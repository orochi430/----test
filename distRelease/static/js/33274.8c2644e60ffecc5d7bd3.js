"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[33274],{41775:function(t,e,n){n.d(e,{Z:function(){return c}});n(23307);var e=n(81392),o=n(26243),s=n.n(o),o=n(79529),l=n.n(o),o=n(46297),a=n(84628),i=n(50856),r=n(25108),o={components:{DsCard:o.Z,DsButtonGroup:a.Z,DsButtonToolbox:i.Z,Icon:e.Z},props:{tabObj:{type:Object},data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},type:{type:String},keyColumn:{type:String},formMethod:{type:String},isHiddenBtn:{type:Boolean,default:function(){}}},data:function(){return{}},created:function(){},computed:{aSubTitles:function(){return r.log(this.columns.filter(function(t){return/^subTitle\w?$/i.test(t.showCategory)})),this.columns.filter(function(t){return/^subTitle\w?$/i.test(t.showCategory)})},bSubTitles:function(){return this.columns.filter(function(t){return/^content$/i.test(t.showCategory)})},needTitles:function(){return this.columns.filter(function(t){return/^needTitle\w?$/i.test(t.showCategory)})},titleIcon:function(){return this.columns.filter(function(t){return/^titleIcon\w?$/i.test(t.showCategory)})}},mounted:function(){r.log(this.bSubTitles)},methods:{isShowColumn:function(t,e){return e.dataValue[t.showMetaColumn]||0===e.dataValue[t.showMetaColumn]},isShowListBtn:function(t){var e=null==this.isHiddenBtn,n=!1,n=!(!t.buttons||!(t.buttons.commonButtons&&0<t.buttons.commonButtons.length||t.buttons.mainButtons&&0<t.buttons.mainButtons.length));return e&&n},link:function(t){var e,n,o,s;t.dataValue.allowMobile&&1!=t.dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):("isRead"in t.dataValue&&!t.dataValue.isRead&&(t.dataValue.isRead=!0),e=(t=t.dataValue)[this.keyColumn]||t.info_id||t.id||t.A0001||t.fid||t["SW_XZD.A0001"],n=this.keyColumn?this.keyColumn.split(".")[0]+".A0004":"",n=t.moduleId||t.A0004||t["SW_XZD.A0004"]||t[n],"db"==this.type&&(n=t.masterModuleId||t.moduleId||t.A0004),s=t.masterId||"",n=n+"/"+e,o={},"gw"==this.type&&(n+="/1",o.todoId=t.todoId),this.type&&(n+="?type=".concat(this.type)),"SigninList"==this.$route.name&&(n+="?&listId=1903161124289nXBk8iVSmTMGYxn9bi&exchangeList=signedList"),"db"==this.type&&(s&&(n+="&masterId=".concat(s)),r.log(this.formMethod),this.formMethod)&&(n+="&formMethod=info"),"dy"==this.type&&(n+="&distribId=".concat(t.distribId),dsf.http.post("fn/mobileToRead/markRead",{pks:t.distribId}).then(function(t){r.log(t)})),this.tabObj&&this.tabObj.targetUrl?(s=this.tabObj.targetUrl.replace("[pk]",e),this.$router.push({path:s})):this.$router.push({path:"/commonForm/"+n,query:o}))},getTitle:function(){return this.columns.find(function(t){return"mainTitle"===t.showCategory})||{}},handleCommonClick:function(t,e,n){e.dataValue.allowMobile&&1!=e.dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):this.$emit("commonClick",t,e,n)},handleMainClick:function(t,e,n){e.dataValue.allowMobile&&1!=e.dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):this.$emit("mainClick",t,e,n)},titleIconColor:function(t,e){t=t.dataValue[e.showMetaColumn].substr(0,1);return dsf.config.listTitleIcon&&-1<s()(dsf.config.listTitleIcon).indexOf(t)?(e=dsf.config.listTitleIcon[t],{backgroundColor:this.colorRgba(e,.12),color:e,borderColor:e}):""},colorRgba:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=t.toLowerCase();if(n&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(n)){if(4===n.length){for(var o="#",s=1;s<4;s+=1)o+=n.slice(s,s+1).concat(n.slice(s,s+1));n=o}for(var a=[],i=1;i<7;i+=2)a.push(l()("0x"+n.slice(i,i+2)));return"rgba("+a.join(",")+","+e+")"}return n}}},c=(0,n(51900).Z)(o,function(){var o=this,s=o._self._c;return s("div",{staticClass:"ds-list"},[o._l(o.data,function(n,e){return s("div",{key:n.id||"item-".concat(e),staticClass:"ds-item"},[s("DsCard",["isRead"in n.dataValue&&!n.dataValue.isRead?s("span",{staticClass:"isStatus"}):o._e(),o._v(" "),"readStatus"in n.dataValue&&"2"!=n.dataValue.readStatus?s("span",{staticClass:"isStatus"}):o._e(),o._v(" "),n.dataValue[o.getTitle().showMetaColumn]?s("div",{class:{ellipsis:o.dsf.config.commonList&&o.dsf.config.commonList.titleEllipsis},attrs:{slot:"header"},on:{click:function(t){return o.link(n)}},slot:"header"},[s("span",{class:{"col-title":"isRead"in n.dataValue&&!n.dataValue.isRead||"readStatus"in n.dataValue&&"2"!=n.dataValue.readStatus},style:{color:o.getTitle().color||"","word-wrap":"break-word","word-break":"break-all"}},[o._v("\n                "+o._s(n.dataValue[o.getTitle().showMetaColumn]))])]):o._e(),o._v(" "),s("div",{staticClass:"content",attrs:{slot:"content"},on:{click:function(t){return o.link(n)}},slot:"content"},[o._t("item-content",function(){return[s("div",{staticClass:"flex1"},[0<o.aSubTitles.length?s("div",{staticClass:"aSubTitles"},[o._l(o.aSubTitles,function(t,e){return[o.isShowColumn(t,n)?s("div",{key:"aSubTitles-".concat(e),staticClass:"subTitle"},[t.icon?s("Icon",{class:["iconfont",t.icon]}):o._e(),o._v(" "),s("span",{staticClass:"label",style:{color:t.color}},[o._v(o._s(n.dataValue[t.showMetaColumn]))])],1):o._e()]})],2):o._e(),o._v(" "),0<o.bSubTitles.length?s("div",{staticClass:"bSubTitles"},[o._l(o.bSubTitles,function(t,e){return[o.isShowColumn(t,n)?s("div",{key:"bSubTitles-".concat(e),staticClass:"subTitle"},[t.icon?s("Icon",{class:["iconfont",t.icon]}):o._e(),o._v(" "),s("span",{class:["label","ds-elips-".concat(t.showRows||1)],style:{color:t.color}},[o._v(o._s(n.dataValue[t.showMetaColumn]))])],1):o._e()]})],2):o._e(),o._v(" "),0<o.needTitles.length?s("div",{staticClass:"needTitles"},[o._l(o.needTitles,function(t,e){return[o.isShowColumn(t,n)?s("div",{key:"needTitles-".concat(e),staticClass:"subTitle"},[s("span",{staticClass:"name label ellipsis"},[o._v(o._s(t.showName))]),o._v(" "),s("span",{staticClass:"label val elips",style:{color:t.color}},[o._v(o._s(n.dataValue[t.showMetaColumn]))])]):o._e()]})],2):o._e()]),o._v(" "),0<o.titleIcon.length?s("div",[o._l(o.titleIcon,function(t,e){return[o.isShowColumn(t,n)?s("div",{key:"titleIcon-".concat(e),staticClass:"moduleIcon",style:o.titleIconColor(n,t)},[s("span",[o._v(o._s(n.dataValue[t.showMetaColumn].substr(0,1)))])]):o._e()]})],2):o._e()]},{item:n}),o._v(" "),o._t("item-extend",null,{item:n})],2),o._v(" "),o.isShowListBtn(n)?s("div",{attrs:{slot:"footer"},slot:"footer"},[o._t("item-footer",function(){return[s("DsButtonToolbox",{attrs:{buttons:n.buttons||{},more:!0,size:"small"},on:{commonClick:function(t){o.handleCommonClick(t,n,e)},mainClick:function(t){o.handleMainClick(t,n,e)}}})]},{item:{}})],2):o._e()])],1)}),o._v(" "),o.data.length||o.$parent.loading?o._e():s("commonempty")],2)},[],!1,null,"7d9709ac",null).exports},33274:function(t,e,n){n.r(e),n.d(e,{default:function(){return _}});var e=n(26243),s=n.n(e),e=n(62680),a=n.n(e),e=n(95366),i=n.n(e),e=n(6919),o=n.n(e),l=n(5044),r=n(66250),c=n(77193),e=n(79529),u=n.n(e),e=n(33453),d=n.n(e),e=n(41775),h=n(50856),f=n(9303),m=n(30819),p=n(63560),g=n(96345),b=n(38496),w=n(91369),v=n(88561),y=n(25108);function C(e,t){var n,o=s()(e);return a()&&(n=a()(e),t&&(n=n.filter(function(t){return i()(e,t).enumerable})),o.push.apply(o,n)),o}var e={name:"TodoCenter",components:{DsList:e.Z,DsfButtonToolbox:h.Z,workFlowDialog:m.Z,selectPerson:p.default,sendFile:g.Z,signFile:b.default,signFilePerson:w.default},mixins:[f.Z],props:{index:{type:String,default:"gw"},animated:{type:Boolean,default:!0},hide:{type:Boolean,default:!1},params:{type:Object,default:function(){}}},data:function(){return{finished:!1,loading:!1,isLoading:!1,finishedTips:"没有更多了",start:1,showPopup:!1,showFlowBack:!1,tab:"gw",tabs:[],componentId:"DsList",data:[],columns:[],listButtons:{},showPerson:!1,selected:null,showFlowSend:!1,extra:{}}},computed:{fetchOptions:function(){var t=this.params,e=t.params;return{url:t.url,params:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):o()?Object.defineProperties(e,o()(n)):C(Object(n)).forEach(function(t){Object.defineProperty(e,t,i()(n,t))})}return e}({start:this.start,page:this.start,limit:15},e)}},hasBottom:function(){var t=this.listButtons.commonButton||[],e=this.listButtons.mainButtons||[];return(t.length||e.length)&&this.data.length}},created:function(){var e=this;return(0,r.Z)(d().mark(function t(){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.tab=e.index,t.next=4,e.getBadge();case 4:e.onRefresh(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.onRefresh();case 10:case"end":return t.stop()}},t,null,[[0,7]])}))()},activated:function(){return(0,r.Z)(d().mark(function t(){return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)}))()},mounted:function(){var t=this;this.$eventBus.onRefresh(this,function(){t.getBadge(),t.onRefresh()})},methods:{handleFlowSendChange:function(){this.showFlowSend=!1,this.onRefresh()},handleFlowBackChange:function(){this.showFlowBack=!1,this.onRefresh()},getContainer:function(){return document.body},getPercent:function(t){t=(t.item.dataValue||{}).process||"";return u()(t.replace("%",""),10)||0},getColor:function(t){t=t.item.dataValue||{},t=new Date(t.bjrq).getTime();return(new Date).getTime()<t?"#F66C6C":"#67C23B"},handleActionClick:function(){var t=arguments[0];1<arguments.length&&arguments[1].dataValue.allowMobile&&1!=arguments[1].dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):(this["action-".concat(t)]||function(){}).apply(void 0,(0,l.Z)(Array.prototype.slice.call(arguments,1)))},getReplaceParams:function(t){return t?t.replace("[user_id]",v.Z.loadSessionStore("user").user_id).replace("[userid]",v.Z.loadSessionStore("user").user_id).replace("[name]",v.Z.loadSessionStore("user").name).replace("[deptId]",v.Z.loadSessionStore("user").deptId).replace("[deptName]",v.Z.loadSessionStore("user").deptName).replace("[logName]",v.Z.loadSessionStore("user").logName).replace("[mobile]",v.Z.loadSessionStore("user").mobile).replace("[root_dept_id]",v.Z.loadSessionStore("user").root_dept_id).replace("[unitId]",v.Z.loadSessionStore("user").unitId):""},fetchData:function(){var a=this,t=(this.loading=!0,this.fetchOptions),e=t.url,t=t.params,e=this.getReplaceParams(e);dsf.http.post(e,t).then(function(t){var e=t.status,t=t.data,n=t.showColumn,o=t.datas,o=void 0===o?[]:o,s=t.listButtons,t=t.total;200===e?(a.start+=1,a.data=[].concat((0,l.Z)(a.data),(0,l.Z)(o)),a.columns=n||[],s&&s.commonButton&&s.commonButton.length&&(s.commonButton=s.commonButton.filter(function(t){return"custom1"!=t.action})),a.listButtons=s||{},a.params.count=t,(null==o||a.data.length===t||0===o.length||o.length<15)&&(a.finished=!0),o.length<a.start&&((null==o||0===o.length)&&0===a.start?a.finishedTips="暂无数据":a.finishedTips="没有更多了")):(a.dsf.layer.toast(message),a.finished=!0,a.finishedTips=message)}).catch(function(t){t=t.message;a.finished=!0,a.dsf.layer.toast(t),a.finishedTips=t}).finally(function(){a.loading=!1,a.isLoading=!1})},onLoad:function(){this.fetchData()},onRefresh:function(){this.finished=!1,this.loading=!0,this.data=[],this.start=1,this.fetchData()},getBadge:function(){var o=this;return(0,r.Z)(d().mark(function t(){var e,n;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=o.params,n=o.getReplaceParams(e.url),dsf.http.post(n,e.countParams).then(function(t){e.count=t.data.total}),o.params=e;case 5:case"end":return t.stop()}},t)}))()},cancePerson:function(){this.showPerson=!1},getSelectUser:function(n){var t,e,o,s,a,i,l=this;y.log("我的",n),0<n.length&&(n.forEach(function(t,e){t.children&&0<t.children.length&&n.splice(e,1)}),t=n.map(function(t){return t.id}),e={},this.isTransfer?1<n.length?dsf.layer.toast("请选择一个人",!0):(o=this.getType(),s=dsf.util.loadSessionStore("user"),a=dsf.layer.loading("取消中"),i=this.selected.dataValue,1===o?dsf.changeUser.flowChangeUser({param:{pk:i.info_id,pId:i.pid,pnId:i.pnid,fromUserId:s.user_id,userId:t.join(","),userName:n.map(function(t){return t.name}).join(","),deptId:n.map(function(t){return t.pid}).join(","),deptName:""},thenFun:function(){return l.onRefresh&&l.onRefresh()},finallyFun:function(){return dsf.layer.closeLoading(a)}}):3===o&&dsf.changeUser.superviseChangeUser({param:{pk:i.info_id||i.id,userId:t.join(",")},thenFun:function(){return l.onRefresh&&l.onRefresh()},finallyFun:function(){return dsf.layer.closeLoading(a)}})):this.isDing?dsf.dd.Ding({users:t,type:2,alertType:2,alertDate:{format:"yyyy-MM-dd HH:mm",value:"2020-05-13 20:00"},attachment:{images:[""]},text:this.selected.dataValue.bt||this.selected.item.dataValue.B0001,bizType:0,onSuccess:function(){this.dsf.layer.toast("操作成功")},onFail:function(){this.dsf.layer.toast("操作失败")}}):dsf.http.post("fn/newMobileMeeting/sendMeetingSq",{pk:this.selected.dataValue.info_id,userIds:t,bt:this.selected.dataValue.bt}).then(function(t){t.data.status&&dsf.layer.toast("操作成功",!0)}).catch(function(t){e={msg:"操作异常",type:!1}}).finally(function(t){e.msg&&dsf.layer.toast(e.msg,e.type)}))},closeSendFile:function(){this.showFlowSend=!1}}},_=(0,n(51900).Z)(e,function(){var e=this,n=e._self._c;return n("div",{class:["ds-hometodocenter",e.hasBottom?"has-bottom":""]},[n("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:e.onRefresh},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[n("van-list",{attrs:{finished:e.finished,"finished-text":e.data.length?e.finishedTips:"",offset:500,"immediate-check":!1},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[n("DsList",{attrs:{tabObj:e.params,type:e.tab,data:e.data,columns:e.columns,formMethod:"info"},on:{mainClick:e.handleActionClick,commonClick:e.handleActionClick},scopedSlots:e._u(["db"===e.tab?{key:"item-extend",fn:function(t){return[n("div",{staticClass:"progress-wrap"})]}}:null],null,!0)})],1)],1),e._v(" "),e.hasBottom?n("div",{staticClass:"footer"},[n("DsfButtonToolbox",{attrs:{more:!0,buttons:e.listButtons},on:{mainClick:e.handleActionClick,commonClick:e.handleActionClick}})],1):e._e(),e._v(" "),n("van-popup",{style:{height:"90vh"},attrs:{"get-container":e.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:e.showPerson,callback:function(t){e.showPerson=t},expression:"showPerson"}},[n("selectPerson",{attrs:{extra:e.extra,type:0},on:{getSelectUser:e.getSelectUser,cancePerson:e.cancePerson}})],1),e._v(" "),n("van-popup",{staticStyle:{height:"90vh"},attrs:{"get-container":e.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:e.showFlowSend,callback:function(t){e.showFlowSend=t},expression:"showFlowSend"}},[e.showFlowSend?n("sendFile",{ref:"sendFile",attrs:{"form-data":e.selected},on:{change:e.handleFlowSendChange,close:e.closeSendFile,golist:e.onRefresh}}):e._e()],1),e._v(" "),n("van-popup",{staticStyle:{height:"90vh"},attrs:{"get-container":e.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:e.showFlowBack,callback:function(t){e.showFlowBack=t},expression:"showFlowBack"}},[n("work-flow-dialog",{ref:"wfDialog",attrs:{"form-data":e.selected},on:{change:e.handleFlowBackChange,close:function(t){e.showFlowBack=!1}}})],1),e._v(" "),n("sign-file",{ref:"signFile"}),e._v(" "),n("sign-file-person",{ref:"signFilePerson"})],1)},[],!1,null,null,null).exports}}]);