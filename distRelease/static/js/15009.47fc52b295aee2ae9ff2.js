(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[15009],{5251:function(t,e){"use strict";e.Z={data:function(){return{timer:""}},mounted:function(){},methods:{debounce:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;clearTimeout(this.timer),this.timer=setTimeout(function(){t()},e)}}}},44174:function(t){t.exports=function(t,e,n,i){for(var s=-1,o=null==t?0:t.length;++s<o;){var a=t[s];e(i,a,n(a),t)}return i}},81119:function(t){t.exports=function(t,e,n,i){for(var s=-1,o=null==t?0:t.length;++s<o;){var a=t[s];e(i,a,n(a),t)}return i}},89465:function(t,e,n){var i=n(38777);t.exports=function(t,e,n){"__proto__"==e&&i?i(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},67206:function(t){t.exports=function(t){return t}},55189:function(t,e,n){var a=n(44174),r=n(81119),c=n(67206),l=n(1469);t.exports=function(s,o){return function(t,e){var n=l(t)?a:r,i=o?o():{};return n(t,s,c(e,2),i)}}},38777:function(t,e,n){var i=n(10852),n=function(){try{var t=i(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=n},10852:function(t){t.exports=function(t,e){return null==t?void 0:t[e]}},7739:function(t,e,n){var i=n(89465),n=n(55189),s=Object.prototype.hasOwnProperty,n=n(function(t,e,n){s.call(t,n)?t[n].push(e):i(t,n,[e])});t.exports=n},1469:function(t){var e=Array.isArray;t.exports=e},15009:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return m}});var e=n(62680),s=n.n(e),e=n(95366),o=n.n(e),e=n(6919),i=n.n(e),a=n(77193),e=n(8450),r=n.n(e),e=n(26243),c=n.n(e),e=n(20629),l=n(90541),u=n(5251),h=n(42152),d=n.n(h),f=n(25108);function p(e,t){var n,i=c()(e);return s()&&(n=s()(e),t&&(n=n.filter(function(t){return o()(e,t).enumerable})),i.push.apply(i,n)),i}var v=n(7739),h={mixins:[u.Z],props:{keyword:{type:String,default:""},url:{type:String,default:""},searchUrl:{type:String,default:""},itemtab:{type:Object,default:function(){return{}}}},data:function(){return{that:this,isShowCount:!0,peopleList:{},indexList:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","W","X","Y","Z"],secIndex:"",secIndexShow:!1,timeout:null,stickyHeight:0,barHeight:{height:"",overflow:"auto"},preNode:null,organization:[],breadList:[],isSeach:!1,userList:[],hasUser:!1,hasgoDetial:!1,showAction:!1,actions:[],selectUser:{},btnCopy:null,phone_system:l.Z.util.checkSystem(),clientName:l.Z.util.getClientName()}},created:function(){this.actions.push({name:"呼叫"}),this.actions.push({name:"复制号码",className:"actionStyle"}),"android"==this.phone_system&&"app"==this.clientName&&this.actions.push({name:"添加到通讯录"}),this.init()},mounted:function(){var t=document.documentElement.style.fontSize.split("px")[0],e=this.isShowAppHeader?.92*t:0,n=this.isShowAppFooter?1.2*t:0;this.stickyHeight=e+1.04*t+.88*t+20,this.barHeight.height=window.innerHeight-n-this.stickyHeight+"px"},activated:function(){},watch:{keyword:function(){var t=this;this.debounce(function(){""!=t.keyword?t.search():(t.isSeach=!1,t.init())},800)},breadList:{handler:function(t,e){var n=this;window.isAddressRoot=0==t.length,this.hasgoDetial=0<t.length,this.$nextTick(function(){var t;n.$refs.scrollRef&&n.breadList.length&&(t=n.$refs.scrollRef.scrollWidth,n.$refs.scrollRef.scrollTo(t,0))})},immediate:!0}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,a.Z)(e,t,n[t])}):i()?Object.defineProperties(e,i()(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,o()(n,t))})}return e}({},(0,e.rn)({isShowAppFooter:function(t){return t.isShowAppFooter},isShowAppHeader:function(t){return t.isShowAppHeader}})),methods:{checkPhoneLength:function(t){var e;return(null==(e=t.mobile)?void 0:e.length)||(null==(e=t.tel)?void 0:e.length)},addPopstate:function(){f.log("indexList-addPopstate"),window.addEventListener("popstate",this.bindPageChange),this.hasgoDetial&&history.pushState(null,null,document.URL),window.isAddressRoot=this.breadList.length==(this.isShowAllOrg?2:0),""!=this.secIndex&&this.$refs.indexList.scrollTo(this.secIndex)},removePopstate:function(t){f.log("indexList-removePopstate"),window.removeEventListener("popstate",this.bindPageChange)},bindPageChange:function(){var t;window.popTarget.length||(2<(t=this).breadList.length?(history.pushState(null,null,document.URL),t.chooseBread(t.breadList[t.breadList.length-2])):2==t.breadList.length?t.chooseBread(t.breadList[t.breadList.length-2]):history.back())},getPhotoSrc:function(t){return l.Z.url.getWebPath(t)+"&time=".concat((new Date).getTime())},chooseBread:function(t){0==t.id?this.init():this.toNext(t)},toNext:function(t){var n=this;0==this.hasgoDetial&&history.pushState(null,null,document.URL),t.hasChildren&&(n.$toast.loading("加载中"),l.Z.http.post(n.url,{groupId:t.id}).then(function(t){n.$toast.clear();var e=t.data.data,e=(n.organization=e.depts,n.breadList=e.navs,t.data.data.users);e.length&&(n.hasUser=!0),n.showUser(e)}))},selectBar:function(t){var e=this;this.secIndex=t,this.secIndexShow=!0,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){e.timeout=null,e.requireFn()},800)},requireFn:function(){this.secIndexShow=!1},toDetail:function(t){this.$router.push({name:"mailDetail",query:{userdata:r()(t)}})},search:function(){var e=this;e.$toast.loading("加载中"),l.Z.http.post(this.searchUrl,{keyword:this.keyword}).then(function(t){e.$toast.clear(),e.isSeach=!0,e.userList=t.data.data,e.userList.length||(e.secIndex="")})},showUser:function(t){var n=v(t,function(t){return t.pinyinInitial.slice(0,1).toUpperCase()}),i={};this.indexList=c()(n).sort(),this.indexList.forEach(function(t,e){i[t]=n[t].sort(function(t,e){return t.userName.localeCompare(e.userName,"zh")})}),this.peopleList=i},init:function(){var n=this;n.breadList=[],l.Z.http.post(this.url,{}).then(function(t){var e=t.data.data.depts.find(function(t){return"未分类"==t.name});return n.organization=t.data.data.depts.filter(function(t){return"未分类"!=t.name}),e?l.Z.http.post(n.url,{groupId:e.id}):{data:{data:{users:[]}}}}).then(function(t){n.hasUser=!1;t=t.data.data.users;t.length&&(n.hasUser=!0),n.showUser(t)})},copyText:function(t){var e=this;e.btnCopy.on("success",function(t){l.Z.layer.toast("复制成功"),t.clearSelection(),e.btnCopy.destroy()}),e.btnCopy.on("error",function(t){l.Z.layer.toast("复制失败"),e.btnCopy.destroy()})},onSelect:function(t,e){f.log(t,e),0==e?this.phoneTo(this.selectUser.mobile||this.selectUser.tel):1==e?this.copyText(this.selectUser.mobile):2==e&&"app"==this.clientName&&$iaction.savePhoneNumber({phoneNumber:this.selectUser.mobile,name:this.selectUser.userName,type:0},function(t){},function(t){})},phoneTo:function(t){window.location.href="tel:".concat(t)},phoneCall:function(t){var e=this;this.selectUser=t,this.showAction=!0,this.$nextTick(function(){document.querySelectorAll(".actionStyle").forEach(function(t){t.setAttribute("data-clipboard-text",e.selectUser.mobile||e.selectUser.tel)}),e.btnCopy=new(d())(document.querySelectorAll(".actionStyle"))})}},filters:{userAvatar:function(t){return t.slice(0,1)},filterMobile:function(t,e){return e.mobileDesensitizationSafeContent||t||e.tel},filterOrg:function(t,e,n){return n.itemtab.isShowAllDept&&e.unitName||t},filterName:function(t){return 4<t.length?t.slice(0,4)+"...":t}}},m=(0,n(51900).Z)(h,function(){var i=this,s=i._self._c;return s("div",{staticClass:"indexList"},[i.isSeach?s("div",{staticClass:"searchCalcHeight"},[s("div",{directives:[{name:"show",rawName:"v-show",value:0<i.userList.length,expression:"userList.length > 0"}],staticClass:"seachPerson"},i._l(i.userList,function(e,t){return s("div",{key:t,staticClass:"disfr"},[s("div",{staticClass:"personInfo disfr ac",on:{click:function(t){return i.toDetail(e)}}},[e.photoSrc?s("img",{staticClass:"userImg",attrs:{src:i.getPhotoSrc(e.photoSrc)}}):s("div",{staticClass:"userImg"},[i._v(i._s(i._f("filterName")(e.userName)))]),i._v(" "),s("div",{staticClass:"itemContent fc jsb flex ellipsis"},[s("span",{staticClass:"personName ellipsis minWid"},[i._v(i._s(e.userName))]),i._v(" "),!e.mobile&&!e.tel||i.dsf.config.addressList.isFideMobile?i._e():s("span",{staticClass:"personNum ellipsis"},[i._v(i._s(i._f("filterMobile")(e.mobile,e)))])]),i._v(" "),s("div",{staticClass:"org-name"},[i._v(i._s(i._f("filterOrg")(e.orgName,e,i.that)))])]),i._v(" "),i.checkPhoneLength(e)?s("div",{staticClass:"personInfoRight"},[s("van-icon",{attrs:{name:"phone"},on:{click:function(t){return i.phoneCall(e)}}})],1):i._e()])}),0),i._v(" "),0==i.userList.length?s("commonempty"):i._e()],1):s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:i.secIndexShow,expression:"secIndexShow"}],staticClass:"secFab"},[i._v(i._s(i.secIndex))]),i._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:1<i.breadList.length,expression:"breadList.length > 1"}],staticClass:"organizationBox flex1 mb10"},[s("div",{staticClass:"organizationitem scrollBoxParent"},[s("div",{ref:"scrollRef",staticClass:"disfr ac ofa"},i._l(i.breadList,function(e,n){return s("div",{key:n,staticClass:"disfr ac wsp",on:{click:function(t){i.breadList.length-1>n&&i.chooseBread(e)}}},[s("span",{class:0==n||n<i.breadList.length-1?"":"normalColor"},[i._v(i._s(e.name))]),i._v(" "),s("van-icon",{directives:[{name:"show",rawName:"v-show",value:n<i.breadList.length-1,expression:"index < breadList.length - 1"}],attrs:{name:"arrow"}})],1)}),0)])]),i._v(" "),s("div",{class:1<i.breadList.length?"calcHeight":"searchCalcHeight",style:1<i.breadList.length?"paddingTop:2px":""},[s("div",{directives:[{name:"show",rawName:"v-show",value:i.organization.length,expression:"organization.length"}],staticClass:"organizationBox flex1 organizationList"},i._l(i.organization,function(e,t){return s("div",{key:t,staticClass:"organizationitem disfr jsb ac",on:{click:function(t){return i.chooseBread(e)}}},[s("span",[i._v(i._s(e.name)),i.isShowCount?s("span",[i._v("（"+i._s(e.userCount)+"）")]):i._e()]),i._v(" "),0<e.userCount?s("van-icon",{attrs:{name:"arrow"}}):i._e()],1)}),0),i._v(" "),i.hasUser?s("van-index-bar",{ref:"indexList",attrs:{"index-list":i.indexList},on:{change:i.selectBar,select:i.selectBar}},i._l(i.peopleList,function(t,e,n){return s("div",{key:n},[s("van-index-anchor",{attrs:{index:e}},[i._v(i._s(e))]),i._v(" "),s("div",{staticClass:"personInfoList"},i._l(t,function(e,t){return s("div",{key:t,staticClass:"disfr"},[s("div",{staticClass:"personInfo disfr ac",on:{click:function(t){return i.toDetail(e)}}},[e.photoSrc?s("img",{staticClass:"userImg",attrs:{src:i.getPhotoSrc(e.photoSrc)}}):s("div",{staticClass:"userImg"},[i._v(i._s(i._f("filterName")(e.userName)))]),i._v(" "),s("div",{staticClass:"itemContent fc jsb flex ellipsis"},[s("span",{staticClass:"personName ellipsis minWid"},[i._v(i._s(e.userName))]),i._v(" "),!e.mobile&&!e.tel||i.dsf.config.addressList.isFideMobile?i._e():s("span",{staticClass:"personNum ellipsis"},[i._v(i._s(i._f("filterMobile")(e.mobile,e)))])]),i._v(" "),s("div",{staticClass:"org-name"},[i._v(i._s(e.orgName))])]),i._v(" "),i.checkPhoneLength(e)?s("div",{staticClass:"personInfoRight"},[s("van-icon",{attrs:{name:"phone"},on:{click:function(t){return i.phoneCall(e)}}})],1):i._e()])}),0)],1)}),0):0==i.organization.length?s("commonempty"):i._e()],1)]),i._v(" "),s("van-action-sheet",{attrs:{actions:i.actions,"cancel-text":"取消","close-on-click-action":""},on:{select:i.onSelect},model:{value:i.showAction,callback:function(t){i.showAction=t},expression:"showAction"}})],1)},[],!1,null,"7499dd64",null).exports}}]);