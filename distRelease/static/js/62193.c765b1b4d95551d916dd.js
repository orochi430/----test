"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[62193],{69273:function(e,t,s){s.d(t,{Z:function(){return i}});var t={name:"fileTypeIcon",props:{fileName:{type:String,default:"cloud"},width:{type:Number,default:32},height:{type:Number,default:38},isDirectory:{type:Number,default:0}},components:{},data:function(){return{}},computed:{iconUrl:function(){var e=this.fileName.substr(this.fileName.lastIndexOf(".")+1);return 1==this.isDirectory?"./static/images/fileTypeIcons/folder.png":"./static/images/fileTypeIcons/"+e+".png"}},watch:{},methods:{},created:function(){},mounted:function(){},destroyed:function(){}},i=(0,s(51900).Z)(t,function(){var e=this,t=e._self._c;return t("van-image",{attrs:{src:e.iconUrl,width:e.width,height:e.height},scopedSlots:e._u([{key:"error",fn:function(){return[t("img",{attrs:{src:s(54073),alt:"",srcset:""}})]},proxy:!0}])})},[],!1,null,null,null).exports},62193:function(e,t,n){n.r(t),n.d(t,{default:function(){return c}});n(39610);var t=n(2163),s=n(70538),i=n(63450),a=n(69273),o=n(25108);s.default.use(t.Z);var s={name:"purviewManage",components:{controlUserList:i.default,fileTypeIcon:a.Z},props:{},data:function(){return{fileid:"",loading:!1,finished:!1,showPerson:!1,selectType:0,extra:{multiple:!0,tabs:[{action:"fn/user/select/data?types=department,person&rootObject=5&action=self_org_suborg_exclusive&async=true&hideNotSelect=1",name:"本机构",subTabKey:"department"},{action:"fn/user/select/data?types=department,person&rootObject=3&action=self_org&async=true&hideNotSelect=1",name:"其他机构",subTabKey:"department"}]},defaultSelectArray:[],privilegeItems:[],privilegeItems1:[{itemCode:"manage",itemText:"可管理",name:"可管理",selected:!1},{itemCode:"edit",itemText:"可编辑",name:"可编辑",selected:!1},{itemCode:"view_download",itemText:"可查看/下载",name:"可查看/下载",selected:!1},{itemCode:"view",itemText:"仅可查看",name:"仅可查看",selected:!0}],ownerObj:{},otherUser:[],showSheet:!1,actions:[],curUser:{},curIndex:0,tabIndex:0,fileObj:{},result:[],checkAll:!1,showChange:!1,username:"",showSheet1:!1,selCode:""}},computed:{},watch:{},created:function(){},mounted:function(){this.fileid=this.$route.params.fileId,this.getShareList(),this.getFileDetail(),this.getCurrentDept()},methods:{getCurrentDept:function(){var s=this;dsf.http.post("fn/user/select/data?types=department,person&rootObject=5&action=self_org_suborg_exclusive&async=true&hideNotSelect=1").then(function(e){var t;o.log(e),e&&"200"==e.data.code&&e.data.data.departmentList&&0<e.data.data.departmentList.length&&(e=e.data.data.departmentList[0].children,t=[],e.forEach(function(e){t.push(e.id.replace("department_",""))}),e="fn/user/select/data?types=department,person&rootObject=3&action=self_org&async=true&hideNotSelect=1&excludeIds="+t.join(","),s.$set(s.extra.tabs[1],"action",e),o.log(e))}).catch(function(e){}).finally(function(){})},getFileDetail:function(){var t=this;dsf.http.post("/fn/cloud/file/getFileById",{id:this.fileid}).then(function(e){e.data&&"200"==e.data.code&&(t.fileObj=e.data.data)}).catch(function(e){}).finally(function(){})},cancePerson:function(){this.showPerson=!this.showPerson},getSelectUser:function(e){var s=this,i=this,n=(o.log(e),[]),a=[];e.forEach(function(t){t.id=t.id.replace("department_",""),s.otherUser.findIndex(function(e){return e.userObjId==t.id})<0&&t.id!=i.ownerObj.userObjId&&(n.push(t),a.push({userObjId:t.id.replace("department_",""),userObjType:5==t.type?2:1,privilegeCode:"view"}))}),this.defaultSelectArray=n,this.showPerson=!1,dsf.http.post("/fn/cloud/privilege/grant",{fileId:this.fileid,objList:a},{headers:{"Content-Type":"application/json"}}).then(function(e){e.data&&"200"==e.data.code&&(dsf.layer.toast("添加成功"),s.getShareList())}).catch(function(e){}).finally(function(){})},getShareList:function(){var s=this;dsf.http.post("/fn/cloud/privilege/shareList",{fileId:this.fileid},{headers:{"Content-Type":"application/json"}}).then(function(e){var t;o.log(e),e.data&&"200"==e.data.code&&(e=e.data.data.userObjList,(t=e[0]).privilegeItems.forEach(function(e){e.selected&&(t.itemText=e.itemText,t.itemCode=e.itemCode)}),s.ownerObj=t,(e=e.splice(1)).forEach(function(t){t.privilegeItems.forEach(function(e){e.name=e.itemText,e.selected&&(t.itemText=e.itemText,t.itemCode=e.itemCode,t.show=!0)})}),s.otherUser=e)}).catch(function(e){}).finally(function(){})},changePurview:function(e,t){e.privilegeItems.forEach(function(e){e.name=e.itemText,e.disabled=e.prohibited,"delete"==e.itemCode&&(e.color="#ee0a24")}),this.privilegeItems=e.privilegeItems,this.curUser=e,this.curIndex=t,this.showSheet=!0},setPurview:function(e,t){"delete"==e.itemCode?(this.otherUser.splice(this.curIndex,1),dsf.http.post("/fn/cloud/privilege/withdraw",{fileId:this.fileid,userObjId:this.curUser.userObjId,userObjType:this.curUser.userObjType||1},{headers:{"Content-Type":"application/json"}}).then(function(e){e.data&&"200"==e.data.code&&dsf.layer.toast("删除成功")}).catch(function(e){}).finally(function(){})):(dsf.http.post("/fn/cloud/privilege/grant",{fileId:this.fileid,objList:[{userObjId:this.curUser.userObjId,userObjType:this.curUser.userObjType||1,privilegeCode:e.itemCode}]},{headers:{"Content-Type":"application/json"}}).then(function(e){e.data&&"200"==e.data.code&&dsf.layer.toast("操作成功")}).catch(function(e){}).finally(function(){}),this.$set(this.otherUser[this.curIndex],"itemText",e.itemText),this.$set(this.otherUser[this.curIndex],"itemCode",e.itemCode),o.log(this.otherUser),this.$forceUpdate())},selectCode:function(t,e){this.result=[],this.checkAll=!1,this.selCode=t,this.username="",this.tabIndex=e,this.otherUser.forEach(function(e){e.show=!t,t&&e.itemCode==t&&(e.show=!0)}),this.$forceUpdate()},search:function(){var t=this;this.username?this.otherUser.forEach(function(e){e.show=!t.selCode,t.selCode?e.itemCode==t.selCode&&0<=e.userObjName.indexOf(t.username)&&(e.show=!0):0<=e.userObjName.indexOf(t.username)?e.show=!0:e.show=!1}):this.selectCode(this.selCode,this.tabIndex),this.$forceUpdate()},goBackUp:function(){this.showChange=!1},setPurview1:function(t,e){var s,i=this;this.$toast.loading({forbidClick:!0,message:"批量删除中"}),("delete"==t.itemCode?(this.otherUser.forEach(function(e){i.result.includes(e.userObjId)&&arr.push({userObjId:e.userObjId,userObjType:e.userObjType||1})}),dsf.http.post("/fn/privilege/withdrawBatch",{fileId:this.fileid,objList:[]},{headers:{"Content-Type":"application/json"}}).then(function(e){e.data&&"200"==e.data.code&&dsf.layer.toast("删除成功")}).catch(function(e){})):(this.$toast.loading({forbidClick:!0,message:"批量授权中"}),s=[],this.otherUser.forEach(function(e){i.result.includes(e.userObjId)&&s.push({userObjId:e.userObjId,userObjType:e.userObjType||1,privilegeCode:t.itemCode})}),dsf.http.post("/fn/cloud/privilege/grant",{fileId:this.fileid,objList:s},{headers:{"Content-Type":"application/json"}}).then(function(e){e.data&&"200"==e.data.code&&dsf.layer.toast("操作成功")}).catch(function(e){}))).finally(function(){i.result=[],i.checkAll=!1,i.showSheet1=!1,i.showChange=!1,i.getShareList(),i.$forceUpdate(),i.$toast.clear()})},showPL:function(){this.selectCode("",0),this.showChange=!0},selectChange:function(){0==this.result.length&&(this.checkAll=!1)},checkChange:function(){var t=this;this.result=[],this.checkAll&&this.otherUser.forEach(function(e){e.show&&t.result.push(e.userObjId)}),this.$forceUpdate()}}},c=(0,n(51900).Z)(s,function(){var i=this,e=i._self._c;return e("div",{staticClass:"purviewManage"},[e("div",{staticClass:"file-item"},[e("div",{staticClass:"fileIcon"},[e("fileTypeIcon",{attrs:{width:18,height:18,"file-name":i.fileObj.name,isDirectory:i.fileObj.isDirectory}})],1),i._v(" "),e("div",{staticClass:"fileBody"},[e("p",[i._v(i._s(i.fileObj.name))]),i._v(" "),e("span",[i._v(i._s(i.fileObj.ownerName)+" 创建")])])]),i._v(" "),e("div",{staticClass:"purview-title"},[e("p",[i._v("指定人及权限\n            ")]),i._v(" "),e("div",{on:{click:i.showPL}},[e("img",{attrs:{src:n(5465),alt:""}}),i._v("批量授权\n        ")])]),i._v(" "),e("div",{staticClass:"user-list"},[e("van-sticky",{attrs:{"offset-top":i.dsf.util.getOffsetTop("46px")}},[e("ul",{staticClass:"user-tab"},[e("li",{class:{active:0==i.tabIndex},on:{click:function(e){return i.selectCode("",0)}}},[i._v("全部")]),i._v(" "),e("li",{class:{active:1==i.tabIndex},on:{click:function(e){return i.selectCode("manage",1)}}},[i._v("可管理")]),i._v(" "),e("li",{class:{active:2==i.tabIndex},on:{click:function(e){return i.selectCode("edit",2)}}},[i._v("可编辑")]),i._v(" "),e("li",{class:{active:3==i.tabIndex},on:{click:function(e){return i.selectCode("view_download",3)}}},[i._v("可查看/下载")]),i._v(" "),e("li",{class:{active:4==i.tabIndex},on:{click:function(e){return i.selectCode("view",4)}}},[i._v("仅可查看")])])]),i._v(" "),e("div",{staticClass:"list-content"},[e("div",{staticClass:"list-box"},[e("div",{directives:[{name:"show",rawName:"v-show",value:0==i.tabIndex,expression:"tabIndex == 0"}],staticClass:"user-item"},[e("img",{staticClass:"userImg",attrs:{src:n(21167),alt:""}}),i._v(" "),e("div",{staticClass:"item-right"},[e("div",{staticClass:"info-left"},[e("p",[i._v(i._s(i.ownerObj.userObjName))])]),i._v(" "),e("div",{staticClass:"info-right"},[e("label",[i._v(i._s(i.ownerObj.itemText))])])])]),i._v(" "),i._l(i.otherUser,function(t,s){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"item.show"}],key:s,staticClass:"user-item"},[e("img",{staticClass:"userImg",attrs:{src:n(21167),alt:""}}),i._v(" "),e("div",{staticClass:"item-right"},[e("div",{staticClass:"info-left"},[e("p",[i._v(i._s(t.userObjName))])]),i._v(" "),e("div",{staticClass:"info-right",on:{click:function(e){return i.changePurview(t,s)}}},[e("p",[e("span",[i._v(i._s(t.itemText))]),i._v(" "),e("img",{attrs:{src:n(68546),alt:""}})])])])])})],2)])],1),i._v(" "),e("div",{staticClass:"add-btn"},[e("div",{on:{click:function(e){i.showPerson=!0}}},[i._v("添加指定人")]),i._v(" "),e("span",[i._v("仅所有者和可管理者能够添加")])]),i._v(" "),e("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom"},model:{value:i.showPerson,callback:function(e){i.showPerson=e},expression:"showPerson"}},[i.showPerson?e("control-user-list",{attrs:{"default-select-array":i.defaultSelectArray,extra:i.extra,selectType:i.selectType},on:{close:i.cancePerson,getSelectUser:i.getSelectUser}}):i._e()],1),i._v(" "),e("van-action-sheet",{attrs:{actions:i.privilegeItems,"cancel-text":"取消","close-on-click-action":""},on:{select:i.setPurview},model:{value:i.showSheet,callback:function(e){i.showSheet=e},expression:"showSheet"}}),i._v(" "),e("van-action-sheet",{attrs:{actions:i.privilegeItems1,"cancel-text":"取消","close-on-click-action":""},on:{select:i.setPurview1},model:{value:i.showSheet1,callback:function(e){i.showSheet1=e},expression:"showSheet1"}}),i._v(" "),e("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom"},model:{value:i.showChange,callback:function(e){i.showChange=e},expression:"showChange"}},[e("div",{staticClass:"piliang"},[e("div",{staticClass:"topbox"},[e("van-nav-bar",{attrs:{title:"批量授权","left-text":"返回","left-arrow":""},on:{"click-left":i.goBackUp}}),i._v(" "),e("van-search",{attrs:{placeholder:"输入姓名检索","left-icon":"",clearable:!1},on:{search:i.search},scopedSlots:i._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconsousuo i1",staticStyle:{color:"#989A9F"}})]},proxy:!0}]),model:{value:i.username,callback:function(e){i.username="string"==typeof e?e.trim():e},expression:"username"}}),i._v(" "),e("ul",{staticClass:"user-tab"},[e("li",{class:{active:0==i.tabIndex},on:{click:function(e){return i.selectCode("",0)}}},[i._v("全部")]),i._v(" "),e("li",{class:{active:1==i.tabIndex},on:{click:function(e){return i.selectCode("manage",1)}}},[i._v("可管理")]),i._v(" "),e("li",{class:{active:2==i.tabIndex},on:{click:function(e){return i.selectCode("edit",2)}}},[i._v("可编辑")]),i._v(" "),e("li",{class:{active:3==i.tabIndex},on:{click:function(e){return i.selectCode("view_download",3)}}},[i._v("可查看/下载")]),i._v(" "),e("li",{class:{active:4==i.tabIndex},on:{click:function(e){return i.selectCode("view",4)}}},[i._v("仅可查看")])])],1),i._v(" "),e("div",{staticClass:"list-box"},[e("van-checkbox-group",{on:{change:i.selectChange},model:{value:i.result,callback:function(e){i.result=e},expression:"result"}},i._l(i.otherUser,function(t,s){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"item.show"}],key:s,staticClass:"user-item"},[i.showChange?e("van-checkbox",{attrs:{name:t.userObjId}}):i._e(),i._v(" "),e("img",{staticClass:"userImg",attrs:{src:n(63769),alt:""}}),i._v(" "),e("div",{staticClass:"item-right"},[e("div",{staticClass:"info-left"},[e("p",[i._v(i._s(t.userObjName))])]),i._v(" "),e("div",{staticClass:"info-right",on:{click:function(e){return i.changePurview(t,s)}}},[e("p",[e("span",[i._v(i._s(t.itemText))]),i._v(" "),e("img",{attrs:{src:n(68546),alt:""}})])])])],1)}),0)],1),i._v(" "),e("div",{staticClass:"add-btn1"},[e("van-checkbox",{on:{click:i.checkChange},model:{value:i.checkAll,callback:function(e){i.checkAll=e},expression:"checkAll"}},[i._v("全选")]),i._v(" "),e("van-button",{attrs:{size:"small",disabled:0==i.result.length,round:"",type:"info"},on:{click:function(e){i.showSheet1=!0}}},[i._v("修改权限")])],1)])])],1)},[],!1,null,"6acd6cd0",null).exports},5465:function(e,t,s){e.exports=s.p+"static/img/icon-batch.f47c21e..png"},68546:function(e,t,s){e.exports=s.p+"static/img/icon-select.d57f450..png"},63769:function(e,t,s){e.exports=s.p+"static/img/upload-img.d85c0b2..png"},21167:function(e,t,s){e.exports=s.p+"static/img/joinUser.40c1b85..png"},54073:function(e,t,s){e.exports=s.p+"static/img/cloud.e0e5c0c..png"}}]);