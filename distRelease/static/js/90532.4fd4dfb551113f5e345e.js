"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[90532],{90532:function(e,t,o){o.r(t),o.d(t,{default:function(){return a}});var l=o(66250),t=o(33453),i=o.n(t),t=o(58930),c=o(25108),t={components:{enclosure:t.default},data:function(){return{fileTitle:"",isShowEnclosure:[!1],moduleTitle:{gzdt:"工作动态",mryq:"每日要情",zydt:"政研动态"},listParams:[{module:"gzdt",listId:"231113152123YlS9UrRPpq5ibRAKFnq",moduleId:"231111101402AlIRsyiV1ihwqvjaeKs"},{module:"mryq",listId:"231113152136mlXkxKL1lzSqFGKzHBD",moduleId:"231111101402AlIRsyiV1ihwqvjaeKs"},{module:"zydt",listId:"231113152146J9T9kSE5Ysmu8xd5Htz",moduleId:"231111101402AlIRsyiV1ihwqvjaeKs"}],publication:[],formMeta:{},allFile:[]}},created:function(){this.getInfo()},methods:{getListImg:function(e){return dsf.url.getServerUrl("fn/file/downloadImage?fileName=".concat(e))},getInfo:function(){var n=this;return(0,l.Z)(i().mark(function e(){var t,o,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={limit:"",page:1,showTotal:!0,isFirst:1,start:1},a=(t=n).listParams.find(function(e){return e.module==n.$route.query.type}),e.next=5,dsf.http.post("fn/list/".concat(a.listId,"/mobile/q?moduleId=").concat(a.moduleId),o).then(function(e){200==e.status&&(t.publication=e.data.datas)});case 5:case"end":return e.stop()}},e)}))()},pubItem:function(o,a,d){var r=this;return(0,l.Z)(i().mark(function e(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.listParams.find(function(e){return e.module==a}).listId,e.next=3,dsf.http.get("fn/xform/getInfo?listId=".concat(t,"&pk=").concat(o.dataValue.A0001,"&moduleId=").concat(o.dataValue.A0004)).then(function(e){var i;200==e.status&&(r.formMeta=e.data.struct,e={info_id:(i=r.formMeta.parameters).pk,infoId:i.pk,nodeId:i.nodeId,flowId:i.flowId,moduleId:i.moduleId,start:1,limit:100},dsf.http.post("fn/mobileAttachment/getFormAttachment",e).then(function(e){c.log("elem",e);var e=e.data.rows,n=dsf.util.loadSessionStore("loginToken"),l=(new Date).getTime(),e=(e.forEach(function(o){var a=[];o.document?(o.document.forEach(function(e,t){e.downloadFileName=dsf.util.stripscript(e.downloadFileName||e.title);t={id:e.id,title:e.title,downloadFileName:e.downloadFileName,type:e.type,size:e.showFileSize||"",navtiveUrl:e.url,url:dsf.url.getServerUrl("fn/office/openMobileOffice?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&fileName=").concat(e.downloadFileName,"&nodeId=").concat(i.nodeId,"&flowId=").concat(i.flowId,"&x-auth-token=").concat(n)),editUrl:dsf.url.getServerUrl("fn/mobileOffice/wordEdit?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&fileName=").concat(e.downloadFileName,"&nodeId=").concat(i.nodeId,"&flowId=").concat(i.flowId,"&x-auth-token=").concat(n)),initUrl:"fn/file/download?infoId=".concat(e.infoId,"&fileId=").concat(e.id,"&fileName=").concat(e.downloadFileName,"&nrType=").concat(e.type,"&moduleId=").concat(e.moduleId,"&x-auth-token=").concat(n,"&fullfilename=").concat(l).concat(e.downloadFileName),handwritingUrl:dsf.url.getServerUrl("fn/office/openMobileOffice?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&fileName=").concat(e.downloadFileName,"&nodeId=").concat(i.nodeId,"&flowId=").concat(i.flowId,"&x-auth-token=").concat(n,"&handwriting=1&screenWidth=").concat(document.body.clientWidth)),infoId:e.infoId,moduleId:e.moduleId,isHandwrite:r.$route.query.isdjOpen?-1:e.isHandwrite,isRevise:e.isRevise,isNoModify:e.isNoModify,canEdit:e.canEdit,canDownLoad:e.canDownLoad,name:1<o.document.length?"".concat(o.name).concat(t+1):o.name};(e.title.toLowerCase().includes(".png")||e.title.toLowerCase().includes(".jpg")||e.title.toLowerCase().includes(".jpeg")||e.title.toLowerCase().includes(".bmp")||e.title.toLowerCase().includes(".gif")||e.title.toLowerCase().includes(".mp4"))&&(t.url=dsf.url.getServerUrl("fn/mobileFileDownload/download?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&fileName=").concat(e.downloadFileName))),"1"==o.canShow&&a.push(t)}),o.file=a):o.file=[],0<o.allowMaintain&&0!=dsf.config.commonForm.canEditFile||0!=o.file.length||(o.canShow="-1")}),r.allFile=e.filter(function(e){return 1==e.canShow}),null==(e=r.allFile[0])||null==(e=e.file[0])?void 0:e.title);r.fileTitle=e.includes(".")?e.split(".")[0]:e,r.isShowEnclosure[d]=!0}))});case 3:case"end":return e.stop()}},e)}))()},closePop:function(e,t){history.back()}}},a=(0,o(51900).Z)(t,function(){var a=this,e=a._self._c;return e("div",{staticClass:"allPublications"},[e("van-cell-group",{staticClass:"cellGroup"},[e("van-cell",{attrs:{title:a.$route.query.title,value:""},scopedSlots:a._u([{key:"icon",fn:function(){return[e("div",{staticClass:"leftIcon"})]},proxy:!0}])}),a._v(" "),e("div",{staticClass:"contenDiv"},a._l(a.publication,function(t,o){return e("div",{key:o,staticClass:"coverInfo",on:{click:function(e){return a.pubItem(t,a.$route.query.type,o)}}},[e("van-image",{attrs:{width:"26vw",fit:"contain",src:a.getListImg(t.dataValue.oa_xxkw_tp)}}),a._v(" "),e("div",{staticClass:"coverTitle"},[a._v(a._s(t.dataValue.B0001))]),a._v(" "),e("van-popup",{staticClass:"flex dc",staticStyle:{height:"100vh"},attrs:{"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom","get-container":"#app"},model:{value:a.isShowEnclosure[o],callback:function(e){a.$set(a.isShowEnclosure,o,e)},expression:"isShowEnclosure[index]"}},[e("van-nav-bar",{attrs:{"left-text":"返回","left-arrow":"",title:a.fileTitle},on:{"click-left":a.closePop}}),a._v(" "),e("enclosure",{ref:"enclosure",refInFor:!0,attrs:{fileData:{info_id:a.formMeta.parameters?a.formMeta.parameters.pk:"",moduleId:a.formMeta.parameters?a.formMeta.parameters.moduleId:"",nodeId:a.formMeta.parameters?a.formMeta.parameters.nodeId:"",nodeName:a.formMeta.parameters?a.formMeta.parameters.nodeName:"",flowId:a.formMeta.parameters?a.formMeta.parameters.flowId:"",pId:a.formMeta.parameters?a.formMeta.parameters.pId:"",pnId:a.formMeta.parameters?a.formMeta.parameters.pnId:"",uploadAttach:a.formMeta.parameters?a.formMeta.parameters.uploadAttach:""},allFile:a.allFile,formMeta:a.formMeta}})],1)],1)}),0)],1)],1)},[],!1,null,"3e2dd5e1",null).exports}}]);