(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[37518,31204],{29871:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return r}});var t=i(77193),n=(i(41762),i(41956)),o=i(25108),t={components:(0,t.Z)({},n.Z.name,n.Z),props:{file:{type:Object,default:function(){}},meetingId:{type:String},isShowCount:{type:Boolean,default:!0},topticId:{type:String,default:""}},data:function(){return{fileType:{pdf:["pdf"],img:["jpeg","bmp","webp","svgz","svg","gif","jpg","ico","png","tif"],txt:["txt","sql","xml","html","css","js","java","php","bat","log"],word:["docx","docm","doc","dotx","dotm","dot"],xls:["xlsx","xlsm","xlsb","xls","xltx","xltm","xlt","xlam","xla","ods"],ppt:["pptx","pptm","ppt","potx","potm","pot","ppsx","ppsm","pps","ppam","ppa"]},hasFilePng:["ai","cloud","html","img","jpg","mp3","mp4","pdf","png","ppt","psd","rar","txt","word","wps","xls","zip","folder"]}},computed:{typeClass:function(){var e,t=this.file.type.toLowerCase();if(this.hasFilePng.includes(t))return i(83887)("./".concat(t,".png"));for(e in this.fileType)if(this.fileType[e].includes(t))return i(83887)("./".concat(e,".png"))}},cteated:function(){},methods:{link:function(e){var t=this;"folder"==t.file.type?t.$router.push({path:"/meetingPad/index/files",query:{title:t.file.folderName,folderId:t.file.folderId,folderModuleId:t.file.folderModuleId}}):(t.setRead(),this.$emit("sendFileData",{id:t.file.fileId,name:t.file.fileName,infoId:t.file.infoId,moduleId:t.file.moduleId,isHandwrite:"1",flowId:t.file.flowId,nodeId:t.file.nodeId,filename:t.file.fileName},this.$route.query.folderId))},setRead:function(){dsf.http.post("fn/conferenceMobile/setRead",{pk:this.file.fileId,moduleId:this.file.moduleId}).done(function(e){o.log("打开文件",e)}).error(function(e){o.log("error",e)}).always(function(){})}}},n=i(51900),t={components:{fileItem:(0,n.Z)(t,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"file",on:{click:function(e){return t.link(0)}}},[e("div",{staticClass:"typeIcon"},[e("img",{attrs:{src:t.typeClass,alt:""}}),t._v(" "),t.file.isNew?e("van-badge",{attrs:{dot:""}}):t._e()],1),t._v(" "),e("div",{staticClass:"info"},["folder"==t.file.type?e("div",[e("div",{staticClass:"title"},[t._v(t._s(t.file.folderName))]),t._v(" "),t.isShowCount?e("div",{staticClass:"num"},[t._v(t._s(t.file.filesCount)+"个文件")]):t._e()]):e("div",[e("div",{staticClass:"title"},[t._v(t._s(t.file.fileName))]),t._v(" "),t.isShowCount?e("div",{staticClass:"num flex jb ac"},[e("span",[t._v(t._s(t.file.updateTime)+" 更新")])]):t._e()])])])])},[],!1,null,"dadae948",null).exports},props:{files:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{sendFileData:function(e,t){this.$emit("sendFileData",e,t)}}},t=(0,n.Z)(t,function(){var i=this,n=i._self._c;return n("div",{staticClass:"file-container"},i._l(i.files,function(e,t){return n("div",{key:t},[n("file-item",{attrs:{file:e},on:{sendFileData:i.sendFileData}}),i._v(" "),t<i.files.length-1?n("van-divider"):i._e()],1)}),0)},[],!1,null,"1efef85e",null).exports,s=i(82060),l=i(25108),t={name:"files",components:{fileList:t,EnclosurePreview:s.default},data:function(){return{folderId:this.$route.query.folderId,folderModuleId:this.$route.query.folderModuleId,files:[],meeting:dsf.util.loadSessionStore("meeting"),popFile:{},showFile:!1,filename:"",isPreview:!0,showSame:!1,meetingObj:{meetingId:"",topicId:"",fileId:"",mode:0}}},computed:{title:function(){return this.$route.query.title||"会议资料"}},created:function(){this.folderId&&this.folderModuleId||(this.folderId=this.meeting.id,this.folderModuleId=""),this.getFolders()},mounted:function(){this.meetingObj.meetingId=this.meeting.id},methods:{showSameClick:function(){this.showSame=!this.showSame},getSameScreenData:function(e,t){this.meetingObj.topicId=t,this.meetingObj.meetingId=dsf.util.loadSessionStore("meeting").id,this.meetingObj.fileId=e.fileId},goPreview:function(){this.isPreview=!0},goHandWrite:function(){this.isPreview=!1},closeFile:function(){this.$refs.enclosurePreview.destroyInterval(),this.showFile=!1},sendFileData:function(e,t){navigator.userAgent.includes("DreamSoft")&&dsf.config.commonForm.nativeWps?this.wpsOpen(e):(this.isPreview=!0,this.popFile=e,this.filename=e.filename,this.showFile=!0,l.log(t),this.getSameScreenData(e,t))},wpsOpen:function(e){var t=dsf.url.getRootPath(),i=dsf.util.loadSessionStore("user").auth.token,t={keepCallback:!0,downUrl:t+"fn/file/download?infoId=".concat(e.infoId,"&fileId=").concat(e.id,"&fileName=").concat(e.name,"&moduleId=").concat(e.moduleId,"&x-auth-token=").concat(i,"&fullfilename=").concat(e.name),saveUrl:"",fileName:e.name,openWithWPS:!0,uploadFile:!0,openMode:"readOnly",enterReviseMode:!1,showReviewingPaneRightDefault:!1,userName:dsf.util.loadSessionStore("user").name};l.log(t),$WPS.downAndOpen(t,function(e){l.log(e)},function(e){l.log("错误回调",e)})},getFolders:function(){var t=this;dsf.http.post("fn/conferenceMobile/files",{meetingId:t.meeting.id,folderId:this.folderId,folderModuleId:this.folderModuleId}).done(function(e){200==e.code&&e.data&&(e.data.folders.forEach(function(e){t.files.push({filesCount:e.filesCount,folderId:e.folderId,folderName:e.folderName,folderModuleId:e.folderModuleId,isNew:!1,type:"folder"})}),e.data.files.map(function(e){t.files.push({fileId:e.fileId,fileName:e.fileName,flowId:e.flowId,isNew:e.isNew,updateTime:e.updateTime,moduleId:e.moduleId,nodeId:e.nodeId,officeModuleId:e.officeModuleId,viewCount:e.count||0,type:e.fileName.substr(e.fileName.lastIndexOf(".")+1).toLowerCase()})}))}).error(function(e){l.log("error",e)}).always(function(){})}}},r=(0,n.Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"file-container"},[e("div",{staticClass:"top"},[e("van-cell",{staticClass:"top-back",attrs:{title:t.title,icon:"arrow-left",center:""},on:{click:function(e){return t.$router.back()}}})],1),t._v(" "),e("div",{staticClass:"content"},[e("fileList",{attrs:{files:t.files},on:{sendFileData:t.sendFileData}})],1),t._v(" "),e("van-popup",{staticClass:"file-preview",staticStyle:{height:"100vh"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom"},model:{value:t.showFile,callback:function(e){t.showFile=e},expression:"showFile"}},[e("van-cell",{staticClass:"top-back",attrs:{title:t.filename,icon:"arrow-left",center:""},on:{click:t.closeFile}}),t._v(" "),e("div",{staticClass:"preview-outer"},[e("enclosure-preview",{ref:"enclosurePreview",attrs:{file:t.popFile,"is-preview":t.isPreview,"is-signature":!0,"is-show-cur-person":!0,meetingObj:t.meetingObj},on:{goPreview:t.goPreview,goHandWrite:t.goHandWrite}})],1)],1)],1)},[],!1,null,"131eb2f8",null).exports},83887:function(e,t,i){var n={"./ai.png":44936,"./cloud.png":54073,"./doc.png":39636,"./docx.png":70071,"./folder-team.png":36556,"./folder.png":7818,"./html.png":97744,"./img.png":32954,"./jpeg.png":90699,"./jpg.png":84693,"./mp3.png":77957,"./mp4.png":96128,"./ofd.png":88825,"./pdf.png":46616,"./png.png":95742,"./ppt.png":68985,"./psd.png":89041,"./rar.png":45074,"./txt.png":48339,"./word.png":26206,"./wps.png":83392,"./xls.png":49472,"./xlsx.png":81682,"./xml.png":66874,"./zip.png":99021};function o(e){e=s(e);return i(e)}function s(e){if(i.o(n,e))return n[e];throw(e=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",e}o.keys=function(){return Object.keys(n)},o.resolve=s,(e.exports=o).id=83887},44936:function(e,t,i){"use strict";e.exports=i.p+"static/img/ai.692fadd..png"},54073:function(e,t,i){"use strict";e.exports=i.p+"static/img/cloud.e0e5c0c..png"},39636:function(e,t,i){"use strict";e.exports=i.p+"static/img/doc.178d734..png"},70071:function(e,t,i){"use strict";e.exports=i.p+"static/img/docx.178d734..png"},36556:function(e,t,i){"use strict";e.exports=i.p+"static/img/folder-team.256a132..png"},7818:function(e,t,i){"use strict";e.exports=i.p+"static/img/folder.b74dd1f..png"},97744:function(e,t,i){"use strict";e.exports=i.p+"static/img/html.aed4382..png"},32954:function(e,t,i){"use strict";e.exports=i.p+"static/img/img.1e66416..png"},90699:function(e,t,i){"use strict";e.exports=i.p+"static/img/jpeg.6690b6f..png"},84693:function(e,t,i){"use strict";e.exports=i.p+"static/img/jpg.6690b6f..png"},77957:function(e,t,i){"use strict";e.exports=i.p+"static/img/mp3.11779e9..png"},96128:function(e,t,i){"use strict";e.exports=i.p+"static/img/mp4.bf3626d..png"},88825:function(e,t,i){"use strict";e.exports=i.p+"static/img/ofd.aa35dda..png"},46616:function(e,t,i){"use strict";e.exports=i.p+"static/img/pdf.0431c10..png"},95742:function(e,t,i){"use strict";e.exports=i.p+"static/img/png.99cbe3b..png"},68985:function(e,t,i){"use strict";e.exports=i.p+"static/img/ppt.2dcd0da..png"},89041:function(e,t,i){"use strict";e.exports=i.p+"static/img/psd.10d45f5..png"},45074:function(e,t,i){"use strict";e.exports=i.p+"static/img/rar.5ca3e88..png"},48339:function(e,t,i){"use strict";e.exports=i.p+"static/img/txt.9b1d964..png"},26206:function(e,t,i){"use strict";e.exports=i.p+"static/img/word.178d734..png"},83392:function(e,t,i){"use strict";e.exports=i.p+"static/img/wps.d841695..png"},49472:function(e,t,i){"use strict";e.exports=i.p+"static/img/xls.e136da2..png"},81682:function(e,t,i){"use strict";e.exports=i.p+"static/img/xlsx.e136da2..png"},66874:function(e,t,i){"use strict";e.exports=i.p+"static/img/xml.aed4382..png"},99021:function(e,t,i){"use strict";e.exports=i.p+"static/img/zip.4b7a304..png"},8167:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,{Z:function(){return n}})},31314:function(e,t,i){"use strict";i.d(t,{Z:function(){return l}});var o=i(26771),s=i(44660);function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),o(e,(0,s.Z)(n.key),n)}}function l(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),o(e,"prototype",{writable:!1}),e}}}]);