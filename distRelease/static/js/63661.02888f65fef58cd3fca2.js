"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[63661],{63661:function(t,i,s){s.r(i),s.d(i,{default:function(){return e}});var a=s(88561),i=s(84528),o=s(25108),i={name:"InspectorCondition",components:{DingBtn:i.default},data:function(){return{alreadyFeedbackTotal:0,noFeedbackTotal:0,isActive:"left",isConditionActive:"fkqs2",listData:[],listDataMock:{},type:1,dingObj:{},params:{pk:""},activeNames:[],wfkData:[]}},mounted:function(){if(this.$route.params.data)a.Z.saveToSessionStore("formData",this.$route.params.data);else{if(!a.Z.loadSessionStore("formData"))return this.$toast.fail("参数错误"),void this.$router.go(-1);this.$route.params.data=a.Z.loadSessionStore("formData")}this.params.pk=this.$route.params.data.dataValue.B0035,o.log(this.params.pk),this.initList()},methods:{initList:function(){var n=this,t=this.$route.params.data.dataValue.B0035;dsf.http.get("fn/superviseV5/feedback/getFeedBackByFid?id=".concat(t,"&rank=2"),n.params).then(function(t){var i=t.data;200===t.status?(n.listData=i.data,o.log(n.listDataMock)):n.dsf.layer.toast(t.message||"获取数据异常")}),dsf.http.get("fn/superviseV5/feedback/getNoFeedBackByFid?id=".concat(t,"&rank=2"),n.params).then(function(t){var i,s,a,e=t.data;o.log(e),200===t.status?(n.wfkData=e.data,i=[],o.log(n.wfkData),n.wfkData.forEach(function(t){i.indexOf(t.foreignId)<0&&i.push(t.foreignId)}),s=dsf.util.loadSessionStore("user"),a={},(e=n.wfkData.reduce(function(t,i){return a[i.foreignId]||i.foreignId==s.foreignId||(a[i.foreignId]=t.push(i)),t},[])).forEach(function(t){t.user_name=t.cbrText,t.foreign_id=t.foreignId,t.id=t.foreignId}),o.log("users==>",i),o.log("canUser",e),n.$set(n.dingObj,"users",i),n.$set(n.dingObj,"selectPerson",e)):n.dsf.layer.toast(t.message||"获取数据异常")})},clickHeader:function(t){this.isActive=t},clickCondition:function(t){o.log(t),this.isConditionActive=t,this.filtersData()},filtersData:function(){"fkqs0"==this.isConditionActive?(this.noFeedbackTotal=this.listDataMock.fkqs0.fkzt01.length,this.alreadyFeedbackTotal=this.listDataMock.fkqs0.fkzt02.length):"fkqs1"==this.isConditionActive?(this.noFeedbackTotal=1<this.listDataMock.lenght?this.listDataMock[1].fkzt1.length:0,this.alreadyFeedbackTotal=1<this.listDataMock.lenght?this.listDataMock[1].fkzt2.length:0):(this.noFeedbackTotal=this.listDataMock[0].fkzt1.length,this.alreadyFeedbackTotal=this.listDataMock[0].fkzt2.length),"fkqs0"==this.isConditionActive&&"left"==this.isActive&&(this.listData=this.filterData(this.listDataMock.fkqs0.fkzt01),o.log(this.listData)),"fkqs0"==this.isConditionActive&&"right"==this.isActive&&(this.listData=this.listDataMock.fkqs0.fkzt02),"fkqs1"==this.isConditionActive&&"left"==this.isActive&&(this.listData=1<this.listDataMock.lenght?this.filterData(this.listDataMock[1].fkzt1):[]),"fkqs1"==this.isConditionActive&&"right"==this.isActive&&(this.listData=1<this.listDataMock.lenght?this.listDataMock[1].fkzt2:[]),"fkqs2"==this.isConditionActive&&"left"==this.isActive&&(this.listData=this.filterData(this.listDataMock[0].fkzt1)),"fkqs2"==this.isConditionActive&&"right"==this.isActive&&(this.listData=this.listDataMock[0].fkzt2);var s=[],a=/(\d{4})-(\d{2})-(\d{2})(\s)(\d{2}):(\d{2})/,e=(o.log(this.listData),this.listData.forEach(function(t){var i;t.time="",t.sjfksj&&(i=a.exec(t.sjfksj),t.time=i[2]+"-"+i[3]+" "+i[5]+":"+i[6]),s.indexOf(t.foreignId)<0&&s.push(t.foreignId)}),dsf.util.loadSessionStore("user")),n={},t=this.listData.reduce(function(t,i){return n[i.foreignId]||i.foreignId==e.foreignId||(n[i.foreignId]=t.push(i)),t},[]);t.forEach(function(t){t.user_name=t.fkr,t.foreign_id=t.foreignId,t.id=t.foreignId}),o.log("users==>",s),o.log("canUser",t),this.$set(this.dingObj,"users",s),this.$set(this.dingObj,"selectPerson",t)},filterData:function(t){var i=[];return t.forEach(function(t){t.data.length&&t.data.forEach(function(t){i.push(t)})}),i},handleClick:function(t){this.$router.push("/commonForm/".concat(t.moduleId,"/").concat(t.feedBackId))}}},e=(0,s(51900).Z)(i,function(){var s=this,a=s._self._c;return a("div",{staticClass:"inspector-condition"},[a("div",{staticClass:"_header"},[a("div",{staticClass:"_btn",class:"left"==s.isActive?"_active":"",on:{click:function(t){return s.clickHeader("left")}}},[s._v("未反馈"),s.noFeedbackTotal?a("span",[s._v("("+s._s(s.noFeedbackTotal)+")")]):s._e()]),s._v(" "),a("div",{staticClass:"_btn",class:"right"==s.isActive?"_active":"",on:{click:function(t){return s.clickHeader("right")}}},[s._v("已反馈"),s.alreadyFeedbackTotal?a("span",[s._v("("+s._s(s.alreadyFeedbackTotal)+")")]):s._e()])]),s._v(" "),"left"==s.isActive?a("div",{class:{_content:!0,_weifankui:"fkqs2"==s.isConditionActive,_yifanhui:"fkqs2"!=s.isConditionActive}},[a("ul",s._l(s.wfkData,function(t,i){return a("li",{key:i,staticClass:"_cell"},[a("span",{staticClass:"icon iconfont icontouxiang"}),s._v(" "),a("span",{staticClass:"_cell__title"},[s._v(s._s(t.cbrText))]),s._v(" "),a("span",{class:1==t.status?"_yi _cell__value":"_wei _cell__value"},[s._v(s._s(t.cbbmText))])])}),0),s._v(" "),a("div",{staticClass:"_footer"},[a("Ding-btn",{attrs:{pk:s.params.pk,prarms:s.dingObj,options:{size:"large",type:"info"},text:"DING一下"}})],1)]):s._e(),s._v(" "),"right"==s.isActive?a("div",{staticClass:"_content _yifanhui"},[a("ul",[a("van-collapse",{model:{value:s.activeNames,callback:function(t){s.activeNames=t},expression:"activeNames"}},s._l(s.listData,function(t,i){return a("van-collapse-item",{key:i,staticClass:"vanCollapse",attrs:{value:"("+t.data.length+"次)",name:i},scopedSlots:s._u([{key:"title",fn:function(){return[a("div",{staticStyle:{"font-size":"var(--font_size_2)",display:"flex"}},[a("span",{staticClass:"icon iconfont icontouxiang",staticStyle:{color:"#3296fa","margin-right":"10px","font-size":"var(--font_size_0)"}}),a("span",[s._v(s._s(t.deptName))])])]},proxy:!0}],null,!0)},[s._v(" "),s._l(t.data,function(i,t){return a("li",{key:t,class:{cell_li:"right"==s.isActive},on:{click:function(t){return s.handleClick(i)}}},[a("div",{staticClass:"cell_line"},[a("div",{staticClass:"cell_name"},[a("span",{staticClass:"_cell__title"},[s._v(s._s(i.feedBackUserName))])]),s._v(" "),a("div",{staticClass:"cell_time"},[a("span",{staticClass:"_yi _cell__value"},[s._v(s._s(i.strDate))])])]),s._v(" "),a("div",{staticClass:"cell_content ellipsis"},[s._v("反馈情况："+s._s(i.content))])])})],2)}),1)],1)]):s._e()])},[],!1,null,"e9bb56da",null).exports}}]);