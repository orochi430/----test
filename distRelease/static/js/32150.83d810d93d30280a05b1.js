"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[32150],{52974:function(t,e,n){n.d(e,{Z:function(){return a}});var e={name:"Squmenu",props:["fontsize","menudata"],data:function(){return{menuList:[]}},watch:{menudata:function(){this.buildMenu(this.menudata)}},created:function(){null==this.menudata&&this.getMenu()},methods:{getMenu:function(){var e=this;dsf.http.post("fn/newFile/shortcutDing").then(function(t){t=t.data;e.buildMenu(t.data)})},buildMenu:function(t){var n=this;t.forEach(function(t){t.children.forEach(function(t){if(!(t.displayPosition.indexOf("shortcut")<0)){var e=t.agentid;try{""!=e&&(e=JSON.parse(e))}catch(t){e={}}e={menuID:t.id,menuText:t.shortcutName,router:t.actUrl.trim(),type:t.shortcutType,params:e,imgUrl:t.shortcutIcon,showClickTip:t.gntsyText,badge:t.tip,badgeNum:0};n.menuList.push(e)}})}),n.$nextTick(function(){n.menuList.forEach(function(a){a.badge&&""!=a.badge&&dsf.http.postUrls(a.badge,{}).then(function(t){if(Array.isArray(t)&&0<t.length)for(var e=0;e<t.length;e++){var n=t[e];a.badgeNum+=n.data.total||n.data.badge||n.data.data}else a.badgeNum+=t.data.total||t.data.badge||t.data.data})})})},openDDApp:function(t){dd.biz.microApp.openApp({agentId:t,onSuccess:function(t){},onFail:function(t){}})},goMenu:function(n){var a=this;this.menuList.forEach(function(t){var e;t.menuID==n&&(""==t.router||null==t.router?t.showClickTip&&dsf.layer.alert({message:t.showClickTip}):t.type&&3==t.type?a.openDDApp(t.router):2==t.type?dsf.config.ddSetting.isDing?dd.biz.util.openLink({url:t.router,onSuccess:function(t){},onFail:function(t){}}):(e=dsf.util.getReplaceUrl(t.router),a.$router.push({path:"iframe",query:{url:e}})):t.params?a.$router.push({name:t.router,params:t.params}):a.$router.push({path:t.router}))})}}},a=(0,n(51900).Z)(e,function(){var n=this,t=n._self._c;return t("div",{staticClass:"ds-squemenu"},[t("div",{staticClass:"dsf-list"},n._l(n.menuList,function(e){return t("div",{key:e.menuID,staticClass:"menu",on:{click:function(t){return n.goMenu(e.menuID)}}},[t("img",{attrs:{src:e.imgUrl,alt:""}}),n._v(" "),t("p",{style:n.fontsize?"font-size:"+n.fontsize:"",domProps:{innerHTML:n._s(e.menuText)}}),n._v(" "),e.badgeNum?t("div",{staticClass:"badge"},[n._v(n._s(e.badgeNum<=99?e.badgeNum:"99+"))]):n._e()])}),0)])},[],!1,null,"e791112c",null).exports},74085:function(t,e,n){n.d(e,{Z:function(){return x}});var e=n(26243),o=n.n(e),e=n(62680),s=n.n(e),e=n(95366),i=n.n(e),e=n(6919),r=n.n(e),l=n(5044),a=n(66250),c=n(77193),e=n(79529),u=n.n(e),e=n(73473),d=n.n(e),e=n(33453),f=n.n(e),e=n(39946),h=n(50856),p=n(9303),m=n(30819),g=n(63560),b=n(96345),v=n(46385),w=n(38496),y=n(91369),k=n(88561),C=n(25108);function S(e,t){var n,a=o()(e);return s()&&(n=s()(e),t&&(n=n.filter(function(t){return i()(e,t).enumerable})),a.push.apply(a,n)),a}var e={name:"TodoCenter",components:{DsList:e.Z,DsfButtonToolbox:h.Z,workFlowDialog:m.Z,selectPerson:g.default,sendFile:b.Z,SeparateRead:v.default,signFile:w.default,signFilePerson:y.default},mixins:[p.Z],props:{index:{type:String,default:"gw"},animated:{type:Boolean,default:!0},hideBottom:{type:Boolean,default:!1}},data:function(){return{finished:!1,loading:!1,isLoading:!1,finishedTips:"没有更多了",start:1,showPopup:!1,showFlowBack:!1,tab:"gw",tabs:[],componentId:"DsList",data:[],columns:[],listButtons:{},showPerson:!1,selected:null,showFlowSend:!1,extra:{},container:null,keyColumn:"",distribIds:""}},computed:{fetchOptions:function(){var t,e,n,a=this;return 0<this.tabs.length?(t=(n=this.tabs.find(function(t){return t.name===a.tab})).params,e=n.url,n=n.nosend,{url:e,params:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):r()?Object.defineProperties(e,r()(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,i()(n,t))})}return e}({start:this.start,page:this.start,limit:15},t),nosend:null!=n&&n}):{}},hasBottom:function(){var t=this.listButtons.commonButton||[],e=this.listButtons.mainButtons||[];return(t.length||e.length)&&this.data.length}},created:function(){var e=this;return(0,a.Z)(f().mark(function t(){return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.tab=e.index,t.next=4,e.initTabs();case 4:return t.next=6,e.getBadge();case 6:t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}},t,null,[[0,8]])}))()},activated:function(){return(0,a.Z)(f().mark(function t(){return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)}))()},mounted:function(){var t=this;this.$eventBus.onRefresh(this,function(){t.getBadge(),t.onRefresh()}),this.container=this.$refs.container},methods:{initTabs:function(){var n=this;return(0,a.Z)(f().mark(function t(){var e;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=dsf.config.homePage.todoCenter,((n.tabs=e).length<2||e[0].isHideTop)&&n.$store.commit("changeHomeTabs",!1);case 3:case"end":return t.stop()}},t)}))()},handleFlowSendChange:function(){this.showFlowSend=!1,this.onRefresh()},handleFlowBackChange:function(){this.showFlowBack=!1,this.onRefresh()},getContainer:function(){return document.body},getPercent:function(t){t=(t.item.dataValue||{}).process||"";return u()(t.replace("%",""),10)||0},getColor:function(t){t=t.item.dataValue||{},t=new Date(t.bjrq).getTime();return(new Date).getTime()<t?"#F66C6C":"#67C23B"},tabChange:function(t){this.onRefresh()},bottomBtnActionClick:function(){(this["".concat(arguments[0])]||function(){}).apply(void 0,(0,l.Z)(Array.prototype.slice.call(arguments,1)))},handleActionClick:function(){var t=arguments[0];1<arguments.length&&arguments[1].dataValue.allowMobile&&1!=arguments[1].dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):(this["action-".concat(t)]||function(){}).apply(void 0,(0,l.Z)(Array.prototype.slice.call(arguments,1)))},getReplaceParams:function(t){return t&&k.Z.loadSessionStore("user")?t.replace("[user_id]",k.Z.loadSessionStore("user").user_id).replace("[userid]",k.Z.loadSessionStore("user").user_id).replace("[name]",k.Z.loadSessionStore("user").name).replace("[deptId]",k.Z.loadSessionStore("user").deptId).replace("[deptName]",k.Z.loadSessionStore("user").deptName).replace("[logName]",k.Z.loadSessionStore("user").logName).replace("[mobile]",k.Z.loadSessionStore("user").mobile).replace("[root_dept_id]",k.Z.loadSessionStore("user").root_dept_id).replace("[unitId]",k.Z.loadSessionStore("user").unitId):t},fetchData:function(){var i=this,t=(this.loading=!0,this.fetchOptions),e=t.url,t=t.params,e=this.getReplaceParams(e);dsf.http.post(e,t).then(function(t){var e=t.status,t=t.data,n=t.showColumn,a=t.datas,a=void 0===a?[]:a,o=t.listButtons,s=t.total;200===e?(i.keyColumn=t.keyColumn,i.start+=1,i.data=[].concat((0,l.Z)(i.data),(0,l.Z)(a)),i.columns=n||[],o&&o.commonButton&&o.commonButton.length&&(o.commonButton=o.commonButton.filter(function(t){return"custom1"!=t.action})),i.listButtons=o||{},i.tabs[i.tabs.findIndex(function(t){return t.name==i.tab})].count=s,(null==a||i.data.length===s||0===a.length||a.length<15)&&(i.finished=!0),i.data.forEach(function(t){i.fetchOptions.nosend&&(t.buttons.mainButtons=t.buttons.mainButtons.filter(function(t){return"faSong"!=t.action})),""!=i.distribIds&&(i.distribIds+=","),i.distribIds+=t.dataValue.distribId}),a.length<i.start&&((null==a||0===a.length)&&0===i.start?i.finishedTips="暂无数据":i.finishedTips="没有更多了")):(i.dsf.layer.toast(message),i.finished=!0,i.finishedTips=message)}).catch(function(t){t=t.message;i.finished=!0,i.dsf.layer.toast(t),i.finishedTips=t}).finally(function(){i.loading=!1,i.isLoading=!1})},onLoad:function(){this.fetchData()},onRefresh:function(){this.finished=!1,this.loading=!0,this.data=[],this.start=1,this.fetchData()},getBadge:function(){var o=this;return(0,a.Z)(f().mark(function t(){var n,a;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((n=o.tabs).length<2)return t.abrupt("return");t.next=3;break;case 3:return a=[],n.forEach(function(t){var e=o.getReplaceParams(t.url);a.push(dsf.http.post(e,t.countParams))}),t.next=7,d().all(a);case 7:t.sent.forEach(function(t,e){t&&(n[e].count=t.data.total)}),o.tabs=n;case 10:case"end":return t.stop()}},t)}))()},cancePerson:function(){this.showPerson=!1},getSelectUser:function(n){var t,e,a,o,s,i,r=this;C.log("我的",n),0<n.length&&(n.forEach(function(t,e){t.children&&0<t.children.length&&n.splice(e,1)}),t=n.map(function(t){return t.id}),e={},this.isTransfer?1<n.length?dsf.layer.toast("请选择一个人",!0):(a=this.getType(),o=dsf.util.loadSessionStore("user"),s=dsf.layer.loading("取消中"),i=this.selected.dataValue,1===a?dsf.changeUser.flowChangeUser({param:{pk:i.info_id,pId:i.pid,pnId:i.pnid,fromUserId:o.user_id,userId:t.join(","),userName:n.map(function(t){return t.name}).join(","),deptId:n.map(function(t){return t.pid}).join(","),deptName:""},thenFun:function(){return r.onRefresh&&r.onRefresh()},finallyFun:function(){return dsf.layer.closeLoading(s)}}):3===a&&dsf.changeUser.superviseChangeUser({param:{pk:i.info_id||i.id,userId:t.join(",")},thenFun:function(){return r.onRefresh&&r.onRefresh()},finallyFun:function(){return dsf.layer.closeLoading(s)}})):this.isDing?dsf.dd.Ding({users:t,type:2,alertType:2,alertDate:{format:"yyyy-MM-dd HH:mm",value:"2020-05-13 20:00"},attachment:{images:[""]},text:this.selected.dataValue.bt||this.selected.item.dataValue.B0001,bizType:0,onSuccess:function(){this.dsf.layer.toast("操作成功")},onFail:function(){this.dsf.layer.toast("操作失败")}}):dsf.http.post("fn/newMobileMeeting/sendMeetingSq",{pk:this.selected.dataValue.info_id,userIds:t,bt:this.selected.dataValue.bt}).then(function(t){t.data.status&&dsf.layer.toast("操作成功",!0)}).catch(function(t){e={msg:"操作异常",type:!1}}).finally(function(t){e.msg&&dsf.layer.toast(e.msg,e.type)}))},closeSendFile:function(){this.showFlowSend=!1}}},x=(0,n(51900).Z)(e,function(){var e=this,n=e._self._c;return n("div",{ref:"container",class:["ds-hometodocenter",e.hasBottom?"has-bottom":""]},[e.$store.state.homeTabs?n("div",{staticClass:"header"},[e._m(0)]):e._e(),e._v(" "),1<e.tabs.length?n("van-tabs",{staticClass:"tabs",attrs:{ellipsis:!1,animated:e.animated,"swipe-threshold":6,sticky:""},on:{change:e.tabChange},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},e._l(e.tabs,function(t){return n("van-tab",{key:t.name,attrs:{name:t.name,title:t.title,badge:(!t.params||t.params.showTotal)&&t.count||"",disabled:e.loading}},[e.tab===t.name?n("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:e.onRefresh},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[n("van-list",{attrs:{finished:e.finished,"finished-text":e.data.length?e.finishedTips:""},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[n("DsList",{ref:"dslist",refInFor:!0,attrs:{tabObj:t,type:e.tab,data:e.data,columns:e.columns,keyColumn:e.keyColumn,formMethod:"info"},on:{mainClick:e.handleActionClick,commonClick:e.handleActionClick},scopedSlots:e._u(["db"===e.tab?{key:"item-extend",fn:function(t){return[n("div",{staticClass:"progress-wrap"})]}}:null],null,!0)})],1)],1):e._e()],1)}),1):e._l(e.tabs,function(t){return n("van-pull-refresh",{key:t.name,attrs:{"success-text":"刷新成功"},on:{refresh:e.onRefresh},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[n("van-list",{attrs:{finished:e.finished,"finished-text":e.data.length?e.finishedTips:""},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[n("DsList",{ref:"dslist",refInFor:!0,attrs:{tabObj:t,type:e.tab,data:e.data,columns:e.columns,formMethod:"info"},on:{mainClick:e.handleActionClick,commonClick:e.handleActionClick},scopedSlots:e._u(["db"===e.tab?{key:"item-extend",fn:function(t){return[n("div",{staticClass:"progress-wrap"})]}}:null],null,!0)})],1)],1)}),e._v(" "),e.hasBottom&&!e.hideBottom?n("div",{staticClass:"footer"},[n("DsfButtonToolbox",{attrs:{more:!0,isFormBtn:!0,buttons:e.listButtons},on:{mainClick:e.bottomBtnActionClick,commonClick:e.bottomBtnActionClick}})],1):e._e(),e._v(" "),n("van-popup",{style:{height:"90vh"},attrs:{"get-container":e.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:e.showPerson,callback:function(t){e.showPerson=t},expression:"showPerson"}},[n("selectPerson",{attrs:{extra:e.extra,type:0},on:{getSelectUser:e.getSelectUser,cancePerson:e.cancePerson}})],1),e._v(" "),n("van-popup",{ref:"sendPop",staticStyle:{height:"90vh"},attrs:{"get-container":e.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:e.showFlowSend,callback:function(t){e.showFlowSend=t},expression:"showFlowSend"}},[n("sendFile",{directives:[{name:"show",rawName:"v-show",value:e.showFlowSend,expression:"showFlowSend"}],ref:"sendFile",attrs:{"form-data":e.selected},on:{change:e.handleFlowSendChange,close:e.closeSendFile}})],1),e._v(" "),n("van-popup",{staticStyle:{height:"90vh"},attrs:{"get-container":e.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:e.showFlowBack,callback:function(t){e.showFlowBack=t},expression:"showFlowBack"}},[n("work-flow-dialog",{ref:"wfDialog",attrs:{"form-data":e.selected},on:{change:e.handleFlowBackChange,close:function(t){e.showFlowBack=!1}}})],1),e._v(" "),n("separate-read",{ref:"readPop"}),e._v(" "),n("sign-file",{ref:"signFile"}),e._v(" "),n("sign-file-person",{ref:"signFilePerson"})],2)},[function(){var t=this._self._c;return t("div",{staticClass:"title"},[t("span",[this._v("待办中心")])])}],!1,null,null,null).exports}}]);