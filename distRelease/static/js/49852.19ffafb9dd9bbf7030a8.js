"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[49852],{84528:function(e,t,n){n.r(t),n.d(t,{default:function(){return h}});var t=n(26243),i=n.n(t),t=n(62680),o=n.n(t),t=n(95366),c=n.n(t),t=n(6919),s=n.n(t),r=n(77193);function a(t,e){var n,s=i()(t);return o()&&(n=o()(t),e&&(n=n.filter(function(e){return c()(t,e).enumerable})),s.push.apply(s,n)),s}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach(function(e){(0,r.Z)(t,e,n[e])}):s()?Object.defineProperties(t,s()(n)):a(Object(n)).forEach(function(e){Object.defineProperty(t,e,c()(n,e))})}return t}var t=n(99965),d=n(25108),t={name:"ding",props:{text:{type:String,default:""},pk:{type:String,default:""},btntype:{type:String,default:""},options:{type:Object,default:function(){return{size:"normal",type:"info"}}},bt:{type:String,default:""},styleOptions:{type:Object,default:function(){return{}}},prarms:{type:Object,default:function(){return{}}}},data:function(){return{defaultStyles:{height:"48px",width:"96%",borderRadius:"6px"},showPerson:!1,selectPersons:[]}},components:{selectPerson:t.Z},methods:{close:function(){this.showPerson=!1,dsf.layer.toast("暂无可钉人员")},ding:function(){var t,n,s=this,i=this.prarms&&this.prarms.users?this.prarms.users:[];if("video"==this.btntype)return i.length?void dsf.dd.video({title:"视频会议",calleeCorpId:dsf.config.ddSetting.ddCoprId,calleeStaffIds:i,onSuccess:function(e){},onFail:function(e){dsf.layer.toast("发起会议失败，存在未激活用户。",!1)},success:function(){toast={msg:"开始视频",type:!1}}}):void dsf.layer.toast("暂无可发起人员");this.selectPersons=this.prarms.selectPerson||[],this.selectPersons=this.selectPersons.filter(function(e){return e.id}),"commonForm"==this.$route.name||0<this.selectPersons.length?this.showPerson=!0:(n=t="",dsf.http.get("fn/common/getFileInfo?pk=".concat(this.pk)).then(function(e){d.log(e),t=e.data.bt,"MeetingSignUpStatus"==s.$route.name&&(n="您有一份标题为【".concat(t,"】的会议通知尚未报名，请及时处理！")),"InspectorCondition"==s.$route.name&&(n="您有一份标题为【".concat(t,"】的督办事项尚未反馈，请及时处理！")),"signIn"==s.$route.name&&(n="您有一份标题为【".concat(t,"】的远程文件尚未签收，请及时处理！")),d.log(n),dsf.dd.Ding({users:i,type:2,alertType:2,text:n,attachment:{images:[""]},bizType:0,confInfo:{bizSubType:0,location:"会议室",remindMinutes:30,remindType:2},taskInfo:{taskRemind:30},onSuccess:function(){},onFail:function(){}})}))},getSelectUser:function(){},cancePerson:function(){this.showPerson=!1},dingding:function(e){var t,n=this,s=e,i=(d.log(s),e.length||dsf.layer.toast("暂无可钉人员"),"");this.bt?dsf.dd.Ding({users:s,type:2,alertType:2,text:this.bt,attachment:{images:[""]},bizType:0,confInfo:{bizSubType:0,location:"公告",remindMinutes:30,remindType:2},taskInfo:{taskRemind:30},onSuccess:function(){},onFail:function(){}}):dsf.http.get("fn/common/getFileInfo?pk=".concat(this.pk)).then(function(e){d.log(e),t=e.data.bt,i="您有一份标题为【".concat(t,"】文件，请及时处理！"),"MeetingSignUpStatus"==n.$route.name&&(i="您有一份标题为【".concat(t,"】的会议通知尚未报名，请及时处理！")),"InspectorCondition"==n.$route.name&&(i="您有一份标题为【".concat(t,"】的督办事项尚未反馈，请及时处理！")),"signIn"==n.$route.name&&(i="您有一份标题为【".concat(t,"】的远程文件尚未签收，请及时处理！")),t||(i="您有一份新文件，请及时处理！"),d.log(i),dsf.dd.Ding({users:s,type:2,alertType:2,text:i,attachment:{images:[""]},bizType:0,confInfo:{bizSubType:0,location:"会议室",remindMinutes:30,remindType:2},taskInfo:{taskRemind:30},onSuccess:function(){},onFail:function(){}})})}}},h=(0,n(51900).Z)(t,function(){var t=this,e=t._self._c;return t.dsf.config.ddSetting&&"dingding"==t.dsf.config.ddSetting.dingdingType?e("div",{staticClass:"box",style:l(l({},t.defaultStyles),t.styleOptions)},[e("van-button",t._b({style:l({},t.styleOptions),on:{click:t.ding}},"van-button",t.options,!1),[t._v(t._s(t.text))]),t._v(" "),e("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,"get-container":"#app",position:"bottom"},model:{value:t.showPerson,callback:function(e){t.showPerson=e},expression:"showPerson"}},[t.showPerson?e("selectPerson",{attrs:{extra:{pk:t.pk},selectPersons:t.selectPersons},on:{close:t.close,getSelectUser:t.getSelectUser,cancePerson:t.cancePerson,dingding:t.dingding}}):t._e()],1)],1):t._e()},[],!1,null,"35ccbf08",null).exports},99965:function(e,t,n){n.d(t,{Z:function(){return i}});var t=n(27921),r=n.n(t),t=n(85579),a=n.n(t),t=n(22013),l=n.n(t),c=n(25108),t={name:"addTree",props:["personSelectData","type"],data:function(){return{isHidden:!1}},created:function(){this.isHidden=void 0,window.GLOBAL.ParentNode=[],window.GLOBAL.personAddList=[]},mounted:function(){},watch:{},methods:{checkAll:function(n){n.children&&0<n.children.length?(this.$set(n,"isopen",!n.isopen),n.isopen?(window.GLOBAL.ParentNode.push(n),n.checked?n.children.forEach(function(e){e.checked=!0}):n.children.forEach(function(e){e.checked=!1})):window.GLOBAL.ParentNode.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.ParentNode.splice(t,1)})):(n.checked?(this.$delete(n,"checked"),this.$set(n,"checked",!1)):(this.$delete(n,"checked"),this.$set(n,"checked",!0)),this.userClick(n))},selectAll:function(e){this.$emit("select",e)},getStyle:function(e){return{"padding-left":"30px","box-sizing":"border-box"}},itemClick:function(e){this.$set(e,"checked",!e.checked),c.log(e)},userClick:function(n){var s=this,i=this,e=(c.log(n),window.GLOBAL.personMultiple?n.checked?(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.push(n),n.children.forEach(function(e){e.checked=!0})),window.GLOBAL.personAddList.push(n)):(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.ParentNode.splice(t,1)}),n.children.forEach(function(e){e.checked=!1})),window.GLOBAL.personAddList.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.personAddList.splice(t,1)})):n.checked?(window.GLOBAL.personAddList.forEach(function(e){i.$set(e,"checked",!1)}),window.GLOBAL.personAddList=[],window.GLOBAL.personAddList.push(n)):window.GLOBAL.personAddList.forEach(function(e,t){i.$set(e,"checked",!1),e.showName==n.showName&&window.GLOBAL.personAddList.splice(t,1)}),window.GLOBAL.personAddList),o={},e=e.reduce(function(e,t){return o[t.id]||(o[t.id]=e.push(t)),e},[]);window.GLOBAL.personAddList=e,c.log("选中的父节点",window.GLOBAL.ParentNode),window.GLOBAL.ParentNode.forEach(function(e){var t=e.children.find(function(e){return 1==e.checked}),n=e.children.find(function(e){return 0==e.checked});null==t&&(s.$delete(e,"checked"),s.$set(e,"checked",!1)),null==n&&(s.$delete(e,"checked"),s.$set(e,"checked",!0))}),this.$emit("select",e),this.$forceUpdate()}}},s=n(51900),t=(0,s.Z)(t,function(){var s=this,i=s._self._c;return i("div",{staticClass:"dsf-tree",staticStyle:{width:"100%",height:"100%"}},s._l(s.personSelectData,function(n,e){return i("div",{key:"index1"+e,staticStyle:{"overflow-y":"hidden"}},[i("div",{staticClass:"flex-box tree_line"},[n.attrs.noselect?s._e():i("van-checkbox",{ref:"check",refInFor:!0,attrs:{"icon-size":"18px"},on:{click:function(e){return s.userClick(n)}},model:{value:n.checked,callback:function(e){s.$set(n,"checked",e)},expression:"item.checked"}}),s._v(" "),i("div",{staticClass:"tree_tit",on:{click:function(e){return s.checkAll(n)}}},[i("span",{class:{tit_width:0<!n.children.length}},[s._v(s._s(n.showName))]),0<n.children.length?i("span",[s._v("("+s._s(n.children.length)+")")]):s._e()]),s._v(" "),0<n.children.length?i("div",{staticClass:"isShowChiled",on:{click:function(e){return s.checkAll(n)}}},[n.isopen?i("van-icon",{attrs:{name:"arrow-up",color:"#3296fa"}}):i("van-icon",{attrs:{name:"arrow-down",color:"#3296fa"}}),s._v(" "),i("span",{staticClass:"r_span"},[s._v(s._s(n.isopen?"收起":"展开"))]),s._v(" "),i("span",{staticClass:"r_line"})],1):s._e()],1),s._v(" "),s._l(n.children,function(t,e){return i("div",{key:"index2"+e,style:{display:n.isopen?"block":"none"}},[1==t.type?i("div",{staticClass:"person",style:{"padding-left":"30px"},on:{click:function(e){return s.userClick(t)}}},[i("div",{staticClass:"flex-box person_child"},[i("van-checkbox",{staticClass:"child_check",attrs:{"icon-size":"16px"},model:{value:t.checked,callback:function(e){s.$set(t,"checked",e)},expression:"cell.checked"}},[i("div",{staticClass:"user-logo"},[i("i",{staticClass:"icon iconfont icontouxiang"})]),s._v(" "),i("div",{staticClass:"username"},[s._v(s._s(t.showName))])])],1)]):s._e()])}),s._v(" "),s._l(n.children,function(e,t){return i("div",{key:"index3"+t,style:{display:n.isopen?"block":"none"}},[1!=e.type?i("div",{style:s.getStyle(n.deep)},[i("add-tree",{attrs:{personSelectData:[e]},on:{select:s.selectAll}})],1):s._e()])})],2)}),0)},[],!1,null,"4ea6c469",null).exports,d=n(25108);function h(e,t){var n,s,i,o,c=void 0!==a()&&e[l()]||e["@@iterator"];if(c)return s=!(n=!0),{s:function(){c=c.call(e)},n:function(){var e=c.next();return n=e.done,e},e:function(e){s=!0,i=e},f:function(){try{n||null==c.return||c.return()}finally{if(s)throw i}}};if(Array.isArray(e)||(c=function(e,t){var n;if(e)return"string"==typeof e?u(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?r()(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return c&&(e=c),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var i=(0,s.Z)({name:"DsfSelectPerson",components:{addTree:t},props:["type","extra","selectPersons"],data:function(){return{show:!0,selectList:[],personSelectData:"",oldV:[],param:{allowEdit:!1,containUnit:"-1",data:"",displayFullPath:"-1",fullOrganize:!1,key:"C-RC-0008",multiple:!0,roles:"",rootObject:"2",schema:"",separator:",",tabs:[{key:"self_org",list:[{key:"department",name:"本机构"}],name:"本单位"}],title:"选择参与人员",type:"userselect",types:["person","department","post"],typesString:"person,department,post",value:""},selectArr:[],selectper:[],pk:""}},created:function(){var e;window.GLOBAL={},this.extra&&(this.pk=this.extra.pk),d.log(this.param,this.type),0<this.selectPersons.length?((e=this.selectPersons).forEach(function(e){e.checked=!1,e.attrs={},e.children=[],e.showName=e.user_name,e.id=e.foreign_id}),this.selectPersons=e,d.log(this.selectPersons),this.personSelectData=[{attrs:{},checked:!1,children:e,showName:"选择人员"}]):this.getPersonList(this.param),window.GLOBAL.selectType=this.type,window.GLOBAL.personMultiple=!0},mounted:function(){},methods:{getPersonList:function(e){var t=dsf.layer.loading("获取中"),n=this,s="fn/mobileToDo/getDingUsersByToDo?pk=".concat(this.pk);dsf.http.post(s).then(function(e){n.personSelectData=e.data.data.codeList,n.personSelectData[0].children.length||n.$emit("close"),n.personSelectData.forEach(function(e){n.addPersonDeep(e,1)}),n.personSelectData.forEach(function(e){e.checked=!1}),n.personSelectData[0].children.forEach(function(e){e.type=1,e.checked=!1}),d.log("人员选择控件",n.personSelectData)}).finally(function(){n.$nextTick(function(){dsf.layer.closeLoading(t)})})},addPersonDeep:function(e,t){var n=this;this.$set(e,"deep",t),this.$set(e,"isopen",t<=1),e.children&&0<e.children.length&&e.children.forEach(function(e){n.addPersonDeep(e,t+1)})},addPerson:function(){var e,s=this,t=[],n=[],i=[],o=(this.selectArr=[],this.selectList.forEach(function(n){n.children&&0<n.children.length&&0<n.children[0].children.length?s.selectArr=[]:n.children&&0<n.children.length?n.children.forEach(function(n){n.checked?s.selectArr.push(n):s.selectArr.forEach(function(e,t){e.showName==n.showName&&s.selectArr.splice(t,1)})}):n.checked?s.selectArr.push(n):s.selectArr.forEach(function(e,t){e.showName==n.showName&&s.selectArr.splice(t,1)})}),{}),c=(this.selectArr=this.selectArr.reduce(function(e,t){return o[t.id]||(o[t.id]=e.push(t)),e},[]),h(this.selectArr));try{for(c.s();!(e=c.n()).done;){var r=e.value;t.push(r.showName),n.push(r.attrs.idValue),i.push(r.type+"::"+r.attrs.idValue)}}catch(e){c.e(e)}finally{c.f()}a=t.join(","),n.join(","),i.join(","),this.person=a,this.show=!1,this.oldV=this.selectList,this.cancePerson(),d.log("最终选择=====>",this.selectArr);var a=this.selectArr.map(function(e){return e.id});d.log(a),this.$emit("dingding",a)},cancePerson:function(){this.$emit("cancePerson")},getSelect:function(e){d.log(e);for(var t in this.selectList=[],e)this.selectList.push(e[t]);d.log(this.selectList)},userClick:function(e){this.$refs.addTree.userClick(e)}}},function(){var e=this,t=e._self._c;return t("div",{staticClass:"dsf-select-person"},[t("add-tree",{ref:"addTree",staticClass:"_add_tree",attrs:{personSelectData:e.personSelectData,type:e.type},on:{select:e.getSelect}}),e._v(" "),t("van-tabbar",[t("van-tabbar-item",{staticClass:"_btns"},[t("van-button",{attrs:{type:"default"},on:{click:e.cancePerson}},[e._v("取消")]),e._v(" "),t("van-button",{attrs:{type:"info"},on:{click:e.addPerson}},[e._v("确定")])],1)],1)],1)},[],!1,null,"44a66037",null).exports}}]);