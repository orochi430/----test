"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[14169],{15582:function(e,o,t){t.r(o),t.d(o,{default:function(){return r}});var s=t(13682),o=t(8450),i=t.n(o),a=t(88561),c=t(62596),o=t(89251),n=t(26983),l=t(25108),o={components:{gesture:o.Z,forgetPassword:n.Z},data:function(){return{logname:"",txtpassword:"",checked:!1,checkedPhone:!1,title:"",DeviceId:"postman",DeviceName:"postman",loginType:"",phone:"",phonecode:"",smsBtnText:"发送验证码",smsBtnEnable:!1,errorMessage:"",hasGesture:!1,logImgStyle:{height:"5rem"},loading:null,autoLogin:!1,phoneValidator:[{required:!0},{pattern:/^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d{8}$/,message:"请输入正确手机号"}],clickIndex:0,loginBackground:dsf.config.setting.hasOwnProperty("SYS-MOBILE-STYLE-0003")&&"".concat(dsf.url.getWebPath(dsf.config.setting["SYS-MOBILE-STYLE-0003"]))||t(41844),isShowAuto:dsf.config.setting.hasOwnProperty("SYS-MOBILE-STYLE-0004")&&dsf.config.setting["SYS-MOBILE-STYLE-0004"]||-1,isShowForget:dsf.config.setting.hasOwnProperty("SYS-MOBILE-STYLE-0006")&&dsf.config.setting["SYS-MOBILE-STYLE-0006"]||-1,isShowSmsLogin:dsf.config.setting.hasOwnProperty("SYS-MOBILE-STYLE-0005")&&dsf.config.setting["SYS-MOBILE-STYLE-0005"]||-1,forgetPwdMsg:dsf.config.setting.hasOwnProperty("SYS-MOBILE-CAPTCHA-0004")&&dsf.config.setting["SYS-MOBILE-CAPTCHA-0004"]||"请联系管理员",isShowChangeType:void 0===dsf.config.login.isShowChangeType||dsf.config.login.isShowChangeType}},computed:{},beforeMount:function(){this.title=dsf.config.login.title},beforeRouteLeave:function(e,o,t){dsf.util.loadSessionStore("loginToken")||"testLogin"!=o.name||"testLogin"==e.name?t():dsf.layer.toast("您进行了未授权的访问，请重新登录！",void 0,function(){t("/testLogin")})},mounted:function(){dsf.util.removeSessionStore("defaultcount"),a.Z.loadLocalStore("autoLogin")&&!a.Z.loadLocalStore("gesture_pas")&&(this.checked=a.Z.loadLocalStore("autoLogin"),this.logname=c.Z.decode(a.Z.loadLocalStore("userName")),this.txtpassword=c.Z.decode(a.Z.loadLocalStore("passWord")),this.checked)&&(this.autoLogin=!0,this.loading=dsf.layer.loading("登录中..."),"app"==a.Z.getClientName()?this.deviceready(this.login):this.login()),a.Z.loadLocalStore("phone")&&(this.checkedPhone=!0,this.phone=c.Z.decode(a.Z.loadLocalStore("phone")))},created:function(){this.hasGesture=!!a.Z.loadLocalStore("gesture_pas"),this.loginType=this.hasGesture?"gesture":dsf.config.login.defaultLoginType||"user","app"==a.Z.getClientName()&&this.deviceready(),this.$route.query.ud&&this.$route.query.pd&&(this.logname=this.$route.query.ud,this.txtpassword=this.$route.query.pd,dsf.config.autoLogin)&&(this.autoLogin=!0,this.loading=dsf.layer.loading("登录中..."),this.login())},methods:{deviceready:function(o){var t=this;document.addEventListener("deviceready",function(){l.log("deviceready_testlogin"),"ios"==dsf.util.checkSystem()?(l.log(device),t.DeviceId=device.uuid,a.Z.saveToLocalStore("DeviceId",t.DeviceId),t.DeviceName=device.model,a.Z.saveToLocalStore("DeviceName",t.DeviceName),o&&o()):(l.log(xsfCommon),xsfCommon.SystemTools(["DeviceId"],function(e){l.log(e),t.DeviceId=JSON.parse(e).DeviceId,a.Z.saveToLocalStore("DeviceId",t.DeviceId),xsfCommon.SystemTools(["DeviceName"],function(e){l.log(e),t.DeviceName=JSON.parse(e).DeviceName,a.Z.saveToLocalStore("DeviceName",t.DeviceName),o&&o()},function(e){alert("open failed: "+e)})},function(e){alert("open failed: "+e)}))})},showDeviceId:function(){var e=this;e.clickIndex++,setTimeout(function(){e.clickIndex=0},300),l.log(e.clickIndex),1<e.clickIndex&&("postman"!=e.DeviceId&&dsf.layer.alert({title:"温馨提示",message:"您的设备码为：".concat(e.DeviceId)}),e.clickIndex=0)},loadImage:function(){this.logImgStyle={}},forgetPassword:function(){this.isShowSmsLogin<=0?dsf.layer.alert({title:"提示",message:this.forgetPwdMsg},function(){}):this.changeLoginType("forgetPassword")},gestureError:function(){this.loginType="user",this.hasGesture=!1},forgetGesture:function(){this.logname=a.Z.loadLocalStore("userName")?c.Z.decode(a.Z.loadLocalStore("userName")):"",a.Z.logOut(),this.changeLoginType("user")},goUrl:function(){dsf.config.login.defaultUrl?this.$router.replace(dsf.config.login.defaultUrl):this.$router.replace("/index")},login:function(){var t=this,e="",n={},o=a.Z.loadLocalStore("user")?a.Z.loadLocalStore("user").autoToken:"";o&&dsf.config.login.tokenAutologin&&this.checked?e="/fn/mobileAuth/autoByToken?autoToken=".concat(o,"&uuid=").concat(t.DeviceId,"&brand=").concat(t.DeviceName):"user"==t.loginType?dsf.config.login.isSpecialLogin?(e="/fn/mobileProjectAuth/auth",o="return "+dsf.config.login.specialLoginParams,new Function("logname","password","deviceId",o)(this.logname,this.txtpassword,this.DeviceId).split(",").forEach(function(e){var o=e.split(":")[0],e=e.split(":")[1];n[o]=e})):(e=dsf.config.login.specialLoginUrl||"/fn/mobileAuth/login",n={__DATA:i()({logname:this.logname,password:this.txtpassword,device_id:t.DeviceId,device_desc:t.DeviceName})}):e="/fn/mobileSmsAuth/login?mobile=".concat(t.phone,"&code=").concat(t.phonecode,"&uuid=").concat(t.DeviceId,"&brand=").concat(t.DeviceName,"&agent=1"),dsf.http.post(e,n).then(function(o){dsf.layer.closeLoading(t.loading),1==o.data.rcode?(a.Z.saveToLocalStore("uid",c.Z.encode(t.logname)),a.Z.saveToLocalStore("pid",c.Z.encode(t.txtpassword)),a.Z.saveToLocalStore("autoLogin",t.checked),a.Z.saveToLocalStore("userName",c.Z.encode(t.logname)),a.Z.saveToLocalStore("passWord",c.Z.encode(t.txtpassword)),t.checkedPhone?a.Z.saveToLocalStore("phone",c.Z.encode(t.phone)):a.Z.removeToLocalStore("phone"),a.Z.saveToSessionStore("user",o.data.data),a.Z.saveToSessionStore("loginToken",o.data.data.auth.token),a.Z.saveToLocalStore("loginToken",o.data.data.auth.token),a.Z.saveToLocalStore("user",o.data.data),a.Z.logIn(function(){var e=o.data.data.user_id;l.log("Client",a.Z.getClientName()),l.log("shkt",o.data.shkt,1==o.data.shkt),"app"==a.Z.getClientName()&&1==o.data.shkt?(l.log("xsfCommon"),xsfCommon.bsCaLogin("",function(e){var o=JSON.parse(e).result;l.log("bsCaLogin",e,(0,s.Z)(e)),1==o&&t.goUrl()},function(e){l.log("bsCaLogin",e,(0,s.Z)(e)),dsf.layer.toast(err)})):dsf.config.login.loginSaveUUID?(e="fn/sso/devicesave?DeviceId="+t.DeviceId+"&DeviceName="+t.DeviceName+"&userId="+e,dsf.http.get(e).then(function(e){t.goUrl()}).catch(function(e){dsf.layer.toast(e.message)})):t.goUrl()})):t.autoLogin=!1,dsf.layer.toast(o.data.message)}).error(function(e){dsf.layer.closeLoading(t.loading),-1<e.message.indexOf("404")&&dsf.layer.toast("登录接口异常，请联系系统管理员！")}).always(function(){})},changeLoginType:function(e){return this.loginType=e,!1},validator:function(e){return e.length?!!/^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d{8}$/.test(this.phone)||!(this.errorMessage="请输入正确的手机号码"):(this.errorMessage="",!1)},sendSmsCode:function(){var n=this,s=0;n.$refs.smslogin.validate("phone").then(function(){return n.smsBtnEnable=!0,s=dsf.layer.loading("发送中..."),dsf.http.get("/fn/mobileSmsAuth/sendSms?mobile=".concat(n.phone,"&uuid=").concat(n.DeviceId,"&brand=").concat(n.DeviceName,"&agent=1"),{})}).then(function(e){var o,t;1==e.data.rcode?(l.log(e),dsf.layer.closeLoading(s),dsf.layer.toast("发送成功！"),o=60,t=setInterval(function(){o--,n.smsBtnText="发送验证码("+o+")",0==o&&(clearInterval(t),n.smsBtnEnable=!1,n.smsBtnText="发送验证码")},1e3)):(dsf.layer.toast(e.data.message),n.smsBtnEnable=!1)}).error(function(e){dsf.layer.closeLoading(s),n.smsBtnEnable=!1,l.log(e),-1<e.message.indexOf("404")&&dsf.layer.toast("短信发送接口异常，请联系系统管理员！")})}}},r=(0,t(51900).Z)(o,function(){var o=this,e=o._self._c;return e("div",{staticClass:"box"},[e("div",{staticClass:"banner",style:o.logImgStyle,on:{click:o.showDeviceId}},[e("img",{attrs:{src:o.loginBackground,alt:""},on:{load:o.loadImage}}),o._v(" "),e("p",{staticClass:"title",domProps:{innerHTML:o._s(o.title)}})]),o._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"user"==o.loginType,expression:"loginType=='user'"}],staticClass:"formbox loginForm"},[e("van-form",{on:{submit:o.login}},[e("van-field",{attrs:{rules:[{required:!0}],name:"账号",placeholder:"请输入账号",center:""},scopedSlots:o._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconzhanghao"})]},proxy:!0}]),model:{value:o.logname,callback:function(e){o.logname=e},expression:"logname"}}),o._v(" "),e("van-field",{attrs:{rules:[{required:!0}],type:"password",name:"密码",placeholder:"请输入密码",center:""},scopedSlots:o._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconmima1"})]},proxy:!0}]),model:{value:o.txtpassword,callback:function(e){o.txtpassword=e},expression:"txtpassword"}}),o._v(" "),e("van-row",{staticClass:"auto",attrs:{type:"flex",justify:"space-between"}},[0<o.isShowAuto?e("van-checkbox",{attrs:{"icon-size":"16",shape:"square"},model:{value:o.checked,callback:function(e){o.checked=e},expression:"checked"}},[o._v("\n                    自动登录\n                ")]):o._e(),o._v(" "),0<o.isShowForget?e("span",{on:{click:function(e){return o.forgetPassword()}}},[o._v("忘记密码")]):o._e()],1),o._v(" "),e("div",{staticClass:"btnbox",staticStyle:{"margin-top":"30px"}},[o.autoLogin?e("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{disabled:o.autoLogin,round:"",type:"info","native-type":"submit"}},[o._v("登录中...")]):e("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{round:"",type:"info","native-type":"submit"}},[o._v("登录")])],1),o._v(" "),o.isShowChangeType?e("div",{staticClass:"changeType"},[0<o.isShowSmsLogin?e("span",{on:{click:function(e){return o.changeLoginType("sms")}}},[o._v("短信验证码登录")]):o._e(),o._v(" "),o.dsf.util.loadLocalStore("gesture_pas")?e("span",{on:{click:function(e){return o.changeLoginType("gesture")}}},[o._v("手势登录")]):o._e()]):o._e()],1),o._v(" "),o.dsf.config.login.isShowIcon?e("van-icon",{staticClass:"login_icon",attrs:{name:"static/images/icon-img.png",size:"50"}}):o._e()],1),o._v(" "),"sms"==o.loginType?e("div",{staticClass:"formbox loginForm"},[e("van-form",{ref:"smslogin",on:{submit:o.login}},[e("van-field",{attrs:{rules:o.phoneValidator,name:"phone",type:"tel",placeholder:"请输入手机号码",center:""},scopedSlots:o._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconshouji"})]},proxy:!0}],null,!1,3510034603),model:{value:o.phone,callback:function(e){o.phone=e},expression:"phone"}}),o._v(" "),e("div",{staticClass:"sendCode"},[e("van-field",{attrs:{rules:[{required:!0}],center:"",clearable:"",name:"短信验证码",placeholder:"请输入验证码"},scopedSlots:o._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconyuechi"})]},proxy:!0}],null,!1,253601634),model:{value:o.phonecode,callback:function(e){o.phonecode=e},expression:"phonecode"}}),o._v(" "),e("van-button",{attrs:{text:o.smsBtnText,disabled:o.smsBtnEnable,size:"small",type:"primary","native-type":"button"},on:{click:function(e){return o.sendSmsCode()}}})],1),o._v(" "),e("van-row",{staticClass:"auto",attrs:{type:"flex",justify:"space-between"}},[0<o.isShowAuto&&o.dsf.config.login.tokenAutologin?e("van-checkbox",{attrs:{"icon-size":"16",shape:"square"},model:{value:o.checked,callback:function(e){o.checked=e},expression:"checked"}},[o._v("\n                    自动登录\n                ")]):o._e(),o._v(" "),e("van-checkbox",{attrs:{"icon-size":"16",shape:"square"},model:{value:o.checkedPhone,callback:function(e){o.checkedPhone=e},expression:"checkedPhone"}},[o._v("\n                    记住手机号\n                ")])],1),o._v(" "),e("div",{staticClass:"btnbox",staticStyle:{"margin-top":"30px"}},[e("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{round:"",type:"info","native-type":"submit"}},[o._v("登录")])],1),o._v(" "),o.isShowChangeType?e("div",{staticClass:"changeType"},[e("span",{on:{click:function(e){return o.changeLoginType("user")}}},[o._v("账号登录")]),o._v(" "),o.dsf.util.loadLocalStore("gesture_pas")?e("span",{on:{click:function(e){return o.changeLoginType("gesture")}}},[o._v("手势登录")]):o._e()]):o._e()],1),o._v(" "),o.dsf.config.login.isShowIcon?e("van-icon",{staticClass:"login_icon",attrs:{name:"static/images/icon-img.png",size:"50"}}):o._e()],1):o._e(),o._v(" "),"gesture"==o.loginType?e("div",{staticClass:"formbox loginForm"},[e("gesture",{attrs:{"gesture-type":"check"},on:{gestureError:o.forgetGesture}}),o._v(" "),o.isShowChangeType?e("div",{staticClass:"changeType"},[e("span",{on:{click:function(e){return o.changeLoginType("user")}}},[o._v("账号登录")]),o._v(" "),0<o.isShowSmsLogin?e("span",{on:{click:function(e){return o.changeLoginType("sms")}}},[o._v("短信验证码登录")]):o._e()]):o._e()],1):o._e(),o._v(" "),"forgetPassword"==o.loginType?e("div",{staticClass:"formbox loginForm"},[e("forget-password",{on:{toLogin:function(e){return o.changeLoginType("user")}}})],1):o._e()])},[],!1,null,"b0e92f9e",null).exports},41844:function(e,o,t){e.exports=t.p+"static/img/loginLogo.6696c0a..png"}}]);