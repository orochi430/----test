"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[32532],{32532:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});var e=a(73473),i=a.n(e),e=a(70596),o=a.n(e),e={name:"meetingvote",props:[],data:function(){return{userName:"",tabnum:0,tabItem:{},optionByTopicId:[],topicId:"",meetingId:"",voteStatisData:{},allOptionUserList:[],btnText:"",isAdmin:!1,default_avatar:'this.src="'+a(11727)+'"',showNodeId:""}},created:function(){var t=this.$route.query;this.topicId=t.topicId,this.meetingId=t.meetingId,this.isAdmin=t.isAdmin,this.showNodeId=t.showNodeId},mounted:function(){var t=dsf.layer.loading();i().all([this.getVoteStatistics(),this.getOptionByTopicId()]).then(function(){dsf.layer.closeLoading(t)}).catch(function(t){dsf.layer.toast("数据获取失败，请稍后重试！",!1)})},watch:{},methods:{getVoteStatistics:function(){var e=this;return dsf.http.post("fn/meetingVote/getVoteStatistics",{topicId:this.topicId,meetingId:this.meetingId}).done(function(t){"200"==t.code?(e.voteStatisData=t.data,"1"==t.data.openFlag?e.btnText="关闭":"-1"==t.data.openFlag&&(e.btnText="开启"),0<t.data.data.length&&e.$nextTick(function(){e.perChart(t.data.data)})):dsf.layer.toast(t.message)})},perChart:function(t){var e=o().init(document.getElementById("perChart")),t={tooltip:{trigger:"item"},legend:{orient:"horizontal",left:"center",bottom:"5%"},grid:{top:"5%"},color:["#FACD00","#9E9E9E","#00AFFF","#0073F2"],series:[{name:"",type:"pie",center:["50%","40%"],radius:["35%","55%"],label:{normal:{formatter:function(t){return 0==t.value?"":["{a|".concat(t.name," ").concat(t.value,"票}"),"{b|".concat(t.percent,"%}")].join("\n")},rich:{a:{fontSize:14,lineHeight:20},b:{fontSize:14}}}},data:t.map(function(t){return t.labelLine={show:0!=t.value},t}),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};e.setOption(t)},getOptionByTopicId:function(){var a=this;return dsf.http.post("fn/meetingVote/getOptionByTopicId",{pk:this.topicId}).done(function(t){var e;"200"==t.code?(e=[{bt:"全部",id:""}],t.data.forEach(function(t){e.push({bt:t.bt,id:t.id})}),e.push({bt:"未表决",id:"-1"}),a.optionByTopicId=e,a.optionUserList(e[0],a.tabnum)):dsf.layer.toast(t.message)})},optionUserList:function(t,e){var a=this;this.tabnum=e,this.tabItem=t,dsf.http.post("fn/meetingVote/getAllOptionUserList",{topicId:this.topicId,meetingId:this.meetingId,optionId:t.id,userName:this.userName}).done(function(t){"200"==t.code?a.allOptionUserList=t.data:dsf.layer.toast(t.message)})},onSearch:function(){this.optionUserList(this.tabItem,this.tabnum)},clearVote:function(){var e=this;dsf.http.post("fn/meetingVote/clearVote",{topicId:this.topicId}).done(function(t){"200"==t.code&&(e.getVoteStatistics(),e.getOptionByTopicId()),dsf.layer.toast(t.message)})},openOrCloseVote:function(){var e=this,a="1"==this.voteStatisData.openFlag?"-1":"1";dsf.http.post("fn/meetingVote/openVote",{topicId:this.topicId,type:a}).done(function(t){"200"==t.code?(e.voteStatisData.openFlag=a,e.btnText="1"==a?"关闭":"开启"):dsf.layer.toast(t.message)})}}},n=(0,a(51900).Z)(e,function(){var i=this,o=i._self._c;return o("div",{staticClass:"meetingvote flex dc",style:{height:"calc(100vh - ".concat(i.dsf.util.getOffsetTop(),")")}},[o("div",{staticClass:"card"},[o("div",{staticClass:"flex ja btn1"},[o("span",[i._v("应参人员 "+i._s(i.voteStatisData.total))]),i._v(" "),o("span",[i._v("实参人员 "+i._s(i.voteStatisData.voteNum))])]),i._v(" "),i.voteStatisData.data&&0<i.voteStatisData.data.length?o("div",{staticClass:"chart",attrs:{id:"perChart"}}):i._e()]),i._v(" "),o("ol",{staticClass:"btn2"},i._l(i.optionByTopicId,function(e,a){return o("li",{key:a,class:{active:i.tabnum==a},on:{click:function(t){return i.optionUserList(e,a)}}},[i._v("\n      "+i._s(e.bt)+"\n    ")])}),0),i._v(" "),o("van-search",{attrs:{placeholder:"搜索","input-align":"left"},on:{search:i.onSearch},model:{value:i.userName,callback:function(t){i.userName=t},expression:"userName"}}),i._v(" "),o("ul",{staticClass:"book"},[0<i.allOptionUserList.length?i._l(i.allOptionUserList,function(t,e){return o("li",{key:e},[o("img",{attrs:{src:i.dsf.url.getWebPath(t.img),onerror:i.default_avatar}}),i._v(" "),o("div",{staticClass:"info"},[o("div",[i._v(i._s(t.userName))]),i._v(" "),o("div",{staticClass:"sub"},[i._v(i._s(t.orgName))])]),i._v(" "),o("span",{class:["tag",t.optionText?"tag-blue":"tag-gray"]},[i._v(i._s(t.optionText||"未表决"))])])}):o("commonempty",{attrs:{description:"暂无数据"}})],2),i._v(" "),"13"==i.showNodeId?o("div",{staticClass:"footer"},[o("van-button",{attrs:{type:"default"},on:{click:i.clearVote}},[i._v("清除表决信息")]),i._v(" "),o("van-button",{attrs:{type:"primary"},on:{click:i.openOrCloseVote}},[i._v(i._s(i.btnText))])],1):i._e()],1)},[],!1,null,"c518797a",null).exports},11727:function(t,e,a){t.exports=a.p+"static/img/default-avatar.ad3a581..png"}}]);