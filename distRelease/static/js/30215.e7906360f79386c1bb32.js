"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[30215],{14352:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});a(17784);var e=a(85573),n=a(62207),i=a.n(n),n=a(70538),s=a(60764),c=a(70596),o=a.n(c),r=a(25108),c={props:["calcType"],data:function(){return{showPop:!1,showPopTitle:"",detailList:{data:[],ydk:{data:[]},wdk:{data:[]}},day:"",groupId:"",tabOrcell:!1,active:-1,tabs:1,list:[],container:null,chartOptions:null,signed:0,due:0,late:0,leaveEarly:0}},methods:{checkBox:function(e){var a=this,n=["打卡人数/应到人数","未打卡","迟到","早退"];dsf.http.post("/ctrl/attendStatistics/attendGroup",{groupId:this.groupId,date:this.day,type:1==e?1:e+1}).then(function(t){t=t.data;a.tabOrcell=0!=e,200==t.code?(a.detailList=1!=e?t.data:t.data.wdk,a.showPop=!0,a.showPopTitle=n[e]):dsf.layer.toast(t.message)})},init:function(t,e){var a=this;this.day=t,this.groupId=e,a.list=[],"1"==a.$route.query.demo?a.list=[{type:"上班打卡",time:"2022-06-08 08:11:22",position:"上海市浦东新区水芸路55号靠近港城广场"},{type:"下班打卡",time:"",position:""}]:0==a.calcType?dsf.http.post("fn/attnd/getMySignRecords",{day:t}).done(function(t){"success"==t.type&&(a.list=t.data)}).error(function(t){r.log("getMySignRecords-error",t)}):dsf.http.post("fn/attnd/getSummary",{sdate:t,edate:t,type:a.calcType,groupId:e}).done(function(t){"success"==t.type&&0<t.data.length&&(a.list=t.data,a.signed=i()(t.data.find(function(t){return"打卡人数"==t.key}).value),a.due=i()(t.data.find(function(t){return"应到人数"==t.key}).value),a.late=i()(t.data.find(function(t){return"迟到"==t.key}).value),a.leaveEarly=i()(t.data.find(function(t){return"早退"==t.key}).value),a.$nextTick(function(){a.drawChart()}))})},drawChart:function(){var e=this,t=o().init(document.getElementById("myChart")),a=(e.signed/e.due).toFixed(2);t.setOption({series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:1,splitNumber:8,axisLine:{lineStyle:{width:20,color:[[a,"#2E71B1"],[1,"#F4F4F4"]]}},pointer:{show:!1},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{offsetCenter:[0,"0%"],fontSize:12},detail:{fontSize:24,offsetCenter:[0,"-30%"],valueAnimation:!0,formatter:function(t){return e.signed+"/"+e.due},color:"#333"},data:[{value:a,name:"打卡人数/应到人数"}],center:["50%","95%"],radius:90}]})}},filters:{dateFormat:function(t){return t?dsf.date.format(t,"hh:ii"):""}}},l=a(51900),c=(0,l.Z)(c,function(){var a=this,n=a._self._c;return n("div",{staticClass:"records-page"},[n("div",{staticClass:"content"},[0==a.list.length?n("commonempty",{attrs:{description:"暂无数据"}}):0==a.calcType?n("div",[n("van-steps",{attrs:{direction:"vertical",active:a.active}},a._l(a.list,function(t,e){return n("van-step",{key:e},[n("div",{staticClass:"title"},[a._v("\n            "+a._s(t.time)+"：\n            "),t.time?n("span",[a._v(" "+a._s(t.type)+" ")]):a._e(),a._v(" "),t.state?n("span",[a._v(" "+a._s(t.state)+" ")]):a._e()]),a._v(" "),t.position?n("div",{staticClass:"position"},[n("van-icon",{attrs:{name:"location-o"}}),a._v(a._s(t.position)+"\n          ")],1):a._e()])}),1)],1):n("div",{staticClass:"charts"},[n("div",{attrs:{id:"myChart"},on:{click:function(t){return a.checkBox(0)}}}),a._v(" "),n("div",{staticClass:"charts-info"},[n("div",{staticClass:"charts-info-container",on:{click:function(t){return a.checkBox(1)}}},[n("div",{staticClass:"num"},[a._v(a._s(a.due-a.signed))]),a._v(" "),n("div",{staticClass:"desc"},[a._v("未打卡")])]),a._v(" "),n("div",{staticClass:"charts-info-container",on:{click:function(t){return a.checkBox(2)}}},[n("div",{staticClass:"num"},[a._v(a._s(a.late))]),a._v(" "),n("div",{staticClass:"desc"},[a._v("迟到")])]),a._v(" "),n("div",{staticClass:"charts-info-container",on:{click:function(t){return a.checkBox(3)}}},[n("div",{staticClass:"num"},[a._v(a._s(a.leaveEarly))]),a._v(" "),n("div",{staticClass:"desc"},[a._v("早退")])])])])],1),a._v(" "),n("van-popup",{staticStyle:{height:"70%"},attrs:{position:"bottom",round:""},model:{value:a.showPop,callback:function(t){a.showPop=t},expression:"showPop"}},[n("van-nav-bar",{attrs:{title:a.showPopTitle,"left-text":"返回","left-arrow":""},on:{"click-left":function(t){a.showPop=!1}}}),a._v(" "),a.tabOrcell?n("div",[0==a.detailList.data.length?n("commonempty",{attrs:{description:"暂无数据"}}):a._l(a.detailList.data,function(t,e){return n("van-cell-group",{key:e},[n("van-cell",{attrs:{title:t.userName}})],1)})],2):n("div",[n("van-tabs",{model:{value:a.tabs,callback:function(t){a.tabs=t},expression:"tabs"}},[n("van-tab",{attrs:{title:"已打卡"}},[0==a.detailList.ydk.data.length?n("commonempty",{attrs:{description:"暂无数据"}}):a._l(a.detailList.ydk.data,function(t,e){return n("van-cell-group",{key:e},[n("van-cell",{attrs:{title:t.userName}})],1)})],2),a._v(" "),n("van-tab",{attrs:{title:"未打卡"}},[0==a.detailList.wdk.data.length?n("commonempty",{attrs:{description:"暂无数据"}}):a._l(a.detailList.wdk.data,function(t,e){return n("van-cell-group",{key:e},[n("van-cell",{attrs:{title:t.userName}})],1)})],2)],1)],1)],1)],1)},[],!1,null,"9b617626",null).exports,d=a(25108),a=(n.default.use(e.Z),{components:{timePicker:s.Z,recordList:c},props:{calcType:{type:Number,default:0}},data:function(){return{show:!1,fieldValue:"",cascaderValue:"",fieldNames:{text:"bt",value:"id"},options:[],endSliderCallBack:null,currentTab:{getDataType:"day",type:"date",url:""},defaultShowType:"week",curyear:null,curmonth:null,activeBgcolor:"#FF6A00",activeTextcolor:"#FFFFFF",todayDotcolor:"#FFFFFF",startNumber:1,clickMode:"month",havaSch:{},cancelChecked:!1,selectedDate:null,now:new Date,mmh:0,late:0,leaveEarly:0,btId:""}},created:function(){this.init()},methods:{init:function(){var e=this;1==e.calcType&&dsf.http.post("/fn/attnd/getAdminAttendGroup").then(function(t){t=t.data;d.log(t),e.options=t.data,e.fieldValue=e.options[0].bt,e.btId=e.cascaderValue=e.options[0].id}),e.checkedDate(dsf.date.format(new Date,"yyyy-mm-dd"))},getAppOnesColors:function(){var e=this;e.curyear>=e.now.getFullYear()&&e.curmonth>e.now.getMonth()||dsf.http.post("fn/attnd/getAppOnesColors",{startData:moment("".concat(e.curyear,"-").concat(e.curmonth+1)).startOf("month").format("YYYY-MM-DD"),endData:moment("".concat(e.curyear,"-").concat(e.curmonth+1)).endOf("month").format("YYYY-MM-DD")}).done(function(t){"success"==t.type?e.havaSch=t.data:d.log("getAppOnesColors-fail",t)}).error(function(t){d.log("getAppOnesColors-err",t)})},onFinish:function(t){t=t.selectedOptions;this.show=!1,this.fieldValue=t.map(function(t){return t.bt}).join("/"),this.btId=this.cascaderValue,this.checkedDate(this.selectedDate)},thisWeek:function(e){var a=this,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.week=e,t&&this.$refs.timePicker.reGetprev_now_next(e[0].date),this.$nextTick(function(){var t=e.filter(function(t){return t.date==a.$refs.timePicker.checkedDate});t.length&&"day"==a.currentTab.getDataType&&"week"==a.defaultShowType?(a.$refs.timePicker.defaultDateShow(t[0]),a.selectedDate=t[0].date):a.selectedDate=""})},thisMonth:function(t){var n=this;this.month=t,this.$nextTick(function(){var e=!1,a="";t.forEach(function(t){t.forEach(function(t){t.isToday&&(e=!0,a=t)})}),e&&"day"==n.currentTab.getDataType&&"month"==n.defaultShowType?(n.$refs.timePicker.defaultDateShow(a),n.selectedDate=a.date):n.selectedDate=""})},checkedDate:function(t){var e=this;this.cancelChecked=!1,this.selectedDate=t,this.$nextTick(function(){""!=t?e.listGetData(t,t):"week"==e.defaultShowType?e.listGetData(e.week[0].date,e.week[6].date):e.listGetData(moment("".concat(e.curyear,"-").concat(e.curmonth+1)).startOf("month").format("YYYY-MM-DD"),moment("".concat(e.curyear,"-").concat(e.curmonth+1)).endOf("month").format("YYYY-MM-DD"))})},toggleShowType:function(t){var e=t[0],t=t[1],a=(this.defaultShowType=e,this.$refs.timePicker.checkedDate),n=a?this.month.filter(function(t){return t.find(function(t){return t.date==a})})[0]:this.week;"week"==e?this.thisWeek(n,t):this.thisMonth(this.month)},listGetData:function(t,e){var a=this;a.$refs.list.init(t,this.btId),d.log("self.week",a.week),d.log("self.month",a.month),0==a.calcType&&a.getSummary(moment("".concat(this.curyear,"-").concat(this.curmonth+1)).startOf("month").format("YYYY-MM-DD"),moment("".concat(this.curyear,"-").concat(this.curmonth+1)).endOf("month").format("YYYY-MM-DD"),a.calcType)},getSummary:function(t,e,a){var n=this;"1"==n.$route.query.demo?(n.mmh=11.4,n.late=0,n.leaveEarly=0):dsf.http.post("fn/attnd/getSummary",{sdate:t,edate:e,type:a}).done(function(t){var e;"success"==t.type&&0<t.data.length&&(n.mmh=i()((null==(e=t.data.find(function(t){return"平均工时"==t.key}))?void 0:e.value)||0),n.late=i()((null==(e=t.data.find(function(t){return"迟到"==t.key}))?void 0:e.value)||0),n.leaveEarly=i()((null==(e=t.data.find(function(t){return"早退"==t.key}))?void 0:e.value)||0))}).error(function(t){d.log("getMyRecords-error",t)}).always(function(){})}},filters:{dateFormat:function(t){return t?dsf.date.format(new Date(Number(t)),"hh:ii"):""}},watch:{curyear:function(t,e){this.getAppOnesColors()},curmonth:function(t,e){this.getAppOnesColors()}}}),u=(0,l.Z)(a,function(){var e=this,t=e._self._c;return t("div",{staticClass:"summary-page"},[1==e.calcType?t("div",{staticClass:"cascader"},[t("van-field",{attrs:{"is-link":"",readonly:"",label:"考勤组",placeholder:"请选择考勤组"},on:{click:function(t){e.show=!0}},model:{value:e.fieldValue,callback:function(t){e.fieldValue=t},expression:"fieldValue"}}),e._v(" "),t("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("van-cascader",{attrs:{"active-color":"#2271b3","field-names":e.fieldNames,title:"请选择考勤组",options:e.options},on:{close:function(t){e.show=!1},finish:e.onFinish},model:{value:e.cascaderValue,callback:function(t){e.cascaderValue=t},expression:"cascaderValue"}})],1)],1):e._e(),e._v(" "),t("div",{staticClass:"summary"},[t("van-cell",{attrs:{title:"".concat(e.curmonth+1,"月汇总"),value:"更多","is-link":"",to:"/attndSummaryMore/".concat(e.calcType,"/").concat(e.btId)}}),e._v(" "),0==e.calcType?t("div",{staticClass:"summary-info"},[t("div",{staticClass:"summary-info-container"},[t("div",{staticClass:"num"},[e._v(e._s(e.late))]),e._v(" "),t("div",{staticClass:"desc"},[e._v("迟到")])]),e._v(" "),t("div",{staticClass:"summary-info-container"},[t("div",{staticClass:"num"},[e._v(e._s(e.leaveEarly))]),e._v(" "),t("div",{staticClass:"desc"},[e._v("早退")])])]):e._e()],1),e._v(" "),t("div",{staticClass:"content"},[t("div",{staticClass:"content-calendar"},[t("van-cell",{attrs:{title:"每日记录(".concat(e.curmonth+1,"月)")}}),e._v(" "),t("time-picker",{directives:[{name:"show",rawName:"v-show",value:"date"==e.currentTab.type,expression:"currentTab.type == 'date'"}],ref:"timePicker",attrs:{"end-slider-call-back":e.endSliderCallBack,"active-bgcolor":e.activeBgcolor,"active-textcolor":e.activeTextcolor,"today-dotcolor":e.todayDotcolor,"start-number":e.startNumber,"click-mode":e.clickMode,"hava-sch":e.havaSch,"cancel-checked":e.cancelChecked,curyear:e.curyear,curmonth:e.curmonth,"show-lunar":!1},on:{"update:havaSch":function(t){e.havaSch=t},"update:hava-sch":function(t){e.havaSch=t},"update:curyear":function(t){e.curyear=t},"update:curmonth":function(t){e.curmonth=t},thisWeek:e.thisWeek,thisMonth:e.thisMonth,checkedDate:e.checkedDate,toggleShowType:function(t){return e.toggleShowType(arguments)}}})],1),e._v(" "),t("div",{staticClass:"content-list"},[t("record-list",{ref:"list",attrs:{"calc-type":e.calcType}})],1)])])},[],!1,null,"1b4b2188",null).exports}}]);