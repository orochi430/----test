"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[16726],{16726:function(n,t,e){e.r(t),e.d(t,{default:function(){return o}});var i=e(5044),s=e(25108),t={filters:{dateFormat:function(n){return n?dsf.date.format(new Date(Number(n)),"hh:ii"):""}},data:function(){return{list:[],refreshing:!1,loading:!1,finished:!1,showPicker:!1,page:1,options:dsf.config.attendance.applications.forms}},computed:{showList:function(){return this.list.map(function(n){return n.title="".concat(n.state,"：").concat(dsf.date.format(n.signTime,"yyyy-mm-dd hh:ii")),n})}},created:function(){},mounted:function(){},methods:{onConfirm:function(n,t){this.showPicker=!1,this.$router.push(dsf.util.getReplaceUrl(n.url))},init:function(){0==this.list.length&&this.onLoad()},onLoad:function(){var e=this;e.refreshing&&(e.list=[],e.page=1,e.refreshing=!1),dsf.http.post("fn/attnd/getMyAbnormalRecords",{page:e.page,count:10}).done(function(n){var t;"success"==n.type?((t=e.list).push.apply(t,(0,i.Z)(n.data.list)),e.page++,e.list.length==n.data.total&&(e.finished=!0)):e.list=null}).error(function(n){e.list=null,s.log("getMyAbnormalRecords-error",n)}).always(function(){e.loading=!1})},onRefresh:function(){var n=this;n.finished=!1,n.loading=!0,n.onLoad()},applyClick:function(t){var e,n,i;1!=t.kqState&&(e=this,(n=null==(n=dsf.config.attendance.applications)||null==(n=n.forms)?void 0:n.find(function(n){return"考勤异常申请"==n.name}))?(i=n.url,dsf.http.get("fn/itas/leave/findUserExceCount",{exdate:t.signTime.split(" ")[0]}).done(function(n){"success"==n.type?n.data?e.$router.push(dsf.util.getReplaceUrl(i,t)):dsf.layer.toast("已超过该月申请次数",!1):dsf.layer.toast(n.message,!1)}).error(function(n){dsf.layer.toast("发生错误，请稍后重试",!1),s.log("findUserExceCount-err",n)})):e.showPicker=!0)}}},o=(0,e(51900).Z)(t,function(){var e=this,i=e._self._c;return i("div",{staticClass:"abnormalities-page"},[e.list?i("div",[i("div",{staticClass:"content"},[i("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.refreshing,callback:function(n){e.refreshing=n},expression:"refreshing"}},[i("van-list",{attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.onLoad},model:{value:e.loading,callback:function(n){e.loading=n},expression:"loading"}},e._l(e.showList,function(t,n){return i("div",{key:n,staticClass:"flex",class:{done:1==t.kqState}},[i("span",[e._v(e._s(t.title))]),e._v(" "),i("span",{on:{click:function(n){return e.applyClick(t)}}},[e._v(e._s(1==t.kqState?"已申请":"申请"))])])}),0)],1)],1)]):i("commonempty",{attrs:{image:"error",description:"发生错误"}}),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showPicker,callback:function(n){e.showPicker=n},expression:"showPicker"}},[i("van-picker",{attrs:{columns:e.options,"swipe-duration":300,title:"请选择你的异常处理单","show-toolbar":"","value-key":"name"},on:{cancel:function(n){e.showPicker=!1},confirm:e.onConfirm}})],1)],1)},[],!1,null,"184b640a",null).exports}}]);