"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[11358],{11358:function(t,e,n){n.r(e),n.d(e,{default:function(){return b}});var e=n(26243),s=n.n(e),e=n(62680),o=n.n(e),e=n(95366),i=n.n(e),e=n(6919),a=n.n(e),c=n(77193),e=n(8450),r=n.n(e),e=n(20629),l=n(99965),d=n(14355),f=n(25108),h={name:"dxqLit",props:["dataList","holiday","year"],components:{selectPerson:l.Z},data:function(){return{selectPersons:[],showPerson:!1}},created:function(){var n=this;this.dataList.forEach(function(t,e){t={user_name:t.orgName,foreign_id:t.foreignId,id:t.foreignId};n.selectPersons.push(t)})},methods:{Ding:function(t){f.log(t),t.foreignId?dsf.dd.Ding({users:[t.foreignId],type:2,alertType:2,text:t.dingContent}):dsf.layer.toast("请联系管理员维护值班室主任人员")},close:function(){this.showPerson=!1,dsf.layer.toast("暂无可钉人员")},getSelectUser:function(){},cancePerson:function(){this.showPerson=!1},dingding:function(t){var e=t;f.log(e),t.length?dsf.dd.Ding({users:e,type:2,alertType:2,text:"请尽快上报".concat(this.year).concat(this.holiday,"值班带班表")}):dsf.layer.toast("暂无可钉人员")}}},u=n(51900),h=(0,u.Z)(h,function(){var n=this,a=n._self._c;return a("div",{staticClass:"box dxqListBox"},[n._l(n.dataList,function(e,t){return n.dataList&&n.dataList.length?a("div",{key:t,staticClass:"dxqItem"},[a("span",[n._v(n._s(e.orgName))]),n._v(" "),a("van-button",{staticClass:"dxqbtn",attrs:{type:"info",size:"mini"},on:{click:function(t){return n.Ding(e)}}},[n._v("催报")])],1):n._e()}),n._v(" "),a("footer",{},[a("van-button",{attrs:{type:"info"},on:{click:function(t){n.showPerson=!0}}},[n._v("催报")])],1),n._v(" "),n.dataList.length?n._e():a("commonempty"),n._v(" "),a("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,"get-container":"#app",position:"bottom"},model:{value:n.showPerson,callback:function(t){n.showPerson=t},expression:"showPerson"}},[n.showPerson?a("selectPerson",{attrs:{selectPersons:n.selectPersons},on:{close:n.close,getSelectUser:n.getSelectUser,cancePerson:n.cancePerson,dingding:n.dingding}}):n._e()],1)],2)},[],!1,null,"f327583a",null).exports,g=n(25108);function p(e,t){var n,a=s()(e);return o()&&(n=o()(e),t&&(n=n.filter(function(t){return i()(e,t).enumerable})),a.push.apply(a,n)),a}var n={name:"commonListWrap",components:{commonList:d.default,dxqList:h,selectPerson:l.Z},data:function(){return{activeName:"",subActive:"",filterData:{},params:{},configJson:{},timeVal:"",showCalendar:!1,controlData:{inputAlign:"right",type:"range",title:"启程时间",placeholder:"时间选择",color:"#3296FA",minDate:new Date((new Date).getFullYear()-40,0,1),maxDate:new Date((new Date).getFullYear()+10,11,31),confirmText:"确定",confirmDisText:"请选择",position:"bottom",maxRange:"5",showMark:!0,showConfirm:!0,round:!0,rangePrompt:"超出可选范围",allowSameDay:!0,firstDayOfWeek:"1"},showList:!1,firstOffsetHeight:"",subOffsetHeight:"",listOffsetHeight:"",ifSb:!0,hasSubTab:!1,showYearPicker:!1,yearColumns:["2021","2020","2019"],showColumns:[],holidayColumns:["元旦","清明","劳动节","中秋节","端午节"],pickType:"",showPerson:!1,dingType:"Ding",selectPersons:[],allList:[],nowDay:""}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):a()?Object.defineProperties(e,a()(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,i()(n,t))})}return e}({},(0,e.rn)({isShowAppFooter:function(t){return t.isShowAppFooter},isShowAppHeader:function(t){return t.isShowAppHeader}})),created:function(){this.init()},methods:{Ding:function(t){this.dingType=t,this.selectPersons.length<1?dsf.layer.toast("暂无可操作人员"):this.showPerson=!0},cancePerson:function(){this.showPerson=!1},dingding:function(t){var a=this,e=t;g.log(e),t.length?"Ding"==this.dingType?dsf.dd.serverDing(e):(t=e.map(function(e,t){var n=a.allList.find(function(t){return t.dataValue["A0001.value"]==e});return g.log(n),n?n.dataValue["B0009.value"]:""}),g.log(t),dsf.dd.video({title:"值班人员平安会议",calleeCorpId:dsf.config.ddSetting.ddCoprId,calleeStaffIds:t,onSuccess:function(t){},onFail:function(t){dsf.layer.toast("发起会议失败，存在未激活用户。",!1)},success:function(){toast={msg:"开始视频",type:!1}}})):dsf.layer.toast("暂无可发人员")},goWrite:function(){this.$router.push("/commonForm/201125171531HhP41e8lrLw0T7kuFXK/".concat(this.configJson.tbid))},tabChangeData:function(t){var e,n;"xingchengtongji_huizong"==this.$route.params.moduleType&&this.$set(this.configJson.tabs[t.params.orgType.index],"count",t.total),"daibantongji"==this.$route.params.moduleType&&(g.log(t),g.log(this.configJson.tabs[t.params.orgType.index]),this.$set(this.configJson.tabs[t.params.orgType.index].subTabs[0],"count",t.total)),"xingchengtongji_shanbao"==this.$route.params.moduleType&&(g.log(t),g.log(this.configJson.tabs[this.activeName]),this.$set(this.configJson.tabs[this.activeName],"count",t.total)),"zhibantongji"==this.$route.params.moduleType&&(g.log(t),e=this.activeName,n=this.configJson.tabs[this.activeName].subTabIndex,g.log(e,n),this.$set(this.configJson.tabs[e].subTabs[n],"count",t.total))},showPicker:function(t){g.log(t),this.pickType=t,this.showColumns="year"==t?this.yearColumns:this.holidayColumns,this.showYearPicker=!0},yearComfirm:function(t,e){var n={};"year"==this.pickType?(this.configJson.showData.year=t,n.year=t):(this.$set(this.configJson.tabs[0].subTabs[0].params.filterData,"holidayId",t.id),this.$set(this.configJson.tabs[1].subTabs[0].params.filterData,"holidayId",t.id),n.holidayId=t.id),this.initData(n),this.showYearPicker=!1},initData:function(t){var e=this;t&&t.year?dsf.http.get(this.configJson.pickUrl,{year:t.year}).then(function(t){t=t.data.data;t.forEach(function(t,e){t.text=t.holidayName}),e.configJson.showData.holidayName="",e.holidayColumns=t,e.holidayColumns.length?e.showPicker("holiday"):(dsf.layer.toast("该年暂无节假日数据,现跳转至本年"),e.init())}):dsf.http.get(this.configJson.configUrl,t).then(function(t){t=t.data;e.configJson.showData.holidayName=t.data.holidayName,e.configJson.showData.dlqyText=t.data.dlqyText,e.configJson.showData.bszt=t.data.bszt,e.configJson.showData.bssj=t.data.bssj,e.configJson.showData.holidayId=t.data.holidayId,e.configJson.tabs[0].subTabs[0].params.filterData.holidayId=t.data.holidayId,e.configJson.tabs[1].subTabs[0].params.filterData.holidayId=t.data.holidayId,e.configJson.tbid=t.data.tbid,e.configJson.tabs[0].subTabs[0].count=t.data.count[0].tj,e.configJson.tabs[0].subTabs[1].count=t.data.count[0].wtj,e.configJson.tabs[0].subTabs[1].wtjArray=t.data.count[0].wtjArray,e.configJson.tabs[1].subTabs[0].count=t.data.count[1].tj,e.configJson.tabs[1].subTabs[1].count=t.data.count[1].wtj,e.configJson.tabs[1].subTabs[1].wtjArray=t.data.count[1].wtjArray})},formatDate:function(t,e){return 1==e?"".concat(t.getFullYear(),"年").concat(t.getMonth()+1,"月").concat(t.getDate(),"日"):"".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate())},changeTab:function(n,t){var a=this;"xingchengtongji_shanbao"==this.configJson._type&&this.configJson.tabFilterKey.forEach(function(t,e){a.configJson.tabs[n][t]&&(g.log(t),a.$set(a.filterData,t,a.configJson.tabs[n][t]))})},huizongTab:function(e,t){var n=this,a=this.configJson.tabs[e];a.tabFilterKey.forEach(function(t){n.$set(n.configJson.tabs[e].filterData,t,a[t])})},changedaibanTab:function(t,e){g.log(t,e)},subChange:function(t,e){g.log(t,e)},inClickFn:function(){this.showCalendar=!0},onConfirm:function(t){var e,n,a=this;g.log(t),"single"==this.controlData.type?(this.timeVal=this.formatDate(t),this.configJson.tabs.forEach(function(t,e){a.$set(a.configJson.tabs[e].subTabs[0].params.filterData,"query_B0013","".concat(a.timeVal," - ").concat(a.timeVal)),a.$set(a.configJson.tabs[e].subTabs[1].params.filterData,"query_B0013","".concat(a.timeVal," - ").concat(a.timeVal))}),e=dsf.date.format(new Date,"yyyy-mm-dd"),this.configJson.footerBtn.show=this.timeVal==e,this.initTabCount({date:"".concat(this.timeVal)})):(n=t.map(function(t,e){return a.formatDate(t)}),t=t.map(function(t,e){return a.formatDate(t,1)}),g.log(t),this.timeVal="".concat(t[0],"-").concat(t[1]),this.configJson.tabs.forEach(function(t,e){a.$set(a.configJson.tabs[e].filterData,"startTime",n[0]),a.$set(a.configJson.tabs[e].filterData,"end",n[1])}),this.initTabCount({startTime:n[0],end:n[1]})),this.showCalendar=!1},initTabCount:function(t){var e=this,n=this;dsf.http.get(n.configJson.configUrl,t).then(function(t){t=t.data;"zhibantongji"==e.configJson._type?(e.configJson.tabs[0].subTabs[0].count=t.data[0].fk,e.configJson.tabs[0].subTabs[1].count=t.data[0].wfk,e.configJson.tabs[1].subTabs[0].count=t.data[1].fk,e.configJson.tabs[1].subTabs[1].count=t.data[1].wfk):(t.data.array.forEach(function(t,e){n.$set(n.configJson.tabs[e],"count",Number(t.count))}),g.log(e.configJson.tabs))})},init:function(){var s=this;g.log(this.$route.params),dsf.http.get("static/commonListWrap.json").then(function(t){var n=t.data[s.$route.params.moduleType];s.configJson=n,s.params=n.params,s.configJson.showDateSec&&(s.controlData.type="single"),"pinganfankui"==s.$route.params.moduleType&&(g.log(dsf.util.loadSessionStore("pingan_fid")),s.configJson.filterData.fid=s.$route.params.fid||dsf.util.loadSessionStore("pingan_fid"),dsf.util.saveToSessionStore("pingan_fid",s.configJson.filterData.fid)),n.showQicheng&&(t=new Date,t=dsf.date.getMonthWeekDate(t.getFullYear(),t.getMonth(),t.getDate()).list,s.timeVal="".concat(s.formatDate(t[0].date,1),"-").concat(s.formatDate(t[6].date,1)),s.$set(s.filterData,"startTime",s.formatDate(t[0].date)),s.$set(s.filterData,"endTime",s.formatDate(t[6].date))),"zhibantongji"==n._type&&(n.configParams.date=dsf.date.format(new Date,"yyyy-mm-dd"),s.configJson.tabs.forEach(function(t,e){s.$set(s.configJson.tabs[e].subTabs[0].params.filterData,"query_B0013","".concat(n.configParams.date," - ").concat(n.configParams.date)),s.$set(s.configJson.tabs[e].subTabs[1].params.filterData,"query_B0013","".concat(n.configParams.date," - ").concat(n.configParams.date)),n.footerBtn.btns[0].config.configParams.query_B0013="".concat(n.configParams.date," - ").concat(n.configParams.date)}),dsf.http.get(n.footerBtn.btns[0].config.url,n.footerBtn.btns[0].config.configParams||{}).then(function(t){t=t.data;g.log(t),s.allList=t.datas,t.datas.forEach(function(t){t={user_name:t.dataValue.B0051,foreign_id:t.dataValue["A0001.value"],foreignId:t.dataValue["A0001.value"],id:t.dataValue["A0001.value"]};s.selectPersons.push(t)}),g.log(s.selectPersons)})),dsf.http.get(n.configUrl,n.configParams||{}).then(function(t){var a=t.data;"xingchengtongji_shanbao"==n._type&&(a.data.array.forEach(function(t,e){var n=JSON.parse(r()(s.configJson.tabs[e]));n.count=Number(t.count),n.startTime=t.start,n.title=t.title,n.end=t.end,n.filterData={startTime:t.start,end:t.end,fbcc:a.data.fbcc},s.$set(s.configJson.tabs,e,n)}),g.log(s.configJson.tabs),s.changeTab(0)),"xingchengtongji_huizong"==n._type&&(a.data.array.forEach(function(t,e){var n=JSON.parse(r()(s.configJson.tabs[e]));n.count=Number(t.count),n.title=t.title,n.filterData={startTime:a.data.start,end:a.data.end},t.dlqy&&(n.dlqy=t.dlqy,n.unitId=a.data.unitId),s.$set(s.configJson.tabs,e,n)}),g.log(s.configJson.tabs),s.huizongTab(0)),"daibantongji"==n._type&&(g.log(s.configJson),s.configJson.showData.year=a.data.year,s.configJson.showData.holidayName=a.data.holidayName,s.configJson.showData.dlqyText=a.data.dlqyText,s.configJson.showData.bszt=a.data.bszt,s.configJson.showData.bssj=a.data.bssj,s.configJson.showData.holidayId=a.data.holidayId,s.configJson.tabs[0].subTabs[0].params.filterData.holidayId=a.data.holidayId,s.configJson.tabs[1].subTabs[0].params.filterData.holidayId=a.data.holidayId,s.configJson.tabs[0].subTabs[0].params.params.unitId=a.data.unitId,s.configJson.tabs[1].subTabs[0].params.params.unitId=a.data.unitId,s.configJson.tbid=a.data.tbid,s.configJson.tabs[0].subTabs[0].count=a.data.count[0].tj,s.configJson.tabs[0].subTabs[1].count=a.data.count[0].wtj,s.configJson.tabs[0].subTabs[1].wtjArray=a.data.count[0].wtjArray,s.configJson.tabs[1].subTabs[0].count=a.data.count[1].tj,s.configJson.tabs[1].subTabs[1].count=a.data.count[1].wtj,s.configJson.tabs[1].subTabs[1].wtjArray=a.data.count[1].wtjArray,g.log(s.configJson),dsf.http.get(n.pickUrl,{year:a.data.year}).then(function(t){t=t.data.data;t.forEach(function(t,e){t.text=t.holidayName}),s.holidayColumns=t}),s.hasSubTab=!0),"zhibantongji"==n._type&&(s.timeVal=s.nowDay=dsf.date.format(new Date,"yyyy-mm-dd"),s.configJson.tabs[0].subTabs[0].count=a.data[0].fk,s.configJson.tabs[0].subTabs[1].count=a.data[0].wfk,s.configJson.tabs[1].subTabs[0].count=a.data[1].fk,s.configJson.tabs[1].subTabs[1].count=a.data[1].wfk),s.$nextTick(function(){var t=document.documentElement.style.fontSize.split("px")[0],e=s.$refs.sticky?s.$refs.sticky.offsetHeight:0,n=s.$refs.firstTitle?.88*t:0,a=s.$refs.subTitle?.88*t:0,t=.92*t;s.firstOffsetHeight=s.isShowAppHeader?e+t:e,s.subOffsetHeight=s.isShowAppHeader?e+n+t:e+n,s.listOffsetHeight=s.isShowAppHeader?e+n+a+t:e+n+a,s.$refs.tabs&&s.$refs.tabs.resize(),s.showList=!0})})})}}},b=(0,u.Z)(n,function(){var n=this,a=n._self._c;return a("div",{ref:"commonListWrap",staticClass:"box commonListWrap"},[a("van-sticky",{attrs:{"offset-top":n.dsf.util.getOffsetTop()}},[a("div",{ref:"sticky",staticClass:"sticky"},[n.configJson.showQicheng?a("div",{staticClass:"controlBox showQicheng"},[a("div",{attrs:{span:"24"}},[a("van-cell",{attrs:{border:!1}},[n._v("启程时间:")]),n._v(" "),a("van-field",{staticClass:"qichengTime",attrs:{readonly:!0,placeholder:"启程时间"},on:{click:n.inClickFn},model:{value:n.timeVal,callback:function(t){n.timeVal=t},expression:"timeVal"}})],1)]):n._e(),n._v(" "),n.configJson.showDateSec?a("div",{staticClass:"showDateSec controlBox"},[a("div",{staticStyle:{display:"flex","align-items":"center",padding:"10px","border-bottom":"10px solid #f2f3f5"}},[a("span",{staticStyle:{width:"60px","font-size":"15px"}},[n._v("日期:")]),n._v(" "),a("van-field",{staticClass:"qichengTime",attrs:{readonly:!0,placeholder:"请选择日期"},on:{click:n.inClickFn},model:{value:n.timeVal,callback:function(t){n.timeVal=t},expression:"timeVal"}})],1)]):n._e(),n._v(" "),n.configJson.yearSec?a("div",{staticClass:"yearSec"},[a("van-cell",{on:{click:function(t){return n.showPicker("year")}},scopedSlots:n._u([{key:"title",fn:function(){return[a("span",{staticClass:"custom-title"},[n._v("年度：    "+n._s(n.configJson.showData.year))])]},proxy:!0},{key:"right-icon",fn:function(){return[a("van-icon",{attrs:{name:"more-o"}})]},proxy:!0}],null,!1,765153914)})],1):n._e(),n._v(" "),n.configJson.holidaySec?a("div",{staticClass:"holidaySec"},[a("van-cell",{on:{click:function(t){return n.showPicker("holiday")}},scopedSlots:n._u([{key:"title",fn:function(){return[a("span",{staticClass:"custom-title"},[n._v("节假日："+n._s(n.configJson.showData.holidayName))])]},proxy:!0},{key:"right-icon",fn:function(){return[a("van-icon",{attrs:{name:"more-o"}})]},proxy:!0}],null,!1,1452309438)})],1):n._e(),n._v(" "),n.configJson.infoBox?a("div",{staticClass:"infoBox"},[a("div",{staticClass:"info"},[a("div",{staticClass:"bjzf"},[n._v("\n            本级政府："),a("span",{staticClass:"_grey"},[n._v(n._s(n.configJson.showData.dlqyText))])]),n._v(" "),3<=n.configJson.showData.bszt?a("div",{staticClass:"sbInfo"},[n._v("\n            已上报："),a("span",{staticClass:"_grey"},[n._v(n._s(n.configJson.showData.bssj))])]):a("div",{staticClass:"sbInfo"},[n._v("\n            未上报\n          ")])]),n._v(" "),n.configJson.showData.bszt<3?a("div",{staticClass:"infobtn",on:{click:n.goWrite}},[a("van-button",{attrs:{size:"mini",type:"info"}},[n._v("去填报")])],1):n._e()]):n._e()])]),n._v(" "),n.configJson.huizongTab?a("van-tabs",{ref:"tabs",attrs:{sticky:!0,"offset-top":n.dsf.util.getOffsetTop(n.firstOffsetHeight),border:!1},on:{change:n.huizongTab},model:{value:n.activeName,callback:function(t){n.activeName=t},expression:"activeName"}},n._l(n.configJson.tabs,function(t,e){return a("van-tab",{key:e,attrs:{badge:t.count||""},scopedSlots:n._u([{key:"title",fn:function(){return[a("div",{ref:"firstTitle",refInFor:!0},[n._v("\n          "+n._s(t.title)+"\n        ")])]},proxy:!0}],null,!0)},[n._v(" "),n.showList?a("common-list",{attrs:{oppsetTop:n.listOffsetHeight,params:t.params,filterData:t.filterData},on:{changeData:n.tabChangeData}}):n._e()],1)}),1):n._e(),n._v(" "),n.configJson.daibanTab?a("van-tabs",{ref:"tabs",attrs:{sticky:!0,"offset-top":n.dsf.util.getOffsetTop(n.firstOffsetHeight),border:!1},on:{change:n.changedaibanTab},model:{value:n.activeName,callback:function(t){n.activeName=t},expression:"activeName"}},n._l(n.configJson.tabs,function(e,t){return a("van-tab",{key:t,attrs:{badge:e.count||"","title-class":{superTab:n.configJson.hasSubTab}},scopedSlots:n._u([{key:"title",fn:function(){return[a("div",{ref:"firstTitle",refInFor:!0},[n._v("\n          "+n._s(e.title)+"\n        ")])]},proxy:!0}],null,!0)},[n._v(" "),e.subTabs?a("van-tabs",{ref:"subTab",refInFor:!0,staticClass:"subTransFormLine",attrs:{sticky:!0,"offset-top":n.dsf.util.getOffsetTop(n.subOffsetHeight)},on:{change:n.subChange},model:{value:e.subTabIndex,callback:function(t){n.$set(e,"subTabIndex",t)},expression:"item.subTabIndex"}},n._l(e.subTabs,function(t,e){return a("van-tab",{key:e,attrs:{name:t.value,badge:t.count||""},scopedSlots:n._u([{key:"title",fn:function(){return[a("div",{ref:"subTitle",refInFor:!0},[n._v("\n              "+n._s(t.tabType)+"\n            ")])]},proxy:!0}],null,!0)},[n._v(" "),t.isCommonList&&n.showList?a("common-list",{attrs:{oppsetTop:n.listOffsetHeight,filterData:t.params.filterData,params:t.params},on:{changeData:n.tabChangeData}}):n._e(),n._v(" "),!t.isCommonList&&n.showList?a("dxq-list",{attrs:{dataList:t.wtjArray,holiday:n.configJson.showData.holidayName,year:n.configJson.showData.year}}):n._e()],1)}),1):n._e()],1)}),1):n._e(),n._v(" "),n.configJson.shangbaoTab?a("van-tabs",{ref:"tabs",attrs:{sticky:!0,"offset-top":n.dsf.util.getOffsetTop(n.firstOffsetHeight),border:!1},on:{change:n.changeTab},model:{value:n.activeName,callback:function(t){n.activeName=t},expression:"activeName"}},n._l(n.configJson.tabs,function(t,e){return a("van-tab",{key:e,attrs:{title:t.title,badge:t.count||"","title-class":{superTab:n.configJson.hasSubTab}},scopedSlots:n._u([{key:"title",fn:function(){return[a("div",{ref:"firstTitle",refInFor:!0},[n._v("\n          "+n._s(t.title)+"\n        ")])]},proxy:!0}],null,!0)},[n._v(" "),n.configJson.shangbaoTab?a("div",{staticClass:"listBox"},[n.showList?a("common-list",{attrs:{oppsetTop:n.listOffsetHeight,params:n.configJson.params,filterData:t.filterData},on:{changeData:n.tabChangeData}}):n._e()],1):n._e()])}),1):n._e(),n._v(" "),n.showList&&n.configJson.pingan?a("common-list",{attrs:{oppsetTop:0,params:n.configJson.params,filterData:n.configJson.filterData},on:{changeData:n.tabChangeData}}):n._e(),n._v(" "),n.configJson.footerBtn&&n.configJson.footerBtn.show?a("div",{staticClass:"btnWrap"},[a("van-button",{attrs:{type:"info"},on:{click:function(t){return n.Ding("Ding")}}},[n._v("点名")]),n._v(" "),a("van-button",{attrs:{type:"info"},on:{click:function(t){return n.Ding("Video")}}},[n._v("语音会议")])],1):n._e(),n._v(" "),a("van-popup",{style:{height:"500px"},attrs:{position:"bottom",round:"","get-container":"#app"},model:{value:n.showCalendar,callback:function(t){n.showCalendar=t},expression:"showCalendar"}},[a("van-calendar",{ref:"calendarRef",attrs:{poppable:!1,"first-day-of-week":n.controlData.firstDayOfWeek,type:n.controlData.type,title:n.controlData.title,"show-mark":n.controlData.showMark,"show-confirm":n.controlData.showConfirm,color:n.controlData.color,"min-date":n.controlData.minDate,"max-date":n.controlData.maxDate},on:{confirm:n.onConfirm}})],1),n._v(" "),a("van-popup",{style:{height:"40vh"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom",round:""},model:{value:n.showYearPicker,callback:function(t){n.showYearPicker=t},expression:"showYearPicker"}},[a("van-picker",{attrs:{title:"选择","show-toolbar":"",columns:n.showColumns},on:{confirm:n.yearComfirm,cancel:function(t){n.showYearPicker=!1}}})],1),n._v(" "),a("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,"get-container":"#app",position:"bottom"},model:{value:n.showPerson,callback:function(t){n.showPerson=t},expression:"showPerson"}},[n.showPerson?a("selectPerson",{attrs:{selectPersons:n.selectPersons},on:{cancePerson:n.cancePerson,dingding:n.dingding}}):n._e()],1)],1)},[],!1,null,"b135d03c",null).exports},99965:function(t,e,n){n.d(e,{Z:function(){return s}});var e=n(27921),c=n.n(e),e=n(85579),r=n.n(e),e=n(22013),l=n.n(e),i=n(25108),e={name:"addTree",props:["personSelectData","type"],data:function(){return{isHidden:!1}},created:function(){this.isHidden=void 0,window.GLOBAL.ParentNode=[],window.GLOBAL.personAddList=[]},mounted:function(){},watch:{},methods:{checkAll:function(n){n.children&&0<n.children.length?(this.$set(n,"isopen",!n.isopen),n.isopen?(window.GLOBAL.ParentNode.push(n),n.checked?n.children.forEach(function(t){t.checked=!0}):n.children.forEach(function(t){t.checked=!1})):window.GLOBAL.ParentNode.forEach(function(t,e){t.showName==n.showName&&window.GLOBAL.ParentNode.splice(e,1)})):(n.checked?(this.$delete(n,"checked"),this.$set(n,"checked",!1)):(this.$delete(n,"checked"),this.$set(n,"checked",!0)),this.userClick(n))},selectAll:function(t){this.$emit("select",t)},getStyle:function(t){return{"padding-left":"30px","box-sizing":"border-box"}},itemClick:function(t){this.$set(t,"checked",!t.checked),i.log(t)},userClick:function(n){var a=this,s=this,t=(i.log(n),window.GLOBAL.personMultiple?n.checked?(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.push(n),n.children.forEach(function(t){t.checked=!0})),window.GLOBAL.personAddList.push(n)):(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.forEach(function(t,e){t.showName==n.showName&&window.GLOBAL.ParentNode.splice(e,1)}),n.children.forEach(function(t){t.checked=!1})),window.GLOBAL.personAddList.forEach(function(t,e){t.showName==n.showName&&window.GLOBAL.personAddList.splice(e,1)})):n.checked?(window.GLOBAL.personAddList.forEach(function(t){s.$set(t,"checked",!1)}),window.GLOBAL.personAddList=[],window.GLOBAL.personAddList.push(n)):window.GLOBAL.personAddList.forEach(function(t,e){s.$set(t,"checked",!1),t.showName==n.showName&&window.GLOBAL.personAddList.splice(e,1)}),window.GLOBAL.personAddList),o={},t=t.reduce(function(t,e){return o[e.id]||(o[e.id]=t.push(e)),t},[]);window.GLOBAL.personAddList=t,i.log("选中的父节点",window.GLOBAL.ParentNode),window.GLOBAL.ParentNode.forEach(function(t){var e=t.children.find(function(t){return 1==t.checked}),n=t.children.find(function(t){return 0==t.checked});null==e&&(a.$delete(t,"checked"),a.$set(t,"checked",!1)),null==n&&(a.$delete(t,"checked"),a.$set(t,"checked",!0))}),this.$emit("select",t),this.$forceUpdate()}}},a=n(51900),e=(0,a.Z)(e,function(){var a=this,s=a._self._c;return s("div",{staticClass:"dsf-tree",staticStyle:{width:"100%",height:"100%"}},a._l(a.personSelectData,function(n,t){return s("div",{key:"index1"+t,staticStyle:{"overflow-y":"hidden"}},[s("div",{staticClass:"flex-box tree_line"},[n.attrs.noselect?a._e():s("van-checkbox",{ref:"check",refInFor:!0,attrs:{"icon-size":"18px"},on:{click:function(t){return a.userClick(n)}},model:{value:n.checked,callback:function(t){a.$set(n,"checked",t)},expression:"item.checked"}}),a._v(" "),s("div",{staticClass:"tree_tit",on:{click:function(t){return a.checkAll(n)}}},[s("span",{class:{tit_width:0<!n.children.length}},[a._v(a._s(n.showName))]),0<n.children.length?s("span",[a._v("("+a._s(n.children.length)+")")]):a._e()]),a._v(" "),0<n.children.length?s("div",{staticClass:"isShowChiled",on:{click:function(t){return a.checkAll(n)}}},[n.isopen?s("van-icon",{attrs:{name:"arrow-up",color:"#3296fa"}}):s("van-icon",{attrs:{name:"arrow-down",color:"#3296fa"}}),a._v(" "),s("span",{staticClass:"r_span"},[a._v(a._s(n.isopen?"收起":"展开"))]),a._v(" "),s("span",{staticClass:"r_line"})],1):a._e()],1),a._v(" "),a._l(n.children,function(e,t){return s("div",{key:"index2"+t,style:{display:n.isopen?"block":"none"}},[1==e.type?s("div",{staticClass:"person",style:{"padding-left":"30px"},on:{click:function(t){return a.userClick(e)}}},[s("div",{staticClass:"flex-box person_child"},[s("van-checkbox",{staticClass:"child_check",attrs:{"icon-size":"16px"},model:{value:e.checked,callback:function(t){a.$set(e,"checked",t)},expression:"cell.checked"}},[s("div",{staticClass:"user-logo"},[s("i",{staticClass:"icon iconfont icontouxiang"})]),a._v(" "),s("div",{staticClass:"username"},[a._v(a._s(e.showName))])])],1)]):a._e()])}),a._v(" "),a._l(n.children,function(t,e){return s("div",{key:"index3"+e,style:{display:n.isopen?"block":"none"}},[1!=t.type?s("div",{style:a.getStyle(n.deep)},[s("add-tree",{attrs:{personSelectData:[t]},on:{select:a.selectAll}})],1):a._e()])})],2)}),0)},[],!1,null,"4ea6c469",null).exports,d=n(25108);function f(t,e){var n,a,s,o,i=void 0!==r()&&t[l()]||t["@@iterator"];if(i)return a=!(n=!0),{s:function(){i=i.call(t)},n:function(){var t=i.next();return n=t.done,t},e:function(t){a=!0,s=t},f:function(){try{n||null==i.return||i.return()}finally{if(a)throw s}}};if(Array.isArray(t)||(i=function(t,e){var n;if(t)return"string"==typeof t?h(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?c()(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}(t))||e&&t&&"number"==typeof t.length)return i&&(t=i),o=0,{s:e=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var s=(0,a.Z)({name:"DsfSelectPerson",components:{addTree:e},props:["type","extra","selectPersons"],data:function(){return{show:!0,selectList:[],personSelectData:"",oldV:[],param:{allowEdit:!1,containUnit:"-1",data:"",displayFullPath:"-1",fullOrganize:!1,key:"C-RC-0008",multiple:!0,roles:"",rootObject:"2",schema:"",separator:",",tabs:[{key:"self_org",list:[{key:"department",name:"本机构"}],name:"本单位"}],title:"选择参与人员",type:"userselect",types:["person","department","post"],typesString:"person,department,post",value:""},selectArr:[],selectper:[],pk:""}},created:function(){var t;window.GLOBAL={},this.extra&&(this.pk=this.extra.pk),d.log(this.param,this.type),0<this.selectPersons.length?((t=this.selectPersons).forEach(function(t){t.checked=!1,t.attrs={},t.children=[],t.showName=t.user_name,t.id=t.foreign_id}),this.selectPersons=t,d.log(this.selectPersons),this.personSelectData=[{attrs:{},checked:!1,children:t,showName:"选择人员"}]):this.getPersonList(this.param),window.GLOBAL.selectType=this.type,window.GLOBAL.personMultiple=!0},mounted:function(){},methods:{getPersonList:function(t){var e=dsf.layer.loading("获取中"),n=this,a="fn/mobileToDo/getDingUsersByToDo?pk=".concat(this.pk);dsf.http.post(a).then(function(t){n.personSelectData=t.data.data.codeList,n.personSelectData[0].children.length||n.$emit("close"),n.personSelectData.forEach(function(t){n.addPersonDeep(t,1)}),n.personSelectData.forEach(function(t){t.checked=!1}),n.personSelectData[0].children.forEach(function(t){t.type=1,t.checked=!1}),d.log("人员选择控件",n.personSelectData)}).finally(function(){n.$nextTick(function(){dsf.layer.closeLoading(e)})})},addPersonDeep:function(t,e){var n=this;this.$set(t,"deep",e),this.$set(t,"isopen",e<=1),t.children&&0<t.children.length&&t.children.forEach(function(t){n.addPersonDeep(t,e+1)})},addPerson:function(){var t,a=this,e=[],n=[],s=[],o=(this.selectArr=[],this.selectList.forEach(function(n){n.children&&0<n.children.length&&0<n.children[0].children.length?a.selectArr=[]:n.children&&0<n.children.length?n.children.forEach(function(n){n.checked?a.selectArr.push(n):a.selectArr.forEach(function(t,e){t.showName==n.showName&&a.selectArr.splice(e,1)})}):n.checked?a.selectArr.push(n):a.selectArr.forEach(function(t,e){t.showName==n.showName&&a.selectArr.splice(e,1)})}),{}),i=(this.selectArr=this.selectArr.reduce(function(t,e){return o[e.id]||(o[e.id]=t.push(e)),t},[]),f(this.selectArr));try{for(i.s();!(t=i.n()).done;){var c=t.value;e.push(c.showName),n.push(c.attrs.idValue),s.push(c.type+"::"+c.attrs.idValue)}}catch(t){i.e(t)}finally{i.f()}r=e.join(","),n.join(","),s.join(","),this.person=r,this.show=!1,this.oldV=this.selectList,this.cancePerson(),d.log("最终选择=====>",this.selectArr);var r=this.selectArr.map(function(t){return t.id});d.log(r),this.$emit("dingding",r)},cancePerson:function(){this.$emit("cancePerson")},getSelect:function(t){d.log(t);for(var e in this.selectList=[],t)this.selectList.push(t[e]);d.log(this.selectList)},userClick:function(t){this.$refs.addTree.userClick(t)}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"dsf-select-person"},[e("add-tree",{ref:"addTree",staticClass:"_add_tree",attrs:{personSelectData:t.personSelectData,type:t.type},on:{select:t.getSelect}}),t._v(" "),e("van-tabbar",[e("van-tabbar-item",{staticClass:"_btns"},[e("van-button",{attrs:{type:"default"},on:{click:t.cancePerson}},[t._v("取消")]),t._v(" "),e("van-button",{attrs:{type:"info"},on:{click:t.addPerson}},[t._v("确定")])],1)],1)],1)},[],!1,null,"44a66037",null).exports}}]);