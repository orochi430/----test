"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[10647],{10647:function(t,e,i){i.r(e),i.d(e,{default:function(){return r}});var e=[function(){var t=this._self._c;return t("div",{staticClass:"top"},[t("div",{staticClass:"flex jb"},[t("img",{staticStyle:{width:"1.14rem",height:"0.48rem"},attrs:{src:i(22737),alt:""}}),this._v(" "),t("img",{staticStyle:{width:"1.46rem",height:"0.48rem"},attrs:{src:i(8685),alt:""}})]),this._v(" "),t("div",{staticClass:"title"},[this._v("疫情防控  人人有责")])])},function(){var t=this._self._c;return t("div",{staticClass:"ao"},[t("img",{attrs:{src:i(91747),alt:""}})])}],n=i(5044),a=i(8450),s=i.n(a),o=i(25108),a={data:function(){return{name:"",idCard:"",docHeight:document.documentElement.clientHeight,showHeight:document.documentElement.clientHeight,isShow:!0,show:!1,showKey:!1,showHistory:!1,phone:"",phonecode:"",smsBtnText:"发送验证码",smsBtnEnable:!1,phoneValidator:[{required:!0},{pattern:/^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d{8}$/,message:"请输入正确手机号"}],idCardValidator:[{pattern:/(^\d{15}$)|(^\d{17}([0-9]|X|x)$)|(^$)/,message:"请输入正确身份证号码"}],data:null,keyword:"",list:[],loading:!1,finished:!1,finishedTips:"",container:null,start:1,usedTimes:"",allowTimes:""}},created:function(){var e=this,a=dsf.layer.loading();dsf.http.post("ctrl/sysuser/queryTimes",{userId:dsf.util.loadSessionStore("user").user_id}).then(function(t){dsf.layer.closeLoading(a),200==t.data.code?(e.usedTimes=t.data.data.usedTimes,e.allowTimes=t.data.data.allowTimes):dsf.layer.toast(t.data.message)}).error(function(t){dsf.layer.closeLoading(a)})},mounted:function(){var i=this;window.onresize=function(){i.showHeight=document.documentElement.clientHeight},this.$nextTick(function(){var t=document.documentElement.clientHeight,e=document.documentElement.clientWidth,a=i.$refs.box.offsetHeight;i.$refs.box.style.transform="translateY(".concat(0<t-a-e/1.5?t-a-e/1.5:0,"px)")})},watch:{showHeight:function(t,e){this.docHeight>t?this.isShow=!1:this.isShow=!0}},methods:{scan:function(){var e=this;"ios"==dsf.util.checkSystem()?xsfCamera.getPicture(function(t){t=function(t){for(var e=atob(t.split(",")[1]),t=t.split(",")[0].match(/:(.*?);/)[1],a=[],i=0;i<e.length;i++)a.push(e.charCodeAt(i));var n=new Blob([new Uint8Array(a)],{type:t});return new File([n],"".concat((new Date).getTime(),".png"),{type:t})}("data:image/jpeg;base64,"+t);e.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),dsf.http.upload("ctrl/web/idCard/imageParse",{},t).then(function(t){200==t.data.code?(e.$toast.clear(),e.idCard=t.data.data.ID,e.name=t.data.data.Name):dsf.layer.toast("未检测到身份证，请重新上传身份证或手动输入")}).error(function(t){o.log(t)})},function(t){},{quality:20,allowEdit:!0,destinationType:destinationType.DATA_URL}):$iaction.getIdentityCardMsg({type:"1",quality:"0"},function(t){o.log(t);t=JSON.parse(t);t.ID?e.idCard=t.ID:dsf.layer.toast("未检测到身份证，请重新上传身份证或手动输入"),t.Name&&(e.name=t.Name)},function(t){})},query:function(){var i=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0],o=this;o.$refs.form.validate().then(function(){var t,e,a;0==i.allowTimes?dsf.layer.toast("您今日可查询人次为0"):-1!=i.allowTimes&&Number(i.usedTimes)>=Number(i.allowTimes)?dsf.layer.toast("今日查询人次已使用完毕"):n?o.show=!0:(t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e=(new Date).getTime(),a="cms"+(t()+t())+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t(),$iaction.encrypt({proName:"YQFKCX",encryptKey:e+"YQFKCX"+a},function(t){o.loadingIndx=dsf.layer.loading(),dsf.http.post("/ctrl/serviceApi/healthDetails/".concat(o.idCard.toUpperCase().trim()||" ","/").concat(o.name.trim()),{timestamp:e,token:a,app:"YQFKCX",vcode:t,deviceId:dsf.util.loadLocalStore("DeviceId")||"未获取到设备",deviceName:dsf.util.loadLocalStore("DeviceName")||"未获取到设备"}).then(function(t){dsf.layer.closeLoading(o.loadingIndx),200==t.data.code?(o.data=t.data.data,o.$router.push({path:"/epidemicResult",query:{data:s()(o.data)}})):dsf.layer.toast(t.data.message)}).error(function(t){dsf.layer.toast("查询失败，请重试")}).finally(function(){})},function(t){alert(t)}))})},sendSmsCode:function(){var i=this,n=0;function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var e=(new Date).getTime(),a="cms"+(t()+t())+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();$iaction.encrypt({proName:"YQFKCX",encryptKey:e+"YQFKCX"+a},function(t){i.$refs.smslogin.validate("phone").then(function(){return i.smsBtnEnable=!0,n=dsf.layer.loading("发送中..."),dsf.http.post("/ctrl/serviceApi/travelCode/getCode/".concat(i.idCard.toUpperCase().trim(),"/").concat(i.phone.trim()),{timestamp:e,token:a,app:"YQFKCX",vcode:t,deviceId:dsf.util.loadLocalStore("DeviceId")||"未获取到设备",deviceName:dsf.util.loadLocalStore("DeviceName")||"未获取到设备"})}).then(function(t){var e,a;o.log(t),dsf.layer.closeLoading(n),200==t.data.code?(dsf.layer.toast(t.data.message),e=60,a=setInterval(function(){e--,i.smsBtnText="发送验证码("+e+")",0==e&&(clearInterval(a),i.smsBtnEnable=!1,i.smsBtnText="发送验证码")},1e3)):(i.smsBtnEnable=!1,dsf.layer.toast(t.data.message||"短信发送接口异常"))}).error(function(t){dsf.layer.closeLoading(n),i.smsBtnEnable=!1,o.log(t),-1<t.message.indexOf("404")&&dsf.layer.toast("短信发送接口异常，请联系系统管理员！")})},function(t){alert(t)})},codeQuery:function(){var e=this;function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var a=(new Date).getTime(),i="cms"+(t()+t())+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();e.$refs.smslogin.validate("phonecode").then(function(){$iaction.encrypt({proName:"YQFKCX",encryptKey:a+"YQFKCX"+i},function(t){e.loadingIndx=dsf.layer.loading(),dsf.http.post("/ctrl/serviceApi/healthAllInfos/".concat(e.idCard.toUpperCase().trim(),"/").concat(e.name.trim(),"/").concat(e.phone.trim(),"/").concat(e.phonecode.trim()),{timestamp:a,token:i,app:"YQFKCX",vcode:t,deviceId:dsf.util.loadLocalStore("DeviceId")||"未获取到设备",deviceName:dsf.util.loadLocalStore("DeviceName")||"未获取到设备",name:e.name.trim()}).then(function(t){"success"==t.data.type?(dsf.layer.closeLoading(e.loadingIndx),e.data=t.data.data,e.$router.push({path:"/epidemicResult",query:{data:s()(e.data)}})):dsf.layer.toast(t.data.message)}).error(function(t){dsf.layer.toast("查询失败，请重试")}).finally(function(){})},function(t){alert(t)})})},fetchData:function(){var i=this,t={limit:15,_content:this.keyword,key:this.keyword,page:this.start};dsf.http.post("/fn/list/220318184459Y1IEAEpUmNXiShjfpYK/mobile/q?moduleId=2203181833082IpGsZssSF8iV3wzUsa",t).then(function(t){var e=t.status,t=t.data,a=(t.filter&&t.filter.length&&(i.isShowSearchBox=!0),t.datas),a=void 0===a?[]:a,t=t.total;200===e&&(i.loading=!1,i.start+=1,i.list=[].concat((0,n.Z)(i.list),(0,n.Z)(a.map(function(t){return{name:t.dataValue["C-ES-QUERY-HISTORY-0002"],id:t.dataValue["C-ES-QUERY-HISTORY-0003"]}}))),null==a||i.list.length===t||0===a.length||a.length<15)&&(i.finished=!0,0<i.list.length)&&(i.finishedTips="")}).catch(function(t){t.message;i.finished=!0}).finally(function(){i.loading=!1,i.isFirst=0})},onLoad:function(){this.fetchData()},onSearch:function(){this.finishedTips="",this.finished=!1,this.loading=!0,this.list=[],this.start=1,this.fetchData()},setInfo:function(t){this.showHistory=!1,this.name=t.name,this.idCard=t.id}}},r=(0,i(51900).Z)(a,function(){var a=this,t=a._self._c;return t("div",{staticClass:"epidemicPrevention",style:{minHeight:"calc(100vh - ".concat(a.$store.state.isShowAppHeader?"0.92rem":"0px",")")}},[t("div",{ref:"box",staticClass:"box"},[a._m(0),a._v(" "),a._m(1),a._v(" "),t("div",{staticClass:"bottom"},[t("div",{staticStyle:{"text-align":"center","padding-bottom":"0.2rem",color:"red","font-size":"var(--font_size_2)"}},[a._v("仅限进博会、疾控、公安等部门内部使用")]),a._v(" "),t("div",{staticStyle:{"text-align":"center","padding-bottom":"0.2rem"}},[a._v("今日可查询人次："),t("span",{staticStyle:{color:"#0081DF"}},[a._v(a._s(a.usedTimes))]),a._v("/"+a._s(-1==a.allowTimes?"无限制":a.allowTimes))]),a._v(" "),t("van-form",{ref:"form"},[t("van-field",{attrs:{name:"姓名",placeholder:"请输入姓名",center:""},on:{"click-right-icon":function(t){a.showHistory=!0}},scopedSlots:a._u([{key:"right-icon",fn:function(){return[t("img",{staticStyle:{width:"0.44rem"},attrs:{src:i(77989),alt:""}})]},proxy:!0}]),model:{value:a.name,callback:function(t){a.name=t},expression:"name"}}),a._v(" "),t("van-field",{attrs:{name:"身份证",placeholder:"请输入证件号(任意证件)",center:""},on:{"click-right-icon":function(t){return a.scan()}},scopedSlots:a._u([{key:"right-icon",fn:function(){return[t("img",{staticStyle:{width:"0.44rem"},attrs:{src:i(39649),alt:""}})]},proxy:!0}]),model:{value:a.idCard,callback:function(t){a.idCard=t},expression:"idCard"}}),a._v(" "),t("div",{staticStyle:{"padding-bottom":"0.2rem",color:"#666","font-size":"var(--font_size_3)"}},[a._v("核酸查询可无需输入姓名，健康码、疫苗查询必须输入正确姓名")]),a._v(" "),t("van-button",{staticStyle:{width:"100%","font-size":"var(--font_size_2)"},attrs:{type:"info"},on:{click:function(t){return a.query()}}},[a._v("健康码、核酸、疫苗查询")]),a._v(" "),t("van-button",{staticStyle:{width:"100%","font-size":"var(--font_size_2)"},attrs:{type:"info"},on:{click:function(t){return a.query(!0)}}},[a._v("行程码、健康码、核酸、疫苗查询")]),a._v(" "),t("div",{staticStyle:{"font-size":"var(--font_size_4)",color:"#666"}},[t("div",{staticStyle:{"padding-bottom":"0.1rem"}},[a._v("建设单位：上海市大数据中心")]),a._v(" "),t("div",{staticStyle:{"padding-bottom":"0.1rem"}},[a._v("开发公司：仪电双杨智能科技（上海）有限公司")]),a._v(" "),t("div",{staticClass:"flex jb ab",staticStyle:{"padding-bottom":"0.1rem"}},[t("span",[a._v("业务支持：18918883653")]),t("span",[a._v("技术支持：15626921761")])]),a._v(" "),t("div",{staticStyle:{"text-align":"right",color:"#0081DF","margin-top":"0.2rem"},on:{click:function(t){return a.$router.push("/changePassWord")}}},[a._v("修改密码")])])],1)],1)]),a._v(" "),a.isShow?t("div",{staticClass:"bg-bottom"},[t("img",{attrs:{src:i(31448),alt:""}})]):a._e(),a._v(" "),t("van-dialog",{attrs:{title:"行程码核验","show-confirm-button":!1},model:{value:a.show,callback:function(t){a.show=t},expression:"show"}},[t("van-form",{ref:"smslogin"},[t("div",{staticClass:"sendCode"},[t("van-field",{attrs:{rules:a.phoneValidator,name:"phone",type:"tel",placeholder:"请输入手机号"},model:{value:a.phone,callback:function(t){a.phone=t},expression:"phone"}}),a._v(" "),t("van-button",{attrs:{text:a.smsBtnText,disabled:a.smsBtnEnable,size:"small",type:"primary","native-type":"button"},on:{click:function(t){return a.sendSmsCode()}}})],1),a._v(" "),t("van-field",{attrs:{rules:[{required:!0}],name:"phonecode",placeholder:"请输入验证码",center:""},model:{value:a.phonecode,callback:function(t){a.phonecode=t},expression:"phonecode"}}),a._v(" "),t("van-button",{staticStyle:{width:"100%","font-size":"var(--font_size_3)"},attrs:{type:"info"},on:{click:function(t){return a.codeQuery()}}},[a._v("行程码、健康码、核酸、疫苗查询")])],1),a._v(" "),t("div",{staticClass:"close-icon",on:{click:function(t){a.show=!1}}},[t("van-icon",{attrs:{name:"close",size:"30px"}})],1)],1),a._v(" "),t("van-popup",{staticClass:"history-dialog",attrs:{"get-container":"#app","close-on-click-overlay":!1},model:{value:a.showHistory,callback:function(t){a.showHistory=t},expression:"showHistory"}},[t("div",{staticStyle:{position:"relative"}},[t("van-field",{attrs:{placeholder:"请输入姓名/身份证号 进行查询",center:""},on:{"click-right-icon":a.onSearch},scopedSlots:a._u([{key:"right-icon",fn:function(){return[t("img",{staticStyle:{width:"0.44rem"},attrs:{src:i(70818),alt:""}})]},proxy:!0}]),model:{value:a.keyword,callback:function(t){a.keyword=t},expression:"keyword"}}),a._v(" "),t("div",{staticClass:"close-icon",on:{click:function(t){a.showHistory=!1}}},[t("van-icon",{attrs:{name:"close",size:"30px"}})],1)],1),a._v(" "),t("div",{staticClass:"list"},[t("van-list",{attrs:{finished:a.finished,"finished-text":a.finishedTips,offset:"100"},on:{load:a.onLoad},model:{value:a.loading,callback:function(t){a.loading=t},expression:"loading"}},a._l(a.list,function(e){return t("van-cell",{key:e.id,staticClass:"history-info",attrs:{title:e.name,value:e.id},on:{click:function(t){return a.setInfo(e)}}})}),1)],1)])],1)},e,!1,null,"0df4c9f4",null).exports},91747:function(t,e,a){t.exports=a.p+"static/img/ao.08e0938..png"},31448:function(t,e,a){t.exports=a.p+"static/img/bg1.17df9c8..png"},39649:function(t,e,a){t.exports=a.p+"static/img/camera.d740f6d..svg"},77989:function(t,e,a){t.exports=a.p+"static/img/history.fadfa64..svg"},22737:function(t,e,a){t.exports=a.p+"static/img/logo1.8ea93f0..png"},8685:function(t,e,a){t.exports=a.p+"static/img/logo2.437af24..png"},70818:function(t,e,a){t.exports=a.p+"static/img/search.002d591..svg"}}]);