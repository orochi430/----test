"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[18930,18868],{31026:function(t,e,n){n.r(e),n.d(e,{default:function(){return a}});var e=n(26243),o=n.n(e),e=n(8450),s=n.n(e),e=n(63560),l=n(25108),e={name:"DelayForm",props:["type"],components:{selectPerson:e.default},data:function(){return{formData:{},attach_1:[],showPerson:!1,sqdw:"",sqr:"",sqrq:"",yqrq:"",yqyy:"",showPicker:!1,showPicker1:!1,minDate:new Date((new Date).getFullYear()-40,0,1),maxDate:new Date((new Date).getFullYear()+10,11,31),currentDate:new Date,fileList:[],maininfo:{},moduleId:"190323161611pdCmmXaqoOhKvPKgG7X",formId:"190323193106NSc1cNEPPG8YB06DLQd",info_id:""}},computed:{},watch:{},methods:{onClickLeft:function(){this.$router.go(-1)},onSubmit:function(e){var n=this,a=(l.log("===提交"),this.maininfo.B0010={},this.maininfo.B0009={},this.maininfo.B0013={},this.maininfo["C-DB-YQ-0002"]={},this.maininfo["C-DB-YQ-0003"]={},this.maininfo.B0010.value=this.sqdw,this.maininfo.B0009.value=this.sqr,this.maininfo.B0013.value=this.sqrq,this.maininfo["C-DB-YQ-0002"].value=this.yqrq,this.maininfo["C-DB-YQ-0003"].value=this.yqyy,{}),t=(o()(this.maininfo).forEach(function(t,e){a[t]={},a[t].values=[{key:"value",value:n.maininfo[t].value}]}),{moduleId:this.moduleId,pk:this.info_id,formId:this.formId,__DATA:s()({maininfo:a})}),i=this;l.log(t),l.log(s()(a)),dsf.http.post("/fn/xform/save",t).then(function(t){l.log(t),i.$emit("change"),e()})},cancel:function(){this.$emit("close")},onConfirm:function(t){this.sqrq=dsf.date.format(t,"yyyy-mm-dd"),this.showPicker=!1},onConfirm1:function(t){this.yqrq=dsf.date.format(t,"yyyy-mm-dd"),this.showPicker1=!1},getUserList:function(){var e=this;dsf.http.get("/fn/xform/data?pk=&moduleId=190323161611pdCmmXaqoOhKvPKgG7X",{}).then(function(t){l.log("===请求表单数据接口"),l.log(t.data.main),e.maininfo=t.data.main,e.info_id=t.data.main.A0001.value,l.log(e.maininfo)})},cancePerson:function(){this.showPerson=!1},getUserNames:function(t){var n="";return t.forEach(function(t,e){""==n?n=t.name:n+=","+t.name}),n},getSelectUser:function(t){l.log("我的",t),0<t.length&&(this.sqr=this.getUserNames(t))},selectUser:function(){this.showPerson=!0,l.log("选人")},doFileRead:function(t,e){var n=this,e="/fn/mobileAttachment/upload?fileId=&moduleId="+this.moduleId+"&mid="+this.moduleId+"&pId=0&pnId=0&nodeName="+encodeURI("拟稿")+"&nrType="+e+"&pk="+this.info_id+"&newFileFlag=0";dsf.http.upload(e,{},t).then(function(t){l.log(t),n.getWebFiles()})},afterRead:function(e){var n=this;this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),this.onSubmit(function(t){n.doFileRead(e,1)})},getWebFiles:function(){var t={info_id:this.info_id,infoId:this.info_id,moduleId:this.moduleId,nodeId:"",start:0,limit:100},n=this;dsf.http.post("/fn/mobileAttachment/getFormAttachment",t).then(function(t){l.log(t.data),t&&t.data&&t.data.rows&&t.data.rows.forEach(function(t,e){"1"==t.attachType&&(n.attach_1=t.document)}),n.$toast.clear()})},removeFile:function(t){l.log(t);var t={pk:t.infoId,fileId:t.id,moduleId:t.moduleId,nrType:t.type,fileName:t.title},e=this;dsf.http.post("/fn/mobileFileUpload/delete",t).then(function(t){e.getWebFiles()})},delayData:function(){this.moduleId,this.moduleId}},created:function(){this.formData=this.$route.params.formData,l.log(this.formData)},mounted:function(){this.getUserList()},destroyed:function(){}},a=(0,n(51900).Z)(e,function(){var n=this,a=n._self._c;return a("div",{staticClass:"receipt"},[1==n.type?a("div",{staticClass:"header"},[a("van-nav-bar",{attrs:{title:"申请延期","left-text":"取消"},on:{"click-left":function(t){return n.cancel()}}})],1):n._e(),n._v(" "),a("div",{staticClass:"form-frame"},[a("div",{staticClass:"form-contain",staticStyle:{position:"relative"}},[a("van-form",{on:{submit:n.onSubmit}},[a("van-field",{attrs:{"input-align":"right",label:"*申请单位",placeholder:"请输入"},scopedSlots:n._u([{key:"label",fn:function(){return[a("span",[a("label",{staticClass:"mast-input"},[n._v("*")]),n._v("申请单位")])]},proxy:!0}]),model:{value:n.sqdw,callback:function(t){n.sqdw=t},expression:"sqdw"}}),n._v(" "),a("van-field",{attrs:{"input-align":"right",label:"*申请人",placeholder:"请选择"},on:{click:n.selectUser},scopedSlots:n._u([{key:"label",fn:function(){return[a("span",[a("label",{staticClass:"mast-input"},[n._v("*")]),n._v("申请人")])]},proxy:!0}]),model:{value:n.sqr,callback:function(t){n.sqr=t},expression:"sqr"}}),n._v(" "),a("van-popup",{attrs:{position:"bottom",round:""},model:{value:n.showPicker,callback:function(t){n.showPicker=t},expression:"showPicker"}},[a("van-datetime-picker",{attrs:{type:"datetime","min-date":n.minDate,"max-date":n.maxDate},on:{confirm:n.onConfirm,cancel:function(t){n.showPicker=!1}},model:{value:n.currentDate,callback:function(t){n.currentDate=t},expression:"currentDate"}})],1),n._v(" "),a("van-popup",{attrs:{position:"bottom",round:""},model:{value:n.showPicker1,callback:function(t){n.showPicker1=t},expression:"showPicker1"}},[a("van-datetime-picker",{attrs:{type:"datetime","min-date":n.minDate,"max-date":n.maxDate},on:{confirm:n.onConfirm1,cancel:function(t){n.showPicker1=!1}},model:{value:n.currentDate,callback:function(t){n.currentDate=t},expression:"currentDate"}})],1),n._v(" "),a("van-field",{attrs:{"input-align":"right",readonly:"",clickable:"",name:"calendar",value:n.sqrq,placeholder:"请选择"},on:{click:function(t){n.showPicker=!0}},scopedSlots:n._u([{key:"label",fn:function(){return[a("span",[a("label",{staticClass:"mast-input"},[n._v("*")]),n._v("申请日期")])]},proxy:!0}])}),n._v(" "),a("van-field",{attrs:{"input-align":"right",readonly:"",clickable:"",name:"calendar",value:n.yqrq,placeholder:"请选择"},on:{click:function(t){n.showPicker1=!0}},scopedSlots:n._u([{key:"label",fn:function(){return[a("span",[a("label",{staticClass:"mast-input"},[n._v("*")]),n._v("延期日期")])]},proxy:!0}])}),n._v(" "),a("van-field",{staticClass:"reset",attrs:{type:"textarea",rows:"2",placeholder:"请输入"},scopedSlots:n._u([{key:"label",fn:function(){return[a("span",[a("label",{staticClass:"mast-input"},[n._v("*")]),n._v("延期原因")])]},proxy:!0}]),model:{value:n.yqyy,callback:function(t){n.yqyy=t},expression:"yqyy"}}),n._v(" "),a("van-field",{staticClass:"reset",attrs:{name:"uploader",label:"附件"},scopedSlots:n._u([{key:"input",fn:function(){return[a("div",{staticClass:"dofile",staticStyle:{width:"100%"}},[a("div",{staticClass:"upload-files"},n._l(n.attach_1,function(t,e){return a("div",{key:e,staticClass:"file-list"},[a("i",{staticClass:"iconfont iconfile"}),n._v(" "),a("span",[n._v(n._s(t.title))])])}),0),n._v(" "),a("van-uploader",{staticClass:"upload-btn",attrs:{"after-read":n.afterRead}},[a("span",{staticClass:"add-file"},[a("van-icon",{attrs:{name:"plus"}})],1)])],1)]},proxy:!0}])}),n._v(" "),a("div",{staticClass:"submit"},[a("van-button",{attrs:{square:"",block:"",type:"info","native-type":"submit"}},[n._v("提交")])],1)],1),n._v(" "),a("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,position:"bottom"},model:{value:n.showPerson,callback:function(t){n.showPerson=t},expression:"showPerson"}},[a("selectPerson",{attrs:{type:0},on:{getSelectUser:n.getSelectUser,cancePerson:n.cancePerson}})],1)],1)])])},[],!1,null,"6311f5bd",null).exports},18868:function(t,e,n){var o=n(25108);const s=(a,i=500,o=!0)=>{let s,l=0,r,c,d=n=>{s=setTimeout(()=>{var t=(new Date).getTime(),e=t-l;e<n?(l=t,d(i-e)):(o||a.apply(r,c),clearTimeout(s),s=null)},n)};return function(){r=this,c=arguments;var t=(new Date).getTime();l=t,s||(o&&a.apply(r,c),d(i))}};e.Z={name:"DebounceClick",functional:!0,render(t,e){var n,a=e.props.time,i=e.props.immediate,e=e.slots().default;return void 0===e?(o.warn("<debounce> 组件必须要有子元素"),null):((e=e[0]||null).data.on&&e.data.on.click?(n=e.data.on.click,n=s(n,a,i),e.data.on.click=n):e.componentOptions&&e.componentOptions.listeners.click&&(n=e.componentOptions.listeners.click,n=s(n,a,i),e.componentOptions.listeners.click=n),e)}}}}]);