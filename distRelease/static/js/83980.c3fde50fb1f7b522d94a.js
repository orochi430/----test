"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[83980,17649],{30819:function(e,t,n){n.d(t,{Z:function(){return d}});var t=n(26243),i=n.n(t),t=n(62680),o=n.n(t),t=n(95366),a=n.n(t),t=n(6919),s=n.n(t),r=n(77193),t=n(73473),l=n.n(t);function c(t,e){var n,s=i()(t);return o()&&(n=o()(t),e&&(n=n.filter(function(e){return a()(t,e).enumerable})),s.push.apply(s,n)),s}var t={name:"WorkFlowDialog",props:{formData:{type:Object,default:function(){return{}}},metaData:{type:Object,default:function(){return{}}}},data:function(){return{text:"退回",message:"",showDialog:!1,submitAfter:function(){},h:0,isNeedWrite:dsf.config.setting["SYS-FLOW-0038"]||0,personSelectData:[],secPeo:!1,columns:[],SendRequest:{}}},created:function(){},mounted:function(){},computed:{isShowUser:function(){return 1<this.columns.length||dsf.config.commonFlow.onePersonBackIsShow}},methods:{cancel:function(){this.showDialog=!1,this.h=0,this.$emit("close")},sendBack:function(){var t=this,e={pid:this.formData.pid||this.formData.pId,pnid:this.formData.pnid||this.formData.pnId,wfId:this.formData.flowId,backReason:this.message},n=dsf.layer.loading(this.text+"中");dsf.http.post("/fn/mobileFlow/sendBack",e).then(function(e){dsf.layer.closeLoading(n),t.dsf.layer.toast(t.text+"成功",!0),t.cancel(),setTimeout(function(){t.$emit("change")},100)})},sendBackNew:function(){var t,e,n=this,s=!0;n.metaData.buttons.mainButtons.some(function(e){"NoopinionBack"==e.action&&(s=!1)}),""==n.message.trim()&&1==n.isNeedWrite&&1==s?dsf.layer.toast("请输入退回原因"):n.personSelectData.length<1&&n.isShowUser?dsf.layer.toast("请选择退回人员"):(t=dsf.layer.loading(n.text+"中"),e={TPID:n.SendRequest.tpid,CurLinkID:n.personSelectData[0].LinkID,WFID:n.SendRequest.wfid,backType:1,Remark:n.message,inherit:"",MultSendBackMod:n.SendRequest.multSendBackMod,IsMergeTodo:n.SendRequest.isMergeTodo,NGR:0,SendBackTo:n.SendRequest.sendBackTo},dsf.http.post("/fn/flow/submitSendBackNode",e).then(function(e){dsf.layer.closeLoading(t),n.dsf.layer.toast(n.text+"成功",!0),n.cancel(),setTimeout(function(){n.$emit("change")},100)}))},show:function(e){var n=this,e=e.text,t=(this.personSelectData=[],{pId:this.metaData.parameters?this.metaData.parameters.pId:this.formData.pid||this.formData.pId,flowId:(this.metaData.parameters||this.formData).flowId,pk:this.metaData.parameters?this.metaData.parameters.pk:this.formData.info_d||this.formData.info_id,pnId:this.metaData.parameters?this.metaData.parameters.pnId:this.formData.pnid||this.formData.pnId});return dsf.http.get("fn/flow/getGPNodeProcess",t).then(function(e){var t,e=e.data;"200"==e.code&&(t=[],n.SendRequest=e.data.SendRequest,e.data.processArray.forEach(function(e){t.push(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){(0,r.Z)(t,e,n[e])}):s()?Object.defineProperties(t,s()(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,a()(n,e))})}return t}({text:e.Sender.UserName+"(".concat(e.PARENT_NODENAME,")")},e))}),n.columns=t,1==n.columns.length&&(n.personSelectData=t),n.initHeight())}),this.text=e||"",this.message="退回"==e&&dsf.config.setting["SYS-MOBILE-FORM-0005"]||"",this.showDialog=!0,new(l())(function(e){n.submitAfter=e})},initHeight:function(){var e=this;this.$nextTick(function(){e.isShowUser?e.h=e.$refs.content.offsetHeight-270:e.h=e.$refs.content.offsetHeight-160})},close:function(){this.showDialog=!1,this.h=0},showPersonModel:function(){this.secPeo=!this.secPeo},onConfirm:function(e){this.personSelectData=[],this.personSelectData.push(e),this.showPersonModel()},closePerson:function(e,t){this.personSelectData.splice(t,1)},submitFun:function(){this.submitAfter(),this.text,this.sendBackNew()}}},d=(0,n(51900).Z)(t,function(){var s=this,e=s._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:s.showDialog,expression:"showDialog"}],staticClass:"ds-workflow_dialog"},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:s.text+"理由","left-text":"取消"},on:{"click-left":function(e){return s.cancel()}}})],1),s._v(" "),e("div",{ref:"content",staticClass:"content"},[s.isShowUser?e("div",{ref:"user",staticClass:"sheetBox"},[e("p",{staticClass:"reasonLabel"},[s._v("退回人员")]),s._v(" "),e("div",{staticClass:"disfr ac",staticStyle:{padding:"10px 0"}},[e("div",{staticClass:"peopleSec disfr ac flex1"},[s._l(s.personSelectData,function(t,n){return e("van-tag",{key:n,attrs:{closeable:"",size:"large",type:"primary"},on:{close:function(e){return s.closePerson(t,n)}}},[s._v("\n            "+s._s(t.text)+"\n          ")])}),s._v("\n            \n        ")],2),s._v(" "),e("van-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"default"},on:{click:s.showPersonModel}},[s._v("选择人员")])],1),s._v(" "),e("p",{staticClass:"reasonLabel",staticStyle:{"margin-bottom":"0.2rem"}},[s._v("退回原因")])]):s._e(),s._v(" "),e("van-field",{ref:"reason",staticClass:"reason",attrs:{rows:"5",type:"textarea",placeholder:"请输入"+s.text+"理由",border:""},model:{value:s.message,callback:function(e){s.message=e},expression:"message"}})],1),s._v(" "),e("div",{staticClass:"footer"},[e("van-button",{attrs:{type:"theme",block:""},on:{click:s.submitFun}},[s._v("确认"+s._s(s.text))])],1),s._v(" "),e("van-popup",{style:{height:"50vh"},attrs:{position:"bottom",round:""},model:{value:s.secPeo,callback:function(e){s.secPeo=e},expression:"secPeo"}},[e("div",{staticStyle:{width:"100%"}},[e("van-picker",{attrs:{title:"请选择退回人员","show-toolbar":"",columns:s.columns},on:{confirm:s.onConfirm,cancel:s.showPersonModel}})],1)])],1)},[],!1,null,"447cfcb4",null).exports},5453:function(e,t,n){n.d(t,{Z:function(){return u}});var t=n(26243),i=n.n(t),t=n(62680),o=n.n(t),t=n(95366),a=n.n(t),t=n(6919),s=n.n(t),r=n(77193),t=n(59655),l=n(25108);function c(t,e){var n,s=i()(t);return o()&&(n=o()(t),e&&(n=n.filter(function(e){return a()(t,e).enumerable})),s.push.apply(s,n)),s}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){(0,r.Z)(t,e,n[e])}):s()?Object.defineProperties(t,s()(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,a()(n,e))})}return t}var t={name:"EnclosureButton",components:{EnclosureItem:t.Z},props:["fileData"],data:function(){return{dataValue:{info_id:"",moduleId:""},isShow:!1,overflow:document.body.style.overflow,typeConfig:{img:"iconpicture",text:"iconfile"},loading:!1,isLast:!1,isError:!1,params:{info_id:"",infoId:"",moduleId:"",nodeId:"",start:0,limit:10},list:[]}},watch:{isShow:function(e){document.body.style.overflow=e?"hidden":this.overflow}},mounted:function(){var e={},t="200517191343bubbMI4Pg5IyFs0BvPV"==(e=this.$route.params.formData?this.$route.params.formData.dataValue:this.fileData).masterId;this.params.info_id=this.params.infoId=t?e.masterId:e.info_id||e.fid||e.id||e.A0001||e["SW_XZD.A0001"],this.params.moduleId=t?e.masterModuleId:e.moduleId||e.A0004||e["SW_XZD.A0004"],this.postData()},destroyed:function(){document.body.style.overflow=this.overflow},methods:{emptyEvent:function(){},showBox:function(){this.isShow=!0},closeBox:function(){this.isShow=!1},openFile:function(e){this.$emit("open-file",e),this.isShow=!1},scrollEvent:function(e){var e=e.target,t=e.offsetHeight,n=e.scrollHeight,e=e.scrollTop;0===e?l.log("到顶了"):n<e+t+100&&this.postData()},postData:function(){var t=this;this.loading||this.isLast||(this.loading=!0,dsf.http.post("fn/mobileAttachment/getFormAttachment",d(d({},this.params),{},{start:this.params.start+1})).done(function(e){t.postDataSuccess(e)}).error(function(e){t.isError=!0,t.dsf.layer.toast("请求异常")}).always(function(){t.loading=!1}))},postDataSuccess:function(e){var r,l=this,e=e.rows;e.length?(e.length<this.params.limit&&(this.isLast=!0),this.$set(this.params,"start",this.params.start+1),r=(new Date).getTime(),e.map(function(e){e=e.document;return e&&e.forEach(function(e){var t=e.id,n=e.infoId,s=e.title,i=e.type,o=e.moduleId,e=e.size,a=dsf.util.loadSessionStore("loginToken");l.list.push({id:t,title:s,size:e||"",url:dsf.url.getServerUrl("fn/file/download?infoId=".concat(n,"&fileId=").concat(t,"&fileName=").concat(s,"&nrType=").concat(i,"&moduleId=").concat(o,"&x-auth-token=").concat(a,"&fullfilename=").concat(r).concat(s))})})}),this.$emit("fileList",this.list),1===this.params.start&&0<this.list.length&&this.$emit("open-file",this.list[0].url)):this.isLast=!0}}},u=(0,n(51900).Z)(t,function(){var t=this,n=t._self._c;return n("div",{staticClass:"ds-enclosure-button"},[n("div",{staticClass:"__e_button",on:{click:t.showBox}},[n("i",{staticClass:"iconfont iconqiehuanfujian"}),t._v(" 附件\n  ")]),t._v(" "),n("transition",{attrs:{name:"__e_box"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"__e_box",on:{click:t.closeBox}},[n("div",{ref:"main",staticClass:"__e_box_main",on:{scroll:t.scrollEvent,click:function(e){return e.stopPropagation(),t.emptyEvent.apply(null,arguments)}}},[t.isError&&!t.list.length?n("div",{staticClass:"__file_empty"},[n("commonempty",{attrs:{image:"network",description:"请求异常"}})],1):t._e(),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.list.length&&t.isLast,expression:"!list.length && isLast"}],staticClass:"__file_empty"},[n("commonempty",{attrs:{description:"暂无附件"}})],1),t._v(" "),n("div",{staticClass:"__file_list"},t._l(t.list,function(e){return n("enclosure-item",{key:e.id,attrs:{name:e.title,size:e.size,url:e.url},on:{open:t.openFile}})}),1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.loading&&!t.isLast,expression:"loading && !isLast"}],staticClass:"__list_loading"},[n("van-loading",{attrs:{type:"spinner",size:"24px"}})],1)])])])],1)},[],!1,null,"6053d58c",null).exports},17649:function(e,t,n){n.r(t),n.d(t,{default:function(){return i}});var s=n(25108),t={name:"EnclosurePre",props:{fileUrl:{type:String,default:""}},data:function(){return{}},mounted:function(){window.filePreview.onhashchange=function(e){s.log("tag",window.filePreview.location.href)}},computed:{fullUrl:function(){return dsf.url.openOffice(encodeURIComponent(this.fileUrl))}},methods:{}},i=(0,n(51900).Z)(t,function(){var e=this._self._c;return e("div",{staticClass:"ds-enclosure-pre"},[this.fileUrl&&0<this.fileUrl.length?e("iframe",{attrs:{id:"filePreview",src:this.fullUrl,frameborder:"0"}}):e("commonempty",{attrs:{description:"暂无预览"}})],1)},[],!1,null,null,null).exports},31026:function(e,t,n){n.r(t),n.d(t,{default:function(){return s}});var t=n(26243),o=n.n(t),t=n(8450),a=n.n(t),t=n(63560),r=n(25108),t={name:"DelayForm",props:["type"],components:{selectPerson:t.default},data:function(){return{formData:{},attach_1:[],showPerson:!1,sqdw:"",sqr:"",sqrq:"",yqrq:"",yqyy:"",showPicker:!1,showPicker1:!1,minDate:new Date((new Date).getFullYear()-40,0,1),maxDate:new Date((new Date).getFullYear()+10,11,31),currentDate:new Date,fileList:[],maininfo:{},moduleId:"190323161611pdCmmXaqoOhKvPKgG7X",formId:"190323193106NSc1cNEPPG8YB06DLQd",info_id:""}},computed:{},watch:{},methods:{onClickLeft:function(){this.$router.go(-1)},onSubmit:function(t){var n=this,s=(r.log("===提交"),this.maininfo.B0010={},this.maininfo.B0009={},this.maininfo.B0013={},this.maininfo["C-DB-YQ-0002"]={},this.maininfo["C-DB-YQ-0003"]={},this.maininfo.B0010.value=this.sqdw,this.maininfo.B0009.value=this.sqr,this.maininfo.B0013.value=this.sqrq,this.maininfo["C-DB-YQ-0002"].value=this.yqrq,this.maininfo["C-DB-YQ-0003"].value=this.yqyy,{}),e=(o()(this.maininfo).forEach(function(e,t){s[e]={},s[e].values=[{key:"value",value:n.maininfo[e].value}]}),{moduleId:this.moduleId,pk:this.info_id,formId:this.formId,__DATA:a()({maininfo:s})}),i=this;r.log(e),r.log(a()(s)),dsf.http.post("/fn/xform/save",e).then(function(e){r.log(e),i.$emit("change"),t()})},cancel:function(){this.$emit("close")},onConfirm:function(e){this.sqrq=dsf.date.format(e,"yyyy-mm-dd"),this.showPicker=!1},onConfirm1:function(e){this.yqrq=dsf.date.format(e,"yyyy-mm-dd"),this.showPicker1=!1},getUserList:function(){var t=this;dsf.http.get("/fn/xform/data?pk=&moduleId=190323161611pdCmmXaqoOhKvPKgG7X",{}).then(function(e){r.log("===请求表单数据接口"),r.log(e.data.main),t.maininfo=e.data.main,t.info_id=e.data.main.A0001.value,r.log(t.maininfo)})},cancePerson:function(){this.showPerson=!1},getUserNames:function(e){var n="";return e.forEach(function(e,t){""==n?n=e.name:n+=","+e.name}),n},getSelectUser:function(e){r.log("我的",e),0<e.length&&(this.sqr=this.getUserNames(e))},selectUser:function(){this.showPerson=!0,r.log("选人")},doFileRead:function(e,t){var n=this,t="/fn/mobileAttachment/upload?fileId=&moduleId="+this.moduleId+"&mid="+this.moduleId+"&pId=0&pnId=0&nodeName="+encodeURI("拟稿")+"&nrType="+t+"&pk="+this.info_id+"&newFileFlag=0";dsf.http.upload(t,{},e).then(function(e){r.log(e),n.getWebFiles()})},afterRead:function(t){var n=this;this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),this.onSubmit(function(e){n.doFileRead(t,1)})},getWebFiles:function(){var e={info_id:this.info_id,infoId:this.info_id,moduleId:this.moduleId,nodeId:"",start:0,limit:100},n=this;dsf.http.post("/fn/mobileAttachment/getFormAttachment",e).then(function(e){r.log(e.data),e&&e.data&&e.data.rows&&e.data.rows.forEach(function(e,t){"1"==e.attachType&&(n.attach_1=e.document)}),n.$toast.clear()})},removeFile:function(e){r.log(e);var e={pk:e.infoId,fileId:e.id,moduleId:e.moduleId,nrType:e.type,fileName:e.title},t=this;dsf.http.post("/fn/mobileFileUpload/delete",e).then(function(e){t.getWebFiles()})},delayData:function(){this.moduleId,this.moduleId}},created:function(){this.formData=this.$route.params.formData,r.log(this.formData)},mounted:function(){this.getUserList()},destroyed:function(){}},s=(0,n(51900).Z)(t,function(){var n=this,s=n._self._c;return s("div",{staticClass:"receipt"},[1==n.type?s("div",{staticClass:"header"},[s("van-nav-bar",{attrs:{title:"申请延期","left-text":"取消"},on:{"click-left":function(e){return n.cancel()}}})],1):n._e(),n._v(" "),s("div",{staticClass:"form-frame"},[s("div",{staticClass:"form-contain",staticStyle:{position:"relative"}},[s("van-form",{on:{submit:n.onSubmit}},[s("van-field",{attrs:{"input-align":"right",label:"*申请单位",placeholder:"请输入"},scopedSlots:n._u([{key:"label",fn:function(){return[s("span",[s("label",{staticClass:"mast-input"},[n._v("*")]),n._v("申请单位")])]},proxy:!0}]),model:{value:n.sqdw,callback:function(e){n.sqdw=e},expression:"sqdw"}}),n._v(" "),s("van-field",{attrs:{"input-align":"right",label:"*申请人",placeholder:"请选择"},on:{click:n.selectUser},scopedSlots:n._u([{key:"label",fn:function(){return[s("span",[s("label",{staticClass:"mast-input"},[n._v("*")]),n._v("申请人")])]},proxy:!0}]),model:{value:n.sqr,callback:function(e){n.sqr=e},expression:"sqr"}}),n._v(" "),s("van-popup",{attrs:{position:"bottom",round:""},model:{value:n.showPicker,callback:function(e){n.showPicker=e},expression:"showPicker"}},[s("van-datetime-picker",{attrs:{type:"datetime","min-date":n.minDate,"max-date":n.maxDate},on:{confirm:n.onConfirm,cancel:function(e){n.showPicker=!1}},model:{value:n.currentDate,callback:function(e){n.currentDate=e},expression:"currentDate"}})],1),n._v(" "),s("van-popup",{attrs:{position:"bottom",round:""},model:{value:n.showPicker1,callback:function(e){n.showPicker1=e},expression:"showPicker1"}},[s("van-datetime-picker",{attrs:{type:"datetime","min-date":n.minDate,"max-date":n.maxDate},on:{confirm:n.onConfirm1,cancel:function(e){n.showPicker1=!1}},model:{value:n.currentDate,callback:function(e){n.currentDate=e},expression:"currentDate"}})],1),n._v(" "),s("van-field",{attrs:{"input-align":"right",readonly:"",clickable:"",name:"calendar",value:n.sqrq,placeholder:"请选择"},on:{click:function(e){n.showPicker=!0}},scopedSlots:n._u([{key:"label",fn:function(){return[s("span",[s("label",{staticClass:"mast-input"},[n._v("*")]),n._v("申请日期")])]},proxy:!0}])}),n._v(" "),s("van-field",{attrs:{"input-align":"right",readonly:"",clickable:"",name:"calendar",value:n.yqrq,placeholder:"请选择"},on:{click:function(e){n.showPicker1=!0}},scopedSlots:n._u([{key:"label",fn:function(){return[s("span",[s("label",{staticClass:"mast-input"},[n._v("*")]),n._v("延期日期")])]},proxy:!0}])}),n._v(" "),s("van-field",{staticClass:"reset",attrs:{type:"textarea",rows:"2",placeholder:"请输入"},scopedSlots:n._u([{key:"label",fn:function(){return[s("span",[s("label",{staticClass:"mast-input"},[n._v("*")]),n._v("延期原因")])]},proxy:!0}]),model:{value:n.yqyy,callback:function(e){n.yqyy=e},expression:"yqyy"}}),n._v(" "),s("van-field",{staticClass:"reset",attrs:{name:"uploader",label:"附件"},scopedSlots:n._u([{key:"input",fn:function(){return[s("div",{staticClass:"dofile",staticStyle:{width:"100%"}},[s("div",{staticClass:"upload-files"},n._l(n.attach_1,function(e,t){return s("div",{key:t,staticClass:"file-list"},[s("i",{staticClass:"iconfont iconfile"}),n._v(" "),s("span",[n._v(n._s(e.title))])])}),0),n._v(" "),s("van-uploader",{staticClass:"upload-btn",attrs:{"after-read":n.afterRead}},[s("span",{staticClass:"add-file"},[s("van-icon",{attrs:{name:"plus"}})],1)])],1)]},proxy:!0}])}),n._v(" "),s("div",{staticClass:"submit"},[s("van-button",{attrs:{square:"",block:"",type:"info","native-type":"submit"}},[n._v("提交")])],1)],1),n._v(" "),s("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,position:"bottom"},model:{value:n.showPerson,callback:function(e){n.showPerson=e},expression:"showPerson"}},[s("selectPerson",{attrs:{type:0},on:{getSelectUser:n.getSelectUser,cancePerson:n.cancePerson}})],1)],1)])])},[],!1,null,"6311f5bd",null).exports},46385:function(e,t,n){n.r(t),n.d(t,{default:function(){return r}});var s=n(66250),t=n(73473),l=n.n(t),t=n(8450),a=n.n(t),t=n(33453),c=n.n(t),t=n(70680),i=n(18868),o=n(63450),d=n(25108),t={name:"SeparateRead",components:{controlUserTree:t.default,DebounceClick:i.Z,controlUserList:o.default},props:{separateTabs:{type:Array,default:function(){return[]}},formParams:{type:Object,default:function(){return{}}},nowButtonParameters:{type:Object,default:function(){return{}}}},data:function(){return{result:[],resolve:function(){},reject:function(){},isShow1:!1,isShow2:!1,opinionList:[],message:"",optionValue:"",nowList:[],showList1:[],organizeList:[],userList:[],privateData:[],data:{},selectList:[],personSelectData:"",oldV:[],selectArr:[],selectParent:[],selectChild:[],type:0,extra:{multiple:!0,filterSelf:"-1"==dsf.config.setting["SYS-FY-0012"],tabs:[]},tab:"",defaultSelectArray:[],smsContent:""}},created:function(){var n=this;return(0,s.Z)(c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getTabs();case 2:t=dsf.config.setting["SYS-FY-0010"]||[],n.separateTabs&&n.separateTabs.length?n.extra.tabs=n.separateTabs:t.length?n.extra.tabs=JSON.parse(t).filter(function(e){return"角色"!=e.name}):n.extra.tabs={multiple:!0,filterSelf:"-1"==dsf.config.setting["SYS-FY-0012"],tabs:[{action:"fn/user/select/data?types=person&rootObject=1&action=self_dept&async=true",name:"本部门",subTabKey:"department"},{action:"fn/user/select/data?types=person&rootObject=1&action=self_org&async=true",name:"本机构",subTabKey:"department"},{name:"群组",action:"fn/user/select/data?types=person,department,post,privateGroup,own_group&rootObject=2&action=private_group&async=true&source=share",subTabKey:"department"}]};case 4:case"end":return e.stop()}},e)}))()},methods:{getTabs:function(){var o=this;return new(l())(function(i,e){try{dsf.http.post("/fn/mobileToRead/mobileShareInfo",{selectedTabs:o.nowButtonParameters.selectedTabs||"",pk:o.formParams.pk,moduleId:o.formParams.moduleId,distribId:o.formParams.distribId||""}).then(function(e){var t,n,s;200==e.data.code&&(dsf.config.setting["SYS-FY-0010"]=a()(e.data.data.tabs),t=/\[(.+?)\]/g,n=e.data.data.fySmsContent,s={"分阅用户":dsf.util.loadSessionStore("user").name,"分阅时间":moment().format("YYYY-MM-DD HH:mm:ss"),"模块名称":o.data.moduleName,"文件标题":o.data.bt,"分阅意见":o.optionValue},n.match(t)&&n.match(t).forEach(function(e){var t=e.replace("[","").replace("]","");s[t]&&(n=n.replace(e,s[t]))}),o.smsContent=n),i()})}catch(e){i()}})},show:function(e,t){var n=this;return this.data=e,this.defaultSelectArray=t,this.getAdvice(),1==this.nowButtonParameters.opinion?this.isShow1=!0:this.isShow2=!0,new(l())(function(e,t){n.resolve=e,n.reject=t})},cancel1:function(){this.isShow1=!1,this.reject("流程被中断")},cancel2:function(){this.isShow2=!1},send:function(){this.isShow2=!0},getAdvice:function(){var t=this;dsf.http.get("fn/mobileUsedOpinion/find").then(function(e){t.opinionList=e.data.rows})},addAdvice:function(){var e=this;""===this.optionValue?dsf.layer.toast("请输入内容"):dsf.http.post("fn/mobileUsedOpinion/add",{__DATA:a()({opinion:this.optionValue})}).then(function(){e.getAdvice()})},deleteAdvice:function(e){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除吗？"}).then(function(){dsf.http.get("fn/mobileUsedOpinion/delete?id="+e.id).then(function(){t.getAdvice()})})},writeAdvice:function(e){this.optionValue=this.optionValue+e,this.$forceUpdate()},addReadSure:function(a){var r=this;return(0,s.Z)(c().mark(function e(){var n,s,i,o,t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s=n="",o=[],a.forEach(function(e,t){t=t?",":"";n+="".concat(t).concat(e.type,"::").concat(e.id),s+=(5==e.type?"".concat(t):"".concat(t).concat(e.attrs.realDeptId||e.pid,"-")).concat(e.id),i+=(5==e.type?"".concat(t):"".concat(t).concat(e.attrs.orgNameLV2Text||e.attrs.orgNameLV1Text,"-")).concat(e.name),5==e.type&&o.push(e.name)}),o.length)return e.next=6,new(l())(function(e,t){dsf.layer.confirm({title:"提示",message:"是否确认分阅给【".concat(o.join(","),"】内所有人员？")},function(){e()})});e.next=6;break;case 6:if(t={infoId:r.data.info_id,userIds:s,userNames:i,schemaVals:n,distribId:r.data.distribId||"",canRedistrib:1,infoType:r.data.infoType||"",infoTypeText:r.data.infoTypeText||"",shareContent:r.optionValue,shareList:"",isSms:r.result.find(function(e){return"isSms"==e})?"1":"-1",smsContent:"",reShare:0,isEndSms:r.result.find(function(e){return"isEndSms"==e})?"1":"-1"},r.data.distribId&&"0"!=r.data.distribId&&(t.reShare=1),""===t.userIds)return dsf.layer.toast("请选择人员"),e.abrupt("return");e.next=11;break;case 11:r.isShow1=!1,r.isShow2=!1,d.log(t),dsf.layer.loading(),dsf.http.post("fn/mobileToReadOperation/toShare",t).then(function(t){dsf.layer.clear(),dsf.layer.toast(t.data.message,!0),r.data.distribId&&"0"!=r.data.distribId&&dsf.config.commonForm.toShareAndRead?dsf.http.post("fn/mobileToReadOperation/readed",{infoIds:r.data.info_id,distribIds:r.data.distribId}).then(function(e){r.resolve(t.data.message)}):r.resolve(t.data.message)});case 16:case"end":return e.stop()}},e)}))()},closePopup:function(){this.$emit("close")}}},r=(0,n(51900).Z)(t,function(){var s=this,e=s._self._c;return e("div",{staticClass:"ds-separate-read"},[e("van-popup",{attrs:{position:"bottom"},on:{closed:s.closePopup},model:{value:s.isShow1,callback:function(e){s.isShow1=e},expression:"isShow1"}},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:"分阅意见","left-text":"取消"},on:{"click-left":s.cancel1}})],1),s._v(" "),e("div",{staticClass:"body"},[e("van-field",{attrs:{rows:"4",type:"textarea",placeholder:"请输入分阅意见",autosize:""},model:{value:s.optionValue,callback:function(e){s.optionValue=e},expression:"optionValue"}}),s._v(" "),e("div",{staticClass:"tag-box"},[e("div",{staticClass:"tag-list"},s._l(s.opinionList,function(t,n){return e("div",{key:n,staticClass:"tag-item"},[e("div",{staticClass:"tag-item-text",on:{click:function(e){return s.writeAdvice(t.context)}}},[s._v("\n              "+s._s(t.context)+"\n            ")]),s._v(" "),e("div",{staticClass:"tag-item-bt",on:{click:function(e){return s.deleteAdvice(t,n)}}},[e("van-icon",{attrs:{name:"cross"}})],1)])}),0),s._v(" "),e("van-button",{attrs:{icon:"plus",size:"small",plain:""},on:{click:s.addAdvice}},[s._v("新增模板")])],1),s._v(" "),e("div",{staticClass:"sms-container"},[e("van-checkbox-group",{attrs:{direction:"horizontal"},model:{value:s.result,callback:function(e){s.result=e},expression:"result"}},[e("van-checkbox",{attrs:{name:"isSms"}},[s._v("是否提醒")]),s._v(" "),e("van-checkbox",{attrs:{name:"isEndSms"}},[s._v("阅闭是否提醒")])],1),s._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:s.result.find(function(e){return"isSms"==e}),expression:"result.find(item => item == 'isSms')"}],attrs:{rows:"4",autosize:"",type:"textarea",placeholder:"请输入提醒内容"},model:{value:s.smsContent,callback:function(e){s.smsContent=e},expression:"smsContent"}})],1)],1),s._v(" "),e("div",{staticClass:"footer"},[e("van-button",{attrs:{type:"theme"},on:{click:s.send}},[s._v("选择人员")])],1)]),s._v(" "),e("van-popup",{ref:"container",style:{height:"100%"},attrs:{position:"bottom","close-on-click-overlay":!1},model:{value:s.isShow2,callback:function(e){s.isShow2=e},expression:"isShow2"}},[e("control-user-list",{attrs:{extra:s.extra,"default-select-array":s.defaultSelectArray},on:{close:s.cancel2,getSelectUser:s.addReadSure}})],1)],1)},[],!1,null,"7e65ecea",null).exports},7843:function(e,t,n){n.r(t),n.d(t,{default:function(){return o}});var t=n(73473),s=n.n(t),t=n(63560),i=n(88561),t={name:"AskLeave",components:{selectPerson:t.default},data:function(){return{isShow:!1,resolve:function(){},reject:function(){},data:null,showPerson:!1,congressPersons:[],congressPersonIds:"",congressPerson:"",leaveReason:""}},methods:{init:function(){var e=i.Z.loadSessionStore("user"),e=[{id:e.user_id,pid:e.deptId,name:e.name}];this.data=null,this.showPerson=!1,this.congressPersons=e,this.congressPersonIds=e[0].id,this.congressPerson=e[0].name,this.leaveReason=""},show:function(e){var n=this;return this.init(),this.data=e,this.isShow=!0,new(s())(function(e,t){n.resolve=e,n.reject=t})},cancel:function(){this.isShow=!1,this.reject("流程被中断")},submit:function(){var e,t=this;this.congressPersons.length?this.leaveReason.length?(e=dsf.layer.loading(),dsf.http.post("fn/mobilePDMeeting/attendMeeting",{attendance:-1,meetingtzId:this.data.meetingtzId,leaveReason:this.leaveReason,userName:this.congressPerson,userId:this.congressPersonIds,"x-auth-token":i.Z.loadSessionStore("loginToken")}).done(function(e){"200"===e.code?(t.isShow=!1,t.resolve(e)):dsf.layer.toast("请求异常")}).error(function(){dsf.layer.toast("请求异常")}).always(function(){dsf.layer.closeLoading(e)})):dsf.layer.toast("请填写请假理由"):dsf.layer.toast("请选择代会人员")},getUserNames:function(e){var t=[],n=[],e=e.map(function(e){return t.push(e.name),n.push(e.attrs.idValue),{id:e.attrs.idValue,pid:e.attrs.pidValue,name:e.name}});return{names:t.join(","),ids:n.join(","),persons:e}},getSelectUser:function(e){var t,n;0<e.length&&(t=(e=this.getUserNames(e)).names,n=e.ids,e=e.persons,this.congressPerson=t,this.congressPersonIds=n,this.congressPersons=e)}}},o=(0,n(51900).Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-ask-leave"},[e("van-popup",{staticClass:"ds-ask-leave-pop",attrs:{position:"bottom","get-container":"#app",round:""},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:"请假","left-text":"取消"},on:{"click-left":t.cancel}})],1),t._v(" "),e("div",{staticClass:"body"},[e("div",{staticClass:"congressPerson"},[e("van-field",{attrs:{readyonly:"","input-align":"left",label:"代会人员:",placeholder:"请选择"},on:{click:function(e){t.showPerson=!0}},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),t._v("代会人员：\n          ")])]},proxy:!0}]),model:{value:t.congressPerson,callback:function(e){t.congressPerson=e},expression:"congressPerson"}})],1),t._v(" "),e("van-field",{attrs:{rows:"2",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:t.leaveReason,callback:function(e){t.leaveReason=e},expression:"leaveReason"}})],1),t._v(" "),e("div",{staticClass:"footer"},[e("van-button",{attrs:{type:"theme"},on:{click:t.submit}},[t._v("提交")])],1)]),t._v(" "),e("van-popup",{style:{height:"90%"},attrs:{"close-on-click-overlay":!1,position:"bottom","get-container":"#app",round:""},model:{value:t.showPerson,callback:function(e){t.showPerson=e},expression:"showPerson"}},[e("selectPerson",{on:{getSelectUser:t.getSelectUser,cancePerson:function(e){t.showPerson=!1}}})],1)],1)},[],!1,null,null,null).exports},89007:function(e,t,n){n.r(t),n.d(t,{default:function(){return B}});var t={name:"ReceiptReadonly",props:["info"],methods:{getVal:function(e){if(this.info.opinionList&&this.info.opinionList[e]){var t,n=this.info.opinionList[e],s="";for(t in n){var i=n[t];s+="\n          <span>".concat(i.opinionContent,'</span>\n          <p style="text-align:left">').concat(i.userName," ").concat(i.opinionDate,"</p>")}return s||""}return this.msg}}},s=n(51900),t=(0,s.Z)(t,function(){var e=this,t=e._self._c;return t("div",{staticClass:"receipt-readonly"},[e.info?t("van-cell-group",[t("van-cell",{attrs:{value:e.info.B0001&&e.info.B0001.value||"",title:"文件标题"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-LW-0001"]&&e.info["C-LW-0001"].value||"",title:"来文单位"}}),e._v(" "),t("van-cell",{attrs:{title:"领导批示",value:e.info["200113110054qQsV5PE7sKFR9T7NOcb"]&&e.info["200113110054qQsV5PE7sKFR9T7NOcb"].value||""}}),e._v(" "),t("van-cell",{attrs:{title:"拟办意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("办公室拟办"))}})]},proxy:!0}],null,!1,2589297801)}),e._v(" "),t("van-cell",{attrs:{title:"办理情况",value:e.info["C-LW-0006"]&&e.info["C-LW-0006"].value||""}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-LW-0016"]&&e.info["C-LW-0016"].value||"",title:"来文文号"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0013&&e.info.B0013.value||"",title:"来文日期"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0021&&e.info.B0021.value||"",title:"收文日期"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0003&&e.info.B0003.value||"",title:"收文编号"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0006&&e.info.B0006.text||"",title:"紧急程度"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0018&&e.info.B0018.value||"",title:"办理期限"}})],1):e._e()],1)},[],!1,null,null,null).exports,i=(0,s.Z)({name:"PostFileReadonly",props:["info","msg"],methods:{getVal:function(e){if(this.info.opinionList&&this.info.opinionList[e]){var t,n=this.info.opinionList[e],s="";for(t in n){var i=n[t];s+="\n          <span>".concat(i.opinionContent,'</span>\n          <p style="text-align:left">').concat(i.userName," ").concat(i.opinionDate,"</p>")}return s||""}return this.msg}}},function(){var e=this,t=e._self._c;return t("div",{staticClass:"receipt-readonly"},[e.info?t("van-cell-group",[t("van-cell",{attrs:{value:e.info.B0001&&e.info.B0001.value||e.msg,title:"文件标题"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0003&&e.info.B0003.value||e.msg,title:"文号"}}),e._v(" "),t("van-cell",{attrs:{title:"签发意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("领导签发"))}})]},proxy:!0}],null,!1,1388096459)}),e._v(" "),t("van-cell",{attrs:{title:"会签意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("部门会稿"))}})]},proxy:!0}],null,!1,1798567675)}),e._v(" "),t("van-cell",{attrs:{title:"科室审核"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("部门审核"))}})]},proxy:!0}],null,!1,2400229287)}),e._v(" "),t("van-cell",{attrs:{title:"办公室核稿"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("办公室核稿"))}})]},proxy:!0}],null,!1,2350103215)}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-GW-FW-0001"]&&e.info["C-GW-FW-0001"].text||e.msg,title:"主送单位"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-GW-FW-0002"]&&e.info["C-GW-FW-0002"].text||e.msg,title:"抄送单位"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-FW-0022"]&&e.info["C-FW-0022"].value||e.msg,title:"文种"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0015&&e.info.B0015.text||e.msg,title:"是否公开"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0006&&e.info.B0006.text||e.msg,title:"紧急程度"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-FW-0036"]&&e.info["C-FW-0036"].value||e.msg,title:"签发日期"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0014?(e.info.B0014.value||0)+"份":e.msg,title:"打印份数"}})],1):e._e()],1)},[],!1,null,null,null).exports,o=n(25108),a=(0,s.Z)({name:"MeetingReadonly",props:["info","type"],data:function(){return{}},created:function(){},methods:{getVal:function(e){if(this.info.opinionList&&this.info.opinionList[e]){this.msg="";var t,n=this.info.opinionList[e],s=(o.log(n),"");for(t in n){var i=n[t];o.log(i),s+="\n          <span>".concat(i.opinionContent,'</span>\n          <p style="text-align:left">').concat(i.userName," ").concat(i.opinionDate,"</p>")}return s||""}return""}}},function(){var e=this,t=e._self._c;return t("div",{staticClass:"receipt-readonly MeetingReadonly"},[e.info?t("van-cell-group",[t("van-cell",{attrs:{value:e.info.B0001&&e.info.B0001.value||"",title:"会议名称"}}),e._v(" "),e.info.dataValue.pid?t("van-cell",{attrs:{title:"单位领导意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("单位领导"))}})]},proxy:!0}],null,!1,1943748348)}):e._e(),e._v(" "),e.info.dataValue.pid?t("van-cell",{attrs:{title:"部门负责人意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("部门负责人"))}})]},proxy:!0}],null,!1,419466520)}):e._e(),e._v(" "),t("van-cell",{attrs:{value:e.info["c-meetingtz-019"]&&e.info["c-meetingtz-019"].value||"",title:"开始时间"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["c-meetingtz-020"]&&e.info["c-meetingtz-020"].value||"",title:"结束时间"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["c-meetingtz-030"]&&e.info["c-meetingtz-030"].value||"",title:"会议地点"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["c-meetingtz-004"]&&e.info["c-meetingtz-004"].text||"",title:"会议类型"}}),e._v(" "),e.type?e._e():t("van-cell",{attrs:{value:e.info["c-meetingtz-011"]&&e.info["c-meetingtz-011"].text||"",title:"会议主持"}}),e._v(" "),e.type?e._e():t("van-cell",{attrs:{value:e.info["c-meetingtz-014"]&&e.info["c-meetingtz-014"].text||"",title:"参会领导"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["c-meetingtz-043"]&&e.info["c-meetingtz-043"].text||"",title:"参会单位"}}),e._v(" "),e.type?e._e():t("van-cell",{attrs:{value:e.info["c-meetingtz-013"]&&e.info["c-meetingtz-013"].text||"",title:"参会人员"}})],1):e._e()],1)},[],!1,null,null,null).exports,r=(0,s.Z)({name:"SuperviseReadonly",props:["info"]},function(){var e=this,t=e._self._c;return t("div",{staticClass:"receipt-readonly"},[e.info?t("van-cell-group",[t("van-cell",{attrs:{title:"督办标题",value:e.info.B0001&&e.info.B0001.value||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"督办类型",value:e.info["C-DB-0020"]&&e.info["C-DB-0020"].text||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"督办要求",value:e.info["C-DB-0007"]&&e.info["C-DB-0007"].value||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"主办部门",value:e.info["C-DB-0001"]&&e.info["C-DB-0001"].text||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"协办部门",value:e.info["C-DB-0002"]&&e.info["C-DB-0002"].text||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"紧急程度",value:e.info.B0006&&e.info.B0006.text||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"办理时限",value:e.info.B0019&&e.info.B0019.value||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"是否定期反馈",value:e.info.B0054&&e.info.B0054.text||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"反馈开始日期",value:e.info["C-DB-0014"]&&e.info["C-DB-0014"].value||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"反馈周期",value:e.info["C-DB-0011"]&&e.info["C-DB-0011"].value?e.info["C-DB-0011"].value+e.info["C-DB-0011"].text:"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"办结提醒",value:e.info["C-DB-0031"]&&e.info["C-DB-0031"].value||"暂无"}}),e._v(" "),t("van-cell",{attrs:{title:"反馈提醒",value:e.info["C-DB-0030"]&&e.info["C-DB-0030"].value||"暂无"}})],1):e._e()],1)},[],!1,null,null,null).exports,l=(0,s.Z)({name:"SignFileReadonly",props:["info"]},function(){var e=this,t=e._self._c;return t("div",{staticClass:"receipt-readonly"},[e.info?t("van-cell-group",[t("van-cell",{attrs:{value:e.info.B0001&&e.info.B0001.value||"",title:"文件标题"}}),e._v(" "),t("van-cell",{attrs:{value:""!=e.info["200311114615V9cbR2NNYL7eDw00HSx"].value?e.info["200311114615V9cbR2NNYL7eDw00HSx"].value||e.info.FWDW_NAME_PD.value:"",title:"来文单位"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-R-RCV-0001"]&&e.info["C-R-RCV-0001"].value||"",title:"来文文号"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-R-RCV-0009"]&&e.info["C-R-RCV-0009"].value||"",title:"来文日期"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-R-RCV-0010"]&&e.info["C-R-RCV-0010"].value||"",title:"收文日期"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0003&&e.info.B0003.value||"",title:"收文编号"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0006&&e.info.B0006.text||"",title:"紧急程度"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0018&&e.info.B0018.value||"",title:"办理期限"}})],1):e._e()],1)},[],!1,null,null,null).exports,c=(0,s.Z)({name:"DuBanLiXiangDanReadOnly",props:["info"],methods:{getVal:function(e){if(this.info.opinionList&&this.info.opinionList[e]){var t,n=this.info.opinionList[e],s="";for(t in n){var i=n[t];s+="\n          <span>".concat(i.opinionContent,'</span>\n          <p style="text-align:left">').concat(i.userName," ").concat(i.opinionDate,"</p>")}return s||""}return""}}},function(){var e=this,t=e._self._c;return t("div",{staticClass:"receipt-readonly"},[e.info?t("van-cell-group",[t("van-cell",{attrs:{value:e.info.B0001&&e.info.B0001.value||"",title:"督办标题"}}),e._v(" "),e.info.dataValue.pid?t("van-cell",{attrs:{title:"单位领导意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("单位领导"))}})]},proxy:!0}],null,!1,1943748348)}):e._e(),e._v(" "),e.info.dataValue.pid?t("van-cell",{attrs:{title:"部门负责人意见"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{domProps:{innerHTML:e._s(e.getVal("部门负责人"))}})]},proxy:!0}],null,!1,419466520)}):e._e(),e._v(" "),t("van-cell",{attrs:{value:e.info.B0003&&e.info.B0003.value||"",title:"督办编号"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-DB-0020"]&&e.info["C-DB-0020"].text||"",title:"督办类型"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-DB-0007"]&&e.info["C-DB-0007"].value||"",title:"督办要求"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-DB-0001"]&&e.info["C-DB-0001"].text||"",title:"主办单位"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-DB-0001"]&&e.info["C-DB-0001"].text||"",title:"协办单位"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0006&&e.info.B0006.text||"",title:"紧急程度"}}),e._v(" "),t("van-cell",{attrs:{value:e.info.B0018&&e.info.B0018.value||"",title:"办结时限"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-DB-0014"]&&e.info["C-DB-0014"].value||"",title:"下次反馈日期"}}),e._v(" "),t("van-cell",{attrs:{value:e.info["C-DB-0011"]&&e.info["C-DB-0011"].value?e.info["C-DB-0011"].value+e.info["C-DB-0011"].text:"",title:"反馈周期"}})],1):e._e()],1)},[],!1,null,null,null).exports,d=n(25108),t=(0,s.Z)({name:"formFile",components:{ReceiptReadonly:t,PostFileReadonly:i,MeetingReadonly:a,SuperviseReadonly:r,SignFileReadonly:l,DuBanLiXiangDanReadOnly:c},data:function(){return{info:null,moduleId:"200514112152rWCht6hUiXVRuSKXPMZ",moduleIds:["2001131007187DmPkCTl0HFmPhHOk1c","200113151945A52p5tF0hUVkN2RlogI","200514112152rWCht6hUiXVRuSKXPMZ","2005131819079PyGXaUaHgivaFEdNzc","190121161348OthBI4s3sEhvfuDJ5FD","190313143112jfLuUxrc19Dchhv4BPU","190323145209SuSc9CTjs9rg88i22T1"],text:"获取异常"}},created:function(){var t,e,n,s,i,o=this;this.$route.params.formData?(e="190323145209SuSc9CTjs9rg88i22T1"==(t=this.$route.params.formData?this.$route.params.formData.dataValue:{}).masterModuleId,this.moduleId=e?t.masterModuleId:t.moduleId||t["SW_XZD.A0004"]||t.A0004,this.moduleIds.includes(this.moduleId)?(d.log(this.$route.params.formData),d.log(t.moduleName),this.moduleId?(n=this,s={},i=dsf.layer.loading("获取中"),dsf.http.get("/fn/xform/data",{pk:e?t.masterId:t.info_id||t.id||t["SW_XZD.A0001"]||t.A0001||t.fid,moduleId:n.moduleId}).then(function(e){n.info=e.data.main,n.info.dataValue=t,n.info.opinionList=e.data.opinionList||{},"dqs"==o.$route.params.type&&dsf.http.post("fn/remoteExchange/read",{rcvRecordId:t.A0001}).then(function(e){})}).catch(function(e){s={msg:"请求异常",type:!1}}).finally(function(){n.$nextTick(function(){dsf.layer.closeLoading(i),s.msg&&(n.info={},dsf.layer.toast(s.msg,s.type))})})):(this.info={},this.text="缺少参数",dsf.layer.toast("缺少参数，获取中断",!1))):(this.info={},this.text="未知类型")):(this.info={},this.text="缺少参数")}},function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-form-group"},[e.info&&!e.dsf.isEmptyObject(e.info)?[e.moduleId==e.moduleIds[0]?t("ReceiptReadonly",{attrs:{info:e.info,msg:""}}):e._e(),e._v(" "),e.moduleId==e.moduleIds[1]?t("PostFileReadonly",{attrs:{info:e.info}}):e._e(),e._v(" "),e.moduleId==e.moduleIds[2]?t("MeetingReadonly",{attrs:{info:e.info}}):e._e(),e._v(" "),e.moduleId==e.moduleIds[3]?t("SuperviseReadonly",{attrs:{info:e.info}}):e._e(),e._v(" "),e.moduleId==e.moduleIds[4]?t("MeetingReadonly",{attrs:{info:e.info,type:"1"}}):e._e(),e._v(" "),e.moduleId==e.moduleIds[5]?t("SignFileReadonly",{attrs:{info:e.info}}):e._e(),e._v(" "),e.moduleId==e.moduleIds[6]?t("DuBanLiXiangDanReadOnly",{attrs:{info:e.info}}):e._e()]:e.info&&e.dsf.isEmptyObject(e.info)?[t("commonempty",{attrs:{description:e.text}})]:e._e()],2)},[],!1,null,"431fb66e",null).exports,i=n(5453),a=n(17649),r=n(50856),l=n(86720),u=(n(73747),n(9980)),f=n(66250),c=n(33453),h=n.n(c),c=n(8450),p=n.n(c),c=n(27921),m=n.n(c),c=n(90487),v=n.n(c),c=n(59655),g=n(94358),_=n(85579),y=n.n(_),_=n(22013),w=n.n(_),k=n(5044),_=(0,s.Z)({name:"addTree",props:["personSelectData","type","multiple","deep"],data:function(){return{default_img:'this.src="'+n(5692)+'"',InListState:!1}},created:function(){this.$set(this.personSelectData[0],"isopen",!this.personSelectData[0].state),window.GLOBAL.ParentNode=[],window.GLOBAL.personAddList||(window.GLOBAL.personAddList=[]),1!=this.personSelectData[0].checked||1!=this.personSelectData[0].Type&&2!=this.personSelectData[0].Type||(window.GLOBAL.personAddList instanceof Array?window.GLOBAL.personAddList.push(this.personSelectData[0]):window.GLOBAL.personAddList=this.personSelectData,window.GLOBAL.renderList=window.GLOBAL.personAddList)},mounted:function(){var s=this;this.$bus.$on("InListState",function(e){window.GLOBAL.personAddList=e;var t="",n="";0<e.length&&e.forEach(function(e){0!=e.Type&&(t+=e.DeptID+","),0!=e.Type&&(n+=e.id+",")}),n&&n.includes(s.personSelectData[0].id)&&t.includes(s.personSelectData[0].DeptID)&&0!=s.personSelectData[0].Type?s.$set(s.personSelectData[0],"checked",!0):s.$set(s.personSelectData[0],"checked",!1)})},watch:{},methods:{checkAll:function(n,e){n.children&&0<n.children.length?(e?(n.isopen||this.$set(n,"isopen",!n.isopen),window.GLOBAL.personMultiple&&(this.$set(n,"checked",!n.checked),this.userClick(n))):this.$set(n,"isopen",!n.isopen),n.isopen?window.GLOBAL.ParentNode.push(n):window.GLOBAL.ParentNode.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.ParentNode.splice(t,1)})):(n.checked?(this.$delete(n,"checked"),this.$set(n,"checked",!1)):(this.$delete(n,"checked"),this.$set(n,"checked",!0)),this.userClick(n))},selectAll:function(e){this.$emit("select",e)},getStyle:function(e){return{"padding-left":"30px","box-sizing":"border-box"}},mapTree:function(e,t){var s=this;e.children.forEach(function(n){n.checked=t,n.checked?window.GLOBAL.personAddList.push(n):window.GLOBAL.personAddList.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.personAddList.splice(t,1)}),n.children&&0<n.children.length&&s.mapTree(n,t)})},userClick:function(n){var s=this,i=this,e=(window.GLOBAL.personMultiple?n.checked?(window.GLOBAL.personAddList.push(n),n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.push(n),this.mapTree(n,n.checked))):(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.forEach(function(e,t){e.id==n.id&&e.DeptID==n.DeptID&&window.GLOBAL.ParentNode.splice(t,1)}),this.mapTree(n,n.checked)),window.GLOBAL.personAddList.forEach(function(e,t){e.id==n.id&&e.DeptID==n.DeptID&&window.GLOBAL.personAddList.splice(t,1)})):n.checked?(window.GLOBAL.personAddList.forEach(function(e){i.$set(e,"checked",!1)}),window.GLOBAL.personAddList=[],window.GLOBAL.personAddList.push(n)):window.GLOBAL.personAddList.forEach(function(e,t){i.$set(e,"checked",!1),e.id==n.id&&e.DeptID==n.DeptID&&window.GLOBAL.personAddList.splice(t,1)}),window.GLOBAL.personAddList),o={},e=e.reduce(function(e,t){return"2"==t.Type?o[t.id+t.DeptID+t.RoleID]||(o[t.id+t.DeptID+t.RoleID]=e.push(t)):o[t.id+t.DeptID]||(o[t.id+t.DeptID]=e.push(t)),e},[]);e.forEach(function(e){e.id&&1<e.id.split("_").length&&e.id.split("_")[1]&&(e.id=e.id.split("_")[1],e.pid=e.pid.split("_")[1],e.children)&&0<e.children.length&&e.children.forEach(function(e){e.id=1<e.id.split("_").length?e.id.split("_")[1]:e.id.split("_")[0],e.pid=(e.pid.split("_").length,e.pid.split("_")[1])})}),window.GLOBAL.personAddList=e,window.GLOBAL.ParentNode.forEach(function(e){var t=e.children.find(function(e){return 1==e.checked}),n=e.children.find(function(e){return 0==e.checked});null==t&&(s.$delete(e,"checked"),s.$set(e,"checked",!1)),null==n&&(s.$delete(e,"checked"),s.$set(e,"checked",!0))}),this.$emit("select",e),this.$forceUpdate()},getFavicon:function(e){return e.Photo?dsf.url.getWebPath("/fn/mobilePhoto/download?id=".concat(e.id,"&time=").concat((new Date).getTime())):n(5692)}}},function(){var s=this,i=s._self._c;return i("div",{staticClass:"dsf-tree",staticStyle:{width:"100%",height:"100%"}},s._l(s.personSelectData,function(n,e){return i("div",{key:"index1"+e,staticStyle:{"overflow-y":"hidden"}},[i("div",{staticClass:"flex-box",class:{treeMargin:!s.deep,tree_line:n.isopen&&!s.deep}},[n.attrs.noselect?s._e():i("van-checkbox",{ref:"check",refInFor:!0,attrs:{"icon-size":"18px",shape:"".concat(s.multiple?"square":"round")},on:{click:function(e){return s.userClick(n)}},model:{value:n.checked,callback:function(e){s.$set(n,"checked",e)},expression:"item.checked"}}),s._v(" "),!n.attrs.noselect&&s.dsf.config.commonForm&&s.dsf.config.commonForm.isshowPhoto?i("img",{staticClass:"van-image",attrs:{src:s.getFavicon(n),alt:"",onerror:s.default_img}}):s._e(),s._v(" "),i("div",{staticClass:"tree_tit"},[i("span",{class:{tit_width:0<!n.children.length}},[s._v(s._s(n.showName))]),0<n.children.length?i("span",{class:{active:s.InListState||(null==(e=s.personSelectData[0].children)?void 0:e.find(function(e){return e.checked&&0!=e.Type}))}},[s._v("("+s._s(n.children.length)+")")]):s._e()]),s._v(" "),0<n.children.length?i("div",{staticClass:"isShowChiled",on:{click:function(e){return e.stopPropagation(),s.checkAll(n)}}},[n.isopen?i("van-icon",{attrs:{name:"arrow-up"}}):i("van-icon",{attrs:{name:"arrow-down"}}),s._v(" "),i("span",{staticClass:"r_span"},[s._v(s._s(n.isopen?"收起":"展开"))]),s._v(" "),!s.multiple||n.hideCheckAll||n.unitId&&n.unitId==n.id?s._e():i("i",{staticClass:"icon iconfont iconcheckAll",on:{click:function(e){return e.stopPropagation(),s.checkAll(n,"check")}}})],1):s._e()],1),s._v(" "),s._l(n.children,function(t,e){return i("div",{key:"index2"+e,staticClass:"child",style:{display:n.isopen?"block":"none"}},[1==t.type?i("div",{staticClass:"person",style:{"padding-left":"30px"},on:{click:function(e){return s.userClick(t)}}},[i("div",{staticClass:"flex-box person_child"},[i("van-checkbox",{staticClass:"child_check",attrs:{"icon-size":"16px"},model:{value:t.checked,callback:function(e){s.$set(t,"checked",e)},expression:"cell.checked"}},[i("div",{staticClass:"user-logo"},[i("i",{staticClass:"icon iconfont iconyonghu"})]),s._v(" "),i("div",{staticClass:"username"},[s._v(s._s(t.showName))])])],1)]):i("div",{style:s.getStyle(n.deep)},[i("add-tree",{attrs:{deep:!0,multiple:s.multiple,personSelectData:[t]},on:{select:s.selectAll}})],1)])})],2)}),0)},[],!1,null,"548b1c60",null).exports,D=n(24672),I=n(25108),S=(0,s.Z)({name:"searchUserList",props:["personSelectData","selectper","lineNodeData","response","checkData"],data:function(){return{searchValue:"",isHidden:!1,selectIds:[],selectItems:[],getUserBySearchValue:[],userdata:[],timer:null}},created:function(){this.isHidden=void 0,this.userdata=JSON.parse(p()(this.personSelectData))},mounted:function(){var e=this;this.$nextTick(function(){e.$refs.inputVal.querySelector("input").focus()}),this.selectItems=this.selectper},methods:{getPerson:function(e,t){var n=this;e.children&&0<e.children.length&&e.children.forEach(function(e){e.UserName&&-1<e.UserName.indexOf(t)&&n.getUserBySearchValue.push(e),n.getPerson(e,t)})},getUserAsync:function(e){var n=this,e=(this.getUserBySearchValue=[],{sendRequestID:this.response.SendRequestID,queryName:e,lineIDs:this.lineNodeData.LineID,RangeOtherUser:"0",ExpandLevel:-1,ruleList:p()([{nodeId:null==(e=this.lineNodeData.RangeRule)||null==(e=e.RuleList)||null==(e=e.Rule)?void 0:e.NodeID,level:null==(e=this.lineNodeData.RangeRule)||null==(e=e.RuleList)||null==(e=e.Rule)?void 0:e.Level,deptId:"",isDeep:"",isSelected:"0",rangeType:null==(e=this.lineNodeData.RangeRule)||null==(e=e.RuleList)||null==(e=e.Rule)?void 0:e.RangeType,isUser:"1"}])});dsf.http.post("/fn/mobileFlow/getFlowNodeUserByNode",e).then(function(e){var t,e=e.data;I.log(e),e.data&&0<e.data.length&&(e=e.data[0].SendRangeTree,t=[],t=Array.isArray(e.Node)?e.Node:[e.Node],n.getUserBySearchValue=n.openDataFilterUser(t),n.getUserBySearchValue.forEach(function(t){t.sId=t.id,t.showName=t.name,t.attrs={idValue:dsf.util.loadSessionStore("user").user_id},t.checked=!1,(n.checkData.some(function(e){return e.id==t.id&&e.DeptID==t.DeptID})||window.GLOBAL.personAddList.some(function(e){return e.id==t.id&&e.DeptID==t.DeptID}))&&(n.selectItems.push(t),t.checked=!0)}))})},openDataFilterUser:function(e){var t=this,n=[];return e.forEach(function(e){e.UserID&&n.push(e),e.Node&&(Array.isArray(e.Node)||(e.Node=[e.Node]),n=n.concat(t.openDataFilterUser(e.Node)))}),n},onSearch:function(t){var n=this;dsf.config.commonForm.isSelectProcessAsync?n.getUserAsync(t):(n.getUserBySearchValue=[],n.userdata.forEach(function(e){n.getPerson(e,t)}))},onBtnOk:function(){this.addPerson(),this.$emit("searchClose")},onCancel:function(){this.getUserBySearchValue=[],this.$emit("searchClose")},userClick:function(n){var s=this;window.GLOBAL.personMultiple?n.checked?(window.GLOBAL.personAddList.push(n),s.selectItems.push(n)):(window.GLOBAL.personAddList.forEach(function(e,t){e.id==n.id&&e.DeptID==n.DeptID&&window.GLOBAL.personAddList.splice(t,1)}),s.selectItems.forEach(function(e,t){n.UserID==e.UserID&&s.selectItems.splice(t,1)})):(s.selectItems=[],this.$emit("callgroup"),n.checked?(window.GLOBAL.personAddList.forEach(function(e){s.$set(e,"checked",!1)}),window.GLOBAL.personAddList=[],window.GLOBAL.personAddList.push(n),s.selectItems.push(n),s.getUserBySearchValue.forEach(function(e){n.UserID!=e.UserID&&s.$set(e,"checked",!1)})):window.GLOBAL.personAddList.forEach(function(e,t){s.$set(e,"checked",!1),e.id==n.id&&e.DeptID==n.DeptID&&window.GLOBAL.personAddList.splice(t,1)})),n.checked||this.cutData(n),I.log(s.selectItems),this.$forceUpdate()},callgroup:function(){this.$emit("callgroup")},cutData:function(e){this.$emit("cutData",e)},cutPutyData:function(e){this.$emit("cutPutyData",e)},addPerson:function(){var e=this.selectItems.filter(function(e){return e.checked}),n={},e=e.reduce(function(e,t){return n[t.id]||(n[t.id]=e.push(t)),e},[]);e.forEach(function(e){e.id&&1<e.id.split("_").length&&e.id.split("_")[1]&&(e.id=e.id.split("_")[1],e.pid=e.pid.split("_")[1],e.children)&&0<e.children.length&&e.children.forEach(function(e){e.id=1<e.id.split("_").length?e.id.split("_")[1]:e.id.split("_")[0],e.pid=(e.pid.split("_").length,e.pid.split("_")[1])})}),window.GLOBAL.personAddList=e,this.$emit("select",e),this.$emit("addPerson"),this.$forceUpdate()}},watch:{searchValue:function(e){var t=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e?t.onSearch(e):t.getUserBySearchValue=[]},500)}}},function(){var n=this,s=n._self._c;return s("div",{attrs:{id:"searchUserList"}},[s("form",{attrs:{action:"/"}},[s("van-search",{ref:"inputVal",attrs:{"show-action":"",autofocus:"",shape:"round",placeholder:"搜索"},on:{search:n.onSearch,cancel:n.onCancel},model:{value:n.searchValue,callback:function(e){n.searchValue=e},expression:"searchValue"}})],1),n._v(" "),0<n.getUserBySearchValue.length?s("div",{staticClass:"dsf-tree",staticStyle:{width:"100%",height:"100%"}},n._l(n.getUserBySearchValue,function(t,e){return s("div",{key:"index"+e},[s("div",{staticClass:"person",style:{"padding-left":"30px"}},[s("div",{staticClass:"flex-box person_child"},[s("van-checkbox",{staticClass:"child_check",attrs:{"icon-size":"16px"},on:{click:function(e){return n.userClick(t)}},model:{value:t.checked,callback:function(e){n.$set(t,"checked",e)},expression:"cell.checked"}},[s("div",{staticClass:"user-logo"},[s("i",{staticClass:"icon iconfont icontouxiang"})]),n._v(" "),s("div",{staticClass:"user-name"},[n._v(n._s(t.showName||t.name))]),n._v("\n                          \n                        "),s("div",{staticClass:"user-dept"},[n._v(n._s(t.DeptName))])])],1)])])}),0):n._e(),n._v(" "),0==n.getUserBySearchValue.length&&0<n.searchValue.length?s("commonempty",{attrs:{description:"暂无人员"}}):n._e(),n._v(" "),s("van-tabbar",[s("van-tabbar-item",{staticClass:"_btns"},[s("van-button",{attrs:{type:"default"},on:{click:n.onCancel}},[n._v("取消")]),n._v(" "),s("van-button",{attrs:{type:"info"},on:{click:n.onBtnOk}},[n._v("确定")])],1)],1)],1)},[],!1,null,"d0917fe8",null).exports,b=n(25108);function x(e,t){var n,s,i,o,a=void 0!==y()&&e[w()]||e["@@iterator"];if(a)return s=!(n=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){s=!0,i=e},f:function(){try{n||null==a.return||a.return()}finally{if(s)throw i}}};if(Array.isArray(e)||(a=function(e,t){var n;if(e)return"string"==typeof e?L(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?m()(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var S={name:"DsfSelectPerson",components:{controlUserSearchList:S,controlUserChecked:D.default,addTree:_},props:["type","extra","selectPersons","Multiplayer","selectIndexUserList"],data:function(){return{show:!0,selectList:[],personSelectData:"",oldV:[],param:{allowEdit:!1,containUnit:"-1",data:"",displayFullPath:"-1",fullOrganize:!1,key:"C-RC-0008",multiple:!0,roles:"",rootObject:"2",schema:"",separator:",",tabs:[{key:"self_org",list:[{key:"department",name:"本机构"}],name:"本单位"}],title:"选择参与人员",type:"userselect",types:["person","department","post"],typesString:"person,department,post",value:""},selectArr:[],selectper:[],selectIdArr:[],pk:"",searchValue:"",showSearch:!1,showSearchBox:!1,checkPopup:!1,personAddList:[]}},created:function(){var t=this;window.GLOBAL={},this.extra&&(this.pk=this.extra.pk),this.selectPersons?this.personSelectData=JSON.parse(p()(this.selectPersons)):this.getPersonList(this.param),this.selectIndexUserList&&(this.selectList=this.selectIndexUserList,this.selectList.forEach(function(e){1!=e.Type&&2!=e.Type||t.selectArr.push(e)})),window.GLOBAL.selectType=this.type,window.GLOBAL.personMultiple=this.Multiplayer,window.GLOBAL.renderList||(window.GLOBAL.renderList=[])},mounted:function(){b.log(this.selectPersons)},methods:{showCheckUsers:function(){this.checkPopup=!0},changeData:function(e){this.selectArr=e;var t=[];this.selectList.forEach(function(e){0==e.Type&&t.push(e)}),this.selectList=[],this.selectList=e.concat(t),b.log("数据改变",this.selectArr),b.log("数据改变",this.selectList)},close:function(e){this.checkPopup=e},onSearch:function(e){this.showSearch=!0},onSearchClose:function(){this.showSearch=!1},getPersonList:function(e){var t=dsf.layer.loading("获取中"),n=this,s="fn/mobileToDo/getDingUsersByToDo?pk=".concat(this.pk);dsf.http.post(s).then(function(e){n.personSelectData=e.data.data.codeList,n.personSelectData[0].children.length||n.$emit("close"),n.personSelectData.forEach(function(e){n.addPersonDeep(e,1)}),n.personSelectData.forEach(function(e){e.checked=!1}),n.personSelectData[0].children.forEach(function(e){e.type=1,e.checked=!1})}).finally(function(){n.$nextTick(function(){dsf.layer.closeLoading(t)})})},addPersonDeep:function(e,t){var n=this;this.$set(e,"deep",t),this.$set(e,"isopen",t<=1),e.children&&0<e.children.length&&e.children.forEach(function(e){n.addPersonDeep(e,t+1)})},addPerson:function(){var e,t,s=this,n=[],i=[],o=[],a=(this.selectArr=[],this.selectList.forEach(function(n){n.children&&0<n.children.length&&0<n.children[0].children.length?s.selectArr=(0,k.Z)(s.selectArr):n.children&&0<n.children.length?n.children.forEach(function(n){n.checked?s.selectArr.push(n):s.selectArr.forEach(function(e,t){e.showName==n.showName&&s.selectArr.splice(t,1)})}):n.checked?s.selectArr.push(n):s.selectArr.forEach(function(e,t){e.showName==n.showName&&s.selectArr.splice(t,1)})}),{}),r=(this.selectArr=this.selectArr.reduce(function(e,t){return"2"==t.Type?a[t.id+t.DeptID+t.RoleID]||(a[t.id+t.DeptID+t.RoleID]=e.push(t)):a[t.id+t.DeptID]||(a[t.id+t.DeptID]=e.push(t)),e},[]),x(this.selectArr));try{for(r.s();!(t=r.n()).done;){var l=t.value;n.push(l.showName),i.push(l.attrs.idValue),o.push(l.type+"::"+l.attrs.idValue)}}catch(e){r.e(e)}finally{r.f()}e=n.join(","),i.join(","),o.join(","),this.person=e,this.show=!1,this.oldV=this.selectList,this.cancePerson(!1),b.log("最终选择=====>",this.selectArr),this.$emit("secOk",this.selectArr)},cancePerson:function(e){e&&(e=m()(new(v())(window.GLOBAL.renderList.map(function(e){return p()(e)}))).map(function(e){return JSON.parse(e)}),this.$emit("secOk",e)),this.$emit("cancePerson")},loopPersonAdd:function(e,t){var n=this;e.children instanceof Array&&e.children.forEach(function(t){t.checked=!1,"2"==t.Type?-1<n.selectList.findIndex(function(e){return e.id==t.id&&e.DeptID==t.DeptID&&e.RoleID==t.RoleID})&&(t.checked=!0):-1<n.selectList.findIndex(function(e){return e.id==t.id&&e.DeptID==t.DeptID})&&(t.checked=!0),0<t.children.length&&n.loopPersonAdd(t)})},getSelect:function(e){var t,n=this,s=this;for(t in s.selectList=[],e)s.selectList.push(e[t]);s.personSelectData.forEach(function(e){e.children.forEach(function(e){n.loopPersonAdd(e,s.selectList)})}),this.selectArr=[],this.selectList.forEach(function(e){0!=e.Type&&e.id&&n.selectArr.push(e)})},userClick:function(e){this.$refs.addTree.userClick(e)}}},D=(0,s.Z)(S,function(){var t=this,e=t._self._c;return e("div",{staticClass:"dsf-select-person"},[t.showSearch?t._e():e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{placeholder:"搜索"},on:{click:t.onSearch},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1),t._v(" "),t.showSearch?e("div",[e("control-user-search-list",{attrs:{selectper:t.selectArr,personSelectData:t.personSelectData},on:{searchClose:t.onSearchClose,select:t.getSelect,addPerson:t.addPerson}})],1):e("div",{staticClass:"tabs"},[e("add-tree",{ref:"addTree",staticClass:"_add_tree",attrs:{personSelectData:t.personSelectData,type:t.type,multiple:t.Multiplayer},on:{select:t.getSelect}}),t._v(" "),e("div",{staticClass:"foot"},[e("div",{staticClass:"tree_l",on:{click:t.showCheckUsers}},[e("span",[t._v("已选择："+t._s(t.selectArr.length)+"人")]),t._v(" "),e("van-icon",{directives:[{name:"show",rawName:"v-show",value:0<t.selectArr.length,expression:"selectArr.length > 0"}],staticClass:"tree_icon",attrs:{size:"0.32rem",name:"arrow-up"}})],1),t._v(" "),e("van-button",{attrs:{type:"default"},on:{click:function(e){return t.cancePerson(!0)}}},[t._v("取消")]),t._v(" "),e("van-button",{attrs:{type:"info"},on:{click:t.addPerson}},[t._v("确定")])],1),t._v(" "),e("van-popup",{style:{height:"90%"},attrs:{round:"",position:"bottom"},model:{value:t.checkPopup,callback:function(e){t.checkPopup=e},expression:"checkPopup"}},[e("control-user-checked",{attrs:{"select-arr":t.selectArr,commonGroup:[],orgType:!1,fromSend:!0,"person-add-list":t.personAddList},on:{close:t.close,changeData:t.changeData,onChangePerson:function(e){return t.personAddList=e}}})],1)],1)])},[],!1,null,"67deae7a",null).exports,_=n(18868),S=n(23501),C=n(69751),P=n(25108),c={name:"sendFile",components:{enclosureItem:c.Z,EnclosurePre:a.default,secPerson:D,DebounceClick:_.Z,hw:S.Z,hwJG:C.default,idealEdit:g.Z},props:{formData:{type:Object,default:function(){return{}}},formMeta:{type:Object,default:function(){return{}}},formParams:{type:Object,default:function(){return{}}},currentOpintion:{type:String,default:null},sendFileOpintion:{type:String,default:null},isShowWriteOpintionBtn:{type:Boolean,default:!1},sendParameters:{type:Object,default:function(){return{}}},currentAction:{type:String,default:""}},data:function(){var e;return{popTitle:"发送",cancalName:"保存",submitName:"发送",checked:!1,showDialog:!1,deptAndUsers:[],defaultIcon:n(47122),tags:["已阅。","同意。","阅。"],value:dsf.config.setting["SYS-MOBILE-FORM-0009"]||"",fileUrl:"",checkedUserList:[],checkedNodeIndex:-1,Response:{},node_list:[],filelistArr:[],nowNodeType:"normal",nodeIsyu:!1,lineNum:0,default_img:'this.src="'+n(5692)+'"',showSelect:!1,selectPersons:[],selectIndex:null,Multiplayer:null,lineData:null,imgUrl:"",showWrite:!1,isShowSignBtn:!1,errorMessage:"",isShowSmsBox:!1,smsContent:"",showMore:!1,havetoHandWrite:dsf.config.setting["SYS-MOBILE-FORM-0011"]||"-1",showContent:!1,smsResult:[],smsMethodRange:[{text:"短信提醒",value:1}],AgainClickArr:[],userCurDeptName:"",showIdeal:!1,lineIds:"",showCalendar:!1,showPicker:!1,currentLine:null,currentTime:"",currentDate:new Date,mj:0,isSecret:0,selectIndexUserList:"",isShowFuyan:"1"==dsf.config.setting["p2512-handleTip-mode"],fuyan:"",fuyanRadio:0,nodeDisplayType:null==(e=dsf.config.commonFlow)?void 0:e.nodeDisplayType,base64Img:"",isHideCancelBtn:null==(e=dsf.util.loadSessionStore("user").privileges)?void 0:e.some(function(e){return"禁用表单意见暂存"==e.name})}},computed:{tempTags:function(){return this.showMore?this.tags:this.tags.slice(0,2)},isShowDefaultUser:function(){return!(0==dsf.config.commonFlow.sendNeedDefaultUser)},getHW_Type:function(){return dsf.config.setting.hasOwnProperty("SYS-MOBILE-FORM-0003")&&dsf.config.setting["SYS-MOBILE-FORM-0003"]||"self"},batchSend:function(){return!!this.formData.batchSend}},watch:{showDialog:function(e,t){var n=this;e&&(this.imgUrl="",this.getFlowNodes(),dsf.config.commonFlow.isDefaultShowOpinition&&this.getDefaultOpinition(),this.$nextTick(function(){n.sendFileOpintion&&n.sendFileOpintion.length&&n.$refs.idealEdit&&(n.$refs.idealEdit.value=n.sendFileOpintion)}))},currentOpintion:{handler:function(e,t){var n=this;this.$nextTick(function(){e&&n.$refs.idealEdit&&(n.$refs.idealEdit.value=e)})},immediate:!0}},created:function(){dsf.config.commonFlow.sendBtnSetting&&(this.cancalName=dsf.config.commonFlow.sendBtnSetting.cancelName,this.popTitle=this.submitName=dsf.config.commonFlow.sendBtnSetting.submitName),dsf.config.commonFlow.hasOwnProperty("showOpinitonText")||(dsf.config.commonFlow.showOpinitonText=!1)},mounted:function(){this.getSineStatus()},methods:{goback:function(){this.showSelect?(P.log("关闭了选人"),this.showSelect=!1,this.showDialog=!0):this.$parent.$parent.showPopUp&&(P.log("关闭了节点"),this.$parent.$parent.showPopUp=!1)},getDefaultOpinition:function(){var n=this;dsf.http.post("fn/mobileFormComment/getH5CurrentComment",{pk:this.formData.info_id||this.formData.infoId||this.formMeta.parameters.pk,pid:this.formData.pid||this.formMeta.parameters.pId,pnid:this.formData.pnid||this.formMeta.parameters.pnId,moduleId:this.formData.moduleId||this.formMeta.parameters.moduleId}).then(function(e){var t,e=e.data;null!=(t=e.data)&&null!=(t=t.opinion)&&t.length&&(n.$refs.idealEdit.value=e.data.opinion),e.data.handWritePic&&(n.imgUrl=dsf.url.getServerUrl("fn/file/downloadFile?fileName=".concat(e.data.handWritePic)))})},getSineStatus:function(){var t=this;dsf.config.commonFlow&&dsf.config.commonFlow.nodeNeedSignBtn&&dsf.http.post("fn/opinionSignCheck/mobileControlCheck",{todoId:this.formData.todoId||this.formParams.todoId,nodeName:this.formData.nodeName||this.formMeta.parameters.nodeName,pk:this.formData.info_id||this.formData.infoId||this.formParams.pk}).then(function(e){e=e.data;e.data.checkVal&&(t.isShowSignBtnBox=!0,t.isShowSignBtn=1==e.data.checkVal)}).catch(function(e){P.log(e),dsf.layer.toast("获取签名状态失败")})},handleSign:function(){var t=this;dsf.http.post("fn/opinionSignCheck/todoUpdSign",{pid:this.formData.pid,pnid:this.formData.pnid,isSign:this.isShowSignBtn?1:0,pk:this.formData.info_id||this.formData.infoId}).then(function(e){e=e.data;dsf.layer.toast(e.message),t.isShowSignBtn=!t.isShowSignBtn}).catch(function(e){P.log(e),dsf.layer.toast("操作失败")})},openWritePopup:function(){this.showWrite=!0,"jg"==this.getHW_Type&&this.$refs.HWJG.buttonHWClick()},delHandWrite:function(){var t=this;dsf.http.post("fn/mobileHandWritingData/delete?pnid=".concat(this.formData.pnid,"&pid=").concat(this.formData.pid)).then(function(e){e.data.result&&(t.imgUrl="")})},closeWritePopup:function(e){e?(this.showWrite=!1,e&&(this.imgUrl=e)):(this.imgUrl="",this.delHandWrite(),this.showWrite=!1)},initCheckUser:function(){var s=this;if(this.deptAndUsers&&0<this.deptAndUsers.length)try{this.deptAndUsers.forEach(function(e,n){if("1"==e.IsAutoSend)return!1;if(!e.checked)return!1;try{e.secHeadInfo=[],e.headInfo.forEach(function(t){if(("1"==t.Selected||"2"==t.Selected)&&(("showSimple"==s.nodeDisplayType||3<e.headInfo.length)&&e.secHeadInfo.push(t),e.checkedUserList.find(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID})||(s.$set(t,"checked",!0),e.checkedUserList.push(t),s.checkedNodeIndex=n),0==e.Multiplayer))throw new Error})}catch(e){P.log("跳出循环",e)}0==e.secHeadInfo.length&&delete e.secHeadInfo})}catch(e){P.log("跳出循环",e)}},secOk:function(e){var n=this,s=this.deptAndUsers[this.selectIndex],i=(s.checkedUserList=[],[]);0<e.length?(s.headInfo.forEach(function(e,t){e.checked=!1}),e.forEach(function(e,t){e.checked=!1,i.push(e),n.checkUser(e,s)}),s.secHeadInfo=i):(s.headInfo.forEach(function(e,t){e.checked=!1}),delete s.secHeadInfo)},showSecPerson:function(s,i){var o=this;return(0,f.Z)(h().mark(function e(){var t,n;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&(o.checkedNodeIndex=i),o.$parent.$parent.spHandleJS&&o.$parent.$parent.spHandleJS.checkNodeFilter){if(e.prev=2,o.$route.name.includes("commonForm"))return e.next=6,o.$parent.$parent.spHandleJS.checkNodeFilter(o.$parent.$parent.formData,o.formMeta,o.$parent.$parent,s);e.next=8}else e.next=16;break;case 6:e.next=10;break;case 8:return e.next=10,o.$parent.$parent.spHandleJS.checkNodeFilter(o.formData,o.$parent.$parent,s);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(2),P.log(e.t0),e.abrupt("return");case 16:o.nodeIsyu||i!=o.selectIndex&&o.checkNode(i,"man",!0),t=JSON.parse(p()(o.node_list[s.originalIndex].SendRangeTree.Node)),n={attrs:{noselect:!0},id:"",isopen:!1,checked:!1,hideCheckAll:"7"==o.lineData[s.originalIndex].NodeType,showName:o.lineData[s.originalIndex].ShowName},o.mapTree(t,s.checkedUserList),Array.isArray(t)?n.children=t:n.children=[t],o.selectPersons=[n],o.Multiplayer=0<s.Multiplayer,s.headInfo.forEach(function(e,t){e.showName=e.UserName,e.attrs={},e.children=[]}),o.selectIndex=i,o.selectIndexUserList=o.deptAndUsers[i].checkedUserList,o.showSelect=!0;case 27:case"end":return e.stop()}},e,null,[[2,12]])}))()},getDefaultCheckTreeNode:function(t,e){var n=!1;return"2"==t.Type?-1<e.findIndex(function(e){return e.id==t.id&&e.DeptID==t.DeptID&&e.RoleID==t.RoleID})&&(n=!0):-1<e.findIndex(function(e){return e.id==t.id&&e.DeptID==t.DeptID})&&(n=!0),n},mapTree:function(e,t){var n=this;e instanceof Array?e.forEach(function(e){e.checked=n.getDefaultCheckTreeNode(e,t),e.showName=e.name,e.attrs={noselect:!0},e.Node?e.Node instanceof Array?(n.mapTree(e.Node,t),n.$set(e,"isopen",!1),e.children=e.Node):(n.mapTree(e.Node,t),n.$set(e,"isopen",!1),e.children=[e.Node]):(e.attrs={noselect:!1},e.children=[])}):(e.checked=this.getDefaultCheckTreeNode(e,t),e.showName=e.name,e.attrs={noselect:!0},e.Node?e.Node instanceof Array?(this.mapTree(e.Node,t),this.$set(e,"isopen",!1),e.children=e.Node):(this.mapTree(e.Node,t),this.$set(e,"isopen",!1),e.children=[e.Node]):(e.attrs={noselect:!1},e.children=[]))},cancel:function(){this.showDialog=!1,this.showContent=!1,this.selectIndex=null;var e=this.$refs.idealEdit?this.trimTip(this.$refs.idealEdit.value):"";this.$emit("close",e),this.$refs.idealEdit&&(this.$refs.idealEdit.value="")},show:function(e){"isList"==e&&this.$refs.idealEdit&&(this.$refs.idealEdit.value=""),this.showDialog=!0},deleteUser:function(e,t){t.headInfo.splice(e,1)},getFavicon:function(e){return e.Photo?dsf.url.getWebPath("/fn/mobilePhoto/download?id=".concat(e.id,"&time=").concat((new Date).getTime())):n(5692)},getfileList:function(){var t=this,e={info_id:this.formData.id,infoId:this.formData.id,moduleId:this.formData.moduleId,nodeId:"",start:1,limit:100},c=dsf.util.loadSessionStore("loginToken");this.filelistArr=[],dsf.http.post("/fn/mobileAttachment/getFormAttachment",e).then(function(e){var l;e&&e.data&&e.data.rows&&(l=(new Date).getTime(),e.data.rows.forEach(function(e){var r=[];e.document?(e.document.forEach(function(e){var t=e.id,n=e.infoId,s=e.title,i=e.type,o=e.moduleId,a=e.showFileSize,e=e.isHandwrite,a={id:t,title:s,size:a||"",url:dsf.url.openOffice(encodeURIComponent(dsf.url.getServerUrl("fn/file/download?infoId=".concat(n,"&fileId=").concat(t,"&fileName=").concat(s,"&nrType=").concat(i,"&moduleId=").concat(o,"&x-auth-token=").concat(c,"&fullfilename=").concat(l).concat(s)))),infoId:n,moduleId:o,isHandwrite:e};r.push(a)}),e.file=r):e.file=[],e.file&&e.file.length||0<e.canEdit?e.show=!0:e.show=!1}),t.filelistArr=e.data.rows)})},checkNextDb:function(t){var e=this.$store.state.searchParam;e.dataIndex=this.$route.query.dataIndex||0,P.log(e),dsf.http.post("/fn/mobileToDo/getToDoByIndex",e).then(function(e){P.log(e.data.data),e&&e.data&&e.data.data?(e=e.data.data,t({path:"/commonForm/".concat(e.moduleId,"/").concat(e.info_id,"/1?type=gw&todoId=").concat(e.todoId),hasData:!0})):t({hasData:!1})})},goBackList:function(){var e=this;this.$emit("change",this.lineIds),setTimeout(function(){e.$emit("close"),e.$emit("golist")},500)},sendAfterAction:function(e){this.lineIds=e||"";var t=this;this.$refs.idealEdit&&(this.$refs.idealEdit.value=""),t.closePop(),"copyOpinion"==this.currentAction||"xform.copySend"==this.currentAction?this.$emit("initData"):(e=dsf.util.loadLocalStore("actionType")||"1",dsf.config.commonForm.showFormSetting&&"commonForm"==this.$route.name&&this.$route.query.type&&"gw"==this.$route.query.type?"0"==e||"1"==e?t.goBackList():"2"==e?t.checkNextDb(function(e){e.hasData?(t.$router.replace({path:e.path}),t.$eventBus.refresh(t)):t.goBackList()}):t.checkNextDb(function(e){e.hasData?(t.curPath=e.path,t.$emit("showNext",e.path)):t.dsf.layer.toast("文件已办理完毕",!0,function(){t.goBackList()})}):"1"==t.sendParameters.sendToNext?dsf.http.post("/fn/mobileToDoAndRead/getToDoAndReadList2",{limit:10,_content:"",key:"",page:1,showTotal:!0,fileType:"gw",isFirst:1,start:1}).then(function(e){P.log(e),e&&e.data&&e.data.datas&&(0<(e=e.data.datas.filter(function(e){return"-1"!=e.dataValue.allowMobile})).length?(t.$router.replace({path:"/commonForm/".concat(e[0].dataValue.moduleId,"/").concat(e[0].dataValue.info_id,"/1?type=gw&todoId=").concat(e[0].dataValue.todoId)}),t.$eventBus.refresh(t)):t.goBackList())}):t.goBackList())},getFlowNodes:function(){this._loading=dsf.layer.loading();var i=this,e=(P.log(i),{type:this.formData.sendType||this.formData.type||"SR_SEND",pid:this.formData.pid,pnid:this.formData.pnid,wfId:this.formData.flowId,infoId:this.formData.info_id||this.formData.infoId,bt:this.formData.bt,moduleName:this.formData.moduleName,moduleId:this.formData.moduleId}),t=(this.formData.opinionContent&&(e.opinionContent=this.formData.opinionContent),this.checkOpinion("notip")||(e.disableAutoSend=1),0<this.formData.opinionRequired&&(e.ignoreOpinion=1),this.formData.nextLineId&&(e.nextLineId=this.formData.nextLineId),this.formData.direction&&(e.direction=this.formData.direction),this.formData.determineUser&&(e.determineUser=this.formData.determineUser),this.formData.nextNodeId&&(e.nextNodeId=this.formData.nextNodeId),null!=this.formData.endOtherLink&&(e.endOtherLink=this.formData.endOtherLink),null!=this.formData.isBackTrack&&(e.isBackTrack=this.formData.isBackTrack),null!=this.formData.intelligenceSend&&(e.intelligenceSend=this.formData.intelligenceSend),null!=this.formData.disableAutoSend&&(e.disableAutoSend=this.formData.disableAutoSend),null!=this.formData.disableAutoSend4EndNode&&(e.disableAutoSend4EndNode=this.formData.disableAutoSend4EndNode),null!=this.formData.agencyType&&(e.agencyType=this.formData.agencyType),null!=this.formData.sendUserId&&(e.sendUserId=this.formData.sendUserId,e.sendUserName=this.formData.sendUserName,e.sendDeptId=this.formData.sendDeptId,e.sendDeptName=this.formData.sendDeptName),"/fn/mobileFlow/getFlowNode");this.formData.hasControlOpinionTagView||(t+="?likeAndBranch=1"),this.deptAndUsers=[],dsf.http.post(t,e).then(function(e){if(P.log(e),e.data.data){var t,n=e.data.data.ResponseObject[0].Status,s=e.data.data.ResponseObject[0].NextNodes;if(i.mj=e.data.data.ResponseObject[0].mj,i.isSecret=e.data.data.ResponseObject[0].isSecret,-1<n.indexOf("2000"))i.dsf.layer.toast("流程发送出错，请检查配置!",void 0,function(){i.sendAfterAction()});else if(-1<n.indexOf("6000"))i.dsf.layer.toast("该文件已办理完毕",!0,function(){i.sendAfterAction()});else if(-1<n.indexOf("1000")||-1<n.indexOf("5000")||-1<n.indexOf("5100"))dsf.layer.closeLoading(i._loading),1==s.Line.length&&2==s.Line[0].nodeType?i.dsf.layer.toast("该文件已办理完毕",!0,function(){i.sendAfterAction()}):s.Line.length&&(t="",s.Line.forEach(function(e){e.RecipientList&&e.RecipientList.Node&&(t+=i.getAutoSendNodeMessage(e.RecipientList))}),t.length&&!dsf.config.commonForm.sendWithNoTips?-1!=dsf.config.setting["SYS-FLOW-0005"]?(u.Z.alert({title:"该文件已成功发送至",message:t}),setTimeout(function(){u.Z.close(),i.sendAfterAction()},3e3)):(dsf.layer.toast("发送完成",!0),i.sendAfterAction()):i.dsf.layer.toast("该文件已办理完毕",!0,function(){i.sendAfterAction()}));else if("90000"==n)i.dsf.layer.toast(e.data.data.ResponseObject[0].ErrorMessage,void 0,function(){i.sendAfterAction()});else{if(i.$parent.$parent.$refs.sendPop.$el.style.display="block",i.showContent=!0,i.Response=e.data.data.ResponseObject[0],i.node_list=i.Response.NextNodes.Line,i.Response.OutLineType&&"1"==i.Response.OutLineType?i.nodeIsyu=!0:i.nodeIsyu=!1,i.lineData=i.node_list,1==i.lineData.length&&"1"==i.lineData[0].IsAutoSend){if(i.checkOpinion("notip"))return i.autoSend(i.lineData[0].LineID),void dsf.layer.closeLoading(i._loading);i.lineData[0].IsAutoSend="-1"}1<i.lineData.length&&i.lineData.forEach(function(e){return e.IsAutoSend="-1"}),i.lineData.forEach(function(t,e){i.lineNum++,"2"!=t.NodeType&&t.TimeType&&t.TimeSpan&&1==dsf.config.setting["SYS-FLOW-0047"]&&dsf.http.post("fn/flow/timeLimit",{timeType:t.TimeType,timeSpan:t.TimeSpan}).then(function(e){"200"==e.data.code&&(t.TimeLimit=e.data.data)}),"0"!=t.NodeType&&"1"!=t.NodeType&&"7"!=t.NodeType||"1"==t.IsAutoSend?(i.lineNum--,i.checkedNodeIndex=1==i.lineData.length&&2==t.NodeType?e:i.checkedNodeIndex,i.deptAndUsers.push({nodeID:t.NodeID,title:t.ShowName,lineID:t.LineID,IsAutoSend:t.IsAutoSend,nodeType:t.NodeType,num:"0人审批",headInfo:[],isAdd:!1,checked:1==i.lineData.length&&2==t.NodeType,Multiplayer:0,originalIndex:e,checkedUserList:[],TimeLimit:t.TimeLimit,Require:t.Require})):i.getFlowNodeUserByNodeInfo(t,e)}),i.userCurDeptName=e.data.data.userCurDeptName,-1!=e.data.data.isSms&&(i.isShowSmsBox=!0,i.smsContent=e.data.data.sms,e.data.data.smsMethodRange?(i.smsMethodRange=e.data.data.smsMethodRange,i.smsMethodRange.forEach(function(e){e.checked&&i.smsResult.push(e.value)})):dsf.config.commonFlow.defaultSendSms&&i.smsResult.push(1)),1==i.deptAndUsers.length&&3==i.deptAndUsers[0].nodeType&&i.checkNode(0,"man",!1),i.$nextTick(function(){i.initCheckUser(),dsf.layer.closeLoading(i._loading)})}}else dsf.layer.toast(e.data.message,!1,function(){i.closePop()})}).catch(function(e){P.log(e),dsf.layer.closeLoading(i._loading)})},getFlowNodeUserByNodeInfo:function(e,t){var n,s,i,o=this;e&&(n=[],s=[],i=[],e.SendRangeTree&&((new Array).concat(e.SendRangeTree.Node).map(function(e,t){i=i.concat(m()(new(v())(o._initUserlist(e,n)))),i=m()(new(v())(i))}),P.log(i.filter(function(e){return"1"==e.Selected||"2"==e.Selected}).length),s.push({nodeID:e.NodeID,title:e.ShowName,num:"0人审批",lineID:e.LineID,headInfo:i,nodeType:e.NodeType,isAdd:!1,checked:1==o.lineData.length,Multiplayer:e.Multiplayer.IsEnabled,originalIndex:t,checkedUserList:[],TimeLimit:e.TimeLimit,Require:e.Require}),i.filter(function(e){return"1"==e.Selected||"2"==e.Selected}).length&&(o.checkedNodeIndex=t),o.deptAndUsers=m()(new(v())(o.deptAndUsers.concat(s))),P.log(o.deptAndUsers)),o.lineNum--)},getFlowNodeUsers:function(e,a,t){var r=this,e={sendRequestID:r.Response.SendRequestID,lineIDs:e||"",pk:this.formData.info_id||this.formData.infoId||this.formMeta.parameters.pk,moduleId:this.formData.moduleId,flowId:this.formData.flowId,nodeId:this.formData.nodeId,pId:this.formData.pid,pnId:this.formData.pnid};dsf.http.post("/fn/mobileFlow/getFlowNodeUserByNode",e).then(function(e){if(e.data.result){e.data.data[0].status;var o=!1;if(a){var t,n,s,i=e.data.data[0].status;if(-1<i.indexOf("1000")||-1<i.indexOf("5000")||-1<i.indexOf("5100")||-1<i.indexOf("6000"))return t=e.data.data[0].RecipientList,n=null==(n=e.data.data[0].SendRangeTree)?void 0:n.Node,void(t||n?(s="",(s=t?r.getAutoSendNodeMessage(t):r.getAutoSendNodeMessage(n)).length&&!dsf.config.commonForm.sendWithNoTips&&(-1!=dsf.config.setting["SYS-FLOW-0005"]?(u.Z.alert({title:"该文件已成功发送至",message:s}).then(function(){r.sendAfterAction()}),setTimeout(function(){u.Z.close(),r.sendAfterAction()},3e3)):(dsf.layer.toast("发送完成",!0),r.sendAfterAction()))):(r.dsf.layer.toast("发送成功",!0),r.sendAfterAction()));if(!(-1<i.indexOf("4000")))return void r.dsf.layer.toast("自动发送失败");o=!0}e.data.data.forEach(function(e,t){o&&(e.IsAutoSend="-1");var n=[],s=[],i=[];"1"==e.NodeType&&"1"!=e.IsAutoSend?(""==e.SendRangeTree&&(e.SendRangeTree={Node:[]}),(new Array).concat(e.SendRangeTree.Node).map(function(e,t){i=i.concat(m()(new(v())(r._initUserlist(e,n)))),i=m()(new(v())(i))}),s.push({nodeID:e.NodeID,title:e.ShowName,num:"0人审批",headInfo:i,lineID:e.LineID,nodeType:e.NodeType,isAdd:!1,checked:!!i.filter(function(e){return"1"==e.Selected||"2"==e.Selected}).length,Multiplayer:e.Multiplayer.IsEnabled,originalIndex:t,checkedUserList:[],Require:e.Require}),r.deptAndUsers=m()(new(v())(r.deptAndUsers.concat(s)))):r.deptAndUsers.push({nodeID:e.NodeID,title:e.ShowName,lineID:e.LineID,IsAutoSend:e.IsAutoSend,nodeType:e.NodeType,num:"0人审批",headInfo:[],isAdd:!1,checked:!1,Multiplayer:0,originalIndex:t,Require:e.Require})}),r.initCheckUser(),r.lineData=e.data.data}else dsf.layer.toast(e.data.message)})},_initUserlist:function(e,t){var n=this;return e.UserID||e.RoleID&&"2"==e.Type?t.push(e):e.Node instanceof Array?e.Node.map(function(e){n._initUserlist(e,t)}):e.Node?this._initUserlist(e.Node,t):P.log("空部门"),m()(new(v())(t))},autoSend:function(e){this.checkOpinion()&&(dsf.config.commonFlow&&dsf.config.commonFlow.needHandWrite&&0<this.formData.allowEditOpinion&&1==this.havetoHandWrite&&!this.imgUrl?dsf.layer.toast("请签名",!1):this.getFlowNodeUsers(e,!0))},sendFlow:function(a){var r=this;return(0,f.Z)(h().mark(function e(){var n,s,i,t,o;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.$parent.$parent.spHandleJS.beforeRealSend)return e.next=3,r.$parent.$parent.spHandleJS.beforeRealSend(a.nodeInfo,r.$parent.$parent);e.next=3;break;case 3:if(i=!(s=[]),(n=r).node_list.map(function(n){i="2"==n.NodeType,a.nodeInfo.forEach(function(e){var t;n.ShowName==e.title&&(t=[],t=e.checkedUserList,n.RecipientList={},n.RecipientList.Node=i?[]:t,n.TimeLimit=e.TimeLimit,s.push(n))})}),s.forEach(function(e){e.SendMode=e.Multiplayer.SendMode,e.exInfo="",e.RangeRule={},e.SendRangeTree={}}),t={ResponseObject:{SendRequestID:n.Response.SendRequestID,SendParams:{isSms:n.smsResult.length?n.smsResult.join(","):-1,sms:n.smsResult.length?n.smsContent:"",Line:s}}},n.batchSend)return dsf.layer.closeLoading(n._loadingSend),n.$emit("firstBatchSend",s),e.abrupt("return");e.next=13;break;case 13:o={__DATA:p()(t),pk:r.formData.info_id||r.formData.infoId||r.formMeta.parameters.pk,moduleId:r.formData.moduleId,flowId:r.formData.flowId,nodeId:r.formData.nodeId,pId:r.formData.pid,pnId:r.formData.pnid},dsf.http.post("/fn/mobileFlow/sendFlow",o).then(function(e){var t;dsf.layer.closeLoading(n._loadingSend),e.data&&e.data.result?(dsf.layer.toast("发送成功",!0),t=s.map(function(e){return e.LineID}),n.sendAfterAction(t)):dsf.layer.toast(e.data.message,!1)}).catch(function(){dsf.layer.closeLoading(n._loadingSend)});case 15:case"end":return e.stop()}},e)}))()},saveOpinion:function(n){var e,s=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=(this._loadingSend=dsf.layer.loading(),this);0<this.formData.allowEditOpinion&&!this.isShowWriteOpintionBtn?(e={__DATA:p()({info_id:this.formData.info_id||this.formData.infoId,pid:new String(this.formData.pid),pnid:new String(this.formData.pnid),opinion:n.contentValue||this.$refs.idealEdit.value,type:"g_inbox"})},dsf.http.post("/fn/mobileSaveOpinion/saveOpinion?flowId=".concat(this.formData.flowId,"&nodeId=").concat(this.formData.nodeId,"&moduleId=").concat(this.formData.moduleId),e).then(function(e){var t;e.data.result?s?(null!=(t=dsf.config.commonFlow)&&t.canSwitchOpinionMode&&"input"==i.$refs.idealEdit.opinionMode&&i.delHandWrite(),i.sendFlow(n)):((n.contentValue||i.sendFileOpintion||i.imgUrl)&&i.$emit("initData"),dsf.layer.closeLoading(i._loadingSend)):i.dsf.layer.toast(e.data.message,!1)}).catch(function(){dsf.layer.closeLoading(i._loadingSend)})):s&&i.sendFlow(n)},checkUser:function(s,i,o,e){var a=this;return(0,f.Z)(h().mark(function e(){var n,t;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o&&0!=o||(a.checkedNodeIndex=o),1==a.isSecret&&s.MJ<a.mj)return dsf.layer.toast("高密级文件不能发送给低密级等级人员"),e.abrupt("return");e.next=4;break;case 4:if("2"==s.Selected)return dsf.layer.toast("必选用户不能删除"),e.abrupt("return");e.next=7;break;case 7:if((n=a).$parent.$parent.spHandleJS&&n.$parent.$parent.spHandleJS.checkNodeFilter){if(e.prev=9,n.$route.name.includes("commonForm"))return e.next=13,n.$parent.$parent.spHandleJS.checkNodeFilter(n.$parent.$parent.formData,n.formMeta,n.$parent.$parent,i);e.next=15}else e.next=23;break;case 13:e.next=17;break;case 15:return e.next=17,n.$parent.$parent.spHandleJS.checkNodeFilter(n.formData,n.$parent.$parent,i);case 17:e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(9),P.log(e.t0),e.abrupt("return");case 23:i.checked||n.deptAndUsers.forEach(function(e,t){e.lineID==i.lineID?(n.$set(e,"checked",!0),n.checkedNodeIndex=t):n.nodeIsyu||"7"!=i.nodeType&&"7"!=e.nodeType&&(n.$set(e,"checked",!1),e.headInfo.forEach(function(e){n.$set(e,"checked",!1)}),e.checkedUserList=[])}),"0"==i.Multiplayer&&0<i.checkedUserList.length&&(!s.checked||void 0===s.checked)&&(i.headInfo.forEach(function(e){n.$set(e,"checked",!1)}),i.checkedUserList=[]),n.$set(s,"checked",!s.checked),s.checked?"2"==s.Type?0!=n.checkedUserList.length&&-1!=n.checkedUserList.findIndex(function(e){return e.UserID==s.UserID&&e.RoleID==s.RoleID&&e.DeptID==s.DeptID})||i.checkedUserList.push(s):i.checkedUserList.find(function(e){return e.UserID==s.UserID&&e.DeptID==s.DeptID})||i.checkedUserList.push(s):(-1<(t=i.checkedUserList.findIndex(function(e){return e.UserID==s.UserID&&e.DeptID==s.DeptID}))&&i.checkedUserList.splice(t,1),0==i.checkedUserList.length&&n.$set(i,"checked",!1)),!a.isShowDefaultUser&&i.secHeadInfo&&(t=i.secHeadInfo.findIndex(function(e){return!e.checked}),i.secHeadInfo.splice(t,1)),n.deptAndUsers.forEach(function(e){!e.checked&&e.secHeadInfo&&n.$delete(e,"secHeadInfo")});case 29:case"end":return e.stop()}},e,null,[[9,19]])}))()},getCheckNum:function(e){var t=0;return e.checked&&e.headInfo.forEach(function(e){e.checked&&t++}),t},getClass:function(e,t){if(!t.checked)return!1;for(var n=!1,s=0;s<t.checkedUserList.length;s++)if("2"==e.Type){if(P.log("item.DeptID==this.checkedUserList[i].DeptID",e.DeptID+","+t.checkedUserList[s].DeptID),e.id==t.checkedUserList[s].id&&e.DeptID==t.checkedUserList[s].DeptID&&e.RoleID==t.checkedUserList[s].RoleID){n=!0;break}}else if(e.id==t.checkedUserList[s].id&&e.DeptID==t.checkedUserList[s].DeptID){n=!0;break}return n},goBackNode:function(){this.node_list=[],this.selectIndex=0,this.deptAndUsers=[],this.checkedUserList=[],this.nowNodeType="normal",this.nodeIsyu=!1,this.getFlowNodes()},getIconClass:function(e){return e.isHaveIcon?e.judge?"_head_img _icon_fault":"_head_img _icon_right":"_head_img"},checkNode:function(a,r,l){var c=this;return(0,f.Z)(h().mark(function e(){var s,t,i,n,o;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(P.log(a),(s=c).checkedNodeIndex=a,t=s.deptAndUsers.find(function(e,t){return a==t}),s.$parent.$parent.spHandleJS&&s.$parent.$parent.spHandleJS.checkNodeFilter&&!l){if(e.prev=5,s.$route.name.includes("commonForm"))return e.next=9,s.$parent.$parent.spHandleJS.checkNodeFilter(s.$parent.$parent.formData,s.formMeta,s.$parent.$parent,t);e.next=11}else e.next=19;break;case 9:e.next=13;break;case 11:return e.next=13,s.$parent.$parent.spHandleJS.checkNodeFilter(s.formData,s.$parent.$parent,t);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(5),P.log(e.t0),e.abrupt("return");case 19:if(t&&"1"==t.IsAutoSend)return"man"==r&&s.autoSend(t.lineID),e.abrupt("return");e.next=22;break;case 22:if(i={},s.nodeIsyu?s.deptAndUsers.forEach(function(n,e){if(a==e)if((i=n).checked)s.$set(n,"checked",!1),n.headInfo.forEach(function(e){s.$set(e,"checked",!1)}),n.checkedUserList=[],delete n.secHeadInfo;else if(s.$set(n,"checked",!0),1==n.headInfo.length)s.$set(n.headInfo[0],"checked",!0),n.checkedUserList=[n.headInfo[0]],n.secHeadInfo=[n.headInfo[0]];else{n.secHeadInfo=[];try{n.headInfo.forEach(function(t,e){if(("1"==t.Selected||"2"==t.Selected)&&(("showSimple"==c.nodeDisplayType||3<n.headInfo.length)&&n.secHeadInfo.push(t),n.checkedUserList.find(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID})||(c.$set(t,"checked",!0),n.checkedUserList.push(t)),0==n.Multiplayer))throw new Error})}catch(e){P.log("跳出循环",e)}0==n.secHeadInfo.length&&delete n.secHeadInfo}}):"7"!=t.nodeType?s.deptAndUsers.forEach(function(n,e){if(a!=e)"7"!=n.nodeType&&(s.$set(n,"checked",!1),n.headInfo.forEach(function(e){s.$set(e,"checked",!1)}),n.checkedUserList=[],delete n.secHeadInfo);else if(i=n,s.$set(n,"checked",!0),1==n.headInfo.length)s.$set(n.headInfo[0],"checked",!0),n.checkedUserList=[n.headInfo[0]],n.secHeadInfo=[n.headInfo[0]];else if(!(0<(null==(e=n.secHeadInfo)?void 0:e.length))){n.secHeadInfo=[];try{n.headInfo.forEach(function(t,e){if(("1"==t.Selected||"2"==t.Selected)&&(("showSimple"==c.nodeDisplayType||3<n.headInfo.length)&&n.secHeadInfo.push(t),n.checkedUserList.find(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID})||(c.$set(t,"checked",!0),n.checkedUserList.push(t)),0==n.Multiplayer))throw new Error})}catch(e){P.log("跳出循环",e)}0==n.secHeadInfo.length&&delete n.secHeadInfo}}):(i=t,s.$set(t,"checked",!0),1==t.headInfo.length&&(s.$set(t.headInfo[0],"checked",!0),t.checkedUserList=[t.headInfo[0]])),"7"==t.nodeType&&(0==s.AgainClickArr.length&&s.deptAndUsers.forEach(function(e,t){s.AgainClickArr.push("2")}),!l&&0<t.checkedUserList.length&&1==s.AgainClickArr[a]&&(s.$set(t,"checked",!1),s.$set(t,"checkedUserList",[]),s.$delete(t,"secHeadInfo"),s.selectIndex=null),l||1!=s.AgainClickArr[a]?(s.$set(t,"checked",!0),s.AgainClickArr[a]=1):(s.$set(t,"checked",!1),t.headInfo.forEach(function(e){s.$set(e,"checked",!1)}),s.AgainClickArr[a]=2)),"3"==i.nodeType&&"auto"!=r)return n="",o=[],s.node_list.forEach(function(e){e.LineID==i.lineID&&((o=e.NextNodes.Line).forEach(function(e,t){n+=e.LineID+","}),s.nodeIsyu=!0)}),e.next=31,s.getFlowNodeUsers(n,!1,a);e.next=35;break;case 31:s.node_list=[],s.deptAndUsers=[],s.nowNodeType="redirect",s.node_list=o;case 35:case"end":return e.stop()}},e,null,[[5,15]])}))()},trimTip:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},checkOpinion:function(e){if(1!=this.formParams.isSign&&this.formParams.sendCheck&&"SR_EXSEND"!=this.formData.sendType)if(this.isShowWriteOpintionBtn){if(this.currentOpintion.length<1&&0<this.formData.opinionRequired)return null==e&&dsf.layer.toast("请填写审批意见",!1),!1}else if(this.$refs.idealEdit&&!this.trimTip(this.$refs.idealEdit.value).length&&this.formData.allowEditOpinion&&0<this.formData.opinionRequired)return null==e&&dsf.layer.toast("请填写审批意见",!1),!(this.errorMessage="请填写审批意见");return!0},sendFileFlow:function(){var n,s,e;this.isShowFuyan&&this.fuyan&&this.saveHandleTip(),this.checkOpinion()&&(dsf.config.commonFlow&&dsf.config.commonFlow.needHandWrite&&0<this.formData.allowEditOpinion&&1==this.havetoHandWrite&&!this.imgUrl?dsf.layer.toast("请签名",!1):(n=!1,s=[],this.deptAndUsers.forEach(function(e,t){"2"!=e.nodeType&&"1"!=e.IsAutoSend||!e.checked||(n=!0),e.checked&&s.push(e)}),(e=this.deptAndUsers.find(function(e){return 1==e.Require&&0==e.checkedUserList.length&&"2"!=e.nodeType}))?dsf.layer.toast("".concat(e.title,"未选中人员"),!1):0!=s.length||n?s.some(function(e){return 0==e.checkedUserList.length})&&!n?dsf.layer.toast("未选中人员",!1):(P.log(this.checkedNodeIndex),P.log(this.deptAndUsers),this.saveOpinion({nodeName:this.deptAndUsers[this.checkedNodeIndex].title,checkedUser:this.checkedUserList,contentValue:this.$refs.idealEdit?this.$refs.idealEdit.value:"",nodeInfo:s})):dsf.layer.toast("未选中发送环节",!1)))},closePop:function(){this.$emit("close"),this.showDialog=!1,this.showContent=!1},getAutoSendNodeMessage:function(e){var n="";return function e(t){t.Node?Array.isArray(t.Node)?t.Node.forEach(e):e(t.Node):n+="".concat(t.DeptName," ").concat(t.UserName||"","\n")}(e),n},timeClick:function(e){this.currentLine=e,this.showCalendar=!0,this.currentLine.TimeLimit&&(this.currentDate=new Date(this.currentLine.TimeLimit.split(" ")[0].replace(/-/g,"/")),this.currentTime=this.currentLine.TimeLimit.split(" ")[1])},onConfirm:function(e){e=dsf.date.format(e,"yyyy-mm-dd"),this.currentLine.TimeLimit=e,this.showPicker=!0},confirmDate:function(e){this.currentLine.TimeLimit+=" "+e,this.showPicker=!1,this.showCalendar=!1},clearDate:function(){this.currentLine.TimeLimit="",this.showCalendar=!1},filter:function(e,t){return"minute"===e?t.filter(function(e){return e%15==0}):t},saveHandleTip:function(){dsf.http.post("fn/flowHandleTip/saveHandleTip",{pnId:this.formData.pnid,handleTipsRange:this.fuyanRadio,handleTip:this.fuyan}).then(function(e){})}}},D=(0,s.Z)(c,function(){var i=this,o=i._self._c;return o("div",{directives:[{name:"show",rawName:"v-show",value:i.showDialog,expression:"showDialog"}],staticClass:"send-file"},[o("van-nav-bar",{attrs:{title:i.popTitle,"left-text":"取消"},on:{"click-left":i.cancel},scopedSlots:i._u([{key:"right",fn:function(){return[i.dsf.config.commonFlow&&i.dsf.config.commonFlow.nodeNeedSignBtn&&i.isShowSignBtnBox?o("div",{staticClass:"flex ac"},[i.isShowSignBtn?o("van-button",{attrs:{type:"info",size:"mini"},on:{click:i.handleSign}},[i._v("签名")]):o("van-button",{attrs:{type:"info",size:"mini"},on:{click:i.handleSign}},[i._v("取消签名")])],1):i._e()]},proxy:!0}])}),i._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:i.showContent,expression:"showContent"}],staticClass:"_content"},[i.userCurDeptName?o("div",{staticClass:"ds_theme_font",staticStyle:{margin:"0.2rem"}},[i._v("\n      所属部门："+i._s(i.userCurDeptName)+"\n    ")]):i._e(),i._v(" "),o("idealEdit",{directives:[{name:"show",rawName:"v-show",value:0<i.formData.allowEditOpinion&&!i.isShowWriteOpintionBtn,expression:"formData.allowEditOpinion > 0 && !isShowWriteOpintionBtn"}],ref:"idealEdit",staticClass:"idealEdit",attrs:{isShowHandWrite:i.dsf.config.commonFlow&&i.dsf.config.commonFlow.needHandWrite,rows:"3"},on:{handWrite:i.openWritePopup},scopedSlots:i._u([{key:"opinionImg",fn:function(){return[i.dsf.config.commonFlow&&i.dsf.config.commonFlow.needHandWrite&&0<i.formData.allowEditOpinion&&!i.isShowWriteOpintionBtn?o("div",{staticClass:"handleWriteBox"},[o("div",{staticClass:"writeContent"},[i.imgUrl?o("img",{style:{width:i.dsf.config.commonFlow.opinionImgWidth||"50%"},attrs:{src:i.imgUrl,alt:""}}):i._e()])]):i._e()]},proxy:!0}])}),i._v(" "),i.isShowFuyan?[o("div",{staticClass:"fuyan"},[o("van-field",{attrs:{label:"附言填写：",placeholder:"请输入附言",type:"textarea",autosize:"",rows:"1"},scopedSlots:i._u([{key:"right-icon",fn:function(){return[o("img",{staticStyle:{width:"0.4rem"},attrs:{src:0==i.fuyanRadio?"static/images/platform/nextNode.png":"static/images/platform/allNode.png",alt:""},on:{click:function(e){i.fuyanRadio=0==i.fuyanRadio?1:0}}})]},proxy:!0}],null,!1,3625057113),model:{value:i.fuyan,callback:function(e){i.fuyan=e},expression:"fuyan"}}),i._v(" "),o("van-radio-group",{attrs:{direction:"horizontal","icon-size":"0.3rem"},model:{value:i.fuyanRadio,callback:function(e){i.fuyanRadio=e},expression:"fuyanRadio"}},[o("van-radio",{attrs:{name:0}},[i._v("仅下一环节可见")]),i._v(" "),o("van-radio",{attrs:{name:1}},[i._v("所有环节可见")])],1)],1)]:i._e(),i._v(" "),o("div",{staticClass:"_send_who"},[o("p",{staticClass:"top_title disfr jsb"},[o("span",[i._v("您即将发给")]),i._v(" "),"redirect"==i.nowNodeType?o("van-tag",{staticClass:"returnBtn",attrs:{type:"primary",size:"small"},on:{click:function(e){return i.goBackNode()}}},[i._v("\n          返回")]):i._e()],1),i._v(" "),"showSimple"==i.nodeDisplayType?o("div",{staticClass:"_options simpleOptions"},i._l(i.deptAndUsers,function(t,n){return o("div",{key:n,class:{_option:!0,disableStatus:0==t.headInfo.length&&"1"==t.nodeType&&"1"!=t.IsAutoSend},on:{click:function(e){return i.checkNode(n,"man",!1)}}},[o("div",{staticClass:"_Node"},[o("div",{staticClass:"_title"},[o("div",{staticClass:"_fon ds_font4_m elps"},[o("i",{class:["iconfont",t.checked?"iconarrow-right-drop-circle-outline":"iconcheckAll"]}),i._v("\n                "+i._s(1==t.Require?"[必选]":"")+i._s(t.title)+"\n                "),"2"!=t.nodeType&&"3"!=t.nodeType&&"1"!=t.IsAutoSend?o("span",{staticStyle:{"font-size":"0.28rem"}},[i._v("\n                  ("+i._s(t.checkedUserList.length+"人")+")\n                ")]):i._e()])]),i._v(" "),"1"!=t.IsAutoSend&&"2"!=t.nodeType&&"3"!=t.nodeType?o("div",{staticClass:"_righ",on:{click:function(e){return e.stopPropagation(),i.showSecPerson(t,n)}}},[i._l(t.secHeadInfo,function(e,t){return t<1?o("div",{key:t,class:i.getIconClass(e)},[o("van-icon",{attrs:{name:"contact"}}),i._v(" "),o("div",{staticClass:"_font ds_font6"},[i._v("\n                  "+i._s(e.name)+"\n                ")])],1):i._e()}),i._v(" "),o("div",[0==t.checkedUserList.length?o("span",[i._v("请选择")]):i._e(),i._v(" "),o("i",{staticClass:"iconfont iconarrow-right1"})])],2):i._e()])])}),0):i.dsf.config.commonFlow&&"showAll"==i.dsf.config.commonFlow.nodeDisplayType?o("div",{staticClass:"_allOptions"},i._l(i.deptAndUsers,function(n,s){return o("div",{key:s,class:{"_option _gray":!n.checked,_option:!0,disableStatus:0==n.headInfo.length&&"1"==n.nodeType&&"1"!=n.IsAutoSend},on:{click:function(e){return i.checkNode(s,"man",!1)}}},[o("div",{staticClass:"_top"},[o("div",{staticClass:"title"},[i._v("\n              "+i._s(1==n.Require?"[必选]":"")+i._s(n.title)+"\n            ")]),i._v(" "),"2"!=n.nodeType&&"3"!=n.nodeType&&"1"!=n.IsAutoSend?o("div",{staticClass:"num"},[i._v("\n              已选人数（"+i._s(i.getCheckNum(n))+"）\n            ")]):i._e(),i._v(" "),"1"==n.IsAutoSend?o("div",{staticClass:"right"},[o("div",{staticClass:"_num"},[i._v("（自动发送节点）")])]):o("div",{staticClass:"right addbox"},[o("van-icon",{staticClass:"_head_img",attrs:{name:"plus",size:"16"},on:{click:function(e){return e.stopPropagation(),i.showSecPerson(n,s)}}})],1)]),i._v(" "),o("div",{staticClass:"_bottom"},i._l(n.secHeadInfo||n.headInfo,function(t,e){return i.getClass(t,n)?o("div",{key:e,staticClass:"_select"},[o("span",{staticClass:"userImg"},[i._v(i._s(t.name.slice(t.name.length-2)))]),i._v(" "),o("span",{staticClass:"_font elps"},[i._v(i._s(t.name)),2==t.Type?o("span",[i._v("("+i._s(t.DeptName)+")")]):i._e()]),i._v(" "),o("van-icon",{attrs:{name:"cross"},on:{click:function(e){return e.stopPropagation(),i.checkUser(t,n,s,e)}}})],1):i._e()}),0)])}),0):o("div",{staticClass:"_options"},i._l(i.deptAndUsers,function(n,s){return o("div",{key:s,class:{_gray:!n.checked,_option:!0,disableStatus:0==n.headInfo.length&&"1"==n.nodeType&&"1"!=n.IsAutoSend},on:{click:function(e){return i.checkNode(s,"man",!1)}}},[8<n.title.length?o("div",{staticClass:"_fon ds_font4_m"},[i._v("\n            "+i._s(1==n.Require?"[必选]":"")+i._s(n.title)+"\n          ")]):i._e(),i._v(" "),o("div",{staticClass:"_Node"},[o("div",{staticClass:"_title"},[n.title.length<=8?o("div",{staticClass:"_fon ds_font4_m"},[i._v("\n                "+i._s(1==n.Require?"[必选]":"")+i._s(n.title)+"\n              ")]):i._e(),i._v(" "),"2"!=n.nodeType&&"3"!=n.nodeType&&"1"!=n.IsAutoSend?o("div",{staticClass:"_num"},[i._v("\n                "+i._s(n.checkedUserList.length+"人")+"\n              ")]):i._e()]),i._v(" "),"1"==n.IsAutoSend?o("div",{staticClass:"_righ"},[o("div",{staticClass:"_num"},[i._v("（自动发送节点）")])]):i._e(),i._v(" "),"1"!=n.IsAutoSend&&i.isShowDefaultUser&&"2"!=n.nodeType&&"3"!=n.nodeType?o("div",{staticClass:"_righ"},[i._l(n.secHeadInfo||n.headInfo,function(t,e){return e<3?o("div",{key:e,class:i.getIconClass(t),on:{click:function(e){return e.stopPropagation(),i.checkUser(t,n,s,e)}}},[o("img",{class:{state:t.checked,header:!0},attrs:{src:i.getFavicon(t),title:t.FullDeptName,alt:"",onerror:i.default_img}}),i._v(" "),t.checked?i._e():o("van-icon",{staticClass:"noChecked",attrs:{name:"checked"}}),i._v(" "),t.checked?o("van-icon",{staticStyle:{"background-color":"#fff","border-radius":"50%"},attrs:{name:"checked"}}):i._e(),i._v(" "),o("div",{staticClass:"_font ds_font6"},[i._v("\n                  "+i._s(t.name)),2==t.Type?o("span",[i._v("("+i._s(t.DeptName)+")")]):i._e()])],1):i._e()}),i._v(" "),3<n.headInfo.length?o("div",{staticClass:"more",on:{click:function(e){return e.stopPropagation(),i.showSecPerson(n,s)}}},[o("i",{staticClass:"iconfont iconjiahao addicon"}),i._v(" "),o("span",[i._v("更多")])]):i._e()],2):i._e(),i._v(" "),"1"==n.IsAutoSend||i.isShowDefaultUser||"2"==n.nodeType||"3"==n.nodeType?i._e():o("div",{staticClass:"_righ"},[i._l(n.secHeadInfo,function(t,e){return e<3?o("div",{key:e,class:i.getIconClass(t),on:{click:function(e){return e.stopPropagation(),i.checkUser(t,n,s,e)}}},[o("img",{class:{state:t.checked,header:!0},attrs:{src:i.getFavicon(t),title:t.FullDeptName,alt:"",onerror:i.default_img}}),i._v(" "),t.checked?i._e():o("van-icon",{staticClass:"noChecked",attrs:{name:"checked"}}),i._v(" "),t.checked?o("van-icon",{staticStyle:{"background-color":"#fff","border-radius":"50%"},attrs:{name:"checked"}}):i._e(),i._v(" "),o("div",{staticClass:"_font ds_font6"},[i._v("\n                  "+i._s(t.name)),2==t.Type?o("span",[i._v("("+i._s(t.DeptName)+")")]):i._e()])],1):i._e()}),i._v(" "),o("i",{staticClass:"iconfont iconjiahao addicon",on:{click:function(e){return e.stopPropagation(),i.showSecPerson(n,s)}}})],2),i._v(" "),"3"==n.nodeType?o("van-icon",{attrs:{name:"arrow",size:"20"},on:{click:i.showSelect}}):i._e()],1),i._v(" "),2!=n.NodeType&&1==i.dsf.config.setting["SYS-FLOW-0047"]?o("div",[o("van-field",{staticClass:"timeLimit",attrs:{readonly:!0,"input-align":"right",label:"办理期限"},on:{click:function(e){return e.stopPropagation(),i.timeClick(n)}},scopedSlots:i._u([{key:"right-icon",fn:function(){return[o("i",{staticClass:"iconfont iconriqi",staticStyle:{"font-size":"0.42rem"}})]},proxy:!0}],null,!0),model:{value:n.TimeLimit,callback:function(e){i.$set(n,"TimeLimit",e)},expression:"item.TimeLimit"}})],1):i._e()])}),0),i._v(" "),o("div",{staticClass:"_check",staticStyle:{display:"none"}},[o("van-checkbox",{model:{value:i.checked,callback:function(e){i.checked=e},expression:"checked"}}),i._v(" "),o("span",{staticClass:"ds_font6",on:{click:function(e){i.checked=!i.checked}}},[i._v("发送时钉")])],1)]),i._v(" "),i.isShowSmsBox?o("p",{staticClass:"top_title disfr jsb"},[o("span",[i._v("提醒方式")])]):i._e(),i._v(" "),i.isShowSmsBox?o("div",{staticClass:"sms-container"},[o("van-checkbox-group",{ref:"checkboxGroup",attrs:{direction:"horizontal"},model:{value:i.smsResult,callback:function(e){i.smsResult=e},expression:"smsResult"}},i._l(i.smsMethodRange,function(e,t){return o("van-checkbox",{key:t,attrs:{name:e.value,"icon-size":"0.28rem"}},[i._v(i._s(e.text)+"\n        ")])}),1),i._v(" "),i.dsf.config.commonFlow.noShowSmsContent?i._e():o("van-field",{attrs:{rows:"2",autosize:"",type:"textarea",placeholder:"请输入短信提醒内容"},model:{value:i.smsContent,callback:function(e){i.smsContent=e},expression:"smsContent"}})],1):i._e(),i._v(" "),o("div",{staticClass:"_footer"},[0<i.formData.allowEditOpinion&&!i.isShowWriteOpintionBtn&&!i.isHideCancelBtn?o("debounce-click",[o("van-button",{staticClass:"_btn _no_send",attrs:{type:"default"},on:{click:function(e){i.saveOpinion({},!1),i.$emit("close")}}},[i._v(i._s(i.cancalName)+"\n        ")])],1):i._e(),i._v(" "),o("debounce-click",[o("van-button",{staticClass:"_btn _send",attrs:{type:"theme"},on:{click:function(e){return i.sendFileFlow()}}},[i._v(i._s(i.submitName))])],1)],1)],2),i._v(" "),o("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,"get-container":"#app",position:"bottom"},model:{value:i.showSelect,callback:function(e){i.showSelect=e},expression:"showSelect"}},[i.showSelect?o("secPerson",{attrs:{Multiplayer:i.Multiplayer,selectPersons:i.selectPersons,selectIndexUserList:i.selectIndexUserList},on:{cancePerson:function(e){i.showSelect=!1},secOk:i.secOk}}):i._e()],1),i._v(" "),"self"==i.getHW_Type?o("van-popup",{attrs:{"get-container":"#app",position:"bottom",round:""},model:{value:i.showWrite,callback:function(e){i.showWrite=e},expression:"showWrite"}},[o("hw",{attrs:{formData:i.formData,base64Img:i.imgUrl},on:{closeWritePopup:i.closeWritePopup}})],1):i._e(),i._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"jg"==i.getHW_Type&&i.showWrite,expression:"getHW_Type == 'jg' && showWrite"}]},[o("hwJG",{ref:"HWJG",attrs:{hwtype:i.getHW_Type,formData:i.formData,formMeta:i.formMeta},on:{closeWritePopup:i.closeWritePopup}})],1),i._v(" "),o("van-calendar",{ref:"calendarRef",attrs:{"first-day-of-week":"1","get-container":"#app","default-date":i.currentDate},on:{confirm:i.onConfirm},scopedSlots:i._u([{key:"title",fn:function(){return[o("div",{staticStyle:{padding:"0 15px","text-align":"left",height:"80px"}},[o("div",{staticClass:"btnright"},[o("van-button",{attrs:{round:"",size:"mini",type:"primary"},on:{click:i.clearDate}},[i._v("清空日期")])],1)])]},proxy:!0}]),model:{value:i.showCalendar,callback:function(e){i.showCalendar=e},expression:"showCalendar"}}),i._v(" "),o("van-popup",{attrs:{position:"bottom",round:"","get-container":"#app"},model:{value:i.showPicker,callback:function(e){i.showPicker=e},expression:"showPicker"}},[o("van-datetime-picker",{attrs:{type:"time",title:"选择时间","min-hour":0,"max-hour":23,filter:i.filter},on:{confirm:i.confirmDate,cancel:function(e){i.showPicker=!i.showPicker}},model:{value:i.currentTime,callback:function(e){i.currentTime=e},expression:"currentTime"}})],1)],1)},[],!1,null,"14761cbe",null).exports,_=n(30819),S=n(9303),C=n(63560),g=n(31026),c=n(46385),A=n(38496),N=n(91369),T=n(7843),U=n(25108),t={name:"TodoFile",components:{formFile:t,EnclosureButton:i.Z,EnclosurePre:a.default,movingSituation:l.Z,DsButtonToolbox:r.Z,sendWorkflow:D,workFlowDialog:_.Z,selectPerson:C.default,DelayForm:g.default,SeparateRead:c.default,signFile:A.default,signFilePerson:N.default,AskLeave:T.default},mixins:[S.Z],props:{},data:function(){return{headTab:0,showFlowSend:!1,showFlowBack:!1,Response:{},node_list:[],deptAndUsers:[],filelistArr:[],fileUrl:"",showPerson:!1,popupStates:!1,showDelayform:!1,showFyyj:!1,isTransfer:!1}},computed:{showPopup:{get:function(){return this.showFlowBack||this.showFlowSend||this.showDelayform||this.showPerson?this.popupStates=!0:this.popupStates=!1,this.popupStates},set:function(e){this.popupStates=e}},buttons:function(){var e=this.$route.params.formData;return e?e.buttons:{}},formData:function(){return this.$route.params.formData||{}},dataValue:function(){var e=this.$route.params.formData;return e?e.dataValue:{}},tab:function(){return this.$route.params.type}},created:function(){this.$route.params.formData||this.sendBack()},mounted:function(){U.log("tag",this.$refs)},methods:{getContainer:function(){return document.body},onRefresh:function(){this.$store.commit("refreshRouteByReg",["/meetingCenter","/todocenter","/","/signinlist"]),this.$router.go(-1)},sendBack:function(e){this.$router.go(-1)},handleActionClick:function(e){e=(e=this["action-".concat(e)])||dsf.noop;U.log(this.formData),e(this.formData,null,!0)},openFile:function(e){this.fileUrl=e},cancePerson:function(){this.showPerson=!1},getSelectUser:function(n){var e,t,s,i,o,a,r=this;0<n.length&&(n.forEach(function(e,t){e.children&&0<e.children.length&&n.splice(t,1)}),e=n.map(function(e){return e.id.replace("person_","")}),t={},this.isTransfer?1<n.length?dsf.layer.toast("请选择一个人",!0):(s=this.getType(),i=dsf.util.loadSessionStore("user"),o=dsf.layer.loading("取消中"),a=this.dataValue,1===s?dsf.changeUser.flowChangeUser({param:{pk:a.info_id,pId:a.pid,pnId:a.pnid,fromUserId:i.user_id,userId:e.join(","),userName:n.map(function(e){return e.name}).join(","),deptId:n.map(function(e){return e.pid}).join(","),deptName:""},thenFun:function(){return r.onRefresh&&r.onRefresh()},finallyFun:function(){return dsf.layer.closeLoading(o)}}):3===s&&dsf.changeUser.superviseChangeUser({param:{pk:a.info_id||a.id,userId:e.join(",")},thenFun:function(){return r.onRefresh&&r.onRefresh()},finallyFun:function(){return dsf.layer.closeLoading(o)}})):this.isDing?dsf.dd.Ding({users:e,type:2,alertType:2,alertDate:{format:"yyyy-MM-dd HH:mm",value:"2020-05-13 20:00"},attachment:{images:[""]},text:dataValue.bt||item.dataValue.B0001,bizType:0,onSuccess:function(){this.dsf.layer.toast("操作成功")},onFail:function(){this.dsf.layer.toast("操作失败")}}):dsf.http.post("fn/newMobileMeeting/sendMeetingSq",{pk:dataValue.info_id,userIds:e,bt:dataValue.bt}).then(function(e){"success"==e.data.type&&dsf.layer.toast("操作成功",!0)}).catch(function(e){t={msg:"操作异常",type:!1}}).finally(function(e){t.msg&&dsf.layer.toast(t.msg,t.type)}))}}},B=(0,s.Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-todo-file"},[e("van-tabs",{attrs:{"title-active-color":"#333333!important","title-inactive-color":"#666666"},model:{value:t.headTab,callback:function(e){t.headTab=e},expression:"headTab"}},[e("van-tab",{attrs:{title:"表单"}},[e("form-file")],1),t._v(" "),e("van-tab",{attrs:{title:"流转情况"}},[e("moving-situation",{attrs:{"form-data":t.dataValue}})],1),t._v(" "),e("van-tab",{attrs:{title:"相关文件"}},[e("enclosure-button",{on:{"open-file":t.openFile}}),t._v(" "),e("enclosure-pre",{attrs:{"file-url":t.fileUrl}})],1)],1),t._v(" "),e("div",{staticClass:"footer"},[e("DsButtonToolbox",{attrs:{buttons:t.buttons,more:""},on:{commonClick:t.handleActionClick,mainClick:t.handleActionClick}})],1),t._v(" "),e("van-popup",{style:{height:"90%"},attrs:{"get-container":t.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom",round:""},model:{value:t.showPopup,callback:function(e){t.showPopup=e},expression:"showPopup"}},[e("work-flow-dialog",{ref:"wfDialog",attrs:{"form-data":t.dataValue},on:{change:t.onRefresh,close:function(e){t.showFlowBack=!1}}}),t._v(" "),t.showFlowSend?e("send-workflow",{ref:"sendFile",attrs:{"form-data":t.dataValue},on:{close:function(e){t.showFlowSend=!1},golist:t.onRefresh}}):t._e(),t._v(" "),t.showDelayform?e("delay-form",{attrs:{"form-data":t.dataValue,type:1},on:{close:function(e){t.showDelayform=!1},change:t.onRefresh}}):t._e(),t._v(" "),t.showPerson?e("selectPerson",{attrs:{type:0},on:{getSelectUser:t.getSelectUser,cancePerson:t.cancePerson}}):t._e()],1),t._v(" "),t.showFyyj?e("separate-read",{ref:"readPop"}):t._e(),t._v(" "),e("sign-file",{ref:"signFile"}),t._v(" "),e("sign-file-person",{ref:"signFilePerson"}),t._v(" "),e("ask-leave",{ref:"askLeave"})],1)},[],!1,null,"2c75ea99",null).exports},38496:function(e,t,n){n.r(t),n.d(t,{default:function(){return r}});var t=n(73473),s=n.n(t),t=n(63560),i=n(18868),o=n(88561),a=n(25108),t={name:"SignFile",components:{selectPerson:t.default,DebounceClick:i.Z},data:function(){return{isShow:!1,resolve:function(){},reject:function(){},data:{deptBaoming:!0},showPerson:!1,userInfo:{},joinPersons:[],joinPersonIds:"",joinPerson:"",congressPersons:[],congressPersonIds:"",congressPerson:"",leaveReason:"",isAttend:!0,isJoin:!0,attendMeetingUrl:dsf.config.meetingConfig.attendMeetingUrl,extra:{}}},watch:{isAttend:function(){this.isJoin=!this.isJoin,this.showPerson=!1}},methods:{init:function(){var e=o.Z.loadSessionStore("user"),e=(this.userInfo=e,[]),t=[];this.data=null,this.showPerson=!1,this.joinPersons=e,this.joinPersonIds=0<e.length?e[0].id:"",this.joinPerson=0<e.length?e[0].name:"",this.congressPersons=t,this.congressPersonIds=0<t.length?t[0].id:"",this.congressPerson=0<t.length?t[0].name:"",this.leaveReason="",this.isAttend=!0,this.isJoin=!0},show:function(e){var n=this;return this.init(),this.data=e,a.log(this.data),this.isShow=!0,new(s())(function(e,t){n.resolve=e,n.reject=t})},cancel:function(){this.isShow=!1,this.reject("流程被中断")},submit:function(){var t=this,e={meetingtzId:this.data.meetingtzId,pk:this.data.pk,pnId:this.data.pnId,attendance:this.isAttend?"1":"-1",leaveReason:this.leaveReason,"x-auth-token":o.Z.loadSessionStore("loginToken"),requestEnv:"mobile"};if(this.data.deptBaoming?e.attendType=2:e.attendType=1,this.isAttend){if(this.data.deptBaoming||(this.joinPersons=[this.userInfo.name],this.joinPerson=this.userInfo.name,this.joinPersonIds=this.userInfo.user_id),!this.joinPersons.length)return void dsf.layer.toast("请选择参会人员");e.userName=this.joinPerson,e.userId=this.joinPersonIds}else{if(!this.congressPersons.length&&this.data.deptBaoming)return void dsf.layer.toast("请选择代会人员");if(!this.leaveReason.length)return void dsf.layer.toast("请填写请假理由");e.userName=this.congressPerson,e.userId=this.congressPersonIds}var n=dsf.layer.loading();dsf.http.post(this.attendMeetingUrl,e).done(function(e){"200"===e.code?(t.isShow=!1,t.resolve(e),t.isAttend=!0,t.isJoin=!0):dsf.layer.toast("请求异常")}).error(function(){dsf.layer.toast("请求异常")}).always(function(){dsf.layer.closeLoading(n)})},getUserNames:function(e){var t=[],n=[],e=e.map(function(e){return t.push(e.name),n.push(e.attrs.idValue),{id:e.attrs.idValue,pid:e.attrs.pidValue,name:e.name}});return{names:t.join(","),ids:n.join(","),persons:e}},getSelectUser:function(n){var e,t,s;0<n.length?(n.forEach(function(e,t){e.children&&0<e.children.length&&n.splice(t,1)}),e=(s=this.getUserNames(n)).names,t=s.ids,s=s.persons,this.isAttend?(this.joinPerson=e,this.joinPersonIds=t,this.joinPersons=s):(this.congressPerson=e,this.congressPersonIds=t,this.congressPersons=s)):(this.joinPerson="",this.joinPersonIds="",this.joinPersons="",this.congressPerson="",this.congressPersonIds="",this.congressPersons="")}}},r=(0,n(51900).Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-sign-file"},[e("van-popup",{staticClass:"ds-sign-file-pop",attrs:{position:"bottom","get-container":"#app",round:""},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:"报名","left-text":"取消"},on:{"click-left":t.cancel}})],1),t._v(" "),t.data.deptBaoming?e("div",{staticClass:"body"},[e("div",{staticClass:"join"},[e("label",{attrs:{for:""}},[t._v("是否出席:")]),t._v(" "),e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.isAttend,callback:function(e){t.isAttend=e},expression:"isAttend"}},[e("van-radio",{attrs:{name:!0,shape:"square"}},[t._v("出席")]),t._v(" "),e("van-radio",{attrs:{name:!1,shape:"square"}},[t._v(t._s("请假/委托"))])],1)],1),t._v(" "),t.isJoin?e("div",{staticClass:"confrence"},[e("van-field",{attrs:{readyonly:"","input-align":"left",label:"参会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){t.showPerson=!0}},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),t._v("参会人员:\n            ")])]},proxy:!0}],null,!1,1705578387),model:{value:t.joinPerson,callback:function(e){t.joinPerson=e},expression:"joinPerson"}})],1):e("div",{staticClass:"congressPerson"},[e("van-field",{attrs:{readonly:!0,"input-align":"left",label:"代会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){t.showPerson=!0}},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),t._v("代会人员：\n            ")])]},proxy:!0}],null,!1,3628413746),model:{value:t.congressPerson,callback:function(e){t.congressPerson=e},expression:"congressPerson"}})],1),t._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:!t.isJoin,expression:"!isJoin"}],attrs:{rows:"4",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:t.leaveReason,callback:function(e){t.leaveReason=e},expression:"leaveReason"}})],1):e("div",{staticClass:"body"},[e("div",{staticClass:"join"},[e("label",{attrs:{for:""}},[t._v("是否出席:")]),t._v(" "),e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.isAttend,callback:function(e){t.isAttend=e},expression:"isAttend"}},[e("van-radio",{attrs:{name:!0,shape:"square"}},[t._v("出席")]),t._v(" "),e("van-radio",{attrs:{name:!1,shape:"square"}},[t._v(t._s("请假/委托"))])],1)],1),t._v(" "),t.isJoin?t._e():e("div",{staticClass:"confrence"},[e("van-field",{attrs:{readonly:!0,"input-align":"left",label:"代会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){t.showPerson=!0}},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),t._v("代会人员：\n            ")])]},proxy:!0}],null,!1,3628413746),model:{value:t.congressPerson,callback:function(e){t.congressPerson=e},expression:"congressPerson"}})],1),t._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:!t.isJoin,expression:"!isJoin"}],attrs:{rows:"4",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:t.leaveReason,callback:function(e){t.leaveReason=e},expression:"leaveReason"}})],1),t._v(" "),e("div",{staticClass:"footer"},[e("debounce-click",[e("van-button",{attrs:{type:"theme"},on:{click:t.submit}},[t._v("提交")])],1)],1)]),t._v(" "),e("van-popup",{style:{height:"90%"},attrs:{"close-on-click-overlay":!1,position:"bottom","get-container":"#app",round:""},model:{value:t.showPerson,callback:function(e){t.showPerson=e},expression:"showPerson"}},[t.showPerson?e("selectPerson",{attrs:{extra:t.extra,type:0},on:{getSelectUser:t.getSelectUser,cancePerson:function(e){t.showPerson=!1}}}):t._e()],1)],1)},[],!1,null,null,null).exports},91369:function(e,t,n){n.r(t),n.d(t,{default:function(){return a}});var t=n(73473),s=n.n(t),t=n(63560),i=n(88561),o=n(25108),t={name:"SignFilePerson",components:{selectPerson:t.default},data:function(){return{isShow:!1,resolve:function(){},reject:function(){},data:{deptBaoming:!0},showPerson:!1,userInfo:{},joinPersons:[],joinPersonIds:"",joinPerson:"",congressPersons:[],congressPersonIds:"",congressPerson:"",leaveReason:"",isAttend:!0,attendance:1,isJoin:!0}},watch:{isAttend:function(){this.isJoin=!this.isJoin,this.showPerson=!1},attendance:function(e){}},methods:{init:function(){var e=i.Z.loadSessionStore("user"),e=(this.userInfo=e,[]),t=[];this.data=null,this.showPerson=!1,this.joinPersons=e,this.joinPersonIds=0<e.length?e[0].id:"",this.joinPerson=0<e.length?e[0].name:"",this.congressPersons=t,this.congressPersonIds=0<t.length?t[0].id:"",this.congressPerson=0<t.length?t[0].name:"",this.leaveReason="",this.isAttend=!0,this.isJoin=!0},show:function(e){var n=this;return this.init(),this.data=e,o.log(this.data),this.isShow=!0,new(s())(function(e,t){n.resolve=e,n.reject=t})},cancel:function(){this.isShow=!1,this.reject("流程被中断")},submit:function(){var t=this,e={meetingtzId:this.data.meetingtzId,pk:this.data.pk,pnId:this.data.pnId,attendance:this.attendance,leaveReason:this.leaveReason,"x-auth-token":i.Z.loadSessionStore("loginToken"),requestEnv:"mobile"};if(this.data.deptBaoming?e.attendType=2:e.attendType=1,-1!=this.attendance||this.leaveReason.length){if(2==this.attendance){if(!this.congressPersons.length)return void dsf.layer.toast("请选择代会人员");e.userName=this.congressPerson,e.userId=this.congressPersonIds}var n=dsf.layer.loading();dsf.http.post("fn/MeetingMobile/attendMeeting",e).done(function(e){"200"===e.code?(t.isShow=!1,t.resolve(e),t.isAttend=!0,t.isJoin=!0):dsf.layer.toast(e.message)}).error(function(){dsf.layer.toast(res.message)}).always(function(){dsf.layer.closeLoading(n)})}else dsf.layer.toast("请填写请假理由")},getUserNames:function(e){var t=[],n=[],e=e.map(function(e){return t.push(e.name),n.push(e.attrs.idValue),{id:e.attrs.idValue,pid:e.attrs.pidValue,name:e.name}});return{names:t.join(","),ids:n.join(","),persons:e}},getSelectUser:function(n){var e,t,s;0<n.length?(n.forEach(function(e,t){e.children&&0<e.children.length&&n.splice(t,1)}),e=(s=this.getUserNames(n)).names,t=s.ids,s=s.persons,this.congressPerson=e,this.congressPersonIds=t,this.congressPersons=s):(this.joinPerson="",this.joinPersonIds="",this.joinPersons="",this.congressPerson="",this.congressPersonIds="",this.congressPersons="")}}},a=(0,n(51900).Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-sign-file"},[e("van-popup",{staticClass:"ds-sign-file-pop",attrs:{position:"bottom","get-container":"#app",round:""},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:"报名","left-text":"取消"},on:{"click-left":t.cancel}})],1),t._v(" "),e("div",{staticClass:"body"},[e("div",{staticClass:"join"},[e("label",{attrs:{for:""}},[t._v("是否出席:")]),t._v(" "),e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.attendance,callback:function(e){t.attendance=e},expression:"attendance"}},[e("van-radio",{attrs:{name:1,shape:"square"}},[t._v("出席")]),t._v(" "),e("van-radio",{attrs:{name:-1,shape:"square"}},[t._v(t._s("请假"))]),t._v(" "),e("van-radio",{attrs:{name:2,shape:"square"}},[t._v(t._s("委托"))])],1)],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:2==t.attendance,expression:"attendance==2"}],staticClass:"confrence"},[e("van-field",{attrs:{readonly:!0,"input-align":"left",label:"代会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){t.showPerson=!0}},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),t._v("代会人员：\n            ")])]},proxy:!0}]),model:{value:t.congressPerson,callback:function(e){t.congressPerson=e},expression:"congressPerson"}})],1),t._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:-1==t.attendance,expression:"attendance==-1"}],attrs:{rows:"4",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:t.leaveReason,callback:function(e){t.leaveReason=e},expression:"leaveReason"}})],1),t._v(" "),e("div",{staticClass:"footer"},[e("van-button",{attrs:{type:"theme"},on:{click:t.submit}},[t._v("提交")])],1)]),t._v(" "),e("van-popup",{style:{height:"90%"},attrs:{"close-on-click-overlay":!1,position:"bottom","get-container":"#app",round:""},model:{value:t.showPerson,callback:function(e){t.showPerson=e},expression:"showPerson"}},[e("selectPerson",{attrs:{type:0},on:{getSelectUser:t.getSelectUser,cancePerson:function(e){t.showPerson=!1}}})],1)],1)},[],!1,null,null,null).exports},79156:function(e,t,n){n.d(t,{Z:function(){return i}});var s=n(78149);function i(e){if(s(e))return e}},26511:function(e,t,n){function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return s}})},522:function(e,t,n){n.d(t,{Z:function(){return a}});var s=n(79156),d=n(85579),u=n(22013);var i=n(33422),o=n(26511);function a(e,t){return(0,s.Z)(e)||function(e,t){var n=null==e?null:void 0!==d&&e[u]||e["@@iterator"];if(null!=n){var s,i,o,a,r=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(s=o.call(n)).done)&&(r.push(s.value),r.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return r}}(e,t)||(0,i.Z)(e,t)||(0,o.Z)()}}}]);