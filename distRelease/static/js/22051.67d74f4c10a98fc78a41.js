"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[22051],{66130:function(e,t,n){n.r(t);var l=n(66250),a=n(33453),u=n.n(a),a=n(8450),f=n.n(a),a=n(73473),c=n.n(a),d=n(90541),m=n(25108),a={};function p(t,n,e){d.Z.http.post("/fn/superviseV6/approval/getResponsibleMobile",{userId:e}).then(function(e){200==e.data.code&&(e="1"==d.Z.config.setting["DB-LX-0001"]?e.data.data.tel:e.data.data.responsibleMobile,n.$set(t.main,"C-DB-0126",{value:e}))})}function v(e,t){t.show=2==e?1:0}a.initHandle=function(o,n,r){var s,i,e=n.controls.find(function(e){return"督办关联"==e.label}),t=n.controls.find(function(e){return"relationFile-2"==e.metaId}),a=(r.relationList.find(function(e){return 2==e.relaValue})&&0==r.relationList.find(function(e){return 2==e.relaValue}).document.length&&(e&&(e.show=0),t)&&(t.show=0),d.Z.http.post("ctrl/superviseV6/m/system/config/db").then(function(e){var t;1==e.data.data.cbType?(e=n.controls.find(function(e){return"220808170715vHySOCUEffqz9jfTocG"==e.metaId}),t=n.controls.find(function(e){return"2208081707395f0kQgjx9XflsmUXkxT"==e.metaId}),e&&(e.show=0),t&&(t.show=0),r.$set(o.main,"C-DB-0127",{value:"1"})):(r.notVaildateMetas.push("C-DB-0001"),e=n.controls.find(function(e){return"C-DB-0001"==e.metaId}),t=n.controls.find(function(e){return"C-DB-0002"==e.metaId}),e&&(e.show=0),t&&(t.show=0),r.$set(o.main,"C-DB-0127",{value:"2"}))}),n.controls.find(function(e){return"controlMobileAlink"==e.controlType})),t=(a&&(i=(s=n).controls.find(function(e){return"controlMobileAlink"==e.controlType}),d.Z.http.post("fn/superviseV6/approvalTask/hasTasks",{relationId:s.parameters.pk}).then(function(e){var t,n=f()({relationId:s.parameters.pk}),a="查看/新建任务计划",o="/commonForm/210604144527JntE2LI7dWrpBLsluZz?specialSaveObj=".concat(n);200==e.data.code&&e.data.data&&e.data.data.taskTitle&&(t="&listId=210618141757PmEKNvvLIJQtgqyDW44",["0","-2","-5","fdn6eOc5Pxw6o8z","Ks0iVYHVoRXz4tk"].indexOf(s.parameters.nodeId)<0&&(t="&method=view"),a=e.data.data.taskTitle,o="/commonForm/210604144527JntE2LI7dWrpBLsluZz/".concat(e.data.data.taskId,"?specialSaveObj=").concat(n).concat(t)),m.log(i),i.extra.linkInfo=o,i.extra.linkName=a})),null==(e=o.main["C-DB-0078"])?void 0:e.value);t&&a&&v(t,a),o.main["C-DB-0126"].value||(e=o.main["C-DB-0094"].value,p(o,r,e)),null!=(t=o.main["C-DB-0016"])&&t.value||r.$set(o.main,"C-DB-0016",o.main["C-DB-0094"]),o.main["C-DB-0086"]&&o.main["C-DB-0086"].value||r.$set(o.main,"C-DB-0086",{value:n.parameters.pk}),o.main["C-DB-0054"]&&o.main["C-DB-0054"].value||r.$set(o.main,"C-DB-0054",{value:"1",text:"待确认"}),r.$bus.$off("selectUserBus").on("selectUserBus",function(e){var t;m.log("busObj.metaData",e.metaData),"C-DB-0094"===e.metaData.metaId?(m.log("busObj",e),r.$set(o.main,"C-DB-0016",o.main["C-DB-0094"]),p(o,r,e.value)):"C-DB-0001"===e.metaData.metaId&&(t=n.controls.find(function(e){return"C-DB-0002"==e.metaId}),1<e.selectArr.length?(r.$set(o.main,"C-DB-0002",{value:"",text:""}),t&&(t.privilege.editable=!1)):t&&(t.privilege.editable=!0))}),r.$bus.$off("userClickBus").on("userClickBus",function(e){var t,a,n;"C-DB-0002"!=e.metaId&&"C-DB-0001"!=e.metaId||(t="C-DB-0002"==e.metaId?o.main["C-DB-0001"]:o.main["C-DB-0002"],n=e.user,t.value.split(",").find(function(e){return e==n.id.slice(n.id.lastIndexOf("_")+1)})&&(n.checked=!1,d.Z.layer.toast("主办单位与协办单位不能重复")),e.user.checked&&(a=e.user,new(c())(function(t,n){d.Z.http.post("fn/superviseV6/approval/hasRolePersonByDept",{deptId:a.id.slice(a.id.lastIndexOf("_")+1),deptName:a.showName}).then(function(e){(200==e.data.code?t:(d.Z.layer.toast(e.data.message),n))()})}).catch(function(){e.user.checked=!1,e.callback(e.user)})))}),r.$bus.on("inputRadio",function(e){"C-DB-0078"==e.metaData.metaId&&v(e.value,a)}),r.$bus.off("subFormTreeSelect").on("subFormTreeSelect",function(a){var t;m.log(a),2<a.selectArr.length+o.multinfos[a.subFormId].rows.length?d.Z.layer.toast("承办人应少于两人"):(t=d.Z.layer.loading(),d.Z.http.post("/ctrl/superviseV6/approval/getUserDept",{userDept:f()(a.selectArr.map(function(e){return{userId:e.id,deptId:e.pid,userName:e.name}}))}).then(function(e){d.Z.layer.closeLoading(t),200==e.data.code&&e.data.data.forEach(function(){var n=(0,l.Z)(u().mark(function e(t,n){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(("220808170715vHySOCUEffqz9jfTocG"==a.subFormId?o.multinfos["2208081707395f0kQgjx9XflsmUXkxT"]:o.multinfos["220808170715vHySOCUEffqz9jfTocG"]).rows.find(function(e){return t.userId==e["C-DB-CBR-003"].value}))return d.Z.layer.toast("主办单位与协办单位不能重复"),e.abrupt("return");e.next=4;break;case 4:return e.next=6,r.$refs.formTab[0].$refs[a.subFormId][0].$refs.subform.addCard(!1).then(function(e){r.$set(e,"C-DB-CBR-001",{value:t.orgLevel,text:t.orgType}),r.$set(e,"C-DB-CBR-004",{schema:"5::"+t.orgId,value:t.orgId,text:t.orgName}),r.$set(e,"C-DB-CBR-003",{schema:"1::"+t.orgId,value:t.userId,text:t.userName})});case 6:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}())}))}),r.formData.multinfos["220808170715vHySOCUEffqz9jfTocG"]&&r.$watch(function(){return r.formData.multinfos["220808170715vHySOCUEffqz9jfTocG"].rows},function(e,t){1<e.length?(o.multinfos["2208081707395f0kQgjx9XflsmUXkxT"].rows.splice(0,o.multinfos["2208081707395f0kQgjx9XflsmUXkxT"].rows.length),n.subform["2208081707395f0kQgjx9XflsmUXkxT"].controls[0].privilege.editable=!1):n.controls.find(function(e){return"220808170715vHySOCUEffqz9jfTocG"==e.metaId}).privilege.editable&&(n.subform["2208081707395f0kQgjx9XflsmUXkxT"].controls[0].privilege.editable=!0)},{deep:!0,immediate:!0})},t.default=a}}]);