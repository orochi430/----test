"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[58930,15264],{51842:function(e,t,i){i.r(t),i.d(t,{default:function(){return n}});var a=i(66250),t=i(33453),l=i.n(t),s=i(25108),t={props:["aoxiongParams"],data:function(){return{data:{},aos:null}},created:function(){this.data=this.aoxiongParams||this.$route.query},mounted:function(){var e=this;this.$nextTick(function(){e.getFiles()})},methods:{getToken:function(n){var o=this;dsf.http.post("fn/aosController/getToken?pk=".concat(this.aoxiongParams.infoId)).then(function(){var t=(0,a.Z)(l().mark(function e(t){var i;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("200"==t.data.code)return e.next=3,dsf.loadJs("http://10.1.214.47:20025/sdk/umd/isigning.min.js").then(function(){}).error(function(e){s.log(e)});e.next=13;break;case 3:return e.next=5,dsf.loadJs("http://10.1.214.47:20025/sdk/plugins/isigning.light-weight.min.js").then(function(){}).error(function(e){s.log(e)});case 5:o.aos=window.axLib.AosSign({host:"http://10.1.214.47:20026/23BVw9aHQTS-20nG7MJJo64/aoscript-api",headers:{"X-Aos-Voucher":"1727498403312738304_1727498403312738304_1700702760282"}}),o.aos.setToken(t.data.message),i={files:[{file:n,name:o.aoxiongParams.fileName}],isFree:!0,thirdBizId:o.aoxiongParams.thirdBizId,toolsBar:{signApprove:{autoActive:!0}}},o.aos.startSign(i),o.aos.event.on("onSubmitSuccess",function(e){var t=e.signId,i=e.thirdBizId,n=e.files;e.sourceFileList,e.fileMd5List;o.aoxiongParams.signId=t,o.aoxiongParams.thirdBizId=i,o.aoxiongParams.currentFileId=n[0],o.aoxiongParams.save_url=o.aoxiongParams.save_url+"&downLoadId="+n[0],o.doFileRead()}),o.aos.event.on("onCloseFrame",function(){o.$emit("update:msg",!1)}),e.next=14;break;case 13:s.log("token获取失败");case 14:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()).error(function(e){s.log(e)}).error(function(e){s.log(e)})},doFileRead:function(e){var t=this;return(0,a.Z)(l().mark(function e(){var i;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=t,dsf.http.upload(t.aoxiongParams.save_url).then(function(){var t=(0,a.Z)(l().mark(function e(t){return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s.log("uploaded",t.data),i.$emit("update:msg",!1),i.dsf.layer.toast(t.data.message);case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}))()},getFiles:function(){var t=this,i=dsf.layer.loading(),e=this.aoxiongParams.initUrl;dsf.http.post(e,{},{responseType:"blob"}).then(function(e){dsf.layer.closeLoading(i),"200"==e.status&&t.getToken(e.data)}).error(function(e){dsf.layer.closeLoading(i),s.log(e)})}}},n=(0,i(51900).Z)(t,function(){return(0,this._self._c)("div")},[],!1,null,"385cef26",null).exports},58930:function(e,t,i){i.r(t),i.d(t,{default:function(){return f}});var a=i(66250),t=i(33453),F=i.n(t),t=i(8450),I=i.n(t),t=i(18428),l=i.n(t),t=i(59655),s=i(25108),n={name:"EnclosureItemToWPS",props:{name:{type:String,require:!0},size:{type:String,default:""},url:{type:String,require:!0},itemData:{type:Object,require:!0},index:{type:Number,default:0},fileData:{type:Object,require:!0},formInfo:{type:Object,require:!0},params:{type:Object,require:!0}},data:function(){return{typeConfig:{IMAGE:"iconIMAGE",TXT:"iconTXT",PDF:"iconPDF",WORD:"iconWORD",EXCEL:"iconEXCEL",PPT:"iconPPT",OTHER:"iconOTHER"},fileType:{IMAGE:["jpeg","bmp","webp","svgz","svg","gif","jpg","ico","png","tif"],PDF:["pdf"],TXT:["txt","sql","xml","html","css","js","java","php","bat","log"],WORD:["docx","docm","doc","dotx","dotm","dot"],EXCEL:["xlsx","xlsm","xlsb","xls","xltx","xltm","xlt","xlam","xla","ods"],PPT:["pptx","pptm","ppt","potx","potm","pot","ppsx","ppsm","pps","ppam","ppa"]}}},computed:{suffix:function(){var e=this.name.lastIndexOf(".");return-1!==e?this.name.substring(e+1,this.name.length).toLowerCase():""},type:function(){for(var e in this.fileType)if(-1<this.fileType[e].indexOf(this.suffix))return e;return"OTHER"}},methods:{ifFile:function(e){return!(e.includes(".png")||e.includes(".jpg")||e.includes(".mp4"))},openFile:function(e,t,i){this.$emit("open",e,t,i)},SaveDing:function(t,e){dsf.http.post("fn/DingDing/upload2DingDrive",{fileId:t.id}).then(function(e){e=e.data;s.log(e),dsf.dd.saveFile({corpId:e.data.corpId,mediaId:e.data.mediaId,name:t.title})})},handWrite:function(e,t){var i,n=this,o=this;s.log(e,":154"),4==dsf.config.previewSetting.previewType?dsf.http.get("fn/wdct/circle",{infoId:e.infoId,moduleId:e.moduleId,fileId:e.id}).then(function(e){var t,i;"200"==e.data.code?((t=e.data.data).downloadUrl=dsf.url.getRootPath()+t.downloadUrl+"&x-auth-token=".concat(dsf.util.loadSessionStore("loginToken")),s.log(t.downloadUrl,t.saveUrl,"179"),i={pageIndex:1,url:t.downloadUrl},dsf.commonForm.nativeCommon("documentannotate",i).then(function(e){s.log(e,":185"),dsf.http.get("".concat(t.saveUrl),{sourceUrl:"".concat(e.data)}).then(function(e){s.log(e),dsf.layer.toast("批示成功"),o.$emit("quanyue")})}).catch(function(e){s.log(e,":193")})):dsf.layer.toast(e.data.message)}):(i=dsf.layer.loading(),this.$emit("closePop"),dsf.http.get("fn/handWrite/circle",{infoId:e.infoId,moduleId:e.moduleId,fileId:e.id}).then(function(e){var t;"200"==e.data.code?((t=e.data.data).downloadUrl=dsf.url.getRootPath()+t.downloadUrl,s.log(t),dsf.layer.closeLoading(i),dsf.dd.signature(t,n).then(function(e){n.$emit("quanyue")}).catch(function(e){s.log(e),n.$emit("quanyue")})):dsf.layer.toast(e.data.message)}))},getIconClass:function(e){var t,i=e.lastIndexOf("."),n=-1<i?e.substring(i+1,e.length).toLowerCase():"";for(t in this.fileType)if(-1<this.fileType[t].indexOf(n))return this.typeConfig[t];return"OTHER"},afterRead:function(e){this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),this.doFileRead(e,this.fileData.attachType)},doFileRead:function(i,n){var o=this;return(0,a.Z)(F().mark(function e(){var l,t;return F().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t="/fn/mobileAttachment/upload?fileId=&moduleId="+(l=o).formInfo.moduleId+"&mid="+o.formInfo.moduleId+"&pId=".concat(o.formInfo.pId,"&pnId=").concat(o.formInfo.pnId,"&nodeName=")+encodeURI("拟稿")+"&nrType="+n+"&pk="+o.formInfo.info_id+"&newFileFlag=0",dsf.http.upload(t,{},i).then(function(){var t=(0,a.Z)(F().mark(function e(t){var i,n,o,a;return F().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s.log(t.data),t.data.result?(i=dsf.util.loadSessionStore("loginToken"),n=(new Date).getTime(),o=t.data.data,(a={id:o.fileId,title:o.fileName,size:o.showFileSize||"",infoId:l.params.info_id,moduleId:l.params.moduleId,isHandwrite:"-1",canEdit:o.canEdit}).navtiveUrl=o.filePath,a.url=dsf.url.getServerUrl("fn/office/openMobileOffice?fileId=".concat(o.fileId,"&moduleId=").concat(l.params.moduleId,"&x-auth-token=").concat(i)),a.editUrl=dsf.url.getServerUrl("fn/mobileOffice/wordEdit?fileId=".concat(o.fileId,"&moduleId=").concat(l.params.moduleId,"&x-auth-token=").concat(i)),a.initUrl="fn/file/download?infoId=".concat(l.params.info_id,"&fileId=").concat(o.fileId,"&fileName=").concat(o.fileName,"&nrType=").concat(o.nrType,"&moduleId=").concat(l.params.moduleId,"&x-auth-token=").concat(i,"&fullfilename=").concat(n).concat(o.fileName),(o.fileName.includes(".png")||o.fileName.includes(".jpg"))&&(a.url=dsf.url.getServerUrl("fn/mobileFileDownload/download?fileId=".concat(o.fileId,"&moduleId=").concat(l.params.moduleId,"&fileName=").concat(o.fileName))),o.fileName.includes(".mp4")&&(a.url=dsf.url.getServerUrl("fn/mobileFileDownload/download?fileId=".concat(o.fileId,"&moduleId=").concat(l.params.moduleId,"&fileName=").concat(o.fileName))),l.fileData.file?l.fileData.file.push(a):l.fileData.file=[a],l.$set(l.fileData,"file",l.fileData.file),s.log(l.fileData),l.$emit("addFile",a)):(l.$emit("closePop"),setTimeout(dsf.layer.toast(t.data.message),1e3)),l.$toast.clear();case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))()},deleteFile:function(i){var n=this;dsf.http.post("/fn/mobileFileUpload/delete?pk=".concat(this.formInfo.info_id,"&fileId=").concat(i.id,"&nrType=").concat(this.fileData.attachType,"&moduleId=").concat(this.formInfo.moduleId,"&fileName=").concat(i.title)).then(function(e){s.log(e),e.data.result?(n.$emit("deleteFile",i),n.fileData.file.forEach(function(e,t){e.id==i.id&&n.fileData.file.splice(t,1)}),n.$set(n.fileData,"file",n.fileData.file)):dsf.layer.toast(e.data.message)})}}},o=i(51900),n=(0,o.Z)(n,function(){var n=this,e=n._self._c;return 0<n.fileData.allowMaintain||0<n.fileData.file.length?e("div",{staticClass:"fileBox EnclosureItemToWPS"},[e("div",{staticClass:"fileTypeList"},[e("van-field",{attrs:{"input-align":"right",name:"uploader"},scopedSlots:n._u([{key:"label",fn:function(){return[e("span",{staticStyle:{"font-size":"var(--font_size_2)","font-weight":"600"}},[n._v(n._s(n.fileData.name)+"：")])]},proxy:!0},{key:"input",fn:function(){return[e("div")]},proxy:!0},0<n.fileData.allowMaintain&&n.dsf.config.commonForm.canEditFile?{key:"right-icon",fn:function(){return[e("van-uploader",{staticClass:"upload-btn",attrs:{"after-read":n.afterRead}},[e("van-icon",{attrs:{color:"#4d9ef1",size:"24",name:"add-o"}})],1)]},proxy:!0}:null],null,!0)}),n._v(" "),n._l(n.fileData.file,function(t,i){return e("div",{key:t.id,staticClass:"fileList"},[e("div",{staticClass:"file disfr"},[e("div",{staticClass:"fileIcon",on:{click:function(e){return n.openFile(t.url,t)}}},[e("i",{staticClass:"iconfont",class:n.getIconClass(t.title)})]),n._v(" "),e("div",{staticClass:"fileBody flex1",on:{click:function(e){return n.openFile(t.url,t)}}},[e("div",{staticClass:"fileTitle ellipsis"},[t.mjText?e("span",{staticStyle:{color:"#E50012"}},[n._v("["+n._s(t.mjText)+"]")]):n._e(),n._v("\n            "+n._s(t.title)+"\n          ")]),n._v(" "),e("div",{staticClass:"fileSize"},[n._v(n._s(t.size||"默认尺寸"))])])]),n._v(" "),e("div",{staticClass:"fileBtn"},[0<t.canEdit&&n.dsf.config.commonForm.canEditFile&&n.ifFile(t.title)?e("div",{staticClass:"fileButton",on:{click:function(e){return n.openFile(t.url,t,"edit")}}},[n._v("编辑")]):n._e(),n._v(" "),n.dsf.config.ddSetting.isDing?e("div",{staticClass:"fileButton",on:{click:function(e){return n.SaveDing(t,i)}}},[n._v("存钉盘")]):n._e(),n._v(" "),0<n.fileData.canDelete&&n.dsf.config.commonForm.canEditFile?e("div",{staticClass:"fileButton",on:{click:function(e){return n.deleteFile(t)}}},[n._v("删除")]):n._e(),n._v(" "),n.fileData.document&&n.fileData.document[i]&&0<n.fileData.document[i].isHandwrite?e("div",{staticClass:"fileButton",on:{click:function(e){return n.handWrite(t,i)}}},[n._v("圈阅")]):n._e()])])})],2)]):n._e()},[],!1,null,"f35f304a",null).exports,r=i(15264),c=i(51842),d=i(62596),k=i(25108),g=null,t=(dsf.util.getClientName().includes("ding")&&i.e(44884).then(i.t.bind(i,44884,23)).then(function(e){g=e.default}),{name:"Enclosure",components:{EnclosureItem:t.Z,EnclosureItemToWPS:n,EnclosurePreview:function(){return Promise.all([i.e(97805),i.e(82060),i.e(31204)]).then(i.bind(i,82060))},WdztFileOpen:r.default,aoxiongFileOpen:c.default},props:{fileData:{type:Object,default:function(){}},isControl:{type:Boolean,default:!1},allFile:{type:Array,default:function(){return[]}},formMeta:{type:Object,default:function(){}},headTab:{type:String,default:""},tabName:{type:String,default:""},formData:{type:Object,default:function(){}},metaData:{type:Object}},data:function(){return{wdztShow:!1,aoxiongShow:!1,aoxiongParams:{signId:"",currentFileId:""},appTopMenu:dsf.config.appTopMenu.value,user:dsf.util.loadSessionStore("user"),isShow:!1,overflow:document.body.style.overflow,typeConfig:{img:"iconpicture",text:"iconfile"},fileObj:{},list:[],fileUrl:"",isdisabled:!1,showUpload:!1,urlIndex:"0",fileList:[],imgPreview:!1,previewImg:[],videoPreview:!1,previewVideo:null,inDreasSoft:navigator.userAgent.includes("DreamSoft"),currentFile:null,fileShow:!1,popFile:{},canPopFileEdit:!1,writeFile:{},writeShow:!1,isFullScreen:!1,isPreview:!0,showPopover:!1,personScreen:[],instructorsList:[],fileTimer:null,isShowFileBtn:!0}},computed:{fullUrl:function(){return dsf.url.openOffice(encodeURIComponent(this.fileUrl))},getActive:function(){return function(e,t){return t.actived?"actived":""}},checkShowPreview:function(){return this.headTab==this.tabName}},watch:{isShow:function(e){document.body.style.overflow=e?"hidden":this.overflow},allFile:{handler:function(e,t){var i=this;this.list=e,this.list.forEach(function(e){i.fileList=i.fileList.concat(e.file)})},deep:!0},fileShow:{handler:function(e,t){e&&this.$refs.enclosurePreview&&this.$refs.enclosurePreview.count&&0<=this.$refs.enclosurePreview.count&&this.$refs.enclosurePreview.init()},deep:!0}},created:function(){var e,t=this;k.log("headTab"+this.headTab),this.list=this.allFile,k.log("全部的呈批文件",this.allFile),this.list.forEach(function(e){t.fileList=t.fileList.concat(e.file)}),0<this.fileList.length&&(this.fileList[0],this.popFile=this.fileList[0],this.fileObj=this.fileList[0],null!=(e=this.formMeta)&&e.parameters&&("1"==(e=this.formMeta.parameters).isopenHandwrite&&this.fileList.some(function(e){if("-5"==e.type)return t.popFile=e,t.fileObj=e,!(t.isPreview=!1)}),0<e.viewAttachUseSignMode)&&0<(null==(e=this.fileList[0])?void 0:e.isHandwrite)&&(this.isPreview=!1),0==this.fileObj.navtiveUrl.indexOf("http")?this.fileUrl=this.fileObj.navtiveUrl:this.fileUrl=this.fileObj.url,this.fileObj.actived=!0)},mounted:function(){},destroyed:function(){document.body.style.overflow=this.overflow},methods:{toggleFile:function(e){this.fileList.length<=1||(this.fileUrl=e.url,this.fileObj=e,this.fileList.forEach(function(e){return e.actived=!1}),e.actived=!0)},ifFile:function(e){return!(e.includes(".png")||e.includes(".jpg")||e.includes(".mp4")||e.includes(".jpeg")||e.includes(".bmp")||e.includes(".gif"))},emptyEvent:function(){},showBox:function(){this.isShow=!0},closeBox:function(){this.isShow=!1},XsfOpenFile:function(e,t){$WPS.open(dsf.url.getRootPath()+e,t.title,function(e){k.log(e)},function(e){k.log(e)})},stripscript:function(e){for(var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\]<>/?~！@#￥……&*——|{}‘；：”“'？↵\r\n ]"),i="",n=0;n<e.length;n++)i+=e.substr(n,1).replace(t,"");return i},wpsOpen:function(t,e,i){var n=this,o=dsf.url.getRootPath(),e=o+e,a=(k.log(encodeURI(e)),this.stripscript(t.title)),e=(k.log(a),{keepCallback:!0,downUrl:encodeURI(e),saveUrl:o+"fn/mobileOffice/upload?fileId=".concat(t.id,"&moduleId=").concat(t.moduleId,"&pnId=").concat(this.fileData.pnId,"&nodeName=").concat(this.fileData.nodeName,"&fileType=1&infoId=").concat(t.infoId,"&extension=").concat(i,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),fileName:a,openWithWPS:!0,uploadFile:!0,openMode:0<t.canEdit?"EditMode":"readOnly",enterReviseMode:"1"==t.isRevise,showReviewingPaneRightDefault:"1"==t.isNoModify,userName:this.user.name});k.log(e),!n.$route.query.isdjOpen&&!n.$route.query.isShuKeOpen||n.$route.query.webViewBack?$WPS.downAndOpen(e,function(e){k.log(e),"success"==e.result&&"upload"==e.action&&(n.fileUrl="",setTimeout(function(){n.fileUrl=t.url+"&temp="+new Date,k.log(n.fileUrl,"重置url成功")},500))},function(e){k.log("错误回调",e)}):window.androidMethod.openNative(I()({action:"$WPS.downAndOpen",data:e}))},yzyWpsOpenFile:function(e,t,i){var n=dsf.url.getRootPath(),n={download_url:n+e.initUrl+"&md5=1",upload_url:n+"fn/mobileOffice/upload?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&pnId=").concat(this.fileData.pnId,"&nodeName=").concat(this.fileData.nodeName,"&fileType=").concat(e.type,"&infoId=").concat(e.infoId,"&extension=").concat(i,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),file_id:e.id,open_mode:"1"==e.canEdit?"EditMode":"ReadOnly",other:"",settings:"EnterReviseMode=true&UserName=".concat(this.user.name)};k.log(n),n=d.Z.encode(I()(n)),wx.invoke("request3rdApp",{scheme:"ksoapp",needToken:1,param:n},function(e){k.log(I()(e))})},goHandWrite:function(){this.isPreview=!1,this.isFullScreen=!1,this.openHandWrite(this.fileObj)},openHandWrite:function(e){var t=this;t.isShow=!1,t.popFile=e,t.fileObj=e,dsf.config.commonForm.LocalDocPreview?(this.isPreview=!1,(this.isControl||dsf.config.commonForm.tabPaneShowFile)&&(this.fileShow=!0)):(t.writeFile=e,t.writeShow=!0,window.onExist=function(){setTimeout(function(){t.fileUrl="".concat(e.url,"&temp=")+Math.random(),t.writeShow=!1},1500)})},iSignature:function(e,t,i){var n=this,o=dsf.url.getRootPath(),a="1"===String(e.canEdit),i=o+"fn/mobileOffice/upload?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&pnId=").concat(this.fileData.pnId,"&nodeName=").concat(this.fileData.nodeName,"&fileType=1&infoId=").concat(e.infoId,"&extension=").concat(i,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),l={userName:null==(l=n.user)?void 0:l.name,canEdit:a,downUrl:o+t,fileName:e.title,saveUrl:i,openWithWPS:!0,opinions:[],writePhoto:"",pid:this.fileData.pId,pnid:this.fileData.pnId,fileId:e.id,copyRight:dsf.config.commonForm.iSignature.keyCode};k.log("调用金格传的参数",l),$WPS.PDFHandWrite(I()(l),function(e){"send"===String(e)&&(n.isShow=!1,n.$bus.emit("iSignatureSend",{act:"send"}))},function(e){alert("open failed: "+e)})},dianJuFileOpen:function(u,m,p){var h=this;return(0,a.Z)(F().mark(function e(){var t,i,n,o,a,l,s,r,c,d,f;return F().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h,i="",n="1"===String(u.canEdit),o=dsf.url.getRootPath(),a=o+"fn/mobileOffice/upload?fileId=".concat(u.id,"&moduleId=").concat(u.moduleId,"&pnId=").concat(h.fileData.pnId,"&nodeName=").concat(h.fileData.nodeName,"&fileType=1&infoId=").concat(u.infoId,"&extension=").concat(p,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),l=o+m,null!=(o=dsf.config.commonForm.dianJu)&&o.needTemplate)return e.next=8,dsf.http.get("fn/dianju/getofd",{pk:u.infoId}).done(function(e){k.log("getofd-res",e),"success"==e.type&&(i=e.data)});e.next=8;break;case 8:return s={fileUrl:l,title:u.title,canEdit:n,uploadUrl:a,keyId:u.id,userName:null==(o=t.user)?void 0:o.name,templateUrl:i},k.log("点聚参数",s),e.next=12,h.isSignFileLock(u.id);case 12:if(r=e.sent,k.log("isOpenSign",r),"mztOA"==dsf.config.projectName)return e.next=17,h.getDianJuAcount();e.next=21;break;case 17:if(e.t0=e.sent,e.t0){e.next=20;break}e.t0="";case 20:s.djAccount=e.t0;case 21:r||(k.log("调用点聚sdk"),t.$route.query.isdjOpen?(s.sendBtn=!1,s.backBtn=!1,window.androidMethod.openNative(I()({action:"xsfCommon.dianJuSdk",data:s}))):(c=function(e){e=JSON.parse(e),k.log("打开点聚的回调参数",e),"dianjuUploadSuccess"==e.message?(t.fileUrl="",setTimeout(function(){t.fileUrl=u.url+"&temp="+new Date,k.log(t.fileUrl,"重置url成功")},500),t.isShow=!1,t.$bus.emit("iSignatureSend",{act:"send"})):"dianjuOpenSuccess"==e.message?t.continueLockFile(u.id):"dianjuOpenError"==e.message?dsf.layer.alert({message:"文件打开失败:"+l}):"dianjuFileClose"==e.message&&("open"==e.type&&e.result?"send"==e.type&&(t.isShow=!1,t.$bus.emit("iSignatureSend",{act:"send"})):t.destroyFileInterval(u.id))},dsf.util.getClientName().includes("ding")?(k.log("exclusiveInvoke1"),d=[{title:u.title,type:"sign",fileUrl:l,fileName:u.title,uploadUrl:a,canEdit:n,templateUrl:"",fileID:u.id,useFingerWrite:"true"}],f={keyId:u.id,userName:null==(f=t.user)?void 0:f.name,tab:d,djAccount:dsf.config.commonForm.dianJu.djAccount,checkFileMd5:!1},g({api:"dianju.open",params:{data:I()(f)}}).then(function(e){k.log("exclusiveInvoke2",e),c(e)})):(k.log("dianJuSdk"),xsfCommon.dianJuSdk(I()(s),c,function(e){k.log("open failed: ",e)}))));case 22:case"end":return e.stop()}},e)}))()},getDianJuAcount:function(){return(0,a.Z)(F().mark(function e(){var t;return F().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="",e.next=3,dsf.http.post("ctrl/thirdPartyInterfaces/getDianJuAcount").then(function(e){k.log("isLock-res",e),"200"==e.data.code?t=e.data.data.djAccount:dsf.layer.toast(e.data.message)}).error(function(e){k.log(e)});case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}))()},shukeFileOpen:function(g,v,w){var S=this;return(0,a.Z)(F().mark(function e(){var t,i,n,o,a,l,s,r,c,d,f,u,m,p,h;return F().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=S,i=dsf.url.getRootPath(),n=i+v,"fn/swMobileCtrl/sendBack?infoId=".concat(g.infoId||g.pk,"&pid=").concat(S.fileData.pId,"&pnid=").concat(S.fileData.pnId,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),o=i+"fn/mobileOffice/upload?fileId=".concat(g.id,"&moduleId=").concat(g.moduleId,"&pnId=").concat(S.fileData.pnId,"&nodeName=").concat(S.fileData.nodeName,"&fileType=1&infoId=").concat(g.infoId,"&extension=").concat(w,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),a=i+"fn/getimage/downloadImage?userid="+S.user.user_id,l="1"===String(g.isHandwrite),s=!1,r=dsf.config.commonForm.shuke.externalStorage||!1,c=dsf.config.commonForm.shuke.screenshots||!1,d=dsf.config.commonForm.shuke.foldingScreen||"",f=dsf.config.commonForm.shuke.penPad||"",u=dsf.config.commonForm.shuke.project||"",m=[],p=[{title:"发送",tag:"send"},{title:"暂存",tag:"zancun"},{title:"手写",tag:"shouxie"},{title:"文字",tag:"wenzi"},{title:"撤回",tag:"chehui"},{title:"恢复",tag:"huifu"},{title:"擦除",tag:"cachu"},{title:"笔写",tag:"bixie"},{title:"笔锋调节",tag:"bftj"},{title:"页码",tag:"yema"}],e.next=17,dsf.http.get("fn/mobileUsedOpinion/find",{}).done(function(e){e.rows.forEach(function(e){m.push(e.context)})});case 17:h={downUrl:n,backUrl:"",sendUrl:"",title:g.title||"",writePhoto:a,externalStorage:r,saveUrl:o,handTip:S.formData.main.B0033&&S.formData.main.B0033.value||"",fileName:g.title,userName:null==(h=t.user)?void 0:h.name,foldingScreen:d,penPad:f,stamp:{getCJInfo:i+"fn/SZFcj/getCJInfo?userId=".concat(S.user.user_id,"&swh=").concat(S.fileData.swh,"&fromList=").concat(S.fileData.urlPath),downloadCJInfo:i+"fn/SZFcj/downloadCJInfo?userId=".concat(S.user.user_id,"&swh=").concat(S.fileData.swh,"&fromList=").concat(S.fileData.urlPath),isStamp:!!s},screenshots:c,canEdit:l,project:u,isForceUpload:dsf.config.commonForm.shuke.isForceUpload||!1,floatTabExpand:dsf.config.commonForm.shuke.floatTabExpand,pid:S.fileData.pId,pnid:S.fileData.pnId,fileId:g.id,opinions:m,nodeOpinion:S.fileData.nodeOpinion||"",copyRight:dsf.config.commonForm.shuke.keyCode,buttonState:dsf.config.commonForm.shuke.buttonState,btnList:dsf.config.commonForm.shuke.btnList||p,enabledScale:dsf.config.commonForm.shuke.enabledScale,showCollapse:dsf.config.commonForm.shuke.showCollapse,btNameTips:dsf.config.commonForm.shuke.btNameTips||[],secretData:{signKey:null==(h=dsf.config.commonForm.shuke.secretData)?void 0:h.signKey,signSecret:null==(h=dsf.config.commonForm.shuke.secretData)?void 0:h.signSecret},docWaterMark:{showWaterMark:null==(h=null==(h=dsf.config.commonForm.shuke)||null==(h=h.showWaterMark)?void 0:h.showWaterMark)||h,color:(null==(h=dsf.config.commonForm.shuke)||null==(h=h.showWaterMark)?void 0:h.color)||"#4da9a9a9",content:(null==(h=dsf.config.commonForm.shuke)||null==(h=h.showWaterMark)?void 0:h.content)||"",degree:-30,dateFormat:"yyyy/MM/dd",space:100,fontSize:(null==(h=dsf.config.commonForm.shuke)||null==(h=h.showWaterMark)?void 0:h.fontSize)||12},btnLeftPadding:null==(h=dsf.config.commonForm.shuke.btnStyleSet)?void 0:h.btnLeftPadding,btnDrawablePadding:null==(h=dsf.config.commonForm.shuke.btnStyleSet)?void 0:h.btnDrawablePadding,btnFontSize:null==(h=dsf.config.commonForm.shuke.btnStyleSet)?void 0:h.btnFontSize,btnEraserLight:null==(h=dsf.config.commonForm.shuke.btnStyleSet)?void 0:h.btnEraserLight,TimerTaskUrl:dsf.config.commonForm.shuke.TimerTaskUrl,TimerTaskPeriod:dsf.config.commonForm.shuke.TimerTaskPeriod},k.log("调用数科传的参数",h,"===",S.fileData,"-----",S.formData),"wechat"==dsf.util.getClientName()?wx.invoke("ext_sySignSdk_startSign",{data:h},function(e){"true"!=e.result||"send"!=JSON.parse(e.data).type&&"back"!=JSON.parse(e.data).type||(S.isShow=!1,0==!dsf.config.commonForm.shuke.isCommitCallBack&&S.$bus.emit("iSignatureSend",{act:JSON.parse(e.data).type}))}):$suwell.openSuWell(I()(h),function(e){S.$bus.emit("addUrlTimer"),"send"!==JSON.parse(e).type&&"back"!==JSON.parse(e).type||(S.isShow=!1,0==!dsf.config.commonForm.shuke.isCommitCallBack&&S.$bus.emit("iSignatureSend",{act:JSON.parse(e.data).type}))},function(e){S.no_fileClick=!1,alert("open failed: "+e)});case 20:case"end":return e.stop()}},e)}))()},isSignFileLock:function(i){return(0,a.Z)(F().mark(function e(){var t;return F().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,dsf.config.commonForm.isInterceptMultiPersonSign)return e.next=4,dsf.http.post("fn/office/isLock",{fileId:i}).then(function(e){k.log("isLock-res",e),"error"==e.data.type&&(dsf.layer.alert({message:"当前文件正在由"+e.data.data.uname+"办理，请稍后处理。"}),t=!0)});e.next=4;break;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)}))()},continueLockFile:function(e){dsf.config.commonForm.isInterceptMultiPersonSign&&(this.fileTimer=setInterval(function(){dsf.http.post("fn/office/continueLock",{fileId:e}).then(function(e){k.log(e,"文件定时上锁")})},3e4))},shGovShuke:function(t){var i=this,e=t.title.substr(t.title.lastIndexOf(".")+1),e={id:t.id,title:"ofd"!=e&&"pdf"!=e?t.title.substr(0,t.title.lastIndexOf("."))+".pdf":t.title,isHandleWrite:!0,isAfterReading:!1,openToPage:t.pagination||0},n={info_id:this.formMeta.parameters.pk,moduleId:this.formMeta.parameters.moduleId,nodeId:this.formMeta.parameters.nodeId,nodeName:this.formMeta.parameters.nodeName,flowId:this.formMeta.parameters.flowId,pId:this.formMeta.parameters.pId,pnId:this.formMeta.parameters.pnId,type:"todo"};try{dsf.shuke.shGovShuke(e,n,function(e){k.log(e),e.openTime&&(t.pagination=e.currentPage,dsf.http.post("/fn/approvalFileInformation/save",{infoId:i.formMeta.parameters.pk,fileId:t.id,startTime:moment(Number(e.openTime)).format("yyyy-MM-DD hh:mm:ss"),endTime:moment(Number(e.closeTime)).format("yyyy-MM-DD hh:mm:ss"),pagination:e.currentPage,readingTime:Math.floor((e.closeTime-e.openTime)/1e3)}).then(function(e){})),"send"!=e.type&&"save"!=e.type||i.$bus.emit("iSignatureSend",{act:"send"})})}catch(e){this.openFile(t.url,t)}},destroyFileInterval:function(e){clearInterval(this.fileTimer),this.fileTimer=null,dsf.config.commonForm.isInterceptMultiPersonSign&&dsf.http.post("fn/office/unLock",{fileId:e}).then(function(e){k.log(e,"文件解锁")})},destroyFileIntervalAll:function(e){clearInterval(fileTimer),fileTimer=null,dsf.config.commonForm.isInterceptMultiPersonSign&&dsf.http.post("fn/office/releaseLock",{pk:e}).then(function(e){k.log(e,"所有文件解锁成功")})},openFile:function(e,t,i){null!=(o=this.formMeta)&&o.parameters&&(o=this.formMeta.parameters,this.isPreview=!(0<o.viewAttachUseSignMode&&0<t.isHandwrite)),this.fileObj=t,this.canPopFileEdit=-1!=t.canEdit&&!i;var n,o=t.navtiveUrl.lastIndexOf("."),o=t.navtiveUrl.substr(o+1),a=o.toLowerCase();"mp4"==a?(this.videoPreview=!0,this.previewVideo=e):0==t.navtiveUrl.indexOf("http")&&-1<t.navtiveUrl.indexOf("response-content-type=image")?this.localImgPreview(t.navtiveUrl):-1<["png","jpg","jpeg","bmp","gif"].indexOf(a)?this.localImgPreview(e):"iSignature"==i?this.iSignature(t,t.initUrl,o):"dianJu"==i?this.dianJuFileOpen(t,t.initUrl,o):"shuke"!=i||(null==(n=dsf.config.commonForm)||null==(n=n.shuke)||null==(n=n.fileTypes)?void 0:n.indexOf(o))<=-1?null!=(n=dsf.config.commonForm.wdzt)&&n.isEnable?(n={edit:i,fileId:t.id,fileName:t.title,infoId:t.infoId,moduleId:t.moduleId,pId:this.fileData.flowId,pnId:this.fileData.nodeId},this.wdztShow=!0,this.wdztParams=n):null!=(n=dsf.config.commonForm.aoxiong)&&n.isEnable&&"pdf"==o&&0<t.isHandwrite?(n="fn/office/downloadFile?infoId=".concat(t.infoId,"&fileId=").concat(t.id,"&fileName=").concat(t.title,"&nrType=").concat(t.type,"&moduleId=").concat(t.moduleId,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken"),"&fullfilename=").concat(t.title,"&file=").concat(t.title),n={save_url:"fn/aosController/saveFile?fileId=".concat(t.id,"&moduleId=").concat(t.moduleId,"&pnId=").concat(this.formMeta.parameters.pnId,"&nodeName=").concat(this.formMeta.parameters.nodeName,"&pk=").concat(t.infoId),initUrl:n,thirdBizId:t.id,edit:i,fileId:t.id,fileName:t.title,infoId:t.infoId,moduleId:t.moduleId,pId:this.fileData.flowId,pnId:this.fileData.nodeId},this.aoxiongShow=!0,this.aoxiongParams=l()(this.aoxiongParams,n)):dsf.config.commonForm.yzyWps?dsf.config.commonForm.LocalPdfPreview&&"edit"!=i?this.localFilePreviewOrEdit(e,t,i,o):this.yzyWpsOpenFile(t,e,a):navigator.userAgent.includes("DreamSoft")?dsf.config.commonForm.xsfWPSofd&&"ofd"==a?this.XsfOpenFile(t.initUrl,t):dsf.config.commonForm.nativeWps?dsf.config.commonForm.LocalPdfPreview&&"edit"!=i||"ofd"==a?this.localFilePreviewOrEdit(e,t,i,o):this.wpsOpen(t,t.initUrl,o):null!=(n=dsf.config.commonForm.dianJu)&&n.isEnable&&"ofd"==a&&"edit"!=i?dsf.config.commonForm.LocalPdfPreview||this.$route.query.LocalPdfPreview?this.localFilePreviewOrEdit(e,t,i,o):this.dianJuFileOpen(t,t.initUrl,o):(this.canPopFileEdit=-1!=t.canEdit&&"edit"!=i,this.localFilePreviewOrEdit(e,t,i,o)):(this.canPopFileEdit=-1!=t.canEdit&&"edit"!=i,this.localFilePreviewOrEdit(e,t,i,o)):"wechat"==dsf.util.getClientName()&&"shGovYth"==dsf.config.projectName?this.shGovShuke(t):this.shukeFileOpen(t,t.initUrl,o)},localImgPreview:function(e){this.isControl||dsf.config.commonForm.tabPaneShowFile?(this.imgPreview=!0,this.previewImg=[e]):(this.fileUrl=e,this.isShow=!1)},localFilePreviewOrEdit:function(e,t,i,n){this.fileUrl="edit"==i?t.editUrl:e,dsf.config.commonForm.webViewPreview?(e=dsf.url.getRootPath()+this.fileUrl.replace("../",""),dsf.util.openWebviewToUrl({url:e,title:t.title})):this.isControl||dsf.config.commonForm.tabPaneShowFile?i||!dsf.config.commonForm.locationHrefToFile||"ofd"!=n&&"pdf"!=n?(this.fileShow=!0,this.popFile=t,this.isPreview=!0):(dsf.layer.loading(),dsf.http.get("/fn/fileToken/get").then(function(e){dsf.layer.clear(),k.log(e.data),e.data.data&&(e=dsf.url.getRootPath()+"fn/fileToPdf/download?fileId=".concat(t.id,"&token=").concat(e.data.data,"&userId=").concat(dsf.util.loadSessionStore("user").user_id),wx.invoke("openUrl",{type:0,url:e},function(e){e.err_msg}))})):dsf.config.commonForm.LocalDocPreview&&(this.popFile=t)},closePop:function(){this.isShow=!1},addFile:function(e){this.fileList.push(e),this.fileUrl=e.url,this.fileObj=e,dsf.config.commonForm.tabPaneShowFile||this.isControl||this.openFile(this.fileUrl,this.fileObj)},deleteFile:function(i){var n=this;this.fileList=i.filelist,this.fileList.forEach(function(e,t){e.id==i.fileData.id&&n.fileList.splice(t,1)}),this.fileObj.id==i.fileData.id&&(this.fileUrl=this.fileList[0]?this.fileList[0].url:"",this.fileObj=this.fileList[0]||{}),0<this.fileList.length?dsf.config.commonForm.tabPaneShowFile||this.isControl||this.openFile(this.fileUrl,this.fileObj):this.popFile={}},goPreview:function(){this.isPreview=!0,this.isFullScreen=!1},fullScreen:function(){this.isFullScreen=!this.isFullScreen;var e,t=0;null!=(e=dsf.config.appTopMenu)&&e.value&&(t=46),document.querySelector(".smt-tab")&&(document.querySelector(".smt-tab").style.top=I()(this.isFullScreen?0:t+50)+"px")},closeFileShow:function(){this.fileShow=!1,this.$refs.enclosurePreview&&this.$refs.enclosurePreview.destroyInterval(),this.$bus.emit("addUrlTimer")},changeFrameHeight:function(){k.log("changeFrameHeight高度变化");var t=this;this.$nextTick(function(){try{var e=t.$refs.enclosurePre.offsetHeight;k.log("parentHeight高度变化"+e),document.querySelector("#filePreview").style.height=e+"px"}catch(e){throw new Error("自定义错误setIframeHeight Error")}})},isShowEnclosureBtn:function(e){this.isShowFileBtn=e},ifFileEdit:function(e){var t=e.lastIndexOf("."),i=e.substr(t+1);return["doc","docx","wps","xls","xlsx","et","ppt","pptx"].some(function(e){return e==i})}}}),f=(0,o.Z)(t,function(){var i=this,n=i._self._c;return n("div",{ref:"enclosurePre",staticClass:"ds-enclosure-pre"},[i.isControl?n("div",[i._l(i.list,function(e,t){return n("enclosure-item",{key:t,attrs:{"is-control":!0,"file-data":e,formMeta:i.formMeta,"form-info":i.fileData,previewId:i.fileObj.id,"form-data":i.formData,metaData:i.metaData},on:{open:i.openFile,openHandWrite:i.openHandWrite,closePop:i.closePop,addFile:i.addFile,deleteFile:i.deleteFile}})}),i._v(" "),n("van-image-preview",{attrs:{images:i.previewImg,closeable:""},model:{value:i.imgPreview,callback:function(e){i.imgPreview=e},expression:"imgPreview"}})],2):n("div",{staticStyle:{height:"inherit"}},[0<i.fileList.length&&i.dsf.config.commonForm.btnToggleShowFile?n("div",{staticClass:"btn-toggle-container"},[n("div",{staticClass:"btn-box"},i._l(i.fileList,function(t,e){return n("span",{key:e,class:i.getActive(e,t),on:{click:function(e){return i.toggleFile(t)}}},[i._v(i._s(t.name))])}),0)]):i._e(),i._v(" "),0<i.fileList.length&&i.ifFile(i.fileUrl)&&!i.dsf.config.commonForm.tabPaneShowFile?n("div",{class:{fullScreen:i.isFullScreen},style:{position:i.isFullScreen?"":"relative",width:"100%",height:i.dsf.config.commonForm.btnToggleShowFile?"calc(100% - 0.76rem)":"100%",overflow:"auto"}},[i.dsf.config.commonForm.LocalDocPreview&&i.checkShowPreview?n("enclosure-preview",{ref:"tabEnclosurePreview",attrs:{file:i.popFile,isPreview:i.isPreview,"form-info":i.fileData,formMeta:i.formMeta,isShowFullScreen:!0,isTabType:!0},on:{fullScreen:i.fullScreen,goPreview:i.goPreview,goHandWrite:i.goHandWrite,closePop:i.closePop,isShowEnclosureBtn:i.isShowEnclosureBtn}}):i._e(),i._v(" "),i.dsf.config.commonForm.LocalDocPreview?i._e():n("iframe",{key:i.fileUrl,attrs:{id:"filePreview",src:i.fileUrl,frameborder:"0"},on:{load:function(e){return i.changeFrameHeight()}}})],1):i.dsf.config.commonForm.tabPaneShowFile||i.ifFile(i.fileUrl)?i.dsf.config.commonForm.tabPaneShowFile?n("div",{staticStyle:{background:"white"}},[i._l(i.list,function(e,t){return n("enclosure-item",{key:t,attrs:{"file-data":e,"form-info":i.fileData,formMeta:i.formMeta,previewId:i.fileObj.id,"form-data":i.formData},on:{open:i.openFile,openHandWrite:i.openHandWrite,closePop:i.closePop,addFile:i.addFile,deleteFile:i.deleteFile}})}),i._v(" "),n("van-image-preview",{attrs:{images:i.previewImg,closeable:"",metaData:i.metaData},model:{value:i.imgPreview,callback:function(e){i.imgPreview=e},expression:"imgPreview"}})],2):i.fileList.length<1?n("commonempty",{attrs:{description:"暂无文件预览"}}):i._e():n("div",[n("img",{attrs:{src:i.fileUrl,alt:""}})]),i._v(" "),!i.dsf.config.commonForm.tabPaneShowFile&&i.isShowFileBtn?n("div",{staticClass:"ds-enclosure-button"},[i.dsf.config.commonForm.txtButtonShowFiles?n("div",{staticClass:"__e_buttonTxt",on:{click:i.showBox}},[i._v("\n        文件"),n("br"),i._v("列表\n      ")]):n("div",{staticClass:"__e_button",on:{click:i.showBox}},[n("i",{staticClass:"iconfont iconattachment"})])]):i._e()],1),i._v(" "),n("van-popup",{staticClass:"relevant-popup",staticStyle:{"max-height":"80%"},attrs:{"get-container":"#app",position:"bottom",round:""},model:{value:i.isShow,callback:function(e){i.isShow=e},expression:"isShow"}},[n("div",{staticClass:"popup-title"},[i._v("相关文件")]),i._v(" "),n("div",{staticClass:"popup-content"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!i.fileList.length&&i.list.length<1,expression:"!fileList.length && list.length < 1"}],staticClass:"__file_empty"},[n("commonempty",{attrs:{description:"暂无附件"}})],1),i._v(" "),n("div",{staticClass:"__file_list"},i._l(i.list,function(e,t){return n("enclosure-item",{key:t,attrs:{"file-data":e,"form-info":i.fileData,formMeta:i.formMeta,showClickIcon:!0,previewId:i.fileObj.id,"form-data":i.formData,metaData:i.metaData},on:{open:i.openFile,openHandWrite:i.openHandWrite,closePop:i.closePop,addFile:i.addFile,deleteFile:i.deleteFile}})}),1)])]),i._v(" "),n("van-popup",{style:{height:"100%"},attrs:{position:"bottom","get-container":"#app"},model:{value:i.videoPreview,callback:function(e){i.videoPreview=e},expression:"videoPreview"}},[n("van-nav-bar",{on:{"click-left":function(e){i.videoPreview=!1}},scopedSlots:i._u([{key:"left",fn:function(){return[n("van-icon",{attrs:{name:"arrow-left"}}),n("span",[i._v("返回")])]},proxy:!0}])}),i._v(" "),n("div",{staticClass:"videoBox",on:{click:function(e){i.videoPreview=!1}}},[i.videoPreview?n("video",{staticStyle:{width:"100%",height:"200px"},attrs:{autoplay:"",name:"media",controls:""}},[n("source",{attrs:{src:i.previewVideo,type:"video/mp4"}})]):i._e()])],1),i._v(" "),n("van-popup",{staticClass:"filePop closefilePop",attrs:{"get-container":"#app",position:"bottom"},model:{value:i.fileShow,callback:function(e){i.fileShow=e},expression:"fileShow"}},[n("van-sticky",[n("van-nav-bar",{attrs:{title:i.popFile.title},on:{"click-left":function(e){return i.closeFileShow()},"click-right":function(e){return i.closeFileShow()}},scopedSlots:i._u([i.appTopMenu?{key:"left",fn:function(){return[n("van-icon",{attrs:{name:"arrow-left"}}),n("span",[i._v("返回")])]},proxy:!0}:{key:"right",fn:function(){return[n("span",[i._v("关闭文件")])]},proxy:!0}],null,!0)})],1),i._v(" "),i.dsf.config.commonForm.LocalDocPreview&&i.fileShow?n("enclosure-preview",{ref:"enclosurePreview",attrs:{file:i.popFile,isPreview:i.isPreview,"form-info":i.fileData,formMeta:i.formMeta},on:{goPreview:i.goPreview,goHandWrite:i.goHandWrite,closePop:i.closePop}}):i._e(),i._v(" "),i.dsf.config.commonForm.LocalDocPreview?i._e():n("iframe",{key:"".concat(i.popFile.id,"_").concat(new Date),attrs:{id:"filePreview",src:i.fileUrl,frameborder:"0"},on:{load:function(e){return i.changeFrameHeight()}}}),i._v(" "),i.fileShow&&i.canPopFileEdit&&i.dsf.config.commonForm.canEditFile&&i.ifFileEdit(i.popFile.title)?n("div",{staticClass:"btn-container"},[n("van-button",{staticClass:"btn",attrs:{type:"info"},on:{click:function(e){return i.openFile(i.fileUrl,i.popFile,"edit")}}},[i._v("编辑")])],1):i._e()],1),i._v(" "),n("van-popup",{staticClass:"filePop iframePop",attrs:{"get-container":"#app",position:"bottom"},model:{value:i.writeShow,callback:function(e){i.writeShow=e},expression:"writeShow"}},[n("van-nav-bar",{attrs:{title:i.writeFile.title},on:{"click-left":function(e){i.writeShow=!1}},scopedSlots:i._u([{key:"left",fn:function(){return[n("van-icon",{attrs:{name:"arrow-left"}}),n("span",[i._v("返回")])]},proxy:!0}])}),i._v(" "),i.writeShow?n("iframe",{key:"".concat(i.writeFile.id,"_").concat(new Date),attrs:{id:"filePreview",src:i.writeFile.handwritingUrl,frameborder:"0"},on:{load:function(e){return i.changeFrameHeight()}}}):i._e()],1),i._v(" "),n("van-popup",{staticClass:"filePop closefilePop",attrs:{"get-container":"#app",position:"bottom"},model:{value:i.wdztShow,callback:function(e){i.wdztShow=e},expression:"wdztShow"}},[n("van-sticky",[n("van-nav-bar",{attrs:{title:i.fileObj.title},on:{"click-left":function(e){i.wdztShow=!1},"click-right":function(e){i.wdztShow=!1}},scopedSlots:i._u([i.appTopMenu?{key:"left",fn:function(){return[n("van-icon",{attrs:{name:"arrow-left"}}),n("span",[i._v("返回")])]},proxy:!0}:{key:"right",fn:function(){return[n("span",[i._v("关闭文件")])]},proxy:!0}],null,!0)})],1),i._v(" "),i.wdztShow?n("WdztFileOpen",{attrs:{wdztParams:i.wdztParams}}):i._e()],1),i._v(" "),n("van-popup",{staticClass:"filePop closefilePop",attrs:{"get-container":"#app",position:"bottom"},model:{value:i.aoxiongShow,callback:function(e){i.aoxiongShow=e},expression:"aoxiongShow"}},[n("van-sticky",[n("van-nav-bar",{attrs:{title:i.fileObj.title},on:{"click-left":function(e){i.aoxiongShow=!1},"click-right":function(e){i.aoxiongShow=!1}},scopedSlots:i._u([i.appTopMenu?{key:"left",fn:function(){return[n("van-icon",{attrs:{name:"arrow-left"}}),n("span",[i._v("返回")])]},proxy:!0}:{key:"right",fn:function(){return[n("span",[i._v("关闭文件")])]},proxy:!0}],null,!0)})],1),i._v(" "),i.aoxiongShow?n("aoxiongFileOpen",{attrs:{msg:i.aoxiongShow,aoxiongParams:i.aoxiongParams},on:{"update:msg":function(e){i.aoxiongShow=e}}}):i._e()],1)],1)},[],!1,null,"776354c9",null).exports},15264:function(e,t,i){i.r(t),i.d(t,{default:function(){return n}});var a=i(66250),t=i(33453),l=i.n(t),t={props:["wdztParams"],data:function(){return{data:{},jssdk:null,wpsData:{}}},created:function(){this.data=this.wdztParams||this.$route.query},mounted:function(){var e=this;dsf.loadJs("static/js/webOffice/web-office-sdk-v1.1.19.umd.js").then(function(){e.getWpsUrl(),e.$nextTick(function(){1<document.getElementsByClassName("wps_office").length&&window.location.reload()})})},methods:{getWpsUrl:function(){var e="edit"==this.data.edit?"fn/sdtongSSO/getEditUrl":"fn/sdtongSSO/getPreviewUrl";this.getWdztUrl(this.data,e)},getWdztUrl:function(e,t){var i=this;dsf.http.post(t,{fileId:e.fileId,fileName:e.fileName,infoId:e.infoId,moduleId:e.moduleId,pnId:e.pnId,pId:e.pId}).then(function(e){"200"==e.data.code&&i.wpsOpens(e.data.data.url)})},wpsOpens:function(n){var o=this;return(0,a.Z)(l().mark(function e(){var t,i;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("wpsOffice"),o.jssdk=WebOfficeSDK.config({url:n,mount:t}),o.jssdk.iframe.style.height=document.body.clientHeight-document.querySelector("#appTop").clientHeight+"px",o.wpsData.isRevise)return e.next=6,o.jssdk.ready();e.next=9;break;case 6:t=o.jssdk.Application,i=!(!dsf.config.commonForm.wdzt||!dsf.config.commonForm.wdzt.trackRevisions)&&dsf.config.commonForm.wdzt.trackRevisions,t.ActiveDocument.TrackRevisions=i;case 9:case"end":return e.stop()}},e)}))()}}},n=(0,i(51900).Z)(t,function(){this._self._c;return this._m(0)},[function(){var e=this._self._c;return e("div",[e("div",{staticClass:"wps_office",attrs:{id:"wpsOffice"}})])}],!1,null,"390ee662",null).exports}}]);