"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[31488],{99995:function(t,e,n){n.r(e);var r=n(66250),a=n(62207),l=n.n(a),a=n(79529),f=n.n(a),a=n(73473),s=n.n(a),a=n(33453),c=n.n(a),m=n(25108),a={},v=!0;function i(){return u.apply(this,arguments)}function u(){return(u=(0,r.Z)(c().mark(function t(e,n,a){var u,o,s,r,i;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(v=!0,u=[],o=[],e.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows.forEach(function(t){var e=t["2011111152511p1BHuXNBePEcSaLaDN"].value,t=t["201102140826J53lVLYNbFLtqCZeEsf"].value;u.push(e),o.push(t)}),0==u.length)return dsf.layer.toast("请选择要预定的食品！"),t.abrupt("return",!1);t.next=7;break;case 7:return r=u.join(","),i=o.join(","),s=e.main.B0013.value,r={idStr:r,numStr:i,ydDte:s},t.next=14,dsf.http.post("ctrl/menuAdmin/checkoutNum",r);case 14:i=t.sent,m.log(i.data),200==i.data.code?v=!0:(v=!1,dsf.layer.toast(i.data.message)),m.log(v);case 18:case"end":return t.stop()}},t)}))).apply(this,arguments)}function d(e,t,n){var a,n=n.main["201111194607dVYexOOQhJnyEgPH43B"],u=!1;e.formMeta.buttons.mainButtons.forEach(function(t){"yuDing"==t.action&&(u=!0)}),0==n.value||u||e.formMeta.buttons.mainButtons.unshift({name:"预定",icon:"",action:"yuDing",parameters:""}),1==n.value?(a=!1,e.formMeta.subform["201102141615lvkWKiLz0C3qRUaQWI0"].controls.forEach(function(t){"201102140826J53lVLYNbFLtqCZeEsf"==t.metaId&&e.$set(t,"privilege",{editable:!0,visible:!0})}),e.formMeta.buttons.mainButtons.forEach(function(t){"yuDing"==t.action&&(t.name="预定"),"save"==t.action&&(a=!0)}),a||e.formMeta.buttons.mainButtons.unshift({name:"保存",icon:"",action:"save",parameters:[{name:"保存类型",remark:"暂无信息",value:"",key:"saveType"}]})):2==n.value&&(e.formMeta.buttons.mainButtons.forEach(function(t){"yuDing"==t.action&&(t.name="取消预定")}),e.formMeta.buttons.mainButtons=e.formMeta.buttons.mainButtons.filter(function(t){return"yuDing"==t.action}),e.formMeta.subform["201102141615lvkWKiLz0C3qRUaQWI0"].controls.forEach(function(t){"201102140826J53lVLYNbFLtqCZeEsf"==t.metaId&&e.$set(t,"privilege",{editable:!1,visible:!0})}))}a.yuDing=function(u,o,s){s.saveNoTip((0,r.Z)(c().mark(function t(){var e,n,a;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=u.main["201111194607dVYexOOQhJnyEgPH43B"].value,t.next=3,i(u,o,s);case 3:if(m.log(v),1!=e||v){t.next=6;break}return t.abrupt("return",!1);case 6:s.$set(u.main,"201111194607dVYexOOQhJnyEgPH43B",{value:1==e?2:1}),n=u.main["201111194607dVYexOOQhJnyEgPH43B"].value,a=o.parameters.pk,a={infoId:a,state:n},dsf.http.post("ctrl/menuAdmin/updateIssueState",a).then(function(t){m.log(t),"success"==t.data.type?(dsf.layer.toast("操作成功"),d(s,0,u)):dsf.layer.toast("操作失败，请联系管理员！")});case 12:case"end":return t.stop()}},t)})))},a.initHandle=function(s,t,r){var o,i;"-1"!=t.parameters.nodeId&&(r.$bus.on("inpBus",function(t){var e,n,a,u,o;"201102140826J53lVLYNbFLtqCZeEsf"==t.metaData.metaId&&(e=t.subFormIndex,n=s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows[e]["201102140715c36Cl3qs5mZ16lMZX7b"].value,a=Number(t.value),u=l()(n)*f()(a),""!=a&&null!=a||(u=0),m.log(t),m.log(n),3<a&&(u=s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows[e]["201102140826J53lVLYNbFLtqCZeEsf"].value=0,dsf.layer.toast("每种食品数量不能超过三份，请重新填写")),m.log(s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows[e]),s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows[e]["201102140943qCgslf0DBGuterfch3b"].value=String(u),o=0,s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows.forEach(function(t){o+=Number(t["201102140943qCgslf0DBGuterfch3b"].value)}),m.log(o),r.$set(s.main,"B0014",{value:String(o)}))}),o=s,(i=r).$bus.on("selectDateTime",function(t){var e,n,a,u;m.log(t),"B0021"==t.metaData.metaId?(u=new Date(o.main.B0013.value),n=(a=new Date(t.value)).getDay(),16<=(e=a.getHours())&&e<17&&(3==n||5==n)&&a.getTime()>u.getTime()||(dsf.layer.toast("领取时间为每周三或周五下午16:00至17:00之间，且应大于预定日期，请重新填写。"),i.$set(o.main,"B0021",{value:""}))):"B0013"==t.metaData.metaId&&(n=(e=new Date(t.value)).getDay(),a=e.getHours(),u=e.getMinutes(),8<=a&&a<11&&u<=30&&(2==n||3==n)||(dsf.layer.toast("预定时间为每周二、周三上午8:00-11:30，其他时间段内暂不允许预定，请重新填写。"),i.$set(o.main,"B0013",{value:""})))}),d(r,0,s)),r.$bus.on("subFormSelect",function(t,e){if(0<s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows.length){m.log(t,e);for(var n=s.multinfos["201102141615lvkWKiLz0C3qRUaQWI0"].rows,a=!1,u=n.length-1;0<=u;u--)!function(e){t.checkItems.forEach(function(t){n[e]["2011111152511p1BHuXNBePEcSaLaDN"].value==t.dataValue.A0001&&(n.splice(e,1),a=!0)})}(u);a&&dsf.layer.toast("不可重复选择食品，请重新填写")}})},a.saveFilter=function(a,u,o,t){return new(s())(function(){var n=(0,r.Z)(c().mark(function t(e,n){return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i(a,u,o);case 2:m.log(v),v&&("0"==(""==a.main["201111194607dVYexOOQhJnyEgPH43B"].value?"0":a.main["201111194607dVYexOOQhJnyEgPH43B"].value)&&o.$set(a.main,"201111194607dVYexOOQhJnyEgPH43B",{value:"1"}),e());case 4:case"end":return t.stop()}},t)}));return function(t,e){return n.apply(this,arguments)}}())},a.saveAfter=function(t,e,n){m.log(t,e,n),dsf.layer.toast("表单保存成功",null,function(){t.$eventBus.refresh(t),d(t,t.formMeta,n)})},e.default=a}}]);