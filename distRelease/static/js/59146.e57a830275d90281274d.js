"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[59146],{59146:function(t,e,n){n.r(e),n.d(e,{default:function(){return y}});var e=n(27921),r=n.n(e),e=n(85579),l=n.n(e),e=n(22013),c=n.n(e),e=n(26243),o=n.n(e),e=n(62680),i=n.n(e),e=n(95366),u=n.n(e),e=n(6919),s=n.n(e),f=n(77193),e=n(8450),a=n.n(e),e=n(13852),d=n(63450),m=n(82695),p=n(25108);function h(e,t){var a,s=o()(e);return i()&&(a=i()(e),t&&(a=a.filter(function(t){return u()(e,t).enumerable})),s.push.apply(s,a)),s}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach(function(t){(0,f.Z)(e,t,a[t])}):s()?Object.defineProperties(e,s()(a)):h(Object(a)).forEach(function(t){Object.defineProperty(e,t,u()(a,t))})}return e}function x(t,e){var a,s,n,o,i=void 0!==l()&&t[c()]||t["@@iterator"];if(i)return s=!(a=!0),{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,n=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw n}}};if(Array.isArray(t)||(i=function(t,e){var a;if(t)return"string"==typeof t?b(t,e):"Map"===(a="Object"===(a=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:a)||"Set"===a?r()(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?b(t,e):void 0}(t))||e&&t&&"number"==typeof t.length)return i&&(t=i),o=0,{s:e=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}var e={name:"controlUser",model:{prop:"usertext",event:"selectuser"},props:{metaData:{type:Object,default:function(){return{}}},formData:{type:Object,default:function(){return{}}},topformData:{type:Object,default:function(){return{}}},topformMeta:{type:Object,default:function(){return{}}},usertext:{type:Object,default:function(){return{}}},subFormIndex:{type:Number,default:null},pformData:{type:Object,default:function(){return{}}},formId:{type:String,default:""}},mixins:[e.Z],components:{controlUserList:d.default,MailDetail:m.default},data:function(){return{users:this.usertext.text,controlUserMessage:{},show:!1,controlData:{rules:[]},tempUrl:"",defaultSelectArray:[],telList:[],userdata:{},showMailDetail:!1}},created:function(){var t,e,s=this;this.controlUserMessage=this.metaData,this.readonly&&"showTelicon"==this.metaData.extra.eatraClass&&""!=this.usertext.value&&dsf.http.post("fn/mobile/user/info",{ids:this.usertext.value}).then(function(t){200==t.data.code&&(s.telList=t.data.data)}),"{}"==a()(this.metaData.defaultValue)||this.usertext.value||(t=this.metaData.defaultValue,e=this.usertext,t.text?(this.$set(e,"text",t.text),e.value=t.value,0==this.selectType&&(e.schema=t.schema)):(this.$set(e,"text",JSON.parse(t.value).text),e.value=JSON.parse(t.value).value,0==this.selectType&&(e.schema=JSON.parse(t.value).schema)),this.$emit("selectuser",e)),this.metaData.extra.tabs?"controlUser"!=this.metaData.controlType&&this.metaData.extra.tabs.forEach(function(t){var e,a;t.action.indexOf("fn")<0&&("/"==t.action[0]?t.action="fn"+t.action:t.action="fn/"+t.action),t.action.includes("?")?t.action+="&moduleId=".concat(s.topformMeta.parameters.moduleId,"&pk=").concat(s.topformMeta.parameters.pk):t.action+="?moduleId=".concat(s.topformMeta.parameters.moduleId,"&pk=").concat(s.topformMeta.parameters.pk),s.formId&&(e=s.pformData[s.formId].value,a=s.pformData.A0004.value,t.action+="&subformPk=".concat(e,"&subformModuleId=").concat(a))}):p.log(this.metaData.extra.message)},mounted:function(){var a=this;this.$bus.on("codeSelect",function(t){var e=t.split("=");p.log(a.metaData),a.metaData.extra.tabs[0].action.includes(e[0])?(e=a.metaData.extra.tabs[0].action.split(e[0]),a.metaData.extra.tabs[0].action=e[0]+t):a.metaData.extra.tabs[0].action+=t}),this.$bus.on("codeChange",function(t){p.log(a.metaData),t&&t.data&&a.metaData.metaId==t.data.metaData.metaId&&(a.metaData.extra.tabs[0].action=t.url)})},computed:{text:function(){return this.usertext.text},selectType:function(){return"controlUser"==this.metaData.controlType?0:1},rows:function(){return null!=this.metaData.extra&&null!=this.metaData.extra.rows?this.metaData.extra.rows:1},usertextArr:function(){var t;return(null==(t=this.usertext.text)?void 0:t.split(","))||[]}},watch:{text:function(t,e){this.users=t},usertext:{handler:function(t,e){if(t.value){this.defaultSelectArray=[];for(var a=t.value.split(","),s=t.text.split(","),n=t.schema?t.schema.split(","):"",o=0;o<a.length;o++)a[o]&&this.defaultSelectArray.push({name:s[o],showName:s[o],id:a[o],pid:n[o]?n[o].split("::")[1]:"",type:n[o]?n[o].split("::")[0]:0==this.selectType?"1":"0",checked:!0,attrs:{orgNameLV2Text:s[o],deptId:n[o]?n[o].split("::")[1]:"",pidValue:n[o]?n[o].split("::")[1]:"",idValue:a[o]}})}else this.defaultSelectArray=[]},deep:!0,immediate:!0}},methods:{toMailDetail:function(t){var e;1==(null==(e=this.usertext.schema)?void 0:e.split(",")[t].split(":")[0])&&(e=this.usertext.value.split(",")[t],this.userdata={userId:e},this.showMailDetail=!0)},getContainer:function(){return document.body},getUser:function(){if(!this.readonly)if(this.$bus.emit("getUser",{metaData:this.metaData}),this.metaData.extra.tabs){if(window[this.metaData.metaId+"_beforeOpenCode"]){this.tempUrl.length||(this.tempUrl=this.metaData.extra.tabs[0].action);var t=window[this.metaData.metaId+"_beforeOpenCode"](this.topformData||this.formData,this.tempUrl,this);if(!t.length)return;this.metaData.extra.tabs[0].action=t}this.show=!0}else dsf.layer.toast("未设置选择范围")},close:function(t){this.show=t},getSelectUser:function(t){p.log(t);var e,a,s,n="",o=[],i=[],r=[],l=x(t);try{for(l.s();!(s=l.n()).done;){var c=s.value,u="",u=c.attrs.idValue?-1<c.attrs.idValue.lastIndexOf("-")?c.attrs.idValue.slice(c.attrs.idValue.lastIndexOf("-")+1):-1<c.attrs.idValue.lastIndexOf("_")?c.attrs.idValue.slice(c.attrs.idValue.lastIndexOf("_")+1):c.attrs.idValue:c.id;o.push(c.name),i.push(u),c.attrs.idValue&&r.push(c.type+"::"+("1"==c.type?void 0===c.attrs.deptId?"":c.attrs.deptId:u))}}catch(t){l.e(t)}finally{l.f()}e=o.join(","),a=i.join(","),0<r.length&&(n=r.join(",")),this.show=!1;var f=this.usertext;this.$set(f,"text",e),f.value=a,0<r.length&&(f.schema=n),this.$bus.emit("selectUserBus",v(v({},f),{},{metaData:this.metaData,subFormIndex:this.subFormIndex,selectArr:t})),this.$emit("selectuser",f)},smsTo:function(t){t?window.location.href="sms:".concat(t):dsf.layer.toast("暂未获取到该用户电话")},phoneTo:function(t){t?window.location.href="tel:".concat(t):dsf.layer.toast("暂未获取到该用户电话")},delUser:function(a){this.$set(this.usertext,"text",this.usertext.text.split(",").filter(function(t,e){return e!=a}).join(",")),this.usertext.value=this.usertext.value.split(",").filter(function(t,e){return e!=a}).join(","),0==this.selectType&&(this.usertext.schema=this.usertext.schema.split(",").filter(function(t,e){return e!=a}).join(","))}}},y=(0,n(51900).Z)(e,function(){var a=this,s=a._self._c;return!a.readonly||a.readonly&&a.usertext.text?s("div",{staticClass:"controlUser"},["showTelicon"==a.metaData.extra.eatraClass&&a.readonly?s("div",a._l(a.telList,function(e){return s("div",{key:e.id,staticClass:"showTel"},[s("span",[a._v(a._s(e.userName))]),a._v(" "),s("img",{attrs:{src:n(66628),alt:""},on:{click:function(t){return a.phoneTo(e.mobile)}}}),a._v(" "),s("i",{staticClass:"iconfont iconletter infoName infoColor",on:{click:function(t){return a.smsTo(e.mobile)}}})])}),0):s("van-field",{attrs:{autosize:"",type:"textarea","show-word-limit":"",placeholder:a.controlData.placeholder,readonly:!0,rules:a.controlData.rules,rows:a.rows,name:a.metaData&&a.metaData.metaId?a.metaData.metaId:""},on:{click:a.getUser},scopedSlots:a._u([{key:"input",fn:function(){return[a.usertext.text?s("div",{class:["selectUser",{flex:1!=a.metaData.extra.mobileAddLink}]},[1==a.metaData.extra.mobileAddLink?a._l(a.usertextArr,function(t,e){return s("span",{key:e,staticStyle:{color:"#0086d9","word-break":"break-all","overflow-wrap":"break-word"},on:{click:function(t){return t.stopPropagation(),a.toMailDetail(e)}}},[a._v("\n            "+a._s(t)+a._s(e<a.usertextArr.length-1?",":"")+"\n          ")])}):a.readonly||!a.dsf.config.commonForm.isEnableControlUserTagDel?s("div",{staticStyle:{flex:"1"}},[a._v("\n          "+a._s(a.usertext.text)+"\n        ")]):a._l(a.usertextArr,function(t,e){return s("span",{key:e,staticClass:"delTag"},[a._v("\n            "+a._s(t)+"\n            "),s("van-icon",{attrs:{name:"cross",size:"0.28rem"},on:{click:function(t){return a.delUser(e)}}})],1)})],2):a._e()]},proxy:!0},a.readonly?null:{key:"right-icon",fn:function(){return[s("i",{staticClass:"iconfont iconyoujiantou1"})]},proxy:!0}],null,!0),model:{value:a.usertext.text,callback:function(t){a.$set(a.usertext,"text",t)},expression:"usertext.text"}}),a._v(" "),s("van-popup",{style:{height:"100%"},attrs:{"get-container":a.getContainer,position:"bottom"},model:{value:a.show,callback:function(t){a.show=t},expression:"show"}},[a.show?s("control-user-list",{attrs:{metaId:a.metaData.metaId,extra:a.metaData.extra,selectType:a.selectType,"default-select-array":a.defaultSelectArray,topformMeta:a.topformMeta},on:{close:a.close,getSelectUser:a.getSelectUser}}):a._e()],1),a._v(" "),s("van-popup",{staticClass:"flex dc",staticStyle:{height:"100vh"},attrs:{"get-container":a.getContainer,position:"bottom"},model:{value:a.showMailDetail,callback:function(t){a.showMailDetail=t},expression:"showMailDetail"}},[s("van-nav-bar",{on:{"click-left":function(t){a.showMailDetail=!1}},scopedSlots:a._u([{key:"left",fn:function(){return[s("van-icon",{attrs:{name:"arrow-left"}}),a._v(" "),s("span",[a._v("返回")])]},proxy:!0}],null,!1,3247808921)}),a._v(" "),a.showMailDetail?s("mail-detail",{staticStyle:{flex:"1"},attrs:{_userdata:a.userdata}}):a._e()],1)],1):a._e()},[],!1,null,"2e76f2a6",null).exports},82695:function(t,e,n){n.r(e),n.d(e,{default:function(){return u}});var a=n(66250),e=n(77193),s=(n(85684),n(43567)),o=n(33453),i=n.n(o),r=n(2728),l=n(8250),o=n(42152),c=n.n(o),o={components:(0,e.Z)({},s.Z.Component.name,s.Z.Component),props:["_userdata"],data:function(){return{default_avatar:'this.src="'+n(11727)+'"',userdata:{},showProps:[],docTitle:"",navs:[],deptname:"",actions:[],show:!1,selectNumber:"",btnCopy:null}},methods:{copyText:function(t){var e=this;e.btnCopy.on("success",function(t){dsf.layer.toast("复制成功"),t.clearSelection(),e.btnCopy.destroy()}),e.btnCopy.on("error",function(t){dsf.layer.toast("复制失败"),e.btnCopy.destroy()})},actionCilck:function(t,e){0==e?this.phoneTo(this.selectNumber):2==e?$iaction.savePhoneNumber({phoneNumber:this.selectNumber,name:this.userdata.userName,type:0},function(t){},function(t){}):1==e&&this.copyText(this.selectNumber)},goChat:function(){var t="".concat(dsf.config.IMSetting.OATOIM,"#/SSOLogin?toid=").concat(this.userdata.userId);dsf.util.loadSessionStore("imAccessToken")?t+="&accessToken=".concat(dsf.util.loadSessionStore("imAccessToken")):t+="&logname=".concat(dsf.util.loadSessionStore("user").logName),"app"==dsf.util.getClientName()?l.Z.getIMId()?l.Z.toPrivateChat(this.userdata.userId):xsfWindow.openWebView({title:"即时通讯",url:t,colorString:"#111111"}):dsf.layer.toast("当前菜单仅支持在App中使用")},previewPhoto:function(t){(0,s.Z)({images:[t],closeable:!0})},getPhotoSrc:function(t){return dsf.url.getWebPath(t)},phoneTo:function(t){window.location.href="tel:".concat(t)},smsTo:function(t){window.location.href="sms:".concat(t)},toImgChange:function(){},setTitle:function(){this.$route.query&&this.$route.query.title?r.Z.setTitle(this.$route.query.title):r.Z.setTitle(" ")},goPhonePop:function(e){var t=this;t.selectNumber=e,t.show=!0,t.$nextTick(function(){document.querySelectorAll(".actionStyle").forEach(function(t){t.setAttribute("data-clipboard-text",e)}),t.btnCopy=new(c())(document.querySelectorAll(".actionStyle"))})},onCancel:function(){}},created:function(){var s=this,n=this;n.actions.push({name:"呼叫"}),n.actions.push({name:"复制号码",className:"actionStyle"}),"android"==dsf.util.checkSystem()&&"app"==dsf.util.getClientName()&&n.actions.push({name:"添加到通讯录"}),this.showProps=dsf.config.mailList.mailDetailShow.filter(function(t){return t.ifShow}),this.userdata=this._userdata||JSON.parse(this.$route.query.userdata),n.$toast.loading("加载中"),dsf.http.post("/fn/contacts/getMobileUserDetail",{userId:this.userdata.userId,pk:this.userdata.pk||""}).then(function(){var e=(0,a.Z)(i().mark(function t(e){var a;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("zydx"==dsf.config.projectName)return t.next=3,dsf.util.isMyDept(e.data.data.orgNameLv1Text);t.next=6;break;case 3:if(t.sent){t.next=6;break}e.data.data.mobile="",s.showProps=s.showProps.filter(function(t){return"mobile"!=t.prop});case 6:s.userdata=e.data.data,s.navs=e.data.data.navs,s.navs?null!=(a=s.navs)&&a.forEach(function(t,e){""!=s.deptname&&(s.deptname+="-"),0<e&&(s.deptname+=t.name)}):s.deptname=s.userdata.orgName,n.$toast.clear();case 10:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())},filters:{filterName:function(t){return t.slice(t.length-2)},filterMobile:function(t,e){return e.mobileDesensitizationSafeContent||t},filterEmail:function(t,e){return e.emailDesensitizationSafeContent||t},userAvatar:function(t){return t.slice(t.length-2)}}},u=(0,n(51900).Z)(o,function(){var a=this,s=a._self._c;return s("div",{directives:[{name:"show",rawName:"v-show",value:a.userdata&&a.userdata.userName,expression:"userdata && userdata.userName"}],staticClass:"mailDetail"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[s("div",{staticClass:"name"},[a._v(a._s(a.userdata.userName))])]),a._v(" "),s("div",{staticClass:"photo"},[a.userdata.photoSrc?s("img",{attrs:{src:a.getPhotoSrc(a.userdata.photoSrc),onerror:a.default_avatar},on:{click:function(t){a.previewPhoto(a.getPhotoSrc(a.userdata.photoSrc))}}}):s("div",{staticClass:"userImg"},[a._v(a._s(a._f("filterName")(a.userdata.userName)))])])]),a._v(" "),a.navs&&a.navs.length?s("div",{staticClass:"orgName"},[a._v(a._s(a.navs[0].name))]):a._e(),a._v(" "),a._l(a.showProps,function(t,e){return s("div",{key:e,staticClass:"propBox"},["userName"==t.prop?s("div",{staticClass:"infoItem disfr"},[s("div",{staticClass:"info flex1 fc jsb"},[s("span",{staticClass:"infoText"},[a._v(a._s(t.text))]),a._v(" "),s("span",{staticClass:"infoName"},[a._v(a._s(a.userdata.userName))])])]):"tel"==t.prop?s("div",{staticClass:"infoItem disfr"},[s("div",{staticClass:"info flex1 fc jsb"},[s("span",{staticClass:"infoText"},[a._v(a._s(t.text))]),a._v(" "),s("span",{staticClass:"infoName infoColor",on:{click:function(t){return a.goPhonePop(a.userdata.tel)}}},[a._v(a._s(a.userdata.tel))]),a._v(" "),a.userdata.tel?s("div",{staticClass:"itemIcon"},[s("img",{attrs:{src:n(2693),alt:""},on:{click:function(t){return a.phoneTo(a.userdata.tel)}}})]):a._e()])]):"mobile"==t.prop?s("div",{staticClass:"infoItem disfr"},[s("div",{staticClass:"info flex1 fc jsb"},[s("span",{staticClass:"infoText"},[a._v(a._s(t.text))]),a._v(" "),s("span",{staticClass:"infoName infoColor",on:{click:function(t){return a.goPhonePop(a.userdata.mobile)}}},[a._v("\n                    "+a._s(a._f("filterMobile")(a.userdata.mobile,a.userdata))+"\n                ")])]),a._v(" "),a.userdata.mobile?s("div",{staticClass:"itemIcon disfr ac"},[s("img",{attrs:{src:n(66628),alt:""},on:{click:function(t){return a.phoneTo(a.userdata.mobile)}}}),a._v(" "),s("i",{staticClass:"iconfont iconletter infoName infoColor",on:{click:function(t){return a.smsTo(a.userdata.mobile)}}})]):a._e()]):"email"==t.prop?s("div",{staticClass:"infoItem disfr"},[s("div",{staticClass:"info flex1 fc jsb"},[s("span",{staticClass:"infoText"},[a._v(a._s(t.text))]),a._v(" "),s("span",{staticClass:"infoName"},[a._v(a._s(a._f("filterEmail")(a.userdata.email,a.userdata)))])]),a._v(" "),s("div",{staticClass:"itemIcon disfr ac"})]):"orgName"==t.prop?s("div",{staticClass:"infoItem disfr"},[s("div",{staticClass:"info flex1 fc jsb"},[s("span",{staticClass:"infoText"},[a._v(a._s(t.text))]),a._v(" "),s("span",{staticClass:"infoName"},[a._v(a._s(a.deptname))])])]):s("div",{staticClass:"infoItem disfr"},[s("div",{staticClass:"info flex1 fc jsb"},[s("span",{staticClass:"infoText"},[a._v(a._s(t.text))]),a._v(" "),s("span",{staticClass:"infoName"},[a._v(a._s(a.userdata[t.prop]))])])])])}),a._v(" "),a.dsf.config.IMSetting&&a.dsf.config.IMSetting.OATOIM?s("div",{staticClass:"btn-container"},[s("van-button",{staticClass:"btn",attrs:{type:"info"},on:{click:a.goChat}},[a._v("发消息\n        ")])],1):a._e(),a._v(" "),s("van-action-sheet",{attrs:{actions:a.actions,"cancel-text":"取消","close-on-click-action":""},on:{cancel:a.onCancel,select:a.actionCilck},model:{value:a.show,callback:function(t){a.show=t},expression:"show"}})],2)},[],!1,null,"d720e97e",null).exports},66628:function(t,e,a){t.exports=a.p+"static/img/mailDetail_phone.c773bcc..png"},2693:function(t,e,a){t.exports=a.p+"static/img/tel.a09f5bc..png"}}]);