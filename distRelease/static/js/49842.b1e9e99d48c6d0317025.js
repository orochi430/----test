"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[49842],{61645:function(t,e,a){a.d(e,{Z:function(){return i}});var n=a(90541),l=a(25108),e={name:"addFile",components:{},props:{show:{type:Boolean,default:!1},fid:{type:String,default:""},listType:{type:String|Number,default:4}},data:function(){return{maxSize:0,list:[{icon:a(63769),title:"上传图片",type:"image",accept:"image/*"},{icon:a(66121),title:"上传视频",type:"video",accept:"video/*"},{icon:a(55905),title:"上传文件",type:"document",accept:"*"},{icon:a(90203),title:"新建文件夹",type:"folder",accept:""}],addFolder:!1,folderName:""}},computed:{},watch:{},created:function(){},mounted:function(){this.getMaxFileSize()},methods:{close:function(){this.$emit("closeAddFile")},addNew:function(t){"folder"==t.type&&(this.folderName="",this.addFolder=!0)},closeAddFolder:function(){this.addFolder=!1,this.close()},doAddFolder:function(){var e=this;this.folderName?n.Z.http.post("/fn/cloud/file/addDirectory",{fid:this.fid,name:this.folderName,listType:this.listType},{headers:{"Content-Type":"application/json"}}).then(function(t){t.data&&"200"==t.data.code&&e.closeAddFolder()}).catch(function(t){}).finally(function(){}):n.Z.layer.toast("请输入文件夹名称")},getMaxFileSize:function(){var e=this;n.Z.http.get("/fn/cloud/file/getMaxFileSize").then(function(t){t.data&&"200"==t.data.code&&(e.maxSize=t.data.data)}).catch(function(t){}).finally(function(){})},afterRead:function(t){for(var e=this,i=(l.log(t),[]),s=(Array.isArray(t)?t.forEach(function(t){i.push(t.file)}):i=[t.file],0),a=new FormData,o=0;o<i.length;o++)s+=i[o].size,a.append("files",i[o]);a.append("fid",this.fid),a.append("listType",this.listType),0!=this.maxSize&&this.maxSize<s?(t=this.maxSize/1048576,n.Z.layer.toast("文件不能超过".concat(t,"M"))):(this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),n.Z.http.post("fn/cloud/file/uploadFile",a,{headers:{"Content-Type":"multipart/form-data"},timeout:2e6}).then(function(t){e.$toast.clear(),t.data&&"200"==t.data.code?(n.Z.layer.toast(t.data.message),e.$emit("closeAddFile")):n.Z.layer.toast(t.data.message)}).finally(function(t){e.$toast.clear()}))}}},i=(0,a(51900).Z)(e,function(){var i=this,s=i._self._c;return s("div",[s("van-popup",{attrs:{position:"bottom",round:"","get-container":"#app","close-on-click-overlay":!1},on:{"click-overlay":i.close},model:{value:i.show,callback:function(t){i.show=t},expression:"show"}},[s("div",{staticClass:"addFile"},[s("p",{staticClass:"addtitle"},[i._v("新建")]),i._v(" "),s("ul",i._l(i.list,function(e,t){return s("li",{key:t,staticClass:"items"},["folder"!=e.type?s("van-uploader",{attrs:{multiple:!0,accept:e.accept,"after-read":i.afterRead}},[s("img",{attrs:{src:e.icon,alt:""}}),i._v(" "),s("span",[i._v(i._s(e.title))])]):i._e(),i._v(" "),"folder"==e.type?s("div",{on:{click:function(t){return i.addNew(e)}}},[s("img",{attrs:{src:e.icon,alt:""}}),i._v(" "),s("span",[i._v(i._s(e.title))])]):i._e()],1)}),0)])]),i._v(" "),s("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:i.addFolder,callback:function(t){i.addFolder=t},expression:"addFolder"}},[s("div",{staticClass:"addFolder"},[s("div",{staticClass:"header"},[s("van-icon",{attrs:{name:"cross"},on:{click:i.closeAddFolder}}),i._v(" "),s("p",[i._v("新建文件夹")]),i._v(" "),s("span",{on:{click:i.doAddFolder}},[i._v("完成")])],1),i._v(" "),s("div",{staticClass:"inputs"},[s("img",{attrs:{src:a(2793),alt:"",srcset:""}}),i._v(" "),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:i.folderName,expression:"folderName",modifiers:{trim:!0}}],attrs:{type:"text",maxlength:"20",placeholder:"输入文件夹名称"},domProps:{value:i.folderName},on:{input:function(t){t.target.composing||(i.folderName=t.target.value.trim())},blur:function(t){return i.$forceUpdate()}}})])])])],1)},[],!1,null,"5ec5c9c8",null).exports},52299:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var i=a(77193),e=a(79529),s=a.n(e),e=a(2319),o=a(3645),n=a(61645),l=a(69273),c=a(25108),e={name:"diskFileList",components:{FileItem:e.Z,FileGrid:o.Z,AddFile:n.Z,fileTypeIcon:l.Z},data:function(){var t={list:[],finished:!1,loading:!1,refreshing:!1,start:1,limit:15,fid:"",keyword:"",addFile:!1,listType:1,folderName:"",canUpload:!1,showBatch:!1,result:[],isCheckAll:!0,addFolder:!1};return(0,i.Z)(t,"folderName",""),(0,i.Z)(t,"direList",[]),(0,i.Z)(t,"direFid",""),(0,i.Z)(t,"curFid",""),(0,i.Z)(t,"moveFolder",!1),(0,i.Z)(t,"actionType",""),(0,i.Z)(t,"canUpload",!1),(0,i.Z)(t,"showSelect",!1),(0,i.Z)(t,"selected",5),(0,i.Z)(t,"selectList",[{name:"按名称",term:[{name:"从A到Z",orderType:1,reversed:!1,value:1},{name:"从Z到A",orderType:1,reversed:!0,value:2}]},{name:"更新时间",term:[{name:"从近到远",orderType:3,reversed:!1,value:3},{name:"从远到近",orderType:3,reversed:!0,value:4}]},{name:"创建时间",term:[{name:"从近到远",orderType:2,reversed:!1,value:5},{name:"从远到近",orderType:2,reversed:!0,value:6}]},{name:"文件大小",term:[{name:"从小到大",orderType:4,reversed:!1,value:7},{name:"从大到小",orderType:4,reversed:!0,value:8}]}]),(0,i.Z)(t,"orderType",2),(0,i.Z)(t,"reversed",!0),(0,i.Z)(t,"topDireList",[]),(0,i.Z)(t,"batchListType",""),(0,i.Z)(t,"timer",null),(0,i.Z)(t,"showBack",dsf.config.appTopMenu&&dsf.config.appTopMenu.value),t},computed:{},watch:{},methods:{onClickLeft:function(){this.$router.go(-1)},onLoad:function(){var i=this,s=this;s.nodata=!1,dsf.http.post("ctrl/cloud/file/listFileByFid",{fid:this.fid,orderType:this.orderType,reversed:this.reversed,pageNo:this.start,pageSize:this.limit,fileNameQuery:this.keyword},{headers:{"Content-Type":"application/json"}}).then(function(t){var e=t.status,t=t.data;c.log(t,e),200===e?(0==t.data.length&&1==s.start&&(s.nodata=!0),t&&t.data&&0<t.data.length&&(t.data.forEach(function(t){t.lastUpdateTime=moment(new Date(t.lastUpdateTime)).calendar()}),s.list=s.list.concat(t.data)),t.data.length<s.limit?i.finished=!0:s.start+=1):(i.finished=!0,s.nodata=!0)}).catch(function(t){t.message;i.finished=!0,s.nodata=!0}).finally(function(){i.loading=!1,i.refreshing=!1})},doRefresh:function(){this.start=1,this.list=[],this.finished=!1,this.loading=!0,this.onLoad()},goFileList:function(t){1==t.isDirectory&&this.$router.push({name:"diskFileList",params:{fid:t.id},query:{listType:t.fileType,name:t.name}})},closeAddFile:function(){this.addFile=!1,this.doRefresh()},getFolderDeail:function(){var e=this;dsf.http.post("/fn/cloud/file/getFileById",{id:this.fid}).then(function(t){t.data&&"200"==t.data.code&&e.checkFolderUpload(t.data.data.fileType)}).catch(function(t){}).finally(function(){})},checkFolderUpload:function(t){var i=this;dsf.http.post("ctrl/cloud/privilege/checkFolderUpload",{fileId:this.fid,listType:t},{headers:{"Content-Type":"application/json"}}).then(function(t){var e=t.status,t=t.data;c.log(t,e),200===e&&t.data&&(i.canUpload=!0)}).catch(function(t){t.message}).finally(function(){})},closeSelect:function(){this.showSelect=!1},changeSelect:function(t){this.selected=t.value,this.orderType=t.orderType,this.reversed=t.reversed,this.doRefresh(),this.showSelect=!1},resetSelect:function(){this.selected=0,this.orderType=2,this.reversed=!1,this.showSelect=!1,this.doRefresh()},handleLongPress:function(){this.showBatch=!0,this.result=[]},complete:function(){this.showBatch=!1,this.result=[]},selectAll:function(){var e=this;this.isCheckAll?(this.result=[],this.list.forEach(function(t){e.result.push(t.id)})):this.result=[],this.isCheckAll=!this.isCheckAll},resultChange:function(){this.result.length==this.list.length?this.isCheckAll=!1:this.isCheckAll=!0},doRealFadeIn:function(){var t=this;this.$toast.loading({forbidClick:!0,message:"正在检查相关权限..."}),dsf.http.post("/fn/cloud/privilege/checkBatchMenuRight",{itemType:"move",fileIdList:this.result},{headers:{"Content-Type":"application/json"}}).then(function(e){var i;e.data&&"200"==e.data.code&&(e.data.data.forbidList&&0<e.data.data.forbidList.length?(i="",t.list.forEach(function(t){e.data.data.forbidList.includes(t.id)&&(i?i+="[".concat(t.name,"]、"):i="[".concat(t.name,"]"))}),dsf.layer.toast("所选文件："+i+"无权或不支持")):t.moveFolder=!0)}).catch(function(t){}).finally(function(){t.$toast.clear()})},batchAdd:function(){0==this.result.length?dsf.layer.toast("请选择需要操作的记录！"):(this.direFid="",this.curFid="",this.actionType="addTo",this.doRealFadeIn())},batchMove:function(){0==this.result.length?dsf.layer.toast("请选择需要操作的记录！"):(this.direFid="",this.curFid="",this.actionType="move",this.doRealFadeIn())},batchDelete:function(){var e=this;0==this.result.length?dsf.layer.toast("请选择需要操作的记录！"):(this.$toast.loading({forbidClick:!0,message:"文件操作中..."}),dsf.http.post("/fn/cloud/recyclebin/delete",{fileIds:this.result.join(",")}).then(function(t){t.data&&"200"==t.data.code&&(dsf.layer.toast("操作成功"),e.showBatch=!1,e.moveFolder=!1,e.doRefresh())}).catch(function(t){}).finally(function(){e.$toast.clear()}))},closePopup:function(){this.showItem=!1},goDireTop:function(t){this.batchListType=t.value,this.curFid="0",this.getDireList()},getDireList:function(){var e=this;dsf.http.post("/fn/cloud/file/getDirectoryTree",{fid:this.curFid||0,listType:this.batchListType,excludeIds:this.result},{headers:{"Content-Type":"application/json"}}).then(function(t){t.data&&"200"==t.data.code&&(e.direList=t.data.data)}).catch(function(t){}).finally(function(){})},goBackUp:function(){var t;""==this.curFid?(this.moveFolder=!1,this.closePopup()):"0"==this.curFid?this.curFid="":(""==this.direFid?this.curFid="0":this.curFid==this.direFid?(this.curFid="0",this.direFid=""):(t=this.direFid.split(","),this.curFid=t[t.length-2],this.direFid=t.slice(0,-1).join(",")),this.getDireList())},goDire:function(t){this.direFid?this.direFid+=","+t.id:this.direFid=t.id,this.curFid=t.id,this.getDireList()},fadeinThis:function(){var e=this;this.$toast.loading({forbidClick:!0,message:"文件操作中..."}),"move"==this.actionType?dsf.http.post("/fn/cloud/file/move",{fileIds:this.result,listType:this.batchListType,targetId:this.curFid||0},{headers:{"Content-Type":"application/json"}}).then(function(t){t.data&&"200"==t.data.code&&(dsf.layer.toast("操作成功"),e.showBatch=!1,e.moveFolder=!1,e.doRefresh())}).catch(function(t){}).finally(function(){e.$toast.clear()}):"addTo"==this.actionType&&dsf.http.post("/fn/cloud/file/copy",{fileIds:this.result,listType:this.batchListType,targetId:this.curFid||0,excludeId:this.result},{headers:{"Content-Type":"application/json"}}).then(function(t){t.data&&"200"==t.data.code&&(dsf.layer.toast("操作成功"),e.showBatch=!1,e.moveFolder=!1)}).catch(function(t){}).finally(function(){e.$toast.clear()})},getTopDireList:function(){var e=this;dsf.http.post("/fn/cloud/privilege/getLeftCopyItem",{}).then(function(t){t.data&&"200"==t.data.code&&(e.topDireList=t.data.data)}).catch(function(t){}).finally(function(){})}},created:function(){this.fid=this.$route.params.fid||"",this.listType=s()(this.$route.query.listType)||1,this.folderName=this.$route.query.name||""},mounted:function(){this.getFolderDeail(),this.getTopDireList()},destroyed:function(){}},d=(0,a(51900).Z)(e,function(){var i=this,s=i._self._c;return s("div",{staticClass:"diskFileList"},[i.showBack?s("van-nav-bar",{attrs:{title:"","left-text":"返回","left-arrow":""},on:{"click-left":i.onClickLeft}}):i._e(),i._v(" "),s("div",{staticClass:"title"},[i._v(i._s(i.folderName))]),i._v(" "),s("van-search",{attrs:{placeholder:"在当前文件夹中搜索","left-icon":"",clearable:!1},on:{search:i.doRefresh},scopedSlots:i._u([{key:"left-icon",fn:function(){return[s("i",{staticClass:"iconfont iconsousuo i1",staticStyle:{color:"#989A9F"}})]},proxy:!0}]),model:{value:i.keyword,callback:function(t){i.keyword=t},expression:"keyword"}}),i._v(" "),s("div",{staticClass:"wrapBox"},[i.showBatch?i._e():s("div",{staticClass:"order"},[s("p",{staticClass:"titleText"},[i._v("文件列表")]),i._v(" "),s("p",{staticClass:"icons"},[s("img",{attrs:{src:a(40297),alt:""},on:{click:function(t){i.showSelect=!0}}})])]),i._v(" "),i.showBatch?s("div",{staticClass:"batchTop"},[s("span",[i._v("已选"+i._s(i.result.length)+"项")]),i._v(" "),s("p",[s("span",{on:{click:i.selectAll}},[i._v(i._s(i.isCheckAll?"全选":"取消全选"))]),i._v(" "),s("span",{on:{click:i.complete}},[i._v("完成")])])]):i._e(),i._v(" "),s("div",{staticClass:"disk-file-list"},[s("van-pull-refresh",{attrs:{disabled:i.finished},on:{refresh:i.doRefresh},model:{value:i.refreshing,callback:function(t){i.refreshing=t},expression:"refreshing"}},[s("van-list",{attrs:{finished:i.finished,"finished-text":""},on:{load:i.onLoad},model:{value:i.loading,callback:function(t){i.loading=t},expression:"loading"}},[[1,2,11,4].includes(i.listType)?s("van-checkbox-group",{on:{change:i.resultChange},model:{value:i.result,callback:function(t){i.result=t},expression:"result"}},i._l(i.list,function(t,e){return s("div",{key:e,staticClass:"itembox"},[i.showBatch?s("van-checkbox",{attrs:{name:t.id}}):i._e(),i._v(" "),s("file-item",{directives:[{name:"long-press",rawName:"v-long-press",value:i.handleLongPress,expression:"handleLongPress"}],attrs:{item:t},on:{doRefresh:i.doRefresh}})],1)}),0):i._l(i.list,function(t,e){return s("div",{key:e,staticClass:"itembox"},i._l(i.list,function(t,e){return s("file-item",{key:e,attrs:{item:t},on:{doRefresh:i.doRefresh}})}),1)})],2)],1)],1),i._v(" "),i.canUpload&&!i.showBatch?s("div",{staticClass:"addBtn",on:{click:function(t){i.addFile=!0}}},[s("img",{attrs:{src:a(14294),alt:""}})]):i._e()]),i._v(" "),s("add-file",{attrs:{listType:i.listType,fid:i.fid,show:i.addFile},on:{closeAddFile:i.closeAddFile}}),i._v(" "),s("van-popup",{attrs:{position:"bottom",round:"","get-container":"#app"},model:{value:i.showSelect,callback:function(t){i.showSelect=t},expression:"showSelect"}},[s("div",{staticClass:"select-contain"},[i._l(i.selectList,function(t,e){return s("div",{key:e,staticClass:"select-box"},[s("span",[i._v(i._s(t.name))]),i._v(" "),s("div",i._l(t.term,function(e,t){return s("p",{key:t,class:{active:i.selected==e.value},on:{click:function(t){return i.changeSelect(e)}}},[i._v(i._s(e.name))])}),0)])}),i._v(" "),s("div",{staticClass:"btn"},[s("div",{class:{reset:2!=i.selected},on:{click:i.resetSelect}},[i._v("重置")]),i._v(" "),s("div",{staticClass:"finish",on:{click:i.closeSelect}},[i._v("完成")])])],2)]),i._v(" "),i.showBatch?s("div",{staticClass:"batchBottom"},[s("p",{on:{click:i.batchAdd}},[s("img",{attrs:{src:a(66340),alt:""}}),i._v(" "),s("span",[i._v("添加到")])]),i._v(" "),s("p",{on:{click:i.batchMove}},[s("img",{attrs:{src:a(66340),alt:""}}),i._v(" "),s("span",[i._v("移动到")])]),i._v(" "),s("p",{on:{click:i.batchDelete}},[s("img",{attrs:{src:a(79158),alt:""}}),i._v(" "),s("span",[i._v("删除")])])]):i._e(),i._v(" "),s("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},on:{close:i.closePopup},model:{value:i.moveFolder,callback:function(t){i.moveFolder=t},expression:"moveFolder"}},[s("div",{staticClass:"directory"},[s("van-nav-bar",{attrs:{title:"云盘","left-text":"返回","left-arrow":""},on:{"click-left":i.goBackUp}}),i._v(" "),""!=i.curFid?s("div",{staticClass:"direList"},i._l(i.direList,function(e,t){return s("div",{key:t,staticClass:"dire",on:{click:function(t){return i.goDire(e)}}},[s("div",{staticClass:"fileIcon"},[s("fileTypeIcon",{attrs:{"file-name":e.name,width:32,height:38,isDirectory:e.isDirectory}})],1),i._v(" "),s("div",{staticClass:"fileBody"},[s("div",{staticClass:"fileTitle"},[i._v(i._s(e.name))]),i._v(" "),s("div",{staticClass:"filePath"},[s("label",[i._v(i._s(e.fileSizeText))]),i._v(" "),s("label",[i._v(i._s(e.ownerName))]),i._v(" "),s("label",[i._v(i._s(e.lastUpdateTime)+" 更新")])])]),i._v(" "),s("div",{staticClass:"moreIcon"},[s("img",{attrs:{src:a(12547),alt:""}})])])}),0):i._e(),i._v(" "),""==i.curFid?s("div",{staticClass:"direList"},i._l(i.topDireList,function(e,t){return s("div",{key:t,staticClass:"dire",on:{click:function(t){return i.goDireTop(e)}}},[s("div",{staticClass:"fileIcon"},[s("fileTypeIcon",{attrs:{"file-name":e.name,width:32,height:38,isDirectory:1}})],1),i._v(" "),s("div",{staticClass:"fileBody"},[s("div",{staticClass:"fileTitle"},[i._v(i._s(e.name))])]),i._v(" "),s("div",{staticClass:"moreIcon"},[s("img",{attrs:{src:a(12547),alt:""}})])])}),0):i._e(),i._v(" "),""!=i.curFid?s("div",{staticClass:"direButton"},[s("van-button",{attrs:{type:"info"},on:{click:i.fadeinThis}},[i._v(i._s("move"==i.actionType?"移动到这里":"添加到这里"))])],1):i._e()],1)])],1)},[],!1,null,"0d0c8cba",null).exports},3645:function(t,e,i){i.d(e,{Z:function(){return a}});var e=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"fileGrid"},[e("div",{staticClass:"file-icon"},[e("img",{staticClass:"fileIcon",attrs:{src:i(15146),alt:""}})]),t._v(" "),e("div",{staticClass:"file-title"},[t._v("DJLog-2023-05-03IMG-5003.MOVIMG-5003.MOV")]),t._v(" "),e("div",{staticClass:"file-size"},[t._v("10.8MB")]),t._v(" "),e("div",{staticClass:"file-more"},[e("img",{attrs:{src:i(3145),alt:""}})])])}],s={name:"fileGrid",components:{},props:{},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{}},a=(0,i(51900).Z)(s,function(){this._self._c;return this._m(0)},e,!1,null,"65ad4ed6",null).exports},14294:function(t,e,i){t.exports=i.p+"static/img/add.62676de..svg"},79158:function(t,e,i){t.exports=i.p+"static/img/delete.9d0e774..png"},2793:function(t,e,i){t.exports=i.p+"static/img/folder.c7d8d49..png"},40297:function(t,e,i){t.exports=i.p+"static/img/order.9261dbe..png"},55905:function(t,e,i){t.exports=i.p+"static/img/upload-file.a6581d8..svg"},90203:function(t,e,i){t.exports=i.p+"static/img/upload-folder.c7d8d49..png"},63769:function(t,e,i){t.exports=i.p+"static/img/upload-img.d85c0b2..png"},66121:function(t,e,i){t.exports=i.p+"static/img/upload-video.039ad74..png"}}]);