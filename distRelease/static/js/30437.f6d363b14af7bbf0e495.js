"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[30437],{30437:function(t,e,a){a.r(e),a.d(e,{default:function(){return s}});var i=a(5044),e={name:"zydxnews",data:function(){return{searchvalue:"",loading:!1,finished:!1,refreshing:!1,successtext:"",finishedtext:"",offsetTop:0,offsetTopTab:0,startindex:0,data:[],tabs:[{name:"全部",xwlx:"all",width:"3em"},{name:"校（院）新闻",xwlx:"xyxw",columnId:"1906101346159VJ7mL1KUHEZrQzKnGc",width:"7em"},{name:"通知公告",xwlx:"",columnId:"190521153131vU89yfMNTbfmiWYswU1",width:"5em"},{name:"部门动态",xwlx:"bmdt",columnId:"1906101346159VJ7mL1KUHEZrQzKnGc",width:"5em"}],tabactive:0,imgpreview:{show:!1,images:[],index:0},isload:!0}},computed:{contentHeight:function(){var t=$("#app footer").height()||0;return document.body.clientHeight-120-t+"px"}},created:function(){var t=this;setTimeout(function(){t.startindex=1,t.getList()},500)},mounted:function(){var t=this;this.$nextTick(function(){t.offsetTop=$("#appTop").height()||0,t.offsetTopTab=t.offsetTop+$(".van-search").outerHeight()+5})},methods:{getCss:function(t){var e=t.ImagePath,a=t.coverimage,t=t.istop,i="";return 0<e.length&&(1!=e.length&&1!=a||(i="haspic"),1<e.length)&&0==a&&(i="haspics"),1==t&&(i+=" istop"),i},onChangeImg:function(t){this.imgpreview.index=t},showImg:function(t,e,a){var i=this;this.imgpreview.index=e,this.imgpreview.images=[],1==a?this.imgpreview.images=[t.ImagePath[0]]:t.ImagePath.forEach(function(t,e){e<3&&i.imgpreview.images.push(t)}),this.imgpreview.show=!0},onCancel:function(){this.searchvalue=""},onRefresh:function(){this.isload=!1,this.initData(1)},onSearch:function(){this.data=[],this.initData()},tabChange:function(){this.initData()},onLoad:function(){this.isload?(this.startindex++,this.getList()):this.loading=!1},initData:function(t){this.finished=!1,t||(this.loading=!0),this.startindex=1,this.getList()},getApi:function(){var t="/ctrl/cmsManager/loadColumnById";return t=0==this.tabactive?"/ctrl/cmsManager/loadColumnAllMsg":t},getList:function(a,i){var s=null;return function(){var t=this,e=arguments;s&&clearTimeout(s),s=setTimeout(function(){a.apply(t,e)},i)}}(function(){var t,e,a=this;0<a.startindex&&(t=a.getApi(),e={},e=0==a.tabactive?{istop:1,key:a.searchvalue,page:a.startindex,limit:15}:{columnId:a.tabs[a.tabactive].columnId,istop:1,issyxs:1,xwlx:a.tabs[a.tabactive].xwlx,page:a.startindex,limit:15,key:a.searchvalue},a.successtext="",a.finishedtext="",dsf.http.post(t,e).then(function(t){var e;"success"==t.data.type?((e=t.data.data).forEach(function(t){t.ImagePath?t.ImagePath=t.ImagePath.split("|"):t.ImagePath=[]}),a.successtext="刷新成功",a.refreshing&&(a.refreshing=!1),a.loading=!1,1==a.startindex&&(a.data=[]),(e.length<15||0==e.length)&&(a.finished=!0,a.finishedtext="没有更多了"),e=e,a.searchvalue&&e.forEach(function(t){t.title=a.showKeyWord(t.title)}),0<a.data.length?a.data=[].concat((0,i.Z)(a.data),(0,i.Z)(e)):a.data=e):(a.refreshing=!1,a.loading=!1,a.finished=!0,a.dsf.layer.toast(t.data.message,!1)),a.isload=!0}).catch(function(t){a.dsf.layer.toast(t.message||"失败")}).finally(function(){}))},0),showKeyWord:function(t){var a=t,t=this.searchvalue;return a&&t&&(t=t.replace(/\ +/g,",").split(","),a)&&""!=a&&t.forEach(function(t){var e=""+"(".concat(t,")"),e=new RegExp(e,"g");a=a.replace(e,'<span style="color:red; font-weight: bold;">'+t+"</span>")}),a},toDetail:function(t){var e=t.columnname;this.$router.push({path:"/zydx/newsdetail?title="+e,query:{id:t.id||"",t:Math.random()}}),setTimeout(function(){t.readnum=Number(t.readnum)+1},300)},formatDate:function(t){return t=new Date(t.replace(/-/g,"/")),dsf.date.format(t,"yyyy-mm-dd hh:ii:ss")},getCommentTime:function(t){var e,a;return t.pubtime&&t.currentTime?(e=new Date(this.formatDate(t.pubtime)).getTime(),(e=(new Date(this.formatDate(t.currentTime)).getTime()-e)/1e3)<60?"刚刚":e<3600?(a=Math.floor(e/60),"".concat(a,"分钟前")):e<86400?(a=Math.floor(e/3600),"".concat(a,"小时前")):e<864e3?(a=Math.floor(e/86400),"".concat(a,"天前")):t.date):t.date}}},s=(0,a(51900).Z)(e,function(){var a=this,i=a._self._c;return i("div",{staticClass:"news"},[i("div",{staticClass:"news-search"},[i("van-sticky",{attrs:{"offset-top":a.offsetTop}},[i("van-search",{attrs:{clearable:!1,"show-action":"",placeholder:"搜索"},on:{search:a.onSearch},scopedSlots:a._u([{key:"left-icon",fn:function(){return[i("i",{staticClass:"iconfont iconsousuo1",staticStyle:{color:"#fff"}})]},proxy:!0},{key:"action",fn:function(){return[i("div",{on:{click:a.onSearch}},[a._v("筛选")])]},proxy:!0},a.searchvalue?{key:"right-icon",fn:function(){return[i("i",{staticClass:"iconfont iconguanbi",on:{click:function(t){a.searchvalue="",a.onSearch()}}})]},proxy:!0}:null],null,!0),model:{value:a.searchvalue,callback:function(t){a.searchvalue="string"==typeof t?t.trim():t},expression:"searchvalue"}})],1)],1),a._v(" "),i("div",{staticClass:"news-list"},[i("van-tabs",{class:4<a.tabs.length?"swipe":"",attrs:{"line-width":a.tabs[a.tabactive].width,swipeable:"",sticky:"","offset-top":a.offsetTopTab},on:{change:a.tabChange},model:{value:a.tabactive,callback:function(t){a.tabactive=t},expression:"tabactive"}},a._l(a.tabs,function(t){return i("van-tab",{key:t.name,attrs:{title:t.name}},[i("div",{staticClass:"news-list-content"},[i("van-pull-refresh",{attrs:{"success-text":a.successtext},on:{refresh:a.onRefresh},model:{value:a.refreshing,callback:function(t){a.refreshing=t},expression:"refreshing"}},[i("van-list",{style:"min-height:"+a.contentHeight,attrs:{finished:a.finished,"finished-text":a.finishedtext},on:{load:a.onLoad},model:{value:a.loading,callback:function(t){a.loading=t},expression:"loading"}},a._l(a.data,function(e){return i("div",{key:e.id,staticClass:"news-list-content-item",class:a.getCss(e),on:{click:function(t){return a.toDetail(e)}}},[0==e.ImagePath.length?[i("div",{staticClass:"con"},[i("div",{staticClass:"caption"},[i("p",{domProps:{innerHTML:a._s(e.title)}})]),a._v(" "),i("div",{staticClass:"des"},[1==e.istop?i("span",{staticClass:"item top"},[a._v("置顶")]):a._e(),a._v(" "),i("span",{staticClass:"item fbbm"},[a._v(a._s(e.fbbm))]),a._v(" "),i("span",{staticClass:"item date"},[a._v(a._s(a.getCommentTime(e)))]),a._v(" "),i("span",{staticClass:"item"},[a._v(a._s(e.readnum)+"浏览")])])])]:a._e(),a._v(" "),0<e.ImagePath.length?[i("div",{staticClass:"con"},[i("div",{staticClass:"caption"},[1==e.ImagePath.length||1==e.coverimage?i("div",{staticClass:"img"},[i("img",{attrs:{src:e.ImagePath[0]}})]):a._e(),a._v(" "),i("p",{domProps:{innerHTML:a._s(e.title)}})]),a._v(" "),i("div",{staticClass:"des"},[1==e.istop?i("span",{staticClass:"item top"},[a._v("置顶")]):a._e(),a._v(" "),i("span",{staticClass:"item fbbm"},[a._v(a._s(e.fbbm))]),a._v(" "),i("span",{staticClass:"item date"},[a._v(a._s(a.getCommentTime(e)))]),a._v(" "),i("span",{staticClass:"item"},[a._v(a._s(e.readnum)+"浏览")])])]),a._v(" "),1<e.ImagePath.length&&0==e.coverimage?i("div",{staticClass:"imglist"},[a._l(e.ImagePath,function(t,e){return[e<3?i("div",{key:e,staticClass:"img"},[i("img",{attrs:{src:t}})]):a._e()]})],2):a._e()]:a._e()],2)}),0)],1)],1)])}),1)],1)])},[],!1,null,"582b9b36",null).exports}}]);