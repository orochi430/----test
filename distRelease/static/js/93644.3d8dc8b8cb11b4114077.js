"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[93644],{9776:function(e,t,a){a.r(t);function u(e,t){d.Z.http.post("fn/assets/getLocation",e).done(function(e){"success"==e.type?t.main.B0045.value=e.data:l.log("getLocation-error",e.message)})}var n=a(26243),i=a.n(n),d=a(90541),l=a(25108),n={},o=d.Z.config.homePage.asset.form.entry.listId,s=d.Z.config.homePage.asset.form.cachedMetas,r=(n.initHandle=function(o,e,s){var t=s.$route.query.code;if(t){s.$set(o.main,"B0025",{value:t});var a=d.Z.util.loadSessionStore("assetInfoTemp");if(a)for(var n=0,r=i()(a);n<r.length;n++){var c=r[n];s.$set(o.main,c,a[c])}}f(e),s.$watch(function(){return o.main["C-ERP-OFFICE-REPAIR-0016"]},function(e,t){var a,n;l.log("C-ERP-OFFICE-REPAIR-0016",o.main["C-ERP-OFFICE-REPAIR-0016"]),a=e.value,n=s,d.Z.http.post("fn/assets/getDeptByUser",{userId:a}).done(function(e){"success"==e.type?n.$set(n.formData.main,"B0051",{value:e.data.deptId,text:e.data.deptName,schema:e.data.schema}):l.log("getDeptByUser-error",e.message)}),u({userId:e.value},o)},{deep:!0}),s.$watch(function(){return o.main.B0051},function(e,t){l.log("B0051",o.main.B0051),o.main["C-ERP-OFFICE-REPAIR-0016"]&&o.main["C-ERP-OFFICE-REPAIR-0016"].value||u({deptId:e.value},o)},{deep:!0})},n.saveToNext=function(t,e,a){var n={};s&&s.forEach(function(e){n[e]=t.main[e]}),d.Z.util.saveToSessionStore("assetInfoTemp",n),a.buttonHandle.save(a.$route.params,a.formMeta,a.formData,a,a.$refs,r)},function(t,e,a){"app"==d.Z.util.getClientName()?xsfBarcode.scan(function(e){l.log("scan",e),e.cancelled||c(e.text,t)},function(e){alert("扫码失败: "+e)}):d.Z.dd&&d.Z.dd.scan(function(e){l.log("scan",e),c(e.text,t)},function(e){l.log("scan",e)})}),c=function(t,a){t?d.Z.http.post("fn/assets/checkCode",{code:t}).done(function(e){"success"==e.type?0==e.data?a.$router.replace({path:"/commonForm/".concat(a.$route.params.moduleId),query:{code:t,listId:o,method:"ydedit"}}):d.Z.layer.alert({message:"该条码已完成入库登记"}):d.Z.layer.alert({message:"".concat(e.message)})}).error(function(e){l.log("checkCode-error =",e),d.Z.layer.alert({message:"".concat(e)})}).always(function(){}):d.Z.layer.alert({message:"无效的条形码"})},f=function(t){d.Z.http.get("fn/getUser/getRole").done(function(e){"success"==e.type&&((e=t.controls.find(function(e){return"C-ERP-OFFICE-REPAIR-0016"==e.metaId}))&&(e.extra.tabs[0]={action:"fn/user/select/data?types=person&rootObject=5&action=self_org&async=true&moduleId=".concat(t.parameters.moduleId),name:"本机构",subTabKey:"department"}),(e=t.controls.find(function(e){return"B0051"==e.metaId}))&&(e.extra.tabs[0]={action:"fn/user/select/data?types=department&rootObject=5&action=self_org&async=true&moduleId=".concat(t.parameters.moduleId),name:"本机构",subTabKey:"department"}),l.log("formStruct",t))}).error(function(e){l.log("getRole-error =",e)}).always(function(){})};t.default=n}}]);