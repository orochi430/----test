"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[96478],{41775:function(t,e,n){n.d(e,{Z:function(){return c}});n(23307);var e=n(81392),a=n(26243),s=n.n(a),a=n(79529),l=n.n(a),a=n(46297),i=n(84628),o=n(50856),r=n(25108),a={components:{DsCard:a.Z,DsButtonGroup:i.Z,DsButtonToolbox:o.Z,Icon:e.Z},props:{tabObj:{type:Object},data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},type:{type:String},keyColumn:{type:String},formMethod:{type:String},isHiddenBtn:{type:Boolean,default:function(){}}},data:function(){return{}},created:function(){},computed:{aSubTitles:function(){return r.log(this.columns.filter(function(t){return/^subTitle\w?$/i.test(t.showCategory)})),this.columns.filter(function(t){return/^subTitle\w?$/i.test(t.showCategory)})},bSubTitles:function(){return this.columns.filter(function(t){return/^content$/i.test(t.showCategory)})},needTitles:function(){return this.columns.filter(function(t){return/^needTitle\w?$/i.test(t.showCategory)})},titleIcon:function(){return this.columns.filter(function(t){return/^titleIcon\w?$/i.test(t.showCategory)})}},mounted:function(){r.log(this.bSubTitles)},methods:{isShowColumn:function(t,e){return e.dataValue[t.showMetaColumn]||0===e.dataValue[t.showMetaColumn]},isShowListBtn:function(t){var e=null==this.isHiddenBtn,n=!1,n=!(!t.buttons||!(t.buttons.commonButtons&&0<t.buttons.commonButtons.length||t.buttons.mainButtons&&0<t.buttons.mainButtons.length));return e&&n},link:function(t){var e,n,a,s;t.dataValue.allowMobile&&1!=t.dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):("isRead"in t.dataValue&&!t.dataValue.isRead&&(t.dataValue.isRead=!0),e=(t=t.dataValue)[this.keyColumn]||t.info_id||t.id||t.A0001||t.fid||t["SW_XZD.A0001"],n=this.keyColumn?this.keyColumn.split(".")[0]+".A0004":"",n=t.moduleId||t.A0004||t["SW_XZD.A0004"]||t[n],"db"==this.type&&(n=t.masterModuleId||t.moduleId||t.A0004),s=t.masterId||"",n=n+"/"+e,a={},"gw"==this.type&&(n+="/1",a.todoId=t.todoId),this.type&&(n+="?type=".concat(this.type)),"SigninList"==this.$route.name&&(n+="?&listId=1903161124289nXBk8iVSmTMGYxn9bi&exchangeList=signedList"),"db"==this.type&&(s&&(n+="&masterId=".concat(s)),r.log(this.formMethod),this.formMethod)&&(n+="&formMethod=info"),"dy"==this.type&&(n+="&distribId=".concat(t.distribId),dsf.http.post("fn/mobileToRead/markRead",{pks:t.distribId}).then(function(t){r.log(t)})),this.tabObj&&this.tabObj.targetUrl?(s=this.tabObj.targetUrl.replace("[pk]",e),this.$router.push({path:s})):this.$router.push({path:"/commonForm/"+n,query:a}))},getTitle:function(){return this.columns.find(function(t){return"mainTitle"===t.showCategory})||{}},handleCommonClick:function(t,e,n){e.dataValue.allowMobile&&1!=e.dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):this.$emit("commonClick",t,e,n)},handleMainClick:function(t,e,n){e.dataValue.allowMobile&&1!=e.dataValue.allowMobile?dsf.layer.toast("该文件只能在电脑端处理"):this.$emit("mainClick",t,e,n)},titleIconColor:function(t,e){t=t.dataValue[e.showMetaColumn].substr(0,1);return dsf.config.listTitleIcon&&-1<s()(dsf.config.listTitleIcon).indexOf(t)?(e=dsf.config.listTitleIcon[t],{backgroundColor:this.colorRgba(e,.12),color:e,borderColor:e}):""},colorRgba:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=t.toLowerCase();if(n&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(n)){if(4===n.length){for(var a="#",s=1;s<4;s+=1)a+=n.slice(s,s+1).concat(n.slice(s,s+1));n=a}for(var i=[],o=1;o<7;o+=2)i.push(l()("0x"+n.slice(o,o+2)));return"rgba("+i.join(",")+","+e+")"}return n}}},c=(0,n(51900).Z)(a,function(){var a=this,s=a._self._c;return s("div",{staticClass:"ds-list"},[a._l(a.data,function(n,e){return s("div",{key:n.id||"item-".concat(e),staticClass:"ds-item"},[s("DsCard",["isRead"in n.dataValue&&!n.dataValue.isRead?s("span",{staticClass:"isStatus"}):a._e(),a._v(" "),"readStatus"in n.dataValue&&"2"!=n.dataValue.readStatus?s("span",{staticClass:"isStatus"}):a._e(),a._v(" "),n.dataValue[a.getTitle().showMetaColumn]?s("div",{class:{ellipsis:a.dsf.config.commonList&&a.dsf.config.commonList.titleEllipsis},attrs:{slot:"header"},on:{click:function(t){return a.link(n)}},slot:"header"},[s("span",{class:{"col-title":"isRead"in n.dataValue&&!n.dataValue.isRead||"readStatus"in n.dataValue&&"2"!=n.dataValue.readStatus},style:{color:a.getTitle().color||"","word-wrap":"break-word","word-break":"break-all"}},[a._v("\n                "+a._s(n.dataValue[a.getTitle().showMetaColumn]))])]):a._e(),a._v(" "),s("div",{staticClass:"content",attrs:{slot:"content"},on:{click:function(t){return a.link(n)}},slot:"content"},[a._t("item-content",function(){return[s("div",{staticClass:"flex1"},[0<a.aSubTitles.length?s("div",{staticClass:"aSubTitles"},[a._l(a.aSubTitles,function(t,e){return[a.isShowColumn(t,n)?s("div",{key:"aSubTitles-".concat(e),staticClass:"subTitle"},[t.icon?s("Icon",{class:["iconfont",t.icon]}):a._e(),a._v(" "),s("span",{staticClass:"label",style:{color:t.color}},[a._v(a._s(n.dataValue[t.showMetaColumn]))])],1):a._e()]})],2):a._e(),a._v(" "),0<a.bSubTitles.length?s("div",{staticClass:"bSubTitles"},[a._l(a.bSubTitles,function(t,e){return[a.isShowColumn(t,n)?s("div",{key:"bSubTitles-".concat(e),staticClass:"subTitle"},[t.icon?s("Icon",{class:["iconfont",t.icon]}):a._e(),a._v(" "),s("span",{class:["label","ds-elips-".concat(t.showRows||1)],style:{color:t.color}},[a._v(a._s(n.dataValue[t.showMetaColumn]))])],1):a._e()]})],2):a._e(),a._v(" "),0<a.needTitles.length?s("div",{staticClass:"needTitles"},[a._l(a.needTitles,function(t,e){return[a.isShowColumn(t,n)?s("div",{key:"needTitles-".concat(e),staticClass:"subTitle"},[s("span",{staticClass:"name label ellipsis"},[a._v(a._s(t.showName))]),a._v(" "),s("span",{staticClass:"label val elips",style:{color:t.color}},[a._v(a._s(n.dataValue[t.showMetaColumn]))])]):a._e()]})],2):a._e()]),a._v(" "),0<a.titleIcon.length?s("div",[a._l(a.titleIcon,function(t,e){return[a.isShowColumn(t,n)?s("div",{key:"titleIcon-".concat(e),staticClass:"moduleIcon",style:a.titleIconColor(n,t)},[s("span",[a._v(a._s(n.dataValue[t.showMetaColumn].substr(0,1)))])]):a._e()]})],2):a._e()]},{item:n}),a._v(" "),a._t("item-extend",null,{item:n})],2),a._v(" "),a.isShowListBtn(n)?s("div",{attrs:{slot:"footer"},slot:"footer"},[a._t("item-footer",function(){return[s("DsButtonToolbox",{attrs:{buttons:n.buttons||{},more:!0,size:"small"},on:{commonClick:function(t){a.handleCommonClick(t,n,e)},mainClick:function(t){a.handleMainClick(t,n,e)}}})]},{item:{}})],2):a._e()])],1)}),a._v(" "),a.data.length||a.$parent.loading?a._e():s("commonempty")],2)},[],!1,null,"7d9709ac",null).exports},46297:function(t,e,n){n.d(e,{Z:function(){return a}});var a=(0,n(51900).Z)({},function(t,e){return t("div",{staticClass:"ds-card"},[e._t("default"),e._v(" "),t("div",{staticClass:"tabspage"},[e.$slots.tabspageCheck?t("div",{staticClass:"tabspageCheck"},[e._t("tabspageCheck")],2):e._e(),e._v(" "),t("div",{staticStyle:{flex:"1",overflow:"hidden"}},[e.$slots.header?t("div",{staticClass:"ds-card-header"},[e._t("header")],2):e._e(),e._v(" "),e.$slots.content?t("div",{staticClass:"ds-card-content"},[e._t("content")],2):e._e()]),e._v(" "),e.$slots.rightIcon?t("div",{staticClass:"rightIcon"},[e._t("rightIcon")],2):e._e()]),e._v(" "),e.$slots.footer?t("div",{staticClass:"ds-card-footer"},[e._t("footer")],2):e._e(),e._v(" "),e.$slots.footermin?t("div",{staticClass:"ds-card-footer ds-card-footer2"},[e._t("footermin")],2):e._e()],2)},[],!0,null,"1b02e7ea",null).exports},46385:function(t,e,n){n.r(e),n.d(e,{default:function(){return l}});var a=n(66250),e=n(73473),r=n.n(e),e=n(8450),o=n.n(e),e=n(33453),c=n.n(e),e=n(70680),s=n(18868),i=n(63450),d=n(25108),e={name:"SeparateRead",components:{controlUserTree:e.default,DebounceClick:s.Z,controlUserList:i.default},props:{separateTabs:{type:Array,default:function(){return[]}},formParams:{type:Object,default:function(){return{}}},nowButtonParameters:{type:Object,default:function(){return{}}}},data:function(){return{result:[],resolve:function(){},reject:function(){},isShow1:!1,isShow2:!1,opinionList:[],message:"",optionValue:"",nowList:[],showList1:[],organizeList:[],userList:[],privateData:[],data:{},selectList:[],personSelectData:"",oldV:[],selectArr:[],selectParent:[],selectChild:[],type:0,extra:{multiple:!0,filterSelf:"-1"==dsf.config.setting["SYS-FY-0012"],tabs:[]},tab:"",defaultSelectArray:[],smsContent:""}},created:function(){var n=this;return(0,a.Z)(c().mark(function t(){var e;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getTabs();case 2:e=dsf.config.setting["SYS-FY-0010"]||[],n.separateTabs&&n.separateTabs.length?n.extra.tabs=n.separateTabs:e.length?n.extra.tabs=JSON.parse(e).filter(function(t){return"角色"!=t.name}):n.extra.tabs={multiple:!0,filterSelf:"-1"==dsf.config.setting["SYS-FY-0012"],tabs:[{action:"fn/user/select/data?types=person&rootObject=1&action=self_dept&async=true",name:"本部门",subTabKey:"department"},{action:"fn/user/select/data?types=person&rootObject=1&action=self_org&async=true",name:"本机构",subTabKey:"department"},{name:"群组",action:"fn/user/select/data?types=person,department,post,privateGroup,own_group&rootObject=2&action=private_group&async=true&source=share",subTabKey:"department"}]};case 4:case"end":return t.stop()}},t)}))()},methods:{getTabs:function(){var i=this;return new(r())(function(s,t){try{dsf.http.post("/fn/mobileToRead/mobileShareInfo",{selectedTabs:i.nowButtonParameters.selectedTabs||"",pk:i.formParams.pk,moduleId:i.formParams.moduleId,distribId:i.formParams.distribId||""}).then(function(t){var e,n,a;200==t.data.code&&(dsf.config.setting["SYS-FY-0010"]=o()(t.data.data.tabs),e=/\[(.+?)\]/g,n=t.data.data.fySmsContent,a={"分阅用户":dsf.util.loadSessionStore("user").name,"分阅时间":moment().format("YYYY-MM-DD HH:mm:ss"),"模块名称":i.data.moduleName,"文件标题":i.data.bt,"分阅意见":i.optionValue},n.match(e)&&n.match(e).forEach(function(t){var e=t.replace("[","").replace("]","");a[e]&&(n=n.replace(t,a[e]))}),i.smsContent=n),s()})}catch(t){s()}})},show:function(t,e){var n=this;return this.data=t,this.defaultSelectArray=e,this.getAdvice(),1==this.nowButtonParameters.opinion?this.isShow1=!0:this.isShow2=!0,new(r())(function(t,e){n.resolve=t,n.reject=e})},cancel1:function(){this.isShow1=!1,this.reject("流程被中断")},cancel2:function(){this.isShow2=!1},send:function(){this.isShow2=!0},getAdvice:function(){var e=this;dsf.http.get("fn/mobileUsedOpinion/find").then(function(t){e.opinionList=t.data.rows})},addAdvice:function(){var t=this;""===this.optionValue?dsf.layer.toast("请输入内容"):dsf.http.post("fn/mobileUsedOpinion/add",{__DATA:o()({opinion:this.optionValue})}).then(function(){t.getAdvice()})},deleteAdvice:function(t){var e=this;this.$dialog.confirm({title:"提示",message:"确定要删除吗？"}).then(function(){dsf.http.get("fn/mobileUsedOpinion/delete?id="+t.id).then(function(){e.getAdvice()})})},writeAdvice:function(t){this.optionValue=this.optionValue+t,this.$forceUpdate()},addReadSure:function(o){var l=this;return(0,a.Z)(c().mark(function t(){var n,a,s,i,e;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=a=n="",i=[],o.forEach(function(t,e){e=e?",":"";n+="".concat(e).concat(t.type,"::").concat(t.id),a+=(5==t.type?"".concat(e):"".concat(e).concat(t.attrs.realDeptId||t.pid,"-")).concat(t.id),s+=(5==t.type?"".concat(e):"".concat(e).concat(t.attrs.orgNameLV2Text||t.attrs.orgNameLV1Text,"-")).concat(t.name),5==t.type&&i.push(t.name)}),i.length)return t.next=6,new(r())(function(t,e){dsf.layer.confirm({title:"提示",message:"是否确认分阅给【".concat(i.join(","),"】内所有人员？")},function(){t()})});t.next=6;break;case 6:if(e={infoId:l.data.info_id,userIds:a,userNames:s,schemaVals:n,distribId:l.data.distribId||"",canRedistrib:1,infoType:l.data.infoType||"",infoTypeText:l.data.infoTypeText||"",shareContent:l.optionValue,shareList:"",isSms:l.result.find(function(t){return"isSms"==t})?"1":"-1",smsContent:"",reShare:0,isEndSms:l.result.find(function(t){return"isEndSms"==t})?"1":"-1"},l.data.distribId&&"0"!=l.data.distribId&&(e.reShare=1),""===e.userIds)return dsf.layer.toast("请选择人员"),t.abrupt("return");t.next=11;break;case 11:l.isShow1=!1,l.isShow2=!1,d.log(e),dsf.layer.loading(),dsf.http.post("fn/mobileToReadOperation/toShare",e).then(function(e){dsf.layer.clear(),dsf.layer.toast(e.data.message,!0),l.data.distribId&&"0"!=l.data.distribId&&dsf.config.commonForm.toShareAndRead?dsf.http.post("fn/mobileToReadOperation/readed",{infoIds:l.data.info_id,distribIds:l.data.distribId}).then(function(t){l.resolve(e.data.message)}):l.resolve(e.data.message)});case 16:case"end":return t.stop()}},t)}))()},closePopup:function(){this.$emit("close")}}},l=(0,n(51900).Z)(e,function(){var a=this,t=a._self._c;return t("div",{staticClass:"ds-separate-read"},[t("van-popup",{attrs:{position:"bottom"},on:{closed:a.closePopup},model:{value:a.isShow1,callback:function(t){a.isShow1=t},expression:"isShow1"}},[t("div",{staticClass:"header"},[t("van-nav-bar",{attrs:{title:"分阅意见","left-text":"取消"},on:{"click-left":a.cancel1}})],1),a._v(" "),t("div",{staticClass:"body"},[t("van-field",{attrs:{rows:"4",type:"textarea",placeholder:"请输入分阅意见",autosize:""},model:{value:a.optionValue,callback:function(t){a.optionValue=t},expression:"optionValue"}}),a._v(" "),t("div",{staticClass:"tag-box"},[t("div",{staticClass:"tag-list"},a._l(a.opinionList,function(e,n){return t("div",{key:n,staticClass:"tag-item"},[t("div",{staticClass:"tag-item-text",on:{click:function(t){return a.writeAdvice(e.context)}}},[a._v("\n              "+a._s(e.context)+"\n            ")]),a._v(" "),t("div",{staticClass:"tag-item-bt",on:{click:function(t){return a.deleteAdvice(e,n)}}},[t("van-icon",{attrs:{name:"cross"}})],1)])}),0),a._v(" "),t("van-button",{attrs:{icon:"plus",size:"small",plain:""},on:{click:a.addAdvice}},[a._v("新增模板")])],1),a._v(" "),t("div",{staticClass:"sms-container"},[t("van-checkbox-group",{attrs:{direction:"horizontal"},model:{value:a.result,callback:function(t){a.result=t},expression:"result"}},[t("van-checkbox",{attrs:{name:"isSms"}},[a._v("是否提醒")]),a._v(" "),t("van-checkbox",{attrs:{name:"isEndSms"}},[a._v("阅闭是否提醒")])],1),a._v(" "),t("van-field",{directives:[{name:"show",rawName:"v-show",value:a.result.find(function(t){return"isSms"==t}),expression:"result.find(item => item == 'isSms')"}],attrs:{rows:"4",autosize:"",type:"textarea",placeholder:"请输入提醒内容"},model:{value:a.smsContent,callback:function(t){a.smsContent=t},expression:"smsContent"}})],1)],1),a._v(" "),t("div",{staticClass:"footer"},[t("van-button",{attrs:{type:"theme"},on:{click:a.send}},[a._v("选择人员")])],1)]),a._v(" "),t("van-popup",{ref:"container",style:{height:"100%"},attrs:{position:"bottom","close-on-click-overlay":!1},model:{value:a.isShow2,callback:function(t){a.isShow2=t},expression:"isShow2"}},[t("control-user-list",{attrs:{extra:a.extra,"default-select-array":a.defaultSelectArray},on:{close:a.cancel2,getSelectUser:a.addReadSure}})],1)],1)},[],!1,null,"7e65ecea",null).exports},96478:function(t,e,n){n.r(e),n.d(e,{default:function(){return i}});var o=n(5044),e=n(41775),a=n(9303),s=n(46385),e={components:{DsList:e.Z,SeparateRead:s.default},mixins:[a.Z],data:function(){return{data:[],columns:[],keyword:"",finished:!1,loading:!1,isLoading:!1,finishedTips:"",start:1,listButtons:[],showFyyj:!1}},methods:{onSearch:function(){this.onRefresh()},fetchData:function(){var i=this;dsf.http.post("fn/list/200517221440muOZO3Y4RodwxFvhCKU/mobile/q?moduleId=2001131007187DmPkCTl0HFmPhHOk1c",{limit:15,_content:this.keyword,start:this.start,page:this.start}).then(function(t){var e=t.status,t=t.data,n=t.showColumn,a=t.datas,a=void 0===a?[]:a,s=t.total,t=t.listButtons;200===e?(i.start+=1,i.data=[].concat((0,o.Z)(i.data),(0,o.Z)(a)),i.listButtons=t||{},i.columns=n||[],(null==a||i.data.length===s||0===a.length||a.length<15)&&(i.finished=!0),a.length<i.start&&((null==a||0===a.length)&&0===i.start?i.finishedTips="暂无数据":i.finishedTips="")):(i.dsf.layer.toast(message),i.finished=!0,i.finishedTips=message)}).catch(function(t){t=t.message;i.finished=!0,i.dsf.layer.toast(t),i.finishedTips=t}).finally(function(){i.loading=!1,i.isLoading=!1})},onLoad:function(){this.fetchData()},onRefresh:function(){this.finished=!1,this.loading=!0,this.data=[],this.start=1,this.fetchData()},handleActionClick:function(){(this["action-".concat(arguments[0])]||function(){}).apply(void 0,(0,o.Z)(Array.prototype.slice.call(arguments,1)))}}},i=(0,n(51900).Z)(e,function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-signinlist"},[t("van-search",{attrs:{placeholder:"搜索"},on:{search:e.onSearch},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),t("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:e.onRefresh},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[t("van-list",{attrs:{finished:e.finished,"finished-text":e.finishedTips,offset:10},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[t("DsList",{attrs:{data:e.data,columns:e.columns},on:{mainClick:e.handleActionClick,commonClick:e.handleActionClick}})],1)],1),e._v(" "),e.showFyyj?t("separate-read",{ref:"readPop"}):e._e()],1)},[],!1,null,"25a7bbd0",null).exports}}]);