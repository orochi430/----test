"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[82060],{82060:function(E,t,e){e.r(t),e.d(t,{default:function(){return F}});var t=e(26243),o=e.n(t),t=e(62680),a=e.n(t),t=e(95366),s=e.n(t),t=e(6919),i=e.n(t),n=e(66250),d=e(5044),r=e(77193),t=e(33453),h=e.n(t),t=e(8450),u=e.n(t),t=e(90487),c=e.n(t),t=e(70538),l=e(23336),f=e.n(l),m=(!function(){function t(n){function t(t,e){this.el=n(t),this.zoomFactor=1,this.lastScale=1,this.offset={x:0,y:0},this.options=n.extend({},this.defaults,e),this.setupMarkup(),this.bindEvents(),this.update(),this.enable()}function e(t,e){return t+e}t.prototype={defaults:{tapZoomFactor:2,zoomOutFactor:1.3,animationDuration:300,maxZoom:4,minZoom:.5,lockDragAxis:!1,use2d:!0,zoomStartEventName:"pz_zoomstart",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap"},handleDragStart:function(t){this.el.trigger(this.options.dragStartEventName),this.stopAnimation(),this.lastDragPosition=!1,this.hasInteraction=!0,this.handleDrag(t)},handleDrag:function(t){1<this.zoomFactor&&(t=this.getTouches(t)[0],this.drag(t,this.lastDragPosition),this.offset=this.sanitizeOffset(this.offset),this.lastDragPosition=t)},handleDragEnd:function(){this.el.trigger(this.options.dragEndEventName),this.end()},handleZoomStart:function(t){this.el.trigger(this.options.zoomStartEventName),this.stopAnimation(),this.lastScale=1,this.nthZoom=0,this.lastZoomCenter=!1,this.hasInteraction=!0},handleZoom:function(t,e){var t=this.getTouchCenter(this.getTouches(t)),n=e/this.lastScale;this.lastScale=e,this.nthZoom+=1,3<this.nthZoom&&(this.scale(n,t),this.drag(t,this.lastZoomCenter)),this.lastZoomCenter=t},handleZoomEnd:function(){this.el.trigger(this.options.zoomEndEventName),this.end()},handleDoubleTap:function(t){var e=this.getTouches(t)[0],n=1<this.zoomFactor?1:this.options.tapZoomFactor,i=this.zoomFactor,t=function(t){this.scaleTo(i+t*(n-i),e)}.bind(this);this.hasInteraction||(n<i&&(e=this.getCurrentZoomCenter()),this.animate(this.options.animationDuration,t,this.swing),this.el.trigger(this.options.doubleTapEventName))},sanitizeOffset:function(t){var e=(this.zoomFactor-1)*this.getContainerX(),n=(this.zoomFactor-1)*this.getContainerY(),i=Math.max(e,0),o=Math.max(n,0),e=Math.min(e,0),n=Math.min(n,0);return{x:Math.min(Math.max(t.x,e),i),y:Math.min(Math.max(t.y,n),o)}},scaleTo:function(t,e){this.scale(t/this.zoomFactor,e)},scale:function(t,e){t=this.scaleZoomFactor(t),this.addOffset({x:(t-1)*(e.x+this.offset.x),y:(t-1)*(e.y+this.offset.y)}),parent.window.scalenumber=Number(this.zoomFactor.toFixed(1))},scaleZoomFactor:function(t){var e=this.zoomFactor;return this.zoomFactor*=t,this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom)),this.zoomFactor/e},drag:function(t,e){e&&(this.options.lockDragAxis?Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?this.addOffset({x:-(t.x-e.x),y:0}):this.addOffset({y:-(t.y-e.y),x:0}):this.addOffset({y:-(t.y-e.y),x:-(t.x-e.x)}))},getTouchCenter:function(t){return this.getVectorAvg(t)},getVectorAvg:function(t){return{x:t.map(function(t){return t.x}).reduce(e)/t.length,y:t.map(function(t){return t.y}).reduce(e)/t.length}},addOffset:function(t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y}},sanitize:function(){this.zoomFactor<this.options.zoomOutFactor?this.zoomOutAnimation():this.isInsaneOffset(this.offset)&&this.sanitizeOffsetAnimation()},isInsaneOffset:function(t){var e=this.sanitizeOffset(t);return e.x!==t.x||e.y!==t.y},sanitizeOffsetAnimation:function(){var e=this.sanitizeOffset(this.offset),n=this.offset.x,i=this.offset.y,t=function(t){this.offset.x=n+t*(e.x-n),this.offset.y=i+t*(e.y-i),this.update()}.bind(this);this.animate(this.options.animationDuration,t,this.swing)},zoomOutAnimation:function(){var e=this.zoomFactor,n=this.getCurrentZoomCenter(),t=function(t){this.scaleTo(e+t*(1-e),n)}.bind(this);this.animate(this.options.animationDuration,t,this.swing)},updateAspectRatio:function(){this.setContainerY(this.container[0].childNodes[0].getBoundingClientRect().height)},getInitialZoomFactor:function(){return this.container[0].offsetWidth/this.el[0].offsetWidth},getAspectRatio:function(){return this.el[0].offsetWidth/this.el[0].offsetHeight},getCurrentZoomCenter:function(){var t=this.container[0].offsetWidth*this.zoomFactor,e=this.offset.x,t=t-e-this.container[0].offsetWidth,e=e/t,e=e*this.container[0].offsetWidth/(1+e),n=this.container[0].offsetHeight*this.zoomFactor,i=this.offset.y,n=n-i-this.container[0].offsetHeight,i=i/n,i=i*this.container[0].offsetHeight/(1+i);return{x:e=0==t?this.container[0].offsetWidth:e,y:i=0==n?this.container[0].offsetHeight:i}},canDrag:function(){return t=this.zoomFactor,!((e=1)-.01<t&&t<e+.01);var t,e},getTouches:function(t){var e=this.container.offset();return Array.prototype.slice.call(t.touches).map(function(t){return{x:t.pageX-e.left,y:t.pageY-e.top}})},animate:function(n,i,o,a){var s=(new Date).getTime(),r=function(){var t,e;this.inAnimation&&(e=(t=(new Date).getTime()-s)/n,n<=t?(i(1),a&&a(),this.update(),this.stopAnimation()):(o&&(e=o(e)),i(e),this.update(),requestAnimationFrame(r)))}.bind(this);this.inAnimation=!0,requestAnimationFrame(r)},stopAnimation:function(){this.inAnimation=!1},swing:function(t){return-Math.cos(t*Math.PI)/2+.5},getContainerX:function(){return this.container[0].offsetWidth},getContainerY:function(){return this.container[0].offsetHeight},setContainerY:function(t){return this.container.height(t)},setupMarkup:function(){this.container=n('<div class="pinch-zoom-container"></div>'),this.el.before(this.container),this.container.append(this.el),this.container.css({overflow:"hidden",position:"relative"}),this.el.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",position:"relative"})},end:function(){this.hasInteraction=!1,this.sanitize(),this.update()},bindEvents:function(){i(this.container.get(0),this),n(window).on("resize",this.update.bind(this)),n(this.el).find("img").on("load",this.update.bind(this))},update:function(){this.updatePlaned||(this.updatePlaned=!0,setTimeout(function(){this.updatePlaned=!1,this.updateAspectRatio();var t=this.getInitialZoomFactor()*this.zoomFactor,e=-this.offset.x/t,n=-this.offset.y/t,i="scale3d("+t+", "+t+",1) translate3d("+e+"px,"+n+"px,0px)",t="scale("+t+", "+t+") translate("+e+"px,"+n+"px)";(function(){this.clone&&(this.clone.remove(),delete this.clone)}).bind(this);this.options.use2d?(this.el.css({"-webkit-transform":t,"-o-transform":t,"-ms-transform":t,"-moz-transform":t,transform:t}),this.is3d=!1):(this.is3d=!0,this.el.css({"-webkit-transform":i,"-o-transform":t,"-ms-transform":t,"-moz-transform":t,transform:i}))}.bind(this),0))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}};var i=function(t,n){function e(t,e){if(r!==t){if(r&&!t)switch(r){case"zoom":n.handleZoomEnd(e);break;case"drag":n.handleDragEnd(e)}switch(t){case"zoom":n.handleZoomStart(e);break;case"drag":n.handleDragStart(e)}}r=t}function i(t){2===c?(document.querySelector(".smt-tab-write")?document.querySelector(".smt-tab-write").className.split(" "):[]).includes("active")||e("zoom"):1===c&&n.canDrag()?(document.querySelector(".smt-tab-write")?document.querySelector(".smt-tab-write").className.split(" "):[]).includes("active")||e("drag",t):e(null,t)}function o(t){return Array.prototype.slice.call(t).map(function(t){return{x:t.pageX,y:t.pageY}})}function a(t,e){var n=t.x-e.x,t=t.y-e.y;return Math.sqrt(n*n+t*t)}function s(t){t.stopPropagation()}var r=null,c=0,l=null,d=!0;t.addEventListener("touchstart",function(t){n.enabled&&(d=!0,c=t.touches.length)}),t.addEventListener("touchmove",function(t){if(n.enabled){if(d)i(t),r&&s(t),l=o(t.touches);else{switch(r){case"zoom":n.handleZoom(t,function(t,e){t=a(t[0],t[1]);return a(e[0],e[1])/t}(l,o(t.touches)));break;case"drag":n.handleDrag(t)}r&&(s(t),n.update())}d=!1}}),t.addEventListener("touchend",function(t){n.enabled&&(c=t.touches.length,i(t))})};return t}"undefined"!=typeof define&&e.amdO?define(["jquery"],t):(window.RTP=window.RTP||{},window.RTP.PinchZoom=t(window.$))}.call(void 0),e(97805)),p=e(8167),g=e(31314),v=function(){function n(t){var e;(0,p.Z)(this,n),this.touchDom=t.touchDom,this.transformDom=t.transformDom,this.transformData={x:(null==t||null==(e=t.transformData)?void 0:e.x)||0,y:(null==t||null==(e=t.transformData)?void 0:e.y)||0,scale:(null==t||null==(e=t.transformData)?void 0:e.scale)||1},this.maxScale=t.maxScale||1/0,this.minScale=t.minScale||0,this.store={x:0,y:0,distance:1},this.isSign=t.isSign,this.touchType="",this.scaleTranslateProportion=[],this.init()}return(0,g.Z)(n,[{key:"init",value:function(){this.touchDom.addEventListener("touchstart",this.touchstart.bind(this)),this.touchDom.addEventListener("touchmove",this.touchmove.bind(this)),this.touchDom.addEventListener("touchend",this.touchend.bind(this)),this.transformDom.style.transition="all .3s"}},{key:"touchstart",value:function(t){var e,n;t.stopPropagation(),t.cancelBubble=!0,1===t.touches.length?(this.moveStart(t.touches[0].clientX,t.touches[0].clientY),e=t.touches[0].clientX-this.transformDom.offsetLeft,n=t.touches[0].clientY-this.transformDom.offsetTop,this.transformData.x=e,this.transformData.y=n,this.touchType="move"):2===t.touches.length&&(this.store.x2=t.touches[1].clientX,this.store.y2=t.touches[1].clientY,this.touchType="scale"),this.store.moveable=!0,this.store.originScale=this.transformData.scale||1}},{key:"moveStart",value:function(t,e){this.store.x=t,this.store.y=e}},{key:"getDistance",value:function(t,e){var n=Math.abs(t.x-e.x),t=Math.abs(t.y-e.y);return Math.sqrt(n*n+t*t)}},{key:"getCenter",value:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}},{key:"move",value:function(t,e){var n,i=this.transformDom.getAttribute("style").split("scale(");2<=i.length&&(i=i[1].split(", ")[0],n=document.querySelector(".smt-tab-write")?document.querySelector(".smt-tab-write").className.split(" "):[],1<Number(i)&&!n.includes("active")&&(this.transformDom.style.position="relative",this.transformDom.style.left=(t-this.transformData.x).toFixed(1)+"px",this.transformDom.style.top=(e-this.transformData.y).toFixed(1)+"px"),1===Number(i))&&(this.transformDom.style.transform="scale(1, 1})",this.transformDom.style.left="0px",this.transformDom.style.top="0px")}},{key:"touchmove",value:function(t){var e,n;this.store.moveable&&(t.stopPropagation(),t.cancelBubble=!0,1===t.touches.length&&"move"===this.touchType?this.move(t.touches[0].clientX,t.touches[0].clientY):2!==t.touches.length||(document.querySelector(".smt-tab-write")?document.querySelector(".smt-tab-write").className.split(" "):[]).includes("active")||(n=t.touches[0],t=t.touches[1],this.store.x2||(this.store.x2=t.clientX),this.store.y2||(this.store.y2=t.clientY),e=this.getDistance({x:n.clientX,y:n.clientY},{x:t.clientX,y:t.clientY})/this.getDistance({x:this.store.x,y:this.store.y},{x:this.store.x2,y:this.store.y2}),(e=(e=this.store.originScale*e)>this.maxScale?this.maxScale:e)<this.minScale&&(e=this.minScale),n=this.getCenter({x:n.clientX,y:n.clientY},{x:t.clientX,y:t.clientY}),this.transformData.scale=e,parent.window.scalenumber=Number(e.toFixed(1)),this.transformDom.style.transform="scale(".concat(e.toFixed(1)||1,", ").concat(e.toFixed(1)||1,")"),this.transformDom.style.transformOrigin="".concat(n.x+50,"px ").concat(n.y+50,"px 0px")))}},{key:"touchend",value:function(){this.store.moveable=!1,delete this.store.x2,delete this.store.yy2}}]),n}(),w=(e(62596),e(25108)),b=[];t.default.directive("focus",{inserted:function(t){new RTP.PinchZoom(t,{})}});var y,I,S,l={name:"SnapshotPreview",props:{file:{type:Object,default:void 0},formInfo:{type:Object,require:!0},formMeta:{type:Object,default:function(){}},isShowFullScreen:{type:Boolean},snapshotTime:{type:String,default:""},curFileId:{type:String,default:""},curPage:{type:Number,default:1}},data:function(){return{sumAry:[],dsfLoading:null,errored:!1,errorMsg:"",imgs:[],show:!1,signMobile:null,allNotionData:[],currentUserNotionData:[],otherUserNotionData:[],addNotionData:[],count:-1,timer:null,autoLoadNameAndDate:"",currentScrollDom:0,user:dsf.util.loadSessionStore("user")||{},pageLengths:0,isRetry:!1,signConfigObj:{},oldScrollTop:0,scrollTop:0}},created:function(){this.init()},watch:{listenChange:function(t){this.init()},scrollTop:function(t,e){var n=this;setTimeout(function(){t==f()(".snapshot-container").scrollTop()&&(n.oldScrollTop=t,n.getPageNum())},50)},curPage:{handler:function(t){0<t&&setTimeout(function(){f()(".snapshot-container .pinch-zooms")[t-1].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},immediate:!0,deep:!0}},computed:{listenChange:function(){return{curFileId:this.curFileId,snapshotTime:this.snapshotTime}}},mounted:function(){},methods:{init:function(){var e=this,i=this;i.imgs=[],i.dsfLoading=dsf.layer.loading(),f()(".snapshot-container .container").empty(),dsf.http.get("fn/office/image/previewAll",{fileId:i.curFileId,filename:"",initDataSource:"",officeModuleId:""}).done(function(t){var n;"success"==t.type?(i.errored=!1,i.isRetry=!1,n=[],t.data.pages.forEach(function(t,e){n.push({path:dsf.url.getWebPath(t.url),show:!![0,1,2].includes(e)})}),i.imgs=n,i.$nextTick(function(){i.$refs.snapshotContainer.addEventListener("scroll",i.handleScroll.bind(e,i),!0),i.$refs.pinchZooms.length>=t.data.pages.length&&(dsf.layer.closeLoading(i.dsfLoading),i.getPageItem(),i.getCurrentUserSignatureInfo(function(){i.initSignatureMobile()}))})):(i.errored=!0,i.errorMsg=t.message,("文件解析中,请耐心等待"===i.errorMsg||t.data&&0==t.data.status)&&(i.isRetry=!0,i.countDown()))}).error(function(t){}).always(function(){dsf.layer.closeLoading(i.dsfLoading)})},getPageItem:function(){b=[],document.querySelectorAll(".pinch-zooms").forEach(function(t){b.push(t.offsetTop)})},getMaxNum:function(e){var t=(0,d.Z)(new(c())(b)),n=t.filter(function(t){return t<=e}).slice(-1);return t.indexOf(n[0])},getPageNum:function(){var t=this.getMaxNum(f()(".snapshot-container").scrollTop()),t=Math.max(t,0);this.signMobile._limitCanvaspage=t+1},countDown:function(){var t=this;this.timer||(this.count=3,this.timer=setInterval(function(){0<t.count&&t.count<=3?t.count--:(clearInterval(t.timer),t.timer=null,t.init())},1e3))},destroyInterval:function(){clearInterval(this.timer),this.timer=null},getCurrentUserSignatureInfo:function(e){var n=this;dsf.http.get("fn/hm/sign/config",{}).then(function(t){t&&t.data&&"success"==t.data.type&&(n.signConfigObj=t.data.data,e)&&e()})},initSignatureMobile:function(t){t=t||"pinch-zooms";var e="iPad"==dsf.util.getClientType();this.signMobile=new m.Z(document.querySelector(".snapshot-box"),!1,{},document.querySelectorAll("."+t),!1,{zoomNum:2,ispad:e,isPaging:!0}),this.signMobile.autographType="canvas",this.signMobile.baseZIndex=999,this.signMobile.currentElementDataStartZIndex=99,this.signMobile.setContainerWH(),this.getAllNotionData(t)},getAllNotionData:function(t){var r=this,e=(r.dsfLoading=dsf.layer.loading(),{papersId:r.curFileId,flowId:r.formInfo?r.formInfo.flowId:r.file.flowId||"",userId:"",createTime:r.snapshotTime});dsf.http.get("fn/hm/notation/data/history",e).then(function(t){var e,n,i,o,a,s;dsf.layer.closeLoading(r.dsfLoading),t&&t.data&&"success"==t.data.type?(e=t.data.data.all,n=[],i=[],e.forEach(function(t){-1===i.indexOf(t.createUserId)?(n.push({createUserId:t.createUserId,createUName:t.createUName,packetContent:JSON.parse(t.packetContent)}),i.push(t.createUserId)):n.forEach(function(e){e.createUserId===t.createUserId&&JSON.parse(t.packetContent).forEach(function(t){e.packetContent.push(t)})})}),n.forEach(function(t){var n=t.packetContent,e=[];n&&(e=n.reverse().filter(function(e,t){if(t==n.findIndex(function(t){return t.papersPage?e.papersPage==t.papersPage:e.addPageId==t.addPageId}))return e}).reverse()),r.$set(t,"packetContent",e)}),o=t.data.data.userData[0]?t.data.data.userData[0].createUserId:r.user.user_id,a=n.filter(function(t,e){return o.includes(t.createUserId)}),s=n.filter(function(t,e){return!o.includes(t.createUserId)}),w.log(a),w.log(s),r.$nextTick(function(){r.renderCanvasData({currentUserData:a,otherUserData:s})})):dsf.layer.toast("获取失败")}).error(function(t){}).always(function(){dsf.layer.closeLoading(r.dsfLoading)})},renderCanvasData:function(t){var e=this,n=t.currentUserData,t=t.otherUserData,i=this;n&&0<n.length&&n.forEach(function(t){t.packetContent&&0<t.packetContent.length&&(t=t.packetContent)&&0<t.length&&(t.forEach(function(t){t.data||(t.data=t.packetContent),t.addPageId&&!document.querySelector('.pinch-zooms[data-pid="'.concat(t.addPageId,'"]'))&&i.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition},function(t){})}),0<e.sumAry.length&&e.sumAry.forEach(function(t){i.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition},function(t){})}),t)&&i.signMobile.initCurrentData(t)}),t&&0<t.length&&t.forEach(function(t){t.packetContent&&0<t.packetContent.length&&(t=t.packetContent)&&0<t.length&&(t.forEach(function(t){t.data||(t.data=t.packetContent),t.addPageId&&!document.querySelector('.pinch-zooms[data-pid="'.concat(t.addPageId,'"]'))&&i.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition},function(t){})}),0<e.sumAry.length&&e.sumAry.forEach(function(t){i.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition},function(t){})}),t)&&i.signMobile.rendererHistoryData(t)}),w.log(i.curPage),this.sortPageNum(),setTimeout(function(){f()(".snapshot-container .pinch-zooms")[i.curPage-1].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},handleCreateNewPage:function(t,e,n,i){var o=n.addPosition,n=n.isMove,a=document.querySelector(".pinch-zooms"),s=a.cloneNode(!0),a=(s.dataset.pid=e,s.dataset.new="1",s.innerHTML="",s.removeAttribute("id"),s.style.height=a.offsetHeight+"px",document.createElement("div")),r=(this.signConfigObj.bgImgUrl?a.style="width: 100%; height: 100%; background:url('".concat(dsf.url.getWebPath(this.signConfigObj.bgImgUrl),"') center top;background-size:100% 100%;"):a.style="width: 100%; height: 100%; border:1PX solid #f00 !important; z-index: 1",s.appendChild(a),document.querySelector(".pageContainers"));switch(o.site){case"1":var c=f()(".snapshot-container .pinch-zooms[data-pid=".concat(o.pid,"]"))[0];c?r.insertBefore(s,c):r.prepend(s);break;case"2":var c=f()(".snapshot-container .pinch-zooms[data-pid=".concat(o.pid,"]"))[0];c?r.insertBefore(s,c):this.sumAry.push(t);break;case"3":o.pid?(c=o.pid?f()(".snapshot-container .pinch-zooms[data-pid=".concat(o.pid,"]"))[0]:"")?r.insertBefore(s,c):this.sumAry.push(t):r.appendChild(s);break;case"4":r.appendChild(s)}n&&setTimeout(function(){s.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);a=this.signMobile.newChildBoard(s,!1,"",e,{addPosition:o}),n=document.querySelectorAll(".pinch-zooms");this.signMobile.changeInfoPageDom(n),this.getPageItem(),i&&i(a)},handleScroll:(y=function(n){n.$refs.pinchZooms&&1!=n.$refs.pinchZooms.length&&n.$nextTick(function(){0==f()(".snapshot-container").scrollTop()?n.currentScrollDom=0:f()(".snapshot-container .pinch-zooms").each(function(t,e){f()(".snapshot-container").scrollTop()>f()(".pinch-zooms").outerHeight(!0)*t&&(n.currentScrollDom=t)}),n.imgs.forEach(function(t,e){[n.currentScrollDom,n.currentScrollDom+1,n.currentScrollDom-1,n.currentScrollDom+2,n.currentScrollDom-2].includes(e)?n.$set(t,"show",!0):n.$set(t,"show",!1)}),n.scrollTop=f()(".snapshot-container").scrollTop()})},I=500,S=null,function(){var t=this,e=arguments;S=S||setTimeout(function(){S=null,y.apply(t,e)},I)}),sortPageNum:function(){var i=this;this.$nextTick(function(){i.pageLengths=f()(".pinch-zooms").length,f()(".page-nums").remove();var n="iPad"==dsf.util.getClientType()?"width: 90px;height: 36px;display: flex;align-items: center;justify-content: center;background: #FFF;border-radius: 18px;font-size: 18px;color: #999;position: absolute;bottom: 0;left: 50%;transform: translateX(-50%);box-shadow: 0 0 10px #ccc;":"width: 60px;height: 24px;display: flex;align-items: center;justify-content: center;background: #FFF;border-radius: 12px;font-size: var(--font_size_3);color: #999;position: absolute;bottom: 0;left: 50%;transform: translateX(-50%);box-shadow: 0 0 10px #ccc;";f()(".pinch-zooms").each(function(t,e){t='<span class="page-nums" style="'.concat(n,'">').concat(t+1,"/").concat(i.pageLengths,"</span>");f()(e).prepend(t)})})},goPageNums:function(t){this.show=!1;var e=document.querySelectorAll(".pinch-zooms")[t-1];setTimeout(function(){e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)}},beforeDestroy:function(){this.destroyInterval(),window.removeEventListener("scroll",this.handleScroll,!0)}},C=e(51900),l=(0,C.Z)(l,function(){var n=this,i=n._self._c;return i("div",{ref:"snapshotContainer",staticClass:"snapshot-container"},[i("div",{staticClass:"snapshot-box"},[n.errored?i("div",[i("commonempty",{attrs:{image:"error",description:n.errorMsg}},[n.isRetry?i("van-button",{staticClass:"bottom-button",attrs:{round:"",type:"danger"}},[n._v("自动重试("+n._s(n.count)+"s)")]):n._e()],1)],1):n._e(),n._v(" "),!n.errored&&0<n.imgs.length?i("div",{ref:"container",staticClass:"container",staticStyle:{background:"#fff"}},[i("div",{staticClass:"pageContainers"},n._l(n.imgs,function(t,e){return i("div",{key:e,ref:"pinchZooms",refInFor:!0,staticClass:"pinch-zooms",attrs:{id:"pages"+e,"data-pid":e+1}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"img.show"},{name:"lazy",rawName:"v-lazy",value:t.path,expression:"img.path"}],ref:"viewImg",refInFor:!0,staticClass:"view-img"})])}),0)]):n._e(),n._v(" "),i("div",{staticClass:"catalogue",on:{click:function(t){n.show=!0}}},[i("van-icon",{attrs:{name:"coupon-o",size:"24"}})],1),n._v(" "),i("van-popup",{staticClass:"file_popup",attrs:{position:"left","get-container":"body","overlay-style":{"z-index":"9999"}},model:{value:n.show,callback:function(t){n.show=t},expression:"show"}},[i("div",{staticClass:"pages"},[i("p",[n._v("跳转至：")]),n._v(" "),n._l(n.pageLengths,function(e){return i("a",{key:e+"x",on:{click:function(t){return n.goPageNums(e)}}},[n._v("第"+n._s(e)+"页")])})],2)])],1)])},[],!1,null,"05744f7e",null).exports,x=(t.default.directive("focus",{inserted:function(t){new RTP.PinchZoom(t,{})}}),{name:"SinglePreview",components:{},props:{imgs:{type:Array,default:function(){return[]}}},data:function(){return{show:!0,index:1,images:[],showPageNum:!1}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{onChange:function(t){this.index=t+1},turnLeft:function(){var t=this.$refs.mySwipeItem[this.index-1].$el.style.transform,t=t.substr(t.indexOf("(")+1,1);1<Number(t)?dsf.layer.toast("请先停止缩放页面！"):this.$refs.mySwipe.prev()},turnRight:function(){var t=this.$refs.mySwipeItem[this.index-1].$el.style.transform,t=t.substr(t.indexOf("(")+1,1);1<Number(t)?dsf.layer.toast("请先停止缩放页面！"):this.$refs.mySwipe.next()},goPageNum:function(t){this.$refs.mySwipe.swipeTo(t-1),this.showPageNum=!1}}}),x=(0,C.Z)(x,function(){var n=this,i=n._self._c;return i("div",{staticClass:"SinglePreview"},[i("div",{staticClass:"preview-swipe"},[i("van-swipe",{ref:"mySwipe",staticClass:"my-swipe",attrs:{"show-indicators":!1,loop:!1},on:{change:n.onChange}},n._l(n.imgs,function(t,e){return i("van-swipe-item",{directives:[{name:"focus",rawName:"v-focus"}],key:e,ref:"mySwipeItem",refInFor:!0},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t,expression:"img"}],ref:"viewImg",refInFor:!0,staticClass:"view-img"}),n._v(" "),i("span",{class:"iPad"==n.dsf.util.getClientType()?"pad-pagenum":"pagenum"},[n._v(n._s(e+1)+"/"+n._s(n.imgs.length))])])}),1),n._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:1!=n.index,expression:"index != 1"}],staticClass:"iconfont iconarrow-left",on:{click:n.turnLeft}}),n._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:n.index<n.imgs.length,expression:"index < imgs.length"}],staticClass:"iconfont iconarrow-right",on:{click:n.turnRight}})],1),n._v(" "),i("div",{staticClass:"catalogue",on:{click:function(t){n.showPageNum=!0}}},[i("van-icon",{attrs:{name:"coupon-o"}})],1),n._v(" "),i("van-popup",{staticClass:"file_popup",attrs:{position:"left","get-container":"body"},model:{value:n.showPageNum,callback:function(t){n.showPageNum=t},expression:"showPageNum"}},[i("div",{staticClass:"pages"},[i("p",[n._v("跳转至：")]),n._v(" "),n._l(n.imgs.length,function(e){return i("a",{key:e,on:{click:function(t){return n.goPageNum(e)}}},[n._v("第"+n._s(e)+"页")])})],2)])],1)},[],!1,null,"dd10c024",null).exports,P=e(69448),k=e(20629),D=e(25108);function _(e,t){var n,i=o()(e);return a()&&(n=a()(e),t&&(n=n.filter(function(t){return s()(e,t).enumerable})),i.push.apply(i,n)),i}var N,O,M,T,U,z,L=[],t=(t.default.directive("focus",{inserted:function(t){new RTP.PinchZoom(t,{})}}),e.e(46088).then(e.bind(e,46088)),{name:"EnclosurePreview",components:{SnapshotPreview:l,SinglePreview:x,screenPerson:P.Z},props:{file:{type:Object,default:void 0},formInfo:{type:Object,require:!0},isPreview:{type:Boolean},officeModuleId:{type:String,default:""},formMeta:{type:Object,default:function(){}},isShowFullScreen:{type:Boolean},isSignature:{type:Boolean},isShowCurPerson:{type:Boolean,default:!1},isTabType:{type:Boolean,default:!1},RouteLeave:{type:Boolean,default:!0},leaderUser:{type:String,default:""},isShowAddPage:{type:Boolean,default:!0},meetingObj:{type:Object,default:function(){}}},data:function(){return{sumAry:[],dsfLoading:null,errored:!1,errorMsg:"",imgs:[],show:!1,signMobile:null,allNotionData:[],currentUserNotionData:[],otherUserNotionData:[],addNotionData:[],count:-1,timer:null,allPageData:[],autoLoadNameAndDate:"",currentScrollDom:0,commentRecordList:[],showTableDialog:!1,showImgPreview:!1,previewImgs:[],showPopover:!1,personScreen:[],instructorsList:[],curFileId:"",showSnapshot:!1,recordTime:"",currentPage:1,signConfigObj:{},pageLength:0,isRetry:!1,timestamp:"",saveLoading:null,oldScrollTop:0,scrollTop:0,user:dsf.util.loadSessionStore("user"),userCurSignData:[],delPageId:[],fileImgs:[],showSame:!1,signCurTabIndex:dsf.config.commonForm.dreamSign&&dsf.config.commonForm.dreamSign.signCurTabIndex||-1,isHideInstructor:dsf.config.commonForm.dreamSign&&dsf.config.commonForm.dreamSign.isHideInstructor,isFileImgMargin:dsf.config.commonForm.dreamSign&&dsf.config.commonForm.dreamSign.isFileImgMargin}},created:function(){this.updateFileId(),this.timestamp="box"+(new Date).getTime()},watch:{listenChange:function(t,e){f()("#headerDiv").hide(),t&&t.file!=e.file?(f()(".preview-container .signature-mobile-vertical").remove(),this.signMobile=null,this.updateFileId()):t&&t.file===e.file&&(0==t.isPreview?(f()("#headerDiv").show(),this.signMobile.show(),this.isShowDelBtn(!0),this.signMobile.changeBoardLock(!1)):0<f()(".preview-container .signature-mobile-vertical").length?(this.signMobile.hide(),this.signMobile.changeBoardDisplay(!1),this.isShowDelBtn(!1),this.resetSignData()):this.init()),0==t.isPreview?this.$emit("isShowEnclosureBtn",!1):this.$emit("isShowEnclosureBtn",!0)},scrollTop:function(t,e){var n=this;setTimeout(function(){t==f()(".preview-container").scrollTop()&&(n.oldScrollTop=t,n.getPageNum())},50),this.scrollTop}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):i()?Object.defineProperties(e,i()(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,s()(n,t))})}return e}({listenChange:function(){return{file:this.file,isPreview:this.isPreview}},isSinglePre:function(){return dsf.config.commonForm.thanPageSinglePre&&this.imgs.length>dsf.config.commonForm.thanPageSinglePre}},(0,k.rn)({isShowAppFooter:function(t){return t.isShowAppFooter},isShowAppHeader:function(t){return t.isShowAppHeader}})),mounted:function(){},beforeRouteLeave:function(t,e,n){n()},methods:{showSameClick:function(){this.showSame=!this.showSame},updateFileId:function(){var e=this,t=0<e.file.isHandwrite?1:0;e.dsfLoading=dsf.layer.loading(),!e.formMeta&&e.isSignature||t?(t={infoId:e.file.infoId||"",referId:e.file.id,moduleId:e.file.moduleId,fileId:e.file.id,officeModuleId:e.officeModuleId||"",fileName:e.file.fileName||""},!e.isSignature&&e.isPreview||(t.addHandWrite=1),dsf.http.get("fn/hm/form/getFileInfo",t).done(function(t){"success"==t.type?(e.curFileId=t.data.qpFileId,e.init(),e.$emit("closePop")):(e.errored=!0,e.errorMsg=t.message+"，请联系管理员！",f()(".preview-container .signature-mobile-vertical")&&f()(".preview-container .signature-mobile-vertical").remove())}).always(function(){dsf.layer.closeLoading(e.dsfLoading)})):(e.curFileId=e.file.id,e.init())},init:function(){var e=this,i=this;i.currentScrollDom=0,i.imgs=[],i.dsfLoading=dsf.layer.loading(),f()(".preview-container .container").empty(),f()(".preview-container .signature-mobile-vertical").remove(),dsf.http.get("fn/office/image/previewAll",{fileId:i.curFileId,filename:i.file.fileName||"",initDataSource:"",officeModuleId:i.officeModuleId}).done(function(t){var n;"success"==t.type?(i.$emit("closePop"),i.errored=!1,i.isRetry=!1,n=[],t.data.pages.forEach(function(t,e){n.push({path:dsf.url.getWebPath(t.url),show:!0})}),i.imgs=n,i.fileImgs=i.imgs.map(function(t){return t.path}),i.$nextTick(function(){i.$refs.previewContainer&&i.$refs.previewContainer.addEventListener("scroll",i.handleScroll.bind(e,i),!0),i.$refs.pinchZoom&&i.$refs.pinchZoom.length>=t.data.pages.length&&(dsf.layer.closeLoading(i.dsfLoading),i.formMeta||!i.formMeta&&i.isSignature?(i.getPageItem(),i.getCurrentUserSignatureInfo(function(){i.initSignatureMobile()})):i.sortPageNum())})):(i.errored=!0,i.errorMsg=t.message,("文件解析中,请耐心等待"===i.errorMsg||t.data&&0==t.data.status)&&(i.isRetry=!0,i.countDown()))}).error(function(t){}).always(function(){dsf.layer.closeLoading(i.dsfLoading)})},getPageItem:function(){L=[],document.querySelectorAll(".pinch-zoom").forEach(function(t){L.push(t.offsetTop)})},countDown:function(){var t=this;this.timer||(this.count=3,this.timer=setInterval(function(){0<t.count&&t.count<=3?t.count--:(clearInterval(t.timer),t.timer=null,t.init())},1e3))},destroyInterval:function(){clearInterval(this.timer),this.timer=null},touchZoom:function(){new v({touchDom:this.$refs.pageContainer,transformDom:this.$refs.pageContainer,transformData:{x:0,y:0,scale:1},minScale:1,maxScale:5,isSign:!1})},initSignatureMobile:function(t){var e,n=this,i=(t=t||"pinchZoom","iPad"==dsf.util.getClientType()),o=!!(this.formMeta&&this.formMeta.parameters&&0<this.formMeta.parameters.autoLoadNameAndDate);n.$refs[t]&&(this.signMobile=new m.Z(n.$refs[n.timestamp],!1,{},n.$refs[t],!1,{isAutoSign:o,zoomNum:2,ispad:i,isPaging:!0,toolFont:["手写","文字","签名","增页","记录","保存"],autographObject:{fontFamily:n.signConfigObj["GW-GENERAL-0033"]||"",fontSize:n.signConfigObj["GW-GENERAL-0034"]?n.signConfigObj["GW-GENERAL-0034"].includes("px")?n.signConfigObj["GW-GENERAL-0034"]:n.signConfigObj["GW-GENERAL-0034"]+"px":"",color:n.signConfigObj["GW-GENERAL-0035"]||""}}),this.signConfigObj.imageData&&""!=this.signConfigObj.imageData?this.signMobile.autographImage=this.signConfigObj.imageData:this.signMobile.autographFont=this.signConfigObj.signUserName,this.signMobile.autographDate=this.signConfigObj.signTimeShort,this.signMobile.autographDateFont="".concat(this.signConfigObj["SYS-OPINION-0013"]?this.signConfigObj["SYS-OPINION-0013"].includes("px")?this.signConfigObj["SYS-OPINION-0013"]:this.signConfigObj["SYS-OPINION-0013"]+"px":""," ").concat(this.signConfigObj["SYS-OPINION-0012"]||""),this.signMobile.autographDateColor=this.signConfigObj["SYS-OPINION-0014"]||"",e=null==this.signConfigObj["SYS-OPINION-0015"]?[0,1,2,3,4]:this.signConfigObj["SYS-OPINION-0015"]?this.signConfigObj["SYS-OPINION-0015"].split(",").map(Number):[],this.signMobile.hiddenToolIndexList=[0,1,2,3,4].filter(function(t){return!e.includes(t)}),o=0,this.$store.state.isShowAppHeader&&(o=46),document.querySelector(".smt-tab").style.top=u()(this.isTabType?o+50:46)+"px",i=JSON.parse(u()(this.signMobile.hiddenToolIndexList)),(this.isShowCurPerson||this.formMeta&&this.formMeta.parameters&&this.formMeta.parameters.isShowCurPerson)&&(this.signMobile.hiddenToolIndexList.includes(4)||i.push(4),this.signMobile.hiddenToolIndexList=i),this.isShowAddPage||this.signMobile.hiddenToolIndexList.includes(3)||(i.push(3),this.signMobile.hiddenToolIndexList=i),this.signMobile.autographType="canvas",this.signMobile.baseZIndex=99,this.signMobile.currentElementDataStartZIndex=20,f()("#headerDiv").height(f()(".smt-tab").height()),(this.formMeta||!this.formMeta&&this.isSignature)&&!this.isPreview&&(this.signMobile.show(),f()("#headerDiv").show()),this.signMobile.currentTabIndex=0==this.isPreview?this.signCurTabIndex:-1,this.signMobile.setContainerWH(),this.signMobile.activeShow=function(t){},this.setAddsheets(t),this.setCompleteHandle(),this.getCurrentUserOpinionList(),this.setOpinionEdit(),this.setOpinionAdd(),this.setOpinionDel(),this.getAllNotionData(t),this.recordHandle())},getMaxNum:function(e){var t=(0,d.Z)(new(c())(L)),n=t.filter(function(t){return t<=e}).slice(-1);return t.indexOf(n[0])},getPageNum:function(){var t=this.getMaxNum(f()(".preview-container").scrollTop()),t=Math.max(t,0),e=t+1;this.currentScrollDom=t,this.signMobile&&(this.signMobile._limitCanvaspage=e)},handleScroll:(T=function(t){t.$refs.pinchZoom&&1!=t.$refs.pinchZoom.length&&t.$nextTick(function(){0==f()(".preview-container").scrollTop()&&(t.currentScrollDom=0),t.scrollTop=f()(".preview-container").scrollTop()})},U=500,function(){var t=this,e=arguments;z=z||setTimeout(function(){z=null,T.apply(t,e)},U)}),getAllNotionData:function(t){var c=this,e=(c.userCurSignData=[],c.delPageId=[],c.dsfLoading=dsf.layer.loading(),{papersId:c.curFileId,flowId:c.formInfo?c.formInfo.flowId:c.file.flowId||"",userId:"",moduleId:c.formInfo?c.formInfo.moduleId:c.file.moduleId||""});c.leaderUser&&(e.leaderUser=c.leaderUser),dsf.http.get("fn/hm/notation/data/all",e).then(function(t){var i,e,o,a,n,s,r;dsf.layer.closeLoading(c.dsfLoading),t&&t.data&&"success"==t.data.type?(n=t.data.data.all,i=t.data.data.userData,e=0<i.length?i.map(function(t){return t.id}):c.user.user_id,r=n.filter(function(t){return!e.includes(t.id)}),c.insetChoosePeople(t.data.data),o=[],a=[],n.forEach(function(n){var t=JSON.parse(n.packetContent);t.forEach(function(t,e){t.createUserId=n.createUserId,t.isSelf=0!=i.length&&n.createUserId==i[0].createUserId}),a.push.apply(a,(0,d.Z)(t)),o=o.concat(t.filter(function(t,e){return""!=t.addPageId}))}),c.allPageData=a,c.addNotionData=o,i.map(function(e){var t;return e.packetContent&&""!=e.packetContent&&(t=JSON.parse(e.packetContent),c.userCurSignData=JSON.parse(u()(t)),t&&0<t.length&&t.forEach(function(t){t.createUserId=e.createUserId,t.isSelf=0!=i.length&&e.createUserId==i[0].createUserId,t.id=e.id}),c.$set(e,"packetContent",u()(t))),e}),r.forEach(function(e,t){var n;e.packetContent&&""!=e.packetContent&&((n=JSON.parse(e.packetContent))&&0<n.length&&n.forEach(function(t){t.createUserId=e.createUserId,t.isSelf=0!=i.length&&e.createUserId==i[0].createUserId,t.id=e.id}),c.$set(e,"packetContent",u()(n)))}),c.allNotionData=n,c.currentUserNotionData=i,c.otherUserNotionData=r,c.leaderUser?((t=n.filter(function(t){return t.id==c.leaderUser})).forEach(function(e,t){var n;e.packetContent&&""!=e.packetContent&&((n=JSON.parse(e.packetContent))&&0<n.length&&n.forEach(function(t){t.createUserId=e.createUserId,t.isSelf=0!=i.length&&e.createUserId==i[0].createUserId,t.id=e.id}),c.$set(e,"packetContent",u()(n)))}),c.renderCanvasData({currentUserData:c.leaderUser==c.user.user_id?t:[],otherUserData:c.leaderUser==c.user.user_id?[]:t})):c.renderCanvasData({currentUserData:i,otherUserData:r}),n=JSON.parse(u()(a)),s=c.user.user_id,t=n.filter(function(t){return t.createUserId==s}),r=n.filter(function(t){return t.createUserId!=s}),!c.isShowCurPerson||!c.isShowCurPerson&&c.formMeta&&c.formMeta.parameters&&!c.formMeta.parameters.isShowCurPerson?c.signMobile.setPageHistoryData(t,r):c.signMobile.setPageHistoryData(t,[])):dsf.layer.toast("获取失败")}).error(function(t){}).always(function(){dsf.layer.closeLoading(c.dsfLoading)})},sortPageNum:function(){var i=this;this.$nextTick(function(){i.pageLength=f()(".pinch-zoom").length,f()(".page-num").remove();var n="iPad"==dsf.util.getClientType()?"width: 90px;height: 36px;display: flex;align-items: center;justify-content: center;background: #FFF;border-radius: 18px;font-size: 18px;color: #999;position: absolute;bottom: 0;left: 50%;transform: translateX(-50%);box-shadow: 0 0 10px #ccc;":"width: 60px;height: 24px;display: flex;align-items: center;justify-content: center;background: #FFF;border-radius: 12px;font-size: var(--font_size_3);color: #999;position: absolute;bottom: 0;left: 50%;transform: translateX(-50%);box-shadow: 0 0 10px #ccc;";f()(".pinch-zoom").each(function(t,e){t='<span class="page-num" style="'.concat(n,'">').concat(t+1,"/").concat(i.pageLength,"</span>");f()(e).prepend(t)})})},goPageNum:function(t){this.show=!1;var e=document.querySelectorAll(".pinch-zoom")[t-1];setTimeout(function(){e.scrollIntoView({behavior:"smooth",block:"start"})},100)},renderRecord:function(t){JSON.parse(u()(t));var e=this,n=(e.dsfLoading=dsf.layer.loading(),e.commentRecordList=[],this.$refs.pinchZoom),o=[],t=(n.forEach(function(t){o.push(t.getAttribute("data-pid"))}),{papersId:e.curFileId,flowId:e.formInfo?e.formInfo.flowId:e.file.flowId||"",userId:""}),a=[];dsf.http.get("fn/hm/notation/data/history",t).then(function(t){t&&t.data&&"success"==t.data.type&&(t.data.data.all.forEach(function(e){var t=JSON.parse(e.packetContent);t&&0<t.length&&t.forEach(function(n,t){var i=o.findIndex(function(t){return t==(n.addPageId||n.papersPage)})||"";n.createUName=e.createUName,n.createTime=e.createTime,n.packetContent&&(n.data=n.packetContent),n.data&&0<n.data.length&&n.data.forEach(function(t,e){t.createUName=n.createUName,t.createTime=n.createTime,t.pageNum=i+1,t.randomEditiId||(t.randomEditId=t.randomId),a.push(t)})})}),t=a.filter(function(e,t){return t===a.findIndex(function(t){return e.randomEditId===t.randomEditId})}),e.commentRecordList=t,dsf.layer.closeLoading(e.dsfLoading))}).error(function(t){}).always(function(){dsf.layer.closeLoading(e.dsfLoading)})},insetChoosePeople:function(t){var e=t.all;t.userData;this.instructorsList=e.map(function(t){return{id:t.id,createUName:t.createUName,createUserId:t.createUserId,active:!0}}),this.personScreen=this.instructorsList.map(function(t){if(t.active)return t.createUserId})},handleCreateNewPage:function(t,e,n,i){var o,a=n.addPosition,s=n.isMove,r=n.isSelf,c=n.isBack,n=document.querySelector(".pinch-zoom"),l=n.cloneNode(!0),n=(l.dataset.pid=e,l.dataset.new="1",l.innerHTML="",l.removeAttribute("id"),l.style.height=n.offsetHeight+"px",document.createElement("div")),d=(this.signConfigObj.bgImgUrl?n.style="width: 100%; height: 100%; background:url('".concat(dsf.url.getWebPath(this.signConfigObj.bgImgUrl),"') center top;background-size:100% 100%;"):n.style="width: 100%; height: 100%; border:1PX solid #f00 !important; z-index: 1",l.appendChild(n),r&&((n=document.createElement("div")).className="delete-page-btn mine-delete-btn",n.style="position: absolute;z-index:999;right:0;top:5vw;background:#C33E32;width:90px;height:28px;line-height:28px;color:#FFFFFF;text-align:center;font-size: var(--font_size_3);cursor:pointer;",n.innerHTML="删除增页",l.appendChild(n),f()(n).click(this.deletePageHandler).mousedown(function(t){t.stopPropagation()})),this.$refs.pageViewer);switch(a.site){case"1":c?(o=a.pid?f()(".preview-container .pinch-zoom[data-pid=".concat(a.pid,"]"))[0]:"")?d.insertBefore(l,o):d.prepend(l):(o=document.querySelectorAll(".pinch-zoom")[a.target],d.prepend(l),a.pid=o.getAttribute("data-pid"));break;case"2":c?(o=a.pid?f()(".preview-container .pinch-zoom[data-pid=".concat(a.pid,"]"))[0]:"")?d.insertBefore(l,o):this.sumAry.push(t):(o=document.querySelectorAll(".pinch-zoom")[a.target],d.insertBefore(l,o),a.pid=o.getAttribute("data-pid"));break;case"3":c?a.pid?(o=a.pid?f()(".preview-container .pinch-zoom[data-pid=".concat(a.pid,"]"))[0]:"")?d.insertBefore(l,o):this.sumAry.push(t):d.appendChild(l):(o=document.querySelectorAll(".pinch-zoom")[a.target+1])?(d.insertBefore(l,o),a.pid=o.getAttribute("data-pid")):d.appendChild(l);break;case"4":d.appendChild(l)}s&&setTimeout(function(){l.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100);r=this.signMobile.newChildBoard(l,!1,"",e,{addPosition:a}),n=document.querySelectorAll(".pinch-zoom");this.signMobile.changeInfoPageDom(n),this.getPageItem(),i&&i(r)},isShowDelBtn:function(e){0<f()(".delete-page-btn").length&&f()(".delete-page-btn").each(function(t){e?f()(".mine-delete-btn")[t].style.display="block":f()(".delete-page-btn")[t].style.display="none"})},deletePageHandler:function(t){var e=this,n=t.currentTarget.parentElement;dsf.layer.confirm({message:"确定要删除增页吗？",className:"delDialog"},function(){dsf.http.get("fn/hm/addPage/del",{id:n.dataset.pid}).then(function(t){t&&t.data&&"success"==t.data.type?(e.signMobile.deleteChildBoard(n),n.remove(),e.delPageId.push(n.dataset.pid),dsf.layer.toast("删除成功"),e.sortPageNum()):dsf.layer.toast("删除失败")}).error(function(t){}).always(function(){})},function(){})},setAddsheets:function(t){var n=this,i=dsf.layer.loading();n.signMobile.addsheetsHandle=function(e){var t=document.querySelectorAll('[data-new="1"]').length,t={papersId:n.curFileId,showOrder:t+1};dsf.http.get("fn/hm/addPage/save",t).then(function(t){t&&t.data&&"success"==t.data.type?n.handleCreateNewPage(t.data.data,t.data.data.id,{addPosition:{target:n.currentScrollDom,site:e.val,pid:""},isMove:!0,isSelf:!0,isBack:!1},function(){dsf.layer.toast("增页成功"),n.sortPageNum()}):dsf.layer.toast("操作失败")}).error(function(t){}).always(function(){dsf.layer.closeLoading(i)})}},getCoverData:function(c){var l=this;return(0,n.Z)(h().mark(function t(){var i,n,o,a,e,s,r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=l,n=!1,o=[],a=[],r=JSON.parse(u()(c)),e=JSON.parse(u()(l.otherUserNotionData)),r.forEach(function(e){e.data&&(e.packetContent=e.data,delete e.data),e.packetContent&&0<e.packetContent.length&&(e.packetContent.forEach(function(t){t.paperPageId=e.papersPage||e.addPageId}),a.push.apply(a,(0,d.Z)(e.packetContent)))}),e.forEach(function(t){t.packetContent&&""!=t.packetContent&&(t=JSON.parse(t.packetContent))&&0<t.length&&t.forEach(function(e){e.data&&(e.packetContent=e.data,delete e.data),e.packetContent&&0<e.packetContent.length&&(e.packetContent.forEach(function(t){t.paperPageId=e.papersPage||e.addPageId}),a.push.apply(a,(0,d.Z)(e.packetContent)))})}),s=a.map(function(t){return t.randomId}),r={papersId:i.curFileId,flowId:i.formInfo?i.formInfo.flowId:i.file.flowId||"",userId:"",moduleId:i.formInfo?i.formInfo.moduleId:i.file.moduleId||""},i.leaderUser&&(r.leaderUser=i.leaderUser),t.next=13,dsf.http.get("fn/hm/notation/data/all",r).then(function(t){var e,n;t&&t.data&&"success"==t.data.type&&(e=t.data.data.all,t=t.data.data.userData,n=0<t.length?t.map(function(t){return t.id}):l.user.user_id,(t=e.filter(function(t){return!n.includes(t.id)})).forEach(function(t,e){var n;t.packetContent&&""!=t.packetContent&&((n=JSON.parse(t.packetContent))&&0<n.length&&n.forEach(function(e){e.data&&(e.packetContent=e.data,delete e.data),e.packetContent&&0<e.packetContent.length&&(e.packetContent=e.packetContent.filter(function(t){return!s.includes(t.randomId)}),e.packetContent.forEach(function(t){t.paperPageId=e.papersPage||e.addPageId}),o.push.apply(o,(0,d.Z)(e.packetContent)))}),i.$set(t,"packetContent",u()(n)))}),i.renderCanvasData({otherUserData:t}))});case 13:o.some(function(e){return a.some(function(t){return n=t.paperPageId==e.paperPageId&&i.checkIntersect(t,e)}),!0}),n?dsf.layer.alert({message:"签批内容有重叠，请调整位置！",className:"delDialog"},function(){}):i.saveNotion(c);case 15:case"end":return t.stop()}},t)}))()},checkIntersect:function(t,e){var n=t.minXRatio+t.widthRatio>=e.minXRatio+e.widthRatio?t.minXRatio+t.widthRatio:e.minXRatio+e.widthRatio,i=t.minYRatio+t.heightRatio>=e.minYRatio+e.heightRatio?t.minYRatio+t.heightRatio:e.minYRatio+e.heightRatio,o=(t.minXRatio<=e.minXRatio?t:e).minXRatio,a=(t.minYRatio<=e.minYRatio?t:e).minYRatio;return n-o<=t.widthRatio+e.widthRatio&&i-a<=t.heightRatio+e.heightRatio},setCompleteHandle:function(t){var n=this;f()(".smt-tab-exit").click(function(){n.saveLoading=dsf.layer.loading("保存中")}),t?(t=n.signMobile.getAllData(),D.log(t,"保存数据"),n.handleSaveData(t.returnData),n.saveFontStyle(t.option)):n.signMobile.completeHandle=function(t,e){return D.log(t,"保存数据--只会返回自己的"),n.handleSaveData(t),n.saveFontStyle(e),!0}},handleSaveData:function(t){var e,n=this,i=this.userCurSignData.map(function(t){return t.addPageId}).filter(function(t){return t&&t.trim()}),o=[],a=[];this.userCurSignData.length>=t.length?(t.forEach(function(t){t.addPageId&&!i.includes(t.addPageId)&&(t.packetContent=t.data,delete t.data,o.push(t))}),this.userCurSignData.forEach(function(e){t.forEach(function(t){(e.papersPage&&t.papersPage&&e.papersPage==t.papersPage||!e.papersPage&&!t.papersPage&&e.addPageId==t.addPageId)&&(e.packetContent=t.data||t.packetContent)}),n.delPageId.includes(e.addPageId)||a.push(e)})):t.forEach(function(t){t.packetContent=t.data,delete t.data}),this.isShowCurPerson||this.formMeta&&this.formMeta.parameters&&this.formMeta.parameters.isShowCurPerson?this.userCurSignData.length>=t.length?(e=a.concat(o),this.saveNotion(e)):this.saveNotion(t):this.userCurSignData.length>=t.length?(e=a.concat(o),this.getCoverData(e)):this.getCoverData(t)},saveNotion:function(t,e){var n=this,t={imgData:"",type:3,content:"",papersId:n.curFileId,flowId:n.formInfo?n.formInfo.flowId:n.file.flowId||"",nodeId:n.formInfo?n.formInfo.nodeId:n.file.nodeId||"",packetContent:u()(t),moduleId:n.formInfo?n.formInfo.moduleId:n.file.moduleId||""};n.currentUserNotionData&&0<n.currentUserNotionData.length&&(t.id=n.currentUserNotionData[0].id),t.pnId=n.formMeta&&n.formMeta.parameters&&n.formMeta.parameters.pnId?n.formMeta.parameters.pnId:"",D.log(t),dsf.http.post("fn/hm/notation/save",t).then(function(t){t&&t.data&&"success"==t.data.type?(f()("#headerDiv").hide(),f()(".preview-container .signature-mobile-vertical").remove(),dsf.layer.closeLoading(n.saveLoading),dsf.layer.toast("保存成功",!0,function(){setTimeout(function(){n.writeOrPreview("p")},1500)})):(dsf.layer.toast("获取失败"),dsf.layer.closeLoading(n.saveLoading))}).error(function(t){D.log(t)}).always(function(){dsf.layer.closeLoading(n.saveLoading)})},getCurrentUserOpinionList:function(){var e=this;dsf.http.post("fn/hm/customOpinion/list",{}).then(function(t){t&&t.data&&0==t.data.code&&(e.signMobile.opinionList=t.data.data)})},getCurrentUserSignatureInfo:function(e){var n=this;dsf.http.get("fn/hm/sign/config",{}).then(function(t){t&&t.data&&"success"==t.data.type&&(n.signConfigObj=t.data.data,e)&&e()})},customOpinionSave:function(t){var e=this;dsf.http.post("fn/hm/customOpinion/save",t).then(function(t){t&&t.data&&"success"==t.data.msg?(dsf.layer.toast("保存成功"),e.signMobile.opinionList=t.data.list):dsf.layer.toast(t.data.msg)})},setOpinionEdit:function(){var e=this;e.signMobile.opinionEditHandler=function(t){e.customOpinionSave(t)}},setOpinionAdd:function(){var e=this;e.signMobile.opinionAddHandler=function(t){e.customOpinionSave(t)}},setOpinionDel:function(){this.signMobile.opinionDelHandler=function(t,e){dsf.layer.confirm({message:"确定要删除意见吗？",className:"delDialog"},function(){e(!0),dsf.http.get("fn/hm/customOpinion/del",{id:t.id}).then(function(t){t&&"success"==t.data.msg?dsf.layer.toast("删除成功"):dsf.layer.toast("删除失败")})},function(){e(!1)})}},recordHandle:function(){var n=this;n.signMobile.recordHandle=function(t,e){n.showTableDialog=!!e,n.showTableDialog&&(!n.isShowCurPerson||!n.isShowCurPerson&&n.formMeta&&n.formMeta.parameters&&!n.formMeta.parameters.isShowCurPerson)&&n.$nextTick(function(){n.renderRecord(n.allNotionData)})}},closeRecord:function(){this.showTableDialog=!1,f()(".smt-tab-item").each(function(){f()(this).hasClass("active")&&f()(this).removeClass("active"),f()(this).hasClass("xn-active")&&f()(this).removeClass("xn-active")})},imgPreview:function(t){this.showImgPreview=!0,this.previewImgs[0]=t},isShowPopover:function(){this.showPopover=!this.showPopover,this.instructorsList.length<=0&&dsf.layer.toast("暂无人员批示！")},changeInstructorSel:function(e){var t,n=this,i=0<this.currentUserNotionData.length?this.currentUserNotionData[0].createUserId:"",o=this.allNotionData.filter(function(t){return e.includes(t.createUserId)}),a=this.allNotionData.filter(function(t){return!n.currentUserNotionData.map(function(t){return t.createUserId}).includes(t.createUserId)});0<e.length?(t=o.filter(function(t){return t.createUserId===i}),o=o.filter(function(t){return t.createUserId!==i}),this.renderCanvasData({currentUserData:this.currentUserNotionData,otherUserData:a,currentFlag:!0,isTips:!0}),0<t.length&&0<o.length?this.renderCanvasData({currentUserData:t,otherUserData:o,isTips:!0}):0<t.length&&0===o.length?this.renderCanvasData({currentUserData:t,otherUserData:[],isTips:!0}):0===t.length&&0<o.length&&this.renderCanvasData({currentUserData:[],otherUserData:o,isTips:!0})):this.renderCanvasData({currentUserData:this.currentUserNotionData,otherUserData:a,currentFlag:!0,isTips:!0})},renderCanvasData:function(t){var e=this,n=t.currentUserData,i=t.otherUserData,o=t.currentFlag,a=t.isTips,s=this;n&&0<n.length&&n.forEach(function(t){t.packetContent&&""!=t.packetContent&&(t=JSON.parse(t.packetContent))&&0<t.length&&(t.forEach(function(t){var e;a?(0<(e=t.packetContent||t.data).length&&e.forEach(function(t){t.randomId&&document.querySelector('.signature-element-class[data-pid="'.concat(t.randomId,'"]'))&&(document.querySelector('.signature-element-class[data-pid="'.concat(t.randomId,'"]')).style.display=o?"none":"block")}),t.addPageId&&document.querySelector('.pinch-zoom[data-pid="'.concat(t.addPageId,'"]'))&&(document.querySelector('.pinch-zoom[data-pid="'.concat(t.addPageId,'"]')).style.display=o?"none":"flex")):t.addPageId&&!document.querySelector('.pinch-zoom[data-pid="'.concat(t.addPageId,'"]'))&&s.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition,isSelf:t.isSelf,isBack:!0},function(t){s.isPreview&&s.isShowDelBtn(!1)})}),a||0<e.sumAry.length&&e.sumAry.forEach(function(t){s.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition,isSelf:t.isSelf,isBack:!0},function(t){s.isPreview&&s.isShowDelBtn(!1)})}))}),i&&0<i.length&&(!this.isShowCurPerson||!this.isShowCurPerson&&this.formMeta&&this.formMeta.parameters&&!this.formMeta.parameters.isShowCurPerson)&&i.forEach(function(t){t.packetContent&&""!=t.packetContent&&(t=JSON.parse(t.packetContent))&&0<t.length&&(t.forEach(function(t){var e;a?(0<(e=t.packetContent||t.data).length&&e.forEach(function(t){t.randomId&&document.querySelector('.signature-element-history-class img[data-pid="'.concat(t.randomId,'"]'))&&(document.querySelector('.signature-element-history-class img[data-pid="'.concat(t.randomId,'"]')).style.display=o?"none":"block")}),t.addPageId&&document.querySelector('.pinch-zoom[data-pid="'.concat(t.addPageId,'"]'))&&(document.querySelector('.pinch-zoom[data-pid="'.concat(t.addPageId,'"]')).style.display=o?"none":"flex")):t.addPageId&&!document.querySelector('.pinch-zoom[data-pid="'.concat(t.addPageId,'"]'))&&s.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition,isSelf:!1,isBack:!0},function(t){s.isPreview&&s.isShowDelBtn(!1)})}),a||0<e.sumAry.length&&e.sumAry.forEach(function(t){s.handleCreateNewPage(t,t.addPageId,{addPosition:t.addPosition,isSelf:!1,isBack:!0},function(t){s.isPreview&&s.isShowDelBtn(!1)})}))}),this.sortPageNum()},fullScreen:function(){this.$emit("fullScreen")},writeOrPreview:(N=function(t){"p"==t?this.$emit("goPreview"):"w"==t&&this.$emit("goHandWrite")},O=2e3,M=!(z=null),function(){M&&(M=!1,N.apply(this,arguments),setTimeout(function(){M=!0},O))}),goSnapshot:function(t){this.showSnapshot=!0,this.recordTime=t.createTime,this.currentPage=Number(t.pageNum)},saveFontStyle:function(t){t={fontFamily:t.fontFamily,fontSize:t.fontSize,color:t.color};dsf.http.post("fn/hm/sign/saveConfig",{data:u()(t)}).then(function(t){D.log(t)}).error(function(t){D.log(t)}).always(function(){})},resetSignData:function(){f()(".smt-tab-item").each(function(){f()(this).hasClass("active")&&f()(this).removeClass("active"),f()(this).hasClass("xn-active")&&f()(this).removeClass("xn-active")});var e=[],t=(this.allPageData.forEach(function(t){t&&t.packetContent&&t.packetContent.forEach(function(t){e.push(t.randomId)})}),this.signMobile.sourceSignaturePool.map(function(t){t.data=t.data.filter(function(t){return e.includes(t.randomId)&&!t.addType})}),document.querySelectorAll(".signature-element-class"));if(t)for(var n=0;n<t.length;n++)t[n].remove();var i=JSON.parse(u()(this.allPageData)),o=this.leaderUser||this.user.user_id,a=i.filter(function(t){return t.createUserId==o}),i=i.filter(function(t){return t.createUserId!=o});!this.isShowCurPerson||!this.isShowCurPerson&&this.formMeta&&this.formMeta.parameters&&!this.formMeta.parameters.isShowCurPerson?this.signMobile.setPageHistoryData(a,i):this.signMobile.setPageHistoryData(a,[])}},beforeDestroy:function(){this.destroyInterval(),window.removeEventListener("scroll",this.handleScroll,!0),document.body.style.backgroundColor="#f7f7f7"}}),F=(0,C.Z)(t,function(){var t,n=this,i=n._self._c;return n.isSinglePre&&n.isPreview?i("div",{staticClass:"single-preview",style:{height:"calc(100vh - ".concat(n.dsf.util.getOffsetTop()," - ").concat(n.isShowAppFooter?"1.2rem":"0px"," - ").concat(n.isTabType?"0.88rem":"0px",")")}},[i("single-preview",{attrs:{imgs:n.fileImgs}})],1):i("div",{ref:"previewContainer",staticClass:"preview-container"},[i("div",{ref:n.timestamp,staticClass:"preview-box",attrs:{id:n.timestamp}},[i("div",{staticClass:"iconBox flex dc"},["iPad"==n.dsf.util.getClientType()&&null!=(t=n.dsf.config.meetProjectconfig)&&t.fileSameScreenFlag?i("img",{attrs:{src:e(61256),alt:""},on:{click:n.showSameClick}}):n._e(),n._v(" "),n.isShowFullScreen?i("img",{attrs:{src:e(65332),alt:""},on:{click:n.fullScreen}}):n._e(),n._v(" "),0<n.file.isHandwrite&&(n.formMeta||!n.formMeta&&n.isSignature)?i("div",[n.isPreview?i("img",{attrs:{src:e(90395),alt:""},on:{click:function(t){return n.writeOrPreview("w")}}}):n._e(),n._v(" "),n.isPreview?n._e():i("img",{attrs:{src:e(71562),alt:""},on:{click:function(t){return n.writeOrPreview("p")}}})]):n._e(),n._v(" "),n.isPreview&&(!n.isShowCurPerson||!n.isShowCurPerson&&n.formMeta&&n.formMeta.parameters&&!n.formMeta.parameters.isShowCurPerson)&&n.signConfigObj&&"1"!=n.signConfigObj.handWriteHis&&0<n.instructorsList.length&&!n.isHideInstructor?i("van-popover",{attrs:{trigger:"click",placement:"left"},scopedSlots:n._u([{key:"reference",fn:function(){return[i("img",{attrs:{src:e(21020),alt:""},on:{click:function(t){return t.stopPropagation(),n.isShowPopover.apply(null,arguments)}}}),n._v(" "),n.personScreen.length<n.instructorsList.length?i("i",{staticClass:"dot"}):n._e()]},proxy:!0}],null,!1,660113534),model:{value:n.showPopover,callback:function(t){n.showPopover=t},expression:"showPopover"}},[i("p",{staticClass:"instructor"},[n._v("批示人")]),n._v(" "),i("van-checkbox-group",{ref:"checkboxGroup",on:{change:n.changeInstructorSel},model:{value:n.personScreen,callback:function(t){n.personScreen=t},expression:"personScreen"}},n._l(n.instructorsList,function(t){return i("van-checkbox",{key:t.createUserId,attrs:{name:t.createUserId,"icon-size":"16px"}},[n._v(n._s(t.createUName))])}),1)],1):n._e()],1),n._v(" "),n.errored?i("div",{staticStyle:{"text-align":"center"}},[i("commonempty",{attrs:{description:n.errorMsg}}),n._v(" "),n.isRetry?i("van-button",{staticClass:"bottom-button",attrs:{round:"",type:"primary"}},[n._v("自动重试("+n._s(n.count)+"s)")]):n._e()],1):n._e(),n._v(" "),!n.errored&&0<n.imgs.length?i("div",{ref:"container",staticClass:"container",staticStyle:{background:"#fff"}},[i("div",{staticStyle:{display:"none"},attrs:{id:"headerDiv"}}),n._v(" "),i("div",{ref:"pageContainer",staticClass:"pageContainer"},[i("div",{directives:[{name:"focus",rawName:"v-focus"}],ref:"pageViewer",staticClass:"pageViewer"},n._l(n.imgs,function(t,e){return i("div",{key:e,ref:"pinchZoom",refInFor:!0,class:["pinch-zoom",n.isFileImgMargin?"imgHasMargin":"imgNoMargin"],attrs:{id:"page"+e,"data-pid":e+1}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"img.show"},{name:"lazy",rawName:"v-lazy",value:t.path,expression:"img.path"}],ref:"viewImg",refInFor:!0,staticClass:"view-img"})])}),0)])]):n._e(),n._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:n.isPreview&&!n.errored,expression:"isPreview && !errored"}],staticClass:"catalogue",on:{click:function(t){n.show=!0}}},[i("van-icon",{attrs:{name:"coupon-o"}})],1),n._v(" "),i("van-popup",{staticClass:"file_popup",attrs:{position:"left","get-container":"body","overlay-style":{"z-index":"9999"}},model:{value:n.show,callback:function(t){n.show=t},expression:"show"}},[i("div",{staticClass:"pages"},[i("p",[n._v("跳转至：")]),n._v(" "),n._l(n.pageLength,function(e){return i("a",{key:e+"x",on:{click:function(t){return n.goPageNum(e)}}},[n._v("第"+n._s(e)+"页")])})],2)])],1),n._v(" "),i("van-popup",{style:{height:"100%"},attrs:{position:"bottom","get-container":"#app"},model:{value:n.showTableDialog,callback:function(t){n.showTableDialog=t},expression:"showTableDialog"}},[i("van-sticky",[i("van-nav-bar",{attrs:{title:"批注记录"},on:{"click-left":n.closeRecord},scopedSlots:n._u([{key:"left",fn:function(){return[i("van-icon",{attrs:{name:"arrow-left"}}),i("span",[n._v("返回")])]},proxy:!0}])})],1),n._v(" "),n.commentRecordList&&0<n.commentRecordList.length?i("div",{staticClass:"table-list"},n._l(n.commentRecordList,function(e,t){return i("div",{key:t,staticClass:"list-item"},[i("div",{staticClass:"item-content"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.base64,expression:"item.base64"}],ref:"contentImg",refInFor:!0,staticClass:"content-img",on:{click:function(t){return n.imgPreview(e.base64)}}})]),n._v(" "),i("div",{staticClass:"item-text"},[i("div",[i("p",[i("van-icon",{attrs:{name:"user-o"}}),n._v(n._s(e.createUName)+"\n                        ")],1)]),n._v(" "),i("div",[i("p",[i("van-icon",{attrs:{name:"clock-o"}}),n._v(n._s(e.createTime)+"\n                        ")],1)]),n._v(" "),i("div",[i("p",[i("van-icon",{attrs:{name:"description"}}),n._v("第"+n._s(e.pageNum)+"页\n                        ")],1),n._v(" "),i("span",{on:{click:function(t){return n.goSnapshot(e)}}},[n._v("快照查看")])])])])}),0):i("commonempty",{attrs:{description:"暂无批注记录"}})],1),n._v(" "),i("van-popup",{style:{height:"100%"},attrs:{position:"bottom","get-container":"#app"},model:{value:n.showSnapshot,callback:function(t){n.showSnapshot=t},expression:"showSnapshot"}},[i("van-sticky",[i("van-nav-bar",{attrs:{title:"快照查看"},on:{"click-left":function(t){n.showSnapshot=!1}},scopedSlots:n._u([{key:"left",fn:function(){return[i("van-icon",{attrs:{name:"arrow-left"}}),i("span",[n._v("返回")])]},proxy:!0}])})],1),n._v(" "),i("snapshot-preview",{attrs:{file:n.file,"form-info":n.formInfo,formMeta:n.formMeta,isShowFullScreen:!0,snapshotTime:n.recordTime,curFileId:n.curFileId,curPage:n.currentPage}})],1),n._v(" "),i("van-image-preview",{attrs:{images:n.previewImgs,closeable:""},model:{value:n.showImgPreview,callback:function(t){n.showImgPreview=t},expression:"showImgPreview"}}),n._v(" "),n.showSame?i("screen-person",{attrs:{meetingObj:n.meetingObj,files:n.file},on:{showSameClick:n.showSameClick}}):n._e()],1)},[],!1,null,"26d7d0d1",null).exports},69448:function(t,e,n){n.d(e,{Z:function(){return c}});var e=n(26243),a=n.n(e),i=n(5044),o=n(77193),e=n(90487),s=n.n(e),r=(n(88561),n(25108)),e={components:{},props:{accept:{type:Boolean,default:!1},meetingObj:{type:Object,default:{meetingId:"",topicId:"",fileId:"",mode:"",sendUserId:"",sendUserName:"",personnelUserid:"",isLocked:"-1"}}},data:function(){var t={showScr:!1,showRemainDialog:!1,sameFile:{},action:"self_unit",checked:!1,tabNum:1,personData:[],show:!1,partyArr:[]};return(0,o.Z)(t,"sameFile",[]),(0,o.Z)(t,"list",{}),(0,o.Z)(t,"checkData",[]),(0,o.Z)(t,"flag",!0),(0,o.Z)(t,"openList",!1),(0,o.Z)(t,"openIframe",!1),(0,o.Z)(t,"SameUrl",""),(0,o.Z)(t,"ids",""),(0,o.Z)(t,"sameboxNum",3),(0,o.Z)(t,"promoter",dsf.util.loadSessionStore("user")),(0,o.Z)(t,"dialogIndex",0),(0,o.Z)(t,"isLocked",!1),(0,o.Z)(t,"isSend",!1),(0,o.Z)(t,"dialogData",[{title:"是否开启同屏共享",button:"开启同屏"},{title:"是否继续邀请人员",button:"邀请"},{title:"是否关闭同屏",button:"关闭"}]),(0,o.Z)(t,"timer",10),(0,o.Z)(t,"inter1",null),(0,o.Z)(t,"inter2",null),(0,o.Z)(t,"showScrDialog",!0),t},watch:{list:{handler:function(t,e){var n,i=this;for(n in this.checkData=[],t)t[n].forEach(function(t){t.checked&&i.checkData.push(t)})},deep:!0},checked:{handler:function(e,t){if(1!=this.dialogIndex)for(var n in this.list)this.list[n].forEach(function(t){t.checked=e})},deep:!0},action:{handler:function(t,e){this.getData()},deep:!0},sameboxNum:{handler:function(t,e){var n=this;1==t?this.inter1=setInterval(function(){n.timer--,n.timer<1&&(n.showRemainDialog=!0,n.sameboxNum=2,clearInterval(n.inter1))},1e3):(setTimeout(function(){n.timer=10},1e3),clearInterval(this.inter1))},deep:!0},showScrDialog:{handler:function(t,e){var n=this;t?(setTimeout(function(){n.timer=10},1e3),clearInterval(this.inter2)):this.inter2=setInterval(function(){n.timer--,n.timer<1&&(n.showScrDialog=!0,n.showRemainDialog=!0,clearInterval(n.inter2))},1e3)},deep:!0}},mounted:function(){this.getData(),this.accept?(r.log("接收人打开同屏"),r.log(this.meetingObj),this.meetingObj.sendUserId?(this.SameUrl="/p1000/idm/index.html?meetingId=".concat(this.meetingObj.meetingId,"&topicId=").concat(this.meetingObj.topicId,"&fileId=").concat(this.meetingObj.fileId,"&mode=").concat(this.meetingObj.mode,"#/preview/231017141823jg9mxImk7iStWUTpGPm"),1==this.meetingObj.isLocked?this.showBox(!0,!1,!0,!0,2):this.showScrDialog=!1):(this.showScrDialog=!1,this.showRemainDialog=!0)):(r.log("发起人打开同屏"),this.showBox(!0,!0,!1,!0,2))},methods:{showBox:function(t,e,n,i,o){this.showScr=t,this.openList=e,this.openIframe=n,this.showRemainDialog=i,this.sameboxNum=o},sameBoxClick:function(){1==this.sameboxNum?this.sameboxNum=2:this.sameboxNum=1},cancelDiolog:function(t){var e=this;0==t?(this.closeSameScreen(),setTimeout(function(){e.$emit("showSameClick")},100)):this.showRemainDialog=!0},againOpen:function(){this.showBox(!0,!1,!0,!0,2)},showDialog:function(t){this.dialogIndex=t,this.showRemainDialog=!1,this.sameboxNum=2},cancel:function(t){var e=this;0==t?setTimeout(function(){e.$emit("showSameClick")},100):this.showBox(!0,!1,!0,!0,2)},openUser:function(t){var e=this;r.log(t),this.meetingObj.sendUserId&&this.meetingObj.sendUserId!=this.promoter.user_id?setTimeout(function(){e.$emit("showSameClick")},100):0==t||1==t?this.showBox(!0,!0,!1,!0,2):(r.log("主持人关闭"),this.closeSameScreen(),setTimeout(function(){e.$emit("showSameClick")},100))},screenClick:function(t){this.showRemainDialog=!this.showRemainDialog,r.log(t),this.sameFile=t.files},getData:function(){var e=this,o=this;this.personData=[],this.partyArr=[],this.list={},dsf.http.post("/fn/conferenceOrg/user-select/data?meetingId=".concat(this.meetingObj.meetingId,"&action=").concat(this.action,"&choiceOrg=true"),{}).done(function(t){r.log(t.data),200==t.code&&t.data.departmentList&&(o.loopData(t.data.departmentList),(0,i.Z)(new(s())(o.partyArr)).forEach(function(n){var i=[];o.personData.forEach(function(t){var e;null!=(e=o.meetingObj.personnelUserid)&&e.includes(t.attrs.idValue)?(o.$set(t,"checked",!0),o.checkData.push(t)):o.$set(t,"checked",!1),t.attrs.fullDeptName==n&&i.push(t)}),o.$set(o.list,n,i)}),r.log(e.personData))})},loopData:function(t){var e=this;t.forEach(function(t){"1"==t.type?(e.partyArr.push(t.attrs.fullDeptName),t.attrs.idValue!=e.promoter.user_id&&e.personData.push(t)):0<t.children.length&&e.loopData(t.children)})},tabClick:function(t,e){this.tabNum=t,this.action=e},infoClick:function(t){1!=this.dialogIndex&&(t.checked=!t.checked)},againSameScreen:function(e){var n=dsf.layer.loading("邀请中");dsf.http.post("fn/conferenceMobile/addPersonnelSameScreen",{meetingId:this.meetingObj.meetingId,personnelUserid:e.attrs.idValue,isLocked:this.isLocked?"1":"-1"}).done(function(t){200==t.code?(dsf.layer.closeLoading(n),e.checked=!0,dsf.layer.toast("已邀请")):dsf.layer.toast(t.message)})},closeSameScreen:function(){this.meetingObj.sendUserId!=this.promoter.user_id&&!this.isSend||dsf.http.post("fn/conferenceMobile/endSameScreen",{meetingId:this.meetingObj.meetingId}).done(function(t){200==t.code&&t.data&&dsf.layer.toast(t.message)})},openSameScreen:function(t){var n=this;0==this.checkData.length?dsf.layer.toast("请选择人员"):0==t&&(this.isSend=!0,this.ids="",this.checkData.forEach(function(t,e){n.ids+=0==e?t.attrs.idValue:","+t.attrs.idValue}),dsf.http.post("fn/conferenceMobile/startSameScreen",{meetingId:this.meetingObj.meetingId,personnelUserid:this.ids,fileId:this.meetingObj.fileId,isLocked:this.meetingObj.isLocked||this.isLocked?"1":"-1"}).done(function(t){r.log(t),"200"==t.code?(setTimeout(function(){n.sameboxNum=2},500),n.openList=!1,n.openIframe=!0,n.SameUrl="/p1000/idm/index.html?meetingId=".concat(n.meetingObj.meetingId,"&topicId=").concat(n.meetingObj.topicId,"&fileId=").concat(n.meetingObj.fileId,"&mode=").concat(n.meetingObj.mode,"#/preview/231017141823jg9mxImk7iStWUTpGPm")):dsf.layer.toast(t.message)}))},openScr:function(){this.showBox(!0,!1,!0,!0,2),this.showScrDialog=!0,r.log(this.showRemainDialog)},remove:function(){this.$emit("showSameClick")}}},c=(0,n(51900).Z)(e,function(){var t,i=this,o=i._self._c;return o("div",{staticClass:"list"},[o("van-popup",{staticClass:"file-preview",staticStyle:{height:"100vh"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom"},model:{value:i.showScr,callback:function(t){i.showScr=t},expression:"showScr"}},[i.openList?o("div",{staticClass:"in-list"},[o("div",{staticClass:"card",on:{click:function(t){return i.cancel(i.dialogIndex)}}},[o("div",[o("van-icon",{attrs:{name:"arrow-left"}}),i._v(" "),o("span",[i._v("组织架构排序")])],1),i._v(" "),o("p",[i._v("人员选择")])]),i._v(" "),o("div",{staticClass:"in-box"},[i._e(),i._v(" "),o("div",{staticClass:"com-tit"},[o("span",[i._v("选择方式")]),i._v(" "),o("i")]),i._v(" "),o("ul",{staticClass:"tab-ul"},[o("li",{class:{active:1==i.tabNum},on:{click:function(t){return i.tabClick(1,"self_unit")}}},[o("i",{staticClass:"icon iconfont iconzhongyaohuiyi"}),i._v(" "),o("span",[i._v("会议人员")])]),i._v(" "),o("li",{class:{active:2==i.tabNum},on:{click:function(t){return i.tabClick(2,"private_group")}}},[o("i",{staticClass:"icon iconfont iconbumen"}),i._v(" "),o("span",[i._v("我的群组")])])]),i._v(" "),o("div",{staticClass:"com-tit com-tit1"},[o("span",[i._v("参会人员")]),i._v(" "),o("div",[1!=i.dialogIndex?o("van-checkbox",{attrs:{shape:"square","icon-size":"20px"},model:{value:i.isLocked,callback:function(t){i.isLocked=t},expression:"isLocked"}},[i._v("强制共享")]):i._e(),i._v(" "),1!=i.dialogIndex?o("van-checkbox",{attrs:{shape:"square","icon-size":"20px"},model:{value:i.checked,callback:function(t){i.checked=t},expression:"checked"}},[i._v("全选")]):i._e()],1)]),i._v(" "),o("div",{staticClass:"tree"},[0<a()(i.list).length?i._l(i.list,function(t,n,e){return o("div",{key:e,staticClass:"tree-item"},[o("div",{staticClass:"tree-tit"},[o("i",{staticClass:"icon iconfont iconarrow-right-drop-circle-outline"}),i._v(" "),o("span",[i._v(i._s(n))])]),i._v(" "),o("ul",{staticClass:"tree-item-ul"},i._l(t,function(e,t){return o("li",{key:t,on:{click:function(t){return t.stopPropagation(),i.infoClick(e)}}},[o("van-checkbox",{attrs:{shape:"square","icon-size":"20px",disabled:""},model:{value:e.checked,callback:function(t){i.$set(e,"checked",t)},expression:"it.checked"}},[o("p",{staticClass:"p"},[i._v("\n                      "+i._s(e.name)),e.attrs.dwzw?o("label",{staticClass:"label",attrs:{for:""}},[i._v("（"+i._s(e.attrs.dwzw)+"）")]):i._e(),1==i.dialogIndex&&e.checked?o("i",{staticClass:"i"},[i._v("共享中")]):i._e()])]),i._v(" "),o("span",[i._v("单位："+i._s(n))]),i._v(" "),o("div",[i.promoter.user_id!=e.attrs.idValue&&1==i.dialogIndex&!e.checked?o("label",{attrs:{for:""},on:{click:function(t){return t.stopPropagation(),i.againSameScreen(e)}}},[i._v("邀请人员")]):i._e(),i._v(" "),o("i",{class:{active:"1"==e.attrs.signValue}},[i._v(i._s("1"==e.attrs.signValue?"已签到":"未签到"))])])],1)}),0)])}):o("commonempty",{staticClass:"empty",attrs:{description:"暂无人员数据"}})],2)]),i._v(" "),o("div",{staticClass:"footer"},[o("div",{staticClass:"line"}),i._v(" "),o("div",[o("label",{attrs:{for:""}},[i._v("已选择")]),i._v(" "),o("div",i._l(i.checkData,function(t,e){return o("span",{key:e},[i._v(i._s(t.name))])}),0)]),i._v(" "),o("button",{class:{active:1==i.dialogIndex},on:{click:function(t){return i.openSameScreen(i.dialogIndex)}}},[i._v("\n          确定 （"+i._s(i.checkData.length)+"/"+i._s(i.personData.length)+"）\n        ")])])]):i._e(),i._v(" "),i.openIframe?o("div",{staticClass:"in-list"},[o("iframe",{attrs:{src:i.dsf.url.getWebPath(i.SameUrl)}})]):i._e()]),i._v(" "),o("div",{staticClass:"mask",class:{active:i.showRemainDialog}},[o("div",{staticClass:"diolag"},[o("p",[i._v(i._s(i.dialogData[i.dialogIndex].title))]),i._v(" "),o("div",[o("span",{on:{click:function(t){return i.cancelDiolog(i.dialogIndex)}}},[i._v("取消")]),i._v(" "),o("span",{on:{click:function(t){return i.openUser(i.dialogIndex)}}},[i._v(i._s(i.dialogData[i.dialogIndex].button))])])])]),i._v(" "),o("div",{staticClass:"mask",class:{active:i.showScrDialog}},[o("div",{staticClass:"diolag"},[i.meetingObj.sendUserId!=i.promoter.user_id?o("p",[i._v("\n        "+i._s(i.meetingObj.sendUserName)+"发送了一条同屏分享，是否参加("+i._s(this.timer)+"s后自动关闭)\n      ")]):o("p",[i._v("\n        您开启的同屏正在共享中...，是否再次进入("+i._s(this.timer)+"s后自动关闭)\n      ")]),i._v(" "),o("div",[o("span",{on:{click:i.remove}},[i._v("取消")]),i._v(" "),o("span",{on:{click:function(t){return i.openScr()}}},[i._v("参加")])])])]),i._v(" "),o("div",{staticClass:"same-box",class:{openhalf:2==i.sameboxNum,open:1==i.sameboxNum,close:0==i.sameboxNum}},[o("div",[o("i",{staticClass:"icon iconfont iconhuiyitongzhi",on:{click:i.againOpen}}),i._v(" "),!i.meetingObj.sendUserId||i.meetingObj.sendUserId&&i.meetingObj.sendUserId==i.promoter.user_id?o("i",{staticClass:"icon iconfont iconfaqiqunliao",on:{click:function(t){return i.showDialog(1)}}}):i._e(),i._v(" "),"-1"==(null==(t=i.meetingObj)?void 0:t.isLocked)&&i.meetingObj.sendUserId!=i.promoter.user_id||i.meetingObj.sendUserId==i.promoter.user_id||i.isSend?o("i",{staticClass:"icon iconfont iconpower",on:{click:function(t){return i.showDialog(2)}}}):i._e()]),i._v(" "),o("div",{on:{click:i.sameBoxClick}},[i._v("\n      "+i._s(i.meetingObj.sendUserName||i.promoter.name)+"发起的同屏，共享中...\n    ")])])],1)},[],!1,null,"287d62b9",null).exports},90395:function(t,e,n){t.exports=n.p+"static/img/edit.eb018c8..png"},21020:function(t,e,n){t.exports=n.p+"static/img/filter.138ced8..png"},65332:function(t,e,n){t.exports=n.p+"static/img/full.5d71e28..png"},71562:function(t,e,n){t.exports=n.p+"static/img/preview.8077f0f..png"},61256:function(t,e,n){t.exports=n.p+"static/img/voice.764a71a..png"}}]);