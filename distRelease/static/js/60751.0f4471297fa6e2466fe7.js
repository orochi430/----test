"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[60751,18868,92137],{80993:function(t,e,i){i.r(e),i.d(e,{default:function(){return a}});var e=i(26243),r=i.n(e),e=i(8450),c=i.n(e),e=i(63560),n=i(92137),o=i(96345),l=i(25108),e={name:"MeetingBook",components:{selectPerson:e.default,TipsSetting:n.default,sendWorkflow:o.Z},filters:{dateFilter:function(t){return t?dsf.date.format(t,"mm月dd日 DD"):"请选择"},timeFilter:function(t,e){return t?dsf.date.format(t,"hh:ii"):e}},data:function(){var t=new Date;return t.setFullYear(t.getFullYear()+2),{showFlowSend:!0,showPopup:!1,attach_1:[],minDate:new Date,maxDate:t,showStartTimePicker:!1,showEndTimePicker:!1,showStartTimePicker1:!1,showEndTimePicker1:!1,form:{meeting:"",isAllDay:!1,address:"",startTime:null,endTime:null,room:"会议室，老宋办公室",room_data:"",Invited:"",Invited_data:{},timetips:"15分钟前,应用内提醒",uploader:[],hyzc:"",chld:"",chdw:"",chry:""},rules:{meeting:[{required:!0,message:"请填写会议标题"}]},meetingData:[],show:!1,showPerson:!1,roomshow:!1,maininfo:{},moduleId:"190121161348OthBI4s3sEhvfuDJ5FD",formId:"200514112152F5P6eHVjGZo3WXAlvtw",info_id:"",sdate:"",edate:"",meeting_type:0,Invited_data:{},cur_index:0,hyzc_list:"",chld_list:"",chdw_list:"",chry_list:"",dataValue:{}}},created:function(){this.initData(),this.postData()},mounted:function(){this.meeting_type=this.$route.query.type,this.getUserList()},methods:{getContainer:function(){return document.body},onRefresh:function(){this.$store.commit("refreshRouteByReg",["/meetingCenter","/todocenter","/"]),this.$router.go(-1)},onConfirm:function(t,e){l.log(t),this.$set(this.form,e,t),"startTime"==e?this.sdate=dsf.date.format(t,"yyyy-mm-dd hh:ii"):this.edate=dsf.date.format(t,"yyyy-mm-dd hh:ii"),l.log(this.sdate),this.showStartTimePicker=!1,this.showEndTimePicker=!1,this.showStartTimePicker1=!1,this.showEndTimePicker1=!1},onSubmit:function(e,i){var n=this,o=(l.log("===表单最终提交数据"),this.maininfo.B0001={},this.maininfo["c-meetingtz-019"]={},this.maininfo["c-meetingtz-020"]={},this.maininfo["c-meetingtz-030"]={},this.maininfo["c-meetingtz-004"]={},this.maininfo["c-meetingtz-011"]={},this.maininfo["c-meetingtz-014"]={},this.maininfo["c-meetingtz-028"]={},this.maininfo["c-meetingtz-013"]={},this.maininfo["c-meetingtz-029"]={},this.maininfo["c-meetingtz-012"]={},this.maininfo.A0005={},this.maininfo.A0005.value="会议申请",this.maininfo.B0001.value=this.form.meeting,this.maininfo["c-meetingtz-019"].value=this.sdate,this.maininfo["c-meetingtz-020"].value=this.edate,this.maininfo["c-meetingtz-004"].value="普通会议",this.maininfo["c-meetingtz-030"].value=this.form.address,this.maininfo["c-meetingtz-029"].value="",this.maininfo["c-meetingtz-012"].value="",{}),t=(r()(this.maininfo).forEach(function(t,e){o[t]={},o[t].values=[{key:"value",value:n.maininfo[t].value}]}),o["c-meetingtz-011"]={},o["c-meetingtz-011"]={values:[{key:"text",value:this.hyzc_list.str||""},{key:"value",value:this.hyzc_list.id||""}]},o["c-meetingtz-014"]={},o["c-meetingtz-014"]={values:[{key:"text",value:this.chld_list.str||""},{key:"value",value:this.chld_list.id||""}]},o["c-meetingtz-028"]={},this.chdw_list.id?this.chdw_list.id.split(","):[]),a="",t=(t.forEach(function(t,e){t="4::"+t.split("_")[1];""==a?a=t:a+=","+t}),o["c-meetingtz-043"]={values:[{key:"text",value:this.chdw_list.str||""},{key:"value",value:this.chdw_list.id||""},{key:"schema",value:this.chdw_list.id||""}]},o["c-meetingtz-013"]={},o["c-meetingtz-013"]={values:[{key:"text",value:this.chry_list.str||""},{key:"value",value:this.chry_list.id||""}]},this.dataValue.bt=this.form.meeting,{moduleId:this.moduleId,pk:this.info_id,formId:this.formId,__DATA:c()({maininfo:o})}),s=(l.log(t),l.log(c()(o)),this);dsf.http.post("/fn/xform/save",t).then(function(t){200==t.data.code?(l.log(t),1==i&&(s.showPopup=!0,s.showFlowSend=!0,s.$nextTick(function(){s.$refs.sendFile.show()})),e&&e(t)):s.$toast.fail("保存失败,"+t.data.message)})},sendMeetingSq:function(){dsf.http.get("fn/newMobileMeeting/sendMeetingSq",{pk:this.info_id}).then(function(t){l.log("通知发送成功")})},getUserList:function(){var e=this;dsf.http.get("/fn/xform/data?pk=&moduleId="+this.moduleId,{}).then(function(t){l.log("===请求表单数据接口"),l.log(t.data.main),e.maininfo=t.data.main,e.info_id=t.data.main.A0001.value,l.log(e.maininfo);dsf.http.post("/fn/flow/getFlowDraftData",{moduleId:e.moduleId,flowId:""}).then(function(t){t&&200==t.data.code&&(t=t.data.data,e.dataValue.sendType="SR_SEND",e.dataValue.pid=t.pId,e.dataValue.pnid=t.pnId,e.dataValue.flowId=t.flowId,e.dataValue.moduleId=e.moduleId,e.dataValue.moduleName="会议室申请",e.dataValue.info_id=e.info_id)})})},formatter:function(t,e){return"year"===t?"".concat(e,"年"):"month"===t?"".concat(e,"月"):"day"===t?"".concat(e,"日"):"hour"===t?"".concat(e,"时"):"minute"===t?"".concat(e,"分"):e},tipsSetting:function(){this.show=!0},getData:function(t){l.log(t),this.show=!1,this.form.timetips=t},cancePerson:function(){this.showPerson=!1},chooseStartTime:function(){this.form.isAllDay?(this.showStartTimePicker=!1,this.showStartTimePicker1=!0):(this.showStartTimePicker1=!1,this.showStartTimePicker=!0)},chooseEndTime:function(){this.form.isAllDay?(this.showEndTimePicker=!1,this.showEndTimePicker1=!0):(this.showEndTimePicker1=!1,this.showEndTimePicker=!0)},getUserNames:function(t){var i="",n="";return t.forEach(function(t,e){""==i?(i=t.name,n=t.id):(i+=","+t.name,n+=","+t.id)}),{str:i,id:n}},getSelectUser:function(t){l.log("我的",t),t&&0<t.length&&(0==this.cur_index?(this.hyzc_list=this.getUserNames(t),this.form.hyzc=this.hyzc_list.str):1==this.cur_index?(this.chld_list=this.getUserNames(t),this.form.chld=this.chld_list.str):2==this.cur_index?(this.chdw_list=this.getUserNames(t),this.form.chdw=this.chdw_list.str):3==this.cur_index&&(this.chry_list=this.getUserNames(t),this.form.chry=this.chry_list.str))},selectUser:function(t){this.showPerson=!0,this.cur_index=t,this.meeting_type=2==this.cur_index?3:0,l.log("选人")},closePerson:function(){this.showPerson=!this.showPerson},selectRoom:function(){l.log("选会议室"),this.roomshow=!0},sureRoom:function(t){this.form.room=t.name,this.form.room_data=t,this.roomshow=!1},initData:function(){l.log(this.$route.query),this.form.room=this.$route.query.name,this.form.room_data={name:this.$route.query.name,id:this.$route.query.id}},postData:function(){var e=this,t=dsf.layer.loading();dsf.http.post("fn/meeting/meetingRoomJson",{date:this.$route.query.date||dsf.date.format(new Date,"yyyy-mm-dd")}).done(function(t){t.code+""=="200"&&(l.log(t.data),e.postDataSuccess(t.data))}).error(function(){dsf.layer.toast("请求异常")}).always(function(){dsf.layer.closeLoading(t)})},postDataSuccess:function(t){l.log(t),this.meetingData=t},doFileRead:function(t,e){var i=this,e="/fn/mobileAttachment/upload?fileId=&moduleId="+this.moduleId+"&mid="+this.moduleId+"&pId=0&pnId=0&nodeName="+encodeURI("拟稿")+"&nrType="+e+"&pk="+this.info_id+"&newFileFlag=0";dsf.http.upload(e,{},t).then(function(t){l.log(t),t.data.result?(dsf.layer.toast("上传成功"),i.getWebFiles()):dsf.layer.toast(t.data.message)})},afterRead:function(e){var i=this;this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),this.onSubmit(function(t){i.doFileRead(e,1)})},getWebFiles:function(){var t={info_id:this.info_id,infoId:this.info_id,moduleId:this.moduleId,nodeId:"",start:0,limit:100},i=this;dsf.http.post("/fn/mobileAttachment/getFormAttachment",t).then(function(t){l.log(t.data),t&&t.data&&t.data.rows&&t.data.rows.forEach(function(t,e){"1"==t.attachType&&(i.attach_1=t.document)}),i.$toast.clear()})},removeFile:function(t){l.log(t);var t={pk:t.infoId,fileId:t.id,moduleId:t.moduleId,mid:t.moduleId,nrType:t.type,fileName:t.title},e=this;dsf.http.post("/fn/mobileFileUpload/delete",t).then(function(t){t.data.result&&(dsf.layer.toast(t.data.message),e.getWebFiles())})}}},a=(0,i(51900).Z)(e,function(){var i=this,n=i._self._c;return n("div",{staticClass:"ds-meeting-book"},[n("van-popup",{attrs:{position:"bottom"},model:{value:i.showStartTimePicker,callback:function(t){i.showStartTimePicker=t},expression:"showStartTimePicker"}},[n("van-datetime-picker",{attrs:{"min-date":i.minDate,"max-date":i.maxDate,formatter:i.formatter,type:"datetime"},on:{confirm:function(t){return i.onConfirm(t,"startTime")},cancel:function(t){i.showStartTimePicker=!1}}})],1),i._v(" "),n("van-popup",{attrs:{position:"bottom"},model:{value:i.showEndTimePicker,callback:function(t){i.showEndTimePicker=t},expression:"showEndTimePicker"}},[n("van-datetime-picker",{attrs:{"min-date":i.minDate,"max-date":i.maxDate,formatter:i.formatter,type:"datetime"},on:{confirm:function(t){return i.onConfirm(t,"endTime")},cancel:function(t){i.showEndTimePicker=!1}}})],1),i._v(" "),n("van-popup",{attrs:{position:"bottom"},model:{value:i.showStartTimePicker1,callback:function(t){i.showStartTimePicker1=t},expression:"showStartTimePicker1"}},[n("van-datetime-picker",{attrs:{"min-date":i.minDate,"max-date":i.maxDate,formatter:i.formatter,type:"date"},on:{confirm:function(t){return i.onConfirm(t,"startTime")},cancel:function(t){i.showStartTimePicker1=!1}}})],1),i._v(" "),n("van-popup",{attrs:{position:"bottom"},model:{value:i.showEndTimePicker1,callback:function(t){i.showEndTimePicker1=t},expression:"showEndTimePicker1"}},[n("van-datetime-picker",{attrs:{"min-date":i.minDate,"max-date":i.maxDate,formatter:i.formatter,type:"date"},on:{confirm:function(t){return i.onConfirm(t,"endTime")},cancel:function(t){i.showEndTimePicker1=!1}}})],1),i._v(" "),n("van-form",{on:{submit:function(t){return i.onSubmit("",1)}}},[n("van-cell-group",[n("van-field",{staticClass:"meeting-textarea files",attrs:{name:"meeting",label:"会议","left-icon":"i iconfont iconricheng"},scopedSlots:i._u([{key:"input",fn:function(){return[n("textarea",{directives:[{name:"model",rawName:"v-model",value:i.form.meeting,expression:"form.meeting"}],staticClass:"textr",staticStyle:{"text-align":"left",height:"72px !important"},attrs:{maxlength:"200",placeholder:"请输入会议标题"},domProps:{value:i.form.meeting},on:{input:function(t){t.target.composing||i.$set(i.form,"meeting",t.target.value)}}})]},proxy:!0}])})],1),i._v(" "),n("van-cell-group",[n("van-field",{attrs:{name:"isAllDay",label:"全天","left-icon":"i iconfont iconshijian"},scopedSlots:i._u([{key:"right-icon",fn:function(){return[n("van-switch",{attrs:{size:"16"},model:{value:i.form.isAllDay,callback:function(t){i.$set(i.form,"isAllDay",t)},expression:"form.isAllDay"}})]},proxy:!0}])}),i._v(" "),n("div",{staticClass:"time-Range"},[n("div",{staticClass:"time-Range-item time-Range-start",style:{opacity:i.form.startTime?1:.7},on:{click:i.chooseStartTime}},[n("div",{staticClass:"time-Range-day"},[i._v(i._s(i._f("dateFilter")(i.form.startTime)))]),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!i.form.isAllDay,expression:"!form.isAllDay"}],staticClass:"time-Range-time"},[i._v(i._s(i._f("timeFilter")(i.form.startTime,"开始时间")))])]),i._v(" "),n("div",{staticClass:"time-Range-item time-Range-end",style:{opacity:i.form.endTime?1:.7},on:{click:i.chooseEndTime}},[n("div",{staticClass:"time-Range-day"},[i._v(i._s(i._f("dateFilter")(i.form.endTime)))]),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!i.form.isAllDay,expression:"!form.isAllDay"}],staticClass:"time-Range-time"},[i._v(i._s(i._f("timeFilter")(i.form.endTime,"结束时间")))])])])],1),i._v(" "),n("van-cell-group",[n("van-field",{attrs:{name:"address","left-icon":"i iconfont icondingwei","right-icon":"i iconfont iconaddress-dark",placeholder:"请输入会议地点"},model:{value:i.form.address,callback:function(t){i.$set(i.form,"address",t)},expression:"form.address"}})],1),i._v(" "),n("van-cell-group",[n("van-field",{attrs:{name:"address",readonly:"","left-icon":"i iconfont iconhuiyi",placeholder:"选择会议主持","is-link":""},on:{click:function(t){return i.selectUser(0)}},model:{value:i.form.hyzc,callback:function(t){i.$set(i.form,"hyzc",t)},expression:"form.hyzc"}})],1),i._v(" "),n("van-cell-group",[n("van-field",{attrs:{name:"address",readonly:"","left-icon":"i iconfont iconyaoqingcanyuren",placeholder:"选择参会领导","is-link":""},on:{click:function(t){return i.selectUser(1)}},model:{value:i.form.chld,callback:function(t){i.$set(i.form,"chld",t)},expression:"form.chld"}})],1),i._v(" "),n("van-cell-group",[n("van-field",{attrs:{name:"address",readonly:"","left-icon":"i iconfont iconfasongren_danwei",placeholder:"选择参会单位","is-link":""},on:{click:function(t){return i.selectUser(2)}},model:{value:i.form.chdw,callback:function(t){i.$set(i.form,"chdw",t)},expression:"form.chdw"}})],1),i._v(" "),n("van-cell-group",[n("van-field",{attrs:{name:"address",readonly:"","left-icon":"i iconfont iconyidao",placeholder:"选择参会人员","is-link":""},on:{click:function(t){return i.selectUser(3)}},model:{value:i.form.chry,callback:function(t){i.$set(i.form,"chry",t)},expression:"form.chry"}})],1),i._v(" "),n("van-cell-group",[n("van-cell",{staticClass:"timetips",attrs:{title:i.form.timetips,icon:"i iconfont icontixing","is-link":""},on:{click:i.tipsSetting}})],1),i._v(" "),n("van-field",{staticStyle:{"margin-top":"15px"},attrs:{"input-align":"right",name:"uploader"},scopedSlots:i._u([{key:"label",fn:function(){return[n("span",[n("label",{staticClass:"mast-input"},[i._v("*")]),i._v("附件：\n        ")])]},proxy:!0},{key:"input",fn:function(){return[n("div")]},proxy:!0},{key:"right-icon",fn:function(){return[n("van-uploader",{staticClass:"upload-btn",attrs:{"after-read":i.afterRead,accept:""}},[n("van-icon",{staticClass:"iconfont iconjiahao",attrs:{color:"#1989fa"}})],1)]},proxy:!0}])}),i._v(" "),n("div",{staticClass:"upload-files"},i._l(i.attach_1,function(e,t){return n("div",{key:t,staticClass:"file-list"},[n("i",{staticClass:"iconfont iconfile"}),i._v(" "),n("span",[i._v(i._s(e.title))]),i._v(" "),n("van-icon",{attrs:{color:"#999999",name:"clear"},on:{click:function(t){return i.removeFile(e)}}})],1)}),0),i._v(" "),n("div",{staticClass:"footer"},[n("van-button",{attrs:{type:"info","native-type":"submit()"}},[i._v("提交审核")])],1)],1),i._v(" "),n("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,position:"bottom"},model:{value:i.showPerson,callback:function(t){i.showPerson=t},expression:"showPerson"}},[i.showPerson?n("selectPerson",{attrs:{extra:{tabs:[{key:"self_org"}]},type:i.meeting_type},on:{getSelectUser:i.getSelectUser,cancePerson:i.cancePerson}}):i._e()],1),i._v(" "),n("van-popup",{style:{height:"80%"},attrs:{position:"bottom"},model:{value:i.show,callback:function(t){i.show=t},expression:"show"}},[n("tips-setting",{on:{getData:i.getData}})],1),i._v(" "),n("van-popup",{style:{height:"80%"},attrs:{position:"bottom"},model:{value:i.roomshow,callback:function(t){i.roomshow=t},expression:"roomshow"}},i._l(i.meetingData,function(e){return n("van-cell",{key:e.id,attrs:{value:e.name},on:{click:function(t){return i.sureRoom(e)}}})}),1),i._v(" "),n("van-popup",{style:{height:"90%"},attrs:{"get-container":i.getContainer,"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom"},model:{value:i.showPopup,callback:function(t){i.showPopup=t},expression:"showPopup"}},[i.showFlowSend?n("send-workflow",{ref:"sendFile",attrs:{"form-data":i.dataValue},on:{close:function(t){i.showFlowSend=!1,i.showPopup=!1},golist:i.onRefresh}}):i._e()],1)],1)},[],!1,null,null,null).exports},92137:function(t,e,i){i.r(e),i.d(e,{default:function(){return o}});var n=i(25108),e={name:"TipsSetting",data:function(){return{tipsdata:[{id:"1",name:"开始时",ischecked:!1},{id:"2",name:"5分钟前",ischecked:!1},{id:"3",name:"15分钟前",ischecked:!0},{id:"4",name:"30分钟前",ischecked:!1},{id:"5",name:"1小时前",ischecked:!1},{id:"6",name:"1天前",ischecked:!1}],tipstype:["应用内","短信","电话"],curr:0,sectype:"",isnonetips:!1,lastData:""}},methods:{back:function(){this.$router.back()},secMultiple:function(t){this.isnonetips=!1,this.tipsdata[t].ischecked=!this.tipsdata[t].ischecked},changeTab:function(t){this.curr=t},noneTips:function(){this.isnonetips=!this.isnonetips,this.tipsdata.forEach(function(t){t.ischecked=!1})},sure:function(){var i=this;this.lastData="",this.isnonetips?this.lastData="无提醒":(this.tipsdata.forEach(function(t,e){t.ischecked&&(""==i.lastData?i.lastData=i.tipsdata[e].name:i.lastData+=","+i.tipsdata[e].name)}),""==this.lastData?this.lastData=this.tipstype[this.curr]+"提醒":this.lastData+=","+this.tipstype[this.curr]+"提醒"),n.log(this.lastData),this.$emit("getData",this.lastData)}}},o=(0,i(51900).Z)(e,function(){var i=this,n=i._self._c;return n("div",{staticClass:"ds-tips"},[n("div",{staticClass:"setting"},[n("van-cell",{staticClass:"none-tips",attrs:{value:"无提醒"},on:{click:i.noneTips},scopedSlots:i._u([i.isnonetips?{key:"right-icon",fn:function(){return[n("van-icon",{staticStyle:{"line-height":"inherit"},attrs:{name:"success",color:"#5094F3"}})]},proxy:!0}:null],null,!0)}),i._v(" "),n("van-cell-group",{staticClass:"none-tips"},i._l(i.tipsdata,function(t,e){return n("van-cell",{key:t.id,staticClass:"cell-choose",class:t.ischecked?"active":"",attrs:{value:t.name},on:{click:function(t){return i.secMultiple(e)}},scopedSlots:i._u([t.ischecked?{key:"right-icon",fn:function(){return[n("van-icon",{staticStyle:{"line-height":"inherit"},attrs:{name:"success",color:"#5094F3"}})]},proxy:!0}:null],null,!0)})}),1),i._v(" "),n("van-cell",{staticClass:"none-tips",attrs:{title:"提醒方式"},scopedSlots:i._u([{key:"default",fn:function(){return[n("div",{staticClass:"tabs-card"},i._l(i.tipstype,function(t,e){return n("div",{class:i.curr==e?"active":"",on:{click:function(t){return i.changeTab(e)}}},[n("span",[i._v(i._s(t))])])}),0)]},proxy:!0}])}),i._v(" "),n("div",{staticClass:"bf"},[n("van-button",{attrs:{type:"primary"},on:{click:i.sure}},[i._v("确定")])],1)],1)])},[],!1,null,null,null).exports},18868:function(t,e,i){var a=i(25108);const s=(n,o=500,a=!0)=>{let s,r=0,c,l,d=i=>{s=setTimeout(()=>{var t=(new Date).getTime(),e=t-r;e<i?(r=t,d(o-e)):(a||n.apply(c,l),clearTimeout(s),s=null)},i)};return function(){c=this,l=arguments;var t=(new Date).getTime();r=t,s||(a&&n.apply(c,l),d(o))}};e.Z={name:"DebounceClick",functional:!0,render(t,e){var i,n=e.props.time,o=e.props.immediate,e=e.slots().default;return void 0===e?(a.warn("<debounce> 组件必须要有子元素"),null):((e=e[0]||null).data.on&&e.data.on.click?(i=e.data.on.click,i=s(i,n,o),e.data.on.click=i):e.componentOptions&&e.componentOptions.listeners.click&&(i=e.componentOptions.listeners.click,i=s(i,n,o),e.componentOptions.listeners.click=i),e)}}}}]);