"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[8636],{8636:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});var o=a(66250),t=a(33453),r=a.n(t),c=a(25108),t={name:"",components:{draggable:function(){return a.e(9980).then(a.t.bind(a,82021,23))}},props:{selectedList:{type:Array,default:[]},unDragList:{type:Array,default:[]},sendMode:{type:Number},selectedSendRange:{type:Object,default:function(){}},flowRangeUrl:{type:Object,default:function(){}}},data:function(){return{}},created:function(){},mounted:function(){},methods:{define:function(){this.$emit("close",!0)},del:function(e,t){c.log(e,t),this.$delete(e,"Selected"),this.$set(e,"Selected",!1),this.selectArr_.splice(t,1),this.$emit("changeData",this.selectArr_)},confirmPerson:function(){var e,s=this,t=this,n=this.unDragList.concat(this.selectArr_),a=0<n.length?n[0].sendMode:0,d=[];n.some(function(e){return e.sendMode!=a})?dsf.layer.toast("只能选择一种流转方式！"):(this.$toast.loading({message:"保存中...",duration:0,overlay:!0}),e=this.selectedSendRange.processSettings?"fn/flow/saveProcessNodeSendRange?":"fn/p2433Flow/afterMobileSelectSendRange?pnId=".concat(this.selectedSendRange.pnId,"&"),e="".concat(e,"infoId=").concat(this.selectedSendRange.infoId,"&flowId=").concat(this.selectedSendRange.flowId,"&sendMode=").concat(a,"&nodeId=").concat(this.selectedSendRange.nodeId,"&targetNodeId=").concat(this.selectedSendRange.targetNodeId,"&processSn=").concat(this.selectedSendRange.processSn,"&moduleId=").concat(this.selectedSendRange.moduleId),n.forEach(function(e,t){e={infoId:s.selectedSendRange.infoId,flowId:s.selectedSendRange.flowId,sendMode:e.sendMode,nodeId:s.selectedSendRange.nodeId,targetNodeId:s.selectedSendRange.targetNodeId,processSn:s.selectedSendRange.processSn,uType:"1",objId:e.objId||e.UserID,objName:e.objName||e.name,objDeptId:e.objDeptId||e.DeptID,objDeptName:e.objDeptName||e.DeptName,processStatus:e.processStatus&&0<e.processStatus?e.processStatus:0,showOrder:t+1};d.push(e)}),n=d.filter(function(e){return 2!=e.processStatus}),dsf.http.post(e,n,{headers:{"Content-Type":"application/json"}}).then(function(e){t.$toast.clear(),200==e.data.code?dsf.layer.toast("保存成功！","success",function(){t.$emit("close"),t.changeForm(d)}):t.$toast.fail(e.data.message)}).catch(function(){s.$toast.clear()}))},changeForm:function(a){var d=this;return(0,o.Z)(r().mark(function e(){var s,t,n;return r().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=d,t=a.map(function(e){return e.objId}),n=d.flowRangeUrl.generateFlowRangeUrl||"ctrl/signReport/generateFlowRange",0<t.length)return e.next=6,dsf.http.post(n,{userIds:t.join(",")}).then(function(){var t=(0,o.Z)(r().mark(function e(t){return r().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t&&t.data&&"200"==t.data.code&&s.updateFlowRange(t.data.data);case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());e.next=8;break;case 6:e.next=9;break;case 8:"230504192223hNSFfFucFKid9ZUWQ37"==d.selectedSendRange.moduleId||"230909172023JgZnhtVNSAyz90RaqGC"==d.selectedSendRange.moduleId?d.updateFlowRange("　"):d.updateFlowRange("");case 9:if("230504192223hNSFfFucFKid9ZUWQ37"!=d.selectedSendRange.moduleId&&"230909172023JgZnhtVNSAyz90RaqGC"!=d.selectedSendRange.moduleId||"-7"==d.selectedSendRange.nodeId||"-1"==d.selectedSendRange.nodeId){e.next=12;break}return e.next=12,dsf.http.post("ctrl/signReport/refreshFileContentByBookmark",{moduleId:d.selectedSendRange.moduleId,infoId:d.selectedSendRange.infoId}).then(function(e){c.log(e),e&&e.data&&200==e.data.code&&s.$emit("changeLeaderSitu")});case 12:case"end":return e.stop()}},e)}))()},updateFlowRange:function(n){var a=this;return(0,o.Z)(r().mark(function e(){var t,s;return r().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.flowRangeUrl.updateFlowRangeUrl||"ctrl/signReport/updateFlowRange",s=a.flowRangeUrl.initControl,e.next=4,dsf.http.post(t,{flowRange:n,infoId:a.selectedSendRange.infoId}).then(function(e){c.log(e),e&&e.data&&200==e.data.code&&"230504192223hNSFfFucFKid9ZUWQ37"!=a.selectedSendRange.moduleId&&"230909172023JgZnhtVNSAyz90RaqGC"!=a.selectedSendRange.moduleId&&a.$emit("changeLeaderSitu",{initControl:s,data:n})});case 4:case"end":return e.stop()}},e)}))()}},computed:{selectArr_:{get:function(){return this.selectedList},set:function(e){c.log(e),this.$emit("changeData",e)}}},watch:{}},s=a(51900),t=(0,s.Z)(t,function(){var s=this,n=s._self._c;return n("div",{staticClass:"checkusers"},[n("van-nav-bar",{attrs:{title:"选中范围",placeholder:""},on:{"click-left":s.define},scopedSlots:s._u([{key:"left",fn:function(){return[n("van-icon",{attrs:{name:"arrow-left"}})]},proxy:!0}])}),s._v(" "),n("div",{staticClass:"content"},[s._m(0),s._v(" "),n("div",{staticClass:"list-group"},[s._l(s.unDragList,function(e,t){return n("div",{key:t,staticClass:"list-group-item"},[n("p",[s._v("\n                    "+s._s(t+1)+"\n                    "),e.processStatus&&2==e.processStatus?n("img",{attrs:{src:a(14879),alt:""}}):e.processStatus&&1==e.processStatus?n("img",{attrs:{src:a(44467),alt:""}}):n("img",{attrs:{src:a(86896),alt:""}})]),s._v(" "),n("p",[s._v(s._s(e.name||e.UserName||e.objName))]),s._v(" "),n("p",[s._v(s._s(e.sendMode?"横传":"直传"))]),s._v(" "),n("p")])}),s._v(" "),n("draggable",{attrs:{group:"people","ghost-class":"ghost",chosenClass:"chosen",animation:"200"},model:{value:s.selectArr_,callback:function(e){s.selectArr_=e},expression:"selectArr_"}},s._l(s.selectArr_,function(e,t){return n("div",{key:t,staticClass:"list-group-item"},[n("p",[s._v(s._s(s.unDragList.length+t+1)+"\n                        "),e.processStatus&&2==e.processStatus?n("img",{attrs:{src:a(14879),alt:""}}):e.processStatus&&1==e.processStatus?n("img",{attrs:{src:a(44467),alt:""}}):n("img",{attrs:{src:a(86896),alt:""}})]),s._v(" "),n("p",[s._v(s._s(e.name||e.UserName||e.objName))]),s._v(" "),n("p",[s._v(s._s(e.sendMode?"横传":"直传"))]),s._v(" "),n("p",[n("van-icon",{staticClass:"sort",attrs:{name:"sort",size:"0.36rem"}})],1)])}),0)],2),s._v(" "),n("div",{staticClass:"confirm"},[n("van-button",{attrs:{type:"default",size:"middle"},on:{click:s.define}},[s._v("选择人员")]),s._v(" "),n("van-button",{attrs:{type:"info",size:"middle"},on:{click:s.confirmPerson}},[s._v("确 定")])],1)])],1)},[function(){var e=this,t=e._self._c;return t("ul",[t("li",[e._v("序号")]),e._v(" "),t("li",[e._v("审核领导")]),e._v(" "),t("li",[e._v("流转方式")]),e._v(" "),t("li",[e._v("操作")])])}],!1,null,"d111be4e",null).exports,t=(a(53411),{name:"addLeadeReview",components:{leaderChecked:t},props:{formData:{type:Object,default:function(){return{}}},formMeta:{type:Object,default:function(){return{}}},formParams:{type:Object,default:function(){return{}}},leaderOrder:{type:String,default:""},processSettings:{type:Object,default:function(){return null}},flowRangeUrl:{type:Object,default:function(){return null}}},data:function(){return{showAppTopMenu:dsf.config.appTopMenu.value,showBack:!0,default_img:'this.src="'+a(5692)+'"',selectArr:[],showLeader:!1,leaderList:[],selectedList:[],sendMode:-1,alreadySelecded:[],alreadySelectIds:[],newSelectedList:[],unDragList:[],canDragList:[],selectedSendRange:{},user:dsf.util.loadSessionStore("user"),processSn:""}},created:function(){},mounted:function(){this.getLeaderList()},methods:{back:function(){this.$emit("close",!1)},getFavicon:function(e){return e.Photo?dsf.url.getWebPath("/fn/mobilePhoto/download?id=".concat(e.id,"&time=").concat((new Date).getTime())):a(5692)},checkDisabled:function(e){var t=0==e.sendMode&&1<e.processStatus,s=0==e.sendMode&&1==e.processStatus&&(e.objId==this.user.user_id||e.UserID==this.user.user_id),e=1==e.sendMode&&1<=e.processStatus;return t||s||e},userClick:function(t,e){t.Selected?this.selectedList.push(t):this.selectedList=this.selectedList.filter(function(e){return e.UserID!=t.UserID});var s=this.alreadySelectIds.indexOf(t.UserID);!t.Selected&&-1<s&&(this.alreadySelecded.splice(s,1),this.alreadySelectIds.splice(s,1),this.leaderList[e].processStatus=0)},showCheckUsers:function(t){this.showLeader=!0;var s=this.selectedList.map(function(e){if(e.Selected)return e.id}),e=(this.unDragList=this.alreadySelecded.filter(function(e,t){if(0==e.sendMode&&1<e.processStatus||1==e.sendMode&&1<=e.processStatus)return e}),this.selectedList.filter(function(e,t){return 0==e.processStatus})),n=(e.forEach(function(e){e.sendMode=t}),this.alreadySelecded.filter(function(e,t){if(0==e.sendMode&&1==e.processStatus&&s.includes(e.objId))return e}));"2"==this.leaderOrder?this.newSelectedList=n.concat(e.sort(function(e,t){return t.orderIndex-e.orderIndex})):"1"==this.leaderOrder?this.newSelectedList=n.concat(e.sort(function(e,t){return e.orderIndex-t.orderIndex})):this.newSelectedList=n.concat(e)},close:function(e){this.showLeader=!1,e||this.back()},changeLeaderData:function(e){this.newSelectedList=e},getLeaderList:function(){var e=this,t=this,s=(this.$toast.loading({message:"加载中...",duration:0,overlay:!0}),this.processSettings?"fn/flow/getNextSendRange":"fn/flow/getMobileSendRange"),n=this.processSettings?{infoId:this.formMeta.parameters.pk||"",flowId:this.processSettings.flowId||"",nodeId:this.processSettings.nodeId||"",targetNodeId:this.processSettings.targetNodeId||""}:{infoId:this.formMeta.parameters.pk||"",pnId:this.formMeta.parameters.pnId||"",order:this.leaderOrder||"1"};dsf.http.get(s,n).then(function(e){e&&e.data&&"200"==e.data.code&&e.data.data.SendRangeTree&&e.data.data.SendRangeTree.Node&&(t.leaderList=e.data.data.SendRangeTree.Node.map(function(e,t){return e.Selected=!1,e.orderIndex=t,e.processStatus=0,e}),t.processSettings?t.getProcessSn():t.getSelectedLeader())}).catch(function(){e.$toast.clear()})},getProcessSn:function(){var e=this,t=this,s={infoId:this.formMeta.parameters.pk||"",flowId:this.processSettings.flowId||"",nodeId:this.processSettings.nodeId||"",targetNodeId:this.processSettings.targetNodeId||"",isLoad:this.processSettings.isLoad||""};dsf.http.get("fn/flow/getProcessSn",s).then(function(e){e&&e.data&&e.data.data&&(t.processSn=e.data.data,t.getSelectedLeaderSettings())}).catch(function(){e.$toast.clear()})},getSelectedLeader:function(){var e=this,n=this,t={pnId:this.formMeta.parameters.pnId||""};dsf.http.get("fn/flow/getMobileSelectedSendRange",t).then(function(e){e&&e.data&&"200"==e.data.code&&(n.selectedSendRange=e.data.data,n.selectedSendRange.pnId=n.formMeta.parameters.pnId||"",n.selectedSendRange.moduleId=n.formMeta.parameters.moduleId||"",n.sendMode=n.selectedSendRange.sendMode,n.selectedSendRange.processList)&&0<n.selectedSendRange.processList.length&&(n.alreadySelectIds=n.selectedSendRange.processList.map(function(e){return e.objId}),n.alreadySelecded=n.selectedSendRange.processList,n.leaderList.forEach(function(t,s){t.processStatus=0,n.alreadySelecded.forEach(function(e){e.objId==t.id&&(t.Selected=!0,t.sendMode=e.sendMode,t.processStatus=e.processStatus,n.selectedList.push(t),n.selectArr.push(s))})}),n.$toast.clear())}).catch(function(){e.$toast.clear()})},getSelectedLeaderSettings:function(){var e=this,n=this,t={processSn:this.processSn};dsf.http.get("fn/flow/getProcessNodeSendRange",t).then(function(e){e&&e.data&&"200"==e.data.code&&(n.selectedSendRange={processList:e.data.data,moduleId:n.formMeta.parameters.moduleId||"",infoId:n.formMeta.parameters.pk,flowId:n.processSettings.flowId,nodeId:n.processSettings.nodeId,targetNodeId:n.processSettings.targetNodeId,processSn:n.processSn,processSettings:1},n.selectedSendRange.processList&&0<n.selectedSendRange.processList.length&&(n.alreadySelectIds=n.selectedSendRange.processList.map(function(e){return e.objId}),n.alreadySelecded=n.selectedSendRange.processList,n.leaderList.forEach(function(t,s){t.processStatus=0,n.alreadySelecded.forEach(function(e){e.objId==t.id&&(t.Selected=!0,t.sendMode=e.sendMode,t.processStatus=e.processStatus,n.selectedList.push(t),n.selectArr.push(s))})})),n.$toast.clear())}).catch(function(){e.$toast.clear()})},changeLeaderSitu:function(e){this.$emit("changeLeaderSitu",e)}},computed:{},watch:{}}),n=(0,s.Z)(t,function(){var n=this,e=n._self._c;return e("div",{staticClass:"addleaderreview"},[n.showAppTopMenu?e("van-nav-bar",{attrs:{title:"领导选择"},on:{"click-left":n.back},scopedSlots:n._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"arrow-left"}}),e("span",[n._v("返回")])]},proxy:!0}],null,!1,2489604797)}):n._e(),n._v(" "),e("div",{staticClass:"leader-list",style:{height:"calc(100vh - ".concat(n.dsf.util.getOffsetTop("0.92rem")," - 1.2rem)")}},[e("van-sticky",{attrs:{"offset-top":n.dsf.util.getOffsetTop()}},[e("div",{staticClass:"leader-title"},[e("p",[n._v("领导列表\n                    "),e("span",{directives:[{name:"show",rawName:"v-show",value:n.processSettings&&1==n.processSettings.sendMode,expression:"processSettings && processSettings.sendMode == 1"}]},[n._v("（横传：依次流转；直传：同时流转）")]),n._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:n.processSettings&&2==n.processSettings.sendMode||1==n.sendMode,expression:"processSettings && processSettings.sendMode == 2 || sendMode == 1"}]},[n._v("（横传：依次流转）")]),n._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:n.processSettings&&3==n.processSettings.sendMode||0==n.sendMode,expression:"processSettings && processSettings.sendMode == 3 || sendMode == 0"}]},[n._v("（直传：同时流转）")])])])]),n._v(" "),n._l(n.leaderList,function(t,s){return e("div",{key:s},[e("div",{staticClass:"person",style:{"padding-left":"30px"}},[e("div",{staticClass:"flex-box person_child"},[e("van-checkbox",{staticClass:"child_check",staticStyle:{flex:"1"},attrs:{"icon-size":"0.32rem",shape:"square",disabled:n.checkDisabled(t)},on:{click:function(e){return n.userClick(t,s)}},model:{value:t.Selected,callback:function(e){n.$set(t,"Selected",e)},expression:"cell.Selected"}},[e("div",{staticClass:"user-logo"},[e("i",{staticClass:"icon iconfont iconyonghu"})]),n._v(" "),e("div",{staticClass:"user-name"},[n._v(n._s(t.UserName||t.name))])])],1)])])})],2),n._v(" "),e("van-tabbar",{attrs:{placeholder:""}},[e("van-tabbar-item",{staticClass:"_btns"},[e("div",{staticClass:"tree_l"},[e("span",[n._v("已选择："+n._s(n.selectedList?n.selectedList.length:0)+"人")])]),n._v(" "),e("div",{staticClass:"tree_r"},[e("van-button",{directives:[{name:"show",rawName:"v-show",value:n.processSettings&&3!=n.processSettings.sendMode||1==n.sendMode,expression:"processSettings && processSettings.sendMode != 3 || sendMode == 1"}],staticClass:"tree_r_btn",attrs:{type:"info",size:"middle"},on:{click:function(e){return n.showCheckUsers(1)}}},[n._v("横传")]),n._v(" "),e("van-button",{directives:[{name:"show",rawName:"v-show",value:n.processSettings&&2!=n.processSettings.sendMode||0==n.sendMode,expression:"processSettings && processSettings.sendMode != 2 || sendMode == 0"}],staticClass:"tree_r_btn",attrs:{type:"info",size:"middle"},on:{click:function(e){return n.showCheckUsers(0)}}},[n._v("直传")])],1)])],1),n._v(" "),e("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:n.showLeader,callback:function(e){n.showLeader=e},expression:"showLeader"}},[e("leader-checked",{attrs:{"selected-list":n.newSelectedList,"un-drag-list":n.unDragList,"send-mode":n.sendMode,"selected-send-range":n.selectedSendRange,"flow-range-url":n.flowRangeUrl},on:{close:n.close,changeData:n.changeLeaderData,changeLeaderSitu:n.changeLeaderSitu}})],1)],1)},[],!1,null,"3c0f9a42",null).exports},44467:function(e,t,s){e.exports=s.p+"static/img/icon-liuzhuanzh.097f2f6..png"},86896:function(e,t,s){e.exports=s.p+"static/img/icon-weiliuzhuan.fa9e469..png"},14879:function(e,t,s){e.exports=s.p+"static/img/icon-yiliuzhuan.2bf1de5..png"}}]);