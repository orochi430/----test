"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[85741],{20936:function(t,e,i){i.d(e,{Z:function(){return a}});var n=i(25108),e={name:"FormFrame",components:{},props:{title:{type:String}},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){n.log(this.title)},destroyed:function(){},methods:{onClickLeft:function(){this.$router.go(-1)}}},a=(0,i(51900).Z)(e,function(){var t=this,e=t._self._c;return e("div",{staticClass:"form-frame"},[e("div",{staticClass:"form-contain"},[t._t("default")],2),t._v(" "),e("div",{staticClass:"form-footer"},[t._t("button")],2)])},[],!1,null,null,null).exports},85741:function(t,e,i){i.r(e),i.d(e,{default:function(){return o}});var e=i(26243),l=i.n(e),e=i(8450),c=i.n(e),e=i(20936),n=i(50856),a=i(63560),f=i(25108),e={name:"OpinionReceipt",components:{FormFrame:e.Z,DsButtonToolbox:n.Z,selectPerson:a.default},data:function(){return{showCalendar:!1,text:"",value:"",radio:"",showPicker:!1,checkboxGroup:[],stepper:1,info_id:"",moduleId:"2003171029240Q1Eg5iPoVkCkgCTlFW",formId:"200317113020yCL9RkixwdnpsJLj3Vc",maininfo:{},feedbackId:"",feedbackModuleId:"",rcvRecordId:"",title:"",opinion:"",qftime:"",isSave:"",buttons:{commonButton:[],mainButtons:[{action:"send",name:"保存"}]},attach_0:[],attach_1:[],doing:!1}},computed:{},watch:{},created:function(){},mounted:function(){var t=this.$route.query.feedbackId,e=this.$route.query.feedbackModuleId,i=this.$route.query.rcvRecordId;f.log("feedbackId"+t),f.log("feedbackModuleId"+e),f.log("rcvRecordId"+i),this.feedbackId=t,this.feedbackModuleId=e,this.rcvRecordId=i,this.initFormData()},destroyed:function(){},methods:{onClickLeft:function(){this.$router.go(-1)},onSubmit:function(){},onConfirm:function(t){this.qftime="".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate()),this.showCalendar=!1},initFormData:function(){var t="/fn/xform/data?moduleId="+this.feedbackModuleId+"&pk="+this.feedbackId,e=this;dsf.http.get(t,{}).then(function(t){t&&t.data&&t.data.main&&(e.maininfo=t.data.main),f.log(e.maininfo)})},handleLeftClick:function(t){f.log(t),"send"==t&&this.doSend()},doSend:function(e,i){var n=this;if(!this.doing)if(this.doing=!0,this.maininfo.B0009={},this.maininfo.B0021={},this.maininfo["C-R-FEEDBACK-0001"]={},this.title)if(this.qftime)if(this.opinion){this.maininfo.B0009.value=this.title,this.maininfo.B0021.value=this.qftime,this.maininfo["C-R-FEEDBACK-0001"].value=this.opinion;var a={};l()(this.maininfo).forEach(function(t,e){a[t]={values:[{key:"value",value:n.maininfo[t].value}]},n.maininfo[t].hasOwnProperty("text")&&a[t].values.push({key:"text",value:n.maininfo[t].text})});for(var t=1;t<=39;t++){var o="A00"+(t<10?"0"+t:t);a[o]||(a[o]={},a[o].values=[{key:"value",value:""}])}var s={moduleId:this.feedbackModuleId,pk:this.feedbackId,formId:this.formId,__DATA:c()({maininfo:a})},d=(f.log(c()(a)),this);dsf.http.post("/fn/xform/save",s).then(function(t){d.doing=!1,f.log(t),"success"==t.data.type?(d.$toast.success("保存成功"),d.isSave="success",f.log(d.isSave),1==i&&d.doSubmit(d.isSave,i)):d.$toast.fail("保存失败"),e&&e(t)}),"success"==this.isSave&&f.log("调用发送反馈")}else this.$toast.fail("请输入意见"),this.doing=!1;else this.$toast.fail("请选择日期"),this.doing=!1;else this.$toast.fail("请输入签发人"),this.doing=!1},doSubmit:function(t,e){f.log("222222222222");var i=this;"success"==t&&(f.log("调用发送反馈"),t={rcvRecordId:this.rcvRecordId,feedbackId:this.feedbackId,feedbackModuleId:this.feedbackModuleId},dsf.http.post("fn/remoteExchange/feedback",t).then(function(t){f.log(t),"success"==t.data.type?(i.$toast.success("发送成功"),1==e&&i.$router.go("-1")):i.$toast.fail("发送失败")}))},doFileRead:function(t,e){var i=this,e="/fn/mobileAttachment/upload?fileId=&moduleId="+this.feedbackModuleId+"&mid="+this.feedbackModuleId+"&pId=0&pnId=0&nodeName="+encodeURI("拟稿")+"&nrType="+e+"&pk="+this.feedbackId+"&newFileFlag=0";dsf.http.upload(e,{},t).then(function(t){f.log(t),i.getWebFiles()})},afterRead:function(e){var i=this;this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),this.doSend(function(t){i.doFileRead(e,1)})},getWebFiles:function(){var t={info_id:this.feedbackId,infoId:this.feedbackId,moduleId:this.feedbackModuleId,nodeId:"",start:0,limit:100},i=this;dsf.http.post("/fn/mobileAttachment/getFormAttachment",t).then(function(t){f.log(t.data),t&&t.data&&t.data.rows&&t.data.rows.forEach(function(t,e){i.attach_1=t.document,f.log(i.attach_1)}),i.$toast.clear()})},removeFile:function(t){f.log(t);var t={pk:t.infoId,fileId:t.id,moduleId:t.moduleId,mid:t.moduleId,nrType:t.type,fileName:t.title},e=this;dsf.http.post("/fn/mobileFileUpload/delete",t).then(function(t){e.getWebFiles()})}}},o=(0,i(51900).Z)(e,function(){var i=this,n=i._self._c;return n("div",{staticClass:"receipt"},[n("form-frame",{attrs:{title:"意见回执"}},[n("template",{slot:"default"},[n("van-form",{on:{submit:i.onSubmit}},[n("van-field",{attrs:{"input-align":"right",placeholder:"请输入签发人"},scopedSlots:i._u([{key:"label",fn:function(){return[n("span",[n("label",{staticClass:"mast-input"},[i._v("* ")]),i._v("签发人：")])]},proxy:!0}]),model:{value:i.title,callback:function(t){i.title=t},expression:"title"}}),i._v(" "),n("van-field",{attrs:{"input-align":"right",value:i.qftime,readonly:"",clickable:"",name:"calendar",placeholder:"请选择日期"},on:{click:function(t){i.showCalendar=!0}},scopedSlots:i._u([{key:"label",fn:function(){return[n("span",[n("label",{staticClass:"mast-input"},[i._v("* ")]),i._v("签发时间：")])]},proxy:!0}])}),i._v(" "),n("van-calendar",{attrs:{"first-day-of-week":"1"},on:{confirm:i.onConfirm},model:{value:i.showCalendar,callback:function(t){i.showCalendar=t},expression:"showCalendar"}}),i._v(" "),n("van-field",{attrs:{"input-align":"right",type:"textarea",rows:"5",placeholder:"请输入意见"},scopedSlots:i._u([{key:"label",fn:function(){return[n("span",[n("label",{staticClass:"mast-input"},[i._v("* ")]),i._v("意见")])]},proxy:!0}]),model:{value:i.opinion,callback:function(t){i.opinion=t},expression:"opinion"}}),i._v(" "),n("van-field",{attrs:{name:"uploader"},scopedSlots:i._u([{key:"label",fn:function(){return[n("span",[n("label",{staticClass:"mast-input"}),i._v("附件：")])]},proxy:!0},{key:"input",fn:function(){return[n("div",{staticClass:"dofile",staticStyle:{width:"100%"}},[n("div",{staticClass:"upload-files"},i._l(i.attach_1,function(e,t){return n("div",{key:t,staticClass:"file-list"},[n("i",{staticClass:"iconfont iconfile"}),i._v(" "),n("span",[i._v(i._s(e.title))]),i._v(" "),n("van-icon",{attrs:{name:"clear"},on:{click:function(t){return i.removeFile(e)}}})],1)}),0),i._v(" "),n("van-uploader",{staticClass:"upload-btn",attrs:{"after-read":i.afterRead,accept:".jpg, .gif, .png, .jpeg, .txt, .pdf, .doc, .docx, .xls, .xlsx"}},[n("span",{staticClass:"add-file"},[n("van-icon",{attrs:{name:"plus"}})],1)])],1)]},proxy:!0}])})],1)],1),i._v(" "),n("template",{slot:"button"},[n("div",{staticClass:"sendbtn",on:{click:function(t){return i.doSend("",1)}}},[i._v("提交")])])],2)],1)},[],!1,null,null,null).exports}}]);