"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[89590,31204],{21864:function(e,t,i){i.d(t,{Z:function(){return a}});var t={props:{fabItems:{type:Array,default:function(){return[]}},titleKey:{type:String,default:"title"}},data:function(){return{showFab:!1}},directives:{clickOutside:{bind:function(t,i,e){function a(e,t){return!e.el.contains(t.target)&&!t.target.dataset.outside&&(e.binding&&e.binding.value&&"function"==typeof e.binding.value?e.binding.value():void 0)}t.__clickOutside__=a,document.addEventListener("click",function(e){return a({el:t,binding:i},e)}),document.addEventListener("touchend",function(e){return a({el:t,binding:i},e)})},unbind:function(e){document.removeEventListener("click",e.__clickOutside__)}}},methods:{clickOutside:function(){this.showFab=!1},clickMain:function(){1==this.fabItems.length?this.clickItem(this.fabItems[0]):this.showFab=!this.showFab},clickItem:function(e){"go"==e.type?e.url?this.$router.push({path:e.url}):dsf.layer.toast("未传入跳转地址"):this.$emit("clickItem",e)}}},a=(0,i(51900).Z)(t,function(){var i=this,a=i._self._c;return a("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:i.clickOutside,expression:"clickOutside"}],staticClass:"fab-container"},[0<i.fabItems.length?a("div",{staticClass:"main-btn",on:{click:i.clickMain}},[1<i.fabItems.length?a("transition",{attrs:{name:"change",mode:"out-in"}},[i.showFab?a("div",{key:"open"},[a("van-icon",{attrs:{name:"cross"}})],1):a("div",{key:"close"},[a("van-icon",{attrs:{name:"ellipsis"}})],1)]):a("i",{staticClass:"iconfont",class:i.fabItems[0].icon||"iconjiahao",staticStyle:{"font-size":"var(--font_size_0)","font-weight":"bold"}})],1):i._e(),i._v(" "),1<i.fabItems.length?a("transition",{attrs:{name:"fade"}},[i.showFab?a("div",{staticClass:"fab-btns",on:{click:function(e){i.showFab=!i.showFab}}},i._l(i.fabItems,function(t,e){return a("div",{key:e,staticClass:"dsf-fab-item",on:{click:function(e){return i.clickItem(t)}}},[t.icon?a("i",{staticClass:"iconfont",class:t.icon}):i._e(),i._v(" "),a("span",[i._v(i._s(t[i.titleKey]))])])}),0):i._e()]):i._e()],1)},[],!1,null,"75ba6501",null).exports},45411:function(e,t,i){i.r(t),i.d(t,{default:function(){return d}});var t=i(77193),a=(i(41762),i(41956)),n=i(82060),o=i(25108),a={components:((0,t.Z)(s={},a.Z.name,a.Z),(0,t.Z)(s,"VPlayer",function(){return i.e(46316).then(i.bind(i,46316))}),(0,t.Z)(s,"EnclosurePreview",n.default),s),props:{file:{type:Object,default:function(){}},isShowCount:{type:Boolean,default:!0},queryType:{type:String,default:""}},watch:{file:{handler:function(e,t){this.file.fullName=this.getName(e,e.type)},deep:!0,immediate:!0}},data:function(){return{showData:!0,reExt:"",reName:"",showRename:!1,video:{showVideo:!1,videoTitle:""},fileType:{pdf:["pdf"],img:["jpeg","bmp","webp","svgz","svg","gif","jpg","ico","png","tif"],txt:["txt","sql","xml","html","css","js","java","php","bat","log"],word:["docx","docm","doc","dotx","dotm","dot"],xls:["xlsx","xlsm","xlsb","xls","xltx","xltm","xlt","xlam","xla","ods"],wps:["wps"],ppt:["pptx","pptm","ppt","potx","potm","pot","ppsx","ppsm","pps","ppam","ppa"],video:["mp4"]},hasFilePng:["ai","cloud","html","img","jpg","mp3","mp4","pdf","png","ppt","psd","rar","txt","word","wps","xls","zip","folder"],imgPreview:!1,previewImg:[],fileData:{},showFile:!1}},created:function(){},computed:{typeClass:function(){var e,t=this.file.type.toLowerCase();if(this.hasFilePng.includes(t))return"folder"==t?dsf.config.diskFileItem&&dsf.config.diskFileItem.folderPng?"static/images/".concat(dsf.config.diskFileItem.folderPng):"static/images/fileType/".concat(t,".png"):dsf.config.diskFileItem&&dsf.config.diskFileItem.filePng?"static/images/".concat(dsf.config.diskFileItem.filePng):"static/images/fileType/".concat(t,".png");for(e in this.fileType)if(this.fileType[e].includes(t))return"static/images/fileType/".concat(e,".png")}},methods:{getName:function(e,t){return"folder"==t?e.driveName||e.name:dsf.config.diskFileItem&&dsf.config.diskFileItem.hideFileType?(e.fileName||e.name).replace("."+e.type,""):e.fileName||e.name},checkType:function(e){var t,i=!1;for(t in this.fileType)if(this.fileType[t].includes(e)){i=!0;break}return i},link:function(){var e,t,i=this;"folder"==i.file.type?(o.log(i.file),i.$router.push({name:"diskFile",params:{driveType:i.file.driveType||i.queryType||-1,folderid:i.file.id||-1,allowAdd:i.file.allowAdd}})):(t=i.file.type)&&i.checkType(t.toLowerCase())?(t=t.toLowerCase(),i.fileType.img.includes(t)?(e=dsf.url.getServerUrl("fn/skydrive/download?pk=".concat(i.file.id,"&fileName=").concat(i.file.name)),this.imgPreview=!0,this.previewImg=[e]):t.includes("mp4")?(e=dsf.url.getServerUrl("fn/skydrive/download?pk=".concat(i.file.id,"&fileName=").concat(i.file.name)),i.video.showVideo=!0,i.video.videoTitle=i.file.name,i.video.src=e):(t=dsf.url.getServerUrl("fn/office/openMobileOffice?moduleId=190427152140nmiGu76moaSpanLaHnY&fileId=".concat(i.file.id,"&officeModuleId=skyDrive&filename=").concat(i.file.name)),dsf.config.commonForm.LocalDocPreview?i.showFile=!0:null!=(e=dsf.config.commonForm.wdzt)&&e.isEnable?(e={edit:!1,fileId:i.file.id,fileName:i.file.name,infoId:i.file.id,moduleId:"190427152140nmiGu76moaSpanLaHnY",officeModuleId:"skyDrive",pId:0,pnId:0},i.$router.push({path:"/wdztFileOpen",query:e})):i.$router.push({name:"dsfIframe",params:{url:t,title:i.file.name},query:{url:t,title:i.file.name.split(".")[0]}}))):dsf.layer.toast("当前文件不支持查看")},doRename:function(){var e;this.file.allowEdit?("folder"==this.file.type?(this.reExt="",this.reName=this.getName(this.file,"folder")):(e=this.getName(this.file,"file"),this.reExt=e.substr(e.lastIndexOf(".")),this.reName=e.substr(0,e.lastIndexOf(".")),o.log(this.reExt)),this.showRename=!0):dsf.layer.toast("此文件/文件夹您无权操作")},handleRename:function(){o.log(this.file);var t=this;this.reName?dsf.http.post("fn/skydrive/checkName",{fid:this.file.fId,id:this.file.id,name:this.reName+this.reExt,queryType:this.queryType}).then(function(e){o.log(e),e&&e.data&&"success"==e.data.type?dsf.http.post("fn/skydrive/reName",{fid:t.file.fId,id:t.file.id,name:t.reName+t.reExt,queryType:t.queryType}).then(function(e){e&&e.data&&"success"==e.data.type&&(t.$set(t.file,"name",t.reName+t.reExt),t.$set(t.file,"fileName",t.reName+t.reExt))}):dsf.layer.toast("已经存在相同名称文件或文件夹，请使用其他名称！")}):dsf.layer.toast("请输入文件名称！")},cancelDialog:function(){this.showRename=!1,this.reExt="",this.reName=""},deleteFile:function(){var e=this,t=(o.log(this.file),this);this.file.allowDelete?this.$dialog.confirm({title:"提示",message:"您确认要删除此文件或文件夹吗？"}).then(function(){dsf.http.post("fn/skydrive/delete",{id:e.file.id,name:e.file.name,fileSize:e.file.fileSize}).then(function(e){o.log(e),e&&e.data&&"200"==e.data.code&&(t.showData=!1)})}):dsf.layer.toast("此文件/文件夹您无权操作")},closeFile:function(){this.showFile=!1,this.$refs.enclosurePreview.destroyInterval()}}},t=i(51900),n=(0,t.Z)(a,function(){var t=this,e=t._self._c;return t.showData?e("div",[e("van-swipe-cell",{scopedSlots:t._u([{key:"right",fn:function(){return[t.file.allowDelete?e("van-button",{attrs:{type:"danger",text:"删除"},on:{click:t.deleteFile}}):t._e(),t._v(" "),t.file.allowEdit?e("van-button",{attrs:{color:"#07c160",type:"primary",text:"重命名"},on:{click:t.doRename}}):t._e()]},proxy:!0}],null,!1,2110875433)},[e("div",{staticClass:"file",on:{click:t.link}},[e("div",{staticClass:"typeIcon"},[e("img",{attrs:{src:t.typeClass,alt:""}}),t._v(" "),t.file.isNew?e("van-badge",{attrs:{dot:""}}):t._e()],1),t._v(" "),e("div",{staticClass:"info"},[e("div",{staticClass:"title elps"},[t._v(t._s(t.file.fullName))]),t._v(" "),e("div",{staticClass:"sub flex jb"},[t.file.createUName?e("span",{staticClass:"elps"},[t._v("上传人："+t._s(t.file.createUName))]):t._e(),t._v(" "),t.file.createTime?e("span",{staticStyle:{"flex-shrink":"0"}},[t._v("时间："+t._s(t.file.createTime))]):t._e()]),t._v(" "),e("div",{staticClass:"sub"},[t._v(t._s(t.file.directoryPath))])])])]),t._v(" "),e("van-image-preview",{attrs:{images:t.previewImg,closeable:""},model:{value:t.imgPreview,callback:function(e){t.imgPreview=e},expression:"imgPreview"}}),t._v(" "),e("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,"lock-scroll":"",position:"bottom","get-container":"#app"},model:{value:t.video.showVideo,callback:function(e){t.$set(t.video,"showVideo",e)},expression:"video.showVideo"}},[t.video.showVideo?e("div",[e("VPlayer",{attrs:{video:t.video}})],1):t._e()]),t._v(" "),e("van-dialog",{attrs:{"cancel-button-color":"#999999",title:"重命名","show-cancel-button":""},on:{confirm:t.handleRename,cancel:t.cancelDialog},model:{value:t.showRename,callback:function(e){t.showRename=e},expression:"showRename"}},[e("div",{staticClass:"nameinput"},[e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.reName,expression:"reName",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"请输入文件名",maxlength:"100"},domProps:{value:t.reName},on:{input:function(e){e.target.composing||(t.reName=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),t._v(" "),e("van-popup",{staticClass:"file-preview",staticStyle:{height:"100vh"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom"},model:{value:t.showFile,callback:function(e){t.showFile=e},expression:"showFile"}},[e("van-nav-bar",{attrs:{title:t.file.name,"left-text":"返回","left-arrow":"",fixed:"",placeholder:""},on:{"click-left":t.closeFile}}),t._v(" "),t.dsf.config.commonForm.LocalDocPreview?e("enclosure-preview",{ref:"enclosurePreview",attrs:{file:t.file,"form-info":t.fileData,officeModuleId:"skyDrive"}}):t._e()],1)],1):t._e()},[],!1,null,"611c110b",null).exports,s=i(21864),a=i(23336),l=i.n(a),r=i(25108),a={props:["params","mainKeyWord"],components:{fileItem:n,dsfFab:s.Z},computed:{showSearchBox:function(){var e;return!1!==(null==(e=this.params)||null==(e=e.params)?void 0:e.showSearchBox)}},watch:{mainKeyWord:{handler:function(e,t){this.key=e,this.key?this.onSearch():this.getFiles()},immediate:!0}},data:function(){return{files:[],loading:null,folderid:"",errored:!1,isFirstLoad:!1,addBtn:[{icon:"iconjiahao",title:"添加文件",type:"event",action:"addFile"},{icon:"iconjiahao",title:"新建目录",type:"event",action:"addDirectory"}],queryType:"",dataId:"",showAdd:!1,fileName:"",allowAdd:!0,key:""}},created:function(){var e=this;dsf.url.setTitle(e.$route.query.title||"资源中心"),e.isFirstLoad=!0,e.folderid=e.$route.params.folderid,this.mainKeyWord||(e.loading=dsf.layer.loading(),e.getFiles())},activated:function(){},mounted:function(){this.queryType=-1==this.$route.params.driveType?"":this.$route.params.driveType,this.dataId=-1==this.$route.params.folderid?0:this.$route.params.folderid,this.allowAdd=!("false"==this.$route.params.allowAdd||!this.$route.params.allowAdd)},methods:{btnAction:function(e){r.log(e),this[e.action](e)},afterRead:function(e){var t=this;r.log(e),this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0,overlay:!0}),dsf.http.upload("fn/skydrive/upload",e.file,{fId:this.dataId,queryType:this.queryType}).then(function(e){r.log(e),t.$toast.clear(),t.$toast("上传成功"),t.getFiles()}).error(function(e){t.$toast.clear(),t.$toast("上传失败"),r.log(e)})},addFile:function(){l()("#uploader_disk").click()},cancelDialog:function(){this.fileName="",this.showAdd=!1},handleAddDirectory:function(){var t=this;this.fileName?dsf.http.post("fn/skydrive/checkName",{fid:this.dataId,fId:this.dataId,name:this.fileName,queryType:this.queryType,isDirectory:1,rowState:1}).then(function(e){r.log(e),e&&e.data&&"success"==e.data.type?dsf.http.post("fn/skydrive/add",{fid:t.dataId,fId:t.dataId,name:t.fileName,queryType:t.queryType,isDirectory:1,rowState:1}).then(function(e){e&&e.data&&"success"==e.data.type&&t.getFiles()}):dsf.layer.toast("已经存在相同文件夹，请使用其他名称！")}):dsf.layer.toast("请输入文件名称！")},addDirectory:function(){this.fileName="",this.showAdd=!0},getFiles:function(){var t=this;(t.$route.params.folderid||t.$route.params.driveType?dsf.http.post("fn/skydrive/list",{queryType:-1==t.$route.params.driveType?"":t.$route.params.driveType,dataId:-1==t.$route.params.folderid?0:t.$route.params.folderid,key:""}).done(function(e){r.log(e),"200"==e.code&&((e=e.data.data).forEach(function(e){1==e.isDirectory?e.type="folder":e.type=e.filePath.split(".")[1]}),t.files=e.filter(function(e){return null!=e.type}))}).error(function(e){t.errored=!0}):dsf.http.post("fn/skydrive/mobileIndex").done(function(e){r.log(e),e.rows.forEach(function(e){e.type="folder"}),t.files=e.rows}).error(function(e){t.errored=!0})).always(function(){dsf.layer.closeLoading(t.loading)})},onSearch:function(){var t=this,e=dsf.layer.loading();dsf.http.post("fn/skydrive/list",{queryType:this.queryType,dataId:this.dataId,key:this.key}).done(function(e){r.log(e),"200"==e.code&&((e=e.data.data).forEach(function(e){1==e.isDirectory?e.type="folder":e.type=e.filePath.split(".")[1]}),t.files=e.filter(function(e){return null!=e.type}))}).error(function(e){t.errored=!0}).always(function(){dsf.layer.closeLoading(e)})}}},d=(0,t.Z)(a,function(){var i=this,a=i._self._c;return a("div",[i.errored?a("div",[i._v("\n        数据获取失败！\n    ")]):0<i.files.length?a("div",[i.showSearchBox?a("van-sticky",{attrs:{"offset-top":i.dsf.util.getOffsetTop()}},[a("van-search",{attrs:{placeholder:"请输入搜索关键词",clearable:!1},on:{search:i.onSearch},scopedSlots:i._u([i.key?{key:"right-icon",fn:function(){return[a("span",{on:{click:function(e){i.key="",i.getFiles()}}},[i._v("取消")])]},proxy:!0}:null],null,!0),model:{value:i.key,callback:function(e){i.key=e},expression:"key"}})],1):i._e(),i._v(" "),i._l(i.files,function(e,t){return a("div",{key:t},[a("file-item",{attrs:{queryType:i.queryType,file:e},on:{reflush:i.getFiles}}),i._v(" "),t<i.files.length-1?a("van-divider"):i._e()],1)})],2):a("div",{staticClass:"flex"},[a("commonempty",{attrs:{description:"暂无文件"}})],1),i._v(" "),i.$route.params.folderid&&i.allowAdd?a("dsf-fab",{attrs:{"fab-items":i.addBtn},on:{clickItem:i.btnAction}}):i._e(),i._v(" "),a("van-dialog",{attrs:{"cancel-button-color":"#999999",title:"新建文件夹","show-cancel-button":""},on:{confirm:i.handleAddDirectory,cancel:i.cancelDialog},model:{value:i.showAdd,callback:function(e){i.showAdd=e},expression:"showAdd"}},[a("div",{staticClass:"nameinput"},[a("span",[i._v("名称：")]),i._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:i.fileName,expression:"fileName",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"请输入文件夹名称",maxlength:"100"},domProps:{value:i.fileName},on:{input:function(e){e.target.composing||(i.fileName=e.target.value.trim())},blur:function(e){return i.$forceUpdate()}}})])]),i._v(" "),a("button",{staticStyle:{display:"none"},attrs:{id:"handleFileClick"}}),i._v(" "),a("van-uploader",{attrs:{id:"uploader_disk",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel, .zip","after-read":i.afterRead}},[a("van-icon",{attrs:{size:"0rem",name:"add-o"}})],1)],1)},[],!1,null,"ffdbbf88",null).exports},8167:function(e,t,i){function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,{Z:function(){return a}})},31314:function(e,t,i){i.d(t,{Z:function(){return s}});var n=i(26771),o=i(44660);function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),n(e,(0,o.Z)(a.key),a)}}function s(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),n(e,"prototype",{writable:!1}),e}}}]);