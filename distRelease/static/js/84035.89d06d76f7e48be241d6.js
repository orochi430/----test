"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[84035],{89251:function(t,e,s){s.d(e,{Z:function(){return h}});var e=s(79529),i=s.n(e),e=s(8450),o=s.n(e),n=s(88561),r=s(62596),a=s(25108),e={name:"gesture",props:{gestureType:{type:String,default:""},isSet:{type:Boolean,default:!1}},data:function(){return{c:"",cPosition:{},cxt:"",CW:600,CH:320,Radius:36,offsetX:5,offsetY:5,password:[],successColor:"#67c23a",errorColor:"red",innerColor:"",successInnerColor:"#ffffff",errorInnerColor:"#ffffff",selectColor:"#627eed",notSelectColor:"#CBCACE",Re:[],borderWidth:1,pointLine:[],pointWidth:12,lineWidth:3,count:0,pas_length:!1,tip_mes:"",tip_color:"",type:this.gestureType,title:""}},created:function(){var t=this;switch(this.type){case"set":this.title="设置手势密码";break;case"check":this.title="手势解锁";break;case"clear":this.title="清除手势密码"}null==n.Z.loadLocalStore("gesture_pas")&&"set"!=this.type&&dsf.layer.alert({title:"温馨提示",message:"还未设置手势密码"},function(){t.$router.go(-1)})},mounted:function(){var t=this;this.innerColor=this.successInnerColor,this.$nextTick(function(){t.init(),t.initEvent()})},methods:{goBack:function(){this.$router.go(-1)},init:function(){this.initCas(),this.getPointLocationArr(),this.draw()},initCas:function(){a.log(this.$refs.gestureBox.offsetWidth),this.c=this.$refs.myCanvas,this.CW=this.$refs.gestureBox.offsetWidth,this.CH=this.CW/1.06,this.c.width=this.CW,this.c.height=this.CH,600<i()(this.CW)&&i()(this.CW)<1e3&&(this.c.width=600,this.c.height=600,this.CH=600,this.CW=600,this.offsetX=20,this.Radius=35,this.c.style.margin="0 calc(50% - 300px)"),1e3<i()(this.CW)&&(this.c.width=800,this.c.height=800,this.CH=800,this.CW=800,this.offsetX=20,this.Radius=45,this.c.style.margin="0 calc(50% - 400px)"),a.log(this.c.height,this.offsetY),this.cPosition=this.c.getBoundingClientRect(),this.cxt=this.c.getContext("2d")},getPointLocationArr:function(){for(var t=(this.CW-2*this.offsetX-2*this.Radius*3)/2,e=(this.CH-2*this.offsetY-2*this.Radius*3)/2,s=0;s<3;s++)for(var i=0;i<3;i++){var o={x:this.offsetX+i*t+(2*i+1)*this.Radius,y:this.offsetY+s*e+(2*s+1)*this.Radius,coordinate:String(s)+String(i)};this.Re.push(o)}a.log(this.Re)},drawPoint:function(t,e){var s=this.pointLine;this.cxt.beginPath();for(var i=0;i<s.length;i++){var o=this.Re[s[i]];this.cxt.lineTo(o.x,o.y)}this.cxt.strokeStyle=this.selectColor,this.cxt.lineWidth=this.lineWidth,this.cxt.stroke(),this.cxt.closePath(),e&&(e=this.Re[this.pointLine[this.pointLine.length-1]],this.cxt.beginPath(),this.cxt.moveTo(e.x,e.y),this.cxt.lineTo(t.pageX-this.cPosition.left,t.pageY-this.cPosition.top),this.cxt.strokeStyle=this.selectColor,this.cxt.lineWidth=this.lineWidth,this.cxt.stroke(),this.cxt.closePath())},isPointSelect:function(t){for(var e=this.Re,s=0;s<e.length;s++){var i=e[s],o=Math.abs(t.pageX-i.x-this.cPosition.left),i=Math.abs(t.pageY-i.y-this.cPosition.top);Math.pow(o*o+i*i,.5)<=this.Radius&&(this.pointLine.length||-1!==this.pointLine.indexOf(s)?-1===this.pointLine.indexOf(s)&&this.handleError(s):this.pointLine.push(s))}},initEvent:function(){var e=this;this.c.addEventListener("touchstart",function(t){e.isPointSelect(t.touches[0])}),this.c.addEventListener("touchmove",function(t){e.isPointSelect(t.touches[0]),e.cxt.clearRect(0,0,e.CW,e.CH),e.draw(t.touches[0],!0)}),this.c.addEventListener("touchend",function(t){e.pas_length=!1,e.pointLine.length<4&&"set"==e.type&&(e.errorSet("密码长度不能小于4"),e.pas_length=!0),e.checkIsRight(),e.cxt.clearRect(0,0,e.CW,e.CH),e.draw(t.touches[0],!1),e.resetCxt(t.touches[0])})},handleError:function(t){var e=this.pointLine[this.pointLine.length-1];0===t&&8===e||8===t&&0===e||2===t&&6===e||6===t&&2===e||1===t&&7===e||7===t&&1===e||3===t&&5===e||5===t&&3===e?-1===this.pointLine.indexOf(4)&&this.pointLine.push(4):2===t&&0===e||0===t&&2===e?-1===this.pointLine.indexOf(1)&&this.pointLine.push(1):6===t&&8===e||8===t&&6===e?-1===this.pointLine.indexOf(7)&&this.pointLine.push(7):0===t&&6===e||6===t&&0===e?-1===this.pointLine.indexOf(3)&&this.pointLine.push(3):(2===t&&8===e||8===t&&2===e)&&-1===this.pointLine.indexOf(5)&&this.pointLine.push(5),this.pointLine.push(t)},resetCxt:function(t){var e=this,s=this;setTimeout(function(){e.pointLine=[],e.selectColor="#627eed",e.innerColor=e.successInnerColor,e.cxt.clearRect(0,0,s.CW,s.CH),e.draw(t,!1)},1e3)},checkIsRight:function(){var t=this;this.pas_length||(a.log("画线密码为：",this.pointLine,this.password,this.count),this.pas_length||this.count++,"set"==this.type?1===this.count?(this.password=this.pointLine,this.successSet("初次设置密码成功，请再次输入")):this.password.toString()!=this.pointLine.toString()?this.errorSet("两次密码不一致，请重新输入"):(this.successSet("二次输入正确，密码设置成功！"),a.log(this.password),n.Z.saveToLocalStore("gesture_pas",this.password),n.Z.saveToLocalStore("loginMode_set",!0),setTimeout(function(){t.$router.go(-1)},500)):"check"==this.type?(3===this.count&&String(this.pointLine)!==String(n.Z.loadLocalStore("gesture_pas"))&&(this.errorSet("手势密码错误，请重新输入"),dsf.layer.alert({title:"温馨提示",message:"超过三次输入失败，进入帐号密码登录"},function(){n.Z.removeToLocalStore("gesture_pas"),n.Z.removeToLocalStore("passWord"),t.$emit("gestureError")})),String(this.pointLine)!==String(n.Z.loadLocalStore("gesture_pas"))?this.errorSet("手势密码错误，请重新输入"):this.commonLogin()):"clear"==this.type&&(String(this.pointLine)!==String(n.Z.loadLocalStore("gesture_pas"))?this.errorSet("手势密码错误，请重新输入"):this.clearPsw()))},goUrl:function(){dsf.config.login.defaultUrl?this.$router.replace(dsf.config.login.defaultUrl):this.$router.replace("/index")},commonLogin:function(){var e,s=this;dsf.util.loadSessionStore("user")?s.goUrl():(e=dsf.layer.loading("登录中..."),dsf.http.post("/fn/mobileAuth/login",{__DATA:o()({logname:r.Z.decode(n.Z.loadLocalStore("uid")),password:r.Z.decode(n.Z.loadLocalStore("pid")),device_id:"postman",device_desc:"postman"})}).then(function(t){dsf.layer.closeLoading(e),1==t.data.rcode?(dsf.layer.toast(t.data.message),n.Z.saveToSessionStore("user",t.data.data),n.Z.saveToSessionStore("loginToken",t.data.data.auth.token),n.Z.saveToLocalStore("loginToken",t.data.data.auth.token),n.Z.saveToLocalStore("user",o()(t.data.data)),n.Z.logIn(function(){s.goUrl()})):(n.Z.removeToLocalStore("uid"),n.Z.removeToLocalStore("pid"),dsf.layer.toast("登录失效,请重新登录"),s.$router.replace("/testLogin"))}).catch(function(t){return dsf.layer.closeLoading(e)}))},clearPsw:function(){var t=this;n.Z.removeToLocalStore("gesture_pas"),n.Z.removeToLocalStore("loginMode_set"),this.successSet("手势密码清除成功"),dsf.layer.alert({title:"温馨提示",message:"手势密码清除成功"},function(){t.$route.params.type?t.$router.go(-2):t.$router.go(-1)})},successSet:function(t){this.tip_mes=t,this.tip_color="success_word",this.selectColor=this.successColor,this.innerColor=this.successInnerColor,this.isSet?this.$emit("remind","success",this.tip_mes):dsf.layer.toast(this.tip_mes)},errorSet:function(t){this.tip_mes=t,this.tip_color="error_word",this.selectColor=this.errorColor,this.innerColor=this.errorInnerColor,this.isSet?this.$emit("remind","warn",this.tip_mes):dsf.layer.toast(this.tip_mes)},draw:function(t,e){0<this.pointLine.length&&this.drawPoint(t,e);for(var s=this.Re,i=0;i<s.length;i++){var o=s[i];this.cxt.fillStyle=this.innerColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.Radius-this.borderWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),this.cxt.fillStyle=this.notSelectColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.pointWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),-1!=this.pointLine.indexOf(i)&&(this.cxt.fillStyle=this.selectColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.Radius,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),this.cxt.fillStyle=this.innerColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.Radius-this.borderWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),this.cxt.fillStyle=this.selectColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.pointWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath())}},randomString:function(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",s=e.length,i="",o=0;o<t;o++)i+=e.charAt(Math.floor(Math.random()*s));return i}}},h=(0,s(51900).Z)(e,function(){var t=this._self._c;return t("div",{ref:"gestureBox",staticClass:"gesture"},[t("canvas",{ref:"myCanvas"})])},[],!1,null,"91aefebc",null).exports},26983:function(t,e,s){s.d(e,{Z:function(){return i}});var n=s(25108),e={name:"forgetPassword",data:function(){return{setCode:!0,setPassword:!1,phone:"",phonecode:"",newpassword:"",surepassword:"",smsBtnText:"发送验证码",smsBtnEnable:!1,randomStr:"",errPwdMsg:"请输入新密码",phoneValidator:[{required:!0},{pattern:/^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d{8}$/,message:"请输入正确手机号"}],smsValidator:[{required:!0}],isIm:!1,findPassword:0}},computed:{minPwd:function(){return dsf.config.setting.hasOwnProperty("SYS-SEC-0001")&&dsf.config.setting["SYS-SEC-0001"]||6},strengthPwd:function(){return dsf.config.setting.hasOwnProperty("SYS-SEC-0002")&&dsf.config.setting["SYS-SEC-0002"]||1},pwdRules:function(){var t=[{validator:function(t){return""!==t}},{pattern:/^[A-Za-z0-9\~\@\^\!\#\$\(\)\*]+$/,message:"密码只能包含合法字符：数字、字母、~！@$^()*"},{pattern:new RegExp("^.{"+this.minPwd+",}$",""),message:"密码长度至少为".concat(this.minPwd,"位")}];return 2==this.strengthPwd&&t.push({pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z0-9\~\@\^\!\#\$\(\)\*]+$/,message:"密码必须包含数字+字母"}),3==this.strengthPwd&&t.push({pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[\~\@\^\!\#\$\(\)\*])[A-Za-z0-9\~\@\^\!\#\$\(\)\*]+$/,message:"密码必须包含数字+字母+符号~、！、@、$、^、(、)、*"}),n.log(t),t}},methods:{sureValidator:function(t){return t==this.newpassword},confirm:function(){var e=this;this.setCode?dsf.http.post("/fn/mobileSmsAuth/verifyForgetCode",{mobile:this.phone,code:this.phonecode}).then(function(t){dsf.layer.toast(t.data.message),1==t.data.rcode&&(e.randomStr=t.data.data,e.setCode=!1,e.setPassword=!0)}).error(function(t){dsf.layer.toast("接口异常，请联系系统管理员！")}):dsf.http.post("/fn/mobileSmsAuth/forgetPsd",{randomStr:this.randomStr,pwd:this.newpassword}).then(function(t){dsf.layer.toast(t.data.message),1==t.data.rcode&&(1==e.findPassword&&window.native&&window.native.isNative?window.native.back():e.$emit("toLogin"))}).error(function(t){dsf.layer.toast("接口异常，请联系系统管理员！")})},sendSmsCode:function(){var i=this,o=0;i.$refs.setPwd.validate("phone").then(function(){return i.smsBtnEnable=!0,o=dsf.layer.loading("发送中..."),dsf.http.post("/fn/mobileSmsAuth/sendForgetSms",{mobile:i.phone})}).then(function(t){var e,s;n.log(t),dsf.layer.closeLoading(o),dsf.layer.toast(t.data.message),1==t.data.rcode?(e=t.data.data.time,s=setInterval(function(){e--,i.smsBtnText="发送验证码("+e+")",0==e&&(clearInterval(s),i.smsBtnEnable=!1,i.smsBtnText="发送验证码")},1e3)):i.smsBtnEnable=!1}).error(function(t){dsf.layer.closeLoading(o),i.smsBtnEnable=!1,n.log(t),-1<t.message.indexOf("404")&&dsf.layer.toast("短信发送接口异常，请联系系统管理员！")})}},created:function(){this.$route.query.isIm&&(this.isIm=1==this.$route.query.isIm),0<=navigator.userAgent.indexOf("mobileIM")&&(this.isIm=!0),this.$route.query.findPassword&&1==this.$route.query.findPassword&&(this.findPassword=1)}},i=(0,s(51900).Z)(e,function(){var e=this,t=e._self._c;return t("div",[t("van-form",{ref:"setPwd",on:{submit:e.confirm}},[t("van-field",{attrs:{rules:e.phoneValidator,readonly:e.setPassword,name:"phone",type:"tel",placeholder:"请输入手机号码",center:""},scopedSlots:e._u([{key:"left-icon",fn:function(){return[t("i",{staticClass:"iconfont iconshouji"})]},proxy:!0}]),model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}}),e._v(" "),e.setCode?t("div",{staticClass:"sendCode"},[t("van-field",{attrs:{rules:e.smsValidator,center:"",clearable:"",name:"短信验证码",placeholder:"请输入验证码"},scopedSlots:e._u([{key:"left-icon",fn:function(){return[t("i",{staticClass:"iconfont iconyuechi"})]},proxy:!0}],null,!1,253601634),model:{value:e.phonecode,callback:function(t){e.phonecode=t},expression:"phonecode"}}),e._v(" "),t("van-button",{attrs:{text:e.smsBtnText,disabled:e.smsBtnEnable,size:"small",type:"primary","native-type":"button"},on:{click:function(t){return e.sendSmsCode()}}})],1):e._e(),e._v(" "),e.setPassword?t("van-field",{attrs:{rules:e.pwdRules,type:"password",name:"密码",placeholder:"请输入新密码",center:""},scopedSlots:e._u([{key:"left-icon",fn:function(){return[t("i",{staticClass:"iconfont iconmima1"})]},proxy:!0}],null,!1,629997040),model:{value:e.newpassword,callback:function(t){e.newpassword=t},expression:"newpassword"}}):e._e(),e._v(" "),e.setPassword?t("van-field",{attrs:{rules:[{required:!0},{validator:e.sureValidator,message:"两次输入密码不一致"}],type:"password",name:"密码",placeholder:"请再次输入新密码",center:""},scopedSlots:e._u([{key:"left-icon",fn:function(){return[t("i",{staticClass:"iconfont iconmima1"})]},proxy:!0}],null,!1,629997040),model:{value:e.surepassword,callback:function(t){e.surepassword=t},expression:"surepassword"}}):e._e(),e._v(" "),t("div",{staticClass:"btnbox",staticStyle:{"margin-top":"30px"}},[t("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{round:"",type:"info","native-type":"submit"}},[e._v("\n                "+e._s(e.setPassword?"确认":"重置")+"\n            ")])],1),e._v(" "),e.isIm?e._e():t("div",{staticClass:"changeType"},[t("span",{on:{click:function(t){return e.$emit("toLogin")}}},[e._v("返回登录")])])],1)],1)},[],!1,null,"7159423d",null).exports}}]);