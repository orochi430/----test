"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[76039],{76039:function(t,s,e){e.r(s),e.d(s,{default:function(){return u}});var i=e(66250),r=e(5044),s=e(8450),n=e.n(s),s=e(33453),c=e.n(s),s=e(5251),o=e(21864),a=e(42152),l=e.n(a),h=e(25108),a={mixins:[s.Z],props:{keyword:{type:String,default:""},initOrgId:{type:String,default:""},isShowCount:{type:Boolean,default:!0},url:{type:String,default:""},searchUrl:{type:String,default:""},itemtab:{type:Object,default:function(){return{}}}},components:{dsfFab:o.Z},data:function(){return{that:this,hasChild:!0,organization:{},commonUserList:[],userList:[],allData:[],timeout:null,userInfo:null,groupList:[],breadList:[],search:!1,searchUserList:[],isShowOrg:!0,isShowCommonUser:!0,currentIndex:0,hasgoDetial:!1,isShowAllOrg:dsf.config.mailList.showAllOrg,showAction:!1,actions:[],selectUser:{},btnCopy:null,phone_system:dsf.util.checkSystem(),clientName:dsf.util.getClientName()}},created:function(){this.userInfo=dsf.util.loadSessionStore("user"),this.actions.push({name:"呼叫"}),this.actions.push({name:"复制号码",className:"actionStyle"}),"android"==this.phone_system&&"app"==this.clientName&&this.actions.push({name:"添加到通讯录"}),this.mainButtons=[{action:"save",icon:"iconreply",name:"返回"}]},mounted:function(){this.init()},activated:function(){this.goScrollRight()},watch:{keyword:function(t){var s=this;this.debounce(function(){t?s.getSearchUserList():(s.search=!1,s.init())},800)},breadList:{handler:function(t,s){window.isAddressRoot=t.length==(this.isShowAllOrg?2:0),this.hasgoDetial=t.length>(this.isShowAllOrg?2:0),this.goScrollRight()},immediate:!0}},methods:{checkPhoneLength:function(t){var s;return(null==(s=t.mobile)?void 0:s.length)||(null==(s=t.tel)?void 0:s.length)},goScrollRight:function(){var s=this;this.$nextTick(function(){var t;s.$refs.scrollRef&&s.breadList.length&&(t=s.$refs.scrollRef.scrollWidth,s.$refs.scrollRef.scrollTo(t,0))})},addPopstate:function(){h.log("organization-addPopstate"),window.addEventListener("popstate",this.bindPageChange),h.log("breadList.length",this.breadList.length),this.hasgoDetial&&history.pushState(null,null,document.URL),window.isAddressRoot=this.breadList.length==(this.isShowAllOrg?2:0)},removePopstate:function(t){h.log("organization-removePopstate"),window.removeEventListener("popstate",this.bindPageChange)},bindPageChange:function(){var t;window.popTarget.length||(2<(t=this).breadList.length?(history.pushState(null,null,document.URL),t.btnAction()):2==t.breadList.length&&(t.isShowAllOrg?history.back():t.btnAction()))},btnAction:function(t){this.toNext(this.breadList[this.breadList.length-2])},getPhotoSrc:function(t){return dsf.url.getWebPath(t)+"&time=".concat((new Date).getTime())},chooseBread:function(t,s){this.toNext(s)},chooseGroup:function(t){this.toNext(t,!1)},init:function(){var s=this,e=this;dsf.http.post("/fn/contacts/mobileIndex",{}).then(function(t){e.organization=t.data.data,e.commonUserList=0<t.data.data.users.length?t.data.data.users:[],e.isShowAllOrg&&s.toNext(e.organization,null,!0)})},toNext:function(n,t,s){var o=this,a=this;if(this.hasgoDetial||s||history.pushState(null,null,document.URL),"全部"==n.name)return a.isShowAllOrg?void this.toNext(a.organization,!0):(a.breadList=[],a.isShowOrg=!0,a.isShowCommonUser=!0,void(a.currentIndex=0));a.isShowOrg=!1,a.isShowCommonUser=!1,a.currentIndex++,a.breadList=[],a.groupList=[],a.userList=[];s=a.allData.find(function(t){return t.orgId==n.id});s?(a.breadList=[].concat((0,r.Z)(s.breadList)),a.groupList=[].concat((0,r.Z)(s.groupList)),a.userList=[].concat((0,r.Z)(s.userList)),a.$nextTick(function(){window.scrollTo(0,0)})):(a.$toast.loading("加载中"),dsf.http.post(a.url,{orgId:n.id}).then(function(){var s=(0,i.Z)(c().mark(function t(s){var e,i;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.data.data,a.breadList=[{name:"全部",id:"0"}].concat((0,r.Z)(e.navs)),h.log("breadListLength",o.breadList,o.breadList.length),"zydx"!=dsf.config.projectName){t.next=13;break}i=0;case 5:if(i<e.users.length)return t.next=8,dsf.util.isMyDept(e.users[i].orgNameLv1Text);t.next=13;break;case 8:if(t.sent){t.next=10;break}e.users[i].mobile="";case 10:i++,t.next=5;break;case 13:a.groupList=e.depts,a.userList=e.users,a.allData.push({orgId:n.id,breadList:dsf.util.deepCopy(a.breadList),groupList:dsf.util.deepCopy(a.groupList),userList:dsf.util.deepCopy(a.userList)}),a.$toast.clear();case 17:case"end":return t.stop()}},t)}));return function(t){return s.apply(this,arguments)}}()))},deepCopy:function(t){return JSON.parse(n()(t))},changeCrumbs:function(t){this.deepCopy(t)},getData:function(){var s=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.$toast.loading({}),dsf.http.post(this.url,{orgId:t}).then(function(t){t=t.data.data;s.organization=t.depts,s.userList=t.users,s.$toast.clear()})},returnOrg:function(t,s){this.getData(t.id)},toDetail:function(t){this.$router.push({name:"mailDetail",query:{title:"通讯录",userdata:n()(t)}})},getSearchUserList:function(){var s=this,e=this,t=(e.$toast.loading("加载中"),this.searchUserList=[],""==this.keyword?{}:{keyword:this.keyword});dsf.http.post(this.searchUrl,t).then(function(t){e.$toast.clear(),s.search=!0,s.searchUserList=t.data.data})},copyText:function(t){var s=this;s.btnCopy.on("success",function(t){dsf.layer.toast("复制成功"),t.clearSelection(),s.btnCopy.destroy()}),s.btnCopy.on("error",function(t){dsf.layer.toast("复制失败"),s.btnCopy.destroy()})},onSelect:function(t,s){h.log(t,s),0==s?this.phoneTo(this.selectUser.mobile||this.selectUser.tel):1==s?this.copyText(this.selectUser.mobile):2==s&&"app"==this.clientName&&$iaction.savePhoneNumber({phoneNumber:this.selectUser.mobile,name:this.selectUser.userName,type:0},function(t){},function(t){})},phoneTo:function(t){window.location.href="tel:".concat(t)},phoneCall:function(t){var s=this;this.selectUser=t,this.showAction=!0,this.$nextTick(function(){document.querySelectorAll(".actionStyle").forEach(function(t){t.setAttribute("data-clipboard-text",s.selectUser.mobile||s.selectUser.tel)}),s.btnCopy=new(l())(document.querySelectorAll(".actionStyle"))})}},filters:{filterName:function(t){return t.slice(t.length-2)},filterMobile:function(t,s){return s.mobileDesensitizationSafeContent||t||s.tel},filterOrg:function(t,s,e){return e.itemtab.isShowAllDept&&s.unitName||t},userAvatar:function(t){return t.slice(0,1)}}},u=(0,e(51900).Z)(a,function(){var i=this,n=i._self._c;return n("div",{staticClass:"organization fc"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!i.search,expression:"!search"}]},[0<i.breadList.length?n("div",{staticClass:"organizationBox flex1 breadList"},[n("div",{staticClass:"organizationitem scrollBoxParent"},[n("div",{ref:"scrollRef",staticClass:"scrollBox disfr ac ofa"},i._l(i.breadList,function(s,e){return n("div",{key:e,staticClass:"disfr ac wsp",on:{click:function(t){e<i.breadList.length-1&&i.toNext(s,e)}}},[n("span",{class:e<i.breadList.length-1?"":"normalColor"},[i._v(i._s(s.name))]),i._v(" "),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:e<i.breadList.length-1,expression:"index < breadList.length - 1"}],attrs:{name:"arrow"}})],1)}),0)])]):i._e(),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:i.isShowOrg,expression:"isShowOrg"}],staticClass:"organizationBox flex1 treeBox"},[n("div",{staticClass:"organizationitem disfr jsb ac deptTitle",on:{click:function(t){return i.toNext(i.organization,!0)}}},[n("span",{staticClass:"org-name"},[i._v(i._s(i.organization.name))]),i._v(" "),n("van-icon",{attrs:{name:"arrow"}})],1),i._v(" "),i._l(i.organization.depts,function(s,t){return n("div",{key:t,staticClass:"organizationitem disfr jsb ac organizationSecitem",on:{click:function(t){return i.toNext(s,!0)}}},[n("div",{staticClass:"org-box"},[n("p",[n("van-icon",{attrs:{name:"cluster-o"}})],1),i._v(" "),n("span",{staticClass:"org-name"},[i._v(i._s(s.name))])]),i._v(" "),n("van-icon",{attrs:{name:"arrow"}})],1)})],2),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:i.groupList.length&&!i.isShowOrg&&!i.dsf.config.addressList.showPersonFirst,expression:"groupList.length && !isShowOrg && !dsf.config.addressList.showPersonFirst"}],staticClass:"organizationBox flex1 groupList calcHeight",style:{maxHeight:"calc(100vh - 3.3rem - ".concat(i.dsf.util.getOffsetTop("1.2rem",!0),")")}},i._l(i.groupList,function(s,t){return n("div",{key:t,staticClass:"organizationitem disfr jsb ac",on:{click:function(t){return i.toNext(s)}}},[n("div",{staticClass:"org-box"},[n("p",[n("van-icon",{attrs:{name:"cluster-o"}})],1),i._v(" "),n("span",{staticClass:"orgtitle flex ae"},[n("span",{staticClass:"elps"},[i._v(i._s(s.name)+" ")]),i._v(" "),0<s.userCount&&!i.dsf.config.mailList.isHideCount?n("span",[i._v("("+i._s(s.userCount)+")")]):i._e()])]),i._v(" "),0<s.userCount?n("van-icon",{attrs:{name:"arrow"}}):i._e()],1)}),0),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0<i.userList.length&&!i.isShowOrg,expression:"userList.length > 0 && !isShowOrg"}],staticClass:"organizationPerson flex1 userList calcHeight",style:{maxHeight:"calc(100vh - 3.3rem - ".concat(i.dsf.util.getOffsetTop("1.2rem",!0),")")}},i._l(i.userList,function(s,t){return n("div",{key:t,staticClass:"personInfo disfr ac",on:{click:function(t){return i.toDetail(s)}}},[s.photoSrc?n("img",{staticClass:"userImg",attrs:{src:i.getPhotoSrc(s.photoSrc)}}):n("div",{staticClass:"userImg"},[i._v(i._s(i._f("filterName")(s.userName)))]),i._v(" "),n("div",{staticClass:"itemContent fc jsb flex ellipsis"},[n("div",{staticClass:"flex jb"},[n("span",{staticClass:"personName ellipsis minWid"},[i._v(i._s(s.userName))]),i._v(" "),(s.zhiw,n("span",{staticClass:"personName ellipsis minWid right"},[i._v(i._s(s.zhiw))]))]),i._v(" "),i.checkPhoneLength(s)&&!i.dsf.config.addressList.isFideMobile?n("span",{staticClass:"personNum"},[i._v(i._s(i._f("filterMobile")(s.mobile,s)))]):i._e()]),i._v(" "),n("div",{staticClass:"personInfoRight"},[i.checkPhoneLength(s)?n("van-icon",{attrs:{name:"phone"},on:{click:function(t){return t.stopPropagation(),i.phoneCall(s)}}}):i._e()],1)])}),0),i._v(" "),0<i.commonUserList.length&&i.isShowCommonUser?n("div",{staticClass:"commonusertitle"},[i._v("\n      常用联系人\n    ")]):i._e(),i._v(" "),0<i.commonUserList.length&&i.isShowCommonUser?n("div",{staticClass:"organizationPerson flex1"},i._l(i.commonUserList,function(s,t){return n("div",{key:t,staticClass:"personInfo disfr ac",on:{click:function(t){return i.toDetail(s)}}},[s.photoSrc?n("img",{staticClass:"userImg",attrs:{src:i.getPhotoSrc(s.photoSrc)}}):n("div",{staticClass:"userImg"},[i._v(i._s(i._f("filterName")(s.userName)))]),i._v(" "),n("div",{staticClass:"itemContent fc jsb"},[n("span",{staticClass:"personName"},[i._v(i._s(s.userName))]),i._v(" "),!s.mobile&&!s.tel||i.dsf.config.addressList.isFideMobile?i._e():n("span",{staticClass:"personNum"},[i._v("\n            "+i._s(i._f("filterMobile")(s.mobile,s))+"\n          ")])])])}),0):i._e(),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:i.groupList.length&&!i.isShowOrg&&i.dsf.config.addressList.showPersonFirst,expression:"groupList.length && !isShowOrg && dsf.config.addressList.showPersonFirst"}],staticClass:"organizationBox flex1 groupList calcHeight",style:{maxHeight:"calc(100vh - 3.3rem - ".concat(i.dsf.util.getOffsetTop("1.2rem",!0),")")}},i._l(i.groupList,function(s,t){return n("div",{key:t,staticClass:"organizationitem disfr jsb ac",on:{click:function(t){return i.toNext(s)}}},[n("div",{staticClass:"org-box"},[n("p",[n("van-icon",{attrs:{name:"cluster-o"}})],1),i._v(" "),n("span",{staticClass:"orgtitle flex ae"},[n("span",{staticClass:"elps"},[i._v(i._s(s.name)+" ")]),i._v(" "),0<s.userCount&&!i.dsf.config.mailList.isHideCount?n("span",[i._v("("+i._s(s.userCount)+")")]):i._e()])]),i._v(" "),0<s.userCount?n("van-icon",{attrs:{name:"arrow"}}):i._e()],1)}),0)]),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:i.search,expression:"search"}],staticClass:"searchCalcHeight",style:{maxHeight:"calc(100vh - 2.3rem - ".concat(i.dsf.util.getOffsetTop("1.2rem",!0),")")}},[n("div",{directives:[{name:"show",rawName:"v-show",value:0<i.searchUserList.length,expression:"searchUserList.length > 0"}],staticClass:"organizationPerson organizationPersonSearch flex1"},i._l(i.searchUserList,function(s,t){return n("div",{key:t,staticClass:"personInfo disfr ac",on:{click:function(t){return i.toDetail(s)}}},[s.photoSrc?n("img",{staticClass:"userImg",attrs:{src:i.getPhotoSrc(s.photoSrc)}}):n("div",{staticClass:"userImg"},[i._v(i._s(i._f("filterName")(s.userName)))]),i._v(" "),n("div",{staticClass:"itemContent fc jsb flex ellipsis"},[n("span",{staticClass:"personName ellipsis minWid"},[i._v(i._s(s.userName))]),i._v(" "),i.checkPhoneLength(s)&&!i.dsf.config.addressList.isFideMobile?n("span",{staticClass:"personNum ellipsis"},[i._v("\n            "+i._s(i._f("filterMobile")(s.mobile,s))+"\n          ")]):i._e()]),i._v(" "),n("div",{staticClass:"search_org_name"},[i._v(i._s(i._f("filterOrg")(s.orgName,s,i.that)))]),i._v(" "),n("div",{staticClass:"personInfoRight"},[i.checkPhoneLength(s)?n("van-icon",{attrs:{name:"phone"},on:{click:function(t){return t.stopPropagation(),i.phoneCall(s)}}}):i._e()],1)])}),0),i._v(" "),0==i.searchUserList.length?n("commonempty"):i._e()],1),i._v(" "),n("van-action-sheet",{attrs:{actions:i.actions,"cancel-text":"取消","close-on-click-action":""},on:{select:i.onSelect},model:{value:i.showAction,callback:function(t){i.showAction=t},expression:"showAction"}})],1)},[],!1,null,"a436b08a",null).exports}}]);