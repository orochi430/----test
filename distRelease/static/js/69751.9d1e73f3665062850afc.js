(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[69751],{53894:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13682),_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(22013),_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(85579),_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(79529),_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_corejs2_core_js_set_immediate__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(21982),_babel_runtime_corejs2_core_js_set_immediate__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_set_immediate__WEBPACK_IMPORTED_MODULE_4__),_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8450),_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5__),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(62207),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6__),_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(73473),_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_7__),_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(26243),_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_8__),console=__webpack_require__(25108),$jscomp=$jscomp||{},maxTickDepth=($jscomp.scope={},$jscomp.findInternal=function(e,t,i){for(var n=(e=e instanceof String?String(e):e).length,a=0;a<n;a++){var o=e[a];if(t.call(i,o,a,e))return{i:a,v:o}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value)},$jscomp.getGlobal=function(e){return("undefined"==typeof window||window!==e)&&void 0!==__webpack_require__.g&&null!=__webpack_require__.g?__webpack_require__.g:e},$jscomp.global=$jscomp.getGlobal(void 0),$jscomp.polyfill=function(e,t,i,n){if(t){for(i=$jscomp.global,e=e.split("."),n=0;n<e.length-1;n++){var a=e[n];a in i||(i[a]={}),i=i[a]}(t=t(n=i[e=e[e.length-1]]))!=n&&null!=t&&$jscomp.defineProperty(i,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}},"es6","es3"),$jscomp.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}},$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.SymbolClass=function(e,t){this.$jscomp$symbol$id_=e,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})},$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_},$jscomp.Symbol=function(){var i=0;return function e(t){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(t||"")+"_"+i++,t)}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=(e=$jscomp.global.Symbol.iterator)||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.asyncIterator||($jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.iteratorFromArray=function(t,i){$jscomp.initSymbolIterator(),t instanceof String&&(t+="");var n=0,a={next:function(){var e;return n<t.length?(e=n++,{value:i(e,t[e]),done:!1}):(a.next=function(){return{done:!0,value:void 0}},a.next())}};return a[_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_1___default()]=function(){return a},a},$jscomp.polyfill("Array.prototype.values",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e,t){return t})}},"es8","es3"),$jscomp.polyfill("Array.prototype.keys",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3"),$jscomp.makeIterator=function(e){var t=void 0!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_2___default()&&_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_1___default()&&e[_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_1___default()];return t?t.call(e):$jscomp.arrayIterator(e)},$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",function(e){function t(){this.batch_=null}function s(i){return i instanceof r?i:new r(function(e,t){e(i)})}if(e&&!$jscomp.FORCE_POLYFILL_PROMISE)return e;t.prototype.asyncExecute=function(e){var t;null==this.batch_&&(this.batch_=[],(t=this).asyncExecuteFunction(function(){t.executeBatch_()})),this.batch_.push(e)};function r(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}var i=$jscomp.global.setTimeout,a=(t.prototype.asyncExecuteFunction=function(e){i(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var i=e[t];e[t]=null;try{i()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e})},r.prototype.createResolveAndReject_=function(){function e(t){return function(e){n||(n=!0,t.call(i,e))}}var i=this,n=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},r.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof r)this.settleSameAsPromise_(e);else{switch((0,_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.Z)(e)){case"object":var t=null!=e;break;case"function":t=!0;break;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},r.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},r.prototype.reject_=function(e){this.settle_(2,e)},r.prototype.fulfill_=function(e){this.settle_(1,e)},r.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},r.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)a.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}},new t);return r.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},r.prototype.settleSameAsThenable_=function(e,t){var i=this.createResolveAndReject_();try{e.call(t,i.resolve,i.reject)}catch(e){i.reject(e)}},r.prototype.then=function(e,t){function i(t,e){return"function"==typeof t?function(e){try{n(t(e))}catch(e){a(e)}}:e}var n,a,o=new r(function(e,t){n=e,a=t});return this.callWhenSettled_(i(e,n),i(t,a)),o},r.prototype.catch=function(e){return this.then(void 0,e)},r.prototype.callWhenSettled_=function(e,t){function i(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?a.asyncExecute(i):this.onSettledCallbacks_.push(i)},r.resolve=s,r.reject=function(i){return new r(function(e,t){t(i)})},r.race=function(a){return new r(function(e,t){for(var i=$jscomp.makeIterator(a),n=i.next();!n.done;n=i.next())s(n.value).callWhenSettled_(e,t)})},r.all=function(e){var t=$jscomp.makeIterator(e),o=t.next();return o.done?s([]):new r(function(i,e){for(var n=[],a=0;n.push(void 0),a++,s(o.value).callWhenSettled_(function(t){return function(e){n[t]=e,0==--a&&i(n)}}(n.length-1),e),!(o=t.next()).done;);})},r},"es6","es3"),$jscomp.polyfill("Array.prototype.fill",function(e){return e||function(e,t,i){var n=this.length||0;for(t<0&&(t=Math.max(0,n+t)),(null==i||n<i)&&(i=n),(i=Number(i))<0&&(i=Math.max(0,n+i)),t=Number(t||0);t<i;t++)this[t]=e;return this}},"es6","es3"),!function(){function e(e,t){i[e]=t}var i={};e("jquery",function(){return jQuery}),e("popup",function(e){function a(){this.destroyed=!1,this.__popup=k("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=k("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],0}var k=e("jquery"),n=!("minWidth"in k("html")[0].style),o=!n;return k.extend(a.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(e){var t,i;return this.destroyed||(t=this.__popup,i=this.__backdrop,this.__activeElement=this.__getActive(),this.open=!0,this.follow=e||this.follow,this.__ready||(t.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),n||k(window).on("resize",k.proxy(this.reset,this)),this.modal&&(e={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||a.zIndex},t.addClass(this.className+"-modal"),o||k.extend(e,{position:"absolute",width:k(window).width()+"px",height:k(document).height()+"px"}),i.css(e).attr({tabindex:"0"}).on("focus",k.proxy(this.focus,this)),this.__mask=i.clone(!0).attr("style","").insertAfter(t),i.addClass(this.className+"-backdrop").insertBefore(t),this.__ready=!0),t.html())||t.html(this.innerHTML),t.addClass(this.className+"-show").show(),i.show(),this.reset().focus(),this.__dispatchEvent("show")),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(e){return!this.destroyed&&this.open&&(void 0!==e&&(this.returnValue=e),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(!this.destroyed)for(var e in this.__dispatchEvent("beforeremove"),a.current===this&&(a.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),n||k(window).off("resize",this.reset),this.__dispatchEvent("remove"),this)delete this[e];return this},reset:function(){var e=this.follow;return e?this.__follow(e):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var e=this.node,t=this.__popup,i=a.current,n=this.zIndex=a.zIndex++;return i&&i!==this&&i.blur(!1),k.contains(e,this.__getActive())||(i=t.find("[autofocus]")[0],!this._autofocus&&i?this._autofocus=!0:i=e,this.__focus(i)),t.css("zIndex",n),a.current=this,t.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(e){var t=this.__activeElement;return!1!==e&&this.__focus(t),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(e,t){return this.__getEventListener(e).push(t),this},removeEventListener:function(e,t){e=this.__getEventListener(e);for(var i=0;i<e.length;i++)t===e[i]&&e.splice(i--,1);return this},__getEventListener:function(e){var t=this.__listener;return(t=t||(this.__listener={}))[e]||(t[e]=[]),t[e]},__dispatchEvent:function(e){var t=this.__getEventListener(e);for(this["on"+e]&&this["on"+e](),e=0;e<t.length;e++)t[e].call(this)},__focus:function(e){try{this.autofocus&&!/^iframe$/i.test(e.nodeName)&&e.focus()}catch(e){}},__getActive:function(){try{var e=document.activeElement,t=e.contentDocument;return t&&t.activeElement||e}catch(e){}},__center:function(){this.__popup[0].style.left="0px";var e=this.__popup,t=k(window),i=k(document),n=(a=this.fixed)?0:i.scrollLeft(),i=a?0:i.scrollTop(),a=t.width(),o=t.height(),t=e.width(),o=382*(o-e.height())/1e3+i;(e=e[0].style).left=Math.max(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()((a-t)/2+n),n)+"px",e.top=Math.max(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(o),i)+"px"},__follow:function(e){var t=e.parentNode&&k(e),i=this.__popup;if(this.__followSkin&&i.removeClass(this.__followSkin),t){var n=t.offset();if(n.left*n.top<0)return this.__center()}var a=this.fixed,o=k(window),n=k(document),s=o.width(),r=o.height(),l=n.scrollLeft(),c=n.scrollTop(),u=(n=i.width(),o=i.height(),t?t.outerWidth():0),g=t?t.outerHeight():0,d=this.__offset(e),h=(e=d.left,d=d.top,e=a?e-l:e,d=a?d-c:d,s=(l=a?0:l)+s-n,r=(a=a?0:c)+r-o,c={},this.align.split(" ")),f=this.className+"-",p={top:"bottom",bottom:"top",left:"right",right:"left"},_={top:"top",bottom:"top",left:"left",right:"left"},m=[{top:d-o,bottom:d+g,left:e-n,right:e+u},{top:d,bottom:d-o+g,left:e,right:e-n+u}],v=(n={left:e+u/2-n/2,top:d+g/2-o/2},{left:[l,s],top:[a,r]});k.each(h,function(e,t){m[e][t]>v[_[t]][1]&&(t=h[e]=p[t]),m[e][t]<v[_[t]][0]&&(h[e]=p[t])}),h[1]||(_[h[1]]="left"===_[h[0]]?"top":"left",m[1][h[1]]=n[_[h[1]]]),this.__followSkin=f+=h.join("-")+" "+this.className+"-follow",t&&i.addClass(f),c[_[h[0]]]=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(m[0][h[0]]),c[_[h[1]]]=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(m[1][h[1]]),i.css(c)},__offset:function(e){var t=(i=e.parentNode)?k(e).offset():{left:e.pageX,top:e.pageY};if((e=(i=(e=i?e:e.target).ownerDocument).defaultView||i.parentWindow)==window)return t;e=e.frameElement;var i=(n=k(i)).scrollLeft(),n=n.scrollTop();return e=k(e).offset(),{left:t.left+e.left-i,top:t.top+e.top-n}}}),a.zIndex=1024,a.current=null,a}),e("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="checkInput" class="ui-dialog-checkInput"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'}),e("dialog",function(e){function o(e,t,i){var n=e=e||{},a=("string"!=typeof e&&1!==e.nodeType||(e={content:e,fixed:!c}),(e=s.extend(!0,{},o.defaults,e)).original=n,n=e.id=e.id||l+r,o.get(n));return a?a.focus():(u||(e.fixed=!1),e.quickClose&&(e.modal=!0,e.backdropOpacity=0),s.isArray(e.button)||(e.button=[]),void 0!==i&&(e.cancel=i),e.cancel&&e.button.push({id:"cancel",value:e.cancelValue,callback:e.cancel,display:e.cancelDisplay}),void 0!==t&&(e.ok=t),e.ok&&e.button.push({id:"ok",value:e.okValue,callback:e.ok,autofocus:!0}),o.list[n]=new o.create(e))}var s=e("jquery"),a=e("popup"),t=e("dialog-config"),r=((i=t.cssUri)&&(e=e[e.toUrl?"toUrl":"resolve"])&&(i='<link rel="stylesheet" href="'+(i=e(i))+'" />',s("base")[0]?s("base").before(i):s("head").append(i)),0),l=+new Date,i=!("minWidth"in s("html")[0].style),c="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),u=!i&&!c;return(i=function(){}).prototype=a.prototype,i=o.prototype=new i,(o.create=function(e){var n=this,t=(s.extend(this,new a),e.original,s(this.node).html(e.innerHTML)),i=s(this.backdrop);return this.options=e,this._popup=t,s.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t}),e.zIndex&&(a.zIndex=e.zIndex),t.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",!1===this.cancel?"none":"").attr("title",this.cancelValue).on("click",function(e){n._trigger("cancel"),e.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),e.quickClose&&i.on("onmousedown"in document?"mousedown":"click",function(){return n._trigger("cancel"),!1}),this.addEventListener("show",function(){i.css({opacity:0,background:e.backdropBackground}).animate({opacity:e.backdropOpacity},150)}),this._esc=function(e){var t=e.target,i=t.nodeName;e=e.keyCode,a.current!==n||/^input|textarea$/i.test(i)&&"button"!==t.type||27===e&&n._trigger("cancel")},s(document).on("keydown",this._esc),this.addEventListener("remove",function(){s(document).off("keydown",this._esc),delete o.list[this.id]}),r++,o.oncreate(this),this}).prototype=i,s.extend(i,{content:function(e){var t=this._$("content");return"object"==(0,_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.Z)(e)?(e=s(e),t.empty("").append(e.show()),this.addEventListener("beforeremove",function(){s("body").append(e.hide())})):t.html(e),this.reset()},title:function(e){return this._$("title").text(e),this._$("header")[e?"show":"hide"](),this},width:function(e){return this._$("content").css("width",e),this.reset()},height:function(e){return this._$("content").css("height",e),this.reset()},button:function(e){e=e||[];var n=this,a="",o=0;return this.callbacks={},"string"==typeof e?(a=e,o++):s.each(e,function(e,t){var i=t.id=t.id||t.value;e="",n.callbacks[i]=t.callback,!1===t.display?e=' style="display:none"':o++,a+='<button type="button" i-id="'+i+'"'+e+(t.disabled?" disabled":"")+(t.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+t.value+"</button>",n._$("button").on("click","[i-id="+i+"]",function(e){s(this).attr("disabled")||n._trigger(i),e.preventDefault()})}),this._$("button").html(a),this._$("footer")[o?"show":"hide"](),this},statusbar:function(e){return this._$("statusbar").html(e)[e?"show":"hide"](),this},_$:function(e){return this._popup.find("[i="+e+"]")},_trigger:function(e){return"function"!=typeof(e=this.callbacks[e])||!1!==e.call(this)?this.close().remove():this}}),o.oncreate=s.noop,o.getCurrent=function(){return a.current},o.get=function(e){return void 0===e?o.list:o.list[e]},o.list={},o.defaults=t,o}),window.KG_Dialog=function e(t){return"object"==(0,_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.Z)(t=i[t])?t:(t.exports||(t.exports={},t.exports=t.call(t.exports,e,t.exports,t)||t.exports),t.exports)}("dialog")}(),100),toString=Object.prototype.toString,nextTick="function"==typeof _babel_runtime_corejs2_core_js_set_immediate__WEBPACK_IMPORTED_MODULE_4___default()?_babel_runtime_corejs2_core_js_set_immediate__WEBPACK_IMPORTED_MODULE_4___default():function(e){setTimeout(e,0)},isArray=Array.isArray||function(e){return"[object Array]"===toString.call(e)};function slice(e,t){var i=e.length,n=Array(i);for(t=t||0;i-- >t;)n[i-t]=e[i];return n}function carry(t,e){try{e.apply(null,slice(arguments,2))}catch(e){t(e)}}function defer(t,e){var i=slice(arguments,2);nextTick(function(){try{e.apply(null,i)}catch(e){t(e)}})}function Thenjs(e,t){if(e instanceof Thenjs)return e;if(!(this instanceof Thenjs))return new Thenjs(e,t);if(this._finally=this._error=this._fail=this._result=this._nextThen=this._chain=this._success=this._each=this._eachSeries=this._parallel=this._series=null,!arguments.length)return this;var i=genContinuation(this,t);try{"function"==typeof e?e(i):null==e?i():"function"==typeof e.toThunk?e.toThunk()(i):"function"==typeof e.then?e.then(function(e){i(null,e)},i):i(null,e)}catch(e){i(e)}}Thenjs.defer=defer,Thenjs.each=function(t,i,e){return thenFactory(function(e){defer(e,each,e,t,i)},null,e)},Thenjs.eachSeries=function(t,i,e){return thenFactory(function(e){defer(e,eachSeries,e,t,i)},null,e)},Thenjs.parallel=function(t,e){return thenFactory(function(e){defer(e,parallel,e,t)},null,e)},Thenjs.series=function(t,e){return thenFactory(function(e){defer(e,series,e,t)},null,e)},Thenjs.nextTick=function(e){var t=slice(arguments,1);nextTick(function(){e.apply(null,t)})},Thenjs.onerror=function(e){throw console.error("Thenjs caught error: ",e),e};var proto=Thenjs.prototype;function continuation(t){var i=this,e=arguments;if(!1!==i._result){!i._result&&i._chain&&i.debug.apply(i,["\nChain "+i._chain+": "].concat(slice(e))),i._result=!1;try{continuationExec(i,e,t)}catch(e){nextTick(function(){continuationError(i,e,t)})}}}function continuationExec(e,t,i){if(e._finally)return e._finally.apply(null,t);if(null!=i)throw i;if(i=e._success||e._each||e._eachSeries||e._parallel||e._series)return i.apply(null,slice(t,1));e._result=t}function continuationError(e,t,i){var n=e,a=e._error||e._fail;for(e._nextThen&&null==i&&(a=null,n=e._nextThen);!a&&n;)a=n._fail,n=n._nextThen;return a?a(t):Thenjs.onerror?Thenjs.onerror(t):void(n._result=[t])}function genContinuation(e,t){function i(){return continuation.apply(e,arguments)}return i._isCont=!0,t&&(proto.debug="function"==typeof t?t:defaultDebug,e._chain=1),i}function thenFactory(e,t,i){var n=new Thenjs;return e(i=genContinuation(n,i),t),t&&(t._nextThen=n,t._chain&&(n._chain=t._chain+1),t._result)&&nextTick(function(){continuation.apply(t,t._result)}),n}function wrapTaskHandler(e,t){return t._isCont?t:function(){t.apply(null,[e].concat(slice(arguments)))}}function parallelNext(i,n,a,o){function e(e,t){if(!a.finished)return null!=e?(a.finished=!0,i(e)):(n[o]=t,--a.i<0&&i(null,n))}return e._isCont=!0,e}function each(e,t,i){var n,a=[],o={};if(!isArray(t))return e(errorify(t,"each"));if(o.i=n=t.length-1,n<0)return e(null,a);for(var s=0;s<=n;s++)i(parallelNext(e,a,o,s),t[s],s,t)}function parallel(e,t){var i,n=[],a={};if(!isArray(t))return e(errorify(t,"parallel"));if(a.i=i=t.length-1,i<0)return e(null,n);for(var o=0;o<=i;o++)t[o](parallelNext(e,n,a,o),o,t)}function eachSeries(i,n,a){function o(e,t){return null!=e?i(e):(l[r]=t,++r>s?i(null,l):void(0<--c?carry:(c=maxTickDepth,defer))(i,a,o,n[r],r,n))}var s,r=0,l=[],c=maxTickDepth;return o._isCont=!0,isArray(n)?(s=n.length-1)<0?i(null,l):void a(o,n[0],0,n):i(errorify(n,"eachSeries"))}function series(i,n){function a(e,t){return null!=e?i(e):(r[s]=t,++s>o?i(null,r):void(0<--l?carry:(l=maxTickDepth,defer))(i,n[s],a,s,n))}var o,s=0,r=[],l=maxTickDepth;return a._isCont=!0,isArray(n)?(o=n.length-1)<0?i(null,r):void n[0](a,0,n):i(errorify(n,"series"))}function defaultDebug(){console.log.apply(console,arguments)}function errorify(e,t){return Error("The argument "+(e&&e.toString())+' in "'+t+'" is not Array!')}proto.fin=proto.all=proto.finally=function(i){return thenFactory(function(e,t){t._finally=wrapTaskHandler(e,i)},this)},proto.then=function(i,n){return thenFactory(function(e,t){t._success=wrapTaskHandler(e,i),t._error=n&&wrapTaskHandler(e,n)},this)},proto.fail=proto.catch=function(i){return thenFactory(function(e,t){t._fail=wrapTaskHandler(e,i),t._success=function(){e.apply(null,[null].concat(slice(arguments)))}},this)},proto.each=function(n,a){return thenFactory(function(i,e){e._each=function(e,t){each(i,n||e,a||t)}},this)},proto.eachSeries=function(n,a){return thenFactory(function(i,e){e._eachSeries=function(e,t){eachSeries(i,n||e,a||t)}},this)},proto.parallel=function(i){return thenFactory(function(t,e){e._parallel=function(e){parallel(t,i||e)}},this)},proto.series=function(i){return thenFactory(function(t,e){e._series=function(e){series(t,i||e)}},this)},proto.toThunk=function(){var t=this;return function(e){t._result?(e.apply(null,t._result),t._result=!1):!1!==t._result&&(t._finally=e)}},Thenjs.NAME="Thenjs",Thenjs.VERSION="1.3.4";var instance,root=window,KG=function(){function l(e,t){var i=w.length,n=e.constructor,n=E.is("Function",n)&&n.prototype||ObjProto,a="constructor";for(E.has(e,a)&&!_.contains(t,a)&&t.push(a);i--;)(a=w[i])in e&&e[a]!==n[a]&&!_.contains(t,a)&&t.push(a)}function s(e){for(var t,i=[],n=0;n<e.length;n++){var a={};a.type=R[Object.prototype.toString.call(e[n]).slice(8,-1)],a.value=e[n],i.push(a)}return t=i,t=_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5___default()(t),m?t.replace(/\\u([0-9a-fA-F]{2,4})/g,function(e,t){return String.fromCharCode(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(t,16))}):t}function c(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length}function t(e){this.map=e}function a(){}function e(e){this.name=e}function o(e,t){var i,n=0,a="";for(i in e){var o=e[i];if(null!=o){var s=function(e){0<n&&(a+=t),a+=i+"="+e,n++};if(E.is("Array",o))for(var r=0;r<o.length;r++)s(o[r]);else s(o)}}return j.trigger("formatData",a),a}function r(e,t){var i="";if(t=t||"",E.is("Array",e))for(var n=0;n<e.length;n++)0<n&&(i+=t),i+=o(e[n],t);else i=o(e,t);return i}function u(e,t){j.trigger.apply(j,["response",t].concat(this)),D(arguments,1),e&&e(t)}function g(e,t,i){return j.trigger.apply(j,["beforeAjax"].concat(D(arguments))),new(i?M:F?B:O)(e,t)}function d(e,t,i,n){j.trigger("beforeMethod",arguments);var a=Array.prototype.slice.call(arguments).slice(4),o={value:a=0==a.length?'{"MethodCall":{"caller":"'+t+'","function":"'+n+'"},"usercode":"'+i+'"}':'{"MethodCall":{"caller":"'+t+'","function":"'+n+'",'+(a='"params":'+s(a))+'},"usercode":"'+i+'"}'};return function(t){g(e+"/MethodCall",o,!1).getJSON(function(e){j.trigger("responseMethod",e),"none"!=e.type&&t(null,e.value||e)})}}function h(e,t,i){j.trigger("beforeAttr",arguments);var n=Array.prototype.slice.call(arguments).slice(3),a={value:n=0==n.length?'{"PropertyCall":{"caller":"'+t+'","property":"'+i+'"}}':'{"MethodCall":{"caller":"'+t+'","property":"'+i+'",'+(n='"params":'+s(n))+"}}"};return function(t){g(e,a,!0).getJSON(function(e){j.trigger("responseMethod",e),"none"!=e.type&&t(null,e.value)})}}function n(e,t){this.url=e,this.data=t,j.trigger("beforeAjaxJ",e,t)}function f(e){this.serverUrl=e,this.thenjs=Thenjs(function(e){e(null)})}var i,p,m=!1,v=(root.JSON&&(m='{"x":"中"}'!==root.JSON.stringify({x:"中"})),!!window.ActiveXObject||"ActiveXObject"in window),k=(c.prototype={clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)},toString:function(e){return(e||k).stringify(this)}},{stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var a=t[n>>>2]>>>24-n%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(n,2),16)<<24-n%8*4;return new c.init(i,t/2)}}),S=function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},b=function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c(i,t)},y={stringify:function(e){try{return decodeURIComponent(escape(S(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return b(unescape(encodeURIComponent(e)))}},C=(t.map={},t.of=function(e){return t.map[e=e||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="]||new t(e)},t.prototype={decodeByte:function(e){var t=e.length,i=this.map;(o=i.charAt(64))&&-1!=(o=e.indexOf(o))&&(t=o);for(var n,a,o=[],s=0,r=0;r<t;r++)r%4&&(n=i.indexOf(e.charAt(r-1))<<r%4*2,a=i.indexOf(e.charAt(r))>>>6-r%4*2,o[s>>>2]|=(n|a)<<24-s%4*8,s++);return new c(o,s)},decode:function(e){return y.stringify(this.decodeByte(e))},encode:function(e){if(e)return this.encodeByte(y.parse(e))},encodeByte:function(e){var t=e.words,i=e.sigBytes,n=this.map;e.clamp(),e=[];for(var a=0;a<i;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<i;s++)e.push(n.charAt(o>>>6*(3-s)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")}},!{toString:null}.propertyIsEnumerable("toString")),w="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" "),D=function(e,t){var i=e.length,n=[];for(t=t||0;i-- >t;)n[i-t]=e[i];return n},E={Utf8:y,Base64:t,slice:D,boolean:function(e,t,i){return!(e.hasOwnProperty(t)?!e[t]:!i)},rand:function(e){return Math.ceil((9301*(new Date).getTime()+49297)%233280/233280*e)},addEvent:(i=root.document.attachEvent,p="micromessenger"!=(I=navigator.userAgent.toLowerCase()).match(/MicroMessenger/i)&&"qq"!=I.match(/QQ/i)&&"weibo"!=I.match(/WeiBo/i)&&(null!=I.match(/Android/i)?null==I.match(/browser/i):null!=I.match(/iPhone/i)?null==I.match(/safari/i):null==I.match(/macintosh/i)&&null==I.match(/windows/i)),i?function(t,e,i){e=e.split(" ");for(var n=0;n<e.length;n++)t.attachEvent("on"+e[n],function(e){e.target=t,e.preventDefault=a,e.stopPropagation=a,i(e)})}:function(e,t,i){void 0===e.eventList&&(e.eventList={});for(var n=t.split(" "),a=0;a<n.length;a++){for(var o in e.eventList)if(o===n[a])return;p?e.addEventListener(n[a],i):document.addEventListener.apply(e,[n[a]].concat(E.slice(arguments,2))),e.eventList[n[a]]=!0}}),extend:function(e){var t=arguments.length;if(!(t<2||null==e))for(var i=1;i<t;i++)for(var n=arguments[i],a=function(e){if(!E.is("Object",e))return[];var t=[],i;for(i in e)t.push(i);return C&&l(e,t),t}(n),o=a.length,s=0;s<o;s++){var r=a[s];e[r]=n[r]}return e},filter:function(e,t){var i,n,a={},o=t;for(n in E.is("String",t)&&(i=E.slice(arguments,1),o=function(e){for(var t=0;t<i.length;t++)if(i[t]===e)return!1;return!0}),e)(i=o.call(e,n))&&(a[n]=e[n]);return a},convertText:function(e){for(var t="",i=0;i<e.length;i++)t+=e[i].replace(/(\S)/gi,"<span>$1</span>").replace(/\n|\r/gi,"<span><br></span>").replace(/\s/gi,"<span>&nbsp;</span>");return t},handleEdittable:function(n,e){var a=[],o=0,s=0;return $.each(n.find("span"),function(e,t){var i={};"<br>"==(e=$(t).text()||$(t).html())&&(o=0,s=v?s+$(t).height()/2:s+$(t).height(),e=""),0==s&&(s=$(t).height()),o>=n.width()-$(t).width()&&(o=0,s+=$(t).height()),i.txt=e,i.left=o,i.top=s,a.push(i),""!=e&&(o+=$(t).width())}),a},val:function(e,t){var i;return E.is("Function",e)?(i=arguments.length<3?[]:[].slice.call(arguments).slice(2),e.apply(t,i)):e},$:function(e){var t,i=document.getElementById(e);return i||(t=document.getElementsByName(e))&&0<t.length&&(i=t[0]),i||(t=document.getElementsByTagName(e))&&0<t.length&&(i=t[0]),i},keys:function(e){if(!E.is("Object",e))return[];if(nativeKeys)return nativeKeys(e);var t,i=[];for(t in e)E.has(e,t)&&i.push(t);return C&&l(e,i),i},contains:function(e,t,i){var n=e&&e.length;return"number"==typeof n&&0<=n&&n<=MAX_ARRAY_INDEX||(e=_.values(e)),0<=_.indexOf(e,t,"number"==typeof i&&i)},values:function(e){for(var t=_.keys(e),i=t.length,n=Array(i),a=0;a<i;a++)n[a]=e[t[a]];return n},has:function(e,t){return null!=e&&Object.prototype.hasOwnProperty.call(e,t)},inherit:function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i,(e.prototype.constructor=e).uber=t.prototype},is:function(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&i===e},colorRgb:function(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if((e=e.toLowerCase())&&t.test(e)){if(4===e.length){for(var i="#",t=1;t<4;t+=1)i+=e.slice(t,t+1).concat(e.slice(t,t+1));e=i}for(i=[],t=1;t<7;t+=2)i.push(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()("0x"+e.slice(t,t+2)));return"RGB("+i.join(",")+")"}return e},colorHex:function(e){if(/^(rgb|RGB)/.test(e)){for(var t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",n=0;n<t.length;n++){var a=Number(t[n]).toString(16);"0"===a&&(a+=a),i+=a}return(i=7!==i.length?e:i).toUpperCase()}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)&&6!==(t=e.replace(/#/,"").split("")).length&&3===t.length)for(e="#",n=0;n<t.length;n+=1)e+=t[n]+t[n];return e.toUpperCase()},dateConvert:function(e,t){var i=["零一二三四五六七八九".split(""),"〇一二三四五六七八九".split("")],n="";if(null!=(e=e.match(/^(\d{2}|\d{4})(\u5e74)(\d{1,2})(\u6708)(\d{1,2})(\u65e5)$/))){for(var a=1;a<e.length;a+=2){var o=e[a];if(2==o.length)o="1"==o.charAt(0)?"0"==o.charAt(1)?"十":"十"+i[t-1][o.charAt(1)]:"0"==o.charAt(1)?i[t-1][o.charAt(0)]+"十":i[t-1][o.charAt(0)]+"十"+i[t-1][o.charAt(1)];else{for(var s="",r=0;r<o.length;r++)s+=i[t-1][o.charAt(r)];o=s}n+=o+e[a+1]}return n}},formatDate:function(e,t){var i,n="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[e.getMonth()],a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(MMM)/.test(t)&&(t=t.replace(RegExp.$1,"$")),a)new RegExp("("+i+")").test(t)&&(e=a[i],2==RegExp.$1.length&&(e=("00"+a[i]).substr((""+a[i]).length)),t=t.replace(RegExp.$1,e));return t=t.replace("$",n),/[*]/gi.test(t)&&(n=t.replace(/[*]/gi,""),t=this.dateConvert(n,t.length-n.length)),t},template:function(e,t){for(var i,n=/<%([^%>]+)?%>/g,a=/(^( )?(var|if|for|else|switch|case|break|{|}))(.*)?/g,o="var r=[];\n",s=0,r=function e(t,i){return o+=i?t.match(a)?t+"\n":"r.push("+t+");\n":""!=t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",e};i=n.exec(e);)r(e.slice(s,i.index))(i[1],!0),s=i.index+i[0].length;return r(e.substr(s,e.length-s)),o+='return r.join("");',new Function(o.replace(/[\r\t\n]/g,"")).apply(t,D(arguments,2))},first:function(e,t){return e.substring(0,1)[t?"toLowerCase":"toUpperCase"]()+e.substring(1)},html2Escape:function(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})},conversion_getDPI:function(){var e,t=[];return window.screen.deviceXDPI?(t[0]=window.screen.deviceXDPI,t[1]=window.screen.deviceYDPI):((e=document.createElement("DIV")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(e),t[0]=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.offsetWidth),t[1]=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.offsetHeight),e.parentNode.removeChild(e)),t},pxConversionMm:function(e){return e/this.conversion_getDPI()[0]*25.4},eosFormatTime:function(e){var t=e.split(" ")[0],i=e.split(" ")[1].split(":");return e=i.slice(1,i.length).join(":"),t+" "+((i=((i=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i[0])+8)<24?i:i%24).toString())<10?"0"+i:i)+":"+e}},L={result:!(e.prototype={on:function(e,t){return this.__getEventListener(e).push(t),this},off:function(e,t){e=this.__getEventListener(e);for(var i=0;i<e.length;i++)t===e[i]&&e.splice(i--,1);return this},clear:function(e){return 0<this.__getEventListener(e).length&&(this.__listener[e]=[]),this},trigger:function(e){var t,i=this.__getEventListener(e),n=Array.prototype.slice.call(arguments);this["on"+e]&&(t=this["on"+e].apply(this,n.slice(1)));for(var a=0;a<i.length;a++)i[a].apply(this,n.slice(1));return t},__getEventListener:function(e){var t=this.__listener;return(t=t||(this.__listener={}))[e]||(t[e]=[]),t[e]}}),errcode:"interErr"},A={result:!1,errcode:"responseErr"},x={result:!1,errcode:"connectionErr"},P={result:!1,errcode:"parseErr"},T={result:!1,errcode:"timeoutErr"},M=function(e,t){this.url=e,this.data=t,j.trigger("beforeJSONP",e,t)},I=M.prototype,B=(I.parseData=function(){var e="",t=this.data;if(E.is("String",t))e=t;else if(E.is("Object",t))for(var i in t)t[i]&&(e+="&"+i+"="+encodeURIComponent(t[i]));else if(E.is("Array",t))for(var n=0;n<t.length;n++){var a=t[n];for(i in a)a[i]&&(e+="&"+i+"="+encodeURIComponent(a[i]))}return e=(e=(e+="&hookback="+this.name)+("&_="+(new Date).getTime())).substr(1),j.trigger("parseData",e),e},I.getJSON=function(t){function e(){setTimeout(function(){clearTimeout(r),s.parentNode.removeChild(s);try{delete window[o]}catch(e){}},1)}var i=this,n=i.url,a=i.data,o=this.name="jsonp_"+(new Date).getTime()+"_"+E.rand(1e5),n=n+(-1===n.indexOf("?")?"?":"&")+this.parseData(a),s=document.createElement("script"),r=(s.type="text/javascript",s.src=n,s.id=o,s.charset="utf-8",window[o]=function(e){i._execed=!0,u.call(i,t,e)},s.onload=function(){e(),i._execed||u.call(i,t,P)},s.onerror=function(){e(),void 0!==Signature.options.isResponseErr&&Signature.options.isResponseErr||u.call(i,t,A)},setTimeout(function(){e(),u.call(i,t,T)},U.options.timeout));(n=document.getElementsByTagName("head"))&&n[0]&&n[0].appendChild(s)},function(e,t){this.url=e,this.data=t,this.xdr=new XDomainRequest}),O=(B.prototype.getJSON=function(t){var i=this.xdr;i.onload=function(){try{var e=JSON.parse(i.responseText)}catch(e){return void u.call(i,t,P)}u.call(i,t,e)},i.onerror=function(){u.call(i,t,x)},i.timeout=U.options.timeout,i.ontimeout=function(){u.call(i,t,T)},i.open("POST",this.url),i.send(r(this.data,"\r\n"))},function(e,t){if(window.XMLHttpRequest)var i=new XMLHttpRequest;else if(window.ActiveXObject)for(var n=0;n<activexName.length;n++)try{i=new ActiveXObject(activexName[n]);break}catch(e){}this.xhr=i,this.url=e,this.data=t}),F=(O.prototype.getJSON=function(t){var i=this.xhr,n=!1,e=(i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status||304==i.status)try{var e=JSON.parse(i.responseText);u.call(i,t,e)}catch(e){u.call(i,t,P)}else n&&u.call(i,t,A)},i.open("POST",this.url,!0),i.onerror=function(){u.call(i,t,x)},i.timeout=U.options.timeout,i.ontimeout=function(){n=!0,u.call(i,t,T)},i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),r(this.data,"\r\n"));i.send(e)},XMLHttpRequest.prototype._send=function(e){Signature.setRequestHeader(this),this.send(e)},Function.prototype.before=function(e){var t=this;return function(){return e.apply(this,arguments),t.apply(this,arguments)}},XMLHttpRequest.prototype.send=XMLHttpRequest.prototype.send.before(function(){Signature.setRequestHeader(this)}),!("withCredentials"in XMLHttpRequest.prototype)&&"undefined"!=typeof XDomainRequest),R={Boolean:"BOOL",String:"BSTR",Number:"LONG"},U=function(){},j=(U.errCode={1e4:"系统错误",20001:"密钥盘信息错误",20003:"密码错误，请输入正确密码",20004:"请输入密码!",11100:"签章服务器错误",111e3:"当前用户没有签章",111001:"该用户没有公章",111002:"该用户没有私章",111003:"该用户没有法人章",111004:"该用户没有法人签名印章",111005:"该用户没有手写签名印章",11101:"当前用户没有签章",11102:"印章错误",11103:"证书过期",11104:"印章过期",11105:"获取签章信息失败!",11106:"获取证书信息失败!",11107:"未搜索到您要的签章!",11108:"未设置签章密码!",11109:"操作失败，签章助手未启用或未授权",11110:"操作失败，请拔掉当前钥匙盘再进行操作",11111:"允许移动失败，请使用原签章密钥允许移动！",11112:"允许移动失败，该签章数据没有允许移动请求权限！",11113:"您的浏览器不支持手写签名。",11114:"请插入当前签章所属密钥盘",11115:"当前用户没有操作该签章权限",none:"客户端未知异常!",signErr:"签名失败",serverErr:"调用产品组件异常",parseErr:"数据格式异常",responseErr:"产品组件响应异常",connectionErr:"产品组件连接异常",timeoutErr:"请求响应超时",interErr:"获取接口异常","-7":"签名组件错误"},E.extend(U.errCode,{then:{"-1":"请安装客户端","-2":"请插入当前签章所属的密钥盘","-3":"未安装手机盾组件","-12":"获取证书失败","-13":"签名时，加载证书失败","-15":"签名数据不能为空","-16":"密码不能为空","-17":"解析证书失败","-18":"未安装手机盾组件","-19":"手机盾登录失败",1:"没有检测到密钥盘",2:"密钥盘没有正确初始化",3:"密钥盘驱动未安装",4:"只能插入一个密钥盘",7:"密码错误或密钥盘被锁定",8:"非法授权",9:"网络连接失败",10:"手机盾登录失败",11:"当前密钥盘没有印章",12:"获取印章信息失败",35:"钥匙盘未生效，不能签章！",36:"钥匙盘已过期，不能签章！",37:"授权信息结构非法！",38:"签章证书已经过期或还未生效！",39:"签章证书不受颁发机构信任！",40:"签章证书已被吊销！",41:"签章证书根证书未安装或无效的根证书！",42:"吊销列表文件不存在",43:"未检测到证书",44:"根证书文件不存在",45:"根证书和该证书的根证书不配套",46:"吊销列表和该证书的吊销列表不配套","-101":"获取密钥盘有效期异常","-103":"密钥盘未生效","-104":"期限许可已过期","-999":"金格组件未知错误","30001@gm":"验证电子印章失败：验证电子印章签名值失败！","30002@gm":"验证电子印章失败：验证电子印章制章人证书有效期失败！","30003@gm":"验证电子印章失败：验证电子印章的有效期失败！","30004@gm":"验证电子印章失败：验证签章人证书有效性失败！","30005@gm":"验证电子印章失败：验证电子签章数据失败！","-7@KGCrySignMessage":"签名组件错误","8@KGVerifySign":"验证失效","1@KGVerifySign":"未安装签名组件","2@KGCrySignMessage":"获取证书失败","3@KGCrySignMessage":"签名时，加载证书失败","5@KGCrySignMessage":"签名数据不能为空","6@KGCrySignMessage":"密码不能为空","7@KGCrySignMessage":"解析证书失败"},KGRunFingerPrints:{"-1":"设备类型设置错误","-2":"没有安装指纹组件","-3":"指纹采集失败"},KGRunHandWritten:{"-1":"设备类型设置错误","-2":"没有安装手写组件","-3":"授权码不正确","-4":"签名取消","-5":"无服务可用","-6":"签名设备错误","-7":"未知错误"},KGGetTSWithDigest:{1:"获取时间戳异常",2:"获取时间戳失败",3:"响应数据为空"},KGGetTSURLInfo:{1:"时间戳未启用"},KGValidate_GM:{"-1":"没有安装签名组件","-2":"没有公共模块组件","-3":"KCL280 验证失败，未知原因的验证失败",1:"KCL272_验证签章人证书失败，签章人证书已过期或未生效！",2:"KCL274 验证签章人证书失败，签章人证书根证书验证未通过!",3:" KCL270_验证签章人证书失败，签章人证书已被吊销！",4:" KCL276 验证签章人证书失败，签章人证书根证书安装未成功!",5:" KCL266_验证签章人证书失败，未检测到签章人证书吊销列表！",6:"KCL260_验证签章人证书失败，未检测到签章人证书！",7:"KCL262_验证签章人根证书失败，未检测到签章人根证书！",8:"KCL264_验证签章人根证书失败，签章人证书与该证书的根证书不匹配！",9:"KCL268_验证签章人证书失败，签章人证书与该证书吊销列表不匹配！",10:"KCL273_验证制章人证书失败，制章人证书已过期或未生效",11:"KCL275 验证制章人证书失败，制章人证书根证书验证未通过!",12:"KCL271_验证制章人证书失败，制章人证书已被吊销！",13:"KCL277_验证制章人证书失败，制章人证书根证书安装未成功!",14:"KCL267_验证制章人证书失败，未检测到制章人证书吊销列表！",15:"KCL281_验证制章人证书失败，未检测到制章人证书！",16:"KCL263_验证制章人根证书失败，未检测到制章人根证书！",17:"KCL265_验证制章人根证书失败，制章人证书与该证书的根证书不匹配！",18:"KCL269_验证制章人证书失败，制章人证书与该证书吊销列表不匹配！",19:"KCL261_验证签章人证书失败，签章人证书不在印章的签章人证书列表中！",20:"KCL278_验证印章制章时间失败，印章未生效！",21:"KCL279 验证印章制章时间失败，印章已经过期！"},KGValidateCertificate:{"-1":"没有安装签名组件","-2":"未知错误",1:"验证失败，签章证书已经过期或还未生效！",2:"验证失败，签章证书不受颁发机构信任！",3:"验证失败，签章证书已被吊销！",4:"验证失败，签章证书根证书未安装或无效的根证书！",5:"验证失败，吊销列表文件不存在！",6:"验证失败，未检测到证书！",7:"验证失败，根证书文件不存在！",8:"验证失败，根证书和该证书的根证书不配套！",9:"验证失败，吊销列表和该证书的吊销列表不配套！"},KG_MSG:{in_input_msg:"请输入密码！",in_verification_msg:"请输入验证码！",timestamp_time:"(时间来源于时间戳服务器)",server_time:"(时间来源于签章服务器)",local_time:"(时间来源于本地)",modify_signdata:"签名数据被篡改",normal_signdata:"签名数据验证正常",success_signdata:"数字签名成功！",invalid_signdata:"签章无效，不能执行数字签名！",cannot_move:"这个印章不是你当前插入的key的印章，不能移动！"},KG_TITLE:{SignatureMoveNot:"禁止移动",SignatureMoveDo:"允许移动",SignSignature:"数字签名",SignVerify:"签名验证",SignatureVerify:"签章验证",RevokeSignature:"撤销签章",KinggridSignature:"电子签章",DateSet:"日期设置",HWSignature:"手写签批",scanBCSignature:"扫码签章",moveSignature:"移动签章",ProtectedDataSet:"保护项设置"},KGVerifyGBSealAction:{"-1":"服务器通讯失败",1:"印章结构体为空",2:"印章状态无效",3:"解析异常",4:"印章已删除",5:"印章未制作",6:"印章已冻结"},KGfontColor:{"黑":"black","红":"red","蓝":"blue","绿":"green"}}),U.msg=function(e,t){return U.errCode[e]||(t?U.errCode[t]:U.errCode)[e]||e},U.options={_version:"1.0",timeout:2e4},U.Utils=E,U.Listener=e,n.prototype.getJSON=function(n){var a=this;$.ajax({url:this.url,contentType:"text/plain;charset=utf-8",type:"POST",data:r(this.data,"\r\n"),success:function(e){u.call(a,n,e)},error:function(e,t,i){u.call(a,n,x)}})},Thenjs.onerror=function(e){if(!E.is("String",e))throw e;alert("[error]"+e)},(I=f.prototype).init=function(e,t,i){return this.progid=e,this.interid=t,this.clientCode=i,this},I.fail=function(n){var a=this;return a.thenjs=a.thenjs.fail(function(e,t){var i=n.call(a,e,t);e(a.respData(null==i?t:i))}),a},I.fin=function(n){var a=this;return a.thenjs=a.thenjs.fin(function(e,t,i){n.call(a,e,t,i)}),a},I.then=function(t){var n=this;return n.thenjs=n.thenjs.then(function(i,e){t.call(n,function(e,t){n.respData(t),i(e,t)},e)}),n},I.series=function(e){return this.thenjs=this.thenjs.series(e),this},I.calArgs=function(e){for(var t=this._data,i=[],n=0;n<e.length;n++){var a=e[n];E.is("Function",a)&&(a=a.call(this,t)),E.is("Array",a)?i=i.concat(a):i.push(a)}return i},I.msg=function(e,t,i,n){return t=t||this._method,i=i||this.progid,n=U.errCode.then,j.trigger("msgArg",e,t,i),U.errCode[e]||n[e+"@"+t+"."+i]||n[e+"@"+t]||n[e]||e},I.ret=function(n){var a=this;return this.then(function(e,t){var i=n.call(a,t);e(null,a.respData(null==i?t:i))}),this},I.respData=function(e){return e&&(this._data=e),this._data},I.attr=function(e){var i=this,n=D(arguments);return i.series([function(e){var t=i.calArgs(n);i._method=t[0],h.apply(null,[i.serverUrl,i.proid].concat(t))(e)}]).then(function(e,t){e(null,i.respData(t[0]))}),this},I.attrSeries=function(){var i=this,e=[];i.initProid();for(var t=0;t<arguments.length;t++)e.push(function(){var t=i.calArgs(arguments);return function(e){i._method=t[0],h.apply(null,[i.serverUrl,i.proid].concat(t))(e)}}.apply(null,arguments[t]));return i.series(e).then(function(e,t){i.respData(t),e(null,t)}),this},I.initProid=function(){var i=this;return this.series([function(e,t,i,n){j.trigger("beforeProg",arguments);var a={value:'{"GetInterface":{"progid":"'+t+'","interface":"'+i+'"},"usercode":"'+n+'"}'};return function(t){g(e+"/GetInterface",a,!1).getJSON(function(e){j.trigger("resonseProg",e),"none"==e.type?t(null,A):"0"===e.value?t(null,L):t(null,e)})}}(i.serverUrl,i.progid,i.interid,i.clientCode)]).then(function(e,t){t=t[0],j.trigger("initProid",t),t.value?(i.proid=t.value,e(null,t)):e(t.errcode)}),this},I.invokeSeries=function(){var i=this,e=[];i.initProid();for(var t=0;t<arguments.length;t++)e.push(function(){var t=i.calArgs(arguments);return function(e){i._method=t[0],d.apply(null,[i.serverUrl,i.proid,i.clientCode].concat(t))(e)}}.apply(null,arguments[t]));return i.series(e).then(function(e,t){i.respData(t),e(null,t)}),this},I.invoke=function(e){var i=this,n=(i.initProid(),D(arguments));return i.series([function(e){var t=i.calArgs(n);i._method=t[0],d.apply(null,[i.serverUrl,i.proid,i.clientCode].concat(t))(e)}]).then(function(e,t){i.respData(t[0]),e(null,t[0])}),this},I.request=function(e,t){var i=this;return i.series([function(e,i){return j.trigger("ajaxRequest",arguments),U.ajax?function(t){new n(e,i).getJSON(function(e){t(null,e)})}:function(t){g(e,i,!1).getJSON(function(e){t(null,e)})}}(i.serverUrl+e,t)]).then(function(e,t){t=t[0],i.respData(t),e(null,t)}),this},new e("kgthen"));return U.addRequestListener=function(e,t){j.on(e,t)},U.surry=function(e,t,i,n){return new f(e||"http://127.0.0.1:9581").init(t,i,n)},U.KgThen=f,U};function KGInstance(){return instance=null==instance?new KG:instance}root.kinggrid=KGInstance();var Utils=kinggrid.Utils,config=kinggrid.options,isIE8=!1,dialog=(root.JSON&&(isIE8='{"x":"中"}'!==root.JSON.stringify({x:"中"})),root.KG_Dialog),dialogConfig=(dialog&&dialog.create&&(dialog.create.prototype.button=function(e){e=e||[];var n=this,a="",o=0;return this.callbacks={},"string"==typeof e?(a=e,o++):$.each(e,function(e,t){var i=t.id=t.id||t.value;"cancel"==i&&(t.value="取消"),e="",n.callbacks[i]=t.callback,!1===t.display?e=' style="display:none"':o++,a+='<button type="button" i-id="'+i+'"'+("cancel"==i?' class="kg-default-btn-red" ':"")+e+(t.disabled?" disabled":"")+(t.autofocus?isIE8?' class="ui-dialog-autofocus kg-primary-btn-red"':' autofocus class="ui-dialog-autofocus kg-primary-btn-red"':"")+">"+t.value+"</button>",n._$("button").on("click","[i-id="+i+"]",function(e){$(this).attr("disabled")||n._trigger(i),e.preventDefault()})}),this._$("button").html(a),this._$("footer")[o?"show":"hide"](),this}),{okValue:"确定",cancelValue:"关闭",modal:!0,fixed:!0,backdropOpacity:.2,skin:"kg-ui-dialog"}),toBase64Img=function(e){var t=e.imgdata;return 0==t.indexOf(e.signsn)&&(t=e.imgdata.substring(65)),Utils.Base64.of().encodeByte(Utils.Base64.of(e.signsn).decodeByte(t))},dialogList={},createDialog,createDialog=function(e,t){return t.id=e,(void 0!==root.iframeDialog&&root.iframeDialog?root.top:root).KG_Dialog(t)},kingDialog=function e(t,i){var n=this;if(!(n instanceof e))return new e(t,i);var a=Utils.extend({},plus.dialogConfig,i),o=a.onOk,s=(o&&(delete a.onOk,a.ok=function(){return o.call(n)}),a.onCancel);s&&(delete a.onCancel,a.cancel=function(){return s.call(n)}),n.init(t,a),n.options=i,n.id=t},dialogProto=kingDialog.prototype,Switcher=(dialogProto.init=function(e,t){return this[0]=createDialog(e,t),this},dialogProto.on=function(e,t){this[0]["on"+e]=t},dialogProto.show=function(e){return this.options.iconClose&&this[0]._$("close").hide(),this.options.onShow&&this.options.onShow.call(this),this[0].show(),this},dialogProto.remove=function(){this[0].remove(),delete this[0]},dialogProto.close=function(){return this[0].close(),this},dialogProto.content=function(e){return this[0].content(e),this[0].reset(),this},dialogProto.find=function(e){return this[0]._popup.find(e)},Thenjs.onerror=function(e){if(plus.hideLoading(),!Utils.is("String",e))throw e;"client"==Signature.options.sealType&&Signature.options.isResponseErr&&"connectionErr"==e?console.warn(kinggrid.msg(e,"then")):Signature.options.errorCall?Signature.options.errorCall.call(null,{result:!1,errcode:e}):plus.alert(kinggrid.msg(e,"then"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})},function(e,t){var i=this;i.target=$(e),t&&$.each(t,function(e,t){"function"==typeof i[e]?i[e](t):i[e]=t}),i.init()}),Tab=(Utils.extend(Switcher.prototype,{running:!1,index:0,animate:!0,init:function(){var e=this.target,t=this.wrapper=e.find(".kg-wrapper"),i=this.guide=e.find(".kg-guide"),e=t.children(".kg-slide"),n=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.css("height")),a=e.outerWidth(!0);t.css({height:n,width:e.length*a}),this.count=e.length,n=(t=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(this.index,10)||0)+1,e.each(function(e){this.setAttribute("index",e),i.append('<span index="'+e+'"></span>')}),this.guide.html(n+"/"+this.count),this._active(t)},_active:function(e){var t=this.index;this.wrapper.children().eq(t).removeClass("active"),this.guide.children().eq(t).removeClass("active"),this.wrapper.children().eq(e).addClass("active"),this.guide.children().eq(e).addClass("active"),this.index=e,this.guide.html(e+1+"/"+this.count)},to:function(e){var t,i=this;i.running||(t=e%this.count)!=i.index&&(i.running=!0,e=i.wrapper.children().eq(t),e=-t*e.outerWidth(!0),this.animate?this.wrapper.animate({left:e},100,function(){i._active(t),i.running=!1}):(this.wrapper.css({left:e}),i._active(t),i.running=!1))},swipePrev:function(){var e=this.index-1;e<0&&(e=this.wrapper.children().length-1),this.to(e)},swipeNext:function(){var e=this.index+1,t=this.wrapper.children().length;this.to(e=t<e+1?0:e)}}),Utils.Switcher=Switcher,function(e){this.target=e;var t=this.nav=this.target.find(".kg-nav");this.content=this.target.find(".kg-tab-content"),e=this.items=t.children(),0==(t=t.children(".active")).length&&(t=e.eq(0)),this._getClassName(),this.active(t),this.init()}),plus=(Tab.prototype={active:function(e){this.activeLi&&(this.activeContent.removeClass("active"),this.activeLi.removeClass("active")),e.addClass("active");var t=e.children("a").attr("kg-target");this.target.find(".kg-nav li a").each(function(){$(this).removeClass(this.className)}),e.children("a").addClass(this.className),(t=this.target.find("."+t)).addClass("active"),this.activeLi=e,this.activeContent=t},init:function(){var t=this;this.target.find(".kg-nav li").click(function(e){e.preventDefault(),(e=$(this)).hasClass("active")||t.active(e)}),t._location()},_location:function(){var i=this.items.length,e=document.body.clientWidth,n=Signature.options.isMobile&&e<375?e:430;this.items.each(function(e,t){e=$(t).width(),e=(n-e*i)/2,$(t).offset({left:e})})},_getClassName:function(){var e=this;this.target.find(".kg-nav li a").each(function(){e.className=$(this).attr("class")})}},Utils.tab=function(e){return new Tab(e)},{dialogConfig:dialogConfig,alertConfig:{},loadingConfig:{}}),internationalization=Utils.internationalization=function(){try{$("[i-id=cancel]").html($.kgi18n.prop("Close")),$("[data-kgi18n-html]").each(function(e){$(this).html($.kgi18n.prop($(this).data("kgi18n-html"))),$(this).addClass("kg-fontFamily")}),$("[data-kgi18n-value]").each(function(e){$(this).val($.kgi18n.prop($(this).data("kgi18n-value"))),$(this).addClass("kg-fontFamily")}),$("[data-kgi18n-title]").each(function(e){$(this).attr("title",$.kgi18n.prop($(this).data("kgi18n-title"))),$(this).addClass("kg-fontFamily")}),$(".kg-default-btn-red").each(function(){$(this).addClass("kg-fontFamily")}),$(".kg-primary-btn-red").each(function(){$(this).addClass("kg-fontFamily")}),$(".kg-default-btn-blue").each(function(){$(this).addClass("kg-fontFamily")}),$(".kg-primary-btn-blue").each(function(){$(this).addClass("kg-fontFamily")}),$(".kg-tab-content").find(".kg-label").each(function(e){$(this).removeClass().addClass("kg-label").addClass(Signature.options.Global+"-label")}),$(".kg-tab-content").find(".kg-value").each(function(e){$(this).removeClass().addClass("kg-value").addClass(Signature.options.Global+"-value")});var e=$("[data-kgi18n-html=SignatureDate]").next().html();if(e)for(var t=e.indexOf("("),i=e.substring(t),n="(时间来源于时间戳服务器);(時間來源於時間戳服務器);(The time comes from the timestamp server);(时间来源于签章服务器);(時間來源於簽章服務器);(Time comes from signature server);(时间来源于本地);(時間來源於本地);(Time comes from local)".split(";"),a=0;a<n.length;a++)i==n[a]&&(e=a<3?e.substring(0,t)+$.kgi18n.prop("KG_MSGtimestamp_time"):3<=a&&a<6?e.substring(0,t)+$.kgi18n.prop("KG_MSGserver_time"):e.substring(0,t)+$.kgi18n.prop("KG_MSGlocal_time"),$("[data-kgi18n-html=SignatureDate]").next().html(e))}catch(e){}},showCacheDialog=function(e,t,i){var n,a=dialogList[e];return a||((n=i.okCall)&&delete i.okCall,i=Utils.extend({onOk:function(){var e=!0;return(e=n?0!=n.call(this):e)&&this.close().remove(),!1},cancel:!1},i),a=dialogList[e]=plus.showDialog(e,i)),a.on("remove",function(){delete dialogList[e]}),a.content(t),internationalization(),a},template=(plus.alert=function(e,t,i){return t=Utils.extend({title:$.kgi18n.prop("OtherInfoTip"),onShow:function(){return Signature.editThemeColor(),i},okCall:t},plus.alertConfig),showCacheDialog("alert",'<div class="kg-dialog kg-alert" ><i class="kg-icon kg-icon-attention-circled"></i>'+e+"</div>",t)},plus.showLoading=function(e){return e=Utils.extend({onOk:!1},plus.loadingConfig),showCacheDialog("loading",'<div class="kg-loading"><img title="加载中..." src="data:image/gif;base64,R0lGODlhIAAgALMAAP///7Ozs/v7+9bW1uHh4fLy8rq6uoGBgTQ0NAEBARsbG8TExJeXl/39/VRUVAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQAAACwAAAAAIAAgAAAE5xDISSlLrOrNp0pKNRCdFhxVolJLEJQUoSgOpSYT4RowNSsvyW1icA16k8MMMRkCBjskBTFDAZyuAEkqCfxIQ2hgQRFvAQEEIjNxVDW6XNE4YagRjuBCwe60smQUDnd4Rz1ZAQZnFAGDd0hihh12CEE9kjAEVlycXIg7BAsMB6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YEvpJivxNaGmLHT0VnOgGYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHQjYKhKP1oZmADdEAAAh+QQFBQAAACwAAAAAGAAXAAAEchDISasKNeuJFKoHs4mUYlJIkmjIV54Soypsa0wmLSnqoTEtBw52mG0AjhYpBxioEqRNy8V0qFzNw+GGwlJki4lBqx1IBgjMkRIghwjrzcDti2/Gh7D9qN774wQGAYOEfwCChIV/gYmDho+QkZKTR3p7EQAh+QQFBQAAACwBAAAAHQAOAAAEchDISWdANesNHHJZwE2DUSEo5SjKKB2HOKGYFLD1CB/DnEoIlkti2PlyuKGEATMBaAACSyGbEDYD4zN1YIEmh0SCQQgYehNmTNNaKsQJXmBuuEYPi9ECAU/UFnNzeUp9VBQEBoFOLmFxWHNoQw6RWEocEQAh+QQFBQAAACwHAAAAGQARAAAEaRDICdZZNOvNDsvfBhBDdpwZgohBgE3nQaki0AYEjEqOGmqDlkEnAzBUjhrA0CoBYhLVSkm4SaAAWkahCFAWTU0A4RxzFWJnzXFWJJWb9pTihRu5dvghl+/7NQmBggo/fYKHCX8AiAmEEQAh+QQFBQAAACwOAAAAEgAYAAAEZXCwAaq9ODAMDOUAI17McYDhWA3mCYpb1RooXBktmsbt944BU6zCQCBQiwPB4jAihiCK86irTB20qvWp7Xq/FYV4TNWNz4oqWoEIgL0HX/eQSLi69boCikTkE2VVDAp5d1p0CW4RACH5BAUFAAAALA4AAAASAB4AAASAkBgCqr3YBIMXvkEIMsxXhcFFpiZqBaTXisBClibgAnd+ijYGq2I4HAamwXBgNHJ8BEbzgPNNjz7LwpnFDLvgLGJMdnw/5DRCrHaE3xbKm6FQwOt1xDnpwCvcJgcJMgEIeCYOCQlrF4YmBIoJVV2CCXZvCooHbwGRcAiKcmFUJhEAIfkEBQUAAAAsDwABABEAHwAABHsQyAkGoRivELInnOFlBjeM1BCiFBdcbMUtKQdTN0CUJru5NJQrYMh5VIFTTKJcOj2HqJQRhEqvqGuU+uw6AwgEwxkOO55lxIihoDjKY8pBoThPxmpAYi+hKzoeewkTdHkZghMIdCOIhIuHfBMOjxiNLR4KCW1ODAlxSxEAIfkEBQUAAAAsCAAOABgAEgAABGwQyEkrCDgbYvvMoOF5ILaNaIoGKroch9hacD3MFMHUBzMHiBtgwJMBFolDB4GoGGBCACKRcAAUWAmzOWJQExysQsJgWj0KqvKalTiYPhp1LBFTtp10Is6mT5gdVFx1bRN8FTsVCAqDOB9+KhEAIfkEBQUAAAAsAgASAB0ADgAABHgQyEmrBePS4bQdQZBdR5IcHmWEgUFQgWKaKbWwwSIhc4LonsXhBSCsQoOSScGQDJiWwOHQnAxWBIYJNXEoFCiEWDI9jCzESey7GwMM5doEwW4jJoypQQ743u1WcTV0CgFzbhJ5XClfHYd/EwZnHoYVDgiOfHKQNREAIfkEBQUAAAAsAAAPABkAEQAABGeQqUQruDjrW3vaYCZ5X2ie6EkcKaooTAsi7ytnTq046BBsNcTvItz4AotMwKZBIC6H6CVAJaCcT0CUBTgaTg5nTCu9GKiDEMPJg5YBBOpwlnVzLwtqyKnZagZWahoMB2M3GgsHSRsRACH5BAUFAAAALAEACAARABgAAARcMKR0gL34npkUyyCAcAmyhBijkGi2UW02VHFt33iu7yiDIDaD4/erEYGDlu/nuBAOJ9Dvc2EcDgFAYIuaXS3bbOh6MIC5IAP5Eh5fk2exC4tpgwZyiyFgvhEMBBEAIfkEBQUAAAAsAAACAA4AHQAABHMQyAnYoViSlFDGXBJ808Ep5KRwV8qEg+pRCOeoioKMwJK0Ekcu54h9AoghKgXIMZgAApQZcCCu2Ax2O6NUud2pmJcyHA4L0uDM/ljYDCnGfGakJQE5YH0wUBYBAUYfBIFkHwaBgxkDgX5lgXpHAXcpBIsRADs="></div>',e)},plus.hideLoading=function(){var e=dialogList.loading;e&&e.close().remove()},plus.hideDialog=function(e){(e=root.KG_Dialog.list[e])&&e.close().remove()},plus.showDialog=function(e,t){return(e=kingDialog(e,t)).show(),internationalization(),e},plus.template={sealTpl_noInput:'<div class="kg-dialog kg-dialog-runSignature" id="sealTpl-dialog"><% if(this.thirdConfig != null){%><div class="kg-postil" id="kg-postil" ><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="TextPostil">文字批注</label></div><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><div class="kg-sm kg-sm-3" data-kgi18n-html="CommonLanguage">常用语：</div><div class="kg-sm kg-sm-5"><select id="i-kg-common-lang" style="width:90px;" ><option value=""></option><% for(var i = 0;this.thirdConfig != null && this.thirdConfig.commonlang != null && i<this.thirdConfig.commonlang.length;i++){ %><option value=""><% this.thirdConfig.commonlang[i]%></option><% }%></select></div><div class="kg-sm kg-sm-2"><a href="#" title="字体" class="kg-fontSet kg-fontSet-font" id="kg-fontSet"><i class="kg-font-text"></i></a><a href="#" title="编辑" class="kg-fontSet kg-fontSet-edit" id="kg-fontSet"><i class="kg-font-edit"></i></a></div></div></div><div class="kg-common-lang"><div class="kg-form"><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><textarea id="kg-postil-value" class="kg-sm kg-sm-10 kg-postil-value" maxlength="140"></textarea></div></div></div></div><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="SignaturePicture">签章图片</label></div></div><% } %><div class=" kg-switcher" id="kg-switcher" ><a class="arrow-left arrow" href="#"><i class="kg-icon kg-icon-angle-left kg-primary-arrow-red"><</i></a><a class="arrow-right arrow" href="#"><i class="kg-icon kg-icon-angle-right kg-primary-arrow-red">></i></a><div class="kg-pagin"><d\tiv class="kg-guide"></div>\t</div><div class="kg-container"><div class="kg-wrapper"><% var seals = this.seals; %><% for(var i=0;i<seals.length;i++) {%><div class="kg-slide" title="<%seals[i].signname%>"><div class="kg-image"><div class="title"><%seals[i].signname%></div><a class="kg-img" href="#" ><img src="data:image/<%seals[i].imgext.substring(1)%>;base64,<%arguments[arguments.length-1](seals[i])%>"></a></div><div class="kg-shade" style="z-index:100;"><img width="100%" height="100%"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="></div></div><%}%></div></div></div><div class="kg-form"><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-addDate"><div class="kg-sm kg-sm-8"><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%> id="<%this.isMobile%>" class="<%this.isMobile?"":"kg-primary-check-red"%>" checked="checked">&nbsp;<label for="kg-addDate" data-kgi18n-html="AddData">附加时间</label>&nbsp;&nbsp;&nbsp;&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%> id="<%this.isMobile%>" class="<%this.isMobile?" ":"kg-primary-check-red"%>" >&nbsp;<label for="kg-addDate" data-kgi18n-html="AddData">附加时间</label>&nbsp;&nbsp;&nbsp;&nbsp;<%}%><input type="button"  name="dateSet" id="kg-dateSet" class="kg-second-btn-red" data-kgi18n-value="Setting" value="设置"/><% if(this.showProtectedBtn){%>&nbsp;<input type="button"  name="proDataSet" class="kg-second-btn-red" id="kg-protectedDataSet" data-kgi18n-value="Protection" value="保护项"/><%}%></div></div></div></div></div>',sealTpl:'<div class="kg-dialog kg-dialog-runSignature" id="sealTpl-dialog"><%if(this.thirdConfig != null){%><div class="kg-postil" id="kg-postil"><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="TextPostil">文字批注</label></div><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><div class="kg-sm kg-sm-3" data-kgi18n-html="CommonLanguage">常用语：</div><div class="kg-sm kg-sm-5"><select id="i-kg-common-lang" style="width:90px;" ><option value=""></option><% for(var i = 0;this.thirdConfig != null && this.thirdConfig.commonlang != null && i<this.thirdConfig.commonlang.length;i++){ %><option value=""><% this.thirdConfig.commonlang[i]%></option><% }%></select></div><div class="kg-sm kg-sm-2"><a href="#" title="字体" class="kg-fontSet kg-fontSet-font" id="kg-fontSet"><i class="kg-font-text"></i></a><a href="#" title="编辑" class="kg-fontSet kg-fontSet-edit" id="kg-fontSet"><i class="kg-font-edit"></i></a></div></div></div><div class="kg-common-lang"><div class="kg-form"><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><textarea id="kg-postil-value" class="kg-sm kg-sm-10 kg-postil-value" maxlength="140"></textarea></div></div></div></div><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="SignaturePicture">签章图片</label></div></div><%} %><div class=" kg-switcher" id="kg-switcher" ><a class="arrow-left arrow" href="#"><i class="kg-icon kg-icon-angle-left kg-primary-arrow-red"><</i></a><a class="arrow-right arrow" href="#"><i class="kg-icon kg-icon-angle-right kg-primary-arrow-red">></i></a><div class="kg-pagin"><d\tiv class="kg-guide"></div></div><div class="kg-container" ><div class="kg-wrapper"><% var seals = this.seals; %><% for(var i=0;i<seals.length;i++) {%><div class="kg-slide" title="<%seals[i].signname%>"><div class="kg-image"><div class="title"><%seals[i].signname%></div><a class="kg-img" href="#" ><img src="data:image/<%seals[i].imgext.substring(1)%>;base64,<%arguments[arguments.length-1](seals[i])%>"></a></div><div class="kg-shade" style="z-index:100;"><img width="100%" height="100%"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="></div></div><%}%></div></div></div><div class="kg-form"><% if(this.verification){%><div class="form-item clearfix i-password"><div class="kg-sm kg-sm-2"></div><div class="kg-sm kg-sm-8"><div style="position:relative"><input name="" style="text-indent:10px" id="kg-verification" class="form-control"/><span class="kg-verificationButton <%this.Global%>-verificationButton kg-second-btn-red" title="获取短信验证码" data-kgi18n-html="VerifyCode">验证码</span><span class="kg-tip <%this.Global%>-tip"></span><span class="kg-tipText"></span><span class="kg-verificationMark"/></div></div><div class="kg-sm kg-sm-2"></div></div><%}else{%><% if(!this.noPassWord){%><div class="form-item clearfix i-password"><div class="kg-sm kg-sm-2"></div><label class="<%this.Global%>-sm <%this.Global%>-password-l kg-label" data-kgi18n-html="PassWord">密码</label><div class="<%this.Global%>-sm <%this.Global%>-password-r"><input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div><div class="kg-sm kg-sm-2"></div></div><%}%><%}%><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-password kg-pwd"><div class="<%this.Global%>-sm <%this.Global%>-remenberPwd"><% if(this.verification){%><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate"   class="<%this.isMobile?"":"kg-primary-check-red"%>" checked="checked">&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">附加时间</label>&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%>" >&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">附加时间</label>&nbsp;<%}%><input type="button"  name="dateSet" id="kg-dateSet" class="kg-second-btn-red" data-kgi18n-value="Setting" value="设置"/><%}else{%><% if(this.showRememberPwd){%><input type="checkbox" name="remenberPwd" class="<%this.isMobile?"":"kg-primary-check-red"%>" id="kg-remenberPwd">&nbsp;<label style="display:inline;"  for="kg-remenberPwd" data-kgi18n-html="RememberMe">记住密码</label><%}%><%}%><% if(this.showProtectedBtn){%>&nbsp;<input type="button"  name="proDataSet" id="kg-protectedDataSet" class="kg-second-btn-red" data-kgi18n-value="Protection" value="保护项"/><%}%></div></div></div><div class="kg-sm kg-sm-2"></div><% if(this.verification){%><%}else{%><div class="form-item clearfix i-addDate"><div class="<%this.Global%>-sm <%this.Global%>-addDate"><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate"   class="<%this.isMobile?"":"kg-primary-check-red"%>" checked="checked">&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">附加时间</label>&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%>" >&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">附加时间</label>&nbsp;<%}%><input type="button"  name="dateSet" id="kg-dateSet" class="kg-second-btn-red" data-kgi18n-value="Setting" value="设置"/></div></div><%}%></div></div></div>',inputTpl:'<div id="kg-verifyPass" class="kg-dialog kg-dialog-password"><div class="kg-form"><div class="form-item clearfix i-password"><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="PassWord">密码</label><div class="kg-sm kg-sm-8"><input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div></div><div class="kg-sm kg-sm-3"></div><div class="kg-sm kg-sm-8"><input type="checkbox" name="remenberPwd" class="<%this.isMobile?"":"kg-primary-check-red"%>" id="kg-remenberPwd" >&nbsp;<label for="kg-remenberPwd" data-kgi18n-html="RememberMe">记住密码</label></div></div></div></div>',prompt:'<div id="kg-verifyPass" class="kg-dialog kg-dialog-prompt"><div class="kg-promtInfo"></div></div>'}),font=plus.fontTemplate={fontFormat:"yyyy-M-d;yyyy.M.d;yyyy/M/d;yyyy年M月d日;yy/M/d;yy.M.d;yyyy-MM-dd;yyyy/MM/dd;yyyy.MM.dd;yyyy年M月d日*;yyyy年M月d日**;MM/dd;MM.dd;M/d;M.d;d-MMM-yyyy;d-MMM-yy;yyyy-M-d hh:mm:ss".split(";"),fontFamily:"@Arial Unicode MS;@Fixedsys;@Malgun Gothic;@Malgun Gothic Semilight;@Meiryo;@Meiryo UI;@Microsoft JhengHei;@Microsoft JhengHei Light;@Microsoft JhengHei UI;@Microsoft JhengHei UI Light;@Microsoft YaHei UI;@Microsoft YaHei UI Light;@MingLiU_HKSCS-ExtB;@MingLiU-ExtB;@MS Gothic;@MS PGothic;@MS UI Gothic;@PMingLiU-ExtB;@SimSun-ExtB;@System;@Terminal;@Yu Gothic;@Yu Gothic Light;@Yu Gothic Medium;@Yu Gothic UI;@Yu Gothic UI Light;@Yu Gothic UI Semibold;@Yu Gothic UI Semilight;@等线;@等线 Light;@方正兰亭超细黑简体;@方正舒体;@方正姚体;@仿宋;@黑体;@华文彩云;@华文仿宋;@华文行楷;@华文琥珀;@华文楷体;@华文隶书;@华文宋体;@华文细黑;@华文新魏;@华文中宋;@楷体;@隶书;@宋体;@微软雅黑;@微软雅黑 Light;@新宋体;@幼圆;ADMUI3Lg;ADMUI3Sm;Agency FB;Algerian;Arial;Arial Black;Arial Narrow;Arial Rounded MT Bold;Arial Unicode MS;Axure Handwriting;Baskerville Old Face;Bauhaus 93;Bell MT;Berlin Sans FB;Berlin Sans FB Demi;Bernard MT Condensed;Blackadder ITC;Bodoni MT;Bodoni MT Black;Bodoni MT Condensed;Bodoni MT Poster Compressed;Book Antiqua;Bookman Old Style;Bookshelf Symbol 7;Bradley Hand ITC;Britannic Bold;Broadway;Brush Script MT;Calibri;Calibri Light;Californian FB;Calisto MT;Cambria;Cambria Math;Candara;Castellar;Centaur;Century;Century Gothic;Century Schoolbook;Chiller;Colonna MT;Comic Sans MS;Consolas;Constantia;Cooper Black;Copperplate Gothic Bold;Copperplate Gothic Light;Corbel;Courier;Courier New;Curlz MT;Default;Ebrima;Edwardian Script ITC;Elephant;Engravers MT;Eras Bold ITC;Eras Demi ITC;Eras Light ITC;Eras Medium ITC;Euro Sign;Felix Titling;Fixedsys;Footlight MT Light;Forte;Franklin Gothic Book;Franklin Gothic Demi;Franklin Gothic Demi Cond;Franklin Gothic Heavy;Franklin Gothic Medium;Franklin Gothic Medium Cond;Freestyle Script;French Script MT;Gabriola;Gadugi;Garamond;Georgia;Gigi;Gill Sans MT;Gill Sans MT Condensed;Gill Sans MT Ext Condensed Bold;Gill Sans Ultra Bold;Gill Sans Ultra Bold Condensed;Gloucester MT Extra Condensed;Goudy Old Style;Goudy Stout;Haettenschweiler;Harlow Solid Italic;Harrington;High Tower Text;Impact;Imprint MT Shadow;Informal Roman;Javanese Text;Jokerman;Juice ITC;Kristen ITC;Kunstler Script;Leelawadee UI;Leelawadee UI Semilight;Lucida Bright;Lucida Calligraphy;Lucida Console;Lucida Fax;Lucida Handwriting;Lucida Sans;Lucida Sans Typewriter;Lucida Sans Unicode;Magneto;Maiandra GD;Malgun Gothic;Malgun Gothic Semilight;Marlett;Matura MT Script Capitals;Meiryo;Meiryo UI;Microsoft Himalaya;Microsoft JhengHei;Microsoft JhengHei Light;Microsoft JhengHei UI;Microsoft JhengHei UI Light;Microsoft New Tai Lue;Microsoft PhagsPa;Microsoft Sans Serif;Microsoft Tai Le;Microsoft YaHei UI;Microsoft YaHei UI Light;Microsoft Yi Baiti;MingLiU_HKSCS-ExtB;MingLiU-ExtB;Mistral;Modern;Modern No. 20;Mongolian Baiti;Monotype Corsiva;MS Gothic;MS Outlook;MS PGothic;MS Reference Sans Serif;MS Reference Specialty;MS Sans Serif;MS Serif;MS UI Gothic;MT Extra;MV Boli;Myanmar Text;Niagara Engraved;Niagara Solid;Nirmala UI;Nirmala UI Semilight;OCR A Extended;Old English Text MT;Onyx;Palace Script MT;Palatino Linotype;Papyrus;Parchment;Perpetua;Perpetua Titling MT;Playbill;PMingLiU-ExtB;Poor Richard;Pristina;Rage Italic;Ravie;Rockwell;Rockwell Condensed;Rockwell Extra Bold;Roman;Script;Script MT Bold;Segoe MDL2 Assets;Segoe Print;Segoe Script;Segoe UI;Segoe UI Black;Segoe UI Emoji;Segoe UI Historic;Segoe UI Light;Segoe UI Semibold;Segoe UI Semilight;Segoe UI Symbol;Showcard Gothic;SimSun-ExtB;Sitka Banner;Sitka Display;Sitka Heading;Sitka Small;Sitka Subheading;Sitka Text;Small Fonts;Snap ITC;Stencil;Sylfaen;Symbol;System;Tahoma;TeamViewer11;Tempus Sans ITC;Terminal;Times New Roman;Trebuchet MS;Tw Cen MT;Tw Cen MT Condensed;Tw Cen MT Condensed Extra Bold;Verdana;Viner Hand ITC;Vivaldi;Vladimir Script;Webdings;Wide Latin;Wingdings;Wingdings 2;Wingdings 3;Yu Gothic;Yu Gothic Light;Yu Gothic Medium;Yu Gothic UI;Yu Gothic UI Light;Yu Gothic UI Semibold;Yu Gothic UI Semilight;ZWAdobeF;等线;等线 Light;方正兰亭超细黑简体;方正舒体;方正姚体;仿宋;黑体;华文彩云;华文仿宋;华文行楷;华文琥珀;华文楷体;华文隶书;华文宋体;华文细黑;华文新魏;华文中宋;楷体;隶书;宋体;微软雅黑;微软雅黑 Light;新宋体;幼圆".split(";"),fontSize:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72],fontColor:"#000000 #800000 #008000 #808000 #000080 #800080 #008080 #808080 #C0C0C0 #FFFFFF #FF0000 #00FF00 #FFFF00 #0000FF #FF00FF #00FFFF".split(" "),fontPosition:[["center","middle","inside","",""],["center","bottom","inside","",""],["right","middle","inside","",""],["right","bottom","inside","",""],["right","top","outside","left",""],["center","top","outside","","below"],["left","middle","outside","right",""],["right","top","outside","","below"],["left","bottom","outside","right",""],["left","top","outside","right","below"]],position:"居中 居中下(章内) 居右中(章内) 居右下(章内) 居左上(章外) 居中下(章外) 居右中(章外) 居右下(章下) 居右下(章右) 居右下(章右下)".split(" ")},fontFamily=plus.fontFamily=[{ename:"sans-serif",zname:"sans-serif"},{ename:"SimSun",zname:"宋体"},{ename:"SimHei",zname:"黑体"},{ename:"Microsoft Yahei",zname:"微软雅黑"},{ename:"Microsoft JhengHei",zname:"微软正黑体"},{ename:"KaiTi",zname:"楷体"},{ename:"NSimSun",zname:"新宋体"},{ename:"FangSong",zname:"仿宋"},{ename:"PingFang SC",zname:"苹方"}],dafaultDate=plus.dafaultDate="2017/01/01 12:00:00",defaultFont=plus.defaultFont={fontFormat:plus.fontTemplate.fontFormat[0],fontFamily:"宋体",fontSize:12,fontColor:"#000000",position:plus.fontTemplate.position[0]},formatArgs=(plus.kgFont=function(e){var t={};return t.fontFormat=e.fontFormat||plus.defaultFont.fontFormat,t.fontFamily=e.fontFamily||plus.defaultFont.fontFamily,t.fontSize=e.fontSize||plus.defaultFont.fontSize,t.fontColor=e.fontColor||plus.defaultFont.fontColor,null!=e.position?(e=jQuery.inArray(e.position,plus.fontTemplate.position),t.fontPosition=plus.fontTemplate.fontPosition[e]):e.fontPositionIndex?t.fontPosition=plus.fontTemplate.fontPosition[e.fontPositionIndex]:(e=jQuery.inArray(plus.defaultFont.position,plus.fontTemplate.position),t.fontPosition=plus.fontTemplate.fontPosition[e]),t},function(e){var t,i,e=[e],n=Utils.slice(arguments,1);return 0<n.length&&(i=n[0],1<n.length)&&(t=n.slice(1)),e.push(i),e.concat(t)}),noop=(plus.showTplDialog=function(e,t,i){var n=Utils.slice(arguments,2),t=Utils.extend({content:function(){return Utils.template.apply(null,[template[e]].concat(n))}},t);return plus.showDialog(e,t)},plus.showTemplateDialog=function(e){var t=formatArgs.apply(null,Utils.slice(arguments));return plus.showTplDialog.apply(plus,t)},plus.create=function(e){Utils.extend(this,plus),this.king=e},function(){return plus.hideLoading(),!0}),proto=plus.create.prototype,kingPlus=function(e){return 0==arguments.length?plus:new plus.create(e)},debug=(kingPlus.changeSkin=function(e){Utils.extend(kingDialog.prototype,e)},root.kingPlus=kingPlus,jQuery.kgi18n={},jQuery.kgi18n.map={},function(e){window.console}),xhr;function callbackIfComplete(e){e.debug&&(debug("callbackIfComplete()"),debug("totalFiles: "+e.totalFiles),debug("filesLoaded: "+e.filesLoaded)),e.async&&e.filesLoaded===e.totalFiles&&e.callback&&e.callback()}function loadAndParseFiles(e,t){t.debug&&debug("loadAndParseFiles"),null!==e&&0<e.length?loadAndParseFile(e[0],t,function(){e.shift(),loadAndParseFiles(e,t)}):callbackIfComplete(t)}if(Function.prototype.method=function(e,t){return this.prototype[e]=t,this},String.prototype.trim||(String.method("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.method("ltrim",function(){return this.replace(/^\s+/g,"")}),String.method("rtrim",function(){return this.replace(/\s+$/g,"")})),jQuery.kgi18n.properties=function(i){(i=jQuery.extend({name:"Messages",language:"",path:"",namespace:null,mode:"vars",cache:!1,debug:!1,encoding:"UTF-8",async:!1,callback:null},i)).namespace&&"string"==typeof i.namespace&&(i.namespace.match(/^[a-z]*$/)?jQuery.kgi18n.map[i.namespace]={}:(debug("Namespaces can only be lower case letters, a - z"),i.namespace=null)),i.path.match(/\/$/)||(i.path+="/"),i.language=this.normaliseLanguageCode(i);var e=i.name&&i.name.constructor===Array?i.name:[i.name];i.totalFiles=2*e.length+(5<=i.language.length?e.length:0),i.debug&&debug("totalFiles: "+i.totalFiles),i.filesLoaded=0,e.forEach(function(e){var t;i.language.substring(0,2),5<=i.language.length&&(t=i.language.substring(0,5),t=i.path+e+"_"+t+".properties"),loadAndParseFiles([t],i)}),i.callback&&!i.async&&i.callback()},jQuery.kgi18n.prop=function(e){var t,i,n,a=[].slice.call(arguments);if(2==a.length&&($.isArray(a[1])?t=a[1]:"object"===(0,_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.Z)(a[1])&&(i=a[1].namespace,n=a[1].replacements,a.splice(-1,1),n)&&Array.prototype.push.apply(a,n)),null===(n=(i?jQuery.kgi18n.map[i]:jQuery.kgi18n.map)[e]))return"["+(i?i+"#"+e:e)+"]";if("string"==typeof n){for(l=0;-1!=(l=n.indexOf("\\",l));)n="t"==n.charAt(l+1)?n.substring(0,l)+"\t"+n.substring(2+l++):"r"==n.charAt(l+1)?n.substring(0,l)+"\r"+n.substring(2+l++):"n"==n.charAt(l+1)?n.substring(0,l)+"\n"+n.substring(2+l++):"f"==n.charAt(l+1)?n.substring(0,l)+"\f"+n.substring(2+l++):"\\"==n.charAt(l+1)?n.substring(0,l)+"\\"+n.substring(2+l++):n.substring(0,l)+n.substring(l+1);for(var o,s,r=[],l=0;l<n.length;)if("'"==n.charAt(l))if(l==n.length-1)n=n.substring(0,l);else if("'"==n.charAt(l+1))n=n.substring(0,l)+n.substring(++l);else{for(o=l+2;-1!=(o=n.indexOf("'",o));){if(o==n.length-1||"'"!=n.charAt(o+1)){n=n.substring(0,l)+n.substring(l+1,o)+n.substring(o+1),l=o-1;break}n=n.substring(0,o)+n.substring(++o)}-1==o&&(n=n.substring(0,l)+n.substring(l+1))}else"{"!=n.charAt(l)||-1==(o=n.indexOf("}",l+1))?l++:(s=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(n.substring(l+1,o)),!isNaN(s)&&0<=s?(""!==(l=n.substring(0,l))&&r.push(l),r.push(s),l=0,n=n.substring(o+1)):l=o+1);""!==n&&r.push(n),n=r,i?jQuery.kgi18n.map[settings.namespace][e]=r:jQuery.kgi18n.map[e]=r}if(!n||0===n.length)return"";if(1==n.length&&"string"==typeof n[0])return n[0];for(i="",l=0,o=n.length;l<o;l++)i="string"==typeof n[l]?i+n[l]:t&&n[l]<t.length?i+t[n[l]]:!t&&n[l]+1<a.length?i+a[n[l]+1]:i+("{"+n[l])+"}";return i},window.XMLHttpRequest)xhr=new XMLHttpRequest;else if(window.ActiveXObject)for(var activexName=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<activexName.length;i++)try{xhr=new ActiveXObject(activexName[i]);break}catch(a){}function loadAndParseFile(e,t,i){t.debug&&(debug("loadAndParseFile('"+e+"')"),debug("totalFiles: "+t.totalFiles),debug("filesLoaded: "+t.filesLoaded)),null!=e&&(xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&(t.debug&&(debug("Succeeded in downloading "+e+"."),debug(xhr.responseText)),parseData(xhr.responseText,t),i())},xhr.open("GET",e,t.cache),xhr.onerror=function(){t.debug&&debug("Failed to download or parse "+e+". errorThrown: "),404===jqXHR.status&&--t.totalFiles,i()},xhr.send())}function parseData(a,b){var c="";a=a.split(/\n/);for(var d=/(\{\d+})/g,e=/\{(\d+)}/g,f=/(\\u.{4})/gi,g=0,h=a.length;g<h;g++){var m=a[g];if(m=m.trim(),0<m.length&&"#"!=m.match("^#")){var p=m.split("=");if(0<p.length){for(var m=decodeURI(p[0]).trim(),l=1==p.length?"":p[1];-1!=l.search(/\\$/);)l=l.substring(0,l.length-1),l+=a[++g].trimRight();for(var r=2,q,t,x;r<p.length;r++)l+="="+p[r];l=l.trim(),"map"!=b.mode&&"both"!=b.mode||((p=l.match(f))&&p.forEach(function(e){l=l.replace(e,unescapeUnicode(e))}),b.namespace?jQuery.kgi18n.map[b.namespace][m]=l:jQuery.kgi18n.map[m]=l),"vars"!=b.mode&&"both"!=b.mode||(l=l.replace(/"/g,'\\"'),checkKeyNamespace(m),d.test(l)?(q=!0,t="",x=[],l.split(d).forEach(function(i){!d.test(i)||0!==x.length&&-1!=x.indexOf(i)||(q||(t+=","),t+=i.replace(e,"v$1"),x.push(i),q=!1)}),c+=m+"=function("+t+"){",m='"'+l.replace(e,'"+v$1+"')+'"',c+="return "+m+";};"):c+=m+'="'+l+'";')}}}eval(c),b.filesLoaded+=1}function checkKeyNamespace(a){if(/\./.test(a)){var b="";a=a.split(/\./);for(var c=0,d=a.length;c<d;c++){var e=a[c];0<c&&(b+="."),b+=e,eval("typeof "+b+' == "undefined"')&&eval(b+"={};")}}}function unescapeUnicode(e){var t=[];return 0<=(e=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(2),16))&&e<Math.pow(2,16)&&t.push(e),t.reduce(function(e,t){return e+String.fromCharCode(t)},"")}jQuery.kgi18n.normaliseLanguageCode=function(e){var t=e.language;return(!t||t.length<2)&&(e.debug&&debug("No language supplied. Pulling it from the browser ..."),t=navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage||"en",e.debug)&&debug("Language from browser: "+t),t=3<(t=(t=t.toLowerCase()).replace(/-/,"_")).length?t.substring(0,3)+t.substring(3).toUpperCase():t};var CryptoJS=CryptoJS||function(r){var e={},t=e.lib={},i=t.Base={extend:function(e){u.prototype=this;var t=new u;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=t.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var a=0;a<e;a++)t[n+a>>>2]|=(i[a>>>2]>>>24-a%4*8&255)<<24-(n+a)%4*8;else if(65535<i.length)for(a=0;a<e;a+=4)t[n+a>>>2]=i[a>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=r.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4)t.push(4294967296*r.random()|0);return new l.init(t,e)}}),n=e.enc={},a=n.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var a=t[n>>>2]>>>24-n%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(n,2),16)<<24-n%8*4;return new l.init(i,t/2)}},o=n.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(i,t)}},s=n.Utf8={stringify:function(e){try{return decodeURIComponent(escape(o.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return o.parse(unescape(encodeURIComponent(e)))}},c=t.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=s.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,i=t.words,n=t.sigBytes,a=this.blockSize,o=n/(4*a),o=e?r.ceil(o):r.max((0|o)-this._minBufferSize,0),n=r.min(4*(e=o*a),n);if(e){for(var s=0;s<e;s+=a)this._doProcessBlock(i,s);s=i.splice(0,e),t.sigBytes-=n}return new l.init(s,n)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});function u(){}t.Hasher=c.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(e,t){return new i.init(t).finalize(e)}},_createHmacHelper:function(i){return function(e,t){return new g.HMAC.init(i,t).finalize(e)}}});var g=e.algo={};return e}(Math),$=(!function(){var e=CryptoJS,t=(n=e.lib).WordArray,i=n.Hasher,u=[],n=e.algo.SHA1=i.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i,n=this._hash.words,a=n[0],o=n[1],s=n[2],r=n[3],l=n[4],c=0;c<80;c++)u[c]=c<16?0|e[t+c]:(i=u[c-3]^u[c-8]^u[c-14]^u[c-16])<<1|i>>>31,i=(a<<5|a>>>27)+l+u[c],i=c<20?i+(1518500249+(o&s|~o&r)):c<40?i+(1859775393+(o^s^r)):c<60?i+((o&s|o&r|s&r)-1894007588):i+((o^s^r)-899497514),l=r,r=s,s=o<<30|o>>>2,o=a,a=i;n[0]=n[0]+a|0,n[1]=n[1]+o|0,n[2]=n[2]+s|0,n[3]=n[3]+r|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=Math.floor(i/4294967296),t[15+(64+n>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=i._createHelper(n),e.HmacSHA1=i._createHmacHelper(n)}(),window.jQuery),kingPlus=window.kingPlus,isIE8=!1,canCanvas=(root.JSON&&(isIE8='{"x":"中"}'!==root.JSON.stringify({x:"中"})),!0);try{root.document.createElement("canvas").getContext("2d")}catch(a){canCanvas=!1}function stringify(e){return e=_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5___default()(e),isIE8?e.replace(/\\u([0-9a-fA-F]{2,4})/g,function(e,t){return String.fromCharCode(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(t,16))}):e}var now=function(){return(new Date).getTime()};function rnd(e){return(9301*e+49297)%233280/233280}function rand(){var e=""+Math.ceil(99999*rnd((new Date).getTime())),t=5-e.length;if(0<t)for(var i=0;i<t;i++)e="0"+e;return e}var Utils=kinggrid.Utils,$window=$(window),$document=$(document),html=document.documentElement,isIE6=!("minWidth"in html.style),isLosecapture=!isIE6&&"onlosecapture"in html,isSetCapture="setCapture"in html,isTouch,EventTypes,getEvent=function(e){return e=isTouch?(e.originalEvent||e).touches.item(0):e},Drag=function(e){this.start=$.proxy(this.start,this),this.over=$.proxy(this.over,this),this.end=$.proxy(this.end,this),this.onstart=this.onover=this.onend=$.noop,EventTypes||(isTouch="mousedown"!=e.type,EventTypes={start:isTouch?"touchstart":"mousedown",over:isTouch?"touchmove":"mousemove",end:isTouch?"touchend":"mouseup"})},Listener=(Drag.prototype={start:function(e){return e=this.startFix(e),globalLisenter.trigger("dragStart",this,e),$document.on(EventTypes.over,this.over).on(EventTypes.end,this.end),this.onstart(e),!1},over:function(e){return e=this.overFix(e),globalLisenter.trigger("dragOver",this,e),this.onover(e),!1},end:function(e){return e=this.endFix(e),globalLisenter.trigger("dragEnd",this,e),$document.off(EventTypes.over,this.over).off(EventTypes.end,this.end),this.onend(e),!1},startFix:function(e){return e=getEvent(e),this.target=$(e.target),this.selectstart=function(){return!1},$document.on("selectstart",this.selectstart).on("dblclick",this.end),isLosecapture?this.target.on("losecapture",this.end):$window.on("blur",this.end),isSetCapture&&this.target[0].setCapture(),e},overFix:function(e){return getEvent(e)},endFix:function(e){return e=getEvent(e),$document.off("selectstart",this.selectstart).off("dblclick",this.end),isLosecapture?this.target.off("losecapture",this.end):$window.off("blur",this.end),isSetCapture&&this.target[0].releaseCapture(),e}},Drag.create=function(s,e,o,t){function i(){}var r,l,c,u,g=$(s),n=new Drag(e),a=EventTypes.start,d=s.className.replace(/^\s|\s.*/g,"")+"-drag-start",h=g[0].style,f=$document.scrollLeft(),p=$document.scrollTop(),_=0==t.left?0:t.left+g.width()-f,m=t.right-f,v=t.top-p,k=0==t.bottom?0:t.bottom-g.height()-p,S=0,b=0,y=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(h.left),C=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(h.top),w=y,D=C,E=y,A=C,x=(o&&(w=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(h.marginLeft),D=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(h.marginTop),E=w,A=D),{onstart:i,onover:i,onend:i,off:function(){g.off(a,n.start)}}),P=function(){var e=1,t=g.parents(".kg-translate");return null!=t&&null!=(t=t.css("transform"))&&(e=(t=t.split("(")[1].split(")")[0].split(","))[0],t=t[3],e=Math.max(Math.sqrt(e*e),Math.sqrt(t*t))),e};return n.onstart=function(e){var t="fixed"===g.css("position"),i=$document.scrollLeft(),n=$document.scrollTop(),a=g.width(),o=g.height();a*=P(),o*=P(),l=r=0,c=t?$window.width()-a+r:$document.width()-a,u=t?$window.height()-o+l:$document.height()-o,o=g.offset(),a=this.startLeft=t?o.left-i:o.left,t=this.startTop=t?o.top-n:o.top,this.clientX=e.clientX,this.clientY=e.clientY,(o=g.parent()).is("body")||(S=o[0].getBoundingClientRect().left+i,b=o[0].getBoundingClientRect().top+n),i=e.clientX-g.offset().left+i-g.width(),n=e.clientY-g.offset().top+n,0!=_&&(_+=i),0!=m&&(m+=i),0!=v&&(v+=n),0!=k&&(k+=n),g.addClass(d),x.onstart.call(s,e,a,t)},n.onover=function(e){var t=e.clientX,i=e.clientY,n=(0!=_&&e.clientX<=_&&(t=_),0!=m&&e.clientX>=m&&(t=m),0!=v&&e.clientY<=v&&(i=v),0!=k&&e.clientY>=k&&(i=k),t=t-this.clientX+this.startLeft,i=i-this.clientY+this.startTop,g[0].style),t=Math.max(r,Math.min(c,t)),i=Math.max(l,Math.min(u,i));i=o?(t=n.marginLeft=(t-S-y)/P()+"px",n.marginTop=(i-b-C)/P()+"px"):(t=n.left=(t-S)/P()+"px",n.top=(i-b)/P()+"px"),E=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(t),A=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i),x.onover.call(s,e,t,i)},n.onend=function(e){var t=(i=g.position()).left,i=i.top,n=(g.removeClass(d),g[0].style),a=!0;Math.abs(E-w)<6&&Math.abs(A-D)<6&&(a=!1),o?x.onend.call(s,e,a,n.marginLeft,n.marginTop):x.onend.call(s,e,a,t,i)},n.off=function(){g.off(a,n.start)},e?n.start(e):g.on(a,n.start),x},kinggrid.Listener),Service=function(){},SealService=($.extend(Service.prototype,Listener.prototype),function(){}),CertService=(SealService.className=SealService.name||"SealService",Utils.inherit(SealService,Service),$.extend(SealService.prototype,{loadSeal:function(){throw Error("must impl")},saveLog:function(){},verifyPwd:function(){throw Error("must impl")}}),function(){}),KgObject=(CertService.className=CertService.name||"CertService",Utils.inherit(CertService,Service),$.extend(CertService.prototype,{sign:function(){throw Error("must impl")},verifySign:function(){throw Error("must impl")}}),function(){}),Signature=($.extend(KgObject.prototype,{getAttr:function(e){return this[e]},setAttr:function(e){var i=this;$.each(e,function(e,t){"function"==typeof i[e]?i[e](t):i[e]=t})},removeAttr:function(e){delete this[e]}}),function i(e,t){var n,a=this;for(n in a.signatureid=e,a.setSignatureData(t),a.on("load",function(){i.list[e]=this}),a.on("remove",function(e){e=a._getLogInfo(Utils.extend(e||{},{LOGTYPE:"00",LOGSORT:"14",LOGMEMO:"撤销签章成功"})),a.sealService.saveLog(e),delete i.list[a.signatureid]}),a.on("update",function(e){"signMeta"===a._item&&(e=a._getLogInfo(Utils.extend(e||{},{LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"数字签名成功"})),a.sealService.saveLog(e))}),a.on("fireremove",function(){i.removeList.push(a.signatureid)}),a.on("fireupdate",function(){for(var e=!1,t=0;t<i.updateList.length;t++)if(i.updateList[t]===a){e=!0;break}e||i.updateList.push(a)}),i)i.hasOwnProperty(n)&&0==n.indexOf("on")&&(this[n]=i[n]);return this}),blankImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=",blackImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mNoaGgAAAMEAYF1LgG8AAAAAElFTkSuQmCC",createImg=function(e,t,i){var n,a,o;return canCanvas?((n=root.document.createElement("canvas")).height=i,n.width=t,a=n.getContext("2d"),(o=new Image).src=e,o.onload=function(){a.drawImage(o,0,0,t,i)}):((n=root.document.createElement("img")).style.width=t+"px",n.style.height=i+"px",n.setAttribute("src",e)),n},aisleKing,signature=(Utils.inherit(Signature,KgObject),$.extend(Signature.prototype,Listener.prototype),$.extend(Signature.prototype,{hashAlg:"sha1",encryptAlg:"RSA",_init:function(){},_getLogInfo:function(e,t){var i=decodeURIComponent(window.location.href);return t=this.signatureData||t,Utils.extend(e||{},{KEYSN:t.gbOvalue&&""!=t.gbOvalue?t.gbOvalue:t.keysn,SIGNSN:t.seal.signsn,DOCUMENTID:t.documentid,DOCUMENTNAME:t.documentname,APPVERSION:version.name,APPTYPE:"HTML",APPCODE:this.appcode,EXTPARAM2:i})},error:function(e,t,i,n){i=(i=Utils.is("Object",i=e)?e.errcode&&"511"!=e.errcode?e.errcode:e.errmsg:i)||"-999",t=Utils.is("String",t)?t:"then",plus.hideLoading(),Signature.options.errorCall?Signature.options.errorCall.call(null,e,t):plus.alert(kinggrid.msg(i,t),function(){n&&n._beginDlgOkCall&&1==n._beginDlgOkCall||Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})},load:function(e){this.trigger("beforeLoad"),this.setAttr(e),this.certService=new Signature.factory.cert[Signature.options.certType](e,this.signatureData);var t=this.signatureData;if(void 0!==e.extra&&null!==e.extra&&void 0!==e.extra[this.signatureid]){if(void 0!==e.extra[this.signatureid].scaleImage&&null!==e.extra[this.signatureid].scaleImage&&(t.seal.height*=e.extra[this.signatureid].scaleImage,t.seal.width*=e.extra[this.signatureid].scaleImage),null!=e.extra[this.signatureid].position){var i,n=$.extend({},t.position),a="";for(i in n)a=i;this.removeItem(t.position),this.updatePos(e.extra[this.signatureid].position,{marginLeft:null==e.extra[this.signatureid].offsetX?n[a].marginLeft:e.extra[this.signatureid].offsetX,marginTop:null==e.extra[this.signatureid].offsetY?n[a].marginTop:e.extra[this.signatureid].offsetY})}}else void 0!==e.scaleImage&&null!==e.scaleImage&&(t.seal.height*=e.scaleImage,t.seal.width*=e.scaleImage);return this.sealService=new Signature.factory.seal[Signature.options.sealType](e,t),this._init(),this.trigger("load"),this},toBase64Img:function(e){var t=e.imgdata,i=t.indexOf(e.signsn);return-1==i?t:(t=e.imgdata.substring(i+65),Utils.Base64.of().encodeByte(Utils.Base64.of(e.signsn).decodeByte(t)))},clearImg:function(){if(this.imgEles)for(var e in this.imgEles)this.trigger("removeAt",this.imgEles[e][0]),this.imgEles[e].remove();this.imgEles={}},repaint:function(){this.clearImg(),this.verify()},getUpdateType:function(){return this._item},updatePos:function(e,t){var i=this.signatureData.position[e];this._item="position",this.signatureData.position[e]=Utils.extend({},i,t)},updateItem:function(e,t){this._item=e,this.signatureData[e]=t},removeItem:function(e){for(var t in e)delete e[t]},fireUpdate:function(t){function e(e){t&&t(e),i[e?"update":"restore"](),delete i._item}var i=this;return Signature.asyn.update?Signature.asyn.update.call(i,e):(this.trigger("fireupdate"),e(!0)),this},restore:function(){this.setSignatureData(this.oriSignatureData),this.repaint()},update:function(){return this.setSignatureData(this.signatureData),this.repaint(),this.trigger("update"),this},remove:function(){for(var e in this.clearImg(),this.trigger("remove"),this)delete this[e];return this},fireRemove:function(t){function e(e){t&&t(e),e&&i.remove()}var i=this;return Signature.asyn.remove?Signature.asyn.remove.call(i,e):(this.trigger("fireremove"),e(!0)),this},hide:function(){if(this.imgEles)for(var e in this.imgEles)this.imgEles[e].hide()},createImg:function(){var e=this.signatureData,t=$(document.createElement("img")),i=0<e.appname.indexOf("H2TH5")?(e.seal.imgext=".png",e.seal.imgdata):this.toBase64Img(e.seal),n=blankImg;return this.broken||(n="data:image/"+e.seal.imgext+";base64,"+i),t.css({width:Math.ceil(9600*_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.seal.width)/254),height:Math.ceil(9600*_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.seal.height)/254)}).attr({src:n}),t},show:function(){var e,t=this.signatureData.position,i=this.imgEles=this.imgEles||{};for(e in t){var n="kg-img-div-"+this.signatureid+"-"+e,a=(a=i[n])||(i[n]=this.showAt(e,t[e]));this._handleImg(a)}this.trigger("show")},showAt:function(e,t){this.trigger("beforeShowAt",e,t);var i=Utils.$(e),n=this.signatureData.position;if(-1!=this.signatureData.appname.indexOf("H2TH5")&&n.H2TH5&&(-1===n.H2TH5.marginTop.indexOf("px")&&(n.H2TH5.marginTop+="px",n.H2TH5.marginLeft+="px"),null===i)&&(n=$("<div style='position:absolute;left:0;top:0;'></div>"),i=$("<div id='H2TH5'></div>"),n.append(i),$("body").append(n)),n=$(i),0==(n=this.extra&&this.extra[this.signatureid]&&(i=this.extra[this.signatureid].scopePosition)?(i instanceof Object?i:$(Utils.$(i))).find("#"+e):n).length){if(!Signature.options.defaultPos)throw Error("no find position:"+e+" signatureid="+this.signatureid);e=Signature.options.defaultPos,n=$(Utils.$(e))}var a,o,s=this.createImg(),r=(s.addClass("kg-img").attr("id","kg-img-"+this.signatureid),i=$(document.createElement("div")).addClass("kg-img-div").addClass("kg-img-div-"+e).attr({id:"kg-img-div-"+this.signatureid+"-"+e,elemid:e,signatureid:this.signatureid}),$(document.createElement("div")).css({position:"absolute"})),l=(r.append(s),i.append(r),i.css({width:s.width(),height:s.height()}),0),c=0,u=0,g=this.signatureData.dateTime,d=this.signatureData.postilFontSet;return null!=g&&g.isCheck&&g.fontDate&&(a=this.addDateToImg(g.fontDate,this.signatureData.timestamp.time,i,r),null!=this.imageAndDate)&&this.imageAndDate&&"outside"==g.fontDate.fontPosition[2]&&("right"==g.fontDate.fontPosition[3]?l+=a.dateWidth:"left"==g.fontDate.fontPosition[3]&&(l+=a.dateWidth,u=a.dateWidth,r.css({right:0})),"below"==g.fontDate.fontPosition[4])&&(c+=a.dateHeight),g=s.width()+l,null!=d&&null!=d.fontValue&&""!=d.fontValue.trim()&&(g+=o=this.calWidth(d.fontValue,d),c+=a=this.calHeight(d.fontSize),r.css({left:o+u}),this.addPostilFontToImg(d,i)),s=s.height()+c,null!=this.thirdConfig&&null!=this.thirdConfig.imgWh?(i.css({width:_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(this.thirdConfig.imgWh.width)>g?this.thirdConfig.imgWh.width:g,height:_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(this.thirdConfig.imgWh.height)>s?this.thirdConfig.imgWh.height:s}),r.css({left:Signature.isIE?"auto":"unset",right:l})):i.css({width:g,height:s}),r=i,l="kg-default",(c=n.attr("display"))?(n.addClass("display-"+c),l="kg-"+c,s=n,(r=document.getElementById("kg-img-container-"+e))||(r=document.createElement("div")).setAttribute("id","kg-img-container-"+e),(r=$(r).addClass(l+"-container")).append(i),i.attr("kg-display",!0)):"html"!=(s=n.offsetParent())[0].tagName.toLowerCase()&&"relative"!=s[0].style.position||(s=$("body")),i.addClass(l),s.append(r),c?"landscape"===c&&(n=r.children(),l=r.parent().width(),o=0,n.each(function(){o+=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()($(this).width())+1}),r.width(l<o?o:l)):this.calSealPos(n,i,r,t),this.trigger("showAt",i[0],e,t),i},calSealPos:function(e,t,i,n){var a=e.offsetParent(),o=(i=i||t,"html"!=a[0].tagName.toLowerCase()&&"relative"!=a[0].style.position||(a=$("body")),e=e.offset(),a.offset());a.is("body")&&(o={top:0,left:0}),i.css({top:e.top-o.top,left:e.left-o.left}),n=n?(a=n.marginLeft,n.marginTop):(a=t.css("marginLeft"),t.css("marginTop")),t.css({marginLeft:a||0,marginTop:n||0})},addPostilFontToImg:function(e,t){var i=$(document.createElement("div")),n=(i.addClass("kg-font-positl-div"),$(document.createElement("span")));return n.css({color:e.fontColor,"font-family":e.fontFamily,"font-size":e.fontSize+"px"}).addClass("kg-font-positl-span"),n.html(e.fontValue),i.append(n),t.prepend(i),i},calWidth:function(e,t){var i=document.createElement("canvas").getContext("2d");return i.font=t.fontSize+"px arial,"+t.fontFamily,i.measureText(e).width+6},calHeight:function(e){return 1.5*_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e)},getLength:function(e){return e.replace(/[\u0391-\uFFE5]/g,"aa").length},addDateToImg:function(e,t,i,n){t=kinggrid.Utils.formatDate(new Date(t),e.fontFormat);var a=$(document.createElement("div")).addClass("kg-date"),o=0,s=0;if(!e.fontPosition)for(var r=plus.fontTemplate.position.length,l=0;l<r;l++)if(plus.fontTemplate.position[l]==this.signdate.position){e.fontPosition=plus.fontTemplate.fontPosition[l];break}return"outside"==e.fontPosition[2]&&("right"==e.fontPosition[3]?o+=i.width():"left"==e.fontPosition[3]&&(o-=i.width()),"below"==e.fontPosition[4])&&(s+=i.height()),a.css({width:i.width(),height:i.height(),top:s,left:o}),o=$(document.createElement("div")).addClass("kg-date-tmb").css({width:i.width()}),s=$(document.createElement("div")).addClass("kg-date-lcr").css({"text-align":e.fontPosition[0],"font-family":e.fontFamily,"font-size":e.fontSize+"px",color:e.fontColor}),"bottom"==e.fontPosition[1]?o.css({bottom:0}):"middle"==e.fontPosition[1]&&s.css({"line-height":i.height()+"px"}),s.html(t),o.html(s),a.html(o),n.append(a),{dateWidth:i=this.calWidth(t,e),dateHeight:e=this.calHeight(e.fontSize)}},canSign:function(){return!this.modified&&!Signature.options.readonly&&Signature.options.signable&&!this.signatureData.signMeta},canMove:function(e){return e=(e=!Signature.options.readonly&&this.signatureData.moveable&&Signature.options.moveable&&!$(e).attr("kg-display"))&&Signature.options.moveable_self?this.signatureData.keysn==Signature.options.keysn:e},canDelete:function(){return!Signature.options.readonly},_handleImg:function(e){var t;e.show(),0==e.children(".kg-shade").length&&((t=$(document.createElement("div")).addClass("kg-shade")).append(createImg(blankImg,e.width(),e.height())),e.append(t)),this._invalid(e),this.trigger("handleImg",e[0])},setSignatureData:function(e){Utils.is("String",e)?this.signatureData=JSON.parse(Utils.Base64.of().decode(e)):this.signatureData=e,this.oriSignatureData=JSON.parse(_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5___default()(this.signatureData))},getSignatureid:function(){return this.signatureid},getSignatureData:function(){var e=_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_5___default()(this.signatureData);return Utils.Base64.of().encode(e)},getBase64Image:function(t,i,e,n){e="kg-img-div-"+t+"-"+e,null!=(e=document.getElementById(e))&&(isIE8?n(this,"",t,i):html2canvas(e).then(function(e){e=e.toDataURL("image/png").split(","),n(this,e,t,i)}))},_invalid:function(e){var t=e.children(".kg-invalid");if(0==t.length){t=$(document.createElement("div")).addClass("kg-hide").addClass("kg-invalid"),e.append(t);var i=e.height()/3;t.css({top:i,height:i}),i/=3;for(var n=e.width(),a=0;a<3;a++){var o=$(document.createElement("div")).height(i);0==a%2&&(o.addClass("kg-invalid-item"),o.append(createImg(blackImg,n,i))),t.append(o)}}if(this.modified){for(i="",n=0;n<this.modifiedItems.length;n++)i+=(a=this.modifiedItems[n]).desc+"["+a.field+"]由{"+a.orivalue+"}更改为{"+a.newvalue+"};";e.attr("modified",i).addClass("error"),t.removeClass("kg-hide")}else e.removeAttr("modified").removeClass("error"),t.addClass("kg-hide")},_verify:function(e,t){if(this.trigger("before_verify"),e=this.verifyProtectedData(e),!t||t.batchVerify||null==this.oriSignatureData.timestamp.timestampInfo)return this.show(),this.trigger("_verify"),!e;var i=this;this.getVerifyTimeStamp(this.oriSignatureData.timestamp.timestampInfo,function(e){i.timeVerify=e,i.show(),i.trigger("_verify"),t&&t.sucCall&&t.sucCall.call(i)})},verify:function(e,t){return this.trigger("beforeVerify"),e=this._verify(e,t),this.trigger("verify"),e},getVerifyProtectedItems:function(e,t){for(var i in e)if(null!=e[i]&&null!=e[i]){i=e[i];if(i.field==t)return i}return null},getVerifyProtectedData:function(){for(var e,t,i,n,a=this.validatedData,o=this.signatureData.protectedData,s={},r=0;r<o.length;r++)null!=o[r]&&null!=o[r]&&(t=(e=o[r]).field,null==(i=a&&(a[t]||this.getVerifyProtectedItems(a,t)&&this.getVerifyProtectedItems(a,t).value))&&((n=Utils.$(t))?null==(i=n.getAttribute("kg-value")||n.value)&&(i=n.innerHTML||n.innerText):i=null!=e.name&&null!=e.name?document.getElementById(e.name).value:""),e=Utils.val(i,this),e=this._formatValue(e),s[t]=e);return s},getSignTimeStamp:function(e){for(var t={},i=0;i<e.length;i++)t[e[i].field]=e[i].value;return Utils.Base64.of().encode(stringify(t))},getValidatedTimeStamp:function(){var e=stringify(this.getVerifyProtectedData());return Utils.Base64.of().encode(e)},getVerifyTimeStamp:function(e,t){var i,n=this.getValidatedTimeStamp(),a=e.CertData;"client"==Signature.options.sealType?(i=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)).invoke("SetParamByName","TSCERTDATA",Utils.Base64.of().encode(a)).ret(function(){i.invoke("KGVerifyTSWithReq",e.TimeStampResponse,e.TimeStampResult,"",n,e.TimeStr,"").ret(function(e){t.call(this,e.result)})}):$.ajax({url:Signature.options.serverUrl+"_key_verifyTimeStamp",type:"POST",data:{verifyed:n,cert:a,tsResp:e.TimeStampResponse},async:!1,success:function(e){t.call(this,e.result)},error:function(e){t.call(this,e)}})},getH5SignData:function(){return[{hashAlg:this.hashAlg,encryptAlg:this.encryptAlg,signdata:CryptoJS.SHA1(this.getSignData()).toString()}]},verifyProtectedData:function(e){e&&(this.validatedData=e),$.extend(!0,e={},this.signatureData.protectedData),Signature.verifyData&&(this.validatedData=Signature.verifyData(e)),e=[];for(var t,i,n=this.getVerifyProtectedData(),a=this.signatureData.protectedData,o=0;o<a.length;o++)null!=a[o]&&null!=a[o]&&(t=a[o],(i=n[a[o].field])!==t.value)&&e.push({field:t.field,desc:t.desc,orivalue:t.value,newvalue:i});return this.modified=0<e.length,this.modifiedItems=e,this.modified},verifySignData:function(i){var n=this,e=(plus.showLoading(),this.certService);if(this.signatureData.signMeta.html2sign){e instanceof ServerCert||((e=new ServerCert(Signature.options)).sData=n.signatureData);for(var t=n.getVerifyProtectedData(),a=this.signatureData.protectedData,o=[],s=0;s<a.length;s++){var r,l=a[s],c={};for(r in l)l.hasOwnProperty(r)&&(c[r]=l[r]);c.value=t[l.field],o.push(c)}t=stringify(o)}else t=this.getValidatedSignData();e.verifySign($.extend({seal:this.signatureData.seal,signeddata:this.signatureData.signMeta.signeddata,crtdata:this.signatureData.signMeta.certinfo.crtdata,keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,signdata:t},{successCall:function(e){var t;plus.hideLoading(),e.errcode||(n.signModified=!e.result,t=n.verify(null,{sucCall:function(){i&&i(e)}})),null==t&&e.result||i&&i(e)}}))},_renderValue:function(e){return e.replace(/\r\n/gi,"<br>")},_formatValue:function(e,t){return e=e?(e=e.replace(/\r\n/gi,"\n")).replace(/\n/gi,"\r\n"):e},getItemVal:function(e){var t;if(t=Utils.is("String",e)?Utils.$(e):e)return"input"===(e=t.tagName.toLowerCase())||"textarea"===e||"select"===e?t.getAttribute("kg-value")||t.value:t.getAttribute("kg-value")||(isIE8?t.innerText:t.textContent);throw Error("No find protectedItem:"+e+" signatureid="+this.signatureid)},getProtectedData:function(e){function t(e){if(Utils.is("String",e))e=a(e);else if(!Utils.is("Object",e)||!e.field)throw Error("Unsupported protectedItems:"+e.toString);return Utils.is("Function",e.value)&&(e.value=e.value.call(n,e.field,e.desc)),e.value=n._formatValue(e.value),e}var n=this,i=[],a=function(e){var t,i=Utils.$(e);if(i)return(t={field:e}).desc=i.getAttribute("kg-desc")||e,t.value=n.getItemVal(i),t;throw Error("No find protectedItem:"+e+" signatureid="+this.signatureid)};if(e)if(Utils.is("Array",e))for(var o=0,s=e.length;o<s;o++)i.push(t(e[o]));else i.push(t(e));return i},__findSignedData:function(e){if(Utils.is("String",e))return e.split(";")[0];if(Utils.is("Array",e))return e[0];throw Error("error signeddata: "+e)},getValidatedSignData:function(){var e=stringify(this.getVerifyProtectedData());return e=Utils.Base64.of().encode(e),CryptoJS.SHA1(e).toString()},getSignData:function(e){e=(e||this.signatureData).protectedData;for(var t={},i=0;i<e.length;i++)t[e[i].field]=e[i].value;return Utils.Base64.of().encode(stringify(t))},showSignSignatureDialog:function(r){var l=this,c=Signature.options.verification,e={target:Utils.is("Array",r.target)?r.target:[r.target],title:kinggrid.msg("SignSignature","KG_TITLE"),onCancel:function(){Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()},onShow:function(){var t,a,o,s,i=this;Signature.editThemeColor(),c?(t=l.signatureData.keysn,a="",o=i.find(".kg-tipText"),l.sealService.getTelphone({keysn:t,successCall:function(e){e.result?(o.html(e.phone),a=e.phone):l.errorCallback(e.massage,r.errorCall)}}),(o=i.find(".kg-tipText")).html(a),o.click(function(){o.hide(),i.find("#kg-revokeVerifyCode").focus()}),i.find("#kg-revokeVerifyCode").click(function(){o.hide(),i.find("#kg-revokeVerifyCode").focus()}),s=i.find(".kg-revokeMark"),i.find(".kg-revokeBtn").click(function(e){plus.showLoading();var n=$(this);l.sealService.applySMSCode({keysn:t,successCall:function(e){var t,i;e.result?(clearInterval(i),plus.hideLoading(),o.css({display:"block"}).html("已发送验证码"),s.css({display:"block"}),t=60,i=setInterval(function(){0<=t?(t<10&&(t="0"+t),n.html(t+"秒"),t--):(n.html("验证码"),s.css({display:"none"}),o.html(a),clearInterval(i))},1e3)):l.errorCallback(e.message,r.errorCall)}})}),i.find("#kg-revokeVerifyCode").keydown(function(e){13==e.keyCode&&i.options.onOk.call(i)})):(setTimeout(function(){i.find("#kg-password").focus()},40),i.find("#kg-password").keydown(function(e){13==e.keyCode&&i.options.onOk.call(i)}))},onOk:function(){var t=this,i=t.find("#kg-password"),n=t.find("#kg-revokeVerifyCode");if(c){if(!n.val())return plus.alert(kinggrid.msg("in_verification_msg","KG_MSG"),function(){n.focus()}),!1}else if(!i.val())return plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){i.focus()}),!1;l.sealService.checkKeysn.call(l,{keysn:l.signatureData.keysn},function(e){return e.result?c&&n.val()?(plus.showLoading(),void l.sealService.verifyPwd({verify:Signature.options.verification,pwd:n.val(),keysn:r.target.keysn,successCall:function(e){if(plus.hideLoading(),e.result)return r._onOk.call(t,n.val()),!1;l.error(e,null,null,{_beginDlgOkCall:!0})}})):(r._onOk.call(t,i.val()),!1):(l.error(e,null,null,{_beginDlgOkCall:!0}),!1)})}};return l.showDialog("signSignatureBtl",e)},changeMoveAble:function(e,t){this.signatureData.moveable=e,this.fireUpdate(),t&&t()},signSignature:function(n){var a=this,t={target:a,_onOk:function(e){var t=this,i=a.getH5SignData();a.runSign(i,e,function(e){e.result?a.fireUpdate(function(e){e&&t.remove()}):a.error(e,null,null,{_beginDlgOkCall:!0}),n&&n(e)})}};if(!a.signatureData.phoneshield)return a.showSignSignatureDialog(t);"client"==Signature.options.sealType&&a.sealService.getPhoneShieldLic({phoneshield:Signature.options.phoneshield},function(e){"1"==e.phoneshield||"3"==e.phoneshield?(kinggrid.options.timeout=1e3*(e.validatetime+10),t._onOk("")):"2"==e.phoneshield?a.error({errcode:"11110"},"then"):a.error({errcode:"11109"},"then")})},showRevokeSignatureDialog:function(r){var l=this,n=Signature.options.verification,e={target:Utils.is("Array",r.target)?r.target:[r.target],title:kinggrid.msg("RevokeSignature","KG_TITLE"),quickClose:null==Signature.options.quickClose||Signature.options.quickClose,onCancel:function(){Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()},onShow:function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call();var t,a,o,s,i=this;Signature.editThemeColor(),n?(t=l.signatureData.keysn,a="",o=i.find(".kg-tipText"),l.sealService.getTelphone({keysn:t,successCall:function(e){e.result?(o.html(e.phone),a=e.phone):l.errorCallback(e.massage,r.errorCall)}}),(o=i.find(".kg-tipText")).html(a),o.click(function(){o.hide(),i.find("#kg-revokeVerifyCode").focus()}),i.find("#kg-revokeVerifyCode").click(function(){o.hide(),i.find("#kg-revokeVerifyCode").focus()}),s=i.find(".kg-revokeMark"),i.find(".kg-revokeBtn").click(function(e){plus.showLoading();var n=$(this);l.sealService.applySMSCode({keysn:t,successCall:function(e){var t,i;e.result?(clearInterval(i),plus.hideLoading(),o.css({display:"block"}).html($.kgi18n.prop("sentSMSCode")),s.css({display:"block"}),t=60,i=setInterval(function(){0<=t?(t<10&&(t="0"+t),n.html(t+"秒"),t--):(n.html("验证码"),s.css({display:"none"}),o.html(a),clearInterval(i))},1e3)):l.errorCallback(e.message,r.errorCall)}})}),i.find("#kg-revokeVerifyCode").keydown(function(e){13==e.keyCode&&i.options.onOk.call(i)})):(setTimeout(function(){i.find("#kg-password").focus()},40),i.find("#kg-password").keydown(function(e){13==e.keyCode&&i.options.onOk.call(i)}))},onOk:function(){var e=this.find("#kg-password"),t=this.find("#kg-revokeVerifyCode");if(n){if(!t.val())return plus.alert(kinggrid.msg("in_verification_msg","KG_MSG"),function(){t.focus()}),!1}else if(!e.val())return plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){e.focus()}),!1;return r._onOk.call(this,(n?t:e).val()),!1}};return l.showDialog("signSignatureBtl",e)},revokeSignature:function(a){function o(t){void 0!==Signature.options.delCallBack&&Signature.options.delCallBack?Signature.options.delCallBack(s.signatureid,s.signatureData)&&s.fireRemove(function(e){e&&(t.remove?t:s).remove()}):s.fireRemove(function(e){e&&(t.remove?t:s).remove()})}var s=this;if("scanStamp"!=s.signatureData.stampType||Signature.options.clientConfig)if(t={target:s,_onOk:function(e,t){var i=this,n=s.signatureData.seal.esid;plus.showLoading(),n?(plus.hideLoading(),s.sealService.getRemoveAuthority(s.signatureid,s.signatureData,function(e){e?(o(i),a&&a({result:!0})):i.remove()})):s.sealService.verifyPwd({verify:Signature.options.verification,pwd:e,keysn:s.signatureData.keysn,successCall:function(e){plus.hideLoading(),!e.result||null!=e.delkeysn&&e.delkeysn!=s.signatureData.keysn?s.error(e,null,null,{_beginDlgOkCall:!0}):o(i),a&&a(e)},phoneshield:t})}},s.signatureData.phoneshield&&"client"==Signature.options.sealType)s.sealService.getPhoneShieldLic({phoneshield:"1"},function(e){"1"==e.phoneshield||"3"==e.phoneshield?(kinggrid.options.timeout=1e3*(e.validatetime+10),t._onOk("","1")):"2"==e.phoneshield?s.error({errcode:"11110"},"then"):s.error({errcode:"11109"},"then")});else{if(!Signature.options.showNoPW||"server"!=Signature.options.sealType)return s.showRevokeSignatureDialog(t);t._onOk(Signature.options.password)}else{var t={title:kinggrid.msg("RevokeSignature","KG_TITLE"),target:s,onCancel:!1},i=Signature.ScanStamp.call(s,function(){return s.showDialog("scanStampdlg",t)},function(e){e.result?o(i.dialog):s.error(e,null,null,{_beginDlgOkCall:!0}),a&&a(e)});i.getQrCodeImageByDelete(s.signatureData.esid)}},showDialog:function(t,e){var i,n,a,o,s,r,l=Utils.is("Array",e.target)?e.target:[e.target],c={title:kinggrid.msg("KinggridSignature","KG_TITLE"),onShow:function(){var t=this;Signature.editThemeColor(),setTimeout(function(){t.find("#kg-password").focus()},40),t.find("#kg-password").keydown(function(e){13==e.keyCode&&t.options.onOk.call(t)})},onCancel:e.errCall||function(){return plus.hideLoading(),!0},content:function(){var e=[Signature.options.template[t]].concat(l);return Utils.template.apply(null,e)}},u=(e=Utils.extend(c,e),plus.showDialog(t,e));return"showSealsBtl"===t&&(i=u.find("#sealTpl-dialog"),n=!1,r=s=o=a=0,i.prevObject[0].onmousedown=function(e){n=!0,null!=(e=e||event)&&(a=e.clientX,o=e.clientY,s=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.prevObject[0].style.top),r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.prevObject[0].style.left))},i.prevObject[0].onmousemove=function(e){var t;n&&null!=(e=e||event)&&(t=r+e.clientX-a,e=s+e.clientY-o,0<t&&0<e&&(i.prevObject[0].style.left=t+"px",i.prevObject[0].style.top=e+"px"))},i.prevObject[0].onmouseup=function(e){n&&(n=!1,r=s=o=a=0)}),"signatureInfoBtl"!=t&&"signInfoBtl"!=t||u.find(".ui-dialog-close").click(function(){u.close(),Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()}),u},runMove:function(e,t,i){var a,o=this;globalLisenter.trigger("startMove",o,e,t);return"client"==Signature.options.sealType&&Signature.options.moveable_self&&o.keysn!=o.signatureData.keysn?(Signature.alert(kinggrid.msg("cannot_move","KG_MSG")),!1):(e=e,t=t,a=i,i=function(e){var t=e.moveableRange;if(!t){for(n in e.position){var i=n;break}(e=$("#"+i).attr("kg-mita"))&&(t=e)}if(t){var n=$("#"+t);if(0<n.length)return{left:t=n.offset().left,right:e=n.offset().left+n.outerWidth(),top:i=n.offset().top,bottom:n=n.offset().top+n.outerHeight()}}return{left:0,right:0,top:0,bottom:0}}(o.signatureData),(t=Drag.create(t,e,!0,i)).onend=function(e,t,i,n){a&&a(t,i,n),globalLisenter.trigger("endMove",o,e,i,n),t&&(e=$(this),o.updatePos(e.attr("elemid"),{marginLeft:i,marginTop:n}),o.fireUpdate())},e.preventDefault(),t)},runSign:function(t,e,i){var n=this,a=n.signatureData;if(Signature.options._clientHW)return Signature.options._clientHW=!1,i({result:!0});plus.showLoading(),n.certService.sign({seal:this.signatureData.seal,keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,documentid:this.signatureData.documentid,documentname:this.signatureData.documentname,password:e,phoneshield:this.signatureData.phoneshield,signMeta:t,successCall:function(e){plus.hideLoading(),e.result&&(e.signeddata?(e.certinfo.algName=e.certinfo.algName.toUpperCase(),n.updateItem("signMeta",{hashAlg:t[0].hashAlg,encryptAlg:t[0].encryptAlg,signdata:t[0].signdata,signeddata:n.__findSignedData(e.signeddata),certinfo:e.certinfo,tsaInfo:e.tsaInfo})):(e.result=!1,e.errcode="signErr"),a.certType=Signature.options.certType),i&&i(e)}})}}),plus=kingPlus(),Signature.options=$.extend({savelogFlg:!0,b64Url:"/iWebSignature_base64",imageUrl:"/iWebSignature_image",languagesPath:"../kinggrid/languages",pw_enc_save:!0,autoCertMode:!0,showSealsDlg:!0,remberPwdAndShowSealsDlg:!0,showRememberPwd:!0,version:"iSignature_HTML5(V2.1)",verification:!1},kinggrid.options,{dialogConfig:{okValue:"确  定",cancelValue:"取  消",fixed:!0,backdropOpacity:.2,modal:!0},template:{},themeColor:{red:{"primary-background-color":"#C62929","primary-border-color":"#C62929","primary-color":"#ffffff","primary-hover-background-color":"#e45a5a","primary-hover-border-color":"#e45a5a","primary-hover-color":"#ffffff","default-background-color":"#ffffff","default-border-color":"#cccccc","default-color":"#333333","default-hover-background-color":"#ffffff","default-hover-border-color":"#C62929","default-hover-color":"#C62929","second-background-color":"#fff","second-color":"#C62929","second-hover-background-color":"#fff4f4","second-hover-color":"#C62929","primary-select-image":'url("image/select_red.png") no-repeat center white',"primary-box-shadow":"0px 2px 6px rgba(198, 41, 41,.2)"},blue:{"primary-background-color":"#1890ff","primary-border-color":"#1890ff","primary-color":"#ffffff","primary-hover-background-color":"#4eaaff","primary-hover-border-color":"#4eaaff","primary-hover-color":"#ffffff","default-background-color":"#ffffff","default-border-color":"#cccccc","default-color":"#333333","default-hover-background-color":"#ffffff","default-hover-border-color":"#1890ff","default-hover-color":"#1890ff","second-background-color":"#fff","second-color":"#1890ff","second-hover-background-color":"#eef7ff","second-hover-color":"#1890ff","primary-select-image":'url("image/select_blue.png") no-repeat center white',"primary-box-shadow":"0px 2px 6px rgba(0, 132, 255,.2)"}}},window.KGCONFIG),Signature.addProvider=function(e,t,i){Signature.factory[e][t]=i},Signature.init=function(e,t){this.Seals={},Utils.extend(Signature.options,e);var i=Signature.options;t=t||e.okCall,i.serverUrl&&(i.b64Url="_signature_b64",i.imageUrl="_signature_image",0<i.serverUrl.indexOf("?")?i.serverUrl+="&action=rest":i.serverUrl+="?action=rest"),aisleKing="client"==i.sealType?(i.clientUrl=i.https,Signature.aisleKing=kinggrid.surry(i.clientUrl||"http://127.0.0.1:9581","IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)):Signature.aisleKing=kinggrid.surry(i.serverUrl||i.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),(e=i.clientConfig)&&"client"===i.sealType?(i.LANGUAGE=i.clientConfig.LANGUAGE,Signature.AXI("SetParamByName",e,t)):t&&t.call(),t=jQuery.kgi18n.normaliseLanguageCode({}),i.isMobile=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent),i.LANGUAGE?i.Global=i.LANGUAGE.substring(0,2):(i.LANGUAGE=t,2<jQuery.kgi18n.normaliseLanguageCode({}).length?i.Global=t.substring(0,2):i.Global=t),i.autoCertMode&&(i.icon_sign=!1,i.icon_signverify=!1),this.dynamicLoadCss(i.languagesPath+"/style/language_"+i.Global+".css"),this.loadProperties(),globalLisenter.trigger("init")},Signature.factory={cert:{},seal:{}},Signature.SealService=SealService,Signature.CertService=CertService,Signature.asyn={},Signature._create=function(e){var o=this;return o.setAttr(e),o.certService=new Signature.factory.cert[o.certType](e),o.sealService=new Signature.factory.seal[o.sealType](e),o.on("createSignature",function(e,t,i){var n=e.signatureData,a=(e=[],"盖章成功");n.phone&&null!=n.phone&&""!=n.phone&&(a="盖章成功【手机短信验证"+n.phone+"】"),n=o._getLogInfo({LOGTYPE:"00",LOGSORT:"13",LOGMEMO:a,LOGSORTSUBCLASS:"1301"}),e.push(Utils.extend(t||{},n)),i&&e.push(o._getLogInfo({LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"数字签名成功"})),o.sealService.saveLog(e)}),this},function(){}),prototype=(signature.prototype=Signature.prototype,new signature),emptyInput="";function formartSignatureData(e,t,i){var n=[],a={};for(u in e){var o={},s=e[u];Utils.is("String",s)&&0!=s.indexOf("ey")?(o["b64_"+u]=e[u],n.push(o)):a[u]=s}var r,l=[],c=a;for(r in c)l.push(new Signature(r,c[r]).load(Signature.options));if(e=n.length)for(var a=Signature.options.signSize||5,u=Math.ceil(e/a),o=1;o<=u;o++){var s=a*(o-1),g=e<a*o?e:a*o;(aisleKing=kinggrid.surry(Signature.options.serverUrl)).request(Signature.options.b64Url,n.slice(s,g)).ret(function(e){if(e.result)for(var t in e){var i;0==t.indexOf("b64_")&&(i=e[t],Utils.is("String",i)&&(i=JSON.parse(i)),l.push(new Signature(t.substring(4),i).load(Signature.options)))}else Signature.prototype.error.call(null,e)})}null!=aisleKing&&(n=function(){t&&t(1==l.length?l[0]:l)},e?aisleKing.fin(n):n(),i)&&i()}Signature.scanCallBack=function(){},Signature._create.prototype=prototype,$.extend(prototype,{keyData:null,sealExpired:function(e,t,i,n,a){var o,s,r,l=this,c=!0;return void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid?l.certExpired(t,i,n):void 0===e.endata||null===e.endata?(e=Signature.options.serverUrl+"_key_sealIsExpired",a=(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(a)+1).toString(),$.ajax({url:e,type:"POST",data:{keysn:l.keyData.keysn,year:(new Date).getFullYear(),month:(new Date).getMonth(),date:(new Date).getDate(),index:a},async:!1,success:function(e){if(e.error)l.errorCallback({errcode:"11105"},t.errorCall);else{if(0==e.result)return l.certExpired(t,i,n);l.errorCallback({errcode:"11104"},t.errorCall)}return!1},error:function(e){l.errorCallback({errcode:"11105"},t.errorCall)}}),!1):(r=e.endata,a=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.substr(0,4)),e=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.substr(5,2)),c=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.substr(8,2)),o=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(r.substr(0,4)),s=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(r.substr(5,2)),r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(r.substr(8,2)),(c=o<a?(l.errorCallback({errcode:"11104"},t.errorCall),!1):a!=o||(s<e?(l.errorCallback({errcode:"11104"},t.errorCall),!1):e!=s||!(r<c&&(l.errorCallback({errcode:"11104"},t.errorCall),1))))&&l.certExpired(t,i,n))},certExpired:function(r,l,c){var u=this,g=!1;return void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid||(kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("KGGetCerInfo","").ret(function(e){var t,i,n,a=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(l.substr(0,4)),o=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(l.substr(5,2)),s=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(l.substr(8,2));e.result?(e=e.certinfo.notAfter,t=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(0,4)),i=0==(i=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(4,1)))?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(5,1)):_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(4,2)),n=0==(n=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(6,1)))?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(7,1)):_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e.substr(6,2)),t<a||a==t&&(i<o||o==i&&n<s)?u.errorCallback({errcode:"11103"},r.errorCall):g=!0):u.errorCallback({errcode:"11106"},r.errorCall),null!=c&&c(g)}),g)},errorCallback:function(e,t,i,n){t?(plus.hideLoading(),t.call(null,e,i)):this.error(e,i,null,n)},runHW:function(i,n){var e,a=this;plus.showLoading(),void 0!==i.imageData&&null!=i.imageData?(void 0!==i.beginCall&&i.beginCall&&i.beginCall.call(a),a.sealService.loadSeal({data:i.imageData,successCall:function(e){if(plus.hideLoading(),e.result&&e.seals.length){for(var t in e.seals){e.seals=[{width:i.width,height:i.height,imgext:e.seals[t].imgext,signname:i.name,signsn:e.seals[t].signsn,username:e.seals[t].username,imgdata:i.imageData,sealTag:e.seals[t].sealTag||e.seals[t].sealtag,seSeal:e.seals[t].seSeal,headinfoex:e.seals[t].headinfoex}];break}a.keyData=e,a.showSeals(n)}else a.errorCallback({errcode:"111000"},i.errorCall)},errorCall:function(e){a.errorCallback(e,i.errorCall)}})):i.qrCodeUserUid&&(plus.hideLoading(),(e={}).qrCodeUserUid=i.qrCodeUserUid,e.seals=i.sealData,e.reuslt=!0,e.ServerTime=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," "),e.username=i.username,e.esid=i.esid,i.stampType&&(e.stampType=i.stampType),a.keyData=e,a.showSeals(n))},run:function(i){var n=this;n.showPromptDialog(function(){return n.keyData?n.showSeals(i):(plus.showLoading(),void 0!==i.beginCall&&i.beginCall&&i.beginCall.call(n),n.sealService.loadSeal({successCall:function(t){plus.hideLoading(),t.result?t.seals&&t.seals.length?(n.keyData=t,n.sealService.getKeysn({},function(e){Signature._getCookie("ksn")!=e&&Signature.clearRPW(),Signature._showAndHideSealsDlg(n.keyData.seals),Signature.options.clientConfig||void 0===Signature.options.imgtag||0===Signature.options.imgtag||void 0!==t.ServerTime?(n.curDate=t.ServerTime,n.showSeals(i)):void 0!==n.serverUrl&&null!==n.serverUrl?(e={usercode:n.usercode,keysn:n.keyData.keysn,signname:n.signname,authcode:Signature.authcode},kinggrid.surry(n.serverUrl).request("_key_load",e).ret(function(e){e.result?(n.curDate=e.ServerTime,n.keyData=e,n.showSeals(i)):n.errorCallback(e,i.errorCall)})):(n.curDate=(new Date).toLocaleString(),n.showSeals(i))})):n.errorCallback({errcode:"11100"+Signature.options.imgtag},i.errorCall):n.errorCallback(t,i.errorCall)},errorCall:function(e){n.errorCallback(e,i.errorCall)}})),this})},getSealsByKeysn:function(e,n,t){var a=this;a.sealService.loadSeal({successCall:function(e){if(e.result){var t=[];if(void 0!==n&&null!=n){for(var i=0;i<e.seals.length;++i)t[i]=a.toBase64Img(e.seals[i]);n(t)}}},errorCall:function(e){a.errorCallback(e,t.errorCall)}})},loadSeals:function(t,i){var n=this;n.sealService.loadSeal({successCall:function(e){null!=t&&null!==e&&void 0!==e.seals&&null!==e.seals&&t(e)},errorCall:function(e){n.errorCallback(e,i&&i.errorCall?i.errorCall:null)}})},runSS:function(t,e){var i=this;null!==e&&(null==(i.keyData=e).seals||0==e.seals.length?i.errorCallback({errcode:"11107"},t.errorCall):void 0!==Signature.options.imgtag&&0!==Signature.options.imgtag&&void 0===e.ServerTime?void 0!==i.serverUrl&&null!==i.serverUrl?(e={usercode:i.usercode,keysn:i.keyData.keysn,signname:i.signname,authcode:Signature.authcode},kinggrid.surry(i.serverUrl).request("_key_load",e).ret(function(e){e.result?(i.curDate=e.ServerTime,i.keyData=e,i.showSeals(t)):i.errorCallback(e,t.errorCall)})):(i.curDate=(new Date).toLocaleString(),i.showSeals(t)):(i.curDate=e.ServerTime,i.showSeals(t)))},formatPos:function(e,i,n){var a={};if(e){var t=function(e){var t=e.elemid||e[0].id;a[t=t||"body"]=null!=i&&null!=n?{marginLeft:i,marginTop:n}:Utils.filter(e,t)};if(Utils.is("Array",e))for(var o=0;o<e.length;o++)t(e[o]);else Utils.is("String",e)?a[e]=null!=i&&null!=n?{marginLeft:i,marginTop:n}:{}:t(e)}else a.body={};return a},exec:function(i,n,a,t,o,s){function r(t){var e=c.signatureData;if(!t||!t.position)throw Error("no set position");t.offsetX&&t.offsetY?(t.changeOffsetXY&&t.changeOffsetXY(t),e.position=c.formatPos(t.position,t.offsetX,t.offsetY)):t.changeOffsetXY?(i={width:Math.ceil(9600*_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(a.width)/254),height:Math.ceil(9600*_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(a.height)/254)},i=t.changeOffsetXY(i),e.position=c.formatPos(t.position,i.offsetX,i.offsetY)):e.position=c.formatPos(t.position),i=t.signatureid||c.genId(),t&&t.scopePosition&&(null==Signature.options.extra&&(Signature.options.extra={}),Signature.options.extra[i]={scopePosition:t.scopePosition}),e.timeid=(new Date).getTime();var i,n=new Signature(i,e).load(Signature.options);t.okCall&&(e={name:a.signname,height:a.height,width:a.width,imgdata:c.toBase64Img(a)},t.isBatchSignature?t.okCall.call(n,function(e){},t.documentid):t.okCall.call(n,function(e){c.trigger("createSignature",n,t.logMeta,u),e&&n.show()},e)),plus.hideLoading()}var l,c=this,e=(delete c.signatureData,null!=i.protectedItemsType&&"1"==i.protectedItemsType?i.protectedItems:c.getProtectedData(i.protectedItems)),e={timestamp:{time:(null==i.signtime?new Date:new Date(Date.parse(i.signtime.replace(/-/g,"/")))).getTime(),signtime:null==i.showtime?i.signtime:i.showtime,timestampInfo:i.timestampInfo},appname:Signature.options.version,documentid:(null==i.documentid?c:i).documentid,documentname:(null==i.documentname?c:i).documentname,moveable:Utils.boolean(i,"moveable",Signature.options.moveable),keysn:c.keyData.keysn,orgname:c.keyData.orgname,usercode:c.keyData.usercode,username:c.keyData.username||a.username,phoneshield:!!Signature.options.phoneshield,gbOvalue:c.keyData.gbOvalue,seal:a,phone:Signature.options.verification?c.keyData.phone:null,moveableRange:i.moveableRange,protectedData:e,sealType:i.sealType||c.sealType,extparam:i.extparam,ver:Signature.version,postilFontSet:i.postilFontSet,dateTime:i.datetime},u=(c.keyData.stampType&&(e.stampType=c.keyData.stampType),a.esid&&(e.esid=a.esid),c.keyData.qrCodeUserUid&&(e.qrCodeUserUid=c.keyData.qrCodeUserUid),c.signatureData=e,c.certService.sData=c.signatureData,c.sealService.sData=c.signatureData,plus.showLoading(),Signature.options.autoCertMode||i.autoCert||c.autoCert||Signature.options.phoneshield&&"1"!=Signature.options.fjrsIsphone);u||"scanStamp"===e.stampType?(c.getSignData(e),l=c.getH5SignData(),i.signMeta&&l[Utils.is("Array",i.signMeta)?"concat":"push"](i.signMeta),i.beforeSignCall&&i.beforeSignCall.call(c,l),o?"client"==Signature.options.sealType?c.runSign(l,t,function(e){e.result&&(r(i),s)&&1<s.batchSignature.length&&(i.documentid=s.batchSignature[s.batchSignature.length-1].documentid,i.documentname=s.batchSignature[s.batchSignature.length-1].documentname,i.position=s.batchSignature[s.batchSignature.length-1].position,i.protectedItems=s.batchSignature[s.batchSignature.length-1].protectedItems,--s.batchSignature.length,c.exec(i,n,a,t,o,s)),n(e)}):c.sealService.verifyPwd({verify:Signature.options.verification,pwd:t,keysn:e.keysn,successCall:function(e){e.result?r(i):Signature.options.pwd_clear_flag&&c.onDeleteRPW&&c.onDeleteRPW(),n(e)},phoneshield:Signature.options.phoneshield}):c.keyData.noPassWord||c.signatureData.seal.esid?c.runSign(l,t,function(e){e.result?r(i):c.error(e,null,null,{_beginDlgOkCall:!0}),n({result:!0})}):c.sealService.checkKeysn.call(c,{keysn:c.signatureData.keysn},function(e){e.result?c.runSign(l,t,function(e){var t;e.result&&(t=c.keyData.seals,setTimeout(function(){Signature._showAndHideSealsDlg(t)}),r(i)),n(e)}):c.error(e,null,null,{_beginDlgOkCall:!0})})):o?r(i):c.sealService.verifyPwd({verify:Signature.options.verification,pwd:t,keysn:e.keysn,successCall:function(e){var t;e.result?(t=c.keyData.seals,setTimeout(function(){Signature._showAndHideSealsDlg(t)}),r(i)):Signature.options.pwd_clear_flag&&c.onDeleteRPW&&c.onDeleteRPW(),n(e)},phoneshield:Signature.options.phoneshield})},runPwd:function(i){var n=this;n.showPwdDialog({cancelCall:i.cancelCall,_onOk:function(e){Signature.options.showNoPW=!0,Signature.options.password=e;var t=this.find("#kg-remenberPwd").is(":checked");n.trigger("execSuccess",this,e,t),n.run($.extend(i,{beginCancalCall:function(){Signature.options.showNoPW=!1,Signature.options.password=emptyInput}}))}})},showPwdDialog:function(e){var i=this,n=e._onOk;i.showDialog("inputTpl",{onCancel:e.cancelCall,onShow:function(){var t=this;i.trigger("showSealsDialog_PW",t),Signature.editThemeColor(),setTimeout(function(){t.find("#kg-password").focus()},40),t.find("#kg-password").keydown(function(e){13==e.keyCode&&t.options.onOk.call(t)})},onOk:function(){var e=this.find("#kg-password"),t=e.val();return t?(n.call(this,t),this.remove()):plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){e.focus()}),!1},content:function(){return Utils.template.apply(null,[plus.template.inputTpl])}})},showPromptDialog:function(a){function o(t,e){var i,n;e.result?(e=e.certinfo.notAfter,n=(n=new Date(+new Date+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")).replace(/-/g,"/"),t.days=(i=e,n=n,i=new Date(r(e)),n=new Date(r(n)),Math.floor((i-n)/864e5)),g.invoke("KGGetPublicParm","Customer","ValidateCertUpdateURL","").ret(function(e){e&&(u=e)}),g.invoke("KGGetPublicParm","Public","HintRemainingDays","").ret(function(e){t.days>e?s(!0):(t.certStatus=t.days<=e&&0<t.days?1:0,s())})):(Signature.options.password=emptyInput,l.errorCallback({errmsg:e.errmsg}))}function s(e){if(!e){e=document.cookie.split("; ");for(var t=null,i=0;i<e.length;i++){var n=e[i].split("=");if("kg-certValidaty-dontShow"==n[0]){t=n[1];break}}e="true"==t}e?a&&a():l.showDialog("prompt",d)}function i(){u?window.open(u):l.errorCallback({errmsg:"获取地址失败"})}function r(e){return 0<e.indexOf("/")?e:e.slice(0,4)+"/"+e.slice(4,6)+"/"+e.slice(6,8)+" "+e.slice(8,10)+":"+e.slice(10,12)+":"+(e=e.slice(12,14))}var l=this,c={},u="",g=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),d=(l.clientConfig?g.invoke("KGGetPublicParm","Customer","ValidateCertExpireTime","").ret(function(e){(0,_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_0__.Z)(e)==String&&"true"==e.toLowerCase()?Signature.options.password||Signature._getCookie("pwd")?(e=Signature._getCookie("pwd")||Signature.options.password,g.invoke("KGGetCerInfo",e).ret(function(e){o(c,e)})):l.showPwdDialog({cancelCall:function(){plus.hideLoading()},_onOk:function(t){var i=this,n=i.find("#kg-remenberPwd").is(":checked");g.invoke("KGGetCerInfo",t).ret(function(e){e.result?(Signature.options.password=t,l.trigger("execSuccess",i,t,n),o(c,e)):l.errorCallback({errmsg:e.errmsg})})}}):s(!0)}):a(),{cancelCall:function(){},onShow:function(){Signature.editThemeColor();var e=Signature._color||"red",t=(setTimeout(function(){root.iframeDialog?($(window.top.document).find("[i-id=cancel]").html($.kgi18n.prop("GoToRenewal")),$(window.top.document).find("[data-kgi18n-html]").each(function(e){$(this).html($.kgi18n.prop($(this).data("kgi18n-html"))),$(this).addClass("kg-fontFamily")}),l.isMobile||$(window.top.document).find(".ui-dialog-button").css("float","right")):($("[i-id=cancel]").show(),$("[i-id=cancel]").html($.kgi18n.prop("GoToRenewal")),l.isMobile||$(".ui-dialog-button").css("float","right"))},100),$("[i-id=cancel]").click(i),(root.iframeDialog?$(window.top.document):this).find(".kg-promtInfo"));switch(c.certStatus){case 0:t.html('<i class="kg-icon-prompt"/><span data-kgi18n-html="RenewalPastDue"></span>');break;case 1:t.html('<i class="kg-icon-prompt"/><span data-kgi18n-html="RenewalInfoLeft"></span> <span id="kg-date">'+c.days+'</span> <span data-kgi18n-html="RenewalInfoRight"></span>'),this.find(".ui-dialog-checkInput").html('<div class="kg-tipCheck"><input type="checkbox" name="noPrompt" class="kg-primary-check-'+e+'" id="kg-noPrompt" >&nbsp;<label for="kg-noPrompt" data-kgi18n-html="NoPrompt">不再提示</label></div>')}},onOk:function(){var e;this.find("#kg-noPrompt").is(":checked")&&((e=new Date).setTime(e.getTime()+864e5),document.cookie="kg-certValidaty-dontShow=true;expires=+"+e.toGMTString()),c.certStatus&&a&&a()},content:function(){return Utils.template.apply(null,[plus.template.prompt])}})},getPassCheck:function(e,t,i){if(e&&1==e)return e;if(void 0===i||!0===i||"auto"===i)try{return t.find("#kg-remenberPwd").is(":checked")}catch(e){}return!1},showSeals:function(c){var e,t,i,n,u=this,a={errorCall:c.errorCall,cancelCall:c.cancelCall,beginCancalCall:c.beginCancalCall,protectedItems:c.protectedItems,protectedItemsType:c.protectedItemsType,protectedItemsCheckedAll:null==c.protectedItemsCheckedAll||c.protectedItemsCheckedAll,_onOk:function(t,i,e,n,a,o){var s=this,r=new plus.kgFont(null==s.fontSel?null==u.signdate?{}:u.signdate:s.fontSel),l=s.isCheck;!1!==Signature.options.showSealsDlg&&u.autoDlg||!Signature.options.signdate||!Signature.options.signdate.ischeck||(l=Signature.options.signdate.ischeck),c.protectedItems=null==s.proItems?0==c.protectedItemsCheckedAll?[]:c.protectedItems:s.proItems,c.datetime={isCheck:l,fontDate:r},(r=new plus.kgFont(null==s.postilFontSet?null==u.thirdConfig||null==u.thirdConfig.postilFontSet?{}:u.thirdConfig.postilFontSet:s.postilFontSet,"0")).fontValue=null!=u.postilFontSet&&null!=u.postilFontSet.fontValue?u.postilFontSet.fontValue:"",c.postilFontSet=r,null!=n?(c.signtime=n,null!=a?(c.showtime=(a.TimeExt?n+" ("+a.TimeExt+")":n).replace(/-/g,"/"),c.showtime+=kinggrid.msg("timestamp_time","KG_MSG"),c.timestampInfo=a):(c.showtime=new Date(Date.parse(n.replace(/-/g,"/"))).toLocaleString(),c.showtime+=kinggrid.msg("server_time","KG_MSG"))):(c.signtime=void 0,c.showtime=(new Date).toLocaleString(),c.showtime+=kinggrid.msg("local_time","KG_MSG")),o=u.getPassCheck(o,s,Signature.options.showSealsDlg),void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid?c.batchSignature?u.sealService.verifyPwd({verify:Signature.options.verification,pwd:i,usercode:null==c.usercode?"":c.usercode,keysn:u.keyData.keysn,successCall:function(e){if(e.result){for(e=0;e<c.batchSignature.length&&(c.batchSignature[e].signtime=c.signtime,c.batchSignature[e].showtime=c.showtime,null!=c.position&&(c.batchSignature[e].position=c.position),c.batchSignature[e].autoCert=c.autoCert,c.batchSignature[e].okCall=c.okCall,c.batchSignature[e].cancelCall=c.cancelCall,c.batchSignature[e].beginCall=c.beginCall,c.batchSignature[e].endCall=c.endCall,null!=c.protectedItems&&(c.batchSignature[e].protectedItems=c.protectedItems),c.batchSignature[e].protectedItemsType=c.protectedItemsType,c.batchSignature[e].datetime=c.datetime,c.batchSignature[e].offsetX=c.offsetX,c.batchSignature[e].offsetY=c.offsetY,c.batchSignature[e].changeOffsetXY=c.changeOffsetXY,c.batchSignature[e].isBatchSignature=!0,u.exec(c.batchSignature[e],function(e){e.result?void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(u):void 0!==Signature.options.showSealsDlg&&!0!==Signature.options.showSealsDlg&&!u.autoDlg||u.trigger("execSuccess",s,i,o):u.errorCallback(e,c.errorCall)},t,i,!0,c),void 0!==c.batchSignature[e].endCall&&c.batchSignature[e].endCall&&c.batchSignature[e].endCall.call(u),"client"!=Signature.options.sealType||!c.autoCert);++e);void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(u),void 0!==Signature.options.showSealsDlg&&!0!==Signature.options.showSealsDlg&&!u.autoDlg||s.remove()}else Signature.options.pwd_clear_flag&&u.onDeleteRPW&&u.onDeleteRPW(),u.errorCallback(e,c.errorCall)},phoneshield:Signature.options.phoneshield}):(u.exec(c,function(e){e.result?(void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(u):void 0!==Signature.options.showSealsDlg&&!0!==Signature.options.showSealsDlg&&!u.autoDlg||u.trigger("execSuccess",s,i,o),s.remove()):u.errorCallback(e,c.errorCall,null,{_beginDlgOkCall:!0})},t,i),void 0!==c.endCall&&c.endCall&&c.endCall.call(u)):void 0!==u.curDate&&null!==u.curDate&&u.sealExpired(t,c,u.curDate,function(e){e?c.batchSignature?u.sealService.verifyPwd({verify:Signature.options.verification,pwd:i,keysn:u.keyData.keysn,successCall:function(e){if(e.result){for(e=0;e<c.batchSignature.length&&(c.batchSignature[e].signtime=c.signtime,c.batchSignature[e].showtime=c.showtime,null!=c.position&&(c.batchSignature[e].position=c.position),c.batchSignature[e].autoCert=c.autoCert,c.batchSignature[e].okCall=c.okCall,c.batchSignature[e].cancelCall=c.cancelCall,c.batchSignature[e].beginCall=c.beginCall,c.batchSignature[e].endCall=c.endCall,null!=c.protectedItems&&(c.batchSignature[e].protectedItems=c.protectedItems),c.batchSignature[e].protectedItemsType=c.protectedItemsType,c.batchSignature[e].datetime=c.datetime,c.batchSignature[e].offsetX=c.offsetX,c.batchSignature[e].offsetY=c.offsetY,c.batchSignature[e].changeOffsetXY=c.changeOffsetXY,c.batchSignature[e].isBatchSignature=!0,u.exec(c.batchSignature[e],function(e){e.result?void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(u):void 0!==Signature.options.showSealsDlg&&!0!==Signature.options.showSealsDlg&&!u.autoDlg||u.trigger("execSuccess",s,i,o):u.errorCallback(e,c.errorCall)},t,i,!0),void 0!==c.batchSignature[e].endCall&&c.batchSignature[e].endCall&&c.batchSignature[e].endCall.call(u),"client"!=Signature.options.sealType||!c.autoCert);++e);void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(u),void 0!==Signature.options.showSealsDlg&&!0!==Signature.options.showSealsDlg&&!u.autoDlg||s.remove()}else u.errorCallback(e,c.errorCall)},phoneshield:Signature.options.phoneshield}):(u.exec(c,function(e){e.result?(void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(u):void 0!==Signature.options.showSealsDlg&&!0!==Signature.options.showSealsDlg&&!u.autoDlg||u.trigger("execSuccess",s,i,o),s.remove()):u.errorCallback(e,c.errorCall,null,{_beginDlgOkCall:!0})},t,i),void 0!==c.endCall&&c.endCall&&c.endCall.call(u)):u.errorCallback({errcode:"11103"},c.errorCall)},e)}};void 0===Signature.options.showSealsDlg||(e=!0,"auto"==Signature.options.showSealsDlg&&(t=u.keyData).seals&&1==t.seals.length&&(e=!1),u.autoDlg=e,!1!==Signature.options.showSealsDlg&&e)?this.showSealsDialog(a):(void 0===Signature.options.password&&void 0!==u.password&&(Signature.options.password=u.password),e=Signature._getCookie("pwd"),!Signature.options.remberPwdAndShowSealsDlg&&e&&1==u.keyData.seals.length?Signature.options.password=e:Signature.options.showSealsDlg&&(Signature.options.showSealsDlg=!0),void 0===Signature.options.password?u.errorCallback({errcode:"11108"},c.errorCall):(i=u.getSignTimeStamp(u.getProtectedData(c.protectedItems)),null!=Signature.options.timestamp&&1==Signature.options.timestamp?"client"==Signature.options.sealType?(n=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)).invoke("KGGetTSURLInfo").ret(function(e){e.result?n.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,i,"").ret(function(e){e.result?a._onOk.call(u,u.keyData.seals[0],Signature.options.password,0,e.TimeStr,e):(u.errorCallback(e,c.errorCall,"KGGetTSWithDigest"),a._onOk.call(u,t.seals[0],pwdVal,0))}):(u.errorCallback(e,c.errorCall,"KGGetTSURLInfo"),a._onOk.call(u,t.seals[0],pwdVal,0))}):$.ajax({url:Signature.options.serverUrl+"_key_getTimeStamp",type:"POST",data:{keysn:u.keyData.keysn,signTimeStamp:i},async:!1,success:function(e){e.result?a._onOk.call(u,u.keyData.seals[0],Signature.options.password,0,e.timestamp):a._onOk.call(u,u.keyData.seals[0],Signature.options.password,0)},error:function(e){a._onOk.call(u,u.keyData.seals[0],Signature.options.password,0)}}):a._onOk.call(u,u.keyData.seals[0],Signature.options.password,0)))},showSealsDialog:function(d){var h=this,f=h.keyData,p=(null!=h.signdate&&(f.signDateIsCheck=h.signdate.ischeck),f.noPassWord=-1!=["scanStamp"].indexOf(f.stampType)),e=(f.isMobile=Signature.options.isMobile,f.showRememberPwd=Signature.options.showRememberPwd,null!=d.protectedItemsType&&"1"==d.protectedItemsType?d.protectedItems:h.getProtectedData(d.protectedItems));f.showProtectedBtn=e&&0<e.length&&Signature.options.showProtectedBtn,f.verification=h.verification;for(var t=d.protectedItemsCheckedAll,i=[],n=0;e&&n<e.length;n++)i[n]=e[n],i[n].isChecked=t;null!=h.thirdConfig&&(f.thirdConfig=h.thirdConfig),f.newProItems=i,f.Global=Signature.options.Global;var a=[f],_=d._onOk,o=d.beginCancalCall,e={onCancel:d.cancelCall,onShow:function(){var t,i=this,e=(Signature.editThemeColor(),Signature.scanCallBack(),i.find(".kg-switcher")),o=(e.length&&(t=new Utils.Switcher(e[0],{}),e.find(".arrow-right").click(function(e){e.preventDefault(),t.swipeNext()}),e.find(".arrow-left").click(function(e){e.preventDefault(),t.swipePrev()}),e.find(".kg-guide span").click(function(e){e.preventDefault(),t.to(+this.getAttribute("index"))}),h.switcher=t),i.find("#kg-dateSet").click(function(e){h.showFontDialog(i)}),i.find("#kg-fontSet").click(function(e){h.showPostilFontDialog(i)}),null!=h.thirdConfig&&(null!=h.thirdConfig.commonlang&&i.find("#i-kg-common-lang").change(function(e){e=this.options[this.selectedIndex].innerHTML,i.find("#kg-postil-value").val(e)}),null!=h.thirdConfig.fontEditCall&&i.find(".kg-fontSet-edit").click(function(){h.thirdConfig.fontEditCall(h.thirdConfig)}),h.thirdConfig.postilFontSet)&&(e=i.find("#kg-postil-value"),h.thirdConfig.postilFontSet.fontFamily&&e.css({fontFamily:h.thirdConfig.postilFontSet.fontFamily}),h.thirdConfig.postilFontSet.fontSize&&e.css({fontSize:h.thirdConfig.postilFontSet.fontSize}),h.thirdConfig.postilFontSet.fontColor)&&e.css({color:h.thirdConfig.postilFontSet.fontColor}),Signature.options.verification?setTimeout(function(){i.find("#kg-password").focus()},40):setTimeout(function(){i.find("#kg-verification").focus()},500),Signature.options.keysn),s=h.keyData.phone,r=i.find(".kg-tipText");r.html(s),r.click(function(){r.hide(),i.find("#kg-verification").focus()}),i.find("#kg-verification").click(function(){r.hide(),i.find("#kg-verification").focus()}),i.find(".kg-verificationButton").click(function(e){plus.showLoading();var n=$(this),a=i.find(".kg-verificationMark");h.sealService.applySMSCode({keysn:o,successCall:function(e){var t,i;e.result?(clearInterval(i),plus.hideLoading(),r.css({display:"block"}).html($.kgi18n.prop("sentSMSCode")),a.css({display:"block"}),t=60,i=setInterval(function(){0<=t?(t<10&&(t="0"+t),n.html(t+"秒"),t--):(n.html("验证码"),a.css({display:"none"}),r.html(s),clearInterval(i))},1e3)):h.errorCallback(e.massage,d.errorCall)}})}),Signature.options.password&&i.find("#kg-password").val(Signature.options.password),h.trigger("showSealsDialog",i),Signature.options.showNoPW&&Signature.options.phoneshield||h.trigger("showSealsDialog_PW",i),i.find("#kg-password").keydown(function(e){13==e.keyCode&&i.options.onOk.call(i)}),i.find("#kg-verification").keydown(function(e){13==e.keyCode&&i.options.onOk.call(i)}),i.find("#kg-protectedDataSet").click(function(e){h.showProtectedDataDialog(i,d,f)})},onOk:function(){var t,i,n=this,e=n.find("#kg-password"),a=e.val()||Signature.options.password,o=n.find("#kg-verification").val(),s=n.find(".kg-wrapper .active"),r=(n.isCheck=n.find("#kg-addDate").is(":checked"),n.find("#kg-remenberPwd").is(":checked")),l=n.find("#kg-postil-value").val();if(h.postilFontSet=null==h.postilFontSet?{}:h.postilFontSet,h.postilFontSet.fontValue=l,Signature.options.verification){if(!o)return plus.alert(kinggrid.msg("in_verification_msg","KG_MSG"),function(){setTimeout(function(){e.focus()},100)}),!1;a=o}else if(!Signature.options.phoneshield&&!p&&!a)return plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){setTimeout(function(){e.focus()},100)}),!1;if(o=h.keyData.seals[s.attr("index")].SealTag||h.keyData.seals[s.attr("index")].sealtag,"client"==Signature.options.sealType&&o&&"GM"==o){var c=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),o=h.keyData.seals[s.attr("index")].SealCert||h.keyData.seals[s.attr("index")].signercert,l=h.keyData.seals[s.attr("index")].ValidStart||h.keyData.seals[s.attr("index")].validstart,u=h.keyData.seals[s.attr("index")].ValidEnd||h.keyData.seals[s.attr("index")].validend,g=h.keyData.seals[s.attr("index")].CertList||h.keyData.seals[s.attr("index")].certlist;c.invoke("KGValidate_GM","",o,l,u,g,"").ret(function(e){if(!e.result)return h.errorCallback(e,d.errorCall,"KGValidate_GM"),!1;var t;null!=Signature.options.timestamp&&1==Signature.options.timestamp?(t=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)).invoke("KGGetTSURLInfo").ret(function(e){e.result?t.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,h.getSignTimeStamp(h.getProtectedData(d.protectedItems)),"").ret(function(e){e.result?_.call(n,f.seals[s.attr("index")],a,s.attr("index"),e.TimeStr,e,!!r):(h.errorCallback(e,d.errorCall,"KGGetTSWithDigest"),_.call(n,f.seals[s.attr("index")],a,s.attr("index"),void 0,void 0,!!r))}):h.errorCallback(e,d.errorCall,"KGGetTSWithDigest")}):_.call(n,f.seals[s.attr("index")],a,s.attr("index"),void 0,void 0,!!r)})}else{if("client"!=Signature.options.sealType||!h.keyData.seals[s.attr("index")].sealtag||"GB"!=h.keyData.seals[s.attr("index")].sealtag)return s=n.find(".kg-wrapper .active"),n.isCheck=n.find("#kg-addDate").is(":checked"),i=h.getSignTimeStamp(h.getProtectedData(d.protectedItems)),null!=Signature.options.timestamp&&1==Signature.options.timestamp?"client"==Signature.options.sealType?(c=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)).invoke("KGGetTSURLInfo").ret(function(e){e.result?c.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,i,"").ret(function(e){e.result?_.call(n,f.seals[s.attr("index")],a,s.attr("index"),e.TimeStr,e):(h.errorCallback(e,d.errorCall,"KGGetTSWithDigest"),_.call(n,f.seals[s.attr("index")],a,s.attr("index")))}):h.errorCallback(e,d.errorCall,"KGGetTSURLInfo")}):$.ajax({url:Signature.options.serverUrl+"_key_getTimeStamp",type:"POST",data:{keysn:h.keyData.keysn,signTimeStamp:i},async:!1,success:function(e){var t;e.result?e.TimeStampResponse?(t=Utils.eosFormatTime(e.TimeStr),_.call(n,f.seals[s.attr("index")],a,s.attr("index"),t,e)):_.call(n,f.seals[s.attr("index")],a,s.attr("index"),e.timestamp):_.call(n,f.seals[s.attr("index")],a,s.attr("index"))},error:function(e){_.call(n,f.seals[s.attr("index")],a,s.attr("index"))}}):_.call(n,f.seals[s.attr("index")],a,s.attr("index")),!1;c=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),t=h.keyData.seals[s.attr("index")],c.invoke("KGVerifyGBSealAction",t.sesealinfo,t.signsn).ret(function(e){if(!e.result)return h.errorCallback(e,d.errorCall,"KGVerifyGBSealAction"),!1;h.keyData.gbOvalue=e.ovalue,_.call(n,t,a,s.attr("index"),void 0,void 0,!!r)})}},content:function(){a.push(h.toBase64Img);var e=[Signature.options.template.showSealsBtl].concat(a);return(Signature.options.showNoPW||Signature.options.phoneshield)&&(e=[Signature.options.template.showSealsBtl_nopassword].concat(a)),Utils.template.apply(null,e)}};void 0!==o&&o&&(e=Utils.extend({onCancel:function(){void 0!==o&&o&&o.call(h),this.close()}},e)),Signature.options.showNoPW||Signature.options.phoneshield?h.showDialog("showSealsBtl_nopassword",e):h.showDialog("showSealsBtl",e),Signature.options.showSignExpirePrompt&&null!=f.currenttime&&null!=f.currenttime&&null!=f.overdate&&null!=f.overdate&&(e=new Date(f.currenttime),(t=Math.floor((new Date(f.overdate).getTime()-e.getTime())/864e5))<=f.hintdays)&&0<=t&&(!localStorage.getItem("lastAlertDate")||null==localStorage.getItem("lastAlertDate")||""==localStorage.getItem("lastAlertDate")||(i=localStorage.getItem("lastAlertDate"),i=new Date(i),0<e.getTime()-i.getTime()))&&h.showExpirtDialog("当前用户还有"+t+"天过期，请及时更新！",f.currenttime)},showProtectedDataDialog:function(n,a,o){var t=[{newProData:o.newProItems,proItemsCheckedAll:a.protectedItemsCheckedAll}],e={title:kinggrid.msg("ProtectedDataSet","KG_TITLE"),content:function(){t.push(Utils.html2Escape);var e=[Signature.options.template.protectedDataSetBtl].concat(t);return Utils.template.apply(null,e)},onShow:function(){Signature.editThemeColor()},onOk:function(){for(var i=o.newProItems.length;i--;)s.find("input[name='kg-proItem']").each(function(e,t){if(this.checked&&$(this).val()==o.newProItems[i].field)return!(o.newProItems[i].isChecked=!0);o.newProItems[i].isChecked=!1});var e=[];if(null!=a.protectedItemsType&&"1"==a.protectedItemsType)for(var t=0;t<o.newProItems.length;t++)o.newProItems[t].isChecked&&e.push(o.newProItems[t]);else for(t=0;t<o.newProItems.length;t++)o.newProItems[t].isChecked&&e.push(o.newProItems[t].field);n.proItems=e}},s=plus.showDialog("protectedDataSetBtl",e);return s.find("#kg-proData-items").on("click",function(e){if("LABEL"==e.target.tagName&&s.find("#kg-selectedProData").text($(e.target).text().split("]")[1]),"checkbox"==e.target.type)if($(e.target).is(":checked")){e=!0;for(var t=s.find("input[name='kg-proItem']"),i=0;i<t.length;i++)if(!t[i].checked){e=!1;break}e&&(s.find("input[name='selectAll']")[0].checked=!0,a.protectedItemsCheckedAll=!0)}else s.find("input[name='selectAll']")[0].checked=!1,a.protectedItemsCheckedAll=!1}),s.find("#kg-selectBox").on("click",function(e){if($(e.target).is(":checked")){a.protectedItemsCheckedAll=!0,e=s.find("input[name='kg-proItem']");for(var t=0;t<e.length;t++)e[t].checked=!0,o.newProItems[t].isChecked=!0}else for(a.protectedItemsCheckedAll=!1,e=s.find("input[name='kg-proItem']"),t=0;t<e.length;t++)e[t].checked=!1,o.newProItems[t].isChecked=!1}),s},showPostilFontDialog:function(e){var t=null==this.thirdConfig||null==this.thirdConfig.postilFontSet?{}:this.thirdConfig.postilFontSet,i=plus.defaultFont,n=(null==t.fontFamily?i:t).fontFamily,a=(null==t.fontSize?i:t).fontSize,i=i.fontColor,o=(null!=t.fontColor&&/^#([0-9a-fA-f]{6})$/.test(t.fontColor)&&(i=t.fontColor.toUpperCase()),null!=e.postilFontSet&&(n=e.postilFontSet.fontFamily,a=e.postilFontSet.fontSize,i=e.postilFontSet.fontColor),[{fontFamily:this.getArrayPush(Signature.options.fontTemplate.fontFamily,n),fontSize:this.getArrayPush(Signature.options.fontTemplate.fontSize,a),fontColor:this.getArrayPush(Signature.options.fontTemplate.fontColor,i),dFontFamily:n,dFontSize:a,dFontColor:i}]),t={title:$.kgi18n.prop("FontSetting"),content:function(){var e=[Signature.options.template.fontSetBtl].concat(o);return Utils.template.apply(null,e)},onShow:function(){Signature.editThemeColor()},onOk:function(){e.postilFontSet={fontFamily:this.find("#kg-fontFamily").val(),fontSize:this.find("#kg-fontSize").val(),fontColor:kinggrid.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor"))},e.find("#kg-postil-value").css("font-family",e.postilFontSet.fontFamily),e.find("#kg-postil-value").css("font-size",e.postilFontSet.fontSize+"px"),e.find("#kg-postil-value").css("color",e.postilFontSet.fontColor)}},s=plus.showDialog("fontSetBtl",t);return s.find("#kg-select-color").on("click",function(){s.find(".kg-color-div").css("display","block"),s.find("#kg-color-ul").css("display","block")}),s.find("#kg-color-ul li a").click(function(){$("#kg-select-color").css("backgroundColor",$(this).css("backgroundColor")),s.find(".kg-color-div").css("display","none"),s.find("#kg-color-ul").css("display","none")}),s.find(".kg-color-div").on("mouseover",function(e){this.contains(e.fromElement||e.relatedTarget)||$(this).show()}),s.find(".kg-color-div").on("mouseout",function(e){this.contains(e.toElement||e.relatedTarget)||$(this).hide()}),s},showFontDialog:function(t){var e=this,i=plus.dafaultDate,n=null==e.signdate?{}:e.signdate,a=plus.defaultFont,e=this,o=(e=(null==n.fontFormat?a:n).fontFormat,(null==n.fontFamily?a:n).fontFamily),s=(null==n.fontSize?a:n).fontSize,r=a.fontColor,l=(null!=n.fontColor&&/^#([0-9a-fA-f]{6})$/.test(n.fontColor)&&(r=n.fontColor.toUpperCase()),n=(null==n.position?a:n).position,null!=t.fontSel&&(e=t.fontSel.fontFormat,o=t.fontSel.fontFamily,s=t.fontSel.fontSize,r=t.fontSel.fontColor,n=plus.fontTemplate.position[t.fontSel.fontPositionIndex]),this.getArrayPush(Signature.options.fontTemplate.fontFormat,e)),c=[{fontFormat:this.getFormatDate(l,i),fontFamily:this.getArrayPush(Signature.options.fontTemplate.fontFamily,o),fontSize:this.getArrayPush(Signature.options.fontTemplate.fontSize,s),fontColor:this.getArrayPush(Signature.options.fontTemplate.fontColor,r),fontPosition:Signature.options.fontTemplate.position,dFontFormat:kinggrid.Utils.formatDate(new Date(i),e),dFontFamily:o,dFontSize:s,dFontColor:r,dFontPosition:n}],i={title:kinggrid.msg("DateSet","KG_TITLE"),content:function(){var e=[Signature.options.template.dateSetBtl].concat(c);return Utils.template.apply(null,e)},onShow:function(){Signature.editThemeColor()},onOk:function(){var e=this.find("#kg-fontFormat").get(0).selectedIndex;t.fontSel={fontFormat:l[e],fontFamily:this.find("#kg-fontFamily").val(),fontSize:this.find("#kg-fontSize").val(),fontColor:kinggrid.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor")),fontPositionIndex:this.find("#kg-fontPosition").get(0).selectedIndex}}},u=plus.showDialog("dateSetBtl",i);return u.find("#kg-select-color").on("click",function(){"block"==u.find(".kg-color-div").css("display")?(u.find(".kg-color-div").css("display","none"),u.find("#kg-color-ul").css("display","none")):(u.find(".kg-color-div").css("display","block"),u.find("#kg-color-ul").css("display","block"))}),u.find("#kg-color-ul li a").click(function(e){e.stopPropagation(),u.find("#kg-select-color").css("backgroundColor",$(this).css("backgroundColor")),u.find("#kg-select-color").css("borderColor",$(this).css("backgroundColor")),u.find(".kg-color-div").css("display","none"),u.find("#kg-color-ul").css("display","none")}),u.find(".kg-color-div").on("mouseover",function(e){this.contains(e.fromElement||e.relatedTarget)||$(this).show()}),u.find(".kg-color-div").on("mouseout",function(e){this.contains(e.toElement||e.relatedTarget)||$(this).hide()}),u},getArrayPush:function(e,t){return-1==jQuery.inArray(t,e)&&e.push(t),e},getFormatDate:function(e,t){for(var i=[],n=0;n<e.length;n++)i[n]=kinggrid.Utils.formatDate(new Date(t),e[n]);return i},genId:function(){return now()+rand()},getSeal:function(e){return this.keyData.seals[e]},saveSignature:function(e,t,i,n){var a,o,s=this;null!=e&&null!=t&&null!=i&&(a=Signature.options.clientCode||"",o=Signature.options.keysn,e=null!=Signature.options.cache_path&&null!=Signature.options.cache_path?{clientCode:a,keysn:o,documentId:e,signatureId:t,signaturedata:i,cachepath:Signature.options.cache_path}:{clientCode:a,keysn:o,documentId:e,signatureId:t,signaturedata:i,cachepath:""},kinggrid.surry(Signature.options.serverUrl).request("_signature_saveHtmlSignature",e).ret(function(e){null!=n&&n.call(s,e)}))},removeSignature:function(e,t,i){var n=this;null!=e&&null!=t&&(e={documentId:e,signatureId:t},kinggrid.surry(Signature.options.serverUrl).request("_signature_reomveHtmlSignature",e).ret(function(e){null!=i&&i.call(n,e)}))},getSaveSignatures:function(e,t,i){null!=e&&kinggrid.surry(Signature.options.serverUrl).request("_signature_getHtmlSignature",{documentId:e}).ret(function(e){Signature._verfiyInfotoServer=e.verfiyInfotoServer,e.result?t(e.sign):i&&i(e.result)})},showExpirtDialog:function(e,t){plus.showDialog("showExpirtDialog",{content:'<div class="kg-dialog kg-dialog-runSignature" id="sealExpirt-dialog"><div class="kg-dialog-content">'+e+'</div><div ><input type="checkbox" name="noMorePrompts" id="kg-noMorePrompts">&nbsp;<label for="kg-noMorePrompts">不再提示</label></div> </div>',onOk:function(){this.find("#kg-noMorePrompts").is(":checked")&&localStorage.setItem("lastAlertDate",t)},onCancel:function(){}})},getRPW:function(e){if(this.ongetRPW)return this.ongetRPW(e)}}),$.extend(Signature.options,{certType:"client",sealType:"client",clientUrl:"http://127.0.0.1:9581",moveable:!0,signable:!0,fontTemplate:plus.fontTemplate,template:{showSealsBtl:plus.template.sealTpl,showSealsBtl_nopassword:plus.template.sealTpl_noInput,signSignatureBtl:'<div id="kg-dialog-sign" class="kg-dialog kg-dialog-password kg-dialog-sign"><div class="kg-form"><div class="form-item clearfix"><% if(this.verification){%><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="VerifyCode">验证码</label><div class="kg-sm kg-sm-7" style="position:relative"> <input type="password" style="text-indent:10px" name="kgpassword" autocomplete="new-password" id="kg-revokeVerifyCode" class="form-control"><span class="kg-verificationButton kg-revokeBtn kg-second-btn-red" style="width:70px;font-size:12px" title="获取短信验证码" data-kgi18n-title="SMSCodeTip" data-kgi18n-html="VerifyCode">验证码</span><span class="kg-tip" style="right:70px"></span><span class="kg-tipText"></span><span class="kg-verificationMark kg-revokeMark"/></div><%}else{%><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="PassWord">密码</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div><%}%> </div></div></div>',protectedDataSetBtl:'<div id="kg-setProData" class="kg-dialog "><div id="kg-pro-data" class="kg-sm-13 kg-dialog-proData "><% var newProData = this.newProData; %><% var isAllChecked = this.proItemsCheckedAll; %><div id="kg-proData-items" class="kg-dialog-proData-items"><% for(var i=0;i<newProData.length;i++){%><div class="kg-dialog-proData-item"><% var proId = "proItem"+i; %><% var filedd = newProData[i].desc && newProData[i].desc != "" ? newProData[i].desc : newProData[i].field; %><% var content = "[" + filedd+"]" + arguments[0](newProData[i].value); %><% if(newProData[i].isChecked){ %><input type="checkbox" checked name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" custom="pro-value"><% content%></label>&nbsp;<% } %><% else{ isAllChecked = false; %><input type="checkbox" name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label"  custom="pro-value"><% content%></label>&nbsp;<% } %></div><%}%></div><div class="kg-dialog-line"></div><div class="kg-dialog-proData-selProData"><label id="kg-selectedProData" class="kg-selProData"></label></div></div><div ><% if(isAllChecked){ %><input type="checkbox" checked  name="selectAll" id="kg-selectBox" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value" data-kgi18n-html="SelectAll">全部选中</label>&nbsp;<% } else{ %><input type="checkbox"  name="selectAll" id="kg-selectBox" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value" data-kgi18n-html="SelectAll">全部选中</label>&nbsp;<% } %></div></div>',dateSetBtl:'<div id="kg-setDate" class="kg-dialog kg-dialog-Date"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Format">格式</label><div class="kg-sm kg-sm-6"><select name="fontFormat" id="kg-fontFormat" class="kg-select kg-fontFormat"><% var fontFormat = this.fontFormat; %><% for(var i=0;i<fontFormat.length;i++) {%><% if(fontFormat[i] == this.dFontFormat){%><option class="kg-option" value="<% fontFormat[i]%>" selected><% fontFormat[i]%></option><%}else{%><option class="kg-option" value="<% fontFormat[i]%>"><% fontFormat[i]%></option><%}%><%}%></select></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Font">字体</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Size">尺寸</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Color">颜色</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Location">位置</label><div class="kg-sm kg-sm-6"><select name="fontPosition" id="kg-fontPosition" class="kg-select kg-fontPosition"><% var fontPosition = this.fontPosition; %><% for(var i=0;i<fontPosition.length;i++) {%><% if(fontPosition[i] == this.dFontPosition){%><option class="kg-option" value="<% fontPosition[i]%>" selected ><% fontPosition[i]%></option><%}else{%><option class="kg-option" value="<% fontPosition[i]%>" ><% fontPosition[i]%></option><%}%><%}%></select></div> </div></div></div>',fontSetBtl:'<div id="kg-setFont" class="kg-dialog kg-dialog-font"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Font">字体：</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Size">尺寸：</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Color">颜色：</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div></div></div>'}}),Signature.list={},Signature.updateList=[],Signature.removeList=[],Signature.loadSignature=function(e,t,i,n){var a={};null==Signature.options.extra&&(Signature.options.extra={}),a[e]=t,null!=a.extra&&(Signature.options.extra[a.signatureid]=a.extra),formartSignatureData(a,i||function(e){Signature.verify()},n)},Signature.loadSignatures=function(e,t,i){var n={};if(null==Signature.options.extra&&(Signature.options.extra={}),Utils.is("Array",e))for(var a=0;a<e.length;a++){var o=e[a];n[o.signatureid]=o.signatureData,void 0!==o.extra&&null!==o.extra&&(Signature.options.extra[o.signatureid]=o.extra)}else for(a in e)n[a]=e[a];formartSignatureData(n,t||function(){Signature.verify()},i)},Signature.resetSignaturePos=function(e){if(null==Signature.options.extra&&(Signature.options.extra={}),Utils.is("Array",e))for(var t=0;t<e.length;t++){var i=e[t];void 0!==i.extra&&null!==i.extra&&(Signature.options.extra[i.signatureid]=i.extra)}else for(t in e)Signature.options.extra[t]=e[t]},Signature.clearRPW=function(){var e=Signature.create();e.onDeleteRPW&&e.onDeleteRPW()};var globalLisenter=new Listener("Signature"),ClientSeal=(Signature.addLiseter=function(e,t){globalLisenter.on(e,t)},Signature.verify=function(){var e,t=Signature.list,i=[];for(e in globalLisenter.trigger("beforeVerify",n),t){var n=t[e];n._verify(null,{batchVerify:!0})||i.push(n),globalLisenter.trigger("eachVerify",n)}return globalLisenter.trigger("verify",n),i},Signature._getCookie=function(e){return getCookie(e)},Signature._showAndHideSealsDlg=function(e){Signature.options.showSealsDlg&&(Signature._getCookie("pwd")&&1==e.length&&!Signature.options.remberPwdAndShowSealsDlg?Signature.options.showSealsDlg=!1:Signature.options.showSealsDlg=!0)},Signature.verifySignByList=function(e){var t,i=[];for(t in globalLisenter.trigger("beforeVerify",n),e){var n=e[t],a=n._verify(null,{batchVerify:!0}),o=n.signatureData,s={};s.appname=o.appname,s.documentid=o.documentid,s.documentname=o.documentname,s.keysn=o.keysn,s.orgname=o.orgname,s.timestamp=o.timestamp,s.usercode=o.usercode,s.username=o.username,s.signname=o.seal.signname,s.signsn=o.seal.signsn,a||(s.modifiedItems=n.modifiedItems),i.push(s),globalLisenter.trigger("eachVerify",n)}return globalLisenter.trigger("verify",n),i},Signature.bind=function(e){Utils.extend(Signature.asyn,e)},Signature.loadProperties=function(){jQuery.kgi18n.properties({name:"language",path:Signature.options.languagesPath+"/lang/",mode:"map",language:Signature.options.LANGUAGE||jQuery.kgi18n.normaliseLanguageCode({}),cache:!1,encoding:"UTF-8",callback:function(){for(var e in kinggrid.errCode)if(Utils.is("Object",kinggrid.errCode[e]))for(var t in kinggrid.errCode[e])kinggrid.errCode[e][t]=$.kgi18n.prop(e+t);else kinggrid.errCode[e]=$.kgi18n.prop("errCode"+e);for(e in plus.fontTemplate.position)plus.fontTemplate.position[e]=$.kgi18n.prop("position"+e);for(plus.dialogConfig.okValue=$.kgi18n.prop("Confirm"),plus.dialogConfig.cancelValue=$.kgi18n.prop("Close"),plus.defaultFont.position=$.kgi18n.prop("position0"),e=$(".kgImgIcons").find(".kg-img-icon"),t=0;t<e.length;t++){var i=(a=$(e[t]).attr("id")).indexOf("-",11)+1,n=a.indexOf("-",i),a=a.substring(i,n);$(e[t]).attr("title",$.kgi18n.prop("Title"+a))}}})},Signature.dynamicLoadCss=function(e){for(var t=document.getElementsByTagName("head")[0],i=(t=root.iframeDialog?window.top.document.getElementsByTagName("head")[0]:t).getElementsByTagName("link"),n=0;n<i.length;n++)0<i[n].href.indexOf("/languages/")&&t.removeChild(i[n]);(i=document.createElement("link")).type="text/css",i.rel="stylesheet",i.href=e,t.appendChild(i)},Signature.show=function(){var e,t=Signature.list;for(e in t)t[e].show()},Signature.hide=function(){var e,t=Signature.list;for(e in t)t[e].hide()},Signature.isIE=!!(window.ActiveXObject||"ActiveXObject"in window),Signature.setRequestHeader=function(e){if(!this.options.clientConfig){var t,i=this.options.RequestHeaderList;for(t in i)e.setRequestHeader(t,i[t])}},Signature.getAuthCode=function(t,i){window.OnecodeJSBridge?window.OnecodeJSBridge.call("getAuthCode",{},function(e){e.status?t(e.authCode):i(e.errorMsg)}):i("OnecodeJSBridge初始化失败, 请在码上办事小程序或者是APP中打开")},Signature.ScanStamp=function(j,o,s){function i(){x=document.getElementById("kg-exitSessionContainer"),P=document.getElementById("kg-exitSessionClick"),x.style.display="flex",P.addEventListener("click",L)}function L(){T.sealService.exitSession(y,function(e){e.result&&(Signature.userToken=usetToken=null,d(),g())})}function F(e){r(e.target.value)}function a(){T.sealService.queryUserCompany(Signature.userToken,function(e){var t=e.data.data,i=e.data.code;e=e.data.message,0==i?((C=Array.prototype.slice.call(t.companys).filter(function(e){return"0"===e.sealMakeStatus||"4"===e.sealMakeStatus})).push({entityName:"授权印章",entityCode:1}),C.push({entityName:"授权印章2",entityCode:12}),r(C[0].entityCode)):6===i?(Signature.userToken=null,l(f,s)):Signature.alert(e)})}function r(e){var t;if(y=Signature.userToken,1==e)t=3;else if(2==(t=s))for(var i=e,n=A.getElementsByTagName("option"),a=0;a<n.length;a++)if(n[a].value==i){n[a].setAttribute("selected","selected");break}T.sealService.getUserSeals(y,t,e,function(e){var t=[],t=e.data.data,i=e.data.code;e=e.data.message,0==i?(e=t.userInfo,t=t.seals,k=e.userId,S=e.userName,"stamp"==f&&(0<t.length?(t=t.map(function(e){e.imgdata=e.imageData,delete e.imageData;var t=1/(720/254);return e.height=Utils.pxConversionMm(Math.round(.15*e.height/t)),e.width=Utils.pxConversionMm(Math.round(.15*e.width/t)),e.version=4,"1"==M&&(e.scanId=_),e.imgext=".png",e}),e={qrCodeUserUid:k,username:S,stampType:"scanStamp",sealData:t},g(),o(e)):1<C.length?r(C[0].entityCode):Signature.alert("该用户没有可用印章！")),"delete"==f&&T.sealService.getSealauthority(_,h,Signature.userToken,function(e){e.result?(_=null,o(e)):(g(),Signature.alert(e.errmsg))})):6===i?(Signature.userToken=null,l(f,s)):Signature.alert(e)})}function n(t){T.sealService.getQrCodeToken(function(e){b=e.stampSystemUrl+"/qr",e=Utils.Base64.of("=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").decode(e.requestParameters),p=decodeURIComponent(e.split("&")[0]),m=decodeURIComponent(e.split("&")[1]),D="?token="+p+"&checkCode="+m,t&&t()})}function l(e,t){O.classList.add("hide"),T.sealService.getQRCodeImage(e,t,function(e){e.result?(1==(M=e.session?e.session:M)&&(Signature.userToken=null,v=e.image,U.src="data:image/png;base64,"+v,_=e.qrcodeId,n(c)),2==M&&(Signature.userToken?(1==t?(Signature.scanCallBack=i,r):(Signature.scanCallBack=function(){E=document.getElementById("kg-companySelectContainer"),A=document.getElementById("kg-companySelect"),E.style.display="block",A.addEventListener("change",F),A.innerHTML="",C.forEach(function(e,t){(t=document.createElement("option")).value=e.entityCode,t.innerText=e.entityName,A.appendChild(t)}),i()},a))():Signature.options.isMobile?new(_babel_runtime_corejs2_core_js_promise__WEBPACK_IMPORTED_MODULE_7___default())(function(e,t){Signature.getAuthCode(e,t)}).then(function(e){T.sealService.establishSession(e,function(e){var t=e.data,i=e.message;0==e.code?(Signature.userToken=t.token,(1==s?r:a)()):Signature.alert(i)})}):(v="data:image/png;base64,"+e.image,U.src=v,_=e.qrcodeId,n(c)))):(O.classList.remove("hide"),_=null,T.errorCallback(e,Signature.options.errorCall))})}function c(){w=$.ajax({type:"get",url:b+"/user/get/"+_+D,timeout:75e3,success:function(e){var i,t,n;e?(i=e.data,t=e.code,e=e.message,_=i.scanId,0==t?(1==M&&(Signature.userToken=null,k=i.userInfo?i.userInfo.userId:void 0,S=i.userInfo?i.userInfo.userName:void 0,n=[],i.seals&&0<i.seals.length&&(n=i.seals.map(function(e){delete e.isGmSeal,delete e.isPersonal,e.imgdata=e.imageData,e.imgext=".png",e.qrcodeId=_,e.scanId=i.scanId,e.scanSealType=s,e.signname=e.sealName,e.sealData&&(e.sealTag="GM"),delete e.sealName,delete e.imageData;var t=1/(720/254);return e.height=Utils.pxConversionMm(Math.round(.15*e.height/t)),e.width=Utils.pxConversionMm(Math.round(.15*e.width/t)),e.version=4,e})),u(t={code:t,message:e,scanId:i.scanId,qrCodeUserUid:i.userInfo?i.userInfo.userId:void 0,qrCodeUserName:i.userInfo?i.userInfo.userName:void 0,seals:n,status:0==t})),2==M&&(Signature.userToken=i.userToken,(1==s?r:a)())):u(t={code:t,message:e})):O.classList.remove("hide")},error:function(){O.classList.remove("hide")}})}function u(e){1==e.status&&0==e.code?e.scanId&&e.qrCodeUserUid&&(k=e.qrCodeUserUid,S=e.qrCodeUserName,"stamp"==f&&(0<e.seals.length?(I=e.seals,g(),o({qrCodeUserUid:k,username:S,stampType:"scanStamp",sealData:I})):(g(),Signature.alert("该用户没有可用印章！"))),"delete"==f)&&T.sealService.getSealauthority(_,h,Signature.userToken,function(e){e.result?(_=null,o(e)):(g(),Signature.alert(e.errmsg))}):801==e.code?setTimeout(function(){n(c)},3e3):802==e.code?O.classList.remove("hide"):803==e.code?g():Signature.alert(e.message)}function e(){w&&w.abort()}function g(){e(),B.close()}function t(){B.show()}function d(){I=[]}var h,f,p,_,m,v,k,S,b,y,C,w,D,E,A,x,P,T=this,M="1",I=(s=s||"",[]),B=j(),O=B.find("#kg-qrCodeImgForeground")[0],U=B.find("#kg-qrcodeImg")[0];return B.find("#kg-qrCodeExpires"),B.find(".ui-dialog-close").click(e),t(),O.addEventListener("click",function(){l(f,s)}),{open:t,close:g,sealData:I,dialog:B,clearSealData:d,getQrCodeImageByStamp:function(){l(f="stamp",s)},getQrCodeImageByDelete:function(e){h=e,l(f="delete")}}},Signature.editThemeColor=function(e){if(Signature._color!=e){if(Signature._color=e||Signature._color,Signature.isIE){if(!Signature._color)return;e="kg-primary-arrow- kg-primary-btn- kg-default-btn- kg-second-btn- kg-title- kg-primary-check-".split(" ")}else{for(k in e=Signature.options.themeColor[e])document.documentElement.style.setProperty("--"+k,e[k]);e=["kg-primary-check-"]}for(var t="red"==Signature._color?"blue":"red",i=0;i<e.length;i++)for(var n=$("."+e[i]+t),a=0;a<n.length;a++)"red"==Signature._color?($(n[a]).toggleClass(e[i]+"red"),$(n[a]).toggleClass(e[i]+"blue")):"blue"==Signature._color&&($(n[a]).toggleClass(e[i]+"blue"),$(n[a]).toggleClass(e[i]+"red"))}},Signature._verfiyInfotoServer=!1,Signature.AXI=function(e,t,i){Signature.authcode=void 0;var n,a=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);for(n in t){var o=t[n];""!==n&&""!==o?a.invoke(e,n,o):null!==n&&""!==n?a.invoke(e,n):a.invoke(e)}return a.ret(function(t){t.result&&(Signature.options.moveable_self?(Signature.options.fjrsIsphone&&a.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),a.invoke("KGGetKeyOtherInfo","0").ret(function(e){e.result&&(e=e.Res.substring(1,e.Res.length-1),Signature.options.keysn=e),null!=i&&i(t)})):null!=i&&i(t))}),a},Signature.showAndHideBySignatureId=function(e,t){var i,n=Signature.list;for(i in n)0<=i.indexOf(e)&&(t?n[i].show():n[i].hide())},Signature.addIcon=function(e){var t=Signature.options.icons||[];t.push(e),Signature.options.icons=t},Signature.create=function(e){var t=$.extend({},Signature.options,e);return void 0!==e&&void 0!==e.imgtag&&(Signature.options.imgtag=e.imgtag),void 0!==e&&void 0!==e.password&&(Signature.options.password=e.password),new Signature._create(t)},$.extend(Signature.prototype,{saveSignatures:function(){},getSignatures:function(){}}),function(e){var i=this;$.each(e,function(e,t){"function"==typeof i[e]?i[e](t):i[e]=t})}),ClientCert=(Utils.inherit(ClientSeal,Signature.SealService),function(e){var i=this;$.each(e,function(e,t){"function"==typeof i[e]?i[e](t):i[e]=t})}),ServerSeal=(Utils.inherit(ClientCert,Signature.CertService),$.extend(ClientSeal.prototype,{saveLog:function(e){var t=[];Utils.is("Object",e)?t.push(e):t=e,e=stringify({MSG:t}),Signature.options.savelogFlg&&kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("SetParamByName","SAVEMSG",e)},loadSeal:function(s){var r=this,l=s.successCall,c=s.errorCall,e=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);r.appcode?e.invoke("SetParamByName","APPCODE",r.appcode):r.appcode="",void 0!==Signature.options.imgtag&&e.invoke("SetParamByName","SIGNTYPE",Signature.options.imgtag),Signature.options.fjrsIsphone&&e.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),e.invoke("KGGetKeyInfo").ret(function(e){if(e.result){if(Signature.options.fjrsIsphone&&localStorage.setItem("fjrsToken",e.fjrs_token),Signature.options.phoneshield=!(!e.phoneshield||"1"!=e.phoneshield&&"3"!=e.phoneshield),Signature.options.phoneshield&&(kinggrid.options.timeout=1e3*(e.validatetime+10)),""==e.seals){if(null==s.data)return void c.call(r,{result:!1,errcode:"11"});e.seals={};var t={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"};e.seals[0]=t}else{if(Signature.options.signname||Signature.options.signindex){Signature.options.signname=Utils.is("Array",Signature.options.signname)?Signature.options.signname:[Signature.options.signname];for(var i=[],t=0;t<e.seals.length;t++){var n=e.seals[t];void 0!==n&&t==Signature.options.signindex&&i.push(e.seals[t]);for(var a=0,o=Signature.options.signname.length;a<o;a++)void 0!==n&&n.signname==Signature.options.signname[a]&&e.seals[Signature.options.signindex]!=n&&i.push(e.seals[t])}0==i.length?(e.result=!1,e.errcode="11101"):e.seals=i}for(t=0;t<e.seals.length;t++)i=(n=e.seals[t]).imgdata.substring(0,65),n=n.imgdata.substring(65),e.seals[t].imgdata=Utils.Base64.of().encodeByte(Utils.Base64.of(i).decodeByte(n))}s.isHW&&!e.seals.length&&(e.seals[0]=t={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"},Signature.options._clientHW=!0),l.call(r,e)}else c.call(r,e)})},verifyPwd:function(e){var t=this,i=e.pwd,n=e.phoneshield?"1":"0",a=e.successCall,o=(null==i&&(i=""),kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode));o.invoke("SetParamByName","ISPHONE",n),o.invoke("SetParamByName","FJRSISPHONE",e.phoneshield||"0"),n&&o.invoke("SetParamByName","FJRSDELKEYSN",e.keysn),o.invoke("KGVerifyPin",i,e.keysn).ret(function(e){a.call(t,e)})},getKeysn:function(e,t){var i=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),n=e&&e.key?e.key:"0",a=Signature.options.getKeysnCallBack;Signature.options.fjrsIsphone&&(i.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),i.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken"))),i.invoke("KGGetKeyOtherInfo",n).ret(function(e){if(e.result)"0"==n&&(e=e.Res.substring(1,e.Res.length-1)),t(e);else{if(a)return a(e.result,e.errcode);plus.alert(kinggrid.msg(e.errcode,"then"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})}})},getPhoneShieldLic:function(e,t){e=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),Signature.options.fjrsIsphone&&e.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),e.invoke("KGPhoneShieldLic").ret(function(e){t(e)})},checkKeysn:function(t,i){this.sealService.getKeysn({},function(e){t.keysn==e?i({result:!0}):i({result:!1,errcode:"11114"})})},getRemoveAuthority:function(e,t,i){i(!0)}}),$.extend(ClientCert.prototype,{verifySign:function(i){var n=this,a=i.successCall,o=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);i.seal&&i.seal.sealtag&&"GB"==i.seal.sealtag&&o.invoke("SetParamByName","GBSIGNSN",i.seal.signsn),Signature.options.fjrsIsphone&&o.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),o.invoke("SetParamByName","KEYSN",i.keysn),o.invoke("SetParamByName","SIGNSN",i.signsn),o.invoke("KGVerifySignMessage","123456",i.signdata,i.signeddata).ret(function(e){var t=e.result||"-8"!==e.errcode?e:{result:!1};t.result&&i.seal&&"GB"==i.seal.sealtag?o.invoke("KGVerifyGBStampAction",i.signeddata).ret(function(e){e.result||(t={result:!1}),a.call(n,t)}):a.call(n,t)}),i.seal&&i.seal.sealtag&&"GB"==i.seal.sealtag&&o.invoke("SetParamByName","GBSIGNSN","")},parseDate:function(e){var t=new Date;return t.setFullYear(e.substring(0,4),+e.substring(4,6)-1,e.substring(6,8)),t.setHours(e.substring(8,10),e.substring(10,12),e.substring(12,14),0),t.getTime()},sign:function(e){var t=this,i=e.successCall,n=e.signMeta,a=[],o=[],s=e.seal,r=e.phoneshield?"1":"0",l=e.password;null==l&&(l="");for(var c=0;c<n.length;c++){var u=n[c];a.push(u.signdata),o.push(""+u.signdata.length)}(n=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)).invoke("SetParamByName","ISPHONE",r),s&&s.sealtag&&("GB"==s.sealtag&&(r=s.sesealinfo,n.invoke("SetParamByName","CLEARGBSESEALINFO",""),n.invoke("SetParamByName","GBSESEALINFO",r),n.invoke("SetParamByName","GBSIGNSN",s.signsn)),"GM"==s.sealtag)&&n.invoke("SetParamByName","ISGM","1"),Signature.options.fjrsIsphone&&(n.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),n.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken"))),n.invoke("SetParamByName","KEYSN",e.keysn),n.invoke("SetParamByName","SIGNSN",e.signsn),n.invoke("KGCrySignMessage",l,a.join(";"),+o[0]).ret(function(e){(e=$.extend({},e)).result&&(e.certinfo.notAfter=t.parseDate(e.certinfo.notAfter),e.certinfo.notBefore=t.parseDate(e.certinfo.notBefore)),i.call(t,e)}),s&&s.sealtag&&"GB"==s.sealtag&&(n.invoke("SetParamByName","CLEARGBSESEALINFO",""),n.invoke("SetParamByName","GBSIGNSN",""))}}),Signature.addProvider("cert","client",ClientCert),Signature.addProvider("seal","client",ClientSeal),function(e,t){var i=this;i.sData=t,$.each(e,function(e,t){"function"==typeof i[e]?i[e](t):i[e]=t})}),ServerCert=(Utils.inherit(ServerSeal,Signature.SealService),function(e,t){var i=this;i.sData=t,$.each(e,function(e,t){"function"==typeof i[e]?i[e](t):i[e]=t})}),version=(Utils.inherit(ServerCert,Signature.CertService),$.extend(ServerSeal.prototype,{getSealsUrl:"_key_load",verifyInputUrl:"_key_verify",saveLogUrl:"_signature_saveLog",applySMSCodeUrl:"_sms_applySMSCode",checkSMSCodeUrl:"_sms_checkSMSCode",telphoneUrl:"_sms_telphone",getQRCodeUrl:"_scan_getQrCodeImage",sealAuthorityUrl:"_scan_sealAuthority",getQRCodeTokenUrl:"_scan_getQrCodeToken",queryUserCompanyUrl:"_scan_queryUserCompany",getUserSealsUrl:"_scan_getUserSeals",establishSessionUrl:"_scan_establishSession",exitSessionUrl:"_scan_exitSession",saveLog:function(e){e=stringify(e),Signature.options.savelogFlg&&kinggrid.surry(this.serverUrl).request(this.saveLogUrl,{loginfo:e}).ret(function(e){e.result||Signature.prototype.error.call(null,e)})},getPwdSaveTime:function(t,i){kinggrid.surry(Signature.options.serverUrl).request("_signature_getPwdSaveTime").ret(function(e){t(e.result?e.pwdTime:i)})},loadSeal:function(s){var r=this,l=s.successCall,c=s.errorCall,e={usercode:r.usercode,keysn:r.keysn,authcode:r.authcode,password:Signature.options.password,sealTag:Signature.options.sealTag,certContext:Signature.options.cert};kinggrid.surry(r.serverUrl).request(r.getSealsUrl,e).ret(function(e){if(e.result){if(void 0!==Signature.options.imgtag&&null!==Signature.options.imgtag){var t,i=[];for(t in e.seals){var n=e.seals[t];void 0!==n&&_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(n.imgtag)==Signature.options.imgtag&&(i[i.length]=e.seals[t])}e.seals=i}if(Signature.options.signname||Signature.options.signindex){for(t in Signature.options.signname=Utils.is("Array",Signature.options.signname)?Signature.options.signname:[Signature.options.signname],i=[],e.seals){void 0!==(n=e.seals[t])&&t==Signature.options.signindex&&i.push(e.seals[t]);for(var a=0,o=Signature.options.signname.length;a<o;a++)void 0!==n&&n.signname==Signature.options.signname[a]&&e.seals[Signature.options.signindex]!=n&&i.push(e.seals[t])}0==i.length?(e.result=!1,e.errcode="11101"):e.seals=i}if(!e.seals.length){if(!s.isHW)return e="11101",Signature.options.imgtag&&(e="11100"+Signature.options.imgtag),void c.call(r,{result:!1,errcode:e});e.seals=[],e.seals[0]={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"}}l.call(r,e)}else c.call(r,e)})},verifyPwd:function(e){var t=this,i=e.successCall,n=kinggrid.surry(t.serverUrl);e.verify?(e={keysn:e.keysn,verifyCode:e.pwd},n.request(t.checkSMSCodeUrl,e).ret(function(e){i.call(t,e)})):(e={usercode:(null==t.sData?e:t.sData).usercode,keysn:(null==t.sData?e:t.sData).keysn,password:e.pwd},n.request(t.verifyInputUrl,e).ret(function(e){i.call(t,e)}))},applySMSCode:function(t){var e={keysn:t.keysn};kinggrid.surry(this.serverUrl).request(this.applySMSCodeUrl,e).ret(function(e){t.successCall&&t.successCall(e)})},getTelphone:function(t){var e={keysn:t.keysn};kinggrid.surry(this.serverUrl).request(this.telphoneUrl,e).ret(function(e){t.successCall&&t.successCall(e)})},checkKeysn:function(e,t){e.keysn==Signature.options.keysn?t({result:!0}):t({result:!1,errcode:"11115"})},getKeysn:function(e,t){t(Signature.options.keysn)},getQRCodeImage:function(e,t,i){var n={},a=kinggrid.surry(this.serverUrl);n.way={stamp:"1",delete:"2"}[e],n.scanSealType=t,a.request(this.getQRCodeUrl,n).ret(function(e){i(e)})},getSealauthority:function(e,t,i,n){e={scanId:e,esid:t,userToken:i},kinggrid.surry(this.serverUrl).request(this.sealAuthorityUrl,e).ret(function(e){n(e)})},getRemoveAuthority:function(e,t,i){Signature.options.clientConfig&&i(!0),t.seal.esid&&"scanStamp"!=t.stampType?(e={documentId:t.documentid,documentName:t.documentname,esid:t.seal.esid,signeddata:t.signMeta.signeddata},kinggrid.surry(Signature.options.serverUrl).request("_signature_authentication",e).ret(function(e){e.result?i(!0):(Signature.prototype.error.call(null,e),i(!1))})):i(!0)},getQrCodeToken:function(t){kinggrid.surry(this.serverUrl).request(this.getQRCodeTokenUrl).ret(function(e){t(e)})},queryUserCompany:function(e,t){kinggrid.surry(this.serverUrl).request(this.queryUserCompanyUrl,{userToken:e}).ret(function(e){t(e)})},getUserSeals:function(e,t,i,n){kinggrid.surry(this.serverUrl).request(this.getUserSealsUrl,{userToken:e,category:t,entityCode:i}).ret(function(e){n(e)})},establishSession:function(e,t){kinggrid.surry(this.serverUrl).request(this.establishSessionUrl,{authCode:e}).ret(function(e){t(e)})},exitSession:function(e,t){kinggrid.surry(this.serverUrl).request(this.exitSessionUrl,{userToken:e}).ret(function(e){t(e)})}}),$.extend(ServerCert.prototype,{signUrl:"_sign",verifySignUrl:"_sign_verify",verifySign:function(e){var t=this,i=t.sData,n=e.successCall,a=!!i.stampType;kinggrid.surry(t.serverUrl).request(t.verifySignUrl,{certType:i.certType,isUTF8:i.isUTF8,signsn:i.seal.signsn,html2sign:i.signMeta.html2sign,keysn:i.keysn,isScan:a,signdata:e.signdata,signeddata:i.signMeta.signeddata,crtdata:i.signMeta.certinfo.crtdata,sealTag:i.seal.sealTag||i.seal.sealtag}).ret(function(e){n.call(t,e)})},sign:function(e){for(var t=this,i=e.signMeta,n=e.successCall,a=[],o=e.seal.sealTag,s=0;s<i.length;s++){var r=i[s];"GM"!=o&&"SM2"!=Signature.options.certAlgorithm||(r.hashAlg="SM3",r.encryptAlg="SM2"),a.push("$"+(r.hashAlg||t.hashAlg)+"|"+(r.encryptAlg||t.encryptAlg)+"$"+r.signdata)}a="scanStamp"===t.sData.stampType?(i=e.seal.sealData,{keysn:e.keysn,scanSealType:e.seal.scanSealType,scanId:e.seal.scanId,esid:e.seal.esid,documentId:e.documentid,documentName:e.documentname,signdata:a.join(";"),signsn:e.signsn,scanStamp:!0,userToken:Signature.userToken,sealData:i}):Signature.options.verification?{keysn:e.keysn,signdata:a.join(";"),signsn:e.signsn,sealTag:o}:{keysn:e.keysn,password:e.password,signdata:a.join(";"),signsn:e.signsn,sealTag:o},e.seal.esid&&(a.esid=e.seal.esid,a.documentId=e.documentid,a.documentName=e.documentname),a.seSeal=e.seal.seSeal,a.version=e.seal.version,kinggrid.surry(t.serverUrl).request(t.signUrl,a).ret(function(e){e.result&&(e.certinfo.algName=e.certinfo.algName.replace("with","")),n.call(t,e)})}}),Signature.addProvider("cert","server",ServerCert),Signature.addProvider("seal","server",ServerSeal),Signature.alert=plus.alert,Signature.version={name:"1.0.20",code:100});function getLen(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function dot(e,t){return e.x*t.x+e.y*t.y}function getAngle(e,t){var i=getLen(e)*getLen(t);return 0==i?0:(1<(e=dot(e,t)/i)&&(e=1),Math.acos(e))}function cross(e,t){return e.x*t.y-t.x*e.y}function getRotateAngle(e,t){var i=getAngle(e,t);return 0<cross(e,t)&&(i*=-1),180*i/Math.PI}root.Signature=Signature;var AlloyFinger=function(e,t){this.preV={x:null,y:null},this.pinchStartLen=null,this.scale=1,this.isDoubleTap=!1,this.rotate=t.rotate||function(){},this.pointStart=t.pointStart||function(){},this.multipointStart=t.multipointStart||function(){},this.multipointEnd=t.multipointEnd||function(){},this.pinch=t.pinch||function(){},this.swipe=t.swipe||function(){},this.tap=t.tap||function(){},this.doubleTap=t.doubleTap||function(){},this.longTap=t.longTap||function(){},this.singleTap=t.singleTap||function(){},this.pressMove=t.pressMove||function(){},this.x1=this.x2=this.y1=this.y2=this.swipeTimeout=this.longTapTimeout=this.touchTimeout=this.tapTimeout=this.now=this.last=this.delta=null,this.preTapPosition={x:null,y:null},e.addEventListener("touchstart",this.start.bind(this),!1),e.addEventListener("touchmove",this.move.bind(this),!1),e.addEventListener("touchend",this.end.bind(this),!1),e.addEventListener("touchcancel",this.cancel.bind(this),!1)};function getsec(e){var t=+e.substring(1,e.length);return"s"==(e=e.substring(0,1))?1e3*t:"h"==e?36e5*t:"d"==e?864e5*t:void 0}AlloyFinger.prototype={start:function(e){var t,i;e.touches&&(this.now=Date.now(),this.x1=e.touches[0].pageX,this.y1=e.touches[0].pageY,this.delta=this.now-(this.last||this.now),this.pointStart(e),null!==this.preTapPosition.x&&(this.isDoubleTap=0<this.delta&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now,t=this.preV,1<e.touches.length&&(i=e.touches[1].pageY-this.y1,t.x=e.touches[1].pageX-this.x1,t.y=i,this.pinchStartLen=getLen(t),this.multipointStart(e)),this.longTapTimeout=setTimeout(function(){this.longTap(e)}.bind(this),750))},move:function(e){var t,i,n,a;e.touches&&(t=this.preV,i=e.touches.length,n=e.touches[0].pageX,a=e.touches[0].pageY,this.isDoubleTap=!1,1<i?(i={x:e.touches[1].pageX-n,y:e.touches[1].pageY-a},null!==t.x&&(0<this.pinchStartLen&&(e.scale=getLen(i)/this.pinchStartLen,this.pinch(e)),e.angle=getRotateAngle(i,t),this.rotate(e)),t.x=i.x,t.y=i.y):null!==this.x2&&(e.deltaX=n-this.x2,e.deltaY=a-this.y2,this.pressMove(e)),this._cancelLongTap(),this.x2=n,this.y2=a,e.preventDefault())},end:function(e){var t;e.changedTouches&&(this._cancelLongTap(),t=this,e.touches.length<2&&this.multipointEnd(e),this.x2&&30<Math.abs(this.x1-this.x2)||this.y2&&30<Math.abs(this.preV.y-this.y2)?(e.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){t.swipe(e)},0)):this.tapTimeout=setTimeout(function(){t.isDoubleTap?(t.doubleTap(e),clearTimeout(t.touchTimeout),t.isDoubleTap=!1):t.touchTimeout=setTimeout(function(){t.singleTap(e)},250)},0),this.preV.x=0,this.preV.y=0,this.scale=1,this.x1=this.x2=this.y1=this.y2=this.pinchStartLen=null)},cancel:function(){clearTimeout(this.touchTimeout),clearInterval(this.tapTimeout),clearInterval(this.longTapTimeout),clearInterval(this.swipeTimeout)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_swipeDirection:function(e,t,i,n){return Math.abs(e-t)>=Math.abs(i-n)?0<e-t?"Left":"Right":0<i-n?"Up":"Down"}},Utils=kinggrid.Utils,Utils.extend(Signature.options.template,{infoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-info"><%var autoCertMode = Signature.options.autoCertMode; %><%var modified = this.modified;%><%var timeVerify = this.timeVerify;%><%var tsaInfo = !!this.signatureData.signMeta?this.signatureData.signMeta.tsaInfo:0; %><%var canSign = this.signatureData.signMeta || this.canSign(); %><div class="kg-title success <%modified?"kg-hide":""%>" style="padding:0 0 15px 0"><i class="kg-icon"></i><div><span a="<%canSign%>" data-kgi18n-html="VerifyNormal">检测结果：保护数据正常！</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-title danger  <%modified?"":"kg-hide"%> "  style="padding:20px 0"><i class="kg-icon"></i><div><span data-kgi18n-html="VerifyTamper">检测结果：保护数据被篡改！</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" class="kg-title-red" kg-target="signatureinfo" data-kgi18n-html="SignInfo">签章信息</a></li><%if(autoCertMode){%><%if(canSign){%><li class=""><a href="#" class="kg-title-red" kg-target="certinfo" data-kgi18n-html="CertInfo">证书信息</a></li><%if(!!tsaInfo){%><li class=""><a href="#" class="kg-title-red" kg-target="tsaInfo"  data-kgi18n-html="tStampInfo">时间戳信息</a></li><%}%><%}%><%}{%><%if(this.icon_sign == null || this.icon_sign == true){%><%if(canSign){%><li class="" ><a href="#" class="kg-title-red" kg-target="certinfo" data-kgi18n-html="CertInfo">证书信息</a></li><%if(!!tsaInfo){%><li class=""><a href="#" class="kg-title-red" kg-target="tsaInfo"  data-kgi18n-html="tStampInfo">时间戳信息</a></li><%}%><%}%><%}%><%}%></ul><div class="kg-tab-content"><div class="kg-tab-pane active signatureinfo"><% var SDATA = this.signatureData; %><% var modifiedItems = this.modifiedItems; %><% var scanStamp = this.signatureData.stampType;%><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Application">应用程序：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.appname%></span></div><%if(SDATA.orgname){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="AuthorizedUnit">授权单位：</label><span class="kg-value  <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.orgname%></span></div><%}%><%if(SDATA.username){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="UserName">用户名称：</label><span class="kg-value  <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.username%></span></div><%}%><%if(SDATA.keysn){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="KeySequence">密钥序列：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.keysn%></span></div><%}%><%if(SDATA.seal.signname){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureName">签章名称：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.seal.signname%></span></div><%}%><%if(SDATA.seal.signsn){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureSequence">签章序列：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin-top:5px;"><%SDATA.seal.signsn%></span></div><%}%><%if(SDATA.timestamp.signtime){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureDate">签章日期：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin-top:5px;"><%SDATA.timestamp.signtime%></span></div><%}%></div><%if(this.icon_remove == null || this.icon_remove == true){%><div><button type="button" id="revoke_<%this.signatureid%>" class="kg-button" i-id="revoke" data-kgi18n-html="RevokeSign" >撤销签章</button></div><%}%></div><%if(canSign){%><div class="kg-tab-pane certinfo"><%var noCertInfo = !this.signatureData.signMeta; %><%if(!noCertInfo){%><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-meta" style="padding-bottom:20px;"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Version">版本：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>">V<%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SerialNumber">序号：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin-top:5px;"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureAlgorithm">签名算法：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Issuer">颁发者：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height: 17px;margin-top:5px;"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="User">使用者：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height: 17px;margin-top:5px;"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">有效期从：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span><label  class="kg-to-sm">~</label><span class="<%this.Global%>-value mf-0 <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div><%}else{%><div class="kg-meta"><div class="clearfix kg-item kg-visble "><label class="kg-label"></label><span class="kg-value">----------------------------------------------------------------------------------------------------------------------</span></div><div class="clearfix kg-item kg-nosign">当前文档未做数字签名</div><div class="clearfix kg-item kg-visble"><label class="kg-label"></label><span class="kg-value">--------------------------------------------------------------------</span></div></div><%}%><%if(noCertInfo){%><div><button type="button" id="sign_<%this.signatureid%>" class="kg-button" data-kgi18n-html="DigitalSign">数字签名</button></div><%}else{%><%}%></div><%if(!!tsaInfo){%><div class="kg-tab-pane tsaInfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaTime">时间戳时间：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%tsaInfo.tsaTime%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSubject" >证书使用者：</label><span class="kg-value <%this.Global%>-value" <%this.isMobile?"mobile-value":""%>"> <%tsaInfo.tsaCert.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSerialNumber">证书序列号：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%tsaInfo.tsaCert.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaIssuerDN">时间戳机构：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin:4px 0;"><%tsaInfo.tsaCert.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSigAlg">签名算法：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>">" style="line-height:17px;margin:4px 0;"><%tsaInfo.tsaCert.oid%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">有效期从：</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(tsaInfo.tsaCert.startDate) , "yyyy-MM-dd hh:mm:ss")%></span><label  class="kg-to-sm">~</label><span class="<%this.Global%>-value mf-0 <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(tsaInfo.tsaCert.endDate) , "yyyy-MM-dd hh:mm:ss")%></span></div></div></div><%}%><%}%></div></div></div></div>',handwritedlg:'<div class="kg-dialog kg-dialog-info" id="kg-handwrite"><div class="kg-hw-content"><div class="kg-hw-info kg-hw-model"><span data-kgi18n-html="Model">模式</span><select id="hw_model"><option value="0" data-kgi18n-html="HWSignatrue">手写签名</option><option value="1" data-kgi18n-html="TextApproval">文字签批</option></select></div><div class="kg-hw-info kg-hw-name"><span data-kgi18n-html="Name">名称</span><input type="text" data-kgi18n-value="HWApproval" value="手写签批" id="nameid" style="margin-left:1px;width:76px;height:16px;"/></div><div class="kg-hw-info kg-hw-color"><span data-kgi18n-html="Color">颜色</span><select id="hw_color"><option value="black" data-kgi18n-html="KGfontColor黑">黑</option><option value="red" data-kgi18n-html="KGfontColor红">红</option><option value="blue" data-kgi18n-html="KGfontColor蓝">蓝</option><option value="green" data-kgi18n-html="KGfontColor绿">绿</option></select></div><div class="kg-hw-info kg-hw-linewidth kg-hw-handwrite"><span data-kgi18n-html="PenWidth">笔宽</span><select id="hw_width"><% for(var i=1;i<=8;i++) {%><option value="<%i%>"><%i%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontFamily kg-hw-written"><span data-kgi18n-html="Font">字体</span><select id="hw_fontFamily"><% for(var i=0;i<this.fontFamily.length;i++) {%><option value="<%this.fontFamily[i].ename%>"><%this.fontFamily[i].zname%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontSize kg-hw-written"><span data-kgi18n-html="FontSize">字号</span><select id="hw_fontSize"><% for(var i=16;i<=80;i+=4) {%><option value="<%i%>"<%i==24?"selected":""%>><%i%></option><%}%></select></div></div><div class="kg-hw-canvas"><div id="kg-hw-span" class="kg-hw-written kg-hw-text-span"></div><textarea class="kg-hw-written kg-hw-text-edit" spellcheck="false"></textarea><canvas id="canvasId" width=700px height=300px></canvas></div><div id="div-judge" class="kg-tab-content" align="center"><button type="button" id="clearid" class="kg-button" data-kgi18n-html="Clear">清除</button><button type="button" id="okid" class="kg-button" data-kgi18n-html="Sign">签名</button></div></div>',barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label" data-kgi18n-html="QrCodeContent">二维码内容</label><textarea id="bcId" align="center" rows="3" cols="25"></textarea><br/><br/><div id="output"><br /></div><div id="div-judge" class="kg-tab-content"><button type="button" id="bc_clearid" class="kg-button" data-kgi18n-html="Clear">清除</button><button type="button" id="bc_okid" class="kg-button" data-kgi18n-html="Confirm">确认</button></div></div>',scanbarcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-scanBC"><div id="contentHolder" style="width:320px;height:320px; background:red;"><video id="html5_qrcode_video" height="320px" width="320px" autoplay></video><canvas id="qr-canvas" width="320px" height="320px" style="display:none;"></canvas> <br/></div></div>',scanStampdlg:'<div class="kg-dialog" id="kg-scanStampdlg"><div id="support"></div><div id="scanStampContent"><div id="kg-qrCodeImgForeground" class="hide" data-kgi18n-html="QrcodeInvalid">二维码已失效，点击刷新</div><img id="kg-qrcodeImg" width="320px" height="320px"/></div></div>'}),Signature._create.prototype.onshowSealsDialog=function(e){var t=this;e.find(".arrow").hide(),e=e.find("#kg-switcher"),t.switcher.animate=!1,new AlloyFinger(e[0],{swipe:function(e){t.switcher["Left"===e.direction?"swipePrev":"swipeNext"]()},tap:function(){t.switcher.swipeNext()}})},Signature.prototype.onhandleImg=function(t){function i(e){var t=n.verify();Signature._verfiyInfotoServer&&(e=[],t=n._getLogInfo({LOGTYPE:"00",LOGSORT:"33",LOGMEMO:t?"文档验证成功":"文档验证失败"}),e.push(t),n.sealService.saveLog(e)),n.signatureInfo()}var n=this,e=null==(e=function(){if(void 0!==Signature.options.extra){var e=t.attributes.signatureid.nodeValue;if(e&&null!=(e=Signature.options.extra[e])&&void 0!==e&&e.icon_move)return e.icon_move()}}())||e;n.canMove(t)&&e?Utils.addEvent(t,"mousedown touchstart",function(e){e.originalEvent=e,n.runMove(e,t,function(e){e||i()}),e.preventDefault(),e.stopPropagation()}):Signature.options.verifyResType?Utils.addEvent(t,Signature.options.verifyResType,i):Utils.addEvent(t,"click",i)},Signature.prototype.signatureInfo=function(){var i=this;return i.showDialog("infoBtl",{target:i,onShow:function(){var t=this,e=t.find(".kg-tab");t.tab=Utils.tab(e),(e=t.find("#verifysign_"+i.signatureid)[0])&&(e.onclick=function(){i.verifySignData(function(e){e.result?Signature.alert(kinggrid.msg("normal_signdata","KG_MSG")):e.errcode?i.error(e):Signature.alert(kinggrid.msg("modify_signdata","KG_MSG"))})}),(e=t.find("#sign_"+i.signatureid)[0])&&(e.onclick=function(){i.signSignature(function(e){e.result&&(Signature.alert(kinggrid.msg("success_signdata","KG_MSG")),t.remove())})}),null!=i.icon_remove&&1!=i.icon_remove||(t.find("#revoke_"+i.signatureid)[0].onclick=function(){i.revokeSignature(function(e){e.result&&t.remove()})})}})},Signature.prototype.handWriteDlg=function(o,s){var t,e=0,i=0,n=0,r=!1,l=Number(o.image_width)||8,c=Number(o.image_height)||8,u=o.canvas_width,g=o.canvas_height,e=Math.max(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(o.canvas_width),300)-30,i=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(o.canvas_height),d=(this.fontFamily=plus.fontFamily,Utils.extend(o,{title:kinggrid.msg("HWSignature","KG_TITLE"),target:this}),this.showDialog("handwritedlg",o)),a=d.find("#canvasId")[0],h=(e<screen.availWidth&&540<screen.availWidth?(a.width=e,a.height=i):screen.availWidth>screen.availHeight?700<screen.availWidth?(a.width=e=670,i=a.height=.9*(screen.availHeight-210),o.noCutting&&(r=!0,a.height=i=o.canvas_height,a.width=e=screen.availWidth-30)):(a.width=.95*screen.availWidth,i=a.height=.9*(screen.availHeight-210)):o.noCutting&&o.canvas_width&&o.canvas_height&&o.canvas_width<screen.availWidth?(a.width=e=o.canvas_width,a.height=i=o.canvas_height):(o.noCutting&&(r=!0,a.height=i=o.canvas_height),e=a.width=.83*(screen.availWidth-190)+190),o.dlg=d,o.canvas_height=a.height,o.canvas_width=a.width,o.hideToolBar&&(o.canvas_height+=$(".kg-hw-content").height(),Signature.hideToolBar=o.hideToolBar),d.find(".kg-hw-text-span").css({height:a.height,width:a.width})),f=d.find(".kg-hw-text-edit").css({height:a.height,width:a.width}),p=(d.find(".kg-hw-content").width(e),$(".kg-dialog-info").width("auto"),d.find("#hw_width").val(o.lineSize||5),d[0].reset(),o.toolBarHeight=$(".kg-hw-content").height(),new SignaturePad(a,o));if(o.fontColor)if(0==o.fontColor.indexOf("#"))d.find("#hw_color").val(o.fontColor),p.setColor(o.fontColor),h.css({color:o.fontColor}),f.css({color:o.fontColor});else for(e=["black","red","blue","green"],i=0;i<4;i++)if(e[i]==o.fontColor){d.find("#hw_color").val(o.fontColor),p.setColor(o.fontColor),h.css({color:o.fontColor}),f.css({color:o.fontColor});break}o.buttonText&&d.find("#okid").html(o.buttonText),o.hideToolBar&&d.find(".kg-hw-content").css("display","none"),d.find("#hw_color").change(function(){var e=d.find("#hw_color").val();p.setColor(e),h.css({color:e}),f.css({color:e})}),d.find("#hw_width").change(function(){var e=d.find("#hw_width").val();p.setSize(e)}),d.find("#hw_model").change(function(e){"0"==e.target.value?(n=0,d.find(".kg-hw-written").css({display:"none"}),d.find(".kg-hw-handwrite").css({display:"block"}),p.setWebHandWrite(t,{fontStyle:"normal",fontSize:h.css("font-size"),fontFamily:h.css("font-family"),fontColor:h.css("color")}),t=[],h.html(""),f.val("")):"1"==e.target.value&&(n=1,d.find(".kg-hw-handwrite").css({display:"none"}),d.find(".kg-hw-written").css({display:"block"}))}),f.keyup(function(e){e=Utils.convertText(this.value),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(f.css("line-height"))*e.split("<br>").length>_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(f.css("height"))?console.warn("文字超过限制"):h.html(e),t=Utils.handleEdittable(h,e)}),d.find("#hw_fontFamily").change(function(e){h.css({"font-family":this.value}),f.css({"font-family":this.value})}),d.find("#hw_fontSize").change(function(e){h.css({"font-size":this.value+"px","line-height":6+1.2*this.value+"px"}),f.css({"font-size":this.value+"px","line-height":6+1.2*this.value+"px"}),t=Utils.handleEdittable(h,h.html())}),e=d.find("#clearid"),i=d.find("#okid"),e&&e.click(function(){t=[],h.html(""),f.val(""),p.clear()}),i&&i.click(function(){d.close(),Signature.hideToolBar=null,p.setWebHandWrite(t,{fontStyle:"normal",fontSize:h.css("font-size"),fontFamily:h.css("font-family"),fontColor:h.css("color")}),p.toDataURL(function(t){var i,e,n=o.canvas_height/o.canvas_width,a=t.imageData;r?((i=new Image).onload=function(){var e=document.createElement("canvas");e.width=2*u,e.height=2*g,e.getContext("2d").drawImage(i,0,0,i.width,i.height),e=e.toDataURL(),t.imageData=e.replace(/^data:image\/\w+;base64,/,""),t.name=o.name||d.find("#nameid").val(),t.width=Utils.pxConversionMm(u/10),t.height=Utils.pxConversionMm(g/10),s(t),d.remove()},i.src=a):(t.imageData=t.imageData.replace(/^data:image\/\w+;base64,/,""),t.name=o.name||d.find("#nameid").val(),t.height=Utils.pxConversionMm(t.height)/o.canvas_height,t.width=Utils.pxConversionMm(t.width)/o.canvas_width,o.noCutting?(t.width=Utils.pxConversionMm(o.canvas_width/10),t.height=Utils.pxConversionMm(o.canvas_height/10)):(t.height=Utils.pxConversionMm(t.height)/o.canvas_height,t.width=Utils.pxConversionMm(t.width)/o.canvas_width,e=t,_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.width)>_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.height)?(a=l/t.width,t.width=l,t.height=t.height*a*n):(a=c/t.height,t.height=c,t.width=t.width*a/n)),s(t),d.remove())},{mode:n,noCutting:o.noCutting,display_width:2*o.canvas_width,display_height:2*o.canvas_height})})},Signature.prototype.barCodeDlg=function(t,i){var e={title:$.kgi18n.prop("OtherInfoQrCode"),target:this,onCancel:!1},n=this.showDialog("barcodedlg",e),e=n.find("#bc_clearid"),a=n.find("#bc_okid"),o=n.find("#bcId");e&&e.click(function(){o.val("")}),a&&a.click(function(){n.close();var e=n.find("#output").qrcode(o.val()),e={height:t.image_height||"5",width:t.image_width||"5",imageData:e,name:$.kgi18n.prop("OtherInfoQrCode")};i(e)})},Signature.prototype.scanStampDlg=function(e,t){var i,n;Signature.options.clientConfig||(i=this,n={title:kinggrid.msg("scanBCSignature","KG_TITLE"),target:i,onCancel:!1},Signature.ScanStamp.call(i,function(){return i.showDialog("scanStampdlg",n)},function(e){t(e)},e.type).getQrCodeImageByStamp())},Signature.prototype.scanBCDlg=function(t,i){var e={title:kinggrid.msg("scanBCSignature","KG_TITLE"),target:this,onCancel:!1},n=this.showDialog("scanbarcodedlg",e);try{var a=document.getElementById("qr-canvas").getContext("2d"),o=document.getElementById("html5_qrcode_video"),e={video:!0,audio:!1},s=(window.navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL||window.oURL,window.navigator.getUserMedia&&window.navigator.getUserMedia(e,function(e){o.src=window.URL.createObjectURL(e),o.play()},function(e){alert("出错信息: "+e.name)}),setInterval(function(){var e;a&&(a.drawImage(o,0,0,640,480),e=a.getImageData(0,0,640,480),e=jsQR.decodeQRFromImage(e.data,e.width,e.height))&&(n.close(),window.clearInterval(s),t.content=e,e={height:t.image_height||"5",width:t.image_width||"5",imageData:$("#output").qrcode(e),name:$.kgi18n.prop("OtherInfoQrCode")},i(e))},2e3))}catch(e){printHtml("浏览器不支持HTML5 CANVAS")}},plus=kingPlus(),Utils.extend(plus.alertConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1}),Utils.extend(plus.loadingConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1}),Utils.extend(plus.dialogConfig,{cancelDisplay:!1,quickClose:!0}),getsec=function(e){var t=+e.substring(1,e.length);return"s"==(e=e.substring(0,1))?1e3*t:"h"==e?36e5*t:"d"==e?864e5*t:void 0};var setCookie=function(e,t,i){var n=getsec(i);(i=new Date).setTime(i.getTime()+ +n),t=escape(t),new RegExp(/[0-9A-Za-z]/).test(t)&&(document.cookie=e+"="+t+";expires="+i.toGMTString())},getCookie=function(e){return(e=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)")))?unescape(e[2]):null},delCookie=function(e){var t=new Date,i=(t.setTime(t.getTime()-1),getCookie(e));null!=i&&(document.cookie=e+"="+i+";expires="+t.toGMTString())},SignaturePad=(Signature.prototype.onshowSealsDialog_PW=function(i){var n,a=this;a.sealService.getKeysn({},function(e){var t;a.keysn=n=e,"true"==getCookie("ck")&&i.find("#kg-remenberPwd").attr("checked","checked"),i.find("#kg-remenberPwd").is(":checked")&&(e=getCookie("ksn"),n==e)&&(e=i.find("#kg-password"),t=getCookie("pwd"),null!=(t=Signature.options.pw_enc_save?Utils.Base64.of().decode(t):t)?e.val(t):e.val("123"))})},Signature.prototype.onexecSuccess=function(e,n,a){var o,s=this;s.sealService.getKeysn({},function(e){var t,i;s.keysn=o=e,a?(t=getCookie("ksn"),e=Signature.options.pw_timeout,i=function(e){o!=t&&((void 0===e||e.indexOf("s")<0&&e.indexOf("h")<0&&e.indexOf("d")<0)&&(e="s1800"),Signature.options.pw_enc_save&&(n=Utils.Base64.of().encode(n)),setCookie("ksn",o,e),setCookie("pwd",n,e),setCookie("ck","true",e))},Signature.options.pw_server_timeout?s.sealService.getPwdSaveTime(i,e):i(e)):!Signature.options.pwd_clear_flag&&Signature.options.remberPwdAndShowSealsDlg&&(delCookie("ksn"),delCookie("pwd"),delCookie("ck"))})},Signature.prototype.ongetRPW=function(e){if(getCookie("ksn")==e)return e=getCookie("pwd"),e=Signature.options.pw_enc_save?Utils.Base64.of().decode(e):e},Signature.prototype.onDeleteRPW=function(){delCookie("ksn"),delCookie("pwd"),delCookie("ck")},function(M){function i(e,o,t){function i(e){return e.type.indexOf("mouse")<0&&(n=!0),e}function s(e){if((e=i(e||window.event)).stopPropagation(),"mousedown"!=e.type&&"touchstart"!=e.type||$(e.target)[0].id!=T.canvasName||n&&1<e.touches.length)return 0;(1===e.which||n&&1==e.touches.length)&&(a=!0,"svg"!=T.writeType&&(A.fillStyle=P,A.globalAlpha=1),m=e=E(n?e.touches[0]:e),v.unshift({time:(new Date).getTime(),dis:0,x:e.x,y:e.y}),b&&(y={top:e.y,right:e.x,bottom:e.y,left:e.x},b=!1),l(e=v),r(e)),"function"==typeof T.touchstartCallback&&T.touchstartCallback()}function r(e){if(!(e.length<=1)){var t,i,n,a,o,s,r,l=e.length<=2?(t=e[1].x,a=e[1].y,i=t+.5*((n=e[1].x+.5*(e[0].x-e[1].x))-t),o=a+.5*((s=e[1].y+.5*(e[0].y-e[1].y))-a),r=e[1].r,e[1].r+.5*(e[0].r-e[1].r)):(t=e[2].x+.5*(e[1].x-e[2].x),a=e[2].y+.5*(e[1].y-e[2].y),i=e[1].x,o=e[1].y,n=i+.5*(e[0].x-i),s=o+.5*(e[0].y-o),r=e[2].r+.5*(e[1].r-e[2].r),(g=e[1].r)+.5*(e[0].r-g)),c=[];for(e=0;e<5;e++){var u=e/4,g=(1-u)*(1-u)*t+2*u*(1-u)*i+u*u*n,d=r+(l-r)/5*e;if(c.push({x:g,y:u=(1-u)*(1-u)*a+2*u*(1-u)*o+u*u*s,r:d}),3==c.length){var h=c[0].x,f=c[0].y,p=c[0].r,_=c[1].x,m=c[1].y,v=c[2].x,k=c[2].y,S=c[2].r,c=[],b=_-h,y=m-f,C=2*Math.sqrt(b*b+y*y+1e-4),w=y=y/C*p,D=-(b=b/C*p),p=m-k,E=(E=_-v)/(C=2*Math.sqrt(E*E+p*p+1e-4))*S,S=-(p=p/C*S);for(C=E,c.push({mx:h+w,my:f+D,color:"#1A1A1A"}),c.push({c1x:_+w,c1y:m+D,c2x:_+S,c2y:m+C,ex:v+S,ey:k+C}),c.push({c1x:v+S-E,c1y:k+C-p,c2x:v-S-E,c2y:k-C-p,ex:v-S,ey:k-C}),c.push({c1x:_-S,c1y:m-C,c2x:_-w,c2y:m-D,ex:h-w,ey:f-D}),c.push({c1x:h-w-b,c1y:f-D-y,c2x:h+w-b,c2y:f+D-y,ex:h+w,ey:f+D}),c[0].mx=c[0].mx.toFixed(1),c[0].mx=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[0].mx),c[0].my=c[0].my.toFixed(1),c[0].my=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[0].my),h=1;h<c.length;h++)c[h].c1x=c[h].c1x.toFixed(1),c[h].c1x=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[h].c1x),c[h].c1y=c[h].c1y.toFixed(1),c[h].c1y=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[h].c1y),c[h].c2x=c[h].c2x.toFixed(1),c[h].c2x=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[h].c2x),c[h].c2y=c[h].c2y.toFixed(1),c[h].c2y=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[h].c2y),c[h].ex=c[h].ex.toFixed(1),c[h].ex=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[h].ex),c[h].ey=c[h].ey.toFixed(1),c[h].ey=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(c[h].ey);if((h=c)[0].color=P,T.bethelPoint.push(h),f=void 0,"svg"==T.writeType){for(void 0===f&&(f=h[0].color),_="M "+h[0].mx+" "+h[0].my+" C",m=1;m<h.length;m++)_=(_=(_+=" "+h[m].c1x+" "+h[m].c1y)+(" "+h[m].c2x+" "+h[m].c2y))+(" "+h[m].ex+" "+h[m].ey);x.path(_).attr("stroke",f).attr("stroke-width",1).attr("fill",f)}else{for(A.beginPath(),A.moveTo(h[0].mx,h[0].my),null!=f?(A.fillStyle=f,A.strokeStyle=f):(A.fillStyle=h[0].color,A.strokeStyle=h[0].color),f=1;f<h.length;f++)A.bezierCurveTo(h[f].c1x,h[f].c1y,h[f].c2x,h[f].c2y,h[f].ex,h[f].ey);A.stroke(),A.fill()}c=[{x:g,y:u,r:d}]}}}}function l(e){if(e.length<=1)return e[0].r=1;T.distance({x:e[0].x,y:e[0].y},{x:e[1].x,y:e[1].y});for(var t=0,i=0,n=0;n<e.length-1&&(t+=e[n].dis,i+=e[n].time-e[n+1].time,!(h<t));n++);e[0].r=Math.min(i/+t*T.pressure+T.lineMin,T.lineMax)*d}function f(e){return e=e.toFixed(4),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e)}function p(e){if(/^(rgb|RGB)/.test(e)){for(var t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",n=0;n<t.length;n++){var a=Number(t[n]).toString(16);i+=a=a.length<2?"0"+a:a}return i=7!==i.length?e:i}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(6===(t=e.replace(/#/,"").split("")).length)return e;if(3===t.length)for(e="#",n=0;n<t.length;n+=1)e+=t[n]+t[n]}return e}function u(e,t,i,n,a){return{x:e*Math.cos(i)-t*Math.sin(i)+n,y:e*Math.sin(i)+t*Math.cos(i)+a}}var n,a=!1,c=(this.writeType="canvas",this.canvasName=e,this.lineMin=.5,this.lineMax=2,this.pressure=1,this.linePrack=[],this.chirography=[],this.currentChirography={},this.transformpdfData=[],this.canvasHeight=this.canvasWidth=0,this.currentBethelLinePoint=[],this.bethelPoint=[],null),g=null,A=null,x=null,P="#1A1A1A",d=1.5,h=100,_=0,m={},v=[],k=2,S=2,b=!0,y={top:0,right:0,bottom:0,left:0},T=this,C=(this.clearCanvasCallback=this.touchendCallback=this.touchmoveCallback=this.touchstartCallback="",this.init=function(e,t,i,n){T.writeType="canvas",T.canvas=o.dlg.find("#"+T.canvasName)[0],(A=T.canvas.getContext("2d")).rotate(45*Math.PI/180),A.fillStyle="rgba(0,0,0,1)";var a=T.canvas;k=(i=null==i?720:i)/(e=null==e?720:e),S=(n=null==n?1280:n)/(t=null==t?1280:t),$(a).width(e),$(a).attr("width",i),$(a).height(t),$(a).attr("height",n),T.canvasWidth=i,T.canvasHeight=n,o.dlg.find("#"+T.canvasName)[0].addEventListener("mousedown",s,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("mousemove",C,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("mouseup",w,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("mouseout",w,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchstart",s,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchmove",C,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchend",w,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchcancel",D,!1)},this.initSVG=function(e,t,i,n){T.writeType="svg",k=(i=null==i?720:i)/(e=null==e?720:e),S=(n=null==n?1280:n)/(t=null==t?1280:t),T.canvas=M.getElementById(T.canvasName),(x=new Snap(T.canvas)).attr({width:e,height:t,viewBox:"0, 0, "+i+", "+n}),o.dlg.find("#"+T.canvasName)[0].addEventListener("mousedown",s,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("mousemove",C,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("mouseup",w,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("mouseout",w,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchstart",s,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchmove",C,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchend",w,!1),o.dlg.find("#"+T.canvasName)[0].addEventListener("touchcancel",D,!1)},this.newCanvas=function(e,t,i,n,a){var o=this.canvas,s=$(o)[0].id,r=(s=M.getElementById(s).getContext("2d")).getImageData(0,0,o.width,o.height);k=(i=null==i?720:i)/(e=null==e?720:e),S=(n=null==n?1280:n)/(t=null==t?1280:t),$(o).width(e),$(o).attr("width",i),$(o).height(t),$(o).attr("height",n),T.canvasWidth=i,T.canvasHeight=n,e=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(o.width*(1-1/a)),o.height,s.putImageData(r,_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(e),0)},this.setCanvasSize=function(e,t,i,n,a,o){null==e&&(e=this.width),null==t&&(t=this.height),null==innerWidth&&(innerWidth=this.innverWidth),null==innerHeight&&(innerHeight=this.innerheight),i=A.getImageData(0,0,this.innerWidth,this.innerHeight),k=innerWidth/e,S=innerHeight/t,$(this.canvas).width(e),$(this.canvas).attr("width",innerWidth),$(this.canvas).height(t),$(this.canvas).attr("height",innerHeight),this.canvasWidth=innerWidth,this.canvasHeight=innerHeight,A.putImageData(i,0,0)},this.setLineColor=function(e){P=e},this.setLineSize=function(e){d=e},this.setSmoothness=function(e){h=e},this.setLineMin=function(e){this.lineMin=e},this.setLineMax=function(e){this.lineMax=e},this.showAllSign=function(e){var t=$(this.canvas)[0].id,i=(t=M.getElementById(t)).getContext("2d");return e=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(1/e),i.scale(e,e),(e=new Image).src=t.toDataURL("image/png"),e},function(e){return e=e||window.event,T.touchmoveCallback&&T.touchmoveCallback(),"mousemove"!=e.type&&"touchmove"!=e.type||$(e.target)[0].id!=T.canvasName?0:n&&1<e.touches.length?(e.stopPropagation(),e.preventDefault(),!e.cancelable||e.defaultPrevented||e.preventDefault(),0):((a||n&&1==e.touches.length)&&(e.cancelable&&!e.defaultPrevented&&e.preventDefault(),(e=E(n?e.touches[0]:e)).y<y.top&&(y.top=e.y),e.y<0&&(y.top=0),e.x>y.right&&(y.right=e.x),T.canvasWidth-e.x<=0&&(y.right=T.canvasWidth),e.y>y.bottom&&(y.bottom=e.y),T.canvasHeight-e.y<=0&&(y.bottom=T.canvasHeight),e.x<y.left&&(y.left=e.x),e.x<0&&(y.left=0),_=m,m=e,v.unshift({time:(new Date).getTime(),dis:T.distance(m,_),x:e.x,y:e.y}),l(e=v),r(e)),void("function"==typeof T.touchmoveCallback&&T.touchmoveCallback()))}),w=function(e){if((e=i(e||window.event)).stopPropagation(),"mouseup"!=e.type&&"touchend"!=e.type||$(e.target)[0].id!=T.canvasName)return 0;(1===e.which&&a||n&&!(1<e.touches.length))&&(a=!1,e=E(n?e.changedTouches[0]:e),_=m,m=e,v.unshift({time:(new Date).getTime(),dis:T.distance(m,_),x:e.x,y:e.y}),2<v.length&&(v[0].time,v[v.length-1].time,v.length),"canvas"==T.writeType?(l(e=v),r(e),T.chirography.unshift({lineSize:d,lineColor:P}),T.linePrack.unshift(v)):T.overlapInCanvas(v),v=[],"function"==typeof T.touchendCallback)&&T.touchendCallback()},D=function(e){(e=i(e||window.event)).type},E=function(e){if(null==c||null==T.offsetTop)if("svg"==T.writeType)c=$(T.canvas).offset().left,g=$(T.canvas).offset().top;else{var t=0;c=T.canvas.offsetLeft,g=T.canvas.offsetTop;for(var i=T.canvas.parentNode;t<100&&i.tagName&&"BODY"!=i.tagName;)c+=i.offsetLeft,g+=i.offsetTop,i=i.parentNode,t++}return t=e.clientX-c,e=e.clientY-g+100+o.toolBarHeight,o.hideToolBar&&(e-=o.toolBarHeight),window!=top&&root.iframeDialog&&(e+=$(window.top.document).find(".kg-hw-content").height()),o.isMobile&&(e+=M.body.scrollTop||M.documentElement.scrollTop),{x:t*=k,y:e*=S}};this.distance=function(e,t){var i=t.x-e.x;return e=t.y-e.y,Math.sqrt(i*i+e*e)},this.reWriteCanvas=function(){A.restore()},this.writeCanvas=function(){T.clearCanvas();for(var e=0;e<T.linePrack.length;e++){var t=T.linePrack[T.linePrack.length-e-1],i=[];A.fillStyle=T.chirography[T.chirography.length-e-1].lineColor,d=T.chirography[T.chirography.length-e-1].lineSize,P=T.chirography[T.chirography.length-e-1].lineColor;for(var n=0;n<t.length;n++){i.unshift(t[t.length-n-1]);var a=i;l(a),r(a)}}return!0},this.clearCanvas=function(){"function"==typeof T.clearCanvasCallback&&T.clearCanvasCallback(),A&&A.clearRect(0,0,T.canvas.width,T.canvas.height),x&&x.clear()},this.clearCanvasAndData=function(){T.clearCanvas(),T.linePrack=[],T.chirography=[],T.bethelPoint=[],b=!0},this.overlapInCanvas=function(e){e=e[0];for(var t=0;t<T.linePrack.length;t++)for(var i=T.linePrack[t],n=0;n<i.length;n++)if((e.x-i[n].x)*(e.x-i[n].x)+(e.y-i[n].y)*(e.y-i[n].y)<400){T.linePrack.splice(t,1),T.chirography.splice(t,1),T.writeCanvas();break}},this.overlapLine=function(e,t,i,n){A.isPointInPath(20,50)},this.saveImage=function(){return this.canvas.toDataURL.apply(this.canvas,arguments)},this.coordinateSystem=function(e,t){return{x:e,y:t}},this.transformpdf=function(){for(var e=this.linePrack,t=0;t<e.length;t++){var i=e[t];if(!(i.length<2)){for(var n=i.length,a=+i[n-1].x+.1,o=+i[n-1].y,s=i[n-1].r,r=+i[n-2].x+.1,l=+i[n-2].y,c=i[n-2].r,u=r-a,g=l-o,d=g=g/(_=2*Math.sqrt(u*u+g*g+1e-4))*s,h=-(u=u/_*s),f=[],p=3;p<=i.length;p++){var _,m=+i[n-p].x,v=+i[n-p].y,k=i[n-p].r,S=(l+v)/2,c=(c+k)/2,b=l-S,y=(y=r-(s=(r+m)/2))/(_=2*Math.sqrt(y*y+b*b+1e-4))*c,C=(_=-(b=b/_*c),y);f[0]=T.coordinateSystem(a+d,o+h),f[1]=T.coordinateSystem(r+d,l+h),f[2]=T.coordinateSystem(r+_,l+C),f[3]=T.coordinateSystem(s+_,S+C),f[4]=T.coordinateSystem(s+_-y,S+C-b),f[5]=T.coordinateSystem(s-_-y,S-C-b),f[6]=T.coordinateSystem(s-_,S-C),f[7]=T.coordinateSystem(r-_,l-C),f[8]=T.coordinateSystem(r-d,l-h),f[9]=T.coordinateSystem(a-d,o-h),f[10]=T.coordinateSystem(a-d-u,o-h-g),f[11]=T.coordinateSystem(a+d-u,o+h-g),f[12]=T.coordinateSystem(a+d,o+h),a=s,o=S,r=m,l=v,c=k,u=-y,g=-b,d=_,h=C,T.transformpdfData.push(f)}y=r-(s=+i[0].x),b=l-(S=+i[0].y),f[0]=T.coordinateSystem(a+d,o+h),f[0]=T.coordinateSystem(a+d,o+h)}}},this.getExtrema=function(){y={top:this.canvasHeight*S,right:0,bottom:0,left:this.canvasWidth*k};for(var e=0;e<this.linePrack.length;e++)for(var t=0;t<this.linePrack[e].length;t++)this.linePrack[e][t].y<y.top&&(y.top=this.linePrack[e][t].y),this.linePrack[e][t].y>y.bottom&&(y.bottom=this.linePrack[e][t].y),this.linePrack[e][t].x>y.right&&(y.right=this.linePrack[e][t].x),this.linePrack[e][t].x<y.left&&(y.left=this.linePrack[e][t].x)};this.calcRotateCanvasInfo=function(){for(var e,t,i,n,a=[],o=[],s=y.bottom-y.top+60,r=y.right-y.left+60,l=0;l<this.linePrack.length;l++){a[l]=[],o[l]={lineSize:this.chirography[l].lineSize,lineColor:this.chirography[l].lineColor};for(var c=0;c<this.linePrack[l].length;c++)e=this.linePrack[l][c].x-y.left+30,t=this.linePrack[l][c].y-y.top+30,i=-Math.PI/2,n=y.right-y.left+60,e=u(e,t,i,0,n),a[l][c]={x:f(e.x),y:f(e.y),dis:this.linePrack[l][c].dis,time:this.linePrack[l][c].time,r:this.linePrack[l][c].r}}return{canvasWidth:s/k,canvasHeight:r/S,canvasInnerWidth:s,canvasInnerHeight:r,linePrack:a,chirography:o,bethelPoint:this.bethelPoint}},this.destory=function(){},this.centreRotate=function(e){for(var t,i=-(Math.min(T.canvasWidth*Math.cos(e),0)+Math.min(T.canvasHeight*Math.cos(e+Math.PI/2),0)),n=-(Math.min(T.canvasWidth*Math.sin(e),0)+Math.min(T.canvasHeight*Math.sin(e+Math.PI/2),0)),a=0;a<T.bethelPoint.length;a++){t=u(T.bethelPoint[a][0].mx,T.bethelPoint[a][0].my,e,i,n),T.bethelPoint[a][0].mx=t.x,T.bethelPoint[a][0].my=t.y;for(var o=1;o<T.bethelPoint[a].length;o++)t=u(T.bethelPoint[a][o].c1x,T.bethelPoint[a][o].c1y,e,i,n),T.bethelPoint[a][o].c1x=t.x,T.bethelPoint[a][o].c1y=t.y,t=u(T.bethelPoint[a][o].c2x,T.bethelPoint[a][o].c2y,e,i,n),T.bethelPoint[a][o].c2x=t.x,T.bethelPoint[a][o].c2y=t.y,t=u(T.bethelPoint[a][o].ex,T.bethelPoint[a][o].ey,e,i,n),T.bethelPoint[a][o].ex=t.x,T.bethelPoint[a][o].ey=t.y}t=Math.abs(T.canvasWidth*Math.sin(e))+Math.abs(T.canvasHeight*Math.sin(e+Math.PI/2)),T.canvasWidth=Math.abs(T.canvasWidth*Math.cos(e))+Math.abs(T.canvasHeight*Math.cos(e+Math.PI/2)),T.canvasHeight=t},this.toSVG=function(e){e=e?new Snap(e):new Snap;for(var t=0;t<this.bethelPoint.length;t++){for(var i="M "+f(this.bethelPoint[t][0].mx/this.canvasHeight)+" "+f(this.bethelPoint[t][0].my/this.canvasHeight)+" C",n=1;n<this.bethelPoint[t].length;n++)i=(i=(i+=" "+f(this.bethelPoint[t][n].c1x/this.canvasHeight)+" "+f(this.bethelPoint[t][n].c1y/this.canvasHeight))+(" "+f(this.bethelPoint[t][n].c2x/this.canvasHeight)+" "+f(this.bethelPoint[t][n].c2y/this.canvasHeight)))+(" "+f(this.bethelPoint[t][n].ex/this.canvasHeight)+" "+f(this.bethelPoint[t][n].ey/this.canvasHeight));e.path(i).attr("stroke",this.bethelPoint[t][0].color).attr("stroke-width",1/this.canvasHeight).attr("fill",this.bethelPoint[t][0].color)}return t="0 0 "+f(this.canvasWidth/this.canvasHeight)+" 1",e.attr("viewBox",t),e.attr("width",f(this.canvasWidth/this.canvasHeight)+"px"),e.attr("height","1px"),e.outerSVG()},this.toCommonSVG=function(e){e=e?new Snap(e):new Snap;for(var t=0;t<T.bethelPoint.length;t++){for(var i="M "+f(T.bethelPoint[t][0].mx)+" "+f(T.bethelPoint[t][0].my)+" C",n=1;n<T.bethelPoint[t].length;n++)i=(i=(i+=" "+f(T.bethelPoint[t][n].c1x)+" "+f(T.bethelPoint[t][n].c1y))+(" "+f(T.bethelPoint[t][n].c2x)+" "+f(T.bethelPoint[t][n].c2y)))+(" "+f(T.bethelPoint[t][n].ex)+" "+f(T.bethelPoint[t][n].ey));e.path(i).attr("stroke",T.bethelPoint[t][0].color).attr("stroke-width",1).attr("fill",T.bethelPoint[t][0].color)}return e.attr("viewBox","0 0 "+T.canvasWidth+" "+T.canvasHeight),e.attr("width",T.canvasWidth+"px"),e.attr("height",T.canvasHeight+"px"),e.outerSVG()},this.pathToSVG=function(s){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=$("body").width(),l=$("body").height();if(1==e){var e="svg"+Math.floor(1e4*Math.random()),t=$("<svg id="+e+"></svg>");for(t.css("position","fixed"),$("body").prepend(t),(e=new Snap("#"+e)).attr("width",r+"px"),e.attr("height",l+"px"),t=0;t<s.length;t++){for(var i="M "+f(s[t][0].mx*r)+" "+f((1-s[t][0].my)*l)+" C",n=1;n<s[t].length;n++)i=(i=(i+=" "+f(s[t][n].c1x*r)+" "+f((1-s[t][n].c1y)*l))+(" "+f(s[t][n].c2x*r)+" "+f((1-s[t][n].c2y)*l)))+(" "+f(s[t][n].ex*r)+" "+f((1-s[t][n].ey)*l));e.path(i).attr("stroke",s[t][0].color).attr("stroke-width",1).attr("fill","none")}}else _babel_runtime_corejs2_core_js_object_keys__WEBPACK_IMPORTED_MODULE_8___default()(s).forEach(function(e){e=s[e];for(var t=0;t<e.length;t++){var i="svg"+t+Math.floor(1e4*Math.random()),n=$("<svg id="+i+"></svg>");for(n.css("position","fixed"),$("body").prepend(n),i="#"+i,(i=new Snap(i)).attr("width",r+"px"),i.attr("height",l+"px"),n=0;n<e[t].length;n++){for(var a="M "+e[t][n][0].mx*r+" "+(1-e[t][n][0].my)*l+" C",o=1;o<e[t][n].length;o++)a=(a=(a+=" "+e[t][n][o].c1x*r+" "+(1-e[t][n][o].c1y)*l)+(" "+e[t][n][o].c2x*r+" "+(1-e[t][n][o].c2y)*l))+(" "+e[t][n][o].ex*r+" "+(1-e[t][n][o].ey)*l);i.path(a).attr("stroke",e[t][n][0].color).attr("stroke-width",1).attr("fill",e[t][n][0].color)}}})},this.SVGToPath=function(e,t,i,r,l,c,u,n,a,g){var d,o,h;if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==r&&void 0!==l&&void 0!==c&&void 0!==u)return t=new Snap(t),d=[],void 0!==n&&void 0!==a&&void 0!==g||(o=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(t.attr("height")),n=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(t.getBBox().width),a=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(t.getBBox().height),g=o/a),h="",t.selectAll("path").forEach(function(e){for(var t,i=e.attr("d").split(" "),n=[],a=0;a<i.length;a++)2==(t=i[a].split(",")).length?(n.push(t[0]),n.push(t[1])):n.push(t[0]);for(t=[],a=0;a<n.length;a++){if(i=n[a],isNaN(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.slice(0,1)))){if(h=i.slice(0,1),1==n[a].length&&"Z"!=h)continue;i=i.slice(1)}switch(h){case"M":var o=n[a+1];a++;var s="none"==(s=e.attr("stroke"))?"#000000":p(s);f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(o)*g+u)/l),t.push({mx:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),my:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(o)*g+u)/l),color:s});break;case"Q":t.push({c1x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c1y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),c2x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c2y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),ex:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+2])*g/r+c/r),ey:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+3])*g+u/l))}),a+=3;break;case"C":t.push({c1x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c1y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),c2x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+2])*g/r+c/r),c2y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+3])*g+u)/l),ex:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+4])*g/r+c/r),ey:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+5])*g+u)/l)}),a+=5;break;case"L":t.push({c1x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c1y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),c2x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c2y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),ex:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),ey:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l)}),a++;break;case"Z":d.push(t),t=[]}}t.length&&d.push(t)}),void 0===e[i]&&(e[i]=[]),e[i].push(d),e},this.SVGToPathNoPage=function(e,r,l,c,u,t,i,g){var d,n,h;if(void 0!==e&&void 0!==r&&void 0!==l&&void 0!==c&&void 0!==u)return e=new Snap(e),d=[],void 0!==t&&void 0!==i&&void 0!==g||(n=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.attr("height")),t=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.getBBox().width),i=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(e.getBBox().height),g=i/n),h="",e.selectAll("path").forEach(function(e){for(var t,i=e.attr("d").split(" "),n=[],a=0;a<i.length;a++)2==(t=i[a].split(",")).length?(n.push(t[0]),n.push(t[1])):n.push(t[0]);for(t=[],a=0;a<n.length;a++){if(i=n[a],isNaN(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_3___default()(i.slice(0,1)))){if(h=i.slice(0,1),1==n[a].length&&"Z"!=h)continue;i=i.slice(1)}switch(h){case"M":var o=n[a+1];a++;var s="none"==(s=e.attr("stroke"))?"#000000":p(s);t.push({mx:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),my:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(o)*g+u)/l),color:s});break;case"Q":t.push({c1x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c1y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),c2x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c2y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),ex:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+2])*g/r+c/r),ey:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+3])*g+u/l))}),a+=3;break;case"C":t.push({c1x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c1y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),c2x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+2])*g/r+c/r),c2y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+3])*g+u)/l),ex:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+4])*g/r+c/r),ey:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+5])*g+u)/l)}),a+=5;break;case"L":t.push({c1x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c1y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),c2x:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),c2y:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l),ex:f(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(i)*g/r+c/r),ey:f(1-(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(n[a+1])*g+u)/l)}),a++;break;case"Z":d.push(t),t=[]}}t.length&&d.push(t)}),d}}function e(e,t){this.times=2,this.canvas=e,this.isSign=!1,t.isMobile=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent),this.painting=new i("canvasId",t),this.initCanvas(t),this.painting.touchstartCallback=t.onBegin,this.painting.touchendCallback=t.onEnd,this.lineSize=t.lineSize||5,this.setSize(this.lineSize),this.lineMax=t.lineMax||4,this.painting.setLineMax(this.lineMax),this.lineMin=t.lineMin||.5,this.painting.setLineMin(this.lineMin),this.smoothness=t.smoothness||100,this.painting.setSmoothness(this.smoothness)}return e.prototype.initCanvas=function(e){var t=e.canvas_width;e=e.canvas_height,this.painting.init(t,e,t*this.times,e*this.times),this.canvas.getContext("2d").fillStyle="rgba(0,0,0,0)"},e.prototype.setSize=function(e){this.painting.setLineSize(e)},e.prototype.setColor=function(e){this.painting.setLineColor(e)},e.prototype.clear=function(){this.isSign=!1,this.painting.clearCanvasAndData()},e.prototype.setWebHandWrite=function(e,t){var i=this.canvas.getContext("2d");for(i.textAlign="left",i.textBaseline="bottom",i.shadowBlur=0,i.font=t.fontStyle+" "+_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_6___default()(t.fontSize)*this.times+"px "+t.fontFamily,i.fillStyle=t.fontColor,t=0;e&&t<e.length;t++){var n=e[t];i.fillText(n.txt,n.left*this.times,n.top*this.times)}},e.prototype.toDataURL=function(i,n){for(var e=(u=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height)).data,a=u.width,o=0,s=u.height,r=0,t=0;t<this.canvas.width;t++)for(var l=0;l<u.height;l++){var c=4*(t+u.width*l);(0<e[c]||0<e[1+c]||e[2+c]||0<e[3+c])&&(r=Math.max(l,r),o=Math.max(t,o),s=Math.min(l,s),a=Math.min(t,a))}a++,o++,s++,r++;var u=this.painting.saveImage(),g=new Image;g.src=u,g.onload=function(){var e=M.createElement("canvas"),t=(e.width=o-a,e.height=r-s,e.getContext("2d"));1==n.mode&&n.noCutting&&(e.width=n.display_width,e.height=n.display_height,s=a=0),0==n.mode&&n.noCutting&&(e.width=e.width>n.display_width?e.width:n.display_width,e.height=e.height>n.display_height?e.height:n.display_height,s=a=0),t.drawImage(g,a,s,e.width,e.height,0,0,e.width,e.height),(t={}).imageData=e.toDataURL(),t.width=e.width,t.height=e.height,i(t)}},e}(document));__webpack_exports__.Z=Signature},8043:function(e,t,i){i(34456),e.exports=i(34579).setImmediate},34456:function(e,t,i){var n=i(83856),i=i(62569);n(n.G+n.B,{setImmediate:i.set,clearImmediate:i.clear})},69751:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return o}});var t=i(18428),n=i.n(t),a=i(53894),t={name:"hwFile",components:{},props:{formMeta:{type:Object,default:function(){return{}}},formData:{type:Object,default:function(){return{}}},hwtype:{type:String,default:"jg"}},data:function(){return{iframeUrl:"",lineWidth:6,lineColor:"#000000",bgColor:"white",resultImg:"",isCrop:!1,imgUrl:"",thicknessList:[{text:"特细",lineWidth:2},{text:"细",lineWidth:4},{text:"粗",lineWidth:6},{text:"特粗",lineWidth:8}],isShowThicknessPicker:!1,isFullScreen:!1,esignHeight:300,tempImgUrl:"",shuiyin_div:null,isShowSignBtnBox:!1,isShowSignBtn:!1,user:{}}},created:function(){var t;"jg"==this.hwtype&&(t="commonList"==this.$route.name?this.formData.info_id:this.formMeta.parameters.pk,a.Z.dynamicLoadCss("static/js/kinggrid/dialog/kgDialog/ui-dialog.css"),a.Z.dynamicLoadCss("static/js/kinggrid/core/kinggrid.plus.css"),a.Z.dynamicLoadCss("static/js/kinggrid/core/kinggrid.plus.mobile.css"),this.user=dsf.util.loadSessionStore("user"),dsf.http.post("fn/handWrite/config",{}).then(function(e){e=e.data.data;a.Z.init({keysn:e.keysn,languagesPath:"static/js/kinggrid/languages",certType:"server",sealType:"server",serverUrl:e.serverUrl,sealTag:"GM",documentid:t})}))},computed:{},mounted:function(){},methods:{buttonHWClick:function(){var d=this,h=a.Z.create(),e={onBegin:function(){},onEnd:function(){}};dsf.config.commonFlow&&dsf.config.commonFlow.JG_HandWrite_Setting?n()(e,dsf.config.commonFlow.JG_HandWrite_Setting):n()(e,{image_height:"6.7",image_width:"10",noCutting:!0,lineSize:4,buttonText:"签批"}),h.handWriteDlg(e,function(i){var n=d.formData.moduleId,a="commonList"==d.$route.name||d.$route.params.pk?0:1,o="commonList"==d.$route.name?d.formData.info_id:d.formMeta.parameters.pk,s=d.formData.flowId,r=("commonList"==d.$route.name?d.formData:d.formMeta.parameters).nodeId,l=("commonList"==d.$route.name?d.formData:d.formMeta.parameters).nodeName,c=d.user.user_id,u="commonList"==d.$route.name?d.formData.pnid:d.formMeta.parameters.pnId,g="commonList"==d.$route.name?d.formData.pid:d.formMeta.parameters.pId;h.runHW(i,{protectedItems:[],position:"handWritePos",okCall:function(e){var t={moduleId:n,newFileFlag:a,infoId:o,flowId:s,nodeId:r,mainPk:o,createUserId:c,nodeName:encodeURIComponent(l),pnid:u,pid:g,temp:a,imageData:i.imageData,handWriteSignatureid:this.getSignatureid()};h.saveSignature(o,this.getSignatureid(),this.getSignatureData()),dsf.http.post("fn/handWrite/updateHmImg",t).then(function(e){"success"==e.data.type?(dsf.layer.toast("签批成功"),d.imgUrl=dsf.url.getServerUrl(e.data.data.handwritePicUrl),d.closePop()):dsf.layer.toast("签批失败")})},cancelCall:function(){}})})},closePop:function(){this.$emit("closeWritePopup",this.imgUrl)}}},o=(0,i(51900).Z)(t,function(){this._self._c;return this._m(0)},[function(){var e=this._self._c;return e("div",{staticStyle:{position:"absolute"}},[e("div",{attrs:{id:"pos0"}})])}],!1,null,null,null).exports},21982:function(e,t,i){e.exports=i(8043)}}]);