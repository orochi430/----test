"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[69164],{69164:function(t,i,e){e.r(i),e.d(i,{default:function(){return o}});e(88561),e(62596);var i=e(89251),s=e(25108),i={name:"set_gesture",components:{gesture:i.Z},data:function(){return{tip_mes:"",tip_color:"",tip_type:"",type:"",title:"",tip_icon:""}},created:function(){var t=this;switch(this.type="set",this.$route.query.type&&(this.type=this.$route.query.type),this.$route.params.type&&(this.type=this.$route.params.type),this.type){case"set":this.title="设置手势密码";break;case"check":this.title="手势解锁";break;case"clear":this.title="清除手势密码"}null==dsf.util.loadLocalStore("gesture_pas")&&"set"!=this.type&&dsf.layer.alert({title:"温馨提示",message:"还未设置手势密码"},function(){t.$router.go(-1)})},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},goClear:function(){var t=this;dsf.layer.alert({title:"温馨提示",message:"请输入手势密码完成清除"},function(){t.$router.push("/canvasGesture/clear")})},remind:function(t){s.log(t),this.tip_type=t[0],this.tip_mes=t[1],"success"==this.tip_type?(this.tip_color="#627eed",this.tip_icon="checked"):(this.tip_color="#ff0000",this.tip_icon="clear")}}},o=(0,e(51900).Z)(i,function(){var i=this,t=i._self._c;return t("div",{staticClass:"contentBox set_gesture"},[t("van-nav-bar",{attrs:{title:i.title},on:{"click-left":i.goBack},scopedSlots:i._u([{key:"left",fn:function(){return["set"==i.type?t("van-icon",{attrs:{name:"arrow-left"}}):i._e(),t("span",[i._v(i._s("check"==i.type?"":"返回"))])]},proxy:!0},{key:"right",fn:function(){return["set"==i.type?t("span",{on:{click:i.goClear}},[t("span",[i._v("清除")])]):i._e()]},proxy:!0}])}),i._v(" "),t("div",{staticClass:"gesture-wrap"},[t("div",{staticClass:"text-center img_tip"},[t("van-icon",{attrs:{name:i.tip_icon,size:"1rem",color:i.tip_color}}),i._v(" "),t("span",[i._v(i._s(i.tip_mes))])],1),i._v(" "),t("div",{staticStyle:{width:"90%",margin:"20px auto"}},[t("gesture",{attrs:{gestureType:i.type,isSet:!0},on:{remind:function(t){return i.remind(arguments)}}})],1)])],1)},[],!1,null,"34e3edce",null).exports},89251:function(t,i,e){e.d(i,{Z:function(){return c}});var i=e(79529),s=e.n(i),i=e(8450),o=e.n(i),n=e(88561),r=e(62596),h=e(25108),i={name:"gesture",props:{gestureType:{type:String,default:""},isSet:{type:Boolean,default:!1}},data:function(){return{c:"",cPosition:{},cxt:"",CW:600,CH:320,Radius:36,offsetX:5,offsetY:5,password:[],successColor:"#67c23a",errorColor:"red",innerColor:"",successInnerColor:"#ffffff",errorInnerColor:"#ffffff",selectColor:"#627eed",notSelectColor:"#CBCACE",Re:[],borderWidth:1,pointLine:[],pointWidth:12,lineWidth:3,count:0,pas_length:!1,tip_mes:"",tip_color:"",type:this.gestureType,title:""}},created:function(){var t=this;switch(this.type){case"set":this.title="设置手势密码";break;case"check":this.title="手势解锁";break;case"clear":this.title="清除手势密码"}null==n.Z.loadLocalStore("gesture_pas")&&"set"!=this.type&&dsf.layer.alert({title:"温馨提示",message:"还未设置手势密码"},function(){t.$router.go(-1)})},mounted:function(){var t=this;this.innerColor=this.successInnerColor,this.$nextTick(function(){t.init(),t.initEvent()})},methods:{goBack:function(){this.$router.go(-1)},init:function(){this.initCas(),this.getPointLocationArr(),this.draw()},initCas:function(){h.log(this.$refs.gestureBox.offsetWidth),this.c=this.$refs.myCanvas,this.CW=this.$refs.gestureBox.offsetWidth,this.CH=this.CW/1.06,this.c.width=this.CW,this.c.height=this.CH,600<s()(this.CW)&&s()(this.CW)<1e3&&(this.c.width=600,this.c.height=600,this.CH=600,this.CW=600,this.offsetX=20,this.Radius=35,this.c.style.margin="0 calc(50% - 300px)"),1e3<s()(this.CW)&&(this.c.width=800,this.c.height=800,this.CH=800,this.CW=800,this.offsetX=20,this.Radius=45,this.c.style.margin="0 calc(50% - 400px)"),h.log(this.c.height,this.offsetY),this.cPosition=this.c.getBoundingClientRect(),this.cxt=this.c.getContext("2d")},getPointLocationArr:function(){for(var t=(this.CW-2*this.offsetX-2*this.Radius*3)/2,i=(this.CH-2*this.offsetY-2*this.Radius*3)/2,e=0;e<3;e++)for(var s=0;s<3;s++){var o={x:this.offsetX+s*t+(2*s+1)*this.Radius,y:this.offsetY+e*i+(2*e+1)*this.Radius,coordinate:String(e)+String(s)};this.Re.push(o)}h.log(this.Re)},drawPoint:function(t,i){var e=this.pointLine;this.cxt.beginPath();for(var s=0;s<e.length;s++){var o=this.Re[e[s]];this.cxt.lineTo(o.x,o.y)}this.cxt.strokeStyle=this.selectColor,this.cxt.lineWidth=this.lineWidth,this.cxt.stroke(),this.cxt.closePath(),i&&(i=this.Re[this.pointLine[this.pointLine.length-1]],this.cxt.beginPath(),this.cxt.moveTo(i.x,i.y),this.cxt.lineTo(t.pageX-this.cPosition.left,t.pageY-this.cPosition.top),this.cxt.strokeStyle=this.selectColor,this.cxt.lineWidth=this.lineWidth,this.cxt.stroke(),this.cxt.closePath())},isPointSelect:function(t){for(var i=this.Re,e=0;e<i.length;e++){var s=i[e],o=Math.abs(t.pageX-s.x-this.cPosition.left),s=Math.abs(t.pageY-s.y-this.cPosition.top);Math.pow(o*o+s*s,.5)<=this.Radius&&(this.pointLine.length||-1!==this.pointLine.indexOf(e)?-1===this.pointLine.indexOf(e)&&this.handleError(e):this.pointLine.push(e))}},initEvent:function(){var i=this;this.c.addEventListener("touchstart",function(t){i.isPointSelect(t.touches[0])}),this.c.addEventListener("touchmove",function(t){i.isPointSelect(t.touches[0]),i.cxt.clearRect(0,0,i.CW,i.CH),i.draw(t.touches[0],!0)}),this.c.addEventListener("touchend",function(t){i.pas_length=!1,i.pointLine.length<4&&"set"==i.type&&(i.errorSet("密码长度不能小于4"),i.pas_length=!0),i.checkIsRight(),i.cxt.clearRect(0,0,i.CW,i.CH),i.draw(t.touches[0],!1),i.resetCxt(t.touches[0])})},handleError:function(t){var i=this.pointLine[this.pointLine.length-1];0===t&&8===i||8===t&&0===i||2===t&&6===i||6===t&&2===i||1===t&&7===i||7===t&&1===i||3===t&&5===i||5===t&&3===i?-1===this.pointLine.indexOf(4)&&this.pointLine.push(4):2===t&&0===i||0===t&&2===i?-1===this.pointLine.indexOf(1)&&this.pointLine.push(1):6===t&&8===i||8===t&&6===i?-1===this.pointLine.indexOf(7)&&this.pointLine.push(7):0===t&&6===i||6===t&&0===i?-1===this.pointLine.indexOf(3)&&this.pointLine.push(3):(2===t&&8===i||8===t&&2===i)&&-1===this.pointLine.indexOf(5)&&this.pointLine.push(5),this.pointLine.push(t)},resetCxt:function(t){var i=this,e=this;setTimeout(function(){i.pointLine=[],i.selectColor="#627eed",i.innerColor=i.successInnerColor,i.cxt.clearRect(0,0,e.CW,e.CH),i.draw(t,!1)},1e3)},checkIsRight:function(){var t=this;this.pas_length||(h.log("画线密码为：",this.pointLine,this.password,this.count),this.pas_length||this.count++,"set"==this.type?1===this.count?(this.password=this.pointLine,this.successSet("初次设置密码成功，请再次输入")):this.password.toString()!=this.pointLine.toString()?this.errorSet("两次密码不一致，请重新输入"):(this.successSet("二次输入正确，密码设置成功！"),h.log(this.password),n.Z.saveToLocalStore("gesture_pas",this.password),n.Z.saveToLocalStore("loginMode_set",!0),setTimeout(function(){t.$router.go(-1)},500)):"check"==this.type?(3===this.count&&String(this.pointLine)!==String(n.Z.loadLocalStore("gesture_pas"))&&(this.errorSet("手势密码错误，请重新输入"),dsf.layer.alert({title:"温馨提示",message:"超过三次输入失败，进入帐号密码登录"},function(){n.Z.removeToLocalStore("gesture_pas"),n.Z.removeToLocalStore("passWord"),t.$emit("gestureError")})),String(this.pointLine)!==String(n.Z.loadLocalStore("gesture_pas"))?this.errorSet("手势密码错误，请重新输入"):this.commonLogin()):"clear"==this.type&&(String(this.pointLine)!==String(n.Z.loadLocalStore("gesture_pas"))?this.errorSet("手势密码错误，请重新输入"):this.clearPsw()))},goUrl:function(){dsf.config.login.defaultUrl?this.$router.replace(dsf.config.login.defaultUrl):this.$router.replace("/index")},commonLogin:function(){var i,e=this;dsf.util.loadSessionStore("user")?e.goUrl():(i=dsf.layer.loading("登录中..."),dsf.http.post("/fn/mobileAuth/login",{__DATA:o()({logname:r.Z.decode(n.Z.loadLocalStore("uid")),password:r.Z.decode(n.Z.loadLocalStore("pid")),device_id:"postman",device_desc:"postman"})}).then(function(t){dsf.layer.closeLoading(i),1==t.data.rcode?(dsf.layer.toast(t.data.message),n.Z.saveToSessionStore("user",t.data.data),n.Z.saveToSessionStore("loginToken",t.data.data.auth.token),n.Z.saveToLocalStore("loginToken",t.data.data.auth.token),n.Z.saveToLocalStore("user",o()(t.data.data)),n.Z.logIn(function(){e.goUrl()})):(n.Z.removeToLocalStore("uid"),n.Z.removeToLocalStore("pid"),dsf.layer.toast("登录失效,请重新登录"),e.$router.replace("/testLogin"))}).catch(function(t){return dsf.layer.closeLoading(i)}))},clearPsw:function(){var t=this;n.Z.removeToLocalStore("gesture_pas"),n.Z.removeToLocalStore("loginMode_set"),this.successSet("手势密码清除成功"),dsf.layer.alert({title:"温馨提示",message:"手势密码清除成功"},function(){t.$route.params.type?t.$router.go(-2):t.$router.go(-1)})},successSet:function(t){this.tip_mes=t,this.tip_color="success_word",this.selectColor=this.successColor,this.innerColor=this.successInnerColor,this.isSet?this.$emit("remind","success",this.tip_mes):dsf.layer.toast(this.tip_mes)},errorSet:function(t){this.tip_mes=t,this.tip_color="error_word",this.selectColor=this.errorColor,this.innerColor=this.errorInnerColor,this.isSet?this.$emit("remind","warn",this.tip_mes):dsf.layer.toast(this.tip_mes)},draw:function(t,i){0<this.pointLine.length&&this.drawPoint(t,i);for(var e=this.Re,s=0;s<e.length;s++){var o=e[s];this.cxt.fillStyle=this.innerColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.Radius-this.borderWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),this.cxt.fillStyle=this.notSelectColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.pointWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),-1!=this.pointLine.indexOf(s)&&(this.cxt.fillStyle=this.selectColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.Radius,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),this.cxt.fillStyle=this.innerColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.Radius-this.borderWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath(),this.cxt.fillStyle=this.selectColor,this.cxt.beginPath(),this.cxt.arc(o.x,o.y,this.pointWidth,0,2*Math.PI,!0),this.cxt.fill(),this.cxt.closePath())}},randomString:function(t){t=t||32;for(var i="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",e=i.length,s="",o=0;o<t;o++)s+=i.charAt(Math.floor(Math.random()*e));return s}}},c=(0,e(51900).Z)(i,function(){var t=this._self._c;return t("div",{ref:"gestureBox",staticClass:"gesture"},[t("canvas",{ref:"myCanvas"})])},[],!1,null,"91aefebc",null).exports}}]);