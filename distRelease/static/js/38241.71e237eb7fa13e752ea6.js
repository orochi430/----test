"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[38241],{38241:function(t,e,s){s.r(e),s.d(e,{default:function(){return i}});var e=s(26243),o=s.n(e),e=s(8450),r=s.n(e),e=s(79529),n=s.n(e),e=s(18428),a=s.n(e),e={name:"democracy_assess",components:{draggable:function(){return s.e(9980).then(s.t.bind(s,82021,23))}},data:function(){return{tab_list:[],content_list:{},content_list_copy:{},drag:!0,type:"",start:"",end:"",current:"",allow_submit:{},loading_use:!1,isTouched:"",isMoved:"",touchStartY:"",touchesDiff:"",sortingEl:"",sortingItems:"",sortableContainer:"",sortingElHeight:"",minTop:"",maxTop:"",insertAfterEl:"",insertBeforeEl:"",indexFrom:"",pageEl:"",pageContentEl:"",pageHeight:"",pageOffset:"",sortingElOffsetLocal:"",sortingElOffsetTop:"",initialScrollTop:""}},created:function(){this.start=new Date(this.$route.params.start).getTime(),this.end=new Date(this.$route.params.end).getTime(),this.current=(new Date).getTime(),this.getLimit()},methods:{submitSort:function(){for(var e=this,t=(this.loading_use=!0,"sortableList"+this.type),i=this.$refs[t][0].getElementsByTagName("li"),n=[],o=0;o<i.length;o++)!function(){var s=i[o].id;e.content_list_copy[e.type].find(function(t,e){t.id===s&&(t.point=String(n.length+1),n.push(t))})}();dsf.http.post("fn/DepartmentType/UpdateDepartmentList",{list:r()(n)}).then(function(t){e.loading_use=!1,dsf.layer.toast(t.data.message),e.getData(e.type,"nosort")})},getLimit:function(){var i=this,t=dsf.util.loadLocalStore("user").user_id;dsf.http.post("fn/DepartmentType/IsReadOnly",{userId:t}).then(function(t){t.data.forEach(function(t,e){var s={};switch(s.name=t){case"业务一类":"0"===String(e)&&(i.type="1"),s.type="1";break;case"业务二类":"0"===String(e)&&(i.type="2"),s.type="2";break;case"保障部门":"0"===String(e)&&(i.type="3"),s.type="3"}i.tab_list.push(s),i.getData(s.type)})})},getData:function(e,s){var i=this,t=dsf.util.loadLocalStore("user").user_id;dsf.http.post("fn/DepartmentType/DepartmentListByType",{userId:t,type:String(e),scoringId:this.$route.params.scoringId}).then(function(t){i.start<=i.current&&i.current<=i.end&&t.data.length&&!t.data[0].point?i.allow_submit[e]=!0:i.allow_submit[e]=!1,s||t.data.sort(function(t,e){return n()(t.point)-n()(e.point)}),i.content_list[e]=t.data,i.content_list=a()({},i.content_list),i.content_list_copy=JSON.parse(r()(i.content_list))})},handleTouchStart:function(t,e){this.allow_submit[e]&&(this.isMoved=!1,this.isTouched=!0,this.touchStartY=("touchstart"===t.type?t.targetTouches[0]:t).pageY,this.sortingEl=t.target.parentElement,this.indexFrom=this.index(this.sortingEl),this.sortableContainer=this.$refs["sortableList"+e],this.sortingItems=this.sortableContainer[0].getElementsByTagName("li"))},index:function(t){var e,s=t;if(s){for(e=0;null!==(s=s.previousSibling);)1===s.nodeType&&(e+=1);return e}},handleTouchMove:function(t,e){if(this.allow_submit[e]&&this.isTouched&&this.sortingEl){var s=("touchmove"===t.type?t.targetTouches[0]:t).pageY,e=(this.isMoved||(this.pageEl=this.$refs.democracyAssess,this.pageContentEl=this.$refs["content"+e],this.initialScrollTop=this.pageContentEl[0].scrollTop,this.pageOffset=this.offset(this.pageEl).top+0,this.pageHeight=+this.pageEl.offsetHeight,this.sortingEl.className.includes("sorting")||(this.sortingEl.className="content_item sorting"),this.sortableContainer[0].className.includes("sortable-sorting")||(this.sortableContainer[0].className="sortable_list sortable-sorting sortable"),this.sortingElOffsetLocal=this.sortingEl.offsetTop,this.minTop=this.sortingEl.offsetTop,this.maxTop=this.sortingEl.parentElement.offsetHeight-this.sortingElOffsetLocal-this.sortingEl.offsetHeight,this.sortingElHeight=this.sortingEl.offsetHeight,this.sortingElOffsetTop=this.offset(this.sortingEl).top),this.isMoved=!0,t.preventDefault(),this.touchesDiff=s-this.touchStartY,this.pageContentEl[0].scrollTop-this.initialScrollTop),i=Math.min(Math.max(this.touchesDiff+e,-this.minTop),this.maxTop);this.transform("translate3d(0,".concat(i,"px,0)"),this.sortingEl,"single"),this.insertBeforeEl=void 0,this.insertAfterEl=void 0;for(var n=0;n<this.sortingItems.length;n++){var o,r,a,l=this.sortingItems[n];l!==this.sortingEl&&((o=l.offsetTop)-(r=l.offsetHeight)/2<=(a=this.sortingElOffsetLocal+i)&&this.index(this.sortingEl)<this.index(l)?(this.transform("translate3d(0, ".concat(-this.sortingElHeight,"px,0)"),l,"single"),this.insertAfterEl=l,this.insertBeforeEl=void 0):a<=o+r/2&&this.index(this.sortingEl)>this.index(l)?(this.transform("translate3d(0, ".concat(this.sortingElHeight,"px,0)"),l,"single"),this.insertAfterEl=void 0,this.insertBeforeEl||(this.insertBeforeEl=l)):this.transform("translate3d(0, 0%,0)",l,"single"))}}},handleTouchEnd:function(t,e){this.allow_submit[e]&&(this.isTouched&&this.isMoved&&(this.transform("",this.sortingItems,"array"),this.sortingEl.className.includes("sorting")&&(this.sortingEl.className="content_item"),this.sortableContainer[0].className.includes("sortable-sorting")&&(this.sortableContainer[0].className="sortable_list"),this.insertAfterEl?this.index(this.insertAfterEl):this.insertBeforeEl&&this.index(this.insertBeforeEl),this.insertAfterEl&&this.insertAfter(this.sortingEl,this.insertAfterEl),this.insertBeforeEl&&this.insertBefore(this.sortingEl,this.insertBeforeEl),this.insertBeforeEl=void 0,this.insertAfterEl=void 0),this.isTouched=!1,this.isMoved=!1)},insertAfter:function(t,e){e.parentNode.insertBefore(t,e.nextSibling)},insertBefore:function(t,e){e.parentNode.insertBefore(t,e)},offset:function(t){var e,s,i,n;return t?(e=(t=t).getBoundingClientRect(),i=document.body,s=t.clientTop||i.clientTop||0,i=t.clientLeft||i.clientLeft||0,n=t===window?window.scrollY:t.scrollTop,t=t===window?window.scrollX:t.scrollLeft,{top:e.top+n-s,left:e.left+t-i}):null},transform:function(t,e,s){if("single"===s)(s=e.style).webkitTransform=t,s.transform=t;else for(var i=0;i<e.length;i+=1){var n=e[i].style;n.webkitTransform=t,n.transform=t}return e}}},i=(0,s(51900).Z)(e,function(){var i=this,n=i._self._c;return n("div",{ref:"democracyAssess",staticClass:"democracy_assess"},[n("van-nav-bar",{attrs:{title:i.$route.params.title,"left-text":"返回","left-arrow":""},on:{"click-left":function(t){return i.$router.back()}}}),i._v(" "),n("van-tabs",{attrs:{animated:""},model:{value:i.type,callback:function(t){i.type=t},expression:"type"}},i._l(i.tab_list,function(s,t){return n("van-tab",{key:t,attrs:{title:s.name,name:s.type}},[n("div",{ref:"content"+s.type,refInFor:!0,staticClass:"main_content"},[n("div",{staticClass:"content_header border_bottom"},[i._v("部门排名详情")]),i._v(" "),i.content_list[i.type]&&i.content_list[i.type].length?n("div",{ref:"sortableList"+s.type,refInFor:!0,staticClass:"sortable_list sortable sortable-enabled"},[i.content_list&&o()(i.content_list).length?n("ul",{ref:"ulObj",refInFor:!0,staticStyle:{"padding-left":"0",margin:"0",position:"relative"}},i._l(i.content_list[s.type],function(t,e){return n("li",{key:e,staticClass:"content_item",attrs:{id:t.id}},[n("span",[i._v(i._s(t.point))]),i._v(" "),n("span",{on:{touchstart:function(t){return t.preventDefault(),t.stopPropagation(),i.handleTouchStart(t,s.type)},touchmove:function(t){return t.preventDefault(),t.stopPropagation(),i.handleTouchMove(t,s.type)},touchend:function(t){return t.preventDefault(),t.stopPropagation(),i.handleTouchEnd(t,s.type)}}},[i._v(i._s(t.deptText))])])}),0):i._e()]):n("commonempty")],1)])}),1),i._v(" "),n("van-button",{attrs:{round:"",type:"info",disabled:!i.allow_submit[i.type]},on:{click:i.submitSort}},[i._v("提交排序")]),i._v(" "),n("van-loading",{directives:[{name:"show",rawName:"v-show",value:i.loading_use,expression:"loading_use"}],attrs:{type:"spinner"}})],1)},[],!1,null,"06996b14",null).exports}}]);