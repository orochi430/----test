"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[57239],{56894:function(t,e,n){n.r(e);var a=n(73473),s=n.n(a),n={};function o(t,n,e){var a=!1,s=n.parameters.pk,o=n.parameters.moduleId,i=t.main["c-meetingsq-075"].value,t="1"==t.main.B0058.value?"220620174737bVEaMUmHpFOjkiQLDte":"220620175357LIm1ZAYkMUciKvN3tB6";return dsf.http.post("fn/office/generatorFile",{fileType:15,templateId:t,moduleId:o,pk:s}).then(function(t){return t}).then(function(t){if("success"==t.data.type)return dsf.http.post("fn/fws/redCheck",{id:s,type:5});dsf.layer.toast("发布会议通知失败!")}).then(function(t){if("success"==t.data.type)return dsf.http.post("fn/fws/electronicSignature",{id:s,qzType:5});dsf.layer.toast("发布会议通知失败!")}).then(function(t){if("success"==t.data.type)return dsf.http.post("fn/gtjMeeting/publishMeetingNotice",{pk:s,convertId:"2103110959168MfJCssug5LQKpLmQa2",meetingType:i,moduleId:o});dsf.layer.toast("发布会议通知失败!")}).then(function(t){"success"==t.data.type?(dsf.layer.toast("发布会议通知成功"),e.buttonHandle.send(e.$route.params,e.formMeta,e.formData,e,e.$refs),a=!0,n.buttons.mainButtons.forEach(function(t,e){"publishMeetingNotice"==t.action&&n.buttons.mainButtons.splice(e,1)})):dsf.layer.toast("发布会议通知失败!")}),a}n.initHandle=function(e,n,t){function a(t,e){"210521142010SF5Ab0z3RsoOzg6ERpO"==t.main["c-meetingsq-009"].value?e.controls.find(function(t){return"B0038"==t.metaId}).show=1:e.controls.find(function(t){return"B0038"==t.metaId}).show=0}n.controls.find(function(t){return"c-meetingsq-075"==t.metaId}).privilege.editable=!1,a(e,n),t.$bus.on("checkVal",function(t){"c-meetingsq-009"==t.metaData.metaId&&a(e,n)})},n.saveFilter=function(i,r,f){function u(t){return t.replace(/-/g,"/")}return new(s())(function(e,n){try{var t=Date.parse(u(i.main["c-meetingsq-007"].value))||"",a=Date.parse(u(i.main["c-meetingsq-008"].value))||"",s=i.main["c-meetingsq-009"].value,o=i.main["c-meetingsq-005"].value;f.$set(i.main,"B0001",{value:o}),t&&a&&a<=t&&n("结束时间必须大于开始时间"),"210521142010SF5Ab0z3RsoOzg6ERpO"==s&&(""==i.main.B0038.value&&n("请输入其他会场"),dsf.http.post("fn/meetingapi/meeting/checkRoom",{room:s,startTime:i.main["c-meetingsq-007"].value,endTime:i.main["c-meetingsq-008"].value,pk:r.parameters.pk}).then(function(t){t=t.data;"success"==!t.type&&n(t.message)})),dsf.http.post("fn/huiYiController/jyhys",{hys:i.main.B0038.value}).then(function(t){t.data||n("其他会场和会议有冲突,请重新填写!")}),e()}catch(t){e()}})},n.publishMeetingNotice=function(t,e,n){o(t,e,n)},n.meetingSend=function(e,n,a){a.buttonHandle.save(a.$route.params,a.formMeta,a.formData,a,a.$refs,function(){dsf.http.post("fn/meetingapi/meeting/isMeetingNoticeConverted",{pk:a.formParams.pk}).then(function(t){t.data.data.converted?a.buttonHandle.send(a.$route.params,a.formMeta,a.formData,a,a.$refs):dsf.layer.confirm({message:"尚未发布会议通知，是否要发布会议通知？",confirmButtonText:"发布通知并发送",cancelButtonText:"不发布，仍要发送"},function(){o(e,n,a),a.$set(a.formData.main,"c-meetingsq-040",{value:"1"})},function(){a.buttonHandle.send(a.$route.params,a.formMeta,a.formData,a,a.$refs)})})})},n.publishAndSend=function(t,e,n){-1!=JSON.parse(t.flowinfo["flow-".concat(e.parameters.pk,"-").concat(e.parameters.pId||"0","-").concat(e.parameters.pnId||e.parameters.pk)].opinionContentTag).findIndex(function(t){return"同意"==t.tagName})?o(t,e,n)&&dsf.layer.toast("发布会议成功",!1,function(){n.buttonHandle.send(n.$route.params,n.formMeta,n.formData,n,n.$refs)}):dsf.layer.toast("未同意,不发布会议",!1,function(){n.buttonHandle.send(n.$route.params,n.formMeta,n.formData,n,n.$refs)})},e.default=n}}]);