"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[24586],{24586:function(n,e,t){t.r(e),t.d(e,{default:function(){return a}});var e=t(8450),i=t.n(e),o=t(88561),e=(t(25108),{props:[],mounted:function(){this.dingLogin()},methods:{dingLogin:function(){var e=this;"notInDingTalk"!=dd.env.platform?dd.ready(function(){o.Z.clearSession(),dd.runtime.permission.requestAuthCode({corpId:dsf.config.ddSetting.ddCoprId,onSuccess:function(n){window.GLOBAL={},window.GLOBAL.zjpCode=n.code,e.getUserInfo()},onFail:function(n){n=i()(n);alert("失败"+n)}})}):e.$router.push({name:"testLogin"})},getUserInfo:function(){var n=this,e=(this.$toast.loading({message:"加载中...",duration:0,forbidClick:!0,loadingType:"spinner",onClose:function(){n.$router.push({name:"Home"})}}),this);dsf.http.post("/fn/mobileDingTalkAuth/login?code=".concat(window.GLOBAL.zjpCode),{}).then(function(n){n=n.data;1==n.rcode?(o.Z.saveToSessionStore("user",n.data),o.Z.saveToSessionStore("loginToken",n.data.auth.token),o.Z.saveToSessionStore("Role",n.data.role),e.getDingTalkToken()):0==n.rcode?dd.device.notification.alert({message:n.message,title:"温馨提示",buttonName:"确定",onSuccess:function(){},onFail:function(n){}}):dd.device.notification.alert({message:"登录失败!",title:"温馨提示",buttonName:"确定",onSuccess:function(){},onFail:function(n){}})})},randomString:function(n){n=n||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=e.length,i="",o=0;o<n;o++)i+=e.charAt(Math.floor(Math.random()*t));return i},getDingTalkToken:function(){var e=this;dsf.http.get("/fn/DingDing/getToken",{}).then(function(n){n=n.data;n&&n.message&&e.getDingTalkTicket(n.message)})},getDingTalkTicket:function(n){var e,t=this;dsf.http.get("/fn/DingDing/getTicket?token=".concat(n),{}).then(function(n){n=n.data;n&&n.message&&(e=n.message,t.getDingTalkSignature(e))})},getDingTalkSignature:function(n){var e=window.location.href.split("#")[0],t=this.randomString(16),i=(dsf.config.ddSetting.ddAgentId,Date.parse(new Date)),o=(dsf.config.ddSetting.ddCoprId,this);dsf.http.get("/fn/DingDing/getSign2?ticket=".concat(n,"&nonceStr=").concat(t,"&timeStamp=").concat(i,"&url=").concat(e),{}).then(function(n){n=n.data;n&&n.message&&o.dingTalkConfig(dsf.config.ddSetting.ddAgentId,dsf.config.ddSetting.ddCoprId,i,t,n.message)})},dingTalkConfig:function(n,e,t,i,o){return this.$toast.clear(),dd.config({agentId:n,corpId:e,timeStamp:t,nonceStr:i,signature:o,type:0,jsApiList:["device.connection.getNetworkType","device.base.getWifiStatus","device.base.getPhoneInfo","device.base.getUUID","biz.cspace.saveFile","biz.conference.videoConfCall","biz.util.scan","biz.ding.create","biz.cspace.saveFile","biz.microApp.openApp","biz.util.openLink"]})}}}),a=(0,t(51900).Z)(e,function(){return(0,this._self._c)("div")},[],!1,null,null,null).exports}}]);