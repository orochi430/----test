"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[15268],{87929:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(25108);n.e(90006).then(n.bind(n,90006));var t={components:{quillEditor:function(){return Promise.all([n.e(76095),n.e(91629)]).then(n.t.bind(n,91629,23)).then(function(e){return e.quillEditor})}},props:["textareaTextVal","isdisabled"],data:function(){return{editorOption:{placeholder:"请输入编辑内容",modules:{toolbar:dsf.config.commonForm.editorToolbar||[["bold","italic","underline"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"]],syntax:{highlight:function(e){return hljs.highlightAuto(e).value}}}},content:this.textareaTextVal}},created:function(){this.$nextTick(function(){this.$refs.myQuillEditor.quill.blur()})},methods:{save:function(){i.log("content",this.content)},onEditorFocus:function(e){this.isdisabled&&e.enable(!1)},onEditorBlur:function(){},onEditorChange:function(){this.$emit("textareaText",this.content)}}},o=(0,n(51900).Z)(t,function(){var t=this,e=t._self._c;return e("div",[e("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{focus:function(e){return t.onEditorFocus(e)},blur:function(e){return t.onEditorBlur(e)},change:function(e){return t.onEditorChange(e)}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)},[],!1,null,null,null).exports},15268:function(e,t,n){n.r(t),n.d(t,{default:function(){return s}});var t=n(8450),i=n.n(t),t=n(23336),r=n.n(t),o=n(97805),t=n(87929),a=n(25108);n.e(46088).then(n.bind(n,46088));var t={components:{textareEdit:t.Z},data:function(){return{title:"",content:"",signMobile:null,allNotionData:[],currentUserNotionData:[],addNotionData:[],currentScrollDom:0,papersId:this.$route.query.fileId,isAdd:this.$route.query.isAdd||-1,meetingId:dsf.util.loadSessionStore("meeting").id,handwriting:this.$route.query.handwriting||1,type:this.$route.query.type}},mounted:function(){1==this.type?this.initSignatureMobile():this.isAdd<0&&this.getMemorandum()},methods:{initSignatureMobile:function(e){e=e||"pageContainer",this.signMobile=new o.Z(document.querySelector(".preview-box"),!1,{},document.querySelectorAll("."+e),!1,{isAutoSign:!1,zoomNum:1,ispad:"iPad"==dsf.util.getClientType(),autographObject:{fontFamily:"",fontSize:"",color:""}}),this.signMobile.hiddenToolIndexList=[2,4],this.signMobile.autographType="canvas",this.signMobile.baseZIndex=99999,1==this.handwriting?r()("#headerDiv").show():r()("#demo").css("height","100vh"),this.signMobile.currentElementDataStartZIndex=999,1==this.handwriting&&(this.signMobile.show(),this.signMobile.currentTabIndex=-1),this.signMobile.setContainerWH(),this.setAddsheets(e),this.setCompleteHandle(),this.isAdd<0&&this.getAllNotionData(e),this.setToolbarStyle(),r()(".preview-box").on("scroll",function(n){r()(".pageContainer").each(function(e,t){n.target.scrollTop>=r()(t).outerHeight(!0)*e&&(this.currentScrollDom=e)})})},getAllNotionData:function(n){var i=this,o=dsf.layer.loading(),e={id:this.papersId};dsf.http.post("fn/conferenceMemorandum/getMemorandum",e).then(function(e){var t;dsf.layer.closeLoading(o),"success"==e.data.type?(e=e.data.data,0<i.isAdd?i.title="":i.title=e.bt,e.content&&(t=JSON.parse(e.content),a.log(e.content),t.forEach(function(e){e.isSelf=!0}),e=(e=[]).concat(t.filter(function(e,t){return""!=e.addPageId})),i.loadAddPage(e,n),i.signMobile.initCurrentData(t))):dsf.layer.toast("获取失败")})},loadAddPage:function(e,i){var o=this;e.forEach(function(e){var t,n=e.addPageId;n&&""!=n&&0==document.querySelectorAll(".addpage-"+n).length&&((t=document.querySelector("."+i).cloneNode(!0)).dataset.pid=n,t.dataset.new="1",t.innerHTML="",t.style.position="relative",e.isSelf&&((n=document.createElement("div")).className="delete-page-btn",n.style.position="absolute",n.style.zIndex="999",n.style.right="0",n.style.top="0",n.style.background="#C33E32",n.style.width="90px",n.style.height="28px",n.style.color="#FFFFFF",n.style.textAlign="center",n.style.fontSize="14px",n.style.cursor="pointer",n.style.lineHeight="28px",n.style.zIndex=99999,n.innerHTML="删除增页",r()(n).click(o.deletePageHandler).mousedown(function(e){e.stopPropagation()}),1==o.handwriting)&&t.append(n),(document.querySelector(".preview-box")||document.querySelector(".svgWrapper")).appendChild(t),e.isSelf)&&o.signMobile.newChildBoard(t,!1,"",e.addPageId,{addPageId:e.addPageId,papersPage:"",isChild:!0})})},setAddsheets:function(i){var o=this;o.signMobile.addsheetsHandle=function(t){var e=document.querySelectorAll('[data-new="1"]').length,e={papersId:this.papersId,showOrder:e+1},n=dsf.layer.loading();dsf.http.post("fn/hm/addPage/save",e).then(function(e){"success"==e.data.type?(dsf.layer.closeLoading(n),o.createNewPageContainer(i,e.data.data,{target:o.currentScrollDom,site:t.val,pid:""})):dsf.layer.toast("操作失败")})}},createNewPageContainer:function(e,t,n){var i=document.querySelector("."+e).cloneNode(!0),e=(i.dataset.pid=t.id,i.dataset.new="1",i.innerHTML="",document.createElement("div"));e.className="delete-page-btn",e.style.position="absolute",e.style.right="0",e.style.top="0",e.style.background="#C33E32",e.style.width="90px",e.style.height="28px",e.style.color="#FFFFFF",e.style.textAlign="center",e.style.fontSize="14px",e.style.cursor="pointer",e.style.lineHeight="28px",e.style.zIndex=9999,e.innerHTML="删除增页",r()(e).click(this.deletePageHandler).mousedown(function(e){e.stopPropagation()}),1==this.handwriting&&i.appendChild(e);var o=(o=document.querySelector(".preview-box"))||document.querySelector(".svgWrapper"),a=null;switch(n.site){case"1":a=document.querySelectorAll(".pageContainer")[n.target],o.prepend(i),n.pid=a.getAttribute("data-pid");break;case"2":a=document.querySelectorAll(".pageContainer")[n.target],o.insertBefore(i,a),n.pid=a.getAttribute("data-pid");break;case"3":var s=document.querySelectorAll(".pageContainer");s[n.target+1]?(s=s[n.target+1],o.insertBefore(i,s),n.pid=s.getAttribute("data-pid")):o.appendChild(i);break;case"4":o.appendChild(i)}i.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),this.signMobile.newChildBoard(i,!1,"",t.id,{addPosition:n}),dsf.layer.toast("添加增页成功")},deletePageHandler:function(e){var t=this,n=e.currentTarget.parentElement;dsf.http.post("fn/hm/addPage/del",{id:n.dataset.pid}).then(function(e){"success"==e.data.type?(t.signMobile.deleteChildBoard(n),n.remove(),dsf.layer.toast("删除成功")):dsf.layer.toast("删除失败")})},setCompleteHandle:function(){var t=this;t.signMobile.completeHandle=function(e){r()(".svgWrapper").css("margin-top","0px");e={id:t.papersId,bt:t.title||"暂无标题",content:i()(e),meetingId:t.meetingId};t.currentUserNotionData&&0<t.currentUserNotionData.length&&(e.id=t.currentUserNotionData[0].id),t.saveNotion(e)}},saveNotion:function(e){var t=this,n=dsf.layer.loading();dsf.http.post("fn/conferenceMemorandum/saveMemorandum",e).then(function(e){dsf.layer.closeLoading(n),r()("#demo").css("height","100vh"),r()("#headerDiv").hide(),r()(".delete-page-btn").hide(),"success"==e.data.type?(a.log(e),dsf.layer.toast("保存成功",!0,function(){r()("#headerDiv").hide(),t.$router.back()})):dsf.layer.toast("保存失败")})},setToolbarStyle:function(){window.screen.width>window.screen.height&&(r()(".smt-tab, #headerDiv").css("height","14.8vh"),r()(".smt-tab-item div").css("font-size","3.47vh"),r()(".smt-tab-item").css("padding-top","2vh")),r()(".smib-opinion-btn, .smib-opinion-save-btn").css("display","none")},getTextValue:function(e){this.content=e},getMemorandum:function(){var t=this,e=dsf.layer.loading();dsf.http.post("fn/conferenceMemorandum/getMemorandum",{id:this.papersId}).then(function(e){"success"==e.data.type?(t.title=0<t.isAdd?"":e.data.data.bt,t.content=e.data.data.content):dsf.layer.toast(e.data.message)}).always(function(){dsf.layer.closeLoading(e)})},save:function(){var t=this;dsf.http.post("fn/conferenceMemorandum/saveMemorandum",{id:this.papersId,meetingId:this.meetingId,bt:this.title,content:this.content,type:2}).then(function(e){"success"==e.data.type?dsf.layer.toast("保存成功",!0,function(){t.$router.back()}):dsf.layer.toast("保存失败")})}}},s=(0,n(51900).Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"card",style:{height:"calc(100vh - ".concat(t.$store.state.isShowAppHeader?"1.32rem":"0px",")")}},[e("div",[e("van-field",{attrs:{label:"标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),1==t.type?e("div",{staticClass:"preview-box"},[e("div",{staticClass:"pageContainer"})]):e("div",{staticClass:"memo-edit"},[t.content||0<t.isAdd?e("textare-edit",{attrs:{"textarea-text-val":t.content},on:{textareaText:t.getTextValue}}):t._e()],1),t._v(" "),2==t.type?e("div",[e("van-button",{attrs:{type:"primary",block:""},on:{click:t.save}},[t._v("保存")])],1):t._e()])},[],!1,null,"4ff6aca6",null).exports}}]);