"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[49816],{49816:function(t,e,a){a.r(e),a.d(e,{default:function(){return s}});var e=a(73473),i=a.n(e),n=a(88561),c=a(25108),e={data:function(){return{active:"-1",meetingInfo:n.Z.loadSessionStore("meeting"),tabArr:[],detailArr:[],activeNames:[0],default_avatar:'this.src="'+a(11727)+'"',scheduleInfo:null,scheduleList:[],showList:!1}},created:function(){this.getStatistics()},watch:{scheduleInfo:{handler:function(t,e){this.getSignInTabs(t.id)}}},methods:{getStatistics:function(e){var n=this;dsf.http.post("fn/conferenceMobile/getStatistics",{meetingId:this.meetingInfo.id}).then(function(t){n.scheduleList=t.data.datas.map(function(t){return t.dataValue.singValueText=-1==t.dataValue.singValue?"未开始":1==t.dataValue.singValue?"进行中":"已结束",t.dataValue}),e?n.scheduleInfo=n.scheduleList.find(function(t){return t.id==e}):(n.scheduleInfo=n.scheduleList.find(function(t){return 2!=t.singValue}),n.scheduleInfo||(n.scheduleInfo=n.scheduleList[0]))})},getSignInTabs:function(n){var s=this,a=dsf.layer.loading();this.tabArr=[],dsf.http.post("fn/conferenceSignIn/signInTabs",{meetingId:this.meetingInfo.id,scheduleId:n}).done(function(t){var e;"success"==t.type&&t.data&&(s.tabArr=t.data,e=[],s.tabArr.forEach(function(t){e.push(s.getSignInDetails(n,t))}),i().all(e).then(function(){dsf.layer.closeLoading(a)}))}).error(function(t){dsf.layer.toast("加载数据失败",!1),c.log("getAgendas-error",t)})},getSignInDetails:function(t,e){var n=this;return dsf.http.post("fn/conferenceSignIn/signInDetails",{meetingId:this.meetingInfo.id,scheduleId:t,type:e.type,query_key:""}).done(function(t){"success"==t.type&&t.data&&n.$set(e,"users",t.data)}).error(function(t){c.log("getAgendas-error",t)})},tanClick:function(t,e){this.active=t},signReminder:function(t){var e=this;dsf.http.post("fn/conferenceSignIn/signInMessageReminder",{meetingId:this.meetingInfo.id,scheduleId:this.scheduleInfo.id,signInIds:t}).done(function(t){"success"==t.type&&e.$toast.success(t.message)}).error(function(t){c.log(t)})},update:function(e,t){var n=this;dsf.layer.confirm({message:1==t?"是否确认开始本场次签到":"是否确认结束本场次签到",confirmButtonText:"确认"},function(){dsf.http.post("fn/conferenceSignIn/updateMeetingSignIn",{meetingId:n.meetingInfo.id,scheduleId:e,type:t}).then(function(t){200==t.data.code&&(dsf.layer.toast(t.data.message),n.getStatistics(e))})})}}},s=(0,a(51900).Z)(e,function(){var n=this,s=n._self._c;return s("div",{staticClass:"signManage",style:{height:"calc(100vh - ".concat(n.$store.state.isShowAppHeader?"0.92rem":"0px",")")}},[n.scheduleInfo?s("div",{staticClass:"flex dc",staticStyle:{overflow:"hidden",height:"100%"}},[s("div",{staticClass:"schedule-box"},[s("div",{staticClass:"flex jb title"},[s("div",[s("span",{class:["tag","tag_".concat(n.scheduleInfo.singValue)]},[n._v(n._s(n.scheduleInfo.singValueText))]),n._v(" "),s("span",[n._v(n._s(n.scheduleInfo.bt))])]),n._v(" "),s("img",{attrs:{src:a(65741),alt:""},on:{click:function(t){n.showList=!0}}})]),n._v(" "),s("div",{staticClass:"sub"},[n._v("默认签到时限："+n._s(n.scheduleInfo.signTimeRange))]),n._v(" "),s("div",{staticClass:"btn-box"},[s("van-button",{attrs:{type:"default"},on:{click:function(t){return n.update(n.scheduleInfo.id,2)}}},[n._v("关闭")]),n._v(" "),s("van-button",{attrs:{type:"info"},on:{click:function(t){return n.update(n.scheduleInfo.id,1)}}},[n._v("开始")])],1)]),n._v(" "),s("van-tabs",{staticStyle:{overflow:"hidden",flex:"1"},on:{click:n.tanClick},model:{value:n.active,callback:function(t){n.active=t},expression:"active"}},n._l(n.tabArr,function(t,e){return s("van-tab",{key:e,attrs:{name:t.type,title:"".concat(t.typeName,"(").concat(t.count,")")}},[s("van-collapse",{class:{oneReminder:"-1"==n.active&&t.users},model:{value:n.activeNames,callback:function(t){n.activeNames=t},expression:"activeNames"}},n._l(t.users,function(t,e){return s("van-collapse-item",{key:e,attrs:{title:t.unitName,name:e}},[s("ul",{staticClass:"signManage_ul"},n._l(t.users,function(e,t){return s("li",{key:t+"a"},[s("img",{attrs:{src:e.img,alt:"",onerror:n.default_avatar}}),n._v(" "),s("div",{staticClass:"signManage_ul_div"},[s("span",{staticClass:"signManage_ul_name"},[n._v(n._s(e.name))]),n._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.time,expression:"userItem.time"}]},[n._v(n._s(e.time))])]),n._v(" "),s("van-button",{directives:[{name:"show",rawName:"v-show",value:-1==e.singValue,expression:"userItem.singValue==-1"}],attrs:{type:"info"},on:{click:function(t){return n.signReminder(e.id)}}},[n._v("提醒")])],1)}),0)])}),1)],1)}),1),n._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"-1"==n.active&&2!=n.scheduleInfo.singValue,expression:"active=='-1'&&scheduleInfo.singValue != 2"}],staticClass:"oneReminderBtn"},[s("van-button",{attrs:{type:"info"},on:{click:function(t){return n.signReminder("")}}},[n._v("一键提醒")])],1)],1):s("commonempty"),n._v(" "),s("van-popup",{staticClass:"listPop",attrs:{"get-container":"#app",position:"bottom"},model:{value:n.showList,callback:function(t){n.showList=t},expression:"showList"}},[s("van-nav-bar",{attrs:{title:"签到管理",fixed:"",placeholder:""},on:{"click-left":function(t){n.showList=!1}},scopedSlots:n._u([{key:"left",fn:function(){return[s("van-icon",{attrs:{name:"arrow-left"}}),s("span",[n._v("返回")])]},proxy:!0}])}),n._v(" "),n._l(n.scheduleList,function(e){return s("div",{key:e.id,staticClass:"schedule-box",on:{click:function(t){n.scheduleInfo=e,n.showList=!1}}},[s("div",{staticClass:"title"},[s("span",{class:["tag","tag_".concat(e.singValue)]},[n._v(n._s(e.singValueText))]),n._v(" "),s("span",[n._v(n._s(e.bt))])]),n._v(" "),s("div",{staticClass:"sub"},[n._v("签到时限："+n._s(e.signTimeRange))]),n._v(" "),s("div",{staticClass:"sub"},[n._v("签到情况："+n._s(e.qdqk))]),n._v(" "),s("div",{staticClass:"btn-box"},[s("van-button",{attrs:{type:"default"},on:{click:function(t){return t.stopPropagation(),n.update(e.id,2)}}},[n._v("关闭")]),n._v(" "),s("van-button",{attrs:{type:"info"},on:{click:function(t){return t.stopPropagation(),n.update(e.id,1)}}},[n._v("开始")])],1)])})],2)],1)},[],!1,null,"244d4a06",null).exports},65741:function(t,e,n){t.exports=n.p+"static/img/home-exchange.dcb7726..png"},11727:function(t,e,n){t.exports=n.p+"static/img/default-avatar.ad3a581..png"}}]);