"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[28038],{30819:function(e,s,t){t.d(s,{Z:function(){return d}});var s=t(26243),o=t.n(s),s=t(62680),a=t.n(s),s=t(95366),i=t.n(s),s=t(6919),n=t.n(s),r=t(77193),s=t(73473),l=t.n(s);function c(s,e){var t,n=o()(s);return a()&&(t=a()(s),e&&(t=t.filter(function(e){return i()(s,e).enumerable})),n.push.apply(n,t)),n}var s={name:"WorkFlowDialog",props:{formData:{type:Object,default:function(){return{}}},metaData:{type:Object,default:function(){return{}}}},data:function(){return{text:"退回",message:"",showDialog:!1,submitAfter:function(){},h:0,isNeedWrite:dsf.config.setting["SYS-FLOW-0038"]||0,personSelectData:[],secPeo:!1,columns:[],SendRequest:{}}},created:function(){},mounted:function(){},computed:{isShowUser:function(){return 1<this.columns.length||dsf.config.commonFlow.onePersonBackIsShow}},methods:{cancel:function(){this.showDialog=!1,this.h=0,this.$emit("close")},sendBack:function(){var s=this,e={pid:this.formData.pid||this.formData.pId,pnid:this.formData.pnid||this.formData.pnId,wfId:this.formData.flowId,backReason:this.message},t=dsf.layer.loading(this.text+"中");dsf.http.post("/fn/mobileFlow/sendBack",e).then(function(e){dsf.layer.closeLoading(t),s.dsf.layer.toast(s.text+"成功",!0),s.cancel(),setTimeout(function(){s.$emit("change")},100)})},sendBackNew:function(){var s,e,t=this,n=!0;t.metaData.buttons.mainButtons.some(function(e){"NoopinionBack"==e.action&&(n=!1)}),""==t.message.trim()&&1==t.isNeedWrite&&1==n?dsf.layer.toast("请输入退回原因"):t.personSelectData.length<1&&t.isShowUser?dsf.layer.toast("请选择退回人员"):(s=dsf.layer.loading(t.text+"中"),e={TPID:t.SendRequest.tpid,CurLinkID:t.personSelectData[0].LinkID,WFID:t.SendRequest.wfid,backType:1,Remark:t.message,inherit:"",MultSendBackMod:t.SendRequest.multSendBackMod,IsMergeTodo:t.SendRequest.isMergeTodo,NGR:0,SendBackTo:t.SendRequest.sendBackTo},dsf.http.post("/fn/flow/submitSendBackNode",e).then(function(e){dsf.layer.closeLoading(s),t.dsf.layer.toast(t.text+"成功",!0),t.cancel(),setTimeout(function(){t.$emit("change")},100)}))},show:function(e){var t=this,e=e.text,s=(this.personSelectData=[],{pId:this.metaData.parameters?this.metaData.parameters.pId:this.formData.pid||this.formData.pId,flowId:(this.metaData.parameters||this.formData).flowId,pk:this.metaData.parameters?this.metaData.parameters.pk:this.formData.info_d||this.formData.info_id,pnId:this.metaData.parameters?this.metaData.parameters.pnId:this.formData.pnid||this.formData.pnId});return dsf.http.get("fn/flow/getGPNodeProcess",s).then(function(e){var s,e=e.data;"200"==e.code&&(s=[],t.SendRequest=e.data.SendRequest,e.data.processArray.forEach(function(e){s.push(function(s){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?c(Object(t),!0).forEach(function(e){(0,r.Z)(s,e,t[e])}):n()?Object.defineProperties(s,n()(t)):c(Object(t)).forEach(function(e){Object.defineProperty(s,e,i()(t,e))})}return s}({text:e.Sender.UserName+"(".concat(e.PARENT_NODENAME,")")},e))}),t.columns=s,1==t.columns.length&&(t.personSelectData=s),t.initHeight())}),this.text=e||"",this.message="退回"==e&&dsf.config.setting["SYS-MOBILE-FORM-0005"]||"",this.showDialog=!0,new(l())(function(e){t.submitAfter=e})},initHeight:function(){var e=this;this.$nextTick(function(){e.isShowUser?e.h=e.$refs.content.offsetHeight-270:e.h=e.$refs.content.offsetHeight-160})},close:function(){this.showDialog=!1,this.h=0},showPersonModel:function(){this.secPeo=!this.secPeo},onConfirm:function(e){this.personSelectData=[],this.personSelectData.push(e),this.showPersonModel()},closePerson:function(e,s){this.personSelectData.splice(s,1)},submitFun:function(){this.submitAfter(),this.text,this.sendBackNew()}}},d=(0,t(51900).Z)(s,function(){var n=this,e=n._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:n.showDialog,expression:"showDialog"}],staticClass:"ds-workflow_dialog"},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:n.text+"理由","left-text":"取消"},on:{"click-left":function(e){return n.cancel()}}})],1),n._v(" "),e("div",{ref:"content",staticClass:"content"},[n.isShowUser?e("div",{ref:"user",staticClass:"sheetBox"},[e("p",{staticClass:"reasonLabel"},[n._v("退回人员")]),n._v(" "),e("div",{staticClass:"disfr ac",staticStyle:{padding:"10px 0"}},[e("div",{staticClass:"peopleSec disfr ac flex1"},[n._l(n.personSelectData,function(s,t){return e("van-tag",{key:t,attrs:{closeable:"",size:"large",type:"primary"},on:{close:function(e){return n.closePerson(s,t)}}},[n._v("\n            "+n._s(s.text)+"\n          ")])}),n._v("\n            \n        ")],2),n._v(" "),e("van-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"default"},on:{click:n.showPersonModel}},[n._v("选择人员")])],1),n._v(" "),e("p",{staticClass:"reasonLabel",staticStyle:{"margin-bottom":"0.2rem"}},[n._v("退回原因")])]):n._e(),n._v(" "),e("van-field",{ref:"reason",staticClass:"reason",attrs:{rows:"5",type:"textarea",placeholder:"请输入"+n.text+"理由",border:""},model:{value:n.message,callback:function(e){n.message=e},expression:"message"}})],1),n._v(" "),e("div",{staticClass:"footer"},[e("van-button",{attrs:{type:"theme",block:""},on:{click:n.submitFun}},[n._v("确认"+n._s(n.text))])],1),n._v(" "),e("van-popup",{style:{height:"50vh"},attrs:{position:"bottom",round:""},model:{value:n.secPeo,callback:function(e){n.secPeo=e},expression:"secPeo"}},[e("div",{staticStyle:{width:"100%"}},[e("van-picker",{attrs:{title:"请选择退回人员","show-toolbar":"",columns:n.columns},on:{confirm:n.onConfirm,cancel:n.showPersonModel}})],1)])],1)},[],!1,null,"447cfcb4",null).exports},46297:function(e,s,t){t.d(s,{Z:function(){return n}});var n=(0,t(51900).Z)({},function(e,s){return e("div",{staticClass:"ds-card"},[s._t("default"),s._v(" "),e("div",{staticClass:"tabspage"},[s.$slots.tabspageCheck?e("div",{staticClass:"tabspageCheck"},[s._t("tabspageCheck")],2):s._e(),s._v(" "),e("div",{staticStyle:{flex:"1",overflow:"hidden"}},[s.$slots.header?e("div",{staticClass:"ds-card-header"},[s._t("header")],2):s._e(),s._v(" "),s.$slots.content?e("div",{staticClass:"ds-card-content"},[s._t("content")],2):s._e()]),s._v(" "),s.$slots.rightIcon?e("div",{staticClass:"rightIcon"},[s._t("rightIcon")],2):s._e()]),s._v(" "),s.$slots.footer?e("div",{staticClass:"ds-card-footer"},[s._t("footer")],2):s._e(),s._v(" "),s.$slots.footermin?e("div",{staticClass:"ds-card-footer ds-card-footer2"},[s._t("footermin")],2):s._e()],2)},[],!0,null,"1b02e7ea",null).exports},38496:function(e,s,t){t.r(s),t.d(s,{default:function(){return r}});var s=t(73473),n=t.n(s),s=t(63560),o=t(18868),a=t(88561),i=t(25108),s={name:"SignFile",components:{selectPerson:s.default,DebounceClick:o.Z},data:function(){return{isShow:!1,resolve:function(){},reject:function(){},data:{deptBaoming:!0},showPerson:!1,userInfo:{},joinPersons:[],joinPersonIds:"",joinPerson:"",congressPersons:[],congressPersonIds:"",congressPerson:"",leaveReason:"",isAttend:!0,isJoin:!0,attendMeetingUrl:dsf.config.meetingConfig.attendMeetingUrl,extra:{}}},watch:{isAttend:function(){this.isJoin=!this.isJoin,this.showPerson=!1}},methods:{init:function(){var e=a.Z.loadSessionStore("user"),e=(this.userInfo=e,[]),s=[];this.data=null,this.showPerson=!1,this.joinPersons=e,this.joinPersonIds=0<e.length?e[0].id:"",this.joinPerson=0<e.length?e[0].name:"",this.congressPersons=s,this.congressPersonIds=0<s.length?s[0].id:"",this.congressPerson=0<s.length?s[0].name:"",this.leaveReason="",this.isAttend=!0,this.isJoin=!0},show:function(e){var t=this;return this.init(),this.data=e,i.log(this.data),this.isShow=!0,new(n())(function(e,s){t.resolve=e,t.reject=s})},cancel:function(){this.isShow=!1,this.reject("流程被中断")},submit:function(){var s=this,e={meetingtzId:this.data.meetingtzId,pk:this.data.pk,pnId:this.data.pnId,attendance:this.isAttend?"1":"-1",leaveReason:this.leaveReason,"x-auth-token":a.Z.loadSessionStore("loginToken"),requestEnv:"mobile"};if(this.data.deptBaoming?e.attendType=2:e.attendType=1,this.isAttend){if(this.data.deptBaoming||(this.joinPersons=[this.userInfo.name],this.joinPerson=this.userInfo.name,this.joinPersonIds=this.userInfo.user_id),!this.joinPersons.length)return void dsf.layer.toast("请选择参会人员");e.userName=this.joinPerson,e.userId=this.joinPersonIds}else{if(!this.congressPersons.length&&this.data.deptBaoming)return void dsf.layer.toast("请选择代会人员");if(!this.leaveReason.length)return void dsf.layer.toast("请填写请假理由");e.userName=this.congressPerson,e.userId=this.congressPersonIds}var t=dsf.layer.loading();dsf.http.post(this.attendMeetingUrl,e).done(function(e){"200"===e.code?(s.isShow=!1,s.resolve(e),s.isAttend=!0,s.isJoin=!0):dsf.layer.toast("请求异常")}).error(function(){dsf.layer.toast("请求异常")}).always(function(){dsf.layer.closeLoading(t)})},getUserNames:function(e){var s=[],t=[],e=e.map(function(e){return s.push(e.name),t.push(e.attrs.idValue),{id:e.attrs.idValue,pid:e.attrs.pidValue,name:e.name}});return{names:s.join(","),ids:t.join(","),persons:e}},getSelectUser:function(t){var e,s,n;0<t.length?(t.forEach(function(e,s){e.children&&0<e.children.length&&t.splice(s,1)}),e=(n=this.getUserNames(t)).names,s=n.ids,n=n.persons,this.isAttend?(this.joinPerson=e,this.joinPersonIds=s,this.joinPersons=n):(this.congressPerson=e,this.congressPersonIds=s,this.congressPersons=n)):(this.joinPerson="",this.joinPersonIds="",this.joinPersons="",this.congressPerson="",this.congressPersonIds="",this.congressPersons="")}}},r=(0,t(51900).Z)(s,function(){var s=this,e=s._self._c;return e("div",{staticClass:"ds-sign-file"},[e("van-popup",{staticClass:"ds-sign-file-pop",attrs:{position:"bottom","get-container":"#app",round:""},model:{value:s.isShow,callback:function(e){s.isShow=e},expression:"isShow"}},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:"报名","left-text":"取消"},on:{"click-left":s.cancel}})],1),s._v(" "),s.data.deptBaoming?e("div",{staticClass:"body"},[e("div",{staticClass:"join"},[e("label",{attrs:{for:""}},[s._v("是否出席:")]),s._v(" "),e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:s.isAttend,callback:function(e){s.isAttend=e},expression:"isAttend"}},[e("van-radio",{attrs:{name:!0,shape:"square"}},[s._v("出席")]),s._v(" "),e("van-radio",{attrs:{name:!1,shape:"square"}},[s._v(s._s("请假/委托"))])],1)],1),s._v(" "),s.isJoin?e("div",{staticClass:"confrence"},[e("van-field",{attrs:{readyonly:"","input-align":"left",label:"参会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){s.showPerson=!0}},scopedSlots:s._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),s._v("参会人员:\n            ")])]},proxy:!0}],null,!1,1705578387),model:{value:s.joinPerson,callback:function(e){s.joinPerson=e},expression:"joinPerson"}})],1):e("div",{staticClass:"congressPerson"},[e("van-field",{attrs:{readonly:!0,"input-align":"left",label:"代会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){s.showPerson=!0}},scopedSlots:s._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),s._v("代会人员：\n            ")])]},proxy:!0}],null,!1,3628413746),model:{value:s.congressPerson,callback:function(e){s.congressPerson=e},expression:"congressPerson"}})],1),s._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:!s.isJoin,expression:"!isJoin"}],attrs:{rows:"4",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:s.leaveReason,callback:function(e){s.leaveReason=e},expression:"leaveReason"}})],1):e("div",{staticClass:"body"},[e("div",{staticClass:"join"},[e("label",{attrs:{for:""}},[s._v("是否出席:")]),s._v(" "),e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:s.isAttend,callback:function(e){s.isAttend=e},expression:"isAttend"}},[e("van-radio",{attrs:{name:!0,shape:"square"}},[s._v("出席")]),s._v(" "),e("van-radio",{attrs:{name:!1,shape:"square"}},[s._v(s._s("请假/委托"))])],1)],1),s._v(" "),s.isJoin?s._e():e("div",{staticClass:"confrence"},[e("van-field",{attrs:{readonly:!0,"input-align":"left",label:"代会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){s.showPerson=!0}},scopedSlots:s._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),s._v("代会人员：\n            ")])]},proxy:!0}],null,!1,3628413746),model:{value:s.congressPerson,callback:function(e){s.congressPerson=e},expression:"congressPerson"}})],1),s._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:!s.isJoin,expression:"!isJoin"}],attrs:{rows:"4",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:s.leaveReason,callback:function(e){s.leaveReason=e},expression:"leaveReason"}})],1),s._v(" "),e("div",{staticClass:"footer"},[e("debounce-click",[e("van-button",{attrs:{type:"theme"},on:{click:s.submit}},[s._v("提交")])],1)],1)]),s._v(" "),e("van-popup",{style:{height:"90%"},attrs:{"close-on-click-overlay":!1,position:"bottom","get-container":"#app",round:""},model:{value:s.showPerson,callback:function(e){s.showPerson=e},expression:"showPerson"}},[s.showPerson?e("selectPerson",{attrs:{extra:s.extra,type:0},on:{getSelectUser:s.getSelectUser,cancePerson:function(e){s.showPerson=!1}}}):s._e()],1)],1)},[],!1,null,null,null).exports},91369:function(e,s,t){t.r(s),t.d(s,{default:function(){return i}});var s=t(73473),n=t.n(s),s=t(63560),o=t(88561),a=t(25108),s={name:"SignFilePerson",components:{selectPerson:s.default},data:function(){return{isShow:!1,resolve:function(){},reject:function(){},data:{deptBaoming:!0},showPerson:!1,userInfo:{},joinPersons:[],joinPersonIds:"",joinPerson:"",congressPersons:[],congressPersonIds:"",congressPerson:"",leaveReason:"",isAttend:!0,attendance:1,isJoin:!0}},watch:{isAttend:function(){this.isJoin=!this.isJoin,this.showPerson=!1},attendance:function(e){}},methods:{init:function(){var e=o.Z.loadSessionStore("user"),e=(this.userInfo=e,[]),s=[];this.data=null,this.showPerson=!1,this.joinPersons=e,this.joinPersonIds=0<e.length?e[0].id:"",this.joinPerson=0<e.length?e[0].name:"",this.congressPersons=s,this.congressPersonIds=0<s.length?s[0].id:"",this.congressPerson=0<s.length?s[0].name:"",this.leaveReason="",this.isAttend=!0,this.isJoin=!0},show:function(e){var t=this;return this.init(),this.data=e,a.log(this.data),this.isShow=!0,new(n())(function(e,s){t.resolve=e,t.reject=s})},cancel:function(){this.isShow=!1,this.reject("流程被中断")},submit:function(){var s=this,e={meetingtzId:this.data.meetingtzId,pk:this.data.pk,pnId:this.data.pnId,attendance:this.attendance,leaveReason:this.leaveReason,"x-auth-token":o.Z.loadSessionStore("loginToken"),requestEnv:"mobile"};if(this.data.deptBaoming?e.attendType=2:e.attendType=1,-1!=this.attendance||this.leaveReason.length){if(2==this.attendance){if(!this.congressPersons.length)return void dsf.layer.toast("请选择代会人员");e.userName=this.congressPerson,e.userId=this.congressPersonIds}var t=dsf.layer.loading();dsf.http.post("fn/MeetingMobile/attendMeeting",e).done(function(e){"200"===e.code?(s.isShow=!1,s.resolve(e),s.isAttend=!0,s.isJoin=!0):dsf.layer.toast(e.message)}).error(function(){dsf.layer.toast(res.message)}).always(function(){dsf.layer.closeLoading(t)})}else dsf.layer.toast("请填写请假理由")},getUserNames:function(e){var s=[],t=[],e=e.map(function(e){return s.push(e.name),t.push(e.attrs.idValue),{id:e.attrs.idValue,pid:e.attrs.pidValue,name:e.name}});return{names:s.join(","),ids:t.join(","),persons:e}},getSelectUser:function(t){var e,s,n;0<t.length?(t.forEach(function(e,s){e.children&&0<e.children.length&&t.splice(s,1)}),e=(n=this.getUserNames(t)).names,s=n.ids,n=n.persons,this.congressPerson=e,this.congressPersonIds=s,this.congressPersons=n):(this.joinPerson="",this.joinPersonIds="",this.joinPersons="",this.congressPerson="",this.congressPersonIds="",this.congressPersons="")}}},i=(0,t(51900).Z)(s,function(){var s=this,e=s._self._c;return e("div",{staticClass:"ds-sign-file"},[e("van-popup",{staticClass:"ds-sign-file-pop",attrs:{position:"bottom","get-container":"#app",round:""},model:{value:s.isShow,callback:function(e){s.isShow=e},expression:"isShow"}},[e("div",{staticClass:"header"},[e("van-nav-bar",{attrs:{title:"报名","left-text":"取消"},on:{"click-left":s.cancel}})],1),s._v(" "),e("div",{staticClass:"body"},[e("div",{staticClass:"join"},[e("label",{attrs:{for:""}},[s._v("是否出席:")]),s._v(" "),e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:s.attendance,callback:function(e){s.attendance=e},expression:"attendance"}},[e("van-radio",{attrs:{name:1,shape:"square"}},[s._v("出席")]),s._v(" "),e("van-radio",{attrs:{name:-1,shape:"square"}},[s._v(s._s("请假"))]),s._v(" "),e("van-radio",{attrs:{name:2,shape:"square"}},[s._v(s._s("委托"))])],1)],1),s._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:2==s.attendance,expression:"attendance==2"}],staticClass:"confrence"},[e("van-field",{attrs:{readonly:!0,"input-align":"left",label:"代会人员:",placeholder:"请选择",type:"textarea",autosize:"",rows:"1"},on:{click:function(e){s.showPerson=!0}},scopedSlots:s._u([{key:"label",fn:function(){return[e("span",[e("label",{staticClass:"mast-input"}),s._v("代会人员：\n            ")])]},proxy:!0}]),model:{value:s.congressPerson,callback:function(e){s.congressPerson=e},expression:"congressPerson"}})],1),s._v(" "),e("van-field",{directives:[{name:"show",rawName:"v-show",value:-1==s.attendance,expression:"attendance==-1"}],attrs:{rows:"4",autosize:"",label:"请假理由:",type:"textarea",placeholder:"请输入请假理由"},model:{value:s.leaveReason,callback:function(e){s.leaveReason=e},expression:"leaveReason"}})],1),s._v(" "),e("div",{staticClass:"footer"},[e("van-button",{attrs:{type:"theme"},on:{click:s.submit}},[s._v("提交")])],1)]),s._v(" "),e("van-popup",{style:{height:"90%"},attrs:{"close-on-click-overlay":!1,position:"bottom","get-container":"#app",round:""},model:{value:s.showPerson,callback:function(e){s.showPerson=e},expression:"showPerson"}},[e("selectPerson",{attrs:{type:0},on:{getSelectUser:s.getSelectUser,cancePerson:function(e){s.showPerson=!1}}})],1)],1)},[],!1,null,null,null).exports}}]);