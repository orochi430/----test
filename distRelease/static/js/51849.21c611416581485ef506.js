"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[51849],{51849:function(t,e,s){s.r(e),s.d(e,{default:function(){return n}});var e=s(73473),i=s.n(e),o=s(25108),e={data:function(){return{show:!0,errMsg:"抱歉，请确保是本人进行操作",user:dsf.util.loadSessionStore("user")}},methods:{identify:function(){var e=this;e.getToken().done(function(t){return dsf.http.get("fn/wztFace/getFaceToken",{wztToken:t})}).done(function(t){if(o.log("getFaceToken-res",t),"success"==t.type)return e.startFace(t.data.fvtoken,t.data.key);throw t.message}).done(function(t){if("false"==t.flag)throw"暂不认证";if("请求成功"==t.faceState)return dsf.http.get("fn/wztFace/accessCheck",{accessToken:t.accessToken});throw t.faceState}).done(function(t){if(o.log("accessCheck-res",t),"success"!=(null==t?void 0:t.type))throw t.message;if(!t.data.flag)throw t.subject;o.log("人脸识别认证成功"),e.user.attnd?e.user.attnd.faceAuth=1:e.user.attnd={faceAuth:1},dsf.util.saveToSessionStore("user",e.user),e.$emit("signIn")}).error(function(t){e.show=!1,null!=t&&t.message&&(e.errMsg=t.message),o.log("identify-err",t)})},startFace:function(n,a){return new(i())(function(e,s){"undefined"==typeof croods?s("请在皖政通中操作"):croods.load(function(){var t={fvtoken:n,key:a,appid:dsf.config.attendance.appId};o.log("FacePlugin.startFace-params",t),croods.customPlugin({action:"FacePlugin.startFace",params:t,success:function(t){o.log("FacePlugin.startFace-res",t),e(t)},fail:function(t){o.log("FacePlugin.startFace-fail",t),s(t)}})})})},back:function(){this.show=!0,this.$emit("closePop")},getToken:function(){return new(i())(function(e,s){"undefined"==typeof croods?s("请在皖政通中操作"):croods.load(function(){croods.customPlugin({action:"UserPlugin.login",params:{},success:function(t){o.log("UserPlugin.login-res",t),e(t.token)},fail:function(t){o.log("UserPlugin.login-err",t),s(t)}})})})}}},n=(0,s(51900).Z)(e,function(){var e=this,t=e._self._c;return t("div",{staticClass:"identify"},[t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"success"},[t("div",{staticClass:"text"},[e._v("\n        使用考勤系统前请您通过人脸识别认证\n        "),t("div",{staticClass:"SC"},[e._v("请确保正对手机，光线充足")])]),e._v(" "),t("img",{attrs:{src:"static/images/wanzhengtong/face_identify.png",alt:""}}),e._v(" "),t("button",{staticClass:"btn",on:{click:e.identify}},[e._v("采集本人人脸")])])]),e._v(" "),t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.show,expression:"!show"}],staticClass:"failed"},[t("div",{staticClass:"img"},[t("img",{attrs:{src:"static/images/wanzhengtong/face_error.png",alt:""}})]),e._v(" "),t("div",{staticClass:"text1"},[e._v("认证失败")]),e._v(" "),t("div",{staticClass:"text2"},[e._v(e._s(e.errMsg))]),e._v(" "),t("div",{staticClass:"button"},[t("button",{staticClass:"button1",on:{click:function(t){return e.back()}}},[e._v("返回")]),e._v(" "),t("button",{staticClass:"button2",on:{click:function(t){e.show=!0}}},[e._v("立即重试")])])])])],1)},[],!1,null,"8e56722a",null).exports}}]);