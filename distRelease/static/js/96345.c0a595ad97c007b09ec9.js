"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[96345],{96345:function(e,t,n){n.d(t,{Z:function(){return y}});var o=n(66250),i=(n(73747),n(9980)),s=n(77193),t=n(33453),c=n.n(t),t=n(26243),a=n.n(t),t=n(27921),r=n.n(t),t=n(90487),d=n.n(t),t=n(8450),l=n.n(t),t=n(94358),h={name:"secTree",props:["tree","multiple"],data:function(){return{default_img:'this.src="'+n(5692)+'"',InListState:!1,isAsync:!!dsf.config.commonForm.isSelectProcessAsync}},created:function(){},mounted:function(){},watch:{},methods:{expand:function(e){e.isopen=!e.isopen,this.isAsync&&0==e.children.length&&this.$emit("setAsyncNode",e)},checkAll:function(e){var t,n=this;e.isopen=!0,e.children&&(t=!0,e.children.filter(function(e){return!e.attrs.noselect}).every(function(e){return e.checked})&&(t=!1),e.children.forEach(function(e){e.attrs.noselect||n.userClick(e,t)}))},userClick:function(e,t){null!=t&&(e.checked=t),this.$emit("changeUser",e)},changeUser:function(e){this.$emit("changeUser",e)},setAsyncNode:function(e){this.$emit("setAsyncNode",e)},getFavicon:function(e){return e.Photo?dsf.url.getWebPath("/fn/mobilePhoto/download?id=".concat(e.id,"&time=").concat((new Date).getTime())):n(5692)}}},u=n(51900),h=(0,u.Z)(h,function(){var n=this,i=n._self._c;return i("div",{staticClass:"dsf-tree"},[n.tree.length?n._l(n.tree,function(t,e){return i("div",{key:"index1"+e},[i("div",{staticClass:"flex-box",class:{treeMargin:0==t.attrs.level,tree_line:t.isopen&&0==t.attrs.level},style:{paddingLeft:"".concat(16*t.attrs.level+16,"px")}},[t.attrs.noselect?n._e():i("van-checkbox",{ref:"check",refInFor:!0,attrs:{"icon-size":"18px",disabled:"2"==t.Selected,shape:"".concat(n.multiple?"square":"round")},on:{click:function(e){return n.userClick(t)}},model:{value:t.checked,callback:function(e){n.$set(t,"checked",e)},expression:"item.checked"}}),n._v(" "),i("div",{staticClass:"tree_tit"},[!t.attrs.noselect&&n.dsf.config.commonForm&&n.dsf.config.commonForm.isshowPhoto?i("img",{attrs:{src:n.getFavicon(t),alt:"",onerror:n.default_img}}):n._e(),n._v(" "),i("span",{class:{tit_width:0<!t.children.length}},[n._v(n._s(t.showName))])]),n._v(" "),!n.isAsync&&0<t.children.length||n.isAsync&&t.attrs.noselect?i("div",{staticClass:"isShowChiled",on:{click:function(e){return e.stopPropagation(),n.expand(t)}}},[t.isopen?i("van-icon",{attrs:{name:"arrow-up"}}):i("van-icon",{attrs:{name:"arrow-down"}}),n._v(" "),i("span",{staticClass:"r_span"},[n._v(n._s(t.isopen?"收起":"展开"))]),n._v(" "),n.multiple&&!t.hideCheckAll&&0<t.children.length?i("i",{staticClass:"icon iconfont iconcheckAll",on:{click:function(e){return e.stopPropagation(),n.checkAll(t)}}}):n._e()],1):n._e()],1),n._v(" "),t.children&&0<t.children.length?[i("sec-tree",{directives:[{name:"show",rawName:"v-show",value:t.isopen,expression:"item.isopen"}],ref:"addTree",refInFor:!0,staticClass:"sec-tree",attrs:{multiple:n.multiple,tree:t.children},on:{changeUser:n.changeUser,setAsyncNode:n.setAsyncNode}})]:n._e()],2)}):i("commonempty")],2)},[],!1,null,"51130890",null).exports,f={name:"controlUserChecked",props:{selectArr:{type:Array,default:[]},currentLine:{type:Object}},components:{draggable:function(){return n.e(9980).then(n.t.bind(n,82021,23))}},data:function(){return{showDialog:!1,inputval:""}},computed:{_selectArr:{get:function(){return this.selectArr},set:function(e){this.$emit("update:selectArr",e)}}},methods:{showClick:function(e){e.isopen=!e.isopen},onEnd:function(){},define:function(){this.$emit("close")},del:function(e,t){this._selectArr.splice(t,1)},saveGroup:function(e,t){var n=this,i={text:"",value:"",nodeId:this.currentLine.lineID,flowId:this.currentLine.flowID};if("confirm"===e){if(!this.inputval)return dsf.layer.toast("请命名小组！"),t(!1);this._selectArr.forEach(function(e){i.text+=e.showName+",",i.value+=e.DeptID+"-"+e.UserID+","}),dsf.http.post("fn/code/select/saveSendGroup",{name:this.inputval,moduleId:this.currentLine.moduleId,data:l()([i])}).then(function(e){"200"==e.data.code&&(n.$emit("refreshGroup"),dsf.layer.toast("新建小组成功"))}),t(!0),this.inputval=""}else t(!0)}}},f=(0,u.Z)(f,function(){var i=this,e=i._self._c;return e("div",{staticClass:"checkusers"},[e("van-nav-bar",{attrs:{title:"选中范围",placeholder:""},on:{"click-left":i.define,"click-right":function(e){i.showDialog=!0}},scopedSlots:i._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"arrow-down"}})]},proxy:!0},{key:"right",fn:function(){return[0<i._selectArr.length?e("van-button",{attrs:{type:"theme",size:"mini"}},[i._v("存为小组")]):i._e()]},proxy:!0}])}),i._v(" "),e("draggable",{staticClass:"list-group",attrs:{group:"people","ghost-class":"ghost",chosenClass:"chosen",animation:"200",handle:".sort"},on:{sort:i.onEnd},model:{value:i._selectArr,callback:function(e){i._selectArr=e},expression:"_selectArr"}},i._l(i._selectArr,function(t,n){return e("div",{key:n,staticClass:"list-group-item"},[e("div",{staticClass:"item-top"},[e("span",[i._v(i._s(t.showName||t.name))]),i._v(" "),e("div",{staticClass:"sort",staticStyle:{padding:"0 10px"}},[e("van-icon",{attrs:{name:"sort",size:"15"}})],1),i._v(" "),"2"!=t.Selected?e("van-icon",{attrs:{size:"0.36rem",name:"cross"},on:{click:function(e){return e.stopPropagation(),i.del(t,n)}}}):i._e()],1)])}),0),i._v(" "),e("van-dialog",{attrs:{title:"新建小组--命名","show-cancel-button":"","before-close":i.saveGroup},model:{value:i.showDialog,callback:function(e){i.showDialog=e},expression:"showDialog"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.inputval,expression:"inputval"}],staticClass:"input-g",attrs:{type:"text"},domProps:{value:i.inputval},on:{input:function(e){e.target.composing||(i.inputval=e.target.value)}}})])],1)},[],!1,null,"95bddb9e",null).exports,p=n(25108),m=(0,u.Z)({name:"searchUserList",props:["tree","selectArr","Response","currentLine"],data:function(){return{searchValue:"",selectIds:[],selectItems:[],getUserBySearchValue:[],userdata:[],timer:null}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){e.$refs.inputVal.querySelector("input").focus()})},methods:{getPerson:function(e,t){var n=this;e.children&&0<e.children.length&&e.children.forEach(function(e){e.UserName&&-1<e.UserName.indexOf(t)&&n.getUserBySearchValue.push(e),n.getPerson(e,t)})},getUserAsync:function(e){var n=this,t=(this.getUserBySearchValue=[],this.currentLine.RangeRule.RuleList.Rule),e=(Array.isArray(t)&&(t=t[0]),{sendRequestID:this.Response.SendRequestID,queryName:e,lineIDs:this.currentLine.lineID,RangeOtherUser:"0",ExpandLevel:-1,ruleList:l()([{nodeId:t.NodeID,level:t.Level,deptId:"",isDeep:"",isSelected:"0",rangeType:t.RangeType,isUser:"1"}])});dsf.http.post("/fn/mobileFlow/getFlowNodeUserByNode",e).then(function(e){var t,e=e.data;p.log(e),e.data&&0<e.data.length&&(e=e.data[0].SendRangeTree,t=[],t=Array.isArray(e.Node)?e.Node:[e.Node],n.getUserBySearchValue=n.openDataFilterUser(t))})},openDataFilterUser:function(e){var n=this,i=[];return e.forEach(function(t){t.UserID&&(t.showName=t.name,t.checked=!!n.selectArr.find(function(e){return n.isSame(t,e)}),i.push(t)),t.Node&&(Array.isArray(t.Node)||(t.Node=[t.Node]),i=i.concat(n.openDataFilterUser(t.Node)))}),i},onSearch:function(t){var n=this;dsf.config.commonForm.isSelectProcessAsync?n.getUserAsync(t):(n.getUserBySearchValue=[],n.userdata.forEach(function(e){n.getPerson(e,t)}))},onCancel:function(){this.getUserBySearchValue=[],this.$emit("searchClose")},userClick:function(e){this.$emit("changeUser",e)},isSame:function(e,t){var n=!1;return"1"==e.Type?n=e.UserID==t.UserID&&e.DeptID==t.DeptID:"2"==e.Type&&(n=e.RoleID==t.RoleID&&e.DeptID==t.DeptID),n}},watch:{tree:{handler:function(e){this.userdata=e},deep:!0,immediate:!0},searchValue:function(e){var t=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e?t.onSearch(e):t.getUserBySearchValue=[]},500)}}},function(){var n=this,i=n._self._c;return i("div",{staticClass:"searchUserList"},[i("form",{attrs:{action:"/"}},[i("van-search",{ref:"inputVal",attrs:{"show-action":"",autofocus:"",shape:"round",placeholder:"搜索"},on:{search:n.onSearch,cancel:n.onCancel},model:{value:n.searchValue,callback:function(e){n.searchValue=e},expression:"searchValue"}})],1),n._v(" "),0<n.getUserBySearchValue.length?i("div",{staticClass:"dsf-tree"},n._l(n.getUserBySearchValue,function(t,e){return i("div",{key:"index"+e},[i("div",{staticClass:"flex-box person"},[i("van-checkbox",{staticClass:"child_check",attrs:{"icon-size":"16px"},on:{click:function(e){return n.userClick(t)}},model:{value:t.checked,callback:function(e){n.$set(t,"checked",e)},expression:"cell.checked"}},[i("div",{staticClass:"user-name"},[n._v(n._s(t.showName||t.name))]),n._v("\n            \n          "),i("div",{staticClass:"user-dept"},[n._v(n._s(t.DeptName))])])],1)])}),0):n._e(),n._v(" "),0==n.getUserBySearchValue.length&&0<n.searchValue.length?i("commonempty",{attrs:{description:"暂无人员"}}):n._e()],1)},[],!1,null,"5c9908a9",null).exports,g=n(25108),m=(0,u.Z)({name:"DsfSelectPerson",components:{secUserSearchList:m,secUserCheckedList:f,secTree:h},props:["currentLine","Response"],data:function(){return{TabActive:0,show:!0,searchValue:"",showSearch:!1,checkPopup:!1,personAddList:[],root:[],group:[],selectArr:[]}},watch:{selectArr:{handler:function(e,t){this.refreshTree(this.root),this.refreshTree(this.group)}}},created:function(){this.getDefaultSelected(),this.setTree()},mounted:function(){},methods:{getDefaultSelected:function(){this.selectArr=JSON.parse(l()(this.currentLine.checkedUserList))},setTree:function(){var t=this;return(0,o.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.getGroup(),t.getData();case 2:case"end":return e.stop()}},e)}))()},getData:function(){this.root=[{attrs:{noselect:!0,level:0},keyCode:"",isopen:!0,checked:!1,hideCheckAll:"7"==this.currentLine.NodeType,showName:this.currentLine.title,children:this.mapNode(JSON.parse(l()(this.currentLine.SendRangeTree.Node)),1)}]},mapNode:function(e,t){var n=this;return(e=e instanceof Array?e:[e]).forEach(function(e){n.setChild(e,t)}),e},setChild:function(t,e){var n=this;t.checked=!!this.selectArr.find(function(e){return n.isSame(t,e)}),t.showName=t.name,t.isopen=e<=1,t.children=[],t.attrs={noselect:"0"==t.Type,level:e},t.Node&&(t.children=this.mapNode(t.Node,e+1))},refreshTree:function(e){var n=this;e.forEach(function(t){t.attrs.noselect?n.refreshTree(t.children):t.checked=!!n.selectArr.find(function(e){return n.isSame(t,e)})})},setAsyncNode:function(n){var i=this,e=this.currentLine.RangeRule.RuleList.Rule,e=(Array.isArray(e)&&(e=e[0]),{sendRequestID:this.Response.SendRequestID,lineIDs:this.currentLine.lineID,RangeOtherUser:this.currentLine.RangeOtherUser,ExpandLevel:-1,ruleList:l()([{nodeId:this.currentLine.NodeID,level:2,deptId:n.DeptID,roleId:e.RoleID,isDeep:"1",isSelected:e.IsSelected||"0",rangeType:e.RangeType,isUser:this.currentLine.RangeRule.IsUser||"0"}])});dsf.http.post("/fn/mobileFlow/getFlowNodeUserByNode",e).then(function(e){var t;e.data.data&&(null!=(t=e.data.data[0].SendRangeTree)&&null!=(t=t.Node)&&t.Node?n.children=i.mapNode(e.data.data[0].SendRangeTree.Node.Node,n.attrs.level+1):dsf.layer.toast("该部门暂无人员！"))})},getGroup:function(){var o=this;dsf.http.post("/fn/flow/getSendGroupData",{moduleId:this.currentLine.moduleId,flowId:this.currentLine.flowID,lineId:this.currentLine.lineID,isMulti:1}).then(function(n){var i,s=[];"200"==n.data.code&&n.data.data&&(i=-1,n.data.data.forEach(function(e,t){"-1"==e.pId&&(s.push({attrs:{noselect:!0,level:0},keyCode:"",isopen:!0,checked:!1,showName:e.showName,children:o.setGroupChild(JSON.parse(l()(n.data.data.slice(i+1,t))))}),i=t)})),o.group=s})},setGroupChild:function(e){var n=this;return e.forEach(function(t){t.isopen=!1,t.children=[],t.UserID=t.sId,t.DeptID=t.deptId,t.Type=t.type,t.checked=!!n.selectArr.find(function(e){return n.isSame(t,e)}),t.attrs={noselect:!1,level:1}}),e},cancePerson:function(){this.$emit("cancePerson")},confirmPerson:function(){this.$emit("confirmPerson",this.selectArr)},changeTreeUser:function(e){g.log(e),e.checked?(1!=this.currentLine.Multiplayer&&this.selectArr.splice(0,this.selectArr.length),this.addToSelectArr(e)):this.removeFormSelectArr(e)},addToSelectArr:function(t){var n=this;this.selectArr.find(function(e){return n.isSame(t,e)})||this.selectArr.push(t)},removeFormSelectArr:function(t){var e,n=this;"2"==t.Selected?dsf.layer.toast("必选用户不能删除"):0<=(e=this.selectArr.findIndex(function(e){return n.isSame(t,e)}))&&this.selectArr.splice(e,1)},isSame:function(e,t){var n=!1;return"1"==e.Type?n=e.UserID==t.UserID&&e.DeptID==t.DeptID:"2"==e.Type&&(n=e.RoleID==t.RoleID&&e.DeptID==t.DeptID),n}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"dsf-select-person"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showSearch,expression:"!showSearch"}],staticClass:"tabs"},[e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{placeholder:"搜索"},on:{click:function(e){t.showSearch=!0}},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1),t._v(" "),e("van-tabs",{attrs:{sticky:"","offset-top":t.dsf.util.getOffsetTop("52px")},model:{value:t.TabActive,callback:function(e){t.TabActive=e},expression:"TabActive"}},[e("van-tab",{attrs:{title:"请选择"}},[e("sec-tree",{ref:"addTree",staticClass:"sec-tree",attrs:{multiple:t.currentLine.Multiplayer,tree:t.root},on:{changeUser:t.changeTreeUser,setAsyncNode:t.setAsyncNode}})],1),t._v(" "),e("van-tab",{attrs:{title:"小组"}},[e("sec-tree",{ref:"addTree",staticClass:"sec-tree",attrs:{multiple:t.currentLine.Multiplayer,tree:t.group},on:{changeUser:t.changeTreeUser}})],1)],1)],1),t._v(" "),e("sec-user-search-list",{directives:[{name:"show",rawName:"v-show",value:t.showSearch,expression:"showSearch"}],staticStyle:{flex:"1"},attrs:{selectArr:t.selectArr,tree:t.root,Response:t.Response,currentLine:t.currentLine},on:{searchClose:function(e){t.showSearch=!1},changeUser:t.changeTreeUser}}),t._v(" "),e("div",{staticClass:"foot"},[e("div",{staticClass:"foot-left",on:{click:function(e){t.checkPopup=!0}}},[e("span",[t._v("已选择："+t._s(t.selectArr.length)+"人")]),t._v(" "),e("van-icon",{directives:[{name:"show",rawName:"v-show",value:0<t.selectArr.length,expression:"selectArr.length > 0"}],staticClass:"tree_icon",attrs:{size:"0.32rem",name:"arrow-up"}})],1),t._v(" "),e("van-button",{attrs:{type:"default"},on:{click:t.cancePerson}},[t._v("取消")]),t._v(" "),e("van-button",{attrs:{type:"info"},on:{click:t.confirmPerson}},[t._v("确定")])],1),t._v(" "),e("van-popup",{style:{height:"90%"},attrs:{round:"",position:"bottom","get-container":"#app"},model:{value:t.checkPopup,callback:function(e){t.checkPopup=e},expression:"checkPopup"}},[e("sec-user-checked-list",{attrs:{"select-arr":t.selectArr,currentLine:t.currentLine},on:{"update:selectArr":function(e){t.selectArr=e},"update:select-arr":function(e){t.selectArr=e},refreshGroup:t.getGroup,close:function(e){t.checkPopup=!1}}})],1)],1)},[],!1,null,"47452cfe",null).exports,f=n(18868),h=n(23501),v=n(25108),t={components:{idealEdit:t.Z,DebounceClick:f.Z,secPerson:m,hw:h.Z,hwJG:function(){return n.e(69751).then(n.bind(n,69751))}},props:{formData:{type:Object,default:function(){return{}}},formMeta:{type:Object,default:function(){return{}}},formParams:{type:Object,default:function(){return{}}},currentOpintion:{type:String,default:null},sendFileOpintion:{type:String,default:null},isShowWriteOpintionBtn:{type:Boolean,default:!1},sendParameters:{type:Object,default:function(){return{}}},currentAction:{type:String,default:""}},data:function(){var e,t={popTitle:"发送",cancalName:"保存",submitName:"发送",showDialog:!1,default_img:'this.src="'+n(5692)+'"',nodeNeedSignBtn:!1,isShowSignBtn:!1,userCurDeptName:"",isShowHandWrite:dsf.config.commonFlow&&dsf.config.commonFlow.needHandWrite,showWrite:!1,imgUrl:"",isShowFuyan:"1"==dsf.config.setting["p2512-handleTip-mode"],fuyan:"",fuyanRadio:0,isShowSmsBox:!1,smsContent:"",smsResult:[],smsMethodRange:[{text:"短信提醒",value:1}],showCalendar:!1,showPicker:!1,currentLine:null,currentTime:"",currentDate:new Date,deptAndUsers:[],checkedUserList:[],Response:{},nodeIsyu:!1,nowNodeType:"normal",showSelect:!1};return(0,s.Z)(t,"currentLine",null),(0,s.Z)(t,"nodeDisplayType",null==(e=dsf.config.commonFlow)?void 0:e.nodeDisplayType),(0,s.Z)(t,"isHideCancelBtn",null==(e=dsf.util.loadSessionStore("user").privileges)?void 0:e.some(function(e){return"禁用表单意见暂存"==e.name})),t},computed:{isShowOpinion:function(){return 0<this.formData.allowEditOpinion&&!this.isShowWriteOpintionBtn},isShowDefaultUser:function(){return!(0==dsf.config.commonFlow.sendNeedDefaultUser)},getHW_Type:function(){return dsf.config.setting.hasOwnProperty("SYS-MOBILE-FORM-0003")&&dsf.config.setting["SYS-MOBILE-FORM-0003"]||"self"},batchSend:function(){return!!this.formData.batchSend}},watch:{showDialog:function(e,t){var n=this;e&&(this.imgUrl="",this.getFlowNodes(),dsf.config.commonFlow.isDefaultShowOpinition&&this.getDefaultOpinition(),this.$nextTick(function(){n.sendFileOpintion&&n.sendFileOpintion.length&&n.$refs.idealEdit&&(n.$refs.idealEdit.value=n.sendFileOpintion)}))},currentOpintion:{handler:function(e,t){var n=this;this.$nextTick(function(){e&&n.$refs.idealEdit&&(n.$refs.idealEdit.value=e)})},immediate:!0}},methods:{getFlowNodes:function(){var s=this,t=(this._loading=dsf.layer.loading(),{lazyExpand:!!dsf.config.commonForm.isSelectProcessAsync,type:this.formData.sendType||this.formData.type||"SR_SEND",wfId:this.formData.flowId,infoId:this.formData.info_id||this.formData.infoId||this.formData.infoId}),e=(a()(this.formData).forEach(function(e){null!=s.formData[e]&&(t[e]=s.formData[e])}),this.checkOpinion("notip")||(t.disableAutoSend=1),0<this.formData.opinionRequired&&(t.ignoreOpinion=1),"/fn/mobileFlow/getFlowNode");this.formData.hasControlOpinionTagView||(e+="?likeAndBranch=1"),dsf.http.post(e,t).then(function(e){var t;if(e.data.data){s.Response=e.data.data.ResponseObject[0];var n=s.Response.Status,i=s.Response.NextNodes;switch(s.mj=s.Response.mj,s.isSecret=s.Response.isSecret,n.substr(0,4)){case"2000":s.dsf.layer.toast("流程发送出错，请检查配置!",void 0,function(){s.sendAfterAction()});break;case"6000":s.dsf.layer.toast("该文件已办理完毕",!0,function(){s.sendAfterAction()});break;case"9000":s.dsf.layer.toast(s.Response.ErrorMessage,void 0,function(){s.sendAfterAction()});break;case"1000":case"5000":case"5100":dsf.layer.closeLoading(s._loading),s.handleAutoSendMes(i.Line);break;default:dsf.layer.closeLoading(s._loading),s.$parent.$parent.$refs.sendPop.$el.style.display="block",s.userCurDeptName=e.data.data.userCurDeptName,s.nodeIsyu="1"==(null==(t=s.Response)?void 0:t.OutLineType)||!1,s.lineData=s.Response.NextNodes.Line,s.initLineDatas(),s.initSms(e.data.data)}}else dsf.layer.toast(e.data.message,!1,function(){s.closePop()})})},handleAutoSendMes:function(e){var t,n=this;1==e.length&&2==e[0].nodeType?dsf.layer.toast("该文件已办理完毕",!0,function(){n.sendAfterAction()}):e.length&&(t="",e.forEach(function(e){e.RecipientList&&e.RecipientList.Node&&(t+=n.getAutoSendNodeMessage(e.RecipientList))}),t.length&&!dsf.config.commonForm.sendWithNoTips?-1!=dsf.config.setting["SYS-FLOW-0005"]?(i.Z.alert({title:"该文件已成功发送至",message:t}),setTimeout(function(){i.Z.close(),n.sendAfterAction()},3e3)):(dsf.layer.toast("发送完成",!0),this.sendAfterAction()):this.dsf.layer.toast("该文件已办理完毕",!0,function(){n.sendAfterAction()}))},initLineDatas:function(){var n=this;if(this.deptAndUsers=[],1==this.lineData.length&&"1"==this.lineData[0].IsAutoSend){if(this.checkOpinion("notip"))return this.autoSend(this.lineData[0].LineID),void dsf.layer.closeLoading(this._loading);this.lineData[0].IsAutoSend="-1"}1<this.lineData.length&&this.lineData.forEach(function(e){return e.IsAutoSend="-1"}),this.lineData.forEach(function(e,t){n.setTimeLimit(e),n.initLineItem(e,t)})},initLineItem:function(e,t){var n={flowID:e.FlowId,nodeID:e.NodeID,title:e.ShowName,lineID:e.LineID,IsAutoSend:e.IsAutoSend,nodeType:e.NodeType,num:"0人审批",headInfo:[],isAdd:!1,checked:!1,Multiplayer:Number(null==(n=e.Multiplayer)?void 0:n.IsEnabled)||0,SendMode:null==(n=e.Multiplayer)?void 0:n.SendMode,originalIndex:t,checkedUserList:[],TimeLimit:e.TimeLimit,Require:e.Require,SendRangeTree:e.SendRangeTree,NextNodes:e.NextNodes,RangeRule:e.RangeRule,RangeOtherUser:e.RangeOtherUser,moduleId:this.formData.moduleId,showMore:!1};this.initHeadInfo(n),this.initShowMore(n),this.initChecked(n),this.checkDefaultUser(n),this.deptAndUsers.push(n)},initChecked:function(e){var t=this;1==this.lineData.length?"3"==e.nodeType?this.$nextTick(function(){t.clickNode(0)}):e.checked=!0:1==e.Require&&(e.checked=!0)},initShowMore:function(e){(dsf.config.commonForm.isSelectProcessAsync||!this.isShowDefaultUser||3<e.headInfo.length)&&(e.showMore=!0)},checkDefaultUser:function(e){var t,n=this;if("1"!=e.IsAutoSend)if(e.checked)if(1==e.headInfo.length)this.$set(e.headInfo[0],"checked",!0),e.checkedUserList=[e.headInfo[0]],e.secHeadInfo=[e.headInfo[0]];else{try{if(0<(null==(t=e.secHeadInfo)?void 0:t.length))return;e.secHeadInfo=[],e.headInfo.forEach(function(t){if(("1"==t.Selected||"2"==t.Selected)&&(("showSimple"==n.nodeDisplayType||3<e.headInfo.length)&&e.secHeadInfo.push(t),e.checkedUserList.find(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID})||(n.$set(t,"checked",!0),e.checkedUserList.push(t)),0==e.Multiplayer))throw new Error})}catch(e){v.log("跳出循环",e)}0==e.secHeadInfo.length&&delete e.secHeadInfo}else e.headInfo.forEach(function(e){n.$set(e,"checked",!1)}),e.checkedUserList=[],delete e.secHeadInfo},initHeadInfo:function(e){var t=[];e.SendRangeTree&&(t=t.concat(this.retainUser(e.SendRangeTree,[]))),e.headInfo=t},retainUser:function(e,t){var n=this;return e.UserID||e.RoleID&&"2"==e.Type?t.push(e):e.Node instanceof Array?e.Node.map(function(e){n.retainUser(e,t)}):e.Node?this.retainUser(e.Node,t):v.log("空部门"),r()(new(d())(t))},getFlowNodeUsers:function(e,t){e={sendRequestID:this.Response.SendRequestID,lineIDs:e||"",pk:this.formData.info_id||this.formData.infoId||this.formMeta.parameters.pk,moduleId:this.formData.moduleId,flowId:this.formData.flowId,nodeId:this.formData.nodeId,pId:this.formData.pid,pnId:this.formData.pnid};dsf.http.post("/fn/mobileFlow/getFlowNodeUserByNode",e).then(function(e){e.data.result?t(e.data):dsf.layer.toast(e.data.message)})},setJumpLine:function(e){e.data&&(this.lineData=e.data,this.initLineDatas())},goBackNode:function(){this.nowNodeType="normal",this.getFlowNodes()},initSms:function(e){var t=this;-1!=e.isSms&&(this.isShowSmsBox=!0,this.smsContent=e.sms,e.smsMethodRange?(this.smsMethodRange=e.smsMethodRange,this.smsMethodRange.forEach(function(e){e.checked&&t.smsResult.push(e.value)})):dsf.config.commonFlow.defaultSendSms&&this.smsResult.push(1))},saveHandleTip:function(){dsf.http.post("fn/flowHandleTip/saveHandleTip",{pnId:this.formData.pnid,handleTipsRange:this.fuyanRadio,handleTip:this.fuyan}).then(function(e){})},setTimeLimit:function(t){"2"!=t.NodeType&&t.TimeType&&t.TimeSpan&&1==dsf.config.setting["SYS-FLOW-0047"]&&dsf.http.post("fn/flow/timeLimit",{timeType:t.TimeType,timeSpan:t.TimeSpan}).then(function(e){"200"==e.data.code&&(t.TimeLimit=e.data.data)})},timeClick:function(e){this.currentLine=e,this.showCalendar=!0,this.currentLine.TimeLimit&&(this.currentDate=new Date(this.currentLine.TimeLimit.split(" ")[0].replace(/-/g,"/")),this.currentTime=this.currentLine.TimeLimit.split(" ")[1])},onConfirm:function(e){e=dsf.date.format(e,"yyyy-mm-dd"),this.currentLine.TimeLimit=e,this.showPicker=!0},confirmDate:function(e){this.currentLine.TimeLimit+=" "+e,this.showPicker=!1,this.showCalendar=!1},filter:function(e,t){return"minute"===e?t.filter(function(e){return e%15==0}):t},getDefaultOpinition:function(){var n=this;dsf.http.post("fn/mobileFormComment/getH5CurrentComment",{pk:this.formData.info_id||this.formData.infoId||this.formMeta.parameters.pk,pid:this.formData.pid||this.formMeta.parameters.pId,pnid:this.formData.pnid||this.formMeta.parameters.pnId,moduleId:this.formData.moduleId||this.formMeta.parameters.moduleId}).then(function(e){var t,e=e.data;null!=(t=e.data)&&null!=(t=t.opinion)&&t.length&&(n.$refs.idealEdit.value=e.data.opinion),e.data.handWritePic&&(n.imgUrl=dsf.url.getServerUrl("fn/file/downloadFile?fileName=".concat(e.data.handWritePic)),dsf.util.getImageFileFromUrl(dsf.url.getRootPath()+"fn/file/downloadFile?fileName=".concat(e.data.handWritePic)).then(function(e){new ArrayBuffer;e=dsf.util.arrayBufferToBase64(e);n.base64Img="data:image/png;base64,"+e}).catch(function(e){v.log(e)}))})},checkOpinion:function(e){return 1==this.formParams.isSign||!this.formParams.sendCheck||!("SR_EXSEND"!=this.formData.sendType&&(this.$refs.idealEdit&&!this.trimTip(this.$refs.idealEdit.value).length&&this.formData.allowEditOpinion&&0<this.formData.opinionRequired?(null==e&&dsf.layer.toast("请填写审批意见",!1),this.errorMessage="请填写审批意见"):null!=(e=dsf.config.commonFlow)&&e.needHandWrite&&0<this.formData.allowEditOpinion&&1==this.havetoHandWrite&&!this.imgUrl&&(dsf.layer.toast("请签名",!1),1)))},saveOpinion:function(n){var e,i=this,s=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._loadingSend=dsf.layer.loading(),0<this.formData.allowEditOpinion&&!this.isShowWriteOpintionBtn?(e={__DATA:l()({info_id:this.formData.info_id||this.formData.infoId,pid:new String(this.formData.pid),pnid:new String(this.formData.pnid),opinion:n.contentValue||this.$refs.idealEdit.value,type:"g_inbox"})},dsf.http.post("/fn/mobileSaveOpinion/saveOpinion?flowId=".concat(this.formData.flowId,"&nodeId=").concat(this.formData.nodeId,"&moduleId=").concat(this.formData.moduleId),e).then(function(e){var t;e.data.result?s?(null!=(t=dsf.config.commonFlow)&&t.canSwitchOpinionMode&&"input"==i.$refs.idealEdit.opinionMode&&i.delHandWrite(),i.sendFlow(n)):dsf.layer.closeLoading(i._loadingSend):dsf.layer.toast(e.data.message,!1)}).catch(function(){dsf.layer.closeLoading(i._loadingSend)})):s&&this.sendFlow(n)},trimTip:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},openWritePopup:function(){this.showWrite=!0,"jg"==this.getHW_Type&&this.$refs.HWJG.buttonHWClick()},delHandWrite:function(){var t=this;dsf.http.post("fn/mobileHandWritingData/delete?pnid=".concat(this.formData.pnid,"&pid=").concat(this.formData.pid)).then(function(e){e.data.result&&(t.imgUrl="")})},closeWritePopup:function(e){e?(this.showWrite=!1,e&&(this.imgUrl=e)):(this.imgUrl="",this.delHandWrite(),this.showWrite=!1)},getSineStatus:function(){var t=this;dsf.config.commonFlow&&dsf.config.commonFlow.nodeNeedSignBtn&&dsf.http.post("fn/opinionSignCheck/mobileControlCheck",{todoId:this.formData.todoId||this.formParams.todoId,nodeName:this.formData.nodeName||this.formMeta.parameters.nodeName,pk:this.formData.info_id||this.formData.infoId||this.formParams.pk}).then(function(e){e=e.data;e.data.checkVal&&(t.nodeNeedSignBtn=!0,t.isShowSignBtn=1==e.data.checkVal)}).catch(function(e){v.log(e),dsf.layer.toast("获取签名状态失败")})},handleSign:function(){var t=this;dsf.http.post("fn/opinionSignCheck/todoUpdSign",{pid:this.formData.pid,pnid:this.formData.pnid,isSign:this.isShowSignBtn?1:0,pk:this.formData.info_id||this.formData.infoId}).then(function(e){e=e.data;dsf.layer.toast(e.message),t.isShowSignBtn=!t.isShowSignBtn}).catch(function(e){v.log(e),dsf.layer.toast("操作失败")})},getAutoSendNodeMessage:function(e){var n="";return function e(t){t.Node?Array.isArray(t.Node)?t.Node.forEach(e):e(t.Node):n+="".concat(t.DeptName," ").concat(t.UserName||"","\n")}(e),n},closePop:function(){this.$emit("close"),this.showDialog=!1,this.showContent=!1},sendAfterAction:function(e){this.lineIds=e||"";var t=this;this.$refs.idealEdit&&(this.$refs.idealEdit.value=""),t.closePop(),"copyOpinion"==this.currentAction||"xform.copySend"==this.currentAction?this.$emit("initData"):(e=dsf.util.loadLocalStore("actionType")||"1",dsf.config.commonForm.showFormSetting&&"commonForm"==this.$route.name&&this.$route.query.type&&"gw"==this.$route.query.type?"0"==e||"1"==e?t.goBackList():"2"==e?t.checkNextDb(function(e){e.hasData?(t.$router.replace({path:e.path}),t.$eventBus.refresh(t)):t.goBackList()}):t.checkNextDb(function(e){e.hasData?(t.curPath=e.path,t.$emit("showNext",e.path)):t.dsf.layer.toast("文件已办理完毕",!0,function(){t.goBackList()})}):"1"==t.sendParameters.sendToNext?dsf.http.post("/fn/mobileToDoAndRead/getToDoAndReadList2",{limit:10,_content:"",key:"",page:1,showTotal:!0,fileType:"gw",isFirst:1,start:1}).then(function(e){v.log(e),e&&e.data&&e.data.datas&&(0<(e=e.data.datas.filter(function(e){return"-1"!=e.dataValue.allowMobile})).length?(t.$router.replace({path:"/commonForm/".concat(e[0].dataValue.moduleId,"/").concat(e[0].dataValue.info_id,"/1?type=gw&todoId=").concat(e[0].dataValue.todoId)}),t.$eventBus.refresh(t)):t.goBackList())}):t.goBackList())},checkNextDb:function(t){var e=this.$store.state.searchParam;e.dataIndex=this.$route.query.dataIndex||0,v.log(e),dsf.http.post("/fn/mobileToDo/getToDoByIndex",e).then(function(e){v.log(e.data.data),e&&e.data&&e.data.data?(e=e.data.data,t({path:"/commonForm/".concat(e.moduleId,"/").concat(e.info_id,"/1?type=gw&todoId=").concat(e.todoId),hasData:!0})):t({hasData:!1})})},goBackList:function(){var e=this;this.$emit("change",this.lineIds),setTimeout(function(){e.$emit("close"),e.$emit("golist")},500)},autoSend:function(e){var n=this;n.getFlowNodeUsers(e,function(e){var t=e.data[0].status;-1<t.indexOf("1000")||-1<t.indexOf("5000")||-1<t.indexOf("5100")||-1<t.indexOf("6000")?n.handleAutoSendMes(e.data):-1<t.indexOf("4000")?(n.lineData=e.data,n.initLineDatas()):dsf.layer.toast("自动发送失败")})},sendFlow:function(a){var r=this;return(0,o.Z)(c().mark(function e(){var n,i,s,t,o;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.$parent.$parent.spHandleJS.beforeRealSend)return e.next=3,r.$parent.$parent.spHandleJS.beforeRealSend(a.nodeInfo,r.$parent.$parent);e.next=3;break;case 3:if(s=!(i=[]),(n=r).lineData.map(function(n){s="2"==n.NodeType,a.nodeInfo.forEach(function(e){var t;n.ShowName==e.title&&(t=[],t=e.checkedUserList,n.RecipientList={},n.RecipientList.Node=s?[]:t,n.TimeLimit=e.TimeLimit,i.push(n))})}),i.forEach(function(e){e.SendMode=e.SendMode,e.exInfo="",e.RangeRule={},e.SendRangeTree={}}),t={ResponseObject:{SendRequestID:n.Response.SendRequestID,SendParams:{isSms:n.smsResult.length?n.smsResult.join(","):-1,sms:n.smsResult.length?n.smsContent:"",Line:i}}},n.batchSend)return dsf.layer.closeLoading(n._loadingSend),n.$emit("firstBatchSend",i),e.abrupt("return");e.next=13;break;case 13:o={__DATA:l()(t),pk:r.formData.info_id||r.formData.infoId||r.formMeta.parameters.pk,moduleId:r.formData.moduleId,flowId:r.formData.flowId,nodeId:r.formData.nodeId,pId:r.formData.pid,pnId:r.formData.pnid},dsf.http.post("/fn/mobileFlow/sendFlow",o).then(function(e){var t;dsf.layer.closeLoading(n._loadingSend),e.data&&e.data.result?(dsf.layer.toast("发送成功",!0),t=i.map(function(e){return e.LineID}),n.sendAfterAction(t)):dsf.layer.toast(e.data.message,!1)}).catch(function(){dsf.layer.closeLoading(n._loadingSend)});case 15:case"end":return e.stop()}},e)}))()},sendFileFlow:function(){var n,i,e;this.isShowFuyan&&this.fuyan&&this.saveHandleTip(),this.checkOpinion()&&(n=!1,i=[],this.deptAndUsers.forEach(function(e,t){"2"!=e.nodeType&&"1"!=e.IsAutoSend||!e.checked||(n=!0),e.checked&&i.push(e)}),(e=this.deptAndUsers.find(function(e){return 1==e.Require&&0==e.checkedUserList.length&&"2"!=e.nodeType}))?dsf.layer.toast("".concat(e.title,"未选中人员"),!1):0!=i.length||n?i.some(function(e){return 0==e.checkedUserList.length})&&!n?dsf.layer.toast("未选中人员",!1):this.saveOpinion({contentValue:this.$refs.idealEdit?this.$refs.idealEdit.value:"",nodeInfo:i}):dsf.layer.toast("未选中发送环节",!1))},clickNode:function(n,i){var e,s=this,t=this.deptAndUsers[n],o=!!i||!t.checked;this.checkNodeFilter(),"7"==t.nodeType?(this.$set(t,"checked",o),i&&i.length?this.checkNodeUser(t,i):this.checkDefaultUser(t)):"3"==t.nodeType?(e=t.NextNodes.Line.map(function(e){return e.LineID}).join(","),this.nowNodeType="redirect",this.nodeIsyu="1"==t.OutLineType||!1,this.getFlowNodeUsers(e,this.setJumpLine)):this.nodeIsyu?(this.$set(t,"checked",o),i&&i.length?this.checkNodeUser(t,i):this.checkDefaultUser(t)):this.deptAndUsers.forEach(function(e,t){"7"!=e.nodeType&&(n==t?(s.$set(e,"checked",!0),i&&i.length?s.checkNodeUser(e,i):s.checkDefaultUser(e)):(s.$set(e,"checked",!1),s.checkDefaultUser(e)))})},clickUser:function(n,i,e){var s=this;return(0,o.Z)(c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1==s.isSecret&&n.MJ<s.mj)return dsf.layer.toast("高密级文件不能发送给低密级等级人员"),e.abrupt("return");e.next=3;break;case 3:if("2"==n.Selected)return dsf.layer.toast("必选用户不能删除"),e.abrupt("return");e.next=6;break;case 6:s.checkNodeFilter(),t=s.deptAndUsers.findIndex(function(e){return e.lineID==i.lineID}),s.clickNode(t,[n]);case 9:case"end":return e.stop()}},e)}))()},checkNodeUser:function(n,e){var i=this;e.forEach(function(t){var e;i.$set(t,"checked",!t.checked),t.checked?(1!=n.Multiplayer&&(n.headInfo.forEach(function(e){e.UserID==t.UserID&&e.RoleID==t.RoleID&&e.DeptID==t.DeptID||i.$set(e,"checked",!1)}),n.checkedUserList=[]),"2"==t.Type?0!=n.checkedUserList.length&&-1!=n.checkedUserList.findIndex(function(e){return e.UserID==t.UserID&&e.RoleID==t.RoleID&&e.DeptID==t.DeptID})||n.checkedUserList.push(t):n.checkedUserList.find(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID})||n.checkedUserList.push(t)):-1<(e=n.checkedUserList.findIndex(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID}))&&n.checkedUserList.splice(e,1)}),0==n.checkedUserList.length&&this.$set(n,"checked",!1)},checkNodeFilter:function(){var t=this;return(0,o.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$parent.$parent.spHandleJS&&t.$parent.$parent.spHandleJS.checkNodeFilter){if(e.prev=1,t.$route.name.includes("commonForm"))return e.next=5,t.$parent.$parent.spHandleJS.checkNodeFilter(t.$parent.$parent.formData,t.formMeta,t.$parent.$parent,data);e.next=7}else e.next=15;break;case 5:e.next=9;break;case 7:return e.next=9,t.$parent.$parent.spHandleJS.checkNodeFilter(t.formData,t.$parent.$parent,data);case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(1),v.log(e.t0),e.abrupt("return");case 15:case"end":return e.stop()}},e,null,[[1,11]])}))()},showSecPerson:function(t,n){var i=this;return(0,o.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.checkNodeFilter(),i.clickNode(n,[]),i.currentLine=t,i.showSelect=!0;case 4:case"end":return e.stop()}},e)}))()},confirmPerson:function(e){var n=this;this.currentLine.checkedUserList=e,dsf.config.commonForm.isSelectProcessAsync?this.currentLine.secHeadInfo=e:(this.currentLine.secHeadInfo=[],e.length?(this.currentLine.checked=!0,e.forEach(function(t){var e=n.currentLine.headInfo.find(function(e){return e.UserID==t.UserID&&e.DeptID==t.DeptID});e.checked=!0,n.currentLine.secHeadInfo.push(e)})):this.currentLine.headInfo.forEach(function(e){return e.checked=!1}),0==this.currentLine.secHeadInfo.length&&delete this.currentLine.secHeadInfo),this.showSelect=!1},cancel:function(){this.showDialog=!1,this.showContent=!1,this.selectIndex=null;var e=this.$refs.idealEdit?this.trimTip(this.$refs.idealEdit.value):"";this.$emit("close",e),this.$refs.idealEdit&&(this.$refs.idealEdit.value="")},show:function(e){"isList"==e&&this.$refs.idealEdit&&(this.$refs.idealEdit.value=""),this.showDialog=!0},getFavicon:function(e){return e.Photo?dsf.url.getWebPath("/fn/mobilePhoto/download?id=".concat(e.id,"&time=").concat((new Date).getTime())):n(5692)}}},y=(0,u.Z)(t,function(){var i=this,s=i._self._c;return s("div",{directives:[{name:"show",rawName:"v-show",value:i.showDialog,expression:"showDialog"}],staticClass:"send-file"},[s("van-nav-bar",{attrs:{title:i.popTitle,"left-text":"取消"},on:{"click-left":i.cancel},scopedSlots:i._u([{key:"right",fn:function(){return[i.nodeNeedSignBtn?s("div",{staticClass:"flex ac"},[s("van-button",{attrs:{type:"info",size:"mini"},on:{click:i.handleSign}},[i._v(i._s(i.isShowSignBtn?"签名":"取消签名"))])],1):i._e()]},proxy:!0}])}),i._v(" "),s("div",{staticClass:"_content"},[i.userCurDeptName?s("div",{staticClass:"ds_theme_font"},[i._v("\n      所属部门："+i._s(i.userCurDeptName)+"\n    ")]):i._e(),i._v(" "),s("idealEdit",{directives:[{name:"show",rawName:"v-show",value:i.isShowOpinion,expression:"isShowOpinion"}],ref:"idealEdit",staticClass:"idealEdit",attrs:{isShowHandWrite:i.isShowHandWrite,rows:"3"},on:{handWrite:i.openWritePopup},scopedSlots:i._u([{key:"opinionImg",fn:function(){return[i.isShowHandWrite?s("div",{staticClass:"handleWriteBox"},[s("div",{staticClass:"writeContent"},[i.imgUrl?s("img",{style:{width:i.dsf.config.commonFlow.opinionImgWidth||"50%"},attrs:{src:i.imgUrl,alt:""}}):i._e()])]):i._e()]},proxy:!0}])}),i._v(" "),i.isShowFuyan?[s("div",{staticClass:"fuyan"},[s("van-field",{attrs:{label:"附言填写：",placeholder:"请输入附言",type:"textarea",autosize:"",rows:"1"},scopedSlots:i._u([{key:"right-icon",fn:function(){return[s("img",{staticStyle:{width:"0.4rem"},attrs:{src:0==i.fuyanRadio?"static/images/platform/nextNode.png":"static/images/platform/allNode.png",alt:""},on:{click:function(e){i.fuyanRadio=0==i.fuyanRadio?1:0}}})]},proxy:!0}],null,!1,3625057113),model:{value:i.fuyan,callback:function(e){i.fuyan=e},expression:"fuyan"}}),i._v(" "),s("van-radio-group",{attrs:{direction:"horizontal","icon-size":"0.3rem"},model:{value:i.fuyanRadio,callback:function(e){i.fuyanRadio=e},expression:"fuyanRadio"}},[s("van-radio",{attrs:{name:0}},[i._v("仅下一环节可见")]),i._v(" "),s("van-radio",{attrs:{name:1}},[i._v("所有环节可见")])],1)],1)]:i._e(),i._v(" "),s("div",{staticClass:"_nodes"},[s("div",{staticClass:"_nodes-top"},[s("span",{staticClass:"ds_theme_font"},[i._v("您即将发给")]),i._v(" "),"redirect"==i.nowNodeType?s("van-tag",{staticClass:"returnBtn",attrs:{type:"primary",size:"small"},on:{click:function(e){return i.goBackNode()}}},[i._v("\n          返回")]):i._e()],1),i._v(" "),"showSimple"==i.nodeDisplayType?[s("div",{staticClass:"_nodes-list simpleOptions"},i._l(i.deptAndUsers,function(t,n){return s("div",{key:n,class:["_node",{_nodeChecked:t.checked}],on:{click:function(e){return i.clickNode(n)}}},[s("div",{staticClass:"_node-info"},[s("div",{staticClass:"_node-title"},[s("span",{staticClass:"ds_font4_m"},[s("i",{class:["iconfont",t.checked?"iconarrow-right-drop-circle-outline":"iconcheckAll"]}),i._v("\n                  "+i._s(1==t.Require?"[必选]":"")+i._s(t.title)),"2"!=t.nodeType&&"3"!=t.nodeType?s("span",{staticClass:"ds_font7",staticStyle:{"font-size":"0.28rem"}},[i._v("\n                    ("+i._s(t.checkedUserList.length+"人")+")")]):i._e()])]),i._v(" "),"1"!=t.IsAutoSend&&"2"!=t.nodeType&&"3"!=t.nodeType?s("div",{staticClass:"_node-more",on:{click:function(e){return e.stopPropagation(),i.showSecPerson(t,n)}}},[i._l(t.secHeadInfo,function(e,t){return t<1?s("div",{key:t,staticClass:"_head_img"},[s("van-icon",{attrs:{name:"contact"}}),i._v(" "),s("span",{staticClass:"_font ds_font6"},[i._v("\n                    "+i._s(e.name)+"\n                  ")])],1):i._e()}),i._v(" "),s("div",[0==t.checkedUserList.length?s("span",[i._v("请选择")]):i._e(),i._v(" "),s("i",{staticClass:"iconfont iconarrow-right1"})])],2):i._e()])])}),0)]:[s("div",{staticClass:"_nodes-list"},i._l(i.deptAndUsers,function(n,t){return s("div",{key:t,class:["_node",{_nodeChecked:n.checked}],on:{click:function(e){return i.clickNode(t)}}},[8<n.title.length?s("div",{staticClass:"_node-top"},[s("span",{staticClass:"ds_font4_m"},[i._v(i._s(1==n.Require?"[必选]":"")+i._s(n.title))])]):i._e(),i._v(" "),s("div",{staticClass:"_node-info"},[s("div",{staticClass:"_node-title"},[n.title.length<=8?s("span",{staticClass:"ds_font4_m"},[i._v(i._s(1==n.Require?"[必选]":"")+i._s(n.title))]):i._e(),i._v(" "),"2"!=n.nodeType&&"3"!=n.nodeType?s("span",{staticClass:"ds_font7"},[i._v(i._s(n.checkedUserList.length+"人"))]):i._e()]),i._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:i.isShowDefaultUser||n.secHeadInfo,expression:"isShowDefaultUser || item.secHeadInfo"}],staticClass:"_node-users"},i._l(n.secHeadInfo||n.headInfo,function(t,e){return e<3?s("div",{key:e,staticClass:"_node-user",on:{click:function(e){return e.stopPropagation(),i.clickUser(t,n,e)}}},[s("img",{class:{gray:!t.checked,header:!0},attrs:{src:i.getFavicon(t),title:t.FullDeptName,alt:"",onerror:i.default_img}}),i._v(" "),t.checked?i._e():s("van-icon",{staticClass:"noChecked",attrs:{name:"checked"}}),i._v(" "),t.checked?s("van-icon",{staticStyle:{"background-color":"#fff","border-radius":"50%"},attrs:{name:"checked"}}):i._e(),i._v(" "),s("div",{staticClass:"_font ds_font6"},[i._v("\n                    "+i._s(t.name)),2==t.Type?s("span",[i._v("("+i._s(t.DeptName)+")")]):i._e()])],1):i._e()}),0),i._v(" "),"3"==n.nodeType?s("div",[s("van-icon",{attrs:{name:"arrow",size:"22"}})],1):n.showMore?s("div",{staticClass:"_node-more",on:{click:function(e){return e.stopPropagation(),i.showSecPerson(n,t)}}},[s("i",{staticClass:"iconfont iconjiahao addicon"}),i._v(" "),s("span",[i._v("更多")])]):i._e()]),i._v(" "),2!=n.nodeType&&1==i.dsf.config.setting["SYS-FLOW-0047"]?s("div",{staticClass:"_node-timeLimit"},[s("van-field",{staticClass:"timeLimit",attrs:{readonly:!0,"input-align":"right",label:"办理期限"},on:{click:function(e){return e.stopPropagation(),i.timeClick(n)}},scopedSlots:i._u([{key:"right-icon",fn:function(){return[s("i",{staticClass:"iconfont iconriqi",staticStyle:{"font-size":"0.42rem"}})]},proxy:!0}],null,!0),model:{value:n.TimeLimit,callback:function(e){i.$set(n,"TimeLimit",e)},expression:"item.TimeLimit"}})],1):i._e()])}),0)]],2),i._v(" "),i.isShowSmsBox?[s("div",{staticClass:"ds_theme_font"},[i._v("提醒方式")]),i._v(" "),s("div",{staticClass:"sms-container"},[s("van-checkbox-group",{ref:"checkboxGroup",attrs:{direction:"horizontal"},model:{value:i.smsResult,callback:function(e){i.smsResult=e},expression:"smsResult"}},i._l(i.smsMethodRange,function(e,t){return s("van-checkbox",{key:t,attrs:{name:e.value,"icon-size":"0.28rem"}},[i._v(i._s(e.text)+"\n          ")])}),1),i._v(" "),i.dsf.config.commonFlow.noShowSmsContent?i._e():s("van-field",{attrs:{rows:"2",autosize:"",type:"textarea",placeholder:"请输入短信提醒内容"},model:{value:i.smsContent,callback:function(e){i.smsContent=e},expression:"smsContent"}})],1)]:i._e()],2),i._v(" "),s("div",{staticClass:"_footer"},[i.isShowOpinion&&!i.isHideCancelBtn?s("debounce-click",[s("van-button",{staticClass:"_btn _no_send",attrs:{type:"default"},on:{click:function(e){i.saveOpinion({},!1),i.$emit("close")}}},[i._v(i._s(i.cancalName)+"\n      ")])],1):i._e(),i._v(" "),s("debounce-click",[s("van-button",{staticClass:"_btn _send",attrs:{type:"theme"},on:{click:function(e){return i.sendFileFlow()}}},[i._v(i._s(i.submitName))])],1)],1),i._v(" "),s("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!1,"get-container":"#app",position:"bottom"},model:{value:i.showSelect,callback:function(e){i.showSelect=e},expression:"showSelect"}},[i.showSelect?s("secPerson",{attrs:{currentLine:i.currentLine,Response:i.Response},on:{cancePerson:function(e){i.showSelect=!1},confirmPerson:i.confirmPerson}}):i._e()],1),i._v(" "),s("van-calendar",{ref:"calendarRef",attrs:{"first-day-of-week":"1","get-container":"#app","default-date":i.currentDate},on:{confirm:i.onConfirm},scopedSlots:i._u([{key:"title",fn:function(){return[s("div",{staticStyle:{padding:"0 15px","text-align":"left",height:"80px"}},[s("div",{staticClass:"btnright"},[s("van-button",{attrs:{round:"",size:"mini",type:"primary"},on:{click:i.clearDate}},[i._v("清空日期")])],1)])]},proxy:!0}]),model:{value:i.showCalendar,callback:function(e){i.showCalendar=e},expression:"showCalendar"}}),i._v(" "),s("van-popup",{attrs:{position:"bottom",round:"","get-container":"#app"},model:{value:i.showPicker,callback:function(e){i.showPicker=e},expression:"showPicker"}},[s("van-datetime-picker",{attrs:{type:"time",title:"选择时间","min-hour":0,"max-hour":23,filter:i.filter},on:{confirm:i.confirmDate,cancel:function(e){i.showPicker=!i.showPicker}},model:{value:i.currentTime,callback:function(e){i.currentTime=e},expression:"currentTime"}})],1),i._v(" "),"self"==i.getHW_Type?s("van-popup",{attrs:{"get-container":"#app",position:"bottom",round:""},model:{value:i.showWrite,callback:function(e){i.showWrite=e},expression:"showWrite"}},[s("hw",{attrs:{formData:i.formData,base64Img:i.imgUrl},on:{closeWritePopup:i.closeWritePopup}})],1):i._e(),i._v(" "),"jg"==i.getHW_Type&&i.showWrite?s("div",[s("hwJG",{ref:"HWJG",attrs:{hwtype:i.getHW_Type,formData:i.formData,formMeta:i.formMeta},on:{closeWritePopup:i.closeWritePopup}})],1):i._e()],1)},[],!1,null,"7db75f28",null).exports}}]);