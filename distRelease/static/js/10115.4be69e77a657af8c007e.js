"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[10115],{10115:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var e=a(8450),o=a.n(e),e=a(18428),n=a.n(e),s=a(88561),i=a(62596),r=a(25108),e={components:{},data:function(){return{logname:"",autoLogin:!1,isChangeUser:!1,createUser:!1,showPickerData:{unit:!1,unitColumns:[],dept:!1,deptColumns:[],post:!1,postColumns:[]},userData:{orgId:"",orgName:"",deptId:"",deptName:"",rankId:"11",rankName:"其他工作人员",userName:""},unitData:[],rankData:[],orgIndex:0}},computed:{},mounted:function(){},created:function(){var e=this;this.$route.query.changUser?(this.isChangeUser=!0,this.createUser=!0):s.Z.loadLocalStore("check_passWord")&&(s.Z.loadLocalStore("autoLogin")?this.login2():this.createUser=!0),dsf.http.post("fn/bgtIndex/organize").then(function(t){return e.unitData=t.data.data,e.showPickerData.unitColumns=e.unitData.map(function(t){return t.text}),dsf.http.post("fn/bgtIndex/code?fid=190223145151tY2wvSmRgkYR1dJpjmj")}).then(function(t){r.log(t),e.rankData=t.data,e.showPickerData.postColumns=e.rankData.map(function(t){return t.name})})},methods:{goForm:function(){this.$router.go(-1)},onConfirmUnit:function(t,e){var a=this;this.orgIndex=e,this.userData.deptName="",this.userData.orgName=t,this.userData.orgId=this.unitData[e].value,this.showPickerData.deptColumns=[],this.unitData[e].depts.forEach(function(t){a.showPickerData.deptColumns.push(t.text)}),this.showPickerData.unit=!1},onConfirmDept:function(t,e){this.userData.deptName=t,this.userData.deptId=this.unitData[this.orgIndex].depts[e].value,this.showPickerData.dept=!1},onConfirmPost:function(t,e){this.userData.rankName=t,this.userData.rankId=this.rankData[e].value,this.showPickerData.post=!1},showPicker:function(t){"dept"!=t||this.userData.orgName.length?this.showPickerData[t]=!this.showPickerData[t]:dsf.layer.toast("请先选择单位")},goUrl:function(){this.$router.replace("/index")},login2:function(){var e=this,t=i.Z.decode(s.Z.loadLocalStore("userName"))||s.Z.loadLocalStore("user").logName,a=i.Z.decode(s.Z.loadLocalStore("passWord"))||"111111",t={__DATA:o()({logname:t,password:a,device_id:"device_id",device_desc:"device_desc"})};dsf.http.post("/fn/mobileAuth/login",t).then(function(t){1==t.data.rcode?(s.Z.saveToSessionStore("user",t.data.data),s.Z.saveToSessionStore("loginToken",t.data.data.auth.token),s.Z.saveToLocalStore("userName",i.Z.encode(t.data.data.logName)),s.Z.saveToLocalStore("passWord",i.Z.encode("111111")),s.Z.saveToLocalStore("loginToken",t.data.data.auth.token),s.Z.saveToLocalStore("user",t.data.data),s.Z.saveToLocalStore("autoLogin",!0),s.Z.logIn(function(){e.goUrl()})):s.Z.saveToLocalStore("autoLogin",!1),dsf.layer.toast(t.data.message)}).error(function(t){-1<t.message.indexOf("404")&&dsf.layer.toast("登录接口异常，请联系系统管理员！")}).always(function(){dsf.layer.closeLoading(e.loading)})},gologin:function(){var e=this,t=n()({device_id:"device_id",device_desc:"device_desc"},this.userData);dsf.http.post("fn/bgtIndex/bgtLogin",t).then(function(t){r.log(t),1==t.data.rcode?(s.Z.saveToSessionStore("user",t.data.data),s.Z.saveToSessionStore("loginToken",t.data.data.auth.token),s.Z.saveToLocalStore("userName",i.Z.encode(t.data.data.logName)),s.Z.saveToLocalStore("passWord",i.Z.encode("111111")),s.Z.saveToLocalStore("loginToken",t.data.data.auth.token),s.Z.saveToLocalStore("user",t.data.data),s.Z.saveToLocalStore("autoLogin",!0),s.Z.logIn(function(){e.goUrl()})):s.Z.saveToLocalStore("autoLogin",!1),dsf.layer.toast(t.data.message)}).error(function(t){s.Z.saveToLocalStore("autoLogin",!1),-1<t.message.indexOf("404")&&dsf.layer.toast("登录接口异常，请联系系统管理员！")})},login:function(){"bgt123456"==this.logname?(s.Z.saveToLocalStore("check_passWord",i.Z.encode("bgt123456")),this.createUser=!0):(dsf.layer.toast("验证码不正确"),this.logname="")}}},c=(0,a(51900).Z)(e,function(){var e=this,t=e._self._c;return t("div",{staticClass:"box"},[t("div",{staticClass:"banner"}),e._v(" "),e.isChangeUser?e._e():t("div",{staticClass:"formbox loginForm"},[t("div",{staticClass:"login_title"},[e._v("请输入验证密码")]),e._v(" "),t("van-form",{on:{submit:e.login}},[t("van-field",{attrs:{type:"password",rules:[{required:!0}],name:"验证密码",placeholder:"请输入验证密码",center:""},model:{value:e.logname,callback:function(t){e.logname=t},expression:"logname"}}),e._v(" "),t("div",{staticClass:"btnbox",staticStyle:{"margin-top":"30px"}},[e.autoLogin?t("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{disabled:e.autoLogin,round:"",type:"info","native-type":"submit"}},[e._v("登录中...")]):t("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{round:"",type:"info","native-type":"submit"}},[e._v("确定")])],1)],1)],1),e._v(" "),t("van-popup",{ref:"popref",style:{height:"100%"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom"},model:{value:e.createUser,callback:function(t){e.createUser=t},expression:"createUser"}},[t("div",{staticClass:"formUserBox loginForm"},[t("van-form",{on:{submit:e.gologin}},[t("van-field",{attrs:{readonly:"",clickable:"",name:"picker",label:"单位",placeholder:"点击选择单位",rules:[{required:!0}]},on:{click:function(t){return e.showPicker("unit")}},model:{value:e.userData.orgName,callback:function(t){e.$set(e.userData,"orgName",t)},expression:"userData.orgName"}}),e._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",name:"picker",label:"部门",placeholder:"点击选择部门",rules:[{required:!0}]},on:{click:function(t){return e.showPicker("dept")}},model:{value:e.userData.deptName,callback:function(t){e.$set(e.userData,"deptName",t)},expression:"userData.deptName"}}),e._v(" "),t("van-field",{attrs:{name:"姓名",label:"姓名",placeholder:"请输入姓名",rules:[{required:!0}]},model:{value:e.userData.userName,callback:function(t){e.$set(e.userData,"userName",t)},expression:"userData.userName"}}),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPickerData.unit,callback:function(t){e.$set(e.showPickerData,"unit",t)},expression:"showPickerData.unit"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.showPickerData.unitColumns},on:{confirm:e.onConfirmUnit,cancel:function(t){return e.showPicker("unit")}}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPickerData.dept,callback:function(t){e.$set(e.showPickerData,"dept",t)},expression:"showPickerData.dept"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.showPickerData.deptColumns},on:{confirm:e.onConfirmDept,cancel:function(t){return e.showPicker("dept")}}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPickerData.post,callback:function(t){e.$set(e.showPickerData,"post",t)},expression:"showPickerData.post"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.showPickerData.postColumns},on:{confirm:e.onConfirmPost,cancel:function(t){return e.showPicker("post")}}})],1),e._v(" "),t("div",{staticClass:"btnbox",staticStyle:{"margin-top":"30px"}},[e.autoLogin?t("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{disabled:e.autoLogin,round:"",type:"info","native-type":"submit"}},[e._v("登录中...")]):t("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{round:"",type:"info","native-type":"submit"}},[e._v("确定")])],1)],1)],1)])],1)},[],!1,null,"2d03cf06",null).exports}}]);