"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[43422],{65463:function(e,t,a){a.r(t),a.d(t,{default:function(){return r}});var t=a(8450),n=a.n(t),t=a(73473),c=a.n(t),t=a(34347),s=a(63450),o=a(25108),t={name:"",components:{timePicker:t.Z,controlUserList:s.default},props:{},data:function(){return{offsetTop:"0px",cancelChecked:!1,curyear:null,curmonth:null,currentDate:moment().format("YYYY-MM-DD"),today:moment().format("YYYY-MM-DD"),leaderList:[],showCalendar:!1,releaseStatus:0,scheduleData:{},showPerson:!1,selectType:0,defaultSelectArray:[],extra:{multiple:!0,tabs:[{action:"fn/user/select/data?types=person&rootObject=1&action=canonical_group-public&async=true",name:"领导活动组",subTabKey:"department"},{action:"fn/user/select/data?types=person&rootObject=2&action=self_org&async=true",name:"本机构",subTabKey:"department"},{action:"fn/user/select/data?types=person&rootObject=3&action=self_dept&async=true",name:"本部门",subTabKey:"department"}]},showViewUser:!1,havaSch:[]}},created:function(){},mounted:function(){this.offsetTop=this.$store.state.isShowAppHeader?"0.92rem":"0px",this.getScheduleData(),this.$refs.timePicker.defaultDateShow({date:this.currentDate})},methods:{prevClick:function(){this.currentDate=moment(this.currentDate).subtract(1,"day").format("YYYY-MM-DD"),this.getScheduleData()},nextClick:function(e){this.currentDate=moment(this.currentDate).add(1,"day").format("YYYY-MM-DD"),this.getScheduleData()},thisWeek:function(e){var t=this;this.getSchedule(e[0].date,e[6].date).then(function(e){t.havaSch=e}).catch(function(e){dsf.layer.toast(e)})},thisMonth:function(e){var t=this;this.getSchedule(e[0][0].date,e[e.length-1][6].date).then(function(e){t.havaSch=e}).catch(function(e){dsf.layer.toast(e)})},checkedDate:function(e){o.log(e),this.currentDate=e,this.getScheduleData()},getScheduleData:function(){var t=this;this.$toast.loading({message:"加载中...",duration:0,overlay:!0}),t.defaultSelectArray=[],dsf.http.get("ctrl/p2433LeaderSchedule/get",{date:t.currentDate,isEdit:"1"}).then(function(e){200==e.data.code&&(t.$toast.clear(),t.scheduleData=e.data.data,t.releaseStatus=e.data.data.status)})},onConfirm:function(e){this.showCalendar=!1,this.currentDate=moment(e).format("YYYY-MM-DD"),this.getScheduleData()},saveSchedule:function(e,t){var a=this,s=JSON.parse(n()(a.scheduleData));s.date=a.currentDate,e&&(s.visibleUser=e.visibleUser,s.visibleUserText=e.visibleUserText,s.visibleUserSchema=e.visibleUserSchema),dsf.http.post("ctrl/p2433LeaderSchedule/save",s,{headers:{"Content-Type":"application/json"}}).then(function(e){200==e.data.code?(a.$toast.success("保存成功!"),t&&t()):a.$toast.fail(e.data.message)})},releaseSchedule:function(e){var t=this;1!=e?t.showPerson=!0:dsf.http.get("ctrl/p2433LeaderSchedule/unRelease",{date:t.currentDate}).then(function(e){200==e.data.code?(t.$toast.success("取消发布成功!"),t.releaseStatus=0,dsf.layer.toast("取消发布成功!","success",function(){t.getScheduleData()})):t.$toast.fail("取消发布失败!")})},cancePerson:function(){this.showPerson=!this.showPerson},getSelectUser:function(a){var e,s,t,n=this;0<a.length&&(a.forEach(function(e,t){e.children&&0<e.children.length&&a.splice(t,1)}),t=a.map(function(e){return e.id}),e=a.map(function(e){return e.name}),s=[],t.forEach(function(e,t){s.push(t+1+"::"+e)}),t={visibleUser:t.join(","),visibleUserText:e.join(","),visibleUserSchema:s.join(",")},n.saveSchedule(t,function(){dsf.http.get("ctrl/p2433LeaderSchedule/release",{date:n.currentDate}).then(function(e){200==e.data.code?(n.$toast.success("发布成功!"),n.releaseStatus=1,dsf.layer.toast("发布成功!","success",function(){n.getScheduleData()})):n.$toast.fail("发布失败!")})})),this.showPerson=!1},getSchedule:function(e,s){return new(c())(function(t,a){dsf.http.get("ctrl/p2433LeaderSchedule/check",{startTime:e,endTime:s}).then(function(e){200==e.data.code?t(e.data.data):a("获取日程失败")})})}},computed:{},watch:{}},r=(0,a(51900).Z)(t,function(){var a=this,s=a._self._c;return s("div",{staticClass:"schedule-leader"},[s("div",{staticClass:"schedule-container",style:{marginBottom:a.currentDate>=a.today?"1.2rem":"0"}},[s("van-sticky",{attrs:{"offset-top":a.dsf.util.getOffsetTop()}},[s("div",{staticClass:"time-card"},[s("time-picker",{ref:"timePicker",attrs:{"position-today":!0,"hava-sch":a.havaSch,curyear:a.curyear,curmonth:a.curmonth},on:{"update:havaSch":function(e){a.havaSch=e},"update:hava-sch":function(e){a.havaSch=e},"update:curyear":function(e){a.curyear=e},"update:curmonth":function(e){a.curmonth=e},thisWeek:a.thisWeek,thisMonth:a.thisMonth,checkedDate:a.checkedDate}})],1)]),a._v(" "),a.scheduleData.subList&&0<a.scheduleData.subList.length?s("div",{staticClass:"leader-card-list"},a._l(a.scheduleData.subList,function(t,e){return s("div",{key:e,staticClass:"leader-card"},[s("p",{staticClass:"name",domProps:{innerHTML:a._s(t.leaderText)}}),a._v(" "),s("div",{staticClass:"context"},[s("p",{staticClass:"morning"},[a._v("上午")]),a._v(" "),s("van-field",{attrs:{autosize:"",readonly:a.currentDate<a.today,rows:"1",type:"textarea",placeholder:"请输入"},model:{value:t.morningContent,callback:function(e){a.$set(t,"morningContent",e)},expression:"item.morningContent"}})],1),a._v(" "),s("div",{staticClass:"context"},[s("p",{staticClass:"afternoon"},[a._v("下午")]),a._v(" "),s("van-field",{attrs:{autosize:"",readonly:a.currentDate<a.today,rows:"1",type:"textarea",placeholder:"请输入"},model:{value:t.afternoonContent,callback:function(e){a.$set(t,"afternoonContent",e)},expression:"item.afternoonContent"}})],1)])}),0):s("commonempty")],1),a._v(" "),a.currentDate>=a.today?s("div",{staticClass:"bottom-btn"},[s("van-button",{staticClass:"flex1",attrs:{size:"middle",type:"default"},on:{click:function(e){return a.saveSchedule()}}},[a._v("保存")]),a._v(" "),s("van-button",{staticClass:"flex1",attrs:{size:"middle",type:"primary"},on:{click:function(e){return a.releaseSchedule(a.scheduleData.status)}}},[a._v(a._s(1==a.scheduleData.status?"取消发布":"发布"))])],1):a._e(),a._v(" "),s("van-popup",{style:{height:"100%"},attrs:{"close-on-click-overlay":!0,"lock-scroll":"",position:"bottom","get-container":"#app"},model:{value:a.showPerson,callback:function(e){a.showPerson=e},expression:"showPerson"}},[a.showPerson?s("control-user-list",{attrs:{"default-select-array":a.defaultSelectArray,extra:a.extra,selectType:a.selectType},on:{close:a.cancePerson,getSelectUser:a.getSelectUser}}):a._e()],1),a._v(" "),a.scheduleData.visibleUserText?s("van-popup",{style:{height:"80%"},attrs:{position:"bottom","lock-scroll":"",round:"","get-container":"#app"},model:{value:a.showViewUser,callback:function(e){a.showViewUser=e},expression:"showViewUser"}},[s("div",{staticClass:"view-user-list"},[s("van-nav-bar",{attrs:{title:"人员查看范围",placeholder:""},scopedSlots:a._u([{key:"right",fn:function(){return[s("van-icon",{attrs:{name:"cross",size:"18",color:"#999"},on:{click:function(e){a.showViewUser=!1}}})]},proxy:!0}],null,!1,2793013438)}),a._v(" "),s("div",{staticClass:"list"},a._l(a.scheduleData.visibleUserText.split(","),function(e,t){return s("p",{key:t},[a._v(a._s(e))])}),0)],1)]):a._e()],1)},[],!1,null,"fc30ace8",null).exports}}]);