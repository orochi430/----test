"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[68938,31204],{8449:function(e,t,n){var r=n(8167),i=n(31314),a=n(77193),s=n(8450),o=n.n(s),u=n(25108),s=function(){function s(){(0,r.Z)(this,s),(0,a.Z)(this,"ws",null),(0,a.Z)(this,"userid",""),(0,a.Z)(this,"ponReceivedTodo",null),(0,a.Z)(this,"ponScanCodeAfter",null),(0,a.Z)(this,"setIntervalWesocketPush",null)}return(0,i.Z)(s,[{key:"open",value:function(e){var t=dsf.url.getRootPath(),n=dsf.util.loadSessionStore("user").user_id||dsf.util.loadSessionStore("user").userId;t.startsWith("http:")?t=t.replace("http","ws")+"servletWebsocket/"+n:t.startsWith("https:")&&(t=t.replace("https","wss")+"servletWebsocket/"+n),this.ws=new WebSocket(t),this.ws.onopen=function(){e&&e()},this.ws.onmessage=function(e){var t;"pong"!=e.data&&(u.log(e),e=JSON.parse(e.data),t=s.getInstance(),-1<e.badgeType.indexOf("inbox")&&0<e.userIds.filter(function(e){return e==t.userid}).length?null!=t.ponReceivedTodo&&t.ponReceivedTodo({badgeType:e.badgeType,refresh:!0}):"qrCodeMessag"==e.badgeType&&e.userIds==t.userid?null!=t.ponScanCodeAfter&&t.ponScanCodeAfter({data:e.data}):"sameScreenMessage"==e.badgeType&&e.userIds.includes(t.userid)&&null!=t.ponmeettingSameScreen&&t.ponmeettingSameScreen({data:e.data}))},this.ws.onerror=function(e){u.log(e)},this.ws.onclose=function(){s.getInstance()}}},{key:"sendMessage",value:function(e){this.ws.send(o()(e))}},{key:"onReceivedTodo",value:function(e,t){this.userid=e,this.ponReceivedTodo=t}},{key:"onScanCodeAfter",value:function(e,t){this.userid=e,this.ponScanCodeAfter=t}},{key:"onmeettingSameScreen",value:function(e,t){this.userid=e,this.ponmeettingSameScreen=t}},{key:"clearFunction",value:function(){this.ponReceivedTodo=null,this.ponScanCodeAfter=null}},{key:"sendPing",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:6e4,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"ping";clearInterval(this.setIntervalWesocketPush),this.ws&&1==this.ws.readyState&&this.ws.send(n),this.setIntervalWesocketPush=setInterval(function(){e.ws&&1==e.ws.readyState?e.ws.send(n):clearInterval(e.setIntervalWesocketPush)},t)}},{key:"getWsReadyState",value:function(){return s.instance.ws.readyState}}],[{key:"getInstance",value:function(e,t,n){return s.instance||(s.instance=new s).open(function(){s.instance.sendPing(),t&&n&&s.instance[t](n)}),s.instance}},{key:"close",value:function(e){s.instance&&s.instance.ws&&(clearInterval(s.instance.setIntervalWesocketPush),1==s.instance.ws.readyState&&s.instance.ws.close(),s.instance=null,e)&&e()}}]),s}();t.Z=s},68938:function(e,t,n){n.r(t),n.d(t,{default:function(){return c}});var a=n(66250),t=n(8450),o=n.n(t),t=n(73473),s=n.n(t),t=n(33453),u=n.n(t),r=n(8449),i=n(88561),t={name:"staging",components:{},data:function(){return{dataObj:{blue:{imgUrl:"",bgUrl:""},red:{imgUrl:"",bgUrl:""}},menuList:[],name:dsf.util.loadSessionStore("user").name,userColor:dsf.util.loadLocalStore("userColor"),tipdatas:[],count:0,err:!0,timer:""}},created:function(){},computed:{imgcp:function(){var e;return this.userColor||null==this.userColor?dsf.url.getServerUrl((null==(e=this.dataObj.red)?void 0:e.imgUrl)||""):dsf.url.getServerUrl((null==(e=this.dataObj.blue)?void 0:e.imgUrl)||"")},bgcp:function(){var e;return this.userColor||null==this.userColor?dsf.url.getServerUrl((null==(e=this.dataObj.red)?void 0:e.bgUrl)||""):dsf.url.getServerUrl((null==(e=this.dataObj.blue)?void 0:e.bgUrl)||"")}},mounted:function(){var s=this;this.getMenu(),this.getImg(),this.setTimer(),this.oaScoket=r.Z.getInstance(this),this.oaScoket.onReceivedTodo(i.Z.loadSessionStore("user").user_id,function(e){window.xsfCommon&&s.setAppBadge(),s.tipdatas.forEach(function(){var t=(0,a.Z)(u().mark(function e(t){var n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.tip)return e.next=3,s.getTip(t.tip);e.next=5;break;case 3:n=e.sent,s.menuList.find(function(e){e.id==t.id&&(e.badge=(-1<t.tip.indexOf("forwardRequest")?n.data:n).data.badge)});case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())})},methods:{setTimer:function(){var s=this;function e(){s.tipdatas.forEach(function(){var t=(0,a.Z)(u().mark(function e(t){var n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.tip)return e.next=3,s.getTip(t.tip);e.next=5;break;case 3:n=e.sent,s.menuList.find(function(e){e.id==t.id&&(e.badge=(-1<t.tip.indexOf("forwardRequest")?n.data:n).data.badge)});case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())}e(),window.xsfCommon&&s.setAppBadge(),clearInterval(this.timer),this.timer=setInterval(function(){window.xsfCommon&&s.setAppBadge(),e()},3e4)},getTimeState:function(){var e=(new Date).getHours(),t="";return 0<=e&&e<=12?t="早上好，":12<e&&e<=18?t="下午好，":18<e&&e<=24&&(t="晚上好，"),t},getImg:function(){var t=this,n=dsf.layer.loading(),e=this.$route.query.id||dsf.util.loadSessionStore("footerMenu").find(function(e){return"工作台"==e.showName}).id;dsf.http.post("ctrl/shortcutBar/img/".concat(e)).then(function(e){"200"==e.data.code?(dsf.layer.closeLoading(n),t.dataObj=e.data.data):dsf.layer.toast(e.data.message)}).error(function(e){o()(e).includes("Network Error")&&(dsf.layer.closeLoading(n),t.err=!1)})},getMenu:function(){var r=this,i=this,t=(this.menuList=[],this.tipdatas=[],dsf.layer.loading());dsf.http.get("fn/shortcutBar/list").then(function(e){"200"==e.data.code?(e.data.data.forEach(function(){var n=(0,a.Z)(u().mark(function e(t,n){var s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s={name:t.shortcutName,router:t.actUrl,img:dsf.url.getServerUrl(i.userColor?JSON.parse(t.shortcutIcon).red:JSON.parse(t.shortcutIcon).blue),textColor:JSON.parse(t.agentid).textColor,id:t.id},r.menuList.push(s),i.tipdatas.push({id:t.id,tip:t.tip}),t.tip)return e.next=6,i.getTip(t.tip);e.next=8;break;case 6:s=e.sent,i.$set(i.menuList[n],"badge",(-1<t.tip.indexOf("forwardRequest")?s.data:s).data.badge);case 8:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}()),dsf.layer.closeLoading(t)):dsf.layer.toast(e.data.message)}).error(function(e){o()(e).includes("Network Error")&&(dsf.layer.closeLoading(t),r.err=!1)})},goRoute:function(e){var t,n,s,r;-1<e.router.indexOf("http:")||-1<e.router.indexOf("https:")?(n=dsf.util.loadSessionStore("user").user_id,t=e.router.split("commonList")[0],-1<e.router.indexOf("nmdwydbg")?s=dsf.base64.encode(e.router.split("/nmdwydbg")[1]):-1<e.router.indexOf("DreamWeb")&&(s=dsf.base64.encode(e.router.split("/DreamWeb")[1])),t="".concat(t,"fn/mobileSso/redirectAuth?code=").concat(n,"&state=").concat(s),xsfWindow.openWebView({title:"",url:t,colorString:"#fff",show_title_bar:!1})):(n=e.router.split("?")[0],s=e.router.includes("fileType"),"commonList/2206140944586bW055wjWnzurPnIaOC/200604181624TgyhRFd9z8kt5NCPcLQ"!=n||s?(e.router.indexOf("fileType"),this.$router.push({path:e.router,query:{title:e.name,openSocket:1}})):(r={},e.router.split("?")[1]&&e.router.split("?")[1].split("&").forEach(function(e){var t=e.split("=")[0],e=e.split("=")[1];r[t]=e}),this.$router.push({path:"/commonList",query:{title:e.name,fileType:"nmg_db",secQuery:o()(r),openSocket:1}})))},getTip:function(n){return new(s())(function(t,e){dsf.http.get(n).then(function(e){t(e)})})},setAppBadge:function(){var t=this,e=dsf.config.login.setAppBadgeUrl||"fn/list/2206140944586bW055wjWnzurPnIaOC/mobileBadge/q?isFirst=1&moduleId=200604181624TgyhRFd9z8kt5NCPcLQ";dsf.http.post(e).then(function(e){t.count=e.data.badge,xsfCommon.setAppBadge({count:e.data.badge},t.testSuccess,t.testFailed)})},testSuccess:function(e){},testFailed:function(e){},reload:function(){window.location.reload()}},activated:function(){this.setTimer()},deactivated:function(){clearInterval(this.timer)}},c=(0,n(51900).Z)(t,function(){var n=this,s=n._self._c;return s("div",{staticClass:"box"},[n.err?s("div",{staticClass:"staging"},[s("div",{staticClass:"head"},[s("img",{attrs:{src:n.imgcp,alt:""}}),n._v(" "),s("div",{staticClass:"weather"},[s("div",{staticClass:"weather_buttom"},[n._v("欢迎您，"+n._s(n.name))])])]),n._v(" "),s("div",{staticClass:"main",style:{backgroundImage:"url(".concat(n.bgcp,")")}},n._l(n.menuList,function(t,e){return s("div",{key:e,staticClass:"main_item",on:{click:function(e){return n.goRoute(t)}}},[s("img",{attrs:{src:t.img,alt:""}}),n._v(" "),s("div",{staticClass:"main_item_content",style:{color:t.textColor}},[s("div",[n._v(n._s(t.name))]),n._v(" "),s("div",[n._v(n._s(t.badge))])])])}),0)]):s("div",[s("div",{staticClass:"errtip"},[s("div",{staticClass:"center",on:{click:n.reload}},[n._m(0),n._v(" "),s("div",{staticClass:"errtext"},[n._v("网络错误，请点击重试")])])])])])},[function(){var e=this._self._c;return e("div",{staticClass:"errimg"},[e("i",{staticClass:"reload icon iconfont iconrefresh"})])}],!1,null,"6496ab36",null).exports},8167:function(e,t,n){function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:function(){return s}})},31314:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(26771),i=n(44660);function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),r(e,(0,i.Z)(s.key),s)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),r(e,"prototype",{writable:!1}),e}}}]);