"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[84888],{84888:function(e,t,s){s.r(t),s.d(t,{default:function(){return n}});var i=s(25108),t={name:"forgetPassword",data:function(){return{setCode:!0,setPassword:!1,phone:"",phonecode:"",newpassword:"",surepassword:"",smsBtnText:"发送验证码",smsBtnEnable:!1,randomStr:"",errPwdMsg:"请输入新密码",phoneValidator:[{required:!0},{pattern:/^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d{8}$/,message:"请输入正确手机号"}],smsValidator:[{required:!0}],isIm:!1,findPassword:0,title:"",logImgStyle:{height:"5rem"},isFullscreenBg:dsf.config.setting.hasOwnProperty("SYS-MOBILE-STYLE-0007")&&dsf.config.setting["SYS-MOBILE-STYLE-0007"]||-1}},computed:{minPwd:function(){return dsf.config.setting.hasOwnProperty("SYS-SEC-0001")&&dsf.config.setting["SYS-SEC-0001"]||6},strengthPwd:function(){return dsf.config.setting.hasOwnProperty("SYS-SEC-0002")&&dsf.config.setting["SYS-SEC-0002"]||1},pwdRules:function(){var e=[{validator:function(e){return""!==e}},{pattern:/^[A-Za-z0-9\~\@\^\!\#\$\(\)\*]+$/,message:"密码只能包含合法字符：数字、字母、~！@$^()*"},{pattern:new RegExp("^.{"+this.minPwd+",}$",""),message:"密码长度至少为".concat(this.minPwd,"位")}];return 2==this.strengthPwd&&e.push({pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z0-9\~\@\^\!\#\$\(\)\*]+$/,message:"密码必须包含数字+字母"}),3==this.strengthPwd&&e.push({pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[\~\@\^\!\#\$\(\)\*])[A-Za-z0-9\~\@\^\!\#\$\(\)\*]+$/,message:"密码必须包含数字+字母+符号~、！、@、$、^、(、)、*"}),i.log(e),e},loginBackground:function(){var e=s(41844);return"iPad"==dsf.util.getClientType()&&dsf.config.setting["SYS-MOBILE-STYLE-0008"]?dsf.url.getServerUrl("fn/file/downloadImage?fileName=".concat(dsf.config.setting["SYS-MOBILE-STYLE-0008"])):dsf.config.setting["SYS-MOBILE-STYLE-0003"]?dsf.url.getWebPath(dsf.config.setting["SYS-MOBILE-STYLE-0003"]):e}},beforeMount:function(){this.title=dsf.config.login.title},methods:{sureValidator:function(e){return e==this.newpassword},confirm:function(){var t=this;this.setCode?dsf.http.post("/fn/mobileSmsAuth/verifyForgetCode",{mobile:this.phone,code:this.phonecode}).then(function(e){dsf.layer.toast(e.data.message),1==e.data.rcode&&(t.randomStr=e.data.data,t.setCode=!1,t.setPassword=!0)}).error(function(e){dsf.layer.toast("接口异常，请联系系统管理员！")}):dsf.http.post("/fn/mobileSmsAuth/forgetPsd",{randomStr:this.randomStr,pwd:this.newpassword}).then(function(e){dsf.layer.toast(e.data.message),1==e.data.rcode&&(1==t.findPassword&&window.native&&window.native.isNative?window.native.back():t.$emit("toLogin"))}).error(function(e){dsf.layer.toast("接口异常，请联系系统管理员！")})},sendSmsCode:function(){var n=this,o=0;n.$refs.setPwd.validate("phone").then(function(){return n.smsBtnEnable=!0,o=dsf.layer.loading("发送中..."),dsf.http.post("/fn/mobileSmsAuth/sendForgetSms",{mobile:n.phone})}).then(function(e){var t,s;i.log(e),dsf.layer.closeLoading(o),dsf.layer.toast(e.data.message),1==e.data.rcode?(t=e.data.data.time,s=setInterval(function(){t--,n.smsBtnText="发送验证码("+t+")",0==t&&(clearInterval(s),n.smsBtnEnable=!1,n.smsBtnText="发送验证码")},1e3)):n.smsBtnEnable=!1}).error(function(e){dsf.layer.closeLoading(o),n.smsBtnEnable=!1,i.log(e),-1<e.message.indexOf("404")&&dsf.layer.toast("短信发送接口异常，请联系系统管理员！")})},showDeviceId:function(){var e=this;e.clickIndex++,setTimeout(function(){e.clickIndex=0},300),i.log(e.clickIndex),1<e.clickIndex&&("postman"!=e.DeviceId&&dsf.layer.alert({title:"温馨提示",message:"您的设备码为：".concat(e.DeviceId)}),e.clickIndex=0)},loadImage:function(){this.logImgStyle={}},openHotLine:function(){dsf.util.openWebviewToUrl({url:dsf.config.login.HotlineAddress,title:""})}},created:function(){this.$route.query.isIm&&(this.isIm=1==this.$route.query.isIm),0<=navigator.userAgent.indexOf("mobileIM")&&(this.isIm=!0),this.$route.query.findPassword&&1==this.$route.query.findPassword&&(this.findPassword=1)}},n=(0,s(51900).Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"box"},[e("div",{staticClass:"banner",style:t.logImgStyle,on:{click:t.showDeviceId}},[e("img",{class:{fullscreenBg:0<t.isFullscreenBg},attrs:{src:t.loginBackground,alt:""},on:{load:t.loadImage}}),t._v(" "),e("p",{staticClass:"title",domProps:{innerHTML:t._s(t.title)}})]),t._v(" "),e("div",{staticClass:"formbox loginForm"},[e("van-form",{ref:"setPwd",on:{submit:t.confirm}},[e("van-field",{attrs:{rules:t.phoneValidator,readonly:t.setPassword,name:"phone",type:"tel",placeholder:"请输入手机号码",center:""},scopedSlots:t._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconshouji"})]},proxy:!0}]),model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}}),t._v(" "),t.setCode?e("div",{staticClass:"sendCode"},[e("van-field",{attrs:{rules:t.smsValidator,center:"",clearable:"",name:"短信验证码",placeholder:"请输入验证码"},scopedSlots:t._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconyuechi"})]},proxy:!0}],null,!1,253601634),model:{value:t.phonecode,callback:function(e){t.phonecode=e},expression:"phonecode"}}),t._v(" "),e("van-button",{attrs:{text:t.smsBtnText,disabled:t.smsBtnEnable,size:"small",type:"primary","native-type":"button"},on:{click:function(e){return t.sendSmsCode()}}})],1):t._e(),t._v(" "),t.setPassword?e("van-field",{attrs:{rules:t.pwdRules,type:"password",name:"密码",placeholder:"请输入新密码",center:""},scopedSlots:t._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconmima1"})]},proxy:!0}],null,!1,629997040),model:{value:t.newpassword,callback:function(e){t.newpassword=e},expression:"newpassword"}}):t._e(),t._v(" "),t.setPassword?e("van-field",{attrs:{rules:[{required:!0},{validator:t.sureValidator,message:"两次输入密码不一致"}],type:"password",name:"密码",placeholder:"请再次输入新密码",center:""},scopedSlots:t._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont iconmima1"})]},proxy:!0}],null,!1,629997040),model:{value:t.surepassword,callback:function(e){t.surepassword=e},expression:"surepassword"}}):t._e(),t._v(" "),e("div",{staticClass:"btnbox",staticStyle:{"margin-top":"30px"}},[e("van-button",{staticStyle:{width:"100%","font-size":"19px"},attrs:{round:"",type:"info","native-type":"submit"}},[t._v("\n          "+t._s(t.setPassword?"确认":"重置")+"\n        ")])],1),t._v(" "),t.isIm?t._e():e("div",{staticClass:"changeType"},[e("span",{on:{click:function(e){return t.$emit("toLogin")}}},[t._v("返回登录")])])],1)],1),t._v(" "),e("div",{staticClass:"FPbottom"},[e("span",{staticClass:"hotLine",on:{click:t.openHotLine}},[t._v("技术服务热线")])])])},[],!1,null,"2e7808a1",null).exports},41844:function(e,t,s){e.exports=s.p+"static/img/loginLogo.6696c0a..png"}}]);