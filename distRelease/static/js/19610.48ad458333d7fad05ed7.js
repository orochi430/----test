"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[19610],{19610:function(e,t,n){n.r(t),n.d(t,{default:function(){return a}});var s=n(66250),t=n(8450),m=n.n(t),t=n(33453),i=n.n(t),t={name:"addRecord",props:{existRec:{type:String,default:function(){return""}}},data:function(){return{RecoContent:""}},watch:{existRec:{handler:function(e,t){this.RecoContent=this.existRec},immediate:!0}},created:function(){},mounted:function(){},methods:{transferText:function(){this.$emit("RecoContent",this.RecoContent)}}},o=n(51900),t=(0,o.Z)(t,function(){var t=this,e=t._self._c;return e("div",{staticClass:"addRecord"},[e("van-field",{attrs:{rows:"8",type:"textarea",maxlength:"200","show-word-limit":"",placeholder:"请输入会议记录"},on:{blur:t.transferText},model:{value:t.RecoContent,callback:function(e){t.RecoContent=e},expression:"RecoContent"}})],1)},[],!1,null,"4090ba24",null).exports,h=n(25108),a=(0,o.Z)({components:{addRecord:t},name:"meeting_preview",data:function(){return{data:{},jssdk:null,showMeeting:!1,saveMessage:"",existRec:""}},created:function(){h.log(this.$route.params,this.$route.query),this.data=this.$route.params.file,this.$route.params.file||(this.data=this.$route.query,h.log(!this.$route.params.file,this.data))},mounted:function(){var e=this;dsf.loadJs("static/js/webOffice/web-office-sdk-v1.1.19.umd.js").then(function(){e.getWpsUrl(),e.$nextTick(function(){1<document.getElementsByClassName("wps_office").length&&window.location.reload()})})},watch:{},methods:{getWpsUrl:function(){this.getWdztUrl(this.data,"fn/sdtongSSO/getPreviewUrl")},getWdztUrl:function(e,t){var n=this,o=this.$route.query.infoId;dsf.http.post(t,{fileId:e.fileId,fileName:e.fileName,infoId:o,moduleId:e.moduleId,pnId:e.nodeId,pId:e.flowId}).then(function(e){"200"==e.data.code&&n.wpsOpens(e.data.data.url)})},wpsOpens:function(n){var o=this;return(0,s.Z)(i().mark(function e(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=document.getElementById("wpsOffice"),o.jssdk=WebOfficeSDK.config({url:n,mount:t}),o.jssdk.iframe.style.height=window.screen.availHeight-100+"px",o.jssdk.iframe.style.width=window.screen.availWidth+15+"px";case 4:case"end":return e.stop()}},e)}))()},getMeeting:function(){var t=this,e={infoId:this.$route.query.infoId,userId:this.$user.user_id,attValue:22};dsf.http.get("ctrl/meetingRecord/getMeetingRecordContent",e).then(function(e){200==e.data.code?(t.existRec=e.data.data.content,t.showMeeting=!0):dsf.layer.toast("获取失败")})},saveMeeting:function(){var e={infoId:this.$route.query.infoId,content:this.saveMessage,attValue:22,attValueText:"会议记录",fileName:this.$route.query.title.split("：")[1]+"的会议记录"};this.showMeeting=!1,dsf.http.post("ctrl/meetingRecord/createMeetingRecord",e).then(function(e){200==e.data.code?dsf.layer.toast(e.data.message):dsf.layer.toast("保存失败")})},RecoContent:function(e){this.saveMessage=e},cancelMeeting:function(){var e=this;h.log(this.existRec),this.showMeeting=!1,setTimeout(function(){e.existRec=""},200)},endorsement:function(){var t=this,e=this.data,n=dsf.util.loadSessionStore("loginToken"),o=(new Date).getTime(),s=dsf.url.getRootPath(),i=this.data.fileName.split(".")[1],n=s+"fn/file/download?infoId=".concat(this.$route.query.infoId,"&fileId=").concat(e.id,"&fileName=").concat(e.fileName,"&nrType=").concat(i,"&moduleId=").concat(e.moduleId,"&x-auth-token=").concat(n,"&fullfilename=").concat(o).concat(e.fileName),o=s+"fn/swMobileCtrl/sendBack?infoId=".concat(this.$route.query.infoId,"&pid=").concat(e.flowId,"&pnid=").concat(e.nodeId,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),a=s+"fn/mobileOffice/upload?fileId=".concat(e.id,"&moduleId=").concat(e.moduleId,"&pnId=").concat(e.nodeId,"&nodeName=&fileType=1&infoId=").concat(this.$route.query.infoId,"&extension=").concat(i,"&x-auth-token=").concat(dsf.util.loadSessionStore("loginToken")),c=s+"fn/getimage/downloadImage?userid="+dsf.util.loadSessionStore("user").user_id,d=dsf.config.commonForm.shuke.externalStorage||!1,r=dsf.config.commonForm.shuke.screenshots||!1,f=dsf.config.commonForm.shuke.foldingScreen||"",u=dsf.config.commonForm.shuke.penPad||"",l=dsf.config.commonForm.shuke.project||"",n=(h.log(n),{downUrl:n,backUrl:o,writePhoto:c,externalStorage:d,saveUrl:a,handTip:"",fileName:e.fileName,userName:dsf.util.loadSessionStore("user").name,foldingScreen:f,penPad:u,stamp:{getCJInfo:s+"fn/SZFcj/getCJInfo?userId=".concat(dsf.util.loadSessionStore("user").user_id,"&swh=&fromList="),downloadCJInfo:s+"fn/SZFcj/downloadCJInfo?userId=".concat(dsf.util.loadSessionStore("user").user_id,"&swh=&fromList="),isStamp:!1},screenshots:r,canEdit:!0,project:l,pid:e.flowId,pnid:e.nodeId,fileId:e.id,Opinions:[],nodeOpinion:"",copyRight:dsf.config.commonForm.shuke.keyCode,buttonState:{signFontSize:dsf.config.commonForm.shuke.buttonState&&dsf.config.commonForm.shuke.buttonState.signFontSize||!1,rectWrite:dsf.config.commonForm.shuke.buttonState&&dsf.config.commonForm.shuke.buttonState.rectWrite||!1},secretData:{signKey:dsf.config.commonForm.shuke.secretData&&dsf.config.commonForm.shuke.secretData.signKey,signSecret:dsf.config.commonForm.shuke.secretData&&dsf.config.commonForm.shuke.secretData.signSecret}});h.log("调用数科传的参数",n,dsf.util.getClientName()),"pdf"==i.toLocaleLowerCase()||"ofd"==i.toLocaleLowerCase()?"wechat"==dsf.util.getClientName()?wx.invoke("ext_sySignSdk_startSign",{data:n},function(e){"true"!=e.result||"send"!=JSON.parse(e.data).type&&"back"!=JSON.parse(e.data).type||(t.isShow=!1,t.$bus.emit("iSignatureSend",{act:"send"}))}):$suwell.openSuWell(m()(n),function(e){"send"!==String(e)&&"back"!==String(e)||t.$bus.emit("iSignatureSend",{act:"send"})},function(e){t.no_fileClick=!1,alert("open failed: "+e)}):dsf.layer.toast("该类型的文件不支持签批")}}},function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"bts"},[t.$route.query.method?t._e():e("div",{staticClass:"topBts"},[e("van-button",{attrs:{type:"default"},on:{click:t.getMeeting}},[t._v("会议记录")]),t._v(" "),e("van-button",{attrs:{type:"default"},on:{click:t.endorsement}},[t._v("签批")])],1),t._v(" "),e("van-popup",{style:{height:"270px"},attrs:{position:"bottom",round:""},model:{value:t.showMeeting,callback:function(e){t.showMeeting=e},expression:"showMeeting"}},[e("div",{staticClass:"btsOut"},[e("van-button",{staticClass:"cancelBt",attrs:{type:"default"},on:{click:t.cancelMeeting}},[t._v("取消")]),t._v(" "),e("van-button",{staticClass:"saveBt",attrs:{type:"default"},on:{click:t.saveMeeting}},[t._v("保存")])],1),t._v(" "),e("div",{staticClass:"meetingReco"},[e("add-record",{attrs:{existRec:t.existRec},on:{RecoContent:t.RecoContent}})],1)])],1),t._v(" "),e("div",{staticClass:"wps_office",attrs:{id:"wpsOffice"}})])},[],!1,null,"530a959a",null).exports}}]);