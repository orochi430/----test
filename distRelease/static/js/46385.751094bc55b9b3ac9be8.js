"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[46385,18868],{46385:function(t,e,n){n.r(e),n.d(e,{default:function(){return r}});var a=n(66250),e=n(73473),c=n.n(e),e=n(8450),i=n.n(e),e=n(33453),d=n.n(e),e=n(70680),s=n(18868),o=n(63450),l=n(25108),e={name:"SeparateRead",components:{controlUserTree:e.default,DebounceClick:s.Z,controlUserList:o.default},props:{separateTabs:{type:Array,default:function(){return[]}},formParams:{type:Object,default:function(){return{}}},nowButtonParameters:{type:Object,default:function(){return{}}}},data:function(){return{result:[],resolve:function(){},reject:function(){},isShow1:!1,isShow2:!1,opinionList:[],message:"",optionValue:"",nowList:[],showList1:[],organizeList:[],userList:[],privateData:[],data:{},selectList:[],personSelectData:"",oldV:[],selectArr:[],selectParent:[],selectChild:[],type:0,extra:{multiple:!0,filterSelf:"-1"==dsf.config.setting["SYS-FY-0012"],tabs:[]},tab:"",defaultSelectArray:[],smsContent:""}},created:function(){var n=this;return(0,a.Z)(d().mark(function t(){var e;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getTabs();case 2:e=dsf.config.setting["SYS-FY-0010"]||[],n.separateTabs&&n.separateTabs.length?n.extra.tabs=n.separateTabs:e.length?n.extra.tabs=JSON.parse(e).filter(function(t){return"角色"!=t.name}):n.extra.tabs={multiple:!0,filterSelf:"-1"==dsf.config.setting["SYS-FY-0012"],tabs:[{action:"fn/user/select/data?types=person&rootObject=1&action=self_dept&async=true",name:"本部门",subTabKey:"department"},{action:"fn/user/select/data?types=person&rootObject=1&action=self_org&async=true",name:"本机构",subTabKey:"department"},{name:"群组",action:"fn/user/select/data?types=person,department,post,privateGroup,own_group&rootObject=2&action=private_group&async=true&source=share",subTabKey:"department"}]};case 4:case"end":return t.stop()}},t)}))()},methods:{getTabs:function(){var o=this;return new(c())(function(s,t){try{dsf.http.post("/fn/mobileToRead/mobileShareInfo",{selectedTabs:o.nowButtonParameters.selectedTabs||"",pk:o.formParams.pk,moduleId:o.formParams.moduleId,distribId:o.formParams.distribId||""}).then(function(t){var e,n,a;200==t.data.code&&(dsf.config.setting["SYS-FY-0010"]=i()(t.data.data.tabs),e=/\[(.+?)\]/g,n=t.data.data.fySmsContent,a={"分阅用户":dsf.util.loadSessionStore("user").name,"分阅时间":moment().format("YYYY-MM-DD HH:mm:ss"),"模块名称":o.data.moduleName,"文件标题":o.data.bt,"分阅意见":o.optionValue},n.match(e)&&n.match(e).forEach(function(t){var e=t.replace("[","").replace("]","");a[e]&&(n=n.replace(t,a[e]))}),o.smsContent=n),s()})}catch(t){s()}})},show:function(t,e){var n=this;return this.data=t,this.defaultSelectArray=e,this.getAdvice(),1==this.nowButtonParameters.opinion?this.isShow1=!0:this.isShow2=!0,new(c())(function(t,e){n.resolve=t,n.reject=e})},cancel1:function(){this.isShow1=!1,this.reject("流程被中断")},cancel2:function(){this.isShow2=!1},send:function(){this.isShow2=!0},getAdvice:function(){var e=this;dsf.http.get("fn/mobileUsedOpinion/find").then(function(t){e.opinionList=t.data.rows})},addAdvice:function(){var t=this;""===this.optionValue?dsf.layer.toast("请输入内容"):dsf.http.post("fn/mobileUsedOpinion/add",{__DATA:i()({opinion:this.optionValue})}).then(function(){t.getAdvice()})},deleteAdvice:function(t){var e=this;this.$dialog.confirm({title:"提示",message:"确定要删除吗？"}).then(function(){dsf.http.get("fn/mobileUsedOpinion/delete?id="+t.id).then(function(){e.getAdvice()})})},writeAdvice:function(t){this.optionValue=this.optionValue+t,this.$forceUpdate()},addReadSure:function(i){var r=this;return(0,a.Z)(d().mark(function t(){var n,a,s,o,e;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=a=n="",o=[],i.forEach(function(t,e){e=e?",":"";n+="".concat(e).concat(t.type,"::").concat(t.id),a+=(5==t.type?"".concat(e):"".concat(e).concat(t.attrs.realDeptId||t.pid,"-")).concat(t.id),s+=(5==t.type?"".concat(e):"".concat(e).concat(t.attrs.orgNameLV2Text||t.attrs.orgNameLV1Text,"-")).concat(t.name),5==t.type&&o.push(t.name)}),o.length)return t.next=6,new(c())(function(t,e){dsf.layer.confirm({title:"提示",message:"是否确认分阅给【".concat(o.join(","),"】内所有人员？")},function(){t()})});t.next=6;break;case 6:if(e={infoId:r.data.info_id,userIds:a,userNames:s,schemaVals:n,distribId:r.data.distribId||"",canRedistrib:1,infoType:r.data.infoType||"",infoTypeText:r.data.infoTypeText||"",shareContent:r.optionValue,shareList:"",isSms:r.result.find(function(t){return"isSms"==t})?"1":"-1",smsContent:"",reShare:0,isEndSms:r.result.find(function(t){return"isEndSms"==t})?"1":"-1"},r.data.distribId&&"0"!=r.data.distribId&&(e.reShare=1),""===e.userIds)return dsf.layer.toast("请选择人员"),t.abrupt("return");t.next=11;break;case 11:r.isShow1=!1,r.isShow2=!1,l.log(e),dsf.layer.loading(),dsf.http.post("fn/mobileToReadOperation/toShare",e).then(function(e){dsf.layer.clear(),dsf.layer.toast(e.data.message,!0),r.data.distribId&&"0"!=r.data.distribId&&dsf.config.commonForm.toShareAndRead?dsf.http.post("fn/mobileToReadOperation/readed",{infoIds:r.data.info_id,distribIds:r.data.distribId}).then(function(t){r.resolve(e.data.message)}):r.resolve(e.data.message)});case 16:case"end":return t.stop()}},t)}))()},closePopup:function(){this.$emit("close")}}},r=(0,n(51900).Z)(e,function(){var a=this,t=a._self._c;return t("div",{staticClass:"ds-separate-read"},[t("van-popup",{attrs:{position:"bottom"},on:{closed:a.closePopup},model:{value:a.isShow1,callback:function(t){a.isShow1=t},expression:"isShow1"}},[t("div",{staticClass:"header"},[t("van-nav-bar",{attrs:{title:"分阅意见","left-text":"取消"},on:{"click-left":a.cancel1}})],1),a._v(" "),t("div",{staticClass:"body"},[t("van-field",{attrs:{rows:"4",type:"textarea",placeholder:"请输入分阅意见",autosize:""},model:{value:a.optionValue,callback:function(t){a.optionValue=t},expression:"optionValue"}}),a._v(" "),t("div",{staticClass:"tag-box"},[t("div",{staticClass:"tag-list"},a._l(a.opinionList,function(e,n){return t("div",{key:n,staticClass:"tag-item"},[t("div",{staticClass:"tag-item-text",on:{click:function(t){return a.writeAdvice(e.context)}}},[a._v("\n              "+a._s(e.context)+"\n            ")]),a._v(" "),t("div",{staticClass:"tag-item-bt",on:{click:function(t){return a.deleteAdvice(e,n)}}},[t("van-icon",{attrs:{name:"cross"}})],1)])}),0),a._v(" "),t("van-button",{attrs:{icon:"plus",size:"small",plain:""},on:{click:a.addAdvice}},[a._v("新增模板")])],1),a._v(" "),t("div",{staticClass:"sms-container"},[t("van-checkbox-group",{attrs:{direction:"horizontal"},model:{value:a.result,callback:function(t){a.result=t},expression:"result"}},[t("van-checkbox",{attrs:{name:"isSms"}},[a._v("是否提醒")]),a._v(" "),t("van-checkbox",{attrs:{name:"isEndSms"}},[a._v("阅闭是否提醒")])],1),a._v(" "),t("van-field",{directives:[{name:"show",rawName:"v-show",value:a.result.find(function(t){return"isSms"==t}),expression:"result.find(item => item == 'isSms')"}],attrs:{rows:"4",autosize:"",type:"textarea",placeholder:"请输入提醒内容"},model:{value:a.smsContent,callback:function(t){a.smsContent=t},expression:"smsContent"}})],1)],1),a._v(" "),t("div",{staticClass:"footer"},[t("van-button",{attrs:{type:"theme"},on:{click:a.send}},[a._v("选择人员")])],1)]),a._v(" "),t("van-popup",{ref:"container",style:{height:"100%"},attrs:{position:"bottom","close-on-click-overlay":!1},model:{value:a.isShow2,callback:function(t){a.isShow2=t},expression:"isShow2"}},[t("control-user-list",{attrs:{extra:a.extra,"default-select-array":a.defaultSelectArray},on:{close:a.cancel2,getSelectUser:a.addReadSure}})],1)],1)},[],!1,null,"7e65ecea",null).exports},18868:function(t,e,n){var o=n(25108);const i=(a,s=500,o=!0)=>{let i,r=0,c,d,l=n=>{i=setTimeout(()=>{var t=(new Date).getTime(),e=t-r;e<n?(r=t,l(s-e)):(o||a.apply(c,d),clearTimeout(i),i=null)},n)};return function(){c=this,d=arguments;var t=(new Date).getTime();r=t,i||(o&&a.apply(c,d),l(s))}};e.Z={name:"DebounceClick",functional:!0,render(t,e){var n,a=e.props.time,s=e.props.immediate,e=e.slots().default;return void 0===e?(o.warn("<debounce> 组件必须要有子元素"),null):((e=e[0]||null).data.on&&e.data.on.click?(n=e.data.on.click,n=i(n,a,s),e.data.on.click=n):e.componentOptions&&e.componentOptions.listeners.click&&(n=e.componentOptions.listeners.click,n=i(n,a,s),e.componentOptions.listeners.click=n),e)}}}}]);