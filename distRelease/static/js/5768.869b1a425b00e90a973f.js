"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[5768],{5768:function(o,e,n){n.r(e),n.d(e,{default:function(){return i}});var a=n(13682),t=n(66250),e=n(33453),r=n.n(e),e=n(8450),c=n.n(e),d=n(88561),g=n(62596),u=n(25108),e={name:"zhengzhouLogin",data:function(){return{logname:"",txtpassword:"",loginPadding:"",logoWidth:"",loading:null}},created:function(){window.addEventListener("onorientationchange"in window?"orientationchange":"resize",this.isPortrait,!1),this.isPortrait()},methods:{isPortrait:function(){180===window.screen.orientation.angle||0===window.screen.orientation.angle?this.loginPadding="8vw":90!==window.screen.orientation.angle&&-90!==window.screen.orientation.angle||(this.loginPadding="20vw")},showAppVersion:function(){var o=this;this.clickTime=(new Date).getTime(),setTimeout(function(){(new Date).getTime()-o.clickTime<500&&cordova.getAppVersion.getVersionCode(function(o){dsf.layer.toast("当前APP的版本为：一体化"+o)},function(o){dsf.layer.toast(o)})},500)},showBuildTime:function(){var o=this;this.clickTime=(new Date).getTime(),setTimeout(function(){(new Date).getTime()-o.clickTime<500&&(document.getElementById("appVersion").innerHTML="当前前端APP程序版本为：一体化2024-03-22 18:20")},500)},C2login:function(){var e=this;this.loading=dsf.layer.loading("登录中..."),window.c2.custom.call({action:"loadCertificate",params:{},onSuccess:function(o){o&&""!==o?window.c2.auth.login({type:"userCode",userCode:o,onSuccess:function(o){u.log("C2login_res",o),dsf.layer.closeLoading(e.loading),window.c2.auth.GetUserInfo(function(o){u.log("GetUserInfo",o),d.Z.saveToLocalStore("zzswUserInfo",o),dsf.http.post("fn/zzswMoblieSSOLogin/getUserinfo",{token:o.token}).then(function(o){o=o.data;u.log("FNgetUserinfo",o.data),e.loginSuccessDeal(o.data)})})},onFail:function(o){u.log("C2login_error",o),dsf.layer.toast("C2login登陆失败！",!1)}}):(u.log("c2.custom.call_result",o),dsf.layer.toast("未获取到code",!1))},onFail:function(o){u.log("c2.custom.call_error",o),dsf.layer.toast("c2.custom.call登陆失败！",!1)}})},login:function(){var l=this;return(0,t.Z)(r().mark(function o(){var e,n,t,a,i,s;return r().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(l.logname&&l.txtpassword){o.next=3;break}return dsf.layer.toast("请填写账号密码"),o.abrupt("return");case 3:l.loading=dsf.layer.loading("登陆中..."),t={},a=n="","OA"==(e=l).$route.query.loginType?((i=d.Z.loadLocalStore("user")?d.Z.loadLocalStore("user").autoToken:"")&&dsf.config.login.tokenAutologin&&l.checked?n="/fn/mobileAuth/autoByToken?autoToken=".concat(i,"&uuid=").concat(e.DeviceId,"&brand=").concat(e.DeviceName):(a="user",n=dsf.config.login.specialLoginUrl||"/fn/mobileAuth/login",i=l.txtpassword,s=l.logname,t={__DATA:c()({logname:s,password:i,device_id:"postman",device_desc:"postman"})}),dsf.http.post(n,t).then(function(o){d.Z.saveToLocalStore("lastLoginType",a),1==o.data.rcode?(d.Z.saveToLocalStore("uid",g.Z.encode(e.logname)),d.Z.saveToLocalStore("pid",g.Z.encode(e.txtpassword)),d.Z.saveToLocalStore("autoLogin",e.checked),d.Z.saveToLocalStore("userName",g.Z.encode(e.logname)),d.Z.saveToLocalStore("passWord",g.Z.encode(e.txtpassword)),o=o.data,e.loginSuccessDeal(o)):(dsf.layer.toast("登录接口异常，请联系系统管理员！"),dsf.layer.closeLoading(e.loading))}).error(function(o){dsf.layer.closeLoading(e.loading),o.message.includes("404")&&dsf.layer.toast("登录接口异常，请联系系统管理员！")})):window.c2.auth.login({type:"pwd",account:e.logname,pwd:e.txtpassword,onSuccess:function(o){u.log("login_res",o),dsf.layer.closeLoading(e.loading),window.c2.auth.GetUserInfo(function(o){u.log("GetUserInfo",o),d.Z.saveToLocalStore("zzswUserInfo",o),dsf.http.post("fn/zzswMoblieSSOLogin/getUserinfo",{token:o.token}).then(function(o){o=o.data;u.log("FNgetUserinfo",o.data),e.loginSuccessDeal(o.data)})})},onFail:function(o){u.log("login_error",o),dsf.layer.toast("c2.auth.login登陆失败，请联系系统管理员！"),dsf.layer.closeLoading(e.loading)}});case 9:case"end":return o.stop()}},o)}))()},loginSuccessDeal:function(o){var e=o.data;d.Z.saveToSessionStore("user",e),d.Z.saveToSessionStore("loginToken",e.auth.token),d.Z.saveToLocalStore("loginToken",e.auth.token),d.Z.saveToLocalStore("user",e),d.Z.saveToLocalStore("loginData",o),1!=dsf.config.setting["SYS-MOBILE-0002"]||e.mobile?"OA"==self.$route.query.loginType&&this.toNext():this.changeLoginType("setPhone")},toNext:function(){var n=this,e=d.Z.loadSessionStore("user"),t=d.Z.loadLocalStore("loginData");d.Z.logIn(function(){var o=e.user_id;u.log("Client",d.Z.getClientName()),u.log("shkt",t.shkt,1==t.shkt),"app"==d.Z.getClientName()&&1==t.shkt?(u.log("xsfCommon"),xsfCommon.bsCaLogin("",function(o){var e=JSON.parse(o).result;u.log("bsCaLogin",o,(0,a.Z)(o)),1==e&&n.goUrl()},function(o){u.log("bsCaLogin",o,(0,a.Z)(o)),dsf.layer.toast(err)})):dsf.config.login.loginSaveUUID?(o="fn/sso/devicesave?DeviceId="+n.DeviceId+"&DeviceName="+n.DeviceName+"&userId="+o,dsf.http.get(o).then(function(o){n.goUrl()}).catch(function(o){dsf.layer.toast(o.message)})):n.goUrl()})},goUrl:function(){var o=this;dsf.layer.closeLoading(self.loading),dsf.layer.toast("登录成功!",!0),setTimeout(function(){dsf.config.login.defaultUrl?o.$router.replace(dsf.config.login.defaultUrl):o.$router.replace("/zhengzhouIndex")},800)}},beforeDestroy:function(){window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",this.isPortrait(),!1)}},i=(0,n(51900).Z)(e,function(){var e=this,o=e._self._c;return o("div",{staticClass:"zhengzhouLogin",style:{padding:"0 ".concat(e.loginPadding)}},[e._m(0),e._v(" "),o("div",{staticClass:"form"},[o("van-field",{staticClass:"logname loginInput",attrs:{name:"账号",placeholder:"请输入账号",center:""},scopedSlots:e._u([{key:"left-icon",fn:function(){return[o("img",{staticClass:"loginIcon",attrs:{src:"static\\images\\project\\zhengzhou\\zh.png",alt:""},on:{click:function(o){return e.showAppVersion()}}})]},proxy:!0}]),model:{value:e.logname,callback:function(o){e.logname=o},expression:"logname"}}),e._v(" "),o("van-field",{staticClass:"loginInput",attrs:{type:"password",name:"密码",placeholder:"请输入密码",center:""},scopedSlots:e._u([{key:"left-icon",fn:function(){return[o("img",{staticClass:"loginIcon",attrs:{src:"static\\images\\project\\zhengzhou\\mima.png",alt:""},on:{click:function(o){return e.showBuildTime()}}})]},proxy:!0}]),model:{value:e.txtpassword,callback:function(o){e.txtpassword=o},expression:"txtpassword"}})],1),e._v(" "),o("div",{staticClass:"btn"},[o("button",{attrs:{"native-type":"submit"},on:{click:e.login}},[e._v("密码登录")]),e._v(" "),o("button",{on:{click:e.C2login}},[e._v("一键登录")])])])},[function(){var o=this,e=o._self._c;return e("div",{staticClass:"header"},[e("span",{staticClass:"line"}),o._v(" "),e("span",{staticClass:"text"},[o._v("市委内网综合办公平台")]),o._v(" "),e("span",{staticClass:"line"})])}],!1,null,"df20c48a",null).exports}}]);