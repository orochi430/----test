"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[84669],{84669:function(t,e,a){a.r(e),a.d(e,{default:function(){return l}});var e={name:"timePicker",props:{touchable:{type:Boolean,default:!0,desc:"能否手动滑动切换"},clickMode:{type:String,default:"month",desc:"切换按钮的切换模式 可选month/week"},endSliderCallBack:{type:Function,default:function(){return!1},desc:"自定义滑动完成之后触发的回调函数"},defaultDate:{type:String,default:moment().format("YYYY-MM-DD"),desc:"传入的时间 格式为2020-01-01这样"},activeBgcolor:{type:String,default:"#35c",desc:"选中日期的背景颜色"},activeTextcolor:{type:String,default:"#FFF",desc:"选中日期的文字颜色"},todayDotcolor:{type:String,default:"#35c",desc:"当前日期下小点的颜色"},havaSch:{type:Array,default:function(){return[]}},startNumber:{type:Number,default:1,desc:"日期从星期几开始,默认为1表示星期一开始到星期天,取值范围1-7"},language:{type:String,default:"ch",desc:"显示的文字是英语还是汉字,能结合startNumber来自动偏移"},cancelChecked:{type:Boolean,default:!1}},data:function(){return{prev_now_next:[],currentIndex:1,weekLanguages:{},checkedDate:""}},computed:{},watch:{cancelChecked:function(t){t&&(this.checkedDate="")}},created:function(){this.initTimer(this.defaultDate)},mounted:function(){},methods:{initTimer:function(t){for(var e in this.checkedDate="",this.weekLanguages={ch:["一","二","三","四","五","六","日"],en:["Mon","Tue","Wed","Thur","Fri","Sat","Sun"],pos:[1,2,3,4,5,6,7]},this.weekLanguages)this.weekLanguages[e]=this.weekLanguages[e].slice(this.startNumber-1).concat(this.weekLanguages[e].slice(0,this.startNumber-1));for(var a=0;a<3;a++)this.prev_now_next.push(this.getWeekInfo(moment(t).add(7*a-7,"d").format("YYYY-MM-DD")));this.$emit("thisWeek",this.prev_now_next[1])},getWeekInfo:function(t){for(var e=Number(moment(t).format("E")),a=[],s=moment(),i=(moment(this.defaultDate),0);i<7;i++){var n=moment(t).subtract(this.weekLanguages.pos.indexOf(e)-i,"d");a.push({date:n.format("YYYY-MM-DD"),isToday:s.format("YYYY-MM-DD")===n.format("YYYY-MM-DD"),week:this.weekLanguages[this.language][i]})}return a},addSch:function(t){return-1!=this.havaSch.indexOf(t)},dateClick:function(t){t.date==this.checkedDate?this.checkedDate="":this.checkedDate=t.date,this.$emit("checkedDate",this.checkedDate)},judgeChecked:function(t){return t==this.checkedDate},prevClick:function(){var t;"week"==this.clickMode?this.$refs.swiperCon.prev():"month"==this.clickMode&&(t=moment(this.prev_now_next[1][0].date).subtract(1,"months").format("YYYY-MM-DD"),this.prev_now_next=[],this.initTimer(t))},nextClick:function(){var t;"week"==this.clickMode?this.$refs.swiperCon.next():"month"==this.clickMode&&(t=moment(this.prev_now_next[1][0].date).add(1,"months").format("YYYY-MM-DD"),this.prev_now_next=[],this.initTimer(t))},getYearMonth:function(t){return t.split("-")[0]+"年"+t.split("-")[1]+"月"},onChange:function(t){this.checkedDate="",0==t?(this.prev_now_next.unshift(this.getWeekInfo(moment(this.prev_now_next[t][0].date).subtract(7,"d").format("YYYY-MM-DD"))),this.prev_now_next.pop()):2==t&&(this.prev_now_next.push(this.getWeekInfo(moment(this.prev_now_next[t][0].date).add(7,"d").format("YYYY-MM-DD"))),this.prev_now_next.shift()),this.$emit("thisWeek",this.prev_now_next[1]),this.endSliderCallBack&&dsf.isFunction(this.endSliderCallBack)&&this.endSliderCallBack()}}},s=a(51900),e=(0,s.Z)(e,function(){var a=this,s=a._self._c;return s("div",{staticClass:"week-slider"},[s("div",{staticClass:"slider-title"},[s("i",{staticClass:"icon iconfont iconln_jiantouzuo",class:{"title-icon-active":!0},on:{click:function(t){return a.prevClick()}}}),a._v(" "),s("span",[a._v(a._s(a.getYearMonth(a.prev_now_next[1][0].date)))]),a._v(" "),s("i",{staticClass:"icon iconfont iconln_jiantouyou",class:{"title-icon-active":!0},on:{click:function(t){return a.nextClick()}}})]),a._v(" "),s("div",{staticClass:"slider-content"},[s("van-swipe",{ref:"swiperCon",staticClass:"my-swiper",attrs:{touchable:a.touchable,"initial-swipe":a.currentIndex,loop:!1,"show-indicators":!1},on:{change:a.onChange}},a._l(a.prev_now_next,function(t){return s("van-swipe-item",{key:t[0].date},[s("div",{staticClass:"date-box"},[s("div",{staticClass:"lang-box"},a._l(t,function(e,t){return s("div",{key:t,staticClass:"day-of-week"},[s("div",{staticClass:"day-title"},[a._v(a._s(e.week))]),a._v(" "),s("div",{staticClass:"day-date",class:{active:a.judgeChecked(e.date)},on:{click:function(t){return a.dateClick(e)}}},[s("span",[a._v(a._s(e.date.split("-")[2]))]),a._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:a.addSch(e.date),expression:"addSch(item.date)"}],staticClass:"day-dot",class:{"has-sch":a.addSch(e.date)&&!a.judgeChecked(e.date)},style:{background:a.addSch(e.date)&&a.judgeChecked(e.date)?a.todayDotcolor:""}})])])}),0)])])}),1)],1)])},[],!1,null,"0f356f32",null).exports,i=a(5044),n=a(18428),c=a.n(n),o=a(25108),n={name:"ScheduleList",props:{tabIndx:[String,Number],selectedDate:String,week:Array,hasSch:{type:Array,default:function(){return[]}}},data:function(){return{finished:!1,loading:!1,refreshing:!1,class:null,allClass:null,list:[],pageConfig:{pageNum:1,pageSize:20},screenHeight:"auto",previewUrl:"",hasRefresh:!0,types:["personal","leader"]}},computed:{},watch:{tabIndx:function(t){this.initfn(this.week[0].date,this.week[6].date)},selectedDate:function(t){this.initfn(t,t)},week:function(t){this.initfn(t[0].date,t[6].date)}},created:function(){o.log(this.tabIndx)},methods:{onLoad:function(t){},goForm:function(t,e){t.sourceInfoId&&t.sourceModuleId?this.$router.push({name:"commonForm",params:{pk:t.sourceInfoId,moduleId:t.sourceModuleId}}):this.$router.push({name:"commonForm",params:{pk:t.agendaId,moduleId:t.moduleId},query:{listId:"201203170900xK9BmlEYInRncNI7K81"}})},initfn:function(t,e){this.$user||(this.$user=dsf.util.loadSessionStore("user")),this.$user||dsf.util.loadSessionStore("user")?(t||e)&&(o.log(this.$user),t={sdate:t,edate:e,unitId:this.$user.unitId,requestEnv:"mobile",MODULE_ID:"180719094152MnF6C2hEPtqIvhjJIxo",type:"personal",leaderId:0,dept:""},1===this.tabIndx&&(t=c()(t,{MODULE_ID:"191104202027u8LzPuGjn5qwqvmn9B0",type:"leader"})),this.loadData(t)):this.dsf.layer.toast("用户丢了, 快去登录")},loadData:function(e){var t,s=this;this.list=[],this.loading=!0,this.finished=!1,o.log(this.tabIndx,e),t=this.tabIndx?"fn/ldrc/unit/getMobileWeekData":"fn/scheduleList/queryMobileData","xzd"==dsf.config.projectName&&(t="fn/workSchedule/getNewWeekDataNew"),this.dsf.http.post(t,e).then(function(t){var a;"success"===t.data.type?(t=t.data.data,a=[],t.forEach(function(e){var t;e.schedule&&0<e.schedule.length&&(a.push(e.date),e.schedule.map(function(t){t.date=moment(e.date).format("MM-DD"),t.sdate=e.date,t.edate=e.date}),(t=s.list).push.apply(t,(0,i.Z)(e.schedule)))}),e.sdate!==e.edate&&s.$emit("update:hasSch",a),s.refreshing=!1,s.finished=!0,s.loading=!1):(s.finished=!0,s.dsf.layer.toast("数据请求失败，请稍后再试"))}).catch(function(t){s.finished=!0,o.log("接口请求失败 错误码:".concat(t))}).always(function(){s.refreshing=!1,s.loading=!1,0==s.list.length&&(s.screenHeight=document.documentElement.clientHeight-180)})}}},n=(0,s.Z)(n,function(){var a=this,s=a._self._c;return s("div",{staticClass:"ds_funList"},[s("div"),a._v(" "),s("van-list",{ref:"list",staticClass:"list_wrap",attrs:{finished:a.finished,"immediate-check":!1,offset:10},on:{load:a.onLoad},model:{value:a.loading,callback:function(t){a.loading=t},expression:"loading"}},[0<a.list.length?s("div",{staticClass:"item_box",attrs:{slot:"default"},slot:"default"},a._l(a.list,function(e,t){return s("div",{key:t,staticClass:"item flex jb"},[s("div",{staticStyle:{width:"100%"},on:{click:function(t){return a.goForm(e,a.tabIndx)}}},[s("div",{staticClass:"title van-ellipsis"},[s("span",{staticClass:"point"}),a._v(" "),s("span",[a._v(a._s(e.date)+" "+a._s(e.time)+" "+a._s(e.content))])]),a._v(" "),s("div",{staticClass:"info_box fontcolor flex fontsmallSize jb"},[s("div",{staticClass:"teacher van-multi-ellipsis--l2"},[s("span",[a._v(a._s(e.attendant))])]),a._v(" "),s("div",{staticClass:"location"},[s("span",[a._v(a._s(e.place))])])])])])}),0):a._e()]),a._v(" "),0==a.list.length&&a.finished?s("commonempty"):a._e()],1)},[],!1,null,null,null).exports,d=a(25108),l=(0,s.Z)({name:"ScheduleCenter",components:{ScheduleList:n,timePicker:e},data:function(){return{tab_box:{activeIdx:0,listNum_0:0,listNum_1:0},endSliderCallBack:null,activeBgcolor:"#FF6A00",activeTextcolor:"#FFFFFF",todayDotcolor:"#FFFFFF",startNumber:1,clickMode:"month",cancelChecked:!1,havaSch:[],listData:[],notHavedata:!1,selectedDate:null,week:[]}},mounted:function(){},created:function(){d.log(this.selectedDate)},methods:{onClick:function(t,e){this.tab_box.activeIdx=t,this.cancelChecked=!0,this.selectedDate=""},thisWeek:function(t){this.week=t},checkedDate:function(t){this.cancelChecked=!1,this.selectedDate=t},toaddScheduleAdd:function(){dsf.config.scheduleCenter.isCommonList?this.$router.push({path:"/commonForm/".concat(dsf.config.scheduleCenter.commonListModuleId)}):"xzd"==dsf.config.projectName?this.$router.push({path:"/commonForm/180719094152MnF6C2hEPtqIvhjJIxo"}):this.$router.push({path:"/scheduleAdd"})}}},function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-schedule"},[t("div",{staticClass:"tab_box"},[t("van-sticky",{staticClass:"sticky"},[t("van-tabs",{on:{click:e.onClick},model:{value:e.tab_box.activeIdx,callback:function(t){e.$set(e.tab_box,"activeIdx",t)},expression:"tab_box.activeIdx"}},[t("van-tab",{attrs:{title:"unevalNum"}},[t("div",{staticClass:"tab_title",attrs:{slot:"title"},slot:"title"},[e._v("个人日程")]),e._v(" "),t("div",{staticClass:"tab_content",attrs:{slot:"default"},slot:"default"})]),e._v(" "),t("van-tab",{attrs:{title:"evalNum"}},[t("div",{staticClass:"tab_title",attrs:{slot:"title"},slot:"title"},[e._v("领导日程")]),e._v(" "),t("div",{staticClass:"tab_content",attrs:{slot:"default"},slot:"default"})])],1),e._v(" "),t("time-picker",{attrs:{"end-slider-call-back":e.endSliderCallBack,"active-bgcolor":e.activeBgcolor,"active-textcolor":e.activeTextcolor,"today-dotcolor":e.todayDotcolor,"start-number":e.startNumber,"click-mode":e.clickMode,"hava-sch":e.havaSch,"cancel-checked":e.cancelChecked},on:{"update:havaSch":function(t){e.havaSch=t},"update:hava-sch":function(t){e.havaSch=t},thisWeek:e.thisWeek,checkedDate:e.checkedDate}})],1),e._v(" "),t("schedule-list",{ref:"list",attrs:{week:e.week,"has-sch":e.havaSch,"selected-date":e.selectedDate,"tab-indx":e.tab_box.activeIdx},on:{"update:hasSch":function(t){e.havaSch=t},"update:has-sch":function(t){e.havaSch=t}}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0===e.tab_box.activeIdx,expression:"tab_box.activeIdx === 0"}],staticClass:"add",on:{click:e.toaddScheduleAdd}},[t("van-icon",{attrs:{name:"plus"}})],1)],1)])},[],!1,null,"4b2d1786",null).exports}}]);