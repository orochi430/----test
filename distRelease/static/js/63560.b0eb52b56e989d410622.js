"use strict";(self.webpackChunkxianzhengding=self.webpackChunkxianzhengding||[]).push([[63560],{63560:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var t=n(8450),i=n.n(t),t=n(27921),o=n.n(t),t=n(85579),a=n.n(t),t=n(22013),l=n.n(t),r=n(25108),t={name:"addTree",props:["personSelectData","type"],data:function(){return{isHidden:!1}},created:function(){this.isHidden=void 0,window.GLOBAL.ParentNode=[],window.GLOBAL.personAddList=[]},mounted:function(){},watch:{},methods:{recursionChecked:function(e,t){var n=this;e.children.forEach(function(e){e.checked=t,e.children&&0<e.children.length&&n.recursionChecked(e,t)})},checkAll:function(n){n.children&&0<n.children.length?(this.$set(n,"isopen",!n.isopen),n.isopen?(window.GLOBAL.ParentNode.push(n),n.checked?n.children.forEach(function(e){e.checked=!0}):n.children.forEach(function(e){e.checked=!1})):window.GLOBAL.ParentNode.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.ParentNode.splice(t,1)})):(n.checked?(this.$delete(n,"checked"),this.$set(n,"checked",!1)):(this.$delete(n,"checked"),this.$set(n,"checked",!0)),this.userClick(n))},selectAll:function(e){this.$emit("select",e)},getStyle:function(e){return{"padding-left":"30px","box-sizing":"border-box"}},itemClick:function(e){this.$set(e,"checked",!e.checked),r.log(e)},userClick:function(n){var i=this,s=this,e=("0"==window.GLOBAL.selectType&&n.children&&0<!n.children.length&&s.$set(n,"checked",!n.checked),r.log(n),window.GLOBAL.personMultiple?n.checked?(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.push(n),this.recursionChecked(n,!0)),window.GLOBAL.personAddList.push(n)):(n.children&&0<n.children.length&&(window.GLOBAL.ParentNode.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.ParentNode.splice(t,1)}),this.recursionChecked(n,!1)),window.GLOBAL.personAddList.forEach(function(e,t){e.showName==n.showName&&window.GLOBAL.personAddList.splice(t,1)})):n.checked?(window.GLOBAL.personAddList.forEach(function(e){s.$set(e,"checked",!1)}),window.GLOBAL.personAddList=[],window.GLOBAL.personAddList.push(n)):window.GLOBAL.personAddList.forEach(function(e,t){s.$set(e,"checked",!1),e.showName==n.showName&&window.GLOBAL.personAddList.splice(t,1)}),window.GLOBAL.personAddList),c={},e=e.reduce(function(e,t){return c[t.id]||(c[t.id]=e.push(t)),e},[]);e.forEach(function(e){1<e.id.split("_").length&&e.id.split("_")[1]&&(e.id=e.id.split("_")[1],e.pid=e.pid.split("_")[1],e.children)&&0<e.children.length&&e.children.forEach(function(e){e.id=1<e.id.split("_").length?e.id.split("_")[1]:e.id.split("_")[0],e.pid=(e.pid.split("_").length,e.pid.split("_")[1])})}),window.GLOBAL.personAddList=e,r.log("选中的父节点",window.GLOBAL.ParentNode),window.GLOBAL.ParentNode.forEach(function(e){var t=e.children.find(function(e){return 1==e.checked}),n=e.children.find(function(e){return 0==e.checked});null==t&&(i.$delete(e,"checked"),i.$set(e,"checked",!1)),null==n&&(i.$delete(e,"checked"),i.$set(e,"checked",!0))}),this.$emit("select",e),this.$forceUpdate()}}},s=n(51900),t=(0,s.Z)(t,function(){var i=this,s=i._self._c;return s("div",{staticClass:"dsf-tree",staticStyle:{width:"100%"}},i._l(i.personSelectData,function(n,e){return s("div",{key:"index1"+e,staticStyle:{overflow:"hidden"}},[s("div",{staticClass:"flex-box tree_line"},[n.attrs.noselect?i._e():s("van-checkbox",{ref:"check",refInFor:!0,attrs:{"icon-size":"18px"},on:{click:function(e){return i.userClick(n)}},model:{value:n.checked,callback:function(e){i.$set(n,"checked",e)},expression:"item.checked"}}),i._v(" "),s("div",{staticClass:"tree_tit",on:{click:function(e){return i.checkAll(n)}}},[s("span",{class:{tit_width:0<!n.children.length}},[i._v(i._s(n.showName))])]),i._v(" "),0<n.children.length?s("div",{staticClass:"isShowChiled",on:{click:function(e){return i.checkAll(n)}}},[n.isopen?s("van-icon",{attrs:{name:"arrow-up"}}):s("van-icon",{attrs:{name:"arrow-down"}}),i._v(" "),s("span",{staticClass:"r_span"},[i._v(i._s(n.isopen?"收起":"展开"))])],1):i._e()],1),i._v(" "),i._l(n.children,function(t,e){return s("div",{key:"index2"+e,style:{display:n.isopen?"block":"none"}},[1==t.type?s("div",{staticClass:"person",style:{"padding-left":"30px"},on:{click:function(e){return i.userClick(t)}}},[s("div",{staticClass:"flex-box person_child"},[s("van-checkbox",{staticClass:"child_check",attrs:{"icon-size":"16px"},model:{value:t.checked,callback:function(e){i.$set(t,"checked",e)},expression:"cell.checked"}}),i._v(" "),i._m(0,!0),i._v(" "),s("div",{staticClass:"username"},[i._v(i._s(t.showName))])],1)]):i._e(),i._v(" "),1!=t.type?s("div",{style:i.getStyle(n.deep)},[s("add-tree",{attrs:{personSelectData:[t]},on:{select:i.selectAll}})],1):i._e()])})],2)}),0)},[function(){var e=this._self._c;return e("div",{staticClass:"user-logo"},[e("i",{staticClass:"icon iconfont iconyonghu"})])}],!1,null,"730b1cd7",null).exports,c=n(18868),d=n(25108);function h(e,t){var n,i,s,c,r=void 0!==a()&&e[l()]||e["@@iterator"];if(r)return i=!(n=!0),{s:function(){r=r.call(e)},n:function(){var e=r.next();return n=e.done,e},e:function(e){i=!0,s=e},f:function(){try{n||null==r.return||r.return()}finally{if(i)throw s}}};if(Array.isArray(e)||(r=function(e,t){var n;if(e)return"string"==typeof e?u(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?o()(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),c=0,{s:t=function(){},n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var n={name:"DsfSelectPerson",components:{addTree:t,DebounceClick:c.Z},props:["type","extra"],data:function(){return{show:!0,selectList:[],personSelectData:"",oldV:[],param:{allowEdit:!1,containUnit:"-1",data:"",displayFullPath:"-1",fullOrganize:!1,key:"C-RC-0008",multiple:!0,roles:"",rootObject:"2",schema:"",separator:",",tabs:[{key:"self_org",list:[{key:"department",name:"本机构"}],name:"本单位"}],title:"选择参与人员",type:"userselect",types:["person","department","post"],typesString:"person,department,post",value:""},selectArr:[],selectper:[]}},created:function(){var e;window.GLOBAL={},this.extra&&"{}"!=i()(this.extra)&&(d.log(this.extra),e=this.extra,this.param.tabs[0].key=e.tabs[0].key,e.typesString&&(this.param.typesString=e.typesString),e.rootObject&&(this.param.rootObject=e.rootObject),this.param.multiple=e.multiple),d.log(this.param,this.type),this.getPersonList(this.param),window.GLOBAL.selectType=this.type},mounted:function(){},methods:{getPersonList:function(e){var t=dsf.layer.loading("获取中"),n=(window.GLOBAL.personMultiple=e.multiple,this),i=n.extra.customAction||"self_org",s={action:i,types:e.typesString,rootObject:e.rootObject,async:!1};this.extra&&this.extra.customRoot&&(s.customRoot=this.extra.customRoot),1==this.type?s={action:i,types:"department",rootObject:e.rootObject,async:!1}:3==this.type&&(s={action:"self_org",types:"org,department",rootObject:1,async:!1}),dsf.http.post("fn/user/select/data",s).then(function(e){e.data.data.departmentList.forEach(function(e){n.addPersonDeep(e,1)}),n.personSelectData=e.data.data.departmentList,n.personSelectData[0].children.forEach(function(e){e.checked=!1}),d.log("人员选择控件",n.personSelectData)}).finally(function(){n.$nextTick(function(){dsf.layer.closeLoading(t)})})},addPersonDeep:function(e,t){var n=this;this.$set(e,"deep",t),this.$set(e,"isopen",t<=1),e.children&&0<e.children.length&&e.children.forEach(function(e){n.addPersonDeep(e,t+1)})},filterSelect:function(e,i){var t=this;e.forEach(function(n){n.children&&0<n.children.length?t.filterSelect(n.children,i):n.checked?i.push(n):i.forEach(function(e,t){e.showName==n.showName&&i.splice(t,1)})})},addPerson:function(){var e,t,n=[],i=[],s=[],c=(this.selectArr=[],this.filterSelect(this.selectList,this.selectArr),{}),r=(this.selectArr=this.selectArr.reduce(function(e,t){return c[t.id]||(c[t.id]=e.push(t)),e},[]),h(this.selectArr));try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(o.showName),i.push(o.attrs.idValue),s.push(o.type+"::"+o.attrs.idValue)}}catch(e){r.e(e)}finally{r.f()}e=n.join(","),i.join(","),s.join(","),this.person=e,this.show=!1,this.oldV=this.selectList,this.$emit("getSelectUser",this.selectArr),this.cancePerson(),d.log("最终选择=====>",this.selectArr)},cancePerson:function(){this.$emit("cancePerson")},getSelect:function(e){for(var t in this.selectList=[],e)this.selectList.push(e[t]);d.log(this.selectList)},userClick:function(e){this.$refs.addTree.userClick(e)}}},p=(0,s.Z)(n,function(){var e=this,t=e._self._c;return t("div",{staticClass:"dsf-select-person"},[t("div",{staticClass:"_add_tree"},[t("add-tree",{ref:"addTree",attrs:{personSelectData:e.personSelectData,type:e.type},on:{select:e.getSelect}})],1),e._v(" "),t("van-tabbar",{attrs:{placeholder:""}},[t("van-tabbar-item",{staticClass:"_btns"},[t("debounce-click",[t("van-button",{attrs:{type:"default"},on:{click:e.cancePerson}},[e._v("取消")])],1),e._v(" "),t("debounce-click",[t("van-button",{attrs:{type:"info"},on:{click:e.addPerson}},[e._v("确定")])],1)],1)],1)],1)},[],!1,null,"80fdb426",null).exports}}]);