/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[63],{505:function(t,e,a){var s=a(635);"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var o=a(19).default;o("1322b418",s,!0,{sourceMap:!1,shadowMode:!1})},634:function(t,e,a){"use strict";a(505)},635:function(t,e,a){"use strict";a.r(e)},989:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"page",staticClass:"ds-platform-userhome"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.blocks.loading,expression:"blocks.loading"}],staticClass:"content-div block-box"},t._l(t.blocks.info,(function(e,s){return a("div",{key:s},[a("div",[t._v(t._s(e.text))]),a("span",{staticClass:"count-to"},[t._v(t._s(t.blocks.data[e.code]||0))])])})),0),a("div",{staticClass:"has-row-children"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.userRole.loading,expression:"userRole.loading"}],staticClass:"content-div"},[a("div",{staticClass:"title"},[t._v("角色授权用户")]),a("div",{staticClass:"content chart-box"},[t.userRole.loading||t.userRole.chart.xAxis[0].data.length?a("DsfPlatformBar",{ref:"chartBar",attrs:{chart:t.userRole.chart}}):a("dsf-empty-data")],1)]),a("div",{staticClass:"content-div user-data"},[a("div",{staticClass:"title"},[t._v("用户状态分布")]),a("div",{staticClass:"content"},[t.userState.loading||t.userState.chart.series[0].data.length?a("DsfPlatformPie",{ref:"chartPie",attrs:{chart:t.userState.chart}}):a("dsf-empty-data")],1)])]),a("div",{staticClass:"has-row-children"},[a("div",{staticClass:"content-div line"},[a("div",{staticClass:"title"},[t._v(" 用户访问量 "),a("div",{staticClass:"filter-bar"},[a("el-form",{ref:"form",attrs:{model:t.userPv}},[a("el-radio-group",{attrs:{size:"small"},model:{value:t.userPv.date,callback:function(e){t.$set(t.userPv,"date",e)},expression:"userPv.date"}},[a("el-radio-button",{attrs:{label:"week"}},[t._v("近一周")]),a("el-radio-button",{attrs:{label:"month"}},[t._v("近一月")]),a("el-radio-button",{attrs:{label:"year"}},[t._v("近一年")])],1)],1)],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.userPv.loading,expression:"userPv.loading"}],staticClass:"content"},[t.userPv.loading||t.userPv.chart.series[0].data.length?a("DsfPlatformPolyline",{ref:"userPv",attrs:{chart:t.userPv.chart}}):a("dsf-empty-data")],1)]),a("div",{staticClass:"content-div list"},[a("div",{staticClass:"title"},[t._v("警告危险行为"),a("i",{staticClass:"iconfont",on:{click:t.openPage}},[t._v("更多")])]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.list.loading,expression:"list.loading"}],staticClass:"content"},[t._m(0),a("DsfVirtualScroll",{attrs:{"scroll-y":""}},[t._l(t.list.data,(function(e,s){return a("div",{key:s,staticClass:"tr"},[a("span",{attrs:{title:e.userName}},[t._v(t._s(e.userName))]),a("span",{attrs:{title:e.type}},[t._v(t._s(e.type))]),a("span",{attrs:{title:e.desc}},[t._v(t._s(e.desc))])])})),t.list.loading||t.list.data.length?t._e():[a("dsf-empty-data")]],2)],1)])])])},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"th-box"},[a("span",[t._v("用户")]),a("span",[t._v("类型")]),a("span",[t._v("行为")])])}],r=a(8),i=a.n(r),l={name:"DsfPlatformUserHome",data:function(){var t=this;return{blocks:{info:[{text:"机构数量",code:"unitCount"},{text:"用户数量",code:"userCount"},{text:"在线用户数",code:"userOnlineCount"},{text:"近30天警告行为（人次）",code:"userWarningCount"},{text:"近30天危险行为（人次）",code:"userDangerCount"}],data:{},loading:!0},userRole:{loading:!0,chart:{dataZoom:[{type:"slider",show:!1,orient:"horizontal",backgroundColor:"#fff",right:"8",left:"8",top:"auto",bottom:0,fillerColor:"rgba(66,143,220,0.4)",borderColor:"#D4D1D1",showDetail:!1,showDataShadow:!0,height:15,endValue:"",startValue:""}],series:[{type:"bar",name:"角色授权用户",yAxisIndex:0,xAxisIndex:0,label:{show:!1},itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}],global:!1},barBorderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#2378f7"},{offset:.5,color:"#2378f7"},{offset:1,color:"#83bff6"}],global:!1}}},barGap:"10%",barCategoryGap:"20%",barWidth:"20",showBackground:!1,data:[]}],tooltip:{trigger:"axis",formatter:function(t){var e=""===t[0].data?"暂无":t[0].data;return'<div class="chart-pop"><div class="pop-title">'+t[0].name+"</div><div><span>"+t[0].marker+"角色授权</span><span>"+e+"人</span></div>"}},title:{text:"人",textStyle:{fontSize:12,color:"#CBD4DF"}},legend:{show:!1},grid:{left:0,top:30,right:0,bottom:40,containLabel:!0},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#CBD4DF"}},axisTick:{show:!1,alignWithLabel:!1},axisLabel:{show:!0,fontSize:12,color:"#424752"},splitLine:{show:!1},data:[]}],yAxis:[{type:"value",axisLine:{show:!0,lineStyle:{color:"#CBD4DF"}},axisTick:{show:!1},axisLabel:{show:!0,fontSize:12,rotate:0,color:"#CBD4DF"},splitLine:{show:!0}}]}},userState:{chart:{legend:{orient:"vertical",right:50,top:20,bottom:20,formatter:function(e){return e+"："+t.userState.textObj[e]+"人"}},series:[{type:"pie",selectedMode:"single",radius:"60%",center:["30%","50%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:"{b}\n{d}%"},itemStyle:{normal:{color:function(t){return["#6B93E2","#8195BA","#F0C23B","#EB7E65","#77CCED","#64D6A8"][t.dataIndex]}}}}]},loading:!0,textObj:{}},list:{loading:!0,data:[]},userPv:{loading:!0,date:"month",chart:{dataZoom:[{type:"slider",show:!0,orient:"horizontal",backgroundColor:"#fff",right:"8",left:"8",top:"auto",bottom:0,fillerColor:"rgba(66,143,220,0.4)",borderColor:"#D4D1D1",showDetail:!1,showDataShadow:!0,height:15,endValue:"",startValue:""}],tooltip:{trigger:"axis",formatter:function(t){var e="用户访问量",a="人";return'<div class="chart-pop"><div class="pop-title">'+t[0].name+"</div><div><span>"+t[0].marker+e+"</span><span>"+t[0].data+a+"</span></div>"}},series:[{type:"line",symbol:"circle",symbolSize:4,showSymbol:!0,connectNulls:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(106,179,255,1)"},{offset:1,color:"rgba(106,179,255,0)"}],global:!1}},itemStyle:{color:"rgba(106, 179, 255, 1)"},data:[]}],grid:{left:10,top:30,right:0,bottom:40,containLabel:!0},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#CBD4DF"}},axisTick:{show:!0,alignWithLabel:!0,interval:0},axisLabel:{show:!0,fontSize:12,color:"#424752"},splitLine:{show:!1},data:[]}],yAxis:[{type:"value",axisLine:{show:!0,lineStyle:{color:"#CBD4DF"}},axisTick:{show:!1},axisLabel:{show:!0,fontSize:12,rotate:0,color:"#94989F"},splitLine:{show:!0}}]}}}},created:function(){this.getBlocksData(),this.getUserRoleData(),this.getUserStat(),this.getListData(),this.userPvData()},watch:{"userPv.date":function(){this.userPvData()}},mounted:function(){var t=this;this.__resizeObserver=new ResizeObserver((function(e){var a=i()(e,1),s=a[0];if(s){var o=s.contentRect.width;t.onresize(_.round(o))}})),this.__resizeObserver.observe(this.$refs.page)},methods:{onresize:function(){var t,e,a;null===(t=this.$refs)||void 0===t||null===(t=t.chartBar)||void 0===t||t.resize(),null===(e=this.$refs)||void 0===e||null===(e=e.chartPie)||void 0===e||e.resize(),null===(a=this.$refs)||void 0===a||null===(a=a.userPv)||void 0===a||a.resize()},getBlocksData:function(){var t=this;this.$http.get("user/home/statistics/count",{},!0).done((function(e){var a=e.success,s=e.data,o=e.message;a?dsf.mix(t.blocks.data,s||{}):dsf.httpError(o)})).error((function(){dsf.httpError("获取 顶部格子数据 请求异常")})).always((function(){t.blocks.loading=!1})),this.$http.post("/traffic/trend/latest").done((function(e){var a=e.success,s=e.message,o=e.data;a?t.blocks.data.userOnlineCount=o.onlineNumber:dsf.layer.message(s,!1)})).error((function(){dsf.layer.message("获取当前在线数据请求异常",!1)}))},getUserRoleData:function(){var t=this,e={};this.$http.get("/user/home/userRole/stat",e).done((function(e){var a=e.success,s=e.message,o=e.data,r=[],i=[];a?(t.userRole.chart.xAxis[0].data=r,_.forEach(o,(function(t,e){r.push(t.text),i.push(t.value)})),r.length>10&&(t.userRole.chart.dataZoom[0].show=!0,t.userRole.chart.dataZoom[0].startValue=r[0],t.userRole.chart.dataZoom[0].endValue=r[7])):dsf.httpError(s),t.userRole.chart.xAxis[0].data=r,t.userRole.chart.series[0].data=i})).error((function(){t.userRole.chart.series[0].data=[],dsf.httpError("获取 角色授权用户 请求异常")})).finally((function(){t.userRole.loading=!1}))},getUserStat:function(){var t=this,e={};this.$http.get("/user/home/userState/stat",e).done((function(e){var a=e.success,s=e.message,o=e.data;a?(_.forEach(o,(function(e,a){a||(e.selected=!0),e.name=e.text,t.userState.textObj[e.text]=e.value})),t.userState.chart.series[0].data=o):dsf.httpError(s)})).error((function(){t.userState.chart.legend.data=[],dsf.httpError("获取 用户状态 请求异常")})).finally((function(){t.userState.loading=!1}))},getListData:function(){var t=this;this.$http.get("/user/home/warnDanger/top",{pageSize:10}).done((function(e){var a=e.success,s=e.message,o=e.data;a?t.list.data=o:dsf.httpError(s)})).error((function(){dsf.httpError("获取 警告危险行为 请求异常")})).finally((function(){t.list.loading=!1}))},getSt:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=dsf.date.format(new Date,"yyyy-mm-dd 00:00:00");return+t?dsf.date.addDate(new Date(e),+t).getTime():new Date(e).getTime()},userPvData:function(){var t=this;this.userPv.loading=!0;var e=this.userPv.date,a={metrics:"visitor_count",type:1,st:Math.floor(this.getSt("week"==e?"-6":"month"==e?"-29":"-365")/1e3)};this.$http.post("/overview/getTimeTrent",a).done((function(e){var a=e.success,s=e.message,o=e.data;if(a){var r=o.timeTitle;t.userPv.chart.series[0].data=o.currentMetrics,t.userPv.chart.xAxis[0].data=r,r.length>10&&(t.userPv.chart.dataZoom[0].startValue=r[r.length-8],t.userPv.chart.dataZoom[0].endValue=r[r.length-1])}else dsf.layer.message(s,!1)})).error((function(){dsf.layer.message("获取趋势图请求异常",!1)})).finally((function(){t.userPv.loading=!1}))},openPage:function(){this.$openDialog({title:"更多",height:"70%",width:"60%",params:{path:"dsfa/log/warnlist"}})}},beforeDestroy:function(){this.__resizeObserver&&this.__resizeObserver.disconnect()}},n=l,d=(a(634),a(0)),c=Object(d["a"])(n,s,o,!1,null,null,null);e["default"]=c.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_router_user_home.js.map