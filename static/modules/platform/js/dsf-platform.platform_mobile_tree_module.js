/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[30],{1208:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control ds-form-item ds-treeinfo mobile",class:e.getCss},[e.simple&&e.readOnly&&!e.isDesign?[s("DsfTextProxy",e._b({model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},"DsfTextProxy",e._self.$props,!1))]:[e.readOnly?e._e():s("van-field",{attrs:{type:"text",required:e.required,"input-align":"right",disabled:e.disabled,"label-width":e.getLabelWidth(!0),label:e.showLabel&&e.label?e.label:""},on:{input:e.inputChangeHandler,blur:e.inputBlurHandler},model:{value:e.inputValue.pid,callback:function(t){e.$set(e.inputValue,"pid",t)},expression:"inputValue.pid"}}),e.readOnly?s("van-field",{attrs:{type:"text",disabled:e.disabled,required:e.required,"input-align":"right","label-width":e.getLabelWidth(!0),label:e.showLabel&&e.label?e.label:""},model:{value:e.inputValue.pid,callback:function(t){e.$set(e.inputValue,"pid",t)},expression:"inputValue.pid"}}):e._e()]],2)},i=[],n=dsf.component({name:"DsfMobileTreeInfo",mixins:[$mixins.formControl],ctrlCaption:"树结构",props:{caption:{type:String,default:"treeinfo"},label:{type:String,default:"树结构"},pidExpress:{type:String,default:""},iconExpress:{type:String,default:""},iconMap:{type:Array,default:function(){return[]}},showLabel:{type:Boolean,default:!0},value:{type:[String,Object],default:function(){return{pid:"",icon:""}}},visible:{type:Boolean,default:!1},metadata:{type:Object,default:function(){return dsf.metadata.get("tree-info-meta-data")}}},data:function(){return{}},computed:{inputValue:{get:function(){return this.value},set:function(e){this.emitValueChange(e)}}},created:function(){this.pidExpress&&(this.value.pid=this.pidExpress.getValueString(",")),this.iconExpress&&(this.value.icon=this.iconExpress.getValueString(","))},methods:{inputChangeHandler:function(){this.$dispatch("change"),this.emitValueChange(this.value)},inputBlurHandler:function(){this.$dispatch("blur"),this.emitValueChange(this.value)}},watch:{value:{handler:function(e,t){if(dsf.isString(e)||dsf.isUnDef(e))return e={pid:dsf.isUnDef(e)?"":e,icon:""},void this.emitValueChange(e);this.inputValue=e},immediate:!0}},design:{layout:{nameValidate:!1}}}),l=n,r=s(0),o=Object(r["a"])(l,a,i,!1,null,null,null);t["default"]=o.exports},1209:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control mobile ds-ouaselect"},[1==e.showSearch?s("van-search",{attrs:{shape:"round",placeholder:"搜索"},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}):e._e(),s("div",{ref:"header",staticClass:"header"},[e.navs.length?s("div",{ref:"navsRef"},[s("span",{staticClass:"nav",on:{click:function(t){return e.changeNav(0)}}},[e._v("全部")]),e._l(e.navs,(function(t,a){return s("span",{key:a,staticClass:"nav",on:{click:function(t){return e.changeNav(a+1)}}},[s("van-icon",{attrs:{name:"arrow"}}),e._v(e._s(t._name)+" ")],1)}))],2):e._e(),s("van-checkbox",{staticClass:"tool",on:{click:e.checkAll},model:{value:e.chooseAllState,callback:function(t){e.chooseAllState=t},expression:"chooseAllState"}},[e._v(" 全选 ")])],1),s("div",{staticClass:"main",class:{pagination:!e.isDesign&&parseInt(e.pagination)},style:{height:e.mainHeight}},[s("van-list",{attrs:{loading:e.loading,finished:!(!e.isDesign&&1*e.pagination)||e.finished,"finished-text":"没有更多了"},on:{load:e.loadMore},scopedSlots:e._u([{key:"default",fn:function(){return[s("van-checkbox-group",{model:{value:e.result,callback:function(t){e.result=t},expression:"result"}},[s("van-cell-group",{directives:[{name:"show",rawName:"v-show",value:1==e.isAsync&&e.searchSqlUrl&&e.searchValue,expression:"isAsync == 1 && searchSqlUrl && searchValue"}]},e._l(e.searchData,(function(t,a){return s("van-cell",{key:t._id,staticClass:"ds-multi-ellipsis-2",attrs:{border:!1},on:{click:function(s){return e.toggle(a,t)}},scopedSlots:e._u([{key:"title",fn:function(){return[s("van-checkbox",{ref:t._id,refInFor:!0,attrs:{name:t._id,disabled:t._isDisabled}},[e._v(" "+e._s(t._name)+" ")])]},proxy:!0}],null,!0)})})),1),s("van-cell-group",{directives:[{name:"show",rawName:"v-show",value:0==e.isAsync||!e.searchSqlUrl||""==e.searchValue,expression:"isAsync == 0 || !searchSqlUrl || searchValue == ''"}]},e._l(e.list,(function(t,a){return s("van-cell",{key:t._id,staticClass:"ds-multi-ellipsis-2",attrs:{border:!1},on:{click:function(s){return e.toggle(a,t)}},scopedSlots:e._u([{key:"title",fn:function(){return[s("van-checkbox",{ref:t._id,refInFor:!0,attrs:{name:t._id,disabled:t._isDisabled}},[e._v(" "+e._s(t._name)+" ")])]},proxy:!0},t._isParent?{key:"right-icon",fn:function(){return[s("div",{staticClass:"to-children",on:{click:function(s){return s.stopPropagation(),e.toChildren(t,a)}}},[s("i",{staticClass:"iconfont icon-zuzhixiaxia"}),e._v(" 下级 ")])]},proxy:!0}:null],null,!0)})})),1)],1)]},proxy:!0}])})],1)],1)},i=[],n=s(3),l=s.n(n),r=s(8),o=s.n(r),d=dsf.component({name:"DsfMobileTree",ctrlCaption:"树",mixins:[$mixins.control],design:{fit:!0,isMask:!0},props:{tabIndex:{type:[Number,String],default:0},paramsData:{type:Object,default:function(){return{}}},showSearch:{type:String,default:"1"},searchKeys:{type:String,default:""},chooseIf:{type:String,default:""},chooseOneNode:{type:String,default:"1"},defaultOpenSeries:{type:[String,Number],default:"1"},dataSource:{type:String,default:"0"},chooseMetaData:{type:Object,default:function(){return{}}},sqlUrl:{type:String,default:""},searchSqlUrl:{type:String,default:""},chooseType:{type:String,default:"dept"},orgLevel:{type:[String,Number],default:"0"},data:{type:Array,default:function(){return[]}},defaultSelected:{type:Array,default:function(){return[]}},nodeKey:{type:String,default:"_id"},excludeIds:{type:Array,default:function(){return[]}},valueNodeKey:{type:String,default:"_id"},chooseOneNodeSpecial:{type:String,default:"0"},isAsync:{type:String,default:"0"},asyncSqlUrl:{type:String,default:""},pagination:{type:String,default:"0"},pageSize:{type:Number,default:1},paginationSql:{type:String,default:""},excludeDept:{type:String,default:""},excludeUser:{type:String,default:""},staticData:{type:String,default:""}},data:function(){return{navs:[],mainHeight:"",result:[],chooseAllState:!1,asyncSql:null,list:[],listObj:{},pageNumObj:{},_paginationSql:this.paginationSql,loading:!1,finished:!1,searchValue:"",searchData:[]}},watch:{searchValue:function(e){this.searchData=[],this._filter(e)},result:function(e){this.dispatchSetResult(e)},navs:{deep:!0,immediate:!0,handler:function(){var e=this;this.$nextTick((function(){e.mainHeight="calc(100% - ".concat(e.$refs.header.clientHeight+"px",")");var t=e.$refs.navsRef;t&&e.$nextTick((function(){t.scrollLeft=t.scrollWidth}))}))}},staticData:function(){this.loadData()}},created:function(){var e=this;this.loadData(),this.dispatchSetResult=_.debounce((function(t){var s=dsf.mix([],t),a=[];_.forEach(s,(function(t,s){e.listObj[t]&&(e.listObj[t].data._checked=1,e.listObj[t].data._isDisabled||a.push(e.listObj[t].data))})),e.$dispatch("setResult",{data:a,index:e.tabIndex})}),100),this._filter=_.debounce((function(t){if(e.chooseAllState=!1,1==e.isAsync&&e.searchSqlUrl&&""!=t)e.checkSearch(t);else if(t){var s=[];dsf.deepForEach(e.list,(function(a){var i=a.name||a._name;if(e.searchKeys){var n=e.searchKeys.split(","),l=o()(n,2),r=l[0],d=l[1];a[r]==d&&_.includes(i,t)&&s.push(a)}else _.includes(i,t)&&s.push(a)})),e.list=s,e.defaultSelected.length&&e.setResult()}else e.changeNav(0),e.list=e.listObj[e.paramsData.tabId].children}),600)},methods:{checkSearch:function(e){var t=this,s=dsf.layer.loading(),a={userName:e};this.$http.get(this.$replace(this.searchSqlUrl,this.$expressParams(this)),a).done((function(e){if(e.success){var s,a=e.data;if(dsf.isEmptyObject(a)&&(a=[]),!Array.isArray(a))a=(null===(s=a)||void 0===s?void 0:s.children)||[];t.searchData=a,a.length&&t.setResult()}else dsf.layer.message(e.message,!1)})).error((function(e){var t;dsf.layer.message((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message),!1)})).always((function(){dsf.layer.closeLoading(s)}))},init:function(){this.navs=[],this.chooseAllState=!1,this.list=[],this.listObj={},this.result=[],this.asyncSql=null},loadData:function(){if(this.isDesign){var e=this.nodeKey,t=[l()(l()({_name:"布局"},e,"bj"),"children",[l()({_name:"一行两列"},e,"yhll"),l()({_name:"一行三列"},e,"yhsl")]),l()(l()({_name:"文字"},e,"wz"),"children",[l()({_name:"文本"},e,"wb"),l()(l()({_name:"标题"},e,"bt"),"children",[l()({_name:"标题1"},e,"bt1"),l()({_name:"标题2"},e,"bt2")])])];-1==+this.dataSource&&(t=JSON.parse(this.staticData||"[]")),this.setLists(t)}else"6"!=this.dataSource&&this.listsRequest()},listsRequest:function(){var e=this,t="",s=dsf.mix({},this.queryString);if(this.loading=!0,"-1"==this.dataSource){var a=JSON.parse(this.staticData||"[]");return this.setLists(a),void(this.listObj[this.paramsData.tabId]["pagination"]={params:s,loading:!1,finished:!0})}var i=dsf.layer.loading();if(1==this.isAsync&&(this.asyncSql=this.asyncSqlUrl),"0"==this.dataSource)t=this.sqlUrl;else if("1"==this.dataSource){var n=this.chooseMetaData||{};"meta"===n.type?(t="meta/tree/byName",dsf.mix(!0,s,{name:n.code.id,namespace:this.$vm?this.$vm.nameSpace:"",pageName:this.$vm?this.$vm.pageName:"",order:"[]"})):"ds"===n.type&&(t="meta/tree/dbSource",dsf.mix(!0,s,{rmId:n.code}))}else t=[{user:"oua/getUserByCurDept",dept:"oua/getUserByCurDept",userSearch:"oua/searchUserByCurDept",deptSearch:"oua/searchDeptByCurDept"},{user:"oua/getUserByCurUnit",dept:"oua/getDeptByCurUnit",userSearch:"oua/searchUserByCurUnit",deptSearch:"oua/searchDeptByCurUnit"},{user:"oua/getUserByOrg",dept:"oua/getDeptByOrg",userSearch:"oua/searchUserByOrg",deptSearch:"oua/searchDeptByOrg"}][1*this.dataSource-2][this.chooseType],this.asyncSql=t,this._paginationSql="/oua/getOrgMoreData",s["isAsy"]=!0,"4"==this.dataSource&&(s["sExplanLevel"]=this.orgLevel,"user"==this.chooseType?this.asyncSql="oua/getUserByCurUnit":this.asyncSql="oua/getDeptByCurUnit"),s.excludeDept=this.excludeDept||null,s.excludeUser=this.excludeUser||null;t?(1*this.pagination&&(s.pageSize=this.pageSize,s.pageNum=1),this.$http.get(this.$replace(t,this.$expressParams(this)),s,"1"==this.dataSource).done((function(t){if(t.success){var a=t.data;dsf.isEmptyObject(a)&&(a=[]),Array.isArray(a)||(a=new Array(a)),e.setLists(a);var i=!1;1*e.pagination&&e.list.length<e.pageSize&&(i=!0,e.finished=!0),e.listObj[e.paramsData.tabId]["pagination"]={params:s,loading:!1,finished:i}}else dsf.layer.message(t.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})).always((function(){dsf.layer.closeLoading(i),e.$dispatch("treeLoaded",{data:e.list,tabIndex:e.tabIndex,type:"loadData"})}))):dsf.layer.message("请在设计器内完成组件数据配置",!1)},setLists:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.paramsData.tabId,s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i={},n=[],l=0,r=this.nodeKey,o=this;if(Array.isArray(e)||(e=[e]),_.forEach(e,(function(e){var d=e[r],c=e.treeinfo_pid;o.setNodeState(e,s),e._isDisabled||l++,a?o.listObj[t]["children"].push(e):(i[d]=e,i[c]&&(i[c]["children"]||(i[c]["children"]=[]),i[c]["children"].push(e),o.listObj[c]={children:i[c]["children"],noDisabledNum:-1,choosedNum:0})),n.push(e),o.listObj[d]={children:e.children||[],noDisabledNum:-1,choosedNum:0,data:e}})),a?(this.listObj[t].noDisabledNum+=l,this.chooseAllState?this.setResult({_checked:1}):this.setResult(s)):(this.listObj[t]={children:n,noDisabledNum:l,choosedNum:0,data:s},this.list=n,this.setResult(s)),this.loading=!1,this.finished=!1,this.asyncSql)return n},setNodeState:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e["_checked"]=-1,e["_isDisabled"]=!1,e["_tabIndex"]=this.tabIndex,e["_isParent"]=this.isParent(e),e["_parentKey"]=t[this.nodeKey]||this.paramsData.tabId,this.chooseIf&&!this.$eval(this.chooseIf,e)&&(e["_isDisabled"]=!0),this.excludeIds.includes(e[this.valueNodeKey])&&(e["_isDisabled"]=!0),e["_isDisabled"]},isParent:function(e){var t;return this.asyncSql?!e.isLeaf&&!!(null!==(t=e.children)&&void 0!==t&&t.length||("dept"===this.chooseType?e.DeptCount:"user"!==this.chooseType||1!==e._type&&1!==e.type&&(e.DeptCount||e.UserCount))):e.children&&e.children.length>0},setResult:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{_checked:-1};this.$nextTick((function(){var s=e,a=parseInt(e.chooseOneNode)>0,i=_.map(s.defaultSelected,(function(e){return e[s.valueNodeKey]||e.value})),n=e.searchSqlUrl&&e.searchValue?e.searchData:e.list,l=[];_.forEach(n,(function(n,r){i.includes(n[s.valueNodeKey])&&!n._isDisabled?(e.$dispatch("deleteDefaultSelected",n),l.push(n._id)):-1==t._checked?e.getResultVals(n[s.nodeKey])>-1?s.$refs[n[s.nodeKey]][0].toggle(!0):s.$refs[n[s.nodeKey]][0].toggle(!1):a&&(s.chooseAllState=1==t._checked,s.checkAll()),e.result=_.xor(e.result,l)})),-1!=t._checked&&(t._checked=-1)}))},toggle:function(e,t,s){var a;if(t._parentKey=(null===(a=_.findLast(this.navs))||void 0===a?void 0:a[this.nodeKey])||this.paramsData.tabId,!t._isDisabled){var i=this.$refs[t._id][0].checked;t._checked=i?0:1,this.$refs[t._id][0].toggle();var n=this.getResultVals(t[this.nodeKey]);e>-1&&(this.result[n]=t);var l=this.listObj[this.navs[this.navs.length-1]?this.navs[this.navs.length-1][this.nodeKey]:this.paramsData.tabId];l.choosedNum=l.choosedNum+(t._checked?1:-1),this.chooseAllState=!i&&l.choosedNum==l.noDisabledNum,s||(this.getParents(t,this.chooseAllState),t.children&&this.getChilds(t.children,!!t._checked,t))}},toChildren:function(e,t){var s=this,a=e[this.nodeKey],i=this,n=e;if(!i.asyncSql||i.listObj[a]&&i.listObj[a].asynced){if(i.listObj[a]){if(e._checked=-1,i.navs.push(e),i.list=i.listObj[a]["children"],i.list[0]&&i.list[0][i.nodeKey]&&i.listObj[i.list[0][i.nodeKey]]==this.paramsData.tabId){var l=0;_.forEach(i.list,(function(e,t){i.setNodeState(i.list[t],n),i.list[t]._isDisabled||l++,i.listObj[e[i.nodeKey]]={children:e.children||0,noDisabledNum:-1,choosedNum:0,asynced:!1,data:e}})),this.listObj[a]["noDisabledNum"]=l,this.setResult(e)}this.$nextTick((function(){s.setChooseAllState(a)}))}}else{i.loading=!0;var r=dsf.layer.loading(),o={isAsy:!0,sFID:a};1*this.pagination&&(o.pageSize=this.pageSize,o.pageNum=1),1*this.dataSource>1&&(o.excludeDept=i.excludeDept||null,o.excludeUser=i.excludeUser||null),i.$http.get(i.$replace(i.asyncSql,i.$expressParams(i,e)),o,"1"==i.dataSource).done((function(t){if(t.success){var s;e.children=i.setLists((null===t||void 0===t||null===(s=t.data)||void 0===s?void 0:s.children)||[],a,n),i.listObj[a].asynced=!0,i.navs.push(e);var l=!1;1*i.pagination&&i.list.length<i.pageSize&&(l=!0,i.finished=!0),i.listObj[a]["pagination"]={params:o,loading:!1,finished:l},i.setChooseAllState(a)}else dsf.layer.message(t.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})).always((function(){dsf.layer.closeLoading(r),i.$dispatch("treeLoaded",{data:i.list,tabIndex:i.tabIndex,type:"toChildren"})}))}},setChooseAllState:function(e){var t,s=this,a=(null===(t=_.findLast(this.navs))||void 0===t?void 0:t[this.nodeKey])||this.paramsData.tabId;if(e||(e=a),a==e){var i=0;_.forEach(this.list,(function(e){var t=s.getResultVals(e[s.nodeKey]);t>-1&&(s.result[t]=e,i++)})),this.listObj[e].choosedNum=i,this.chooseAllState=this.listObj[e].choosedNum>0&&this.listObj[e].choosedNum==this.listObj[e].noDisabledNum}},checkAll:function(){var e=this,t=this.navs[this.navs.length-1],s=[];if(t||this.searchValue){var a=1==this.isAsync&&this.searchSqlUrl&&this.searchValue?this.searchData:this.list;a.length&&(this.searchSqlUrl&&this.searchValue?_.forEach(a,(function(t,a){t._isDisabled||(e.listObj[t._id].data._checked=e.chooseAllState?1:0,s.push(t._id))})):_.forEach(this.$refs,(function(t,a){"header"==a&&-1==_.indexOf(e.result,a)||t[0]&&(e.listObj[a].data._checked=e.chooseAllState?1:0,s.push(a))})),this.chooseAllState?this.result=_.uniqBy(_.concat(this.result,s)):this.result=_.xor(_.concat(this.result,s),s))}else _.forEach(this.listObj[this.paramsData.tabId].children,(function(t,a){var i;t._parentKey=(null===(i=_.findLast(e.navs))||void 0===i?void 0:i[e.nodeKey])||e.paramsData.tabId,t._checked=e.chooseAllState?1:0,t._checked&&s.push(t._id)})),this.result=s;var i,n=this.listObj[this.navs[this.navs.length-1]?this.navs[this.navs.length-1][this.nodeKey]:this.paramsData.tabId];(this.chooseAllState?n["choosedNum"]=n.noDisabledNum:n["choosedNum"]=0,parseInt(this.chooseOneNode)>0)&&(this.getParents((null===(i=this.list)||void 0===i?void 0:i[0])||{},this.chooseAllState),_.forEach(this.list,(function(t){t.children&&e.getChilds(t.children,e.chooseAllState,t)})))},getChilds:function(e,t,s){var a=this;e&&e.length>0&&parseInt(this.chooseOneNode)>0&&_.forEach(e,(function(e){if(!e._isDisabled){var i=a.getResultVals(e[a.nodeKey]);e._checked=t?1:0,-1==i&&t?(s&&!e._parentKey&&(e._parentKey=s[a.nodeKey]),e._tabIndex=a.tabIndex,a.result.push(e),a.listObj[e._parentKey].choosedNum++):i>-1&&!t&&(a.result.splice(i,1),a.listObj[e._parentKey].choosedNum--),e.children&&a.getChilds(e.children||[],t,e)}}))},getParents:function(e,t){if(e&&(null===e||void 0===e||!e._isDisabled)&&1==parseInt(this.chooseOneNode)){var s=e._parentKey,a=this.paramsData.tabId,i=this.listObj[s];if(i&&1*i.choosedNum==i.noDisabledNum==t){var n=this.getResultVals(s);i.data&&(i.data._checked=t?1:0,a=i.data._parentKey),-1==n&&t?(i.data&&(i.data._tabIndex=this.tabIndex),i.data&&this.result.push(i.data),a&&this.listObj[a].choosedNum++):n>-1&&!t&&(this.result.splice(n,1),a&&this.listObj[a].choosedNum--),this.getParents(i.data,t)}}},changeNav:function(e){if(e!=this.navs.length){this.navs.splice(e);var t=this.navs.length,s={};if(s=t>0?this.listObj[this.navs[t-1][this.nodeKey]]:this.listObj[this.paramsData.tabId],1*this.pagination&&(this.finished=s.pagination.finished),this.list=s["children"],1==parseInt(this.chooseOneNode)){var a=this.getResultVals(),i=0,n=this;_.forEach(this.list,(function(e){var t=a.indexOf(e[n.nodeKey]);t>-1&&(n.result[t]=e,i++)})),s.choosedNum=i}this.chooseAllState=s.choosedNum>0&&s.choosedNum==s.noDisabledNum}},getResultVals:function(e){var t=this,s=_.map(this.result,(function(e){return null===e||void 0===e?void 0:e[t.nodeKey]}));return e?s.indexOf(e):s},deleteResult:function(e){var t,s=this;this.getParents(e,!1),this.getChilds(e.children,!1,e);var a=(null===(t=_.findLast(this.navs))||void 0===t?void 0:t[this.nodeKey])||this.paramsData.tabId;if(this.listObj[e._parentKey].choosedNum--,e._parentKey===a){var i=_.findIndex(this.list,(function(t){return t[s.nodeKey]==e[s.nodeKey]}));i>-1&&(this.$refs[e._id][0].toggle(!1),this.chooseAllState=!1)}else{var n=this.listObj[this.navs[this.navs.length-1]?this.navs[this.navs.length-1][this.nodeKey]:this.paramsData.tabId];this.chooseAllState=n.choosedNum==n.noDisabledNum}var l=this.getResultVals(e[this.nodeKey]);l>-1&&this.result.splice(l,1)},loadMore:function(){var e=this,t=this;if(this.list&&this.list.length>0){var s=this.listObj[this.navs[this.navs.length-1]?this.navs[this.navs.length-1][this.nodeKey]:this.paramsData.tabId],a=s.pagination,i=a.params;this.loading||this.finished||(this.loading=!0,a.loading=!0,s.pagination.params.pageNum++,1*this.dataSource>1&&(i.withUser="user"===this.chooseType),this.$http.get(this.$replace(this._paginationSql,this.$expressParams(this,s.data)),i,"1"==this.dataSource).done((function(i){if(i.success){var n=i.data;dsf.isEmptyObject(n)&&(n=[]),Array.isArray(n)||(n=new Array(n)),e.setLists(n,s.data[e.nodeKey],s.data,!0);var l=!1;n.length<e.pageSize&&(l=!0,e.finished=!0),a.loading=!1,a.finished=l,t.$dispatch("treeLoaded",{data:t.list,tabIndex:t.tabIndex,type:"loadMore"})}else dsf.layer.message(i.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})))}}}}),c=d,h=s(0),u=Object(h["a"])(c,a,i,!1,null,null,null);t["default"]=u.exports},1210:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control mobile ds-ouaselect dsf-checkNode ds-no-padding"},[s("div",{staticClass:"content",style:{height:e.mainHeight}},[e.slots.length>1?s("van-tabs",{attrs:{animated:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.slots,(function(t,a){return s("van-tab",{key:t.name,attrs:{title:t.title,name:t.title}},["tree"==t.displayMode?s("dsf-mobile-tree-interface",{ref:"treeInterface"+a,refInFor:!0,attrs:{"is-design":e.isDesign,"tab-index":a,"params-data":t},on:{setResult:e.setResult,deleteDefaultSelected:e.deleteDefaultSelected,treeLoaded:e.treeLoaded},scopedSlots:e._u([{key:"searchboxSolt",fn:function(){return[e._t("searchboxSolt")]},proxy:!0},{key:"searchAfter",fn:function(){return[e._t("searchAfter")]},proxy:!0},{key:"nodeNameBefore",fn:function(t){var s=t.data;return[e._t("nodeNameBefore",null,{data:s})]}}],null,!0)}):s("dsf-mobile-index-bar",{ref:"indexBar"+a,refInFor:!0,attrs:{"is-design":e.isDesign,"tab-index":a,"params-data":t,"search-sql-url":t.searchSqlUrl,defaultSelected:e.defaultSelected},on:{setResult:e.setResult,deleteDefaultSelected:e.deleteDefaultSelected,treeLoaded:e.treeLoaded}})],1)})),1):["tree"==e.slots[0].displayMode?s("dsf-mobile-tree-interface",{ref:"treeInterface0",attrs:{"is-design":e.isDesign,"tab-index":0,"params-data":e.slots[0],defaultSelected:e.defaultSelected},on:{setResult:e.setResult,deleteDefaultSelected:e.deleteDefaultSelected,treeLoaded:e.treeLoaded},scopedSlots:e._u([{key:"searchboxSolt",fn:function(){return[e._t("searchboxSolt")]},proxy:!0},{key:"searchAfter",fn:function(){return[e._t("searchAfter")]},proxy:!0},{key:"nodeNameBefore",fn:function(t){var s=t.data;return[e._t("nodeNameBefore",null,{data:s})]}}],null,!0)}):s("dsf-mobile-index-bar",{ref:"indexBar0",attrs:{"is-design":e.isDesign,"tab-index":0,"params-data":e.slots[0],"search-sql-url":e.slots[0].searchSqlUrl,defaultSelected:e.defaultSelected},on:{setResult:e.setResult,deleteDefaultSelected:e.deleteDefaultSelected,treeLoaded:e.treeLoaded}})]],2),s("div",{ref:"footer",staticClass:"footer"},[s("span",{on:{click:e.showResultPopup}},[e._v(" 已选择"+e._s(e.result.length)+" "+e._s(1*e._maxTags>=1?" /"+e._maxTags:"")+" "),e.result.length>0?s("van-icon",{attrs:{name:"arrow-up"}}):e._e()],1)]),s("van-popup",{style:{height:"100%"},attrs:{position:"bottom","close-on-popstate":!0},model:{value:e.showResult,callback:function(t){e.showResult=t},expression:"showResult"}},[s("van-sticky",[s("div",{staticClass:"top"},[s("span",{staticClass:"btn",on:{click:function(t){e.showResult=!1}}},[e._v("取消")]),e._v(" 已选择数量:"+e._s(e.resultPopup.length)+" "),s("span",{staticClass:"btn",on:{click:function(t){return e.deleteResult()}}},[e._v("确定")])])]),e._l(e.resultPopup,(function(t,a){return s("van-cell-group",{key:a},[s("van-cell",{attrs:{title:e.popupName(t)},scopedSlots:e._u([{key:"title",fn:function(){return[e._t("popupName",(function(){return[e._v(" "+e._s(e.popupName(t))+" ")]}),{data:{item:t,title:e.popupName(t)}})]},proxy:!0},t.required?null:{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"close"},on:{click:function(s){return e.deleteResultPopup(t,a)}}})]},proxy:!0}],null,!0)})],1)}))],2)],1)},i=[],n=s(2),l=s.n(n),r=s(3),o=s.n(r);function d(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?d(Object(s),!0).forEach((function(t){o()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var h=dsf.component({name:"DsfMobileTreeSelector",ctrlCaption:"树选择器",mixins:[$mixins.control,$mixins.dataResult],design:{isMask:!0,fit:!0},props:{label:{type:String,default:"树选择器"},maxTags:{type:[String,Number],default:10},chooseIf:{type:String,default:""},dataSource:{type:String,default:"3"},chooseType:{type:String,default:"2"},orgLevel:{type:[String,Number],default:"0"},showSearch:{type:String,default:"1"},searchKeys:{type:String,default:""},showOrgSubMechanism:{type:Boolean,default:!0},sqlUrl:{type:String,default:""},chooseMetaData:{type:Object,default:function(){return{}}},data:{type:Array,default:function(){return[]}},slots:{type:Array,default:function(){return[]}},sort:{type:Boolean,default:!1},maxLength:{type:Number,default:0},nodeKey:{type:String,default:"_id"},excludeIds:{type:Array,default:function(){return[]}},valueNodeKey:{type:String,default:"_id"}},data:function(){return{activeName:"",result:[],result_tab:[],showResult:!1,resultPopup:[],deletedResultPopupIds:[],defaultSelected:[],_maxTags:void 0,oldResult:[],mainHeight:"",unwatchA:["_unwatch"]}},created:function(){this.init()},mounted:function(){this.mainHeight="calc(100% - ".concat(this.$refs.footer.clientHeight+"px",")")},watch:{dataSource:{handler:function(e){var t,s=this;dsf.isArray(e)?(_.forEach(this.unwatchA,(function(e){var t;null===(t=s[e])||void 0===t||t.call(s)})),this.unwatchA=[],_.forEach(e,(function(e,t){var a;"6"==e?(s.unwatchA.push("_unwatch"+t),s["_unwatch"+t]=s.$watch("data"+t,(function(e){var a=s.$refs["treeInterface"+t];a&&(a=a[0]||a,a.init(),a.setLists(e))}),{immediate:!0,deep:!0})):null===(a=s["_unwatch"+t])||void 0===a||a.call(s)}))):"6"==e?this._unwatch=this.$watch("data",(function(e){s.$nextTick((function(){var t=s.$refs["treeInterface0"];t&&(t=t[0]||t,t.init(),t.setLists(e))}))}),{immediate:!0,deep:!0}):null===(t=this._unwatch)||void 0===t||t.call(this)},immediate:!0}},computed:{excludeIdsAll:function(){var e;return this.excludeIds.concat((null===(e=this.$vm)||void 0===e||null===(e=e.$attrs)||void 0===e?void 0:e.excludeIds)||[])}},provide:function(){return{$treeBox:this}},methods:{fixOldVersions:function(){if(0==this.slots.length&&this.dataSource){var e=this.dataSource,t="6"==e?"6":"5"==e?"1":"4"==e?"0":1*e+1+"",s=["","dept","user"][this.chooseType],a={title:this.label,types:this.chooseIf,chooseOneNode:"0",defaultOpenSeries:"1",metaDataType:t,showType:s,showLevel:this.orgLevel,chooseMetaData:this.chooseMetaData,sqlUrl:this.sqlUrl,controls:[],name:dsf.uuid(),error:!1,nodeKey:this.nodeKey,showSearch:this.showSearch,searchKeys:this.searchKeys,async:"0",asyncSqlUrl:"",searchSqlUrl:"",pagination:"0",pageSize:1e3,paginationSql:"",clickTextFun:"check",chooseOneNodeSpecial:"0",excludeDept:"",excludeUser:"",staticData:null,tabId:dsf.uuid(),displayMode:"tree"};this.slots.push(a),this._maxTags=1*this.$maxTags||0}},init:function(){var e=this;this._maxTags=this.maxLength||0,this.fixOldVersions(),this.getParentCtrlConfig(),_.forEach(this.slots,(function(){e.result_tab.push([])}))},getParentCtrlConfig:function(){var e=this;if(!dsf.isEmptyObject(this.$choiceParams)){if(_.isArray(this.$choiceParams.slots)&&this.$choiceParams.slots.length>0)for(var t in this.slots.length=this.$choiceParams.slots.length,this.$choiceParams.slots)this.slots[t]=this.$choiceParams.slots[t];this._maxTags=this.$choiceParams.maxTags||0,this.defaultSelected=[],_.forEach(this.$choiceParams.value||[],(function(t){var s=o()(o()({},e.valueNodeKey,t.value),"_name",t.text);e.defaultSelected.push(c(c({},t),s))})),this.result=this.defaultSelected,this.oldResult=_.cloneDeep(this.result)}},setResult:function(e){var t;if(e){var s=e.args;this.result_tab[s.index]=s.data}var a=[];_.forEach(this.result_tab,(function(e){var t;a=(t=a).concat.apply(t,l()(e))})),a=(t=this.defaultSelected||[]).concat.apply(t,l()(a)),a=_.unionBy(a,this.valueNodeKey),this._maxTags>=1&&a.length>this._maxTags&&dsf.layer.message("已超出选择数量上限",!1),this.result=a},showResultPopup:function(){this.result.length>0&&(this.showResult=!0,this.resultPopup=dsf.mix(!0,[],this.result),this.deletedResultPopupIds=[])},deleteResultPopup:function(e,t){var s,a=e[(null===(s=this.slots)||void 0===s||null===(s=s[e._tabIndex])||void 0===s?void 0:s.nodeKey)||"_id"];this.resultPopup.splice(t,1),this.deletedResultPopupIds.push(a)},deleteResult:function(){var e=this,t=this;if(t.showResult=!1,0!=t.deletedResultPopupIds.length){t.deleteDefaultSelected(t.deletedResultPopupIds);for(var s=function(s){var i,n=t.result[s],l=n._tabIndex,r=n[(null===(i=e.slots)||void 0===i||null===(i=i[l])||void 0===i?void 0:i.nodeKey)||"_id"],o=t.deletedResultPopupIds.indexOf(r);if(-1!=o){t.result.splice(s,1),t.deletedResultPopupIds.splice(o,1),s--;var d,c,h=null;if(n.initials)h=t.$refs["indexBar"+l];else if(e.slots[l]){e.slots[l];h=t.$refs["treeInterface"+l]}if(dsf.isArray(h))_.each(h,(function(e){return e.deleteResult(n)}));else null===(d=h)||void 0===d||null===(c=d.deleteResult)||void 0===c||c.call(d,n)}a=s},a=0;a<t.result.length;a++)s(a)}},getReturnValue:function(){var e=this,t=[];return this._maxTags>=1&&this.result.length>this._maxTags?(dsf.layer.message("已超出选择数量上限【"+this._maxTags+"】",!1),!1):(_.forEach(this.result,(function(s,a){t.push(dsf.mix({value:s[e.valueNodeKey],text:s._name},s))})),this.oldResult=_.cloneDeep(this.result),t)},setViewSeleted:function(e){var t=this,s={},a=0;_.forEach(e.value,(function(e){s[e[t.valueNodeKey]||e.value]=e,a++})),a?_.forEachRight(this.result,(function(e){var a=e[t.valueNodeKey];s[a]||t.deletedResultPopupIds.push(a)})):this.deletedResultPopupIds=_.map(this.result,(function(e){return e[t.valueNodeKey]})),this.deleteResult();var i=_.map(this.result,(function(e){return e[t.valueNodeKey]})),n={};_.forEach(e.value||[],(function(e){var s=e[t.valueNodeKey]||e.value;i.includes(s)||_.forEach(t.slots,(function(a,i){var l,r=t.$refs["treeInterface"+i];if(r)if(r=(null===(l=r)||void 0===l?void 0:l[0])||r,r.$refs[s])n["treeInterface"+i]||(n["treeInterface"+i]=[]),n["treeInterface"+i].push(s);else{var d=o()(o()({},t.valueNodeKey,e.value||e[t.valueNodeKey]),"_name",e.text||e._name);t.defaultSelected.push(c(c({},e),d))}}))})),dsf.isEmptyObject(n)?this.setResult():_.forEach(n,(function(e,s){var a,i=t.$refs[s];i&&(i=(null===(a=i)||void 0===a?void 0:a[0])||i,i.chooseNodeKeys=i.chooseNodeKeys.concat(e))}))},reset:function(e){var t=this;this.defaultSelected=[],this.result=[],_.forEach(this.result_tab,(function(s,a){if(s&&s.length&&(s=[],!e)){var i,n=t.$refs["treeInterface"+a];if(n)n=(null===(i=n)||void 0===i?void 0:i[0])||n,n.chooseNodeKeys=[],n.searchSelData=[]}}))},deleteDefaultSelected:function(e){if(e.args){for(var t=e.args[this.valueNodeKey],s=0;s<this.oldResult.length;s++)this.oldResult[s][this.valueNodeKey]==t&&(this.oldResult[s]._tabIndex=e.args._tabIndex);e=[t]}for(var a=0;a<this.defaultSelected.length;a++){var i=this.defaultSelected[a],n=e.indexOf(i[this.valueNodeKey]);-1!=n&&(this.defaultSelected.splice(a,1),a--)}},treeLoaded:function(e){this.$dispatch("treeLoaded",e)},popupName:function(e){if(e.initials)return"通讯录 -> "+e.name;var t="";return e.deptId&&e.deptName?t=e.deptName+" -> ":e.pname&&(t=e.pname+" -> "),t+(e._name||e.name)}},beforeDestroy:function(){var e=this;_.forEach(this.unwatchA,(function(t){var s;null===(s=e[t])||void 0===s||s.call(e)}))}}),u=h,f=s(0),p=Object(f["a"])(u,a,i,!1,null,null,null);t["default"]=p.exports},1211:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.noData?s("dsf-empty-data",{attrs:{description:"暂无数据"}}):s("div",{staticClass:"ds-control mobile ds-ouaselect"},[1==e.paramsData.showSearch?s("van-search",{attrs:{shape:"round",placeholder:"搜索","show-action":""},on:{search:e.onSearch,clear:e.onSearch},scopedSlots:e._u([{key:"action",fn:function(){return[e._t("searchboxSolt")]},proxy:!0}],null,!0),model:{value:e.searchValueInput,callback:function(t){e.searchValueInput=t},expression:"searchValueInput"}}):e._e(),e._t("searchAfter"),s("div",{ref:"header",staticClass:"header"},[e.navs.length&&!e.searchValue?s("div",{ref:"navsRef"},[s("span",{staticClass:"nav",on:{click:function(t){return e.changeNav(0)}}},[e._v("全部")]),e._l(e.navs,(function(t,a){return s("span",{key:a,staticClass:"nav",on:{click:function(t){return e.changeNav(a+1)}}},[s("van-icon",{attrs:{name:"arrow"}}),e._v(e._s(t._name)+" ")],1)}))],2):e._e(),s("van-checkbox",{directives:[{name:"show",rawName:"v-show",value:1!=+e.$treeBox._maxTags,expression:"+$treeBox._maxTags != 1"}],staticClass:"tool",on:{click:e.checkAll},model:{value:e.chooseAllState,callback:function(t){e.chooseAllState=t},expression:"chooseAllState"}},[e._v("全选")])],1),s("div",{staticClass:"main",class:[e.isDesign?"":"pagination","showCheckBox"+e.paramsData.showCheckBox]},[s("van-list",{attrs:{loading:e.loading,finished:e.finished,"finished-text":"没有更多了"},scopedSlots:e._u([{key:"default",fn:function(){return[s("van-checkbox-group",{model:{value:e.chooseNodeKeys,callback:function(t){e.chooseNodeKeys=t},expression:"chooseNodeKeys"}},[e.searchValue?s("van-cell-group",e._l(e.searchData,(function(t,a){return s("van-cell",{key:t._id,ref:"rows",refInFor:!0,class:["ds-multi-ellipsis-2",t.isNodeSplit?"is-node-split":""],attrs:{"row-index":a,id:t._id,border:!1},on:{click:function(s){return e.checkedToggle(t)}},scopedSlots:e._u([t._inClient?{key:"title",fn:function(){return[t._isDisabled||t.required&&1==t._checked?s("van-checkbox",{ref:t[e.nodeKey],refInFor:!0,attrs:{name:t[e.nodeKey],disabled:!0}},[e._t("nodeNameBefore",null,{data:t}),e._v(e._s(t._name)+" ")],2):s("van-checkbox",{ref:t[e.nodeKey],refInFor:!0,attrs:{name:t[e.nodeKey]}},[e._t("nodeNameBefore",null,{data:t}),e._v(e._s(t._name)+" ")],2)]},proxy:!0}:{key:"title",fn:function(){return[s("div",{ref:t[e.nodeKey],refInFor:!0,staticClass:"skeleton"},[e._t("nodeNameBefore",null,{data:t}),e._v(e._s(t._name))],2)]},proxy:!0}],null,!0)})})),1):s("van-cell-group",e._l(e.list,(function(t,a){return s("van-cell",{key:t._id,ref:"rows",refInFor:!0,class:["ds-multi-ellipsis-2",t.isNodeSplit?"is-node-split":""],attrs:{"row-index":a,border:!1},on:{click:function(s){return e.checkedToggle(t)}},scopedSlots:e._u([t._inClient?{key:"title",fn:function(){return[t._isDisabled||t.required&&1==t._checked?s("van-checkbox",{ref:t[e.nodeKey],refInFor:!0,attrs:{name:t[e.nodeKey],disabled:!0}},[e._t("nodeNameBefore",null,{data:t}),e._v(e._s(t._name)+" ")],2):s("van-checkbox",{ref:t[e.nodeKey],refInFor:!0,attrs:{name:t[e.nodeKey]}},[e._t("nodeNameBefore",null,{data:t}),e._v(e._s(t._name)+" ")],2)]},proxy:!0}:{key:"title",fn:function(){return[s("div",{ref:t[e.nodeKey],refInFor:!0,staticClass:"skeleton"},[e._t("nodeNameBefore",null,{data:t}),e._v(e._s(t._name))],2)]},proxy:!0},t._inClient&&t._isParent?{key:"right-icon",fn:function(){return[s("div",{staticClass:"to-children",on:{click:function(s){return s.stopPropagation(),e.toNextChildren(t,a)}}},[s("i",{staticClass:"iconfont icon-zuzhixiaxia"}),e._v("下级 ")])]},proxy:!0}:null],null,!0)})})),1)],1)]},proxy:!0}],null,!1,3871907316)})],1)],2)},i=[],n=s(8),l=s.n(n),r=s(3),o=s.n(r);function d(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?d(Object(s),!0).forEach((function(t){o()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var h=dsf.component({name:"DsfMobileTreeInterface",ctrlCaption:"自定义接口树",mixins:[$mixins.control],design:{fit:!0,isMask:!0},props:{tabIndex:{type:[Number,String],default:0},paramsData:{type:Object,default:function(){return{}}},isDesign:{type:Boolean,default:!0}},data:function(){return this.sqlUrls={1:{name:"元数据组",meta:"meta/tree/byName",ds:"meta/tree/dbSource"},2:{name:"本部门",user:"oua/getUserByCurDept",dept:"oua/getUserByCurDept",userSearch:"oua/searchUserByCurDept",deptSearch:"oua/searchDeptByCurDept"},3:{name:"本单位",user:"oua/getUserByCurUnit",dept:"oua/getDeptByCurUnit",userSearch:"oua/searchUserByCurUnit",deptSearch:"oua/searchDeptByCurUnit"},4:{name:"组织架构",user:"oua/getUserByOrg",dept:"oua/getDeptByOrg",userSearch:"oua/searchUserByOrg",deptSearch:"oua/searchDeptByOrg"}},this.fixParams={},{listObj:{},listObjSearch:{},list:[],loading:!1,finished:!1,navs:[],chooseNodeKeys:[],chooseAllState:!1,pageNumObj:{},searchValueInput:"",searchValue:"",searchData:[],searchLoaded:!1,intersectionObserverList:[],noData:!1,searchSelData:[]}},computed:{nodeKey:function(){return this.paramsData.nodeKey||"_id"},initSql:function(){var e=+this.paramsData.metaDataType,t=this.sqlUrls[e];if(e>1)return t[this.paramsData.showType];if(1==e){var s,a=null===(s=this.paramsData)||void 0===s||null===(s=s.chooseMetaData)||void 0===s?void 0:s.type;if(a)return t[a]}return this.paramsData.sqlUrl},isAsync:function(){var e=+this.paramsData.metaDataType;return e>1?4!=e||+this.paramsData.orgAsync:-1!=e&&+this.paramsData.async},asyncSql:function(){var e=+this.paramsData.metaDataType;if(e>1){var t=this.sqlUrls[e],s=this.paramsData.showType;return 4==e?"user"==s?"oua/getUserByCurUnit":"oua/getDeptByCurUnit":t[s]}return this.paramsData.asyncSqlUrl},paginationSql:function(){var e=+this.paramsData.metaDataType;return e>1?"/oua/getOrgMoreData":this.paramsData.paginationSql},searchSql:function(){var e=+this.paramsData.metaDataType,t=this.sqlUrls[e];if(e>1){var s=this.paramsData.showType;return t[s+"Search"]}return this.paramsData.searchSqlUrl}},watch:{chooseNodeKeys:function(e,t){_.isEqual(e,t)||this.dispatchSetResult(e)},navs:{immediate:!0,handler:function(){var e,t=null===this||void 0===this||null===(e=this.$refs)||void 0===e?void 0:e.navsRef;t&&this.$nextTick((function(){t.scrollLeft=t.scrollWidth}))}}},mounted:function(){this.init()},beforeDestroy:function(){this.disconnectIntersectionObserver()},methods:{init:function(){var e=this.paramsData,t=e.metaDataType,s=e.staticData,a=this.nodeKey;if(this.isDesign){var i=[o()(o()({_name:"布局"},a,"bj"),"children",[o()({_name:"一行两列"},a,"yhll")]),o()({_name:"文本"},a,"wb")];-1==+t&&(i=JSON.parse(s||"[]")),this.setTreeLists(i)}else"6"!=t&&(this.setFixParams(),this.listsRequest())},setFixParams:function(){var e,t=+this.paramsData.metaDataType,s=c({},this.queryString);if(t>1)s.isAsy=!0,s.excludeDept=this.$replace(this.paramsData.excludeDept||"",this),s.excludeUser=this.$replace(this.paramsData.excludeUser||"",this),4==t&&(s.sExplanLevel=this.paramsData.showLevel,+(null===(e=this.paramsData)||void 0===e?void 0:e.orgAsync)||(s.isAsy=!1));else if(1==t){var a=this.paramsData.chooseMetaData||{};"meta"===a.type?(s.name=a.code.id,s.namespace=this.$vm?this.$vm.nameSpace:"",s.pageName=this.$vm?this.$vm.pageName:"",s.order="[]"):"ds"===a.type&&(s.rmId=a.code)}this.fixParams=s},setTreeLists:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.paramsData.tabId,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=[],l=0;Array.isArray(e)||(e=[e]);var r=this.searchValue?"listObjSearch":"listObj";return _.forEach(e,(function(e){var s=e[t.nodeKey];t.setNodeState(e,a),n.push(e),t[r][s]={children:e.children||[],noDisabledNum:-1,choosedNum:0,data:e,asynced:!1},t.isAsync||_.forEach(e.children,(function(s){t.setTreeLists(s,t.paramsData.tabId,e,!1)}))})),i||(this[r][s]={children:n,noDisabledNum:l,choosedNum:0,data:a}),this.searchValue?this.searchData=n:this.list=n,this.loading=!1,this.finished=!1,this.$nextTick((function(){t.createIntersectionObserver(n)})),n},setNodeState:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.paramsData,a=s.nodeKey,i=s.types,n=s.tabId;return e["_checked"]=this.chooseNodeKeys.includes(e[a])?1:-1,e["_isDisabled"]=e._isDisabled||!1,e["_tabIndex"]=this.tabIndex,e["_isParent"]=this.isParent(e),e["_parentKey"]=(null===t||void 0===t?void 0:t[a])||n,e["_inClient"]=!1,i&&!this.$eval(i,e)&&(e["_isDisabled"]=!0),this.$treeBox.excludeIdsAll.includes(e[this.nodeKey])&&(e["_isDisabled"]=!0),e["_isDisabled"]},isParent:function(e){var t;if(null!==e&&void 0!==e&&null!==(t=e.children)&&void 0!==t&&t.length)return!0;var s=this.paramsData,a=s.metaDataType,i=s.showType;if(this.isAsync&&this.asyncSql){var n;if(+a>1)if((null===e||void 0===e||null===(n=e.children)||void 0===n||!n.length)&&("dept"===i?!e.DeptCount:"user"===i&&(1===e.type||!e.DeptCount&&!e.UserCount)))return!1;return!e.isLeaf}return!1},dispatchSetResult:_.debounce((function(e){var t=this;e&&e.length||(this.searchSelData=[]);var s=[],a=this.nodeKey,i=[].concat(this.searchSelData);this.searchValue?_.forEach(this.searchData,(function(t){e.includes(t[a])&&!t._isDisabled&&s.push(t)})):(_.forEach(this.searchSelData,(function(t){e.includes(t[a])&&s.push(t)})),i=[].concat(s)),s=_.unionBy(s,a),this.searchSelData=s;var n=dsf.mix([],e),l=[],r=+this.$treeBox._maxTags;if(n.length){var o=1==r?"forEachRight":"forEach";_[o](e,(function(e){var s,a=t.listObjSearch[e];if(t.searchValue&&a&&!a.data._isDisabled){var i;if(a.data._checked=1,1==r)return null!==t&&void 0!==t&&null!==(i=t.$treeBox)&&void 0!==i&&null!==(i=i.defaultSelected)&&void 0!==i&&i.length&&t.$treeBox.reset(!0),l=[a.data],t.searchSelData=l,t.chooseNodeKeys=[e],!1;l.push(a.data)}else if(null!==(s=t.listObj[e])&&void 0!==s&&s.data){var n=t.listObj[e];if(!n.data._isDisabled){var o;if(n.data._checked=1,1==r)return null!==t&&void 0!==t&&null!==(o=t.$treeBox)&&void 0!==o&&null!==(o=o.defaultSelected)&&void 0!==o&&o.length&&t.$treeBox.reset(!0),l=[n.data],t.searchSelData=[],t.chooseNodeKeys=[e],!1;l.push(n.data)}}}))}else l=[];1!=r||l.length?1!=r&&(l=[].concat(l,s)):_.forEachRight(i,(function(e){if(l.push(e),l.length)return!1})),l=_.unionBy(l,a),1==r&&this.updateChooseAllState(this.searchValue?this.searchData:this.list),this.$dispatch("setResult",{data:l,index:this.tabIndex})}),150),onSearch:function(){var e,t=this;(this.searchData=[],this.searchValue=this.searchValueInput,this.searchValueInput)?this.dataFilter(this.searchValue):(null!==this&&void 0!==this&&null!==(e=this.$treeBox)&&void 0!==e&&null!==(e=e.$listeners)&&void 0!==e&&e.setDataBefore&&this.$treeBox.$dispatch("setDataBefore",{data:this.list,tabIndex:this.tabIndex,cancelSearching:!0,setData:function(e){t.list=e||t.list}}),this.$nextTick((function(){t.createIntersectionObserver(t.list)})))},disconnectIntersectionObserver:function(){this.intersectionObserver&&this.intersectionObserver.disconnect()},createIntersectionObserver:function(e,t){var s=this;this.disconnectIntersectionObserver(),this.intersectionObserverList=e;var a=!0,i=!1;_.each(this.intersectionObserverList,(function(e){e._inClient=!1,null===t||void 0===t||t(e);var n=!!s.chooseNodeKeys.includes(e[s.nodeKey]);e._isDisabled||n||(a=!1),n&&(i=!0)})),this.chooseAllState=i&&a,this.intersectionObserver=new IntersectionObserver(this.observerScroll),_.each(this.$refs.rows||[],(function(e){s.intersectionObserver.observe(e)}))},observerScroll:function(e){var t=this;_.each(e,(function(e){if(e.isIntersecting||e.intersectionRatio){var s,a=e.target.getAttribute("row-index"),i=null===t||void 0===t||null===(s=t.intersectionObserverList)||void 0===s?void 0:s[a];i&&t.$set(i,"_inClient",!0)}}))},dataFilter:_.debounce((function(e){var t=this;this.chooseAllState=!1,this.finished=!1;var s=dsf.layer.loading();if(this.searchSql)this.checkSearch(e,s);else{var a,i=[];_.forEach(_.keys(this.listObj),(function(s){var a=t.listObj[s].data;if(null!==a&&void 0!==a&&a[t.nodeKey]){var n=a.name||a._name;if(t.paramsData.searchKeys){var r=t.paramsData.searchKeys.split(","),o=l()(r,2),d=o[0],c=o[1];a[d]==c&&_.includes(n,e)&&i.push(a)}else _.includes(n,e)&&i.push(a)}})),null!==this&&void 0!==this&&null!==(a=this.$treeBox)&&void 0!==a&&null!==(a=a.$listeners)&&void 0!==a&&a.setDataBefore&&this.$treeBox.$dispatch("setDataBefore",{data:i,tabIndex:this.tabIndex,searching:!0,setData:function(e){i=e||i}}),i.length?(this.setTreeLists(i,"searchData",null,!0),this.setResult(i,-1)):this.finished=!0,this.searchData=i,this.$nextTick((function(){dsf.layer.closeLoading(s)}))}}),600),checkSearch:function(e,t){var s=this,a=dsf.mix({},this.fixParams);a.userName=e,a.keyWord=e,this.$http.get(this.$replace(this.searchSql,this.$expressParams(this)),a,"1"==this.paramsData.hasPrefix||this.paramsData.metaDataType>0).done((function(e){if(e.success){var t,i=(null===e||void 0===e?void 0:e.data)||[];if(dsf.isEmptyObject(i)&&(i=[]),!Array.isArray(i))i=(null===(t=i)||void 0===t?void 0:t.children)||new Array(i);var n=[];dsf.deepForEach(i,(function(e){n.push(e)}));try{var l;null!==s&&void 0!==s&&null!==(l=s.$treeBox)&&void 0!==l&&null!==(l=l.$listeners)&&void 0!==l&&l.setDataBefore&&s.$treeBox.$dispatch("setDataBefore",{data:n,tabIndex:s.tabIndex,searching:!0,params:a,setData:function(e){n=e||n}})}catch(r){dsf.error(r)}n.length?(s.setTreeLists(n,"searchData",null,!0),s.setResult(n,-1)):s.finished=!0,s.searchData=n}else dsf.layer.message(e.message,!1)})).error((function(e){var t;dsf.layer.message((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message),!1)})).always((function(){dsf.layer.closeLoading(t)}))},listsRequest:function(){var e=this,t=this.paramsData,s=t.metaDataType,a=t.staticData,i=t.pagination,n=t.pageSize;if("-1"==s){var l=JSON.parse(a||"[]");return this.setTreeLists(l),void this.setResult(l,-1)}var r=dsf.mix({},this.fixParams),o=this.initSql;if(o){this.loading=!0;var d=dsf.layer.loading();1*i&&(r.pageSize=n,r.pageNum=1),this.$http.get(this.$replace(o,this.$expressParams(this)),r,"1"==this.paramsData.hasPrefix||this.paramsData.metaDataType>0).done((function(t){if(t.success){var s=(null===t||void 0===t?void 0:t.data)||[];dsf.isEmptyObject(s)&&(s=[]),Array.isArray(s)||(s=new Array(s));try{var a;null!==e&&void 0!==e&&null!==(a=e.$treeBox)&&void 0!==a&&null!==(a=a.$listeners)&&void 0!==a&&a.setDataBefore&&e.$treeBox.$dispatch("setDataBefore",{data:s,tabIndex:e.tabIndex,initing:!0,params:r,setData:function(e){s=e||s}})}catch(i){dsf.error(i)}!s.length>0&&(e.noData=!0),e.setTreeLists(s),e.setResult(s,-1)}else dsf.layer.message(t.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})).always((function(){dsf.layer.closeLoading(d),e.$dispatch("treeLoaded",{data:e.list,tabIndex:e.tabIndex,type:"loadData"})}))}else dsf.layer.message("请在设计器内完成组件数据配置",!1)},toNextChildren:function(e,t){var s=this;if(!this.isDesign){var a=this.paramsData,i=a.pagination,n=a.pageSize,l=e[this.nodeKey],r=e,o=this.asyncSql;if(!this.isAsync||!o||this.listObj[l]&&this.listObj[l].asynced)this.listObj[l]&&(this.navs.push(e),this.list=this.listObj[l]["children"],this.setResult(this.list,e._checked),this.$nextTick((function(){s.createIntersectionObserver(s.list,(function(e){var t,a,i;(null===(t=s.$refs[e._id])||void 0===t||null===(t=t[0])||void 0===t?void 0:t.checked)!=e._checked&&-1!=e._checked&&(null===(a=s.$refs[e._id])||void 0===a||null===(a=a[0])||void 0===a||null===(i=a.toggle)||void 0===i||i.call(a))}))})));else{this.loading=!0;var d=dsf.layer.loading(),c=dsf.mix({},this.fixParams);c.sFID=l,1*i&&(c.pageSize=n,c.pageNum=1),this.$http.get(this.$replace(o,this.$expressParams(this,e)),c,"1"==this.paramsData.hasPrefix||this.paramsData.metaDataType>0).done((function(t){if(t.success){var a,i=(null===t||void 0===t?void 0:t.data)||[];if(dsf.isEmptyObject(i)&&(i=[]),!Array.isArray(i))i=null!==(a=i)&&void 0!==a&&a.children?i.children:new Array(i);try{var n;null!==s&&void 0!==s&&null!==(n=s.$treeBox)&&void 0!==n&&null!==(n=n.$listeners)&&void 0!==n&&n.setDataBefore&&s.$treeBox.$dispatch("setDataBefore",{data:i,tabIndex:s.tabIndex,toNextChildren:!0,params:c,setData:function(e){i=e||i}})}catch(o){dsf.error(o)}e.children=s.setTreeLists(i,l,r),s.listObj[l].asynced=!0,s.navs.push(e),s.setResult(s.list,e._checked),+s.paramsData.chooseOneNode>0&&-1!=e._checked&&s.$nextTick((function(){s.chooseAllState=e._checked,s.checkAll()}))}else dsf.layer.message(t.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})).always((function(){dsf.layer.closeLoading(d),s.$dispatch("treeLoaded",{data:s.list,tabIndex:s.tabIndex,type:"toChildren"})}))}}},checkedToggle:function(e){var t,s,a,i=this;if(!(e._isDisabled||e.required&&1==e._checked)){var n=1==e._checked?0:1;e._checked=n,null===(t=this.$refs[e._id])||void 0===t||null===(t=t[0])||void 0===t||null===(s=t.toggle)||void 0===s||s.call(t);var l,r=+this.paramsData.chooseOneNode;if(this.searchValue)e=null===(l=this.listObj[e[this.nodeKey]])||void 0===l?void 0:l.data,e&&(e._checked=n);if(0!=r&&e&&(!this.isAsync||(null===(a=this.listObj[e[this.nodeKey]])||void 0===a?void 0:a.asynced))&&1!=+this.$treeBox._maxTags){var o=this.getNodeDepth(e,[],n);this.chooseNodeKeys=_.xor(this.chooseNodeKeys,o)}if(1==r&&e&&1!=+this.$treeBox._maxTags){var d=[];this.getNodeParentDepth(e,d,n),this.chooseNodeKeys=_.xor(this.chooseNodeKeys,d)}this.updateChooseAllState(this.searchValue?this.searchData:this.list),this.$nextTick((function(){i.dispatchSetResult(i.chooseNodeKeys)}))}},getNodeParentDepth:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,a=this.nodeKey;if(e._parentKey){var i=this.listObj[e._parentKey];if(i.data){var n=!!s;if(n){var l=!1;_.forEach(i.children,(function(e){e._isDisabled||"1"==e._checked||(n=!1),1==e._checked&&(l=!0)})),n=l&&n}var r=i.data._checked;if(n){if(1!=r){var o,d;i.data._checked=1;var c=i.data[a];null===(o=this.$refs[c])||void 0===o||null===(o=o[0])||void 0===o||null===(d=o.toggle)||void 0===d||d.call(o),t.push(c)}}else if(1==r){var h,u;i.data._checked=0;var f=i.data[a];null===(h=this.$refs[f])||void 0===h||null===(h=h[0])||void 0===h||null===(u=h.toggle)||void 0===u||u.call(h),t.push(f)}this.getNodeParentDepth(i.data,t,s)}}},getNodeDepth:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,i=this.nodeKey,n=this.listObj[e[i]];return null===n||void 0===n||!n.children||this.isAsync&&!n.asynced||dsf.deepForEach(n.children,(function(e,n){var l,r;if(e._checked!=a){e._checked=a;var o=e[i];null===(l=t.$refs[o])||void 0===l||null===(l=l[0])||void 0===l||null===(r=l.toggle)||void 0===r||r.call(l),s.push(o)}})),s},changeNav:function(e){var t=this;if(e!=this.navs.length){this.navs.splice(e);var s=this.navs.length,a={};a=s>0?this.listObj[this.navs[s-1][this.nodeKey]]:this.listObj[this.paramsData.tabId],1*this.pagination&&(this.finished=a.pagination.finished),this.list=a["children"],this.$nextTick((function(){t.createIntersectionObserver(t.list)}))}},updateChooseAllState:function(e){var t=!0,s=!1;_.forEach(e,(function(e){var a=1==e._checked;e._isDisabled||a||(t=!1),a&&(s=!0)})),this.chooseAllState=s&&t},checkAll:function(){var e,t,s=this,a=[],i=this.chooseAllState?1:0,n=+this.paramsData.chooseOneNode,l=this.searchValue?this.searchData:this.list,r=this.nodeKey,o=!this.isAsync||(null===(e=this.listObj[null===l||void 0===l||null===(t=l[0])||void 0===t?void 0:t[this.nodeKey]])||void 0===e?void 0:e.asynced);if(l.length)if(n&&!this.searchValue&&1!=+this.$treeBox._maxTags){var d=o?dsf.deepForEach:_.forEach;d(l,(function(e,t){!i&&e.required||e._checked==i||e._isDisabled||(e._checked=i,a.push(e[r]))})),1==n&&1!=+this.$treeBox._maxTags&&this.getNodeParentDepth(l[0],a,i)}else _.forEach(l,(function(e,t){if((!e.required||i)&&e._checked!=i&&!e._isDisabled&&(e._checked=i,a.push(e[r]),s.searchValue&&s.listObj[e[r]])){var n,l=e[s.nodeKey],d=null===(n=s.listObj[l])||void 0===n?void 0:n.data;if(d&&d._checked!=i){d._checked=i;var c=+s.paramsData.chooseOneNode;1==c&&1!=+s.$treeBox._maxTags&&o&&s.getNodeParentDepth(d,a,i),0!=c&&1!=+s.$treeBox._maxTags&&s.getNodeDepth(d,a,i)}}}));a=_.union(a),this.chooseAllState?this.chooseNodeKeys=_.uniqBy(_.concat(this.chooseNodeKeys,a)):this.chooseNodeKeys=_.xor(_.concat(this.chooseNodeKeys,a),a)},setResult:function(e){var t,s=this;if(null!==this&&void 0!==this&&null!==(t=this.$treeBox)&&void 0!==t&&null!==(t=t.defaultSelected)&&void 0!==t&&t.length){var a=this.$treeBox.defaultSelected;this.$nextTick((function(){var t={};_.forEach(a,(function(e){t[e[s.nodeKey]]=e}));var i=[];_.forEach(e,(function(e,a){var n=t[e[s.nodeKey]];null!==n&&void 0!==n&&n.required&&(e.required=!0),n&&!e._isDisabled&&(s.$dispatch("deleteDefaultSelected",e),i.push(e._id))})),s.chooseNodeKeys=_.xor(s.chooseNodeKeys,i)}))}},deleteResult:function(e){var t=this.nodeKey;if(this.chooseNodeKeys.includes(e[t]))if(this.$refs[e[t]]&&this.$refs[e[t]].length&&e._inClient)this.checkedToggle(e);else if(e._parentKey){var s,a=e._parentKey,i=_.find((null===(s=this.listObj)||void 0===s||null===(s=s[a])||void 0===s?void 0:s.children)||[],o()({},t,e[t]));this.chooseNodeKeys=_.xor(this.chooseNodeKeys,[e[t]]),this.checkedToggle(i)}},loadMore:function(){var e=this;if(this.list&&this.list.length>0){var t=this.listObj[this.navs[this.navs.length-1]?this.navs[this.navs.length-1][this.nodeKey]:void 0],s=t.pagination,a=s.params;this.loading||this.finished||(this.loading=!0,s.loading=!0,t.pagination.params.pageNum++,this.$http.get(this.$replace(this.paginationSql,this.$expressParams(this,t.data)),a,"1"==this.paramsData.hasPrefix||this.paramsData.metaDataType>0).done((function(i){if(i.success){var n=(null===i||void 0===i?void 0:i.data)||[];dsf.isEmptyObject(n)&&(n=[]),Array.isArray(n)||(n=new Array(n));try{var l;null!==e&&void 0!==e&&null!==(l=e.$treeBox)&&void 0!==l&&null!==(l=l.$listeners)&&void 0!==l&&l.setDataBefore&&e.$treeBox.$dispatch("setDataBefore",{data:n||[],tabIndex:e.tabIndex,loadingMore:!0,params:a,setData:function(e){n=e||n}})}catch(o){dsf.error(o)}e.setTreeLists(n,t.data[e.nodeKey],t.data,!0);var r=!1;n.length<e.pageSize&&(r=!0,e.finished=!0),s.loading=!1,s.finished=r,self.$dispatch("treeLoaded",{data:self.list,tabIndex:self.tabIndex,type:"loadMore"})}else dsf.layer.message(i.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})))}}},inject:{$treeBox:{default:null}}}),u=h,f=s(0),p=Object(f["a"])(u,a,i,!1,null,null,null);t["default"]=p.exports},1212:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control mobile ds-ouaselect"},[1==e.paramsData.showSearch?s("van-search",{attrs:{shape:"round",placeholder:"搜索"},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}):e._e(),s("div",{ref:"header",staticClass:"header"},[s("van-checkbox",{staticClass:"tool",on:{click:e.checkAll},model:{value:e.chooseAllState,callback:function(t){e.chooseAllState=t},expression:"chooseAllState"}},[e._v(" 全选 ")])],1),e.defaultListData?s("div",{staticClass:"main"},[0===e.defaultListData.initialsList.length?s("dsf-empty-data",{attrs:{description:"没有更多了"}}):s("van-index-bar",{attrs:{"highlight-color":"#1989fa","sticky-offset-top":130,sticky:!1,"index-list":e.defaultListData.initialsList}},e._l(e.defaultListData.initialsList,(function(t,a){return s("div",{key:a},[s("van-index-anchor",{attrs:{index:t}},[s("div",{staticClass:"letter-name"},[s("label",[e._v(e._s(t))])]),s("van-checkbox-group",{model:{value:e.result,callback:function(t){e.result=t},expression:"result"}},e._l(e.list,(function(a,i){return s("van-cell-group",{key:i},[a.initials==t?s("van-cell",{staticClass:"ds-multi-ellipsis-2",attrs:{border:!1},on:{click:function(t){return e.toggle(i,a)}},scopedSlots:e._u([{key:"title",fn:function(){return[s("van-checkbox",{ref:"checkboxes",refInFor:!0,attrs:{name:a,disabled:a._isDisabled}},[e._v(" "+e._s(a.name)+" ")])]},proxy:!0}],null,!0)}):e._e()],1)})),1)],1)],1)})),0)],1):e._e()],1)},i=[],n=s(3),l=s.n(n),r=dsf.component({name:"DsfMobileIndexBar",ctrlCaption:"索引栏",mixins:[$mixins.control],props:{tabIndex:{type:[Number,String],default:0},paramsData:{type:Object,default:function(){return{}}},defaultSelected:{type:Array,default:function(){return[]}},chooseIf:{type:String,default:""},chooseOneNode:{type:String,default:"1"},defaultOpenSeries:{type:[String,Number],default:"1"},dataSource:{type:String,default:"0"},chooseMetaData:{type:Object,default:function(){return{}}},sqlUrl:{type:String,default:""},chooseType:{type:String,default:"dept"},orgLevel:{type:[String,Number],default:"0"},data:{type:Array,default:function(){return[]}},nodeKey:{type:String,default:"_id"},excludeIds:{type:Array,default:function(){return[]}},valueNodeKey:{type:String,default:"_id"},chooseOneNodeSpecial:{type:String,default:"0"},isAsync:{type:String,default:"0"},asyncSqlUrl:{type:String,default:""},pagination:{type:String,default:"0"},pageSize:{type:Number,default:1},paginationSql:{type:String,default:""},excludeDept:{type:String,default:""},excludeUser:{type:String,default:""},staticData:{type:String,default:""}},data:function(){return{defaultListData:null,result:[],chooseAllState:!1,list:[],searchValue:""}},watch:{searchValue:function(e){if(e){var t=_.filter(this.defaultListData.contactsUserTree,(function(t){return-1!==t.name.indexOf(e)}));this.list=t,this.defaultListData.initialsList=_.keys(_.groupBy(t,"initials"))}else this.defaultListData.initialsList=_.keys(_.groupBy(this.defaultListData.contactsUserTree,"initials")),this.list=this.defaultListData.contactsUserTree;this.chooseAllState=this.defaultListData.contactsUserTree.length==this.result.length},result:function(e){this.dispatchSetResult(e)},staticData:function(){this.loadData()}},created:function(){var e=this;this.loadData(),this.dispatchSetResult=_.debounce((function(t){e.$dispatch("setResult",{data:t,index:e.tabIndex})}),100)},methods:{init:function(){this.navs=[],this.chooseAllState=!1,this.list=[],this.listObj={},this.result=[],this.asyncSql=null},loadData:function(){if(this.isDesign){var e=this.nodeKey,t=[l()(l()(l()({},e,"wz"),"name","文字"),"initials","A"),l()(l()(l()({},e,"wb"),"name","文本"),"initials","D"),l()(l()(l()({},e,"yh"),"name","一行两列"),"initials","D"),l()(l()(l()({},e,"sh"),"name","一行三列"),"initials","C")],s=["A","D","C"];-1==+this.dataSource&&(t=JSON.parse(this.staticData||"[]")),this.defaultListData={contactsUserTree:t,initialsList:s},this.list=_.groupBy(t,"initials")}else"6"!=this.dataSource&&this.listsRequest()},listsRequest:function(){var e=this;this.loading=!0;var t=dsf.layer.loading();this.paramsData.sqlUrl?this.$http.get(this.$replace(this.paramsData.sqlUrl,this.$expressParams(this))).done((function(t){t.success?t.data.contactsUserTree&&t.data.contactsUserTree.length&&e.setLists(t.data):dsf.layer.message(t.message,!1)})).error((function(){dsf.layer.message("服务器异常",!1)})).always((function(){dsf.layer.closeLoading(t)})):dsf.layer.message("请在设计器内完成组件数据配置",!1)},setLists:function(e){var t=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.defaultListData=e;var a={},i=[],n=this.nodeKey,l=this;if(_.forEach(e.contactsUserTree,(function(e){var r=e[n],o=e.treeinfo_pid;l.setNodeState(e,t),e._isDisabled||0,s||(a[r]=e,a[o]?(a[o]["children"]||(a[o]["children"]=[]),a[o]["children"].push(e),l.listObj[o]={children:a[o]["children"],noDisabledNum:-1,choosedNum:0}):i.push(e))})),s?this.setChooseAllState?this.setResult({_checked:1}):this.setResult(t):(this.list=_.sortBy(i,"initials"),this.setResult(t)),this.loading=!1,this.finished=!1,this.asyncSql)return _.sortBy(i,"initials")},setNodeState:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e["_checked"]=-1,e["_isDisabled"]=!1,e["_tabIndex"]=this.tabIndex,e["_isParent"]=this.isParent(e),e["_parentKey"]=t[this.nodeKey]||"undefined",this.chooseIf&&!this.$eval(this.chooseIf,e)&&(e["_isDisabled"]=!0),this.excludeIds.includes(e[this.valueNodeKey])&&(e["_isDisabled"]=!0),e["_isDisabled"]},isParent:function(e){var t;return this.asyncSql?!e.isLeaf&&!!(null!==(t=e.children)&&void 0!==t&&t.length||("dept"===this.chooseType?e.DeptCount:"user"!==this.chooseType||1!==e.type&&(e.DeptCount||e.UserCount))||0!=e.total):e.children&&e.children.length>0},setResult:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{_checked:-1};this.$nextTick((function(){var s=e,a=parseInt(e.chooseOneNode)>0,i=_.map(s.defaultSelected,(function(e){return e[s.valueNodeKey]}));_.forEach(e.defaultListData.contactsUserTree,(function(n,l){i.includes(n[s.valueNodeKey])&&!n._isDisabled?(e.$dispatch("deleteDefaultSelected",n),s.toggle(l,n,!0)):-1==t._checked?e.getResultVals(n[s.nodeKey])>-1?s.$refs.checkboxes[l].toggle(!0):s.$refs.checkboxes[l].toggle(!1):a&&(s.chooseAllState=1==t._checked,s.checkAll())})),-1!=t._checked&&(t._checked=-1)}))},toggle:function(e,t,s){var a=this.$refs.checkboxes[e].checked;t._checked=a?0:1,s&&this.$refs.checkboxes[e].toggle();var i=this.getResultVals(t[this.nodeKey]);e>-1&&(this.result[i]=t),this.chooseAllState=!a&&this.defaultListData.contactsUserTree.length==this.result.length+1},setChooseAllState:function(e){var t,s=this,a=(null===(t=_.findLast(this.navs))||void 0===t?void 0:t[this.nodeKey])||"undefined";if(e||(e=a),a==e){_.forEach(this.list,(function(e){var t=s.getResultVals(e[s.nodeKey]);t>-1&&(s.result[t]=e)}))}},checkAll:function(){var e=this,t=0,s=this;_.forEach(this.$refs.checkboxes,(function(a,i){a.disabled||(t=1,a.name._checked=e.chooseAllState?1:0,a.toggle(s.chooseAllState))})),0!=t||(this.chooseAllState=!1)},getChilds:function(e,t,s){var a=this;e&&e.length>0&&parseInt(this.chooseOneNode)>0&&_.forEach(e,(function(e){if(!e._isDisabled){var i=a.getResultVals(e[a.nodeKey]);e._checked=t?1:0,-1==i&&t?(s&&!e._parentKey&&(e._parentKey=s[a.nodeKey]),e._tabIndex=a.tabIndex,a.result.push(e)):i>-1&&!t&&a.result.splice(i,1),e.children&&a.getChilds(e.children||[],t,e)}}))},getResultVals:function(e){var t=this,s=_.map(this.result,(function(e){return null===e||void 0===e?void 0:e[t.nodeKey]}));return e?s.indexOf(e):s},deleteResult:function(e){var t=this,s=_.findIndex(this.list,(function(s){return s[t.nodeKey]==e[t.nodeKey]}));s>-1&&(this.$refs.checkboxes[s].toggle(!1),this.chooseAllState=!1);var a=this.getResultVals(e[this.nodeKey]);a>-1&&this.result.splice(a,1)}}}),o=r,d=s(0),c=Object(d["a"])(o,a,i,!1,null,null,null);t["default"]=c.exports},1238:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control ds-mobile-virtual-tree"},[s("div",{staticClass:"ds-mobile-virtual-tree-bread"},e._l(e.selectExpandedNodes,(function(t,a){return s("div",{key:t.id,staticClass:"ds-mobile-virtual-tree-bread-item",attrs:{"current-show":a==e.selectExpandedNodes.length-1}},[a>0?s("dsf-icon",{staticClass:"ds-mobile-virtual-tree-bread_icon",attrs:{name:"weibiaoti34"}}):e._e(),s("div",{staticClass:"ds-mobile-virtual-tree-bread_label",on:{click:function(s){return e.selectExpandedNode(t)}}},[e._v(" "+e._s(t.label)+" ")])],1)})),0),s("div",{staticClass:"ds-mobile-virtual-tree-all-check-row"},[s("div",{key:e.renderKey,staticClass:"ds-mobile-virtual-tree-check-warp",attrs:{check:e.currentExpandedNode.checked,indeterminate:e.currentExpandedNode.indeterminate,type:e.checkStyle},on:{click:function(t){return t.stopPropagation(),e.currentExpandedNodeCheckClick()}}},[s("div",{staticClass:"ds-mobile-virtual-tree_check"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.currentExpandedNode.indeterminate,expression:"currentExpandedNode.indeterminate"}],staticClass:"ds-mobile-virtual-tree-check_icon",attrs:{indeterminate:""}}),s("dsf-icon",{directives:[{name:"show",rawName:"v-show",value:!e.currentExpandedNode.indeterminate,expression:"!currentExpandedNode.indeterminate"}],staticClass:"ds-mobile-virtual-tree-check_icon",attrs:{name:"duigou"}})],1),s("div",{staticClass:"ds-mobile-virtual-tree-check_label"},[e._v("全选")])])]),s("div",{ref:"treeList",staticClass:"ds-mobile-virtual-tree-scroll",on:{scroll:e.scrollChange}},[s("div",{staticClass:"ds-mobile-virtual-tree_warp",style:"height: "+e.maxHeight+"px;"},e._l(e.showNodes,(function(t){return s("div",{key:t.id,staticClass:"ds-mobile-virtual-tree-node",style:t.style,on:{click:function(s){return s.stopPropagation(),e.clickNode(t,s)}}},[s("div",{key:e.renderKey,staticClass:"ds-mobile-virtual-tree__content"},[s("div",{staticClass:"ds-mobile-virtual-tree-check-warp",attrs:{check:t.checked,indeterminate:t.indeterminate,type:e.checkStyle},on:{click:function(s){return s.stopPropagation(),e.checkboxClick(t,!t.checked)}}},[s("div",{staticClass:"ds-mobile-virtual-tree_check"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.indeterminate,expression:"node.indeterminate"}],staticClass:"ds-mobile-virtual-tree-check_icon",attrs:{indeterminate:""}}),s("dsf-icon",{directives:[{name:"show",rawName:"v-show",value:!t.indeterminate,expression:"!node.indeterminate"}],staticClass:"ds-mobile-virtual-tree-check_icon",attrs:{name:"duigou"}})],1)]),s("div",{staticClass:"ds-mobile-virtual-tree_label"},[e._t("default",(function(){return[e._v(" "+e._s(t.label)+" ")]}),{data:t.data,node:t})],2),s("div",{staticClass:"ds-mobile-virtual-tree_btns"},[e._t("btns",(function(){return[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isExpandedOpacity(t),expression:"!isExpandedOpacity(node)"}],staticClass:"ds-mobile-virtual-tree_btn",on:{click:function(s){return s.stopPropagation(),e.selectExpandedNode(t)}}},[s("dsf-icon",{attrs:{name:"zuzhixiaxia"}}),e._v("下级 ")],1)]}),{data:t.data,node:t})],2)])])})),0)])])},i=[],n=s(8),l=s.n(n),r=s(2),o=s.n(r),d=dsf.component({name:"DsfMobileVirtualTree",ctrlCaption:"虚拟树",mixins:[$mixins.virtualTreeMixins],props:{nodeHeight:{default:56},checkStyle:{default:"square",filter:function(e){return"square"!=e&&"circle"!=e?"square":e}}},data:function(){return{selectExpandedNodes:[{}],dragstart:!1,isInit:!1,showHeight:0,scrollY:0,maxHeight:0,showNodes:[],totalData:0,currentNode:null,filterText:null,updateCurrentExpandedNodeKey:0}},computed:{currentExpandedNode:function(){return this.selectExpandedNodes[this.selectExpandedNodes.length-1]}},methods:{currentExpandedNodeCheckClick:function(){var e=this.currentExpandedNode;this.checkboxClick(e,!e.checked)},scrollChange:function(e){this.onScroll(e,e.target)},updateMaxHeight:function(){this.filterNodeData;var e,t=this.nodeHeight,s=(null===(e=this.currentExpandedNode)||void 0===e?void 0:e.childNodes)||[],a=o()(s||[]),i=0;while(a.length){var n=a.shift(),l=this.getNode(n);l.top=i;var r=t+"px";l.style={height:r,"line-height":r,top:l.top+"px"},i+=t}this.maxHeight=i,this.updateShowNodes()},updateShowNodes:function(){var e,t=this,s=this.nodeHeight,a=this.showHeight,i=this.scrollY;if(!a)return this.showNodes=[];var n=Math.floor(i/s)-2;n<0&&(n=0);var l=n+Math.ceil(a/s)+4,r=(null===(e=this.currentExpandedNode)||void 0===e?void 0:e.childNodes)||[];this.showNodes=r.slice(n,l).map((function(e){var s=e.id;return t.nodeMap[s]})).filter((function(e){return!!e}))},updateShowHeight:function(){this.showHeight=this.$refs.treeList.clientHeight,this.updateMaxHeight()},selectExpandedNode:function(e){var t,s;if(e&&e.id!=this.currentExpandedNode.id){var a=[];while(e)a.unshift(e),e=e.parent;(t=this.selectExpandedNodes).splice.apply(t,[0,this.selectExpandedNodes.length].concat(a)),this.scrollY=0,null!==this&&void 0!==this&&null!==(s=this.$refs)&&void 0!==s&&s.treeList&&(this.$refs.treeList.scrollTop=this.scrollY),this.updateMaxHeight()}},nodeScrollIntoView:function(){return console.warn("移动端虚拟树暂不支持nodeScrollIntoView方法")}},created:function(){this.selectExpandedNode(this.nodeTree)},mounted:function(){var e=this;this.__resizeObserver=new ResizeObserver((function(t){var s=l()(t,1);s[0];e.updateShowHeight()})),this.__resizeObserver.observe(this.$refs.treeList)}}),c=d,h=(s(817),s(0)),u=Object(h["a"])(c,a,i,!1,null,null,null);t["default"]=u.exports},1285:function(e,t,s){"use strict";s.r(t);var a,i,n=dsf.component((function(){var e=dsf.getComponentOptions($components.platform.DsfMobileTreeSelector);return{name:"DsfMobileCheckNode",mixins:[e],ctrlCaption:"组织架构选择",props:{}}})),l=n,r=s(0),o=Object(r["a"])(l,a,i,!1,null,null,null);t["default"]=o.exports},590:function(e,t,s){var a=s(818);"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=s(19).default;i("45fcaba8",a,!0,{sourceMap:!1,shadowMode:!1})},817:function(e,t,s){"use strict";s(590)},818:function(e,t,s){"use strict";s.r(t)}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_mobile_tree_module.js.map