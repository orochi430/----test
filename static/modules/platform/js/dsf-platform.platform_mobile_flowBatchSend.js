/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[16],{948:function(e,s,o){"use strict";o.r(s);var t=o(4),i=o.n(t),n=o(8),a=o.n(n),l=o(1),r=o.n(l),d={flowSend:function(e,s,o){var t=this,i=s.targetButton,n=s._self,a=i.line,l=i.completed,r=this.$vm.flows.flowInfo;if(r){var d=r.chooseFlow.dsfa_rm_id;if(d){var h,f,c,u=Object.assign({},dsf.removePoint(this.$vm.$viewData),this.$route.query),m="wfr/batchStartSend",v={sObjects:JSON.stringify(o),sWFID:d,sCurNodeID:"",sExInfos:JSON.stringify(u)};if(this.$route.query.sPID||n.$vm.$dialog||this.queryString.sPID){m="wfr/batchSend";var p=[];o.forEach((function(e){p.push({PID:n.$vm.$dialog?e.sPID:t.$route.query.sPID||t.queryString.sPID,LinkID:n.$vm.$dialog?e.sCurLinkID:t.$route.query.sCurLinkID||t.queryString.sCurLinkID})})),v.sObjects=JSON.stringify(p)}null!==(h=this.$vm)&&void 0!==h&&null!==(h=h.flows)&&void 0!==h&&null!==(h=h.disposeIdea)&&void 0!==h&&h.sOpinion&&(v.sOpinion=JSON.stringify(this.$vm.flows.disposeIdea.sOpinion)),(null!==(f=this.$vm)&&void 0!==f&&null!==(f=f.flows)&&void 0!==f&&null!==(f=f.sOpinion)&&void 0!==f&&f.Content||(null===(c=this.$vm)||void 0===c||null===(c=c.flows)||void 0===c||null===(c=c.sOpinion)||void 0===c||null===(c=c.Attachments)||void 0===c?void 0:c.length)>0)&&(v.sOpinion=JSON.stringify(this.$vm.flows.sOpinion)),a&&(v.sLineIDs=a.LineID);var $={param:v,url:m};this.$http.post($.url,$.param).then((function(e){t.handler(e,l)})).catch((function(e){dsf.layer.message("发送异常",!1),t._RequestID=null}))}else dsf.layer.message("请先配置流程信息控件的'选择流程'",!1)}else dsf.layer.message("请先配置流程信息控件的'选择流程'",!1)},handler:function(e,s){if(2e4==e.data.state){var o=e.data.data;if(this._RequestID=o.RequestID,2e4==o.Code||20001==o.Code||20003==o.Code||20004==o.Code||20005==o.Code)this.$vm&&this.$vm.$dialog?this.$vm.$dialog.openerVm.reloadData():this.$vm.$openerVm?this.$vm.$openerVm&&this.$vm.$openerVm.reloadData&&this.$vm.$openerVm.reloadData():this.$vm.openerVm&&this.$vm.openerVm.reloadData&&this.$vm.openerVm.reloadData(),this.directlySend(o,s);else if(81e3==o.Code)this.chooseSendNode(o);else if(82e3==o.Code)this.chooseSendTree(o);else{var t=o.Message;o.EsMessage&&(t=t+"."+o.EsMessage),dsf.layer.message(t||"未知流程类型发送",!1)}}else{this._RequestID=null;var i=data.Message;data.EsMessage&&(i=i+"."+data.EsMessage),dsf.layer.message(i||"发送异常",!1)}},directlySend:function(e,s){var o=this,t=[];if(2e4==e.Code){var i;if(e.BatchResults){if(dsf.layer.message("发送成功"),this.$vm.$dialog.close(),this.$vm.$dialog){if(this.$vm.$openerVm.$refs)for(var n=0,l=Object.entries(this.$vm.$openerVm.$refs);n<l.length;n++){var r=a()(l[n],2),d=(r[0],r[1]);"DsfMobileDataGrid"===d.ctrlName&&d.reloadData()}this.$vm.$openerVm.reloadData()}else window.opener&&(window.opener.reloadData&&window.opener.reloadData(!0),window.close());return}var h=e.Links;h.forEach((function(e,s){if(0==e.Status&&e.LinkUser){var o=e.LinkUser,i=e.LinkUser.Type;1==i?t.push(o.UserName):2==i?t.push("".concat(o.DeptName,"-").concat(o.RoleName)):3==i?t.push(o.JobName):4==i&&t.push("".concat(o.UserName,"-").concat(o.RelationName))}})),dsf.layer.openDialog({type:"dialog",title:"流程已发送到以下人员：",width:"300px",height:"200px",content:"SendFlowDialog",showClose:!1,params:{list:_.uniq(t),showCountDown:!this.$vm.$dialog,countDownTime:null===(i=this.$vm.flows.flowInfo)||void 0===i?void 0:i.countDown},btns:[{text:"确定",class:"sendFlow",handler:function(e){return dsf.global.$isMobile?(o.$router.go(-1),!0):(o.$vm.$dialog?(o.$vm.$dialog.openerVm.reloadData(),o.$vm.$dialog.close()):window.opener&&(window.opener.reloadData&&window.opener.reloadData(!0),window.close()),!0)}}]})}else{var f,c="发送成功",u=e.Code;switch(u){case 20004:c=s||"文件已办结";break;case 20005:c=s||"文件已办结";break}dsf.layer.openDialog({type:"dialog",title:"提示",width:"300px",height:"100px",content:"SendFlowDialog",params:{msg:c,countDownTime:null===(f=this.$vm.flows.flowInfo)||void 0===f?void 0:f.countDown},btns:[{text:"确定",class:"sendFlow",handler:function(e){return dsf.global.$isMobile?(o.$router.go(-1),!0):(o.$vm.$dialog?(o.$vm.$dialog.openerVm.reloadData(),o.$vm.$dialog.close()):window.opener&&(window.opener.reloadData&&window.opener.reloadData(!0),window.close()),!0)}}]})}},chooseSendNode:function(e){var s=50*e.SendParams.Lines.length+62;this.dialog=this.$openDialog({height:s+"px",hasHeader:!1,hasFooter:!1,content:"DsfMobileChooseSendNode",params:{requestID:this._RequestID,lines:e.SendParams.Lines,title:"请选择要发送的环节：",callback:this.chooseNode,showBack:!1,back:function(){},isBatch:!0},btns:[]})},chooseNode:function(e){var s=this,o={sRequestID:this._RequestID,sLineID:e.LineID};this.$http.post("wfr/batchSendToLine",o).then((function(e){2e4==e.data.state&&s.handler(e)}))},chooseSendTree:function(e){var s=this;dsf.layer.openDialog({type:"dialog",title:"请选择办理人",fullscreen:!0,width:"100vw",height:"100vh",class:"work_flow-usersDialog",content:"DsfMobileChooseUsers",btnPosition:"bottom",params:{lines:e.SendParams.Lines},btns:[{text:"取消"},{text:"确定",handler:function(e){if(e.validate()){var o,t=e.yes(),i={sRequestID:s._RequestID,sReceivers:t.sReceivers};if(t.disposeIdea){var n=t.disposeIdea,a={Content:n.inputValue,Attachments:n.multipleFiles};i.sOpinion=JSON.stringify(a)}return s.$http.post("wfr/batchSendToReceivers",i).then((function(e){2e4==e.data.state&&s.handler(e)})),null===(o=document.querySelector(".close-send-node"))||void 0===o||o.click(),!0}return!1}}]})}},h=function(){var e=i()(r.a.mark((function e(s){var o,t,i,n,l,h,f,c,u;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=s._self.$form,!o){e.next=7;break}return t={isSilent:!0,isRefresh:!0,savedClose:!1,successMsg:"",errorMsg:""},e.next=5,o.formSave(t);case 5:i=e.sent,i&&i.data&&(n=[],l=s._self.$vm&&s._self.$vm.$dialog&&s._self.$vm.$dialog.dialogArgs&&s._self.$vm.$dialog.dialogArgs.data||[],s._self.$vm.$dialog&&l.length>0?n=l:(h=a()(s.params,3),f=h[0],c=h[1],u=h[2],f=f.split(","),c=c.split(","),u=u.split(","),f.forEach((function(e,s){i.data[e].forEach((function(e){n.push({ObjectID:e[c[s]||c[0]],ObjectName:e[u[s]||u[0]]})}))}))),Object.assign(s._self,d),s._self.flowSend(i,s,n));case 7:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();s["default"]=h}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_mobile_flowBatchSend.js.map