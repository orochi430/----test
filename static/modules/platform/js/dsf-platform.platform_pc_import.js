/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[49],{575:function(e,t,r){var i=r(790);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=r(19).default;n("69910f10",i,!0,{sourceMap:!1,shadowMode:!1})},576:function(e,t,r){var i=r(792);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=r(19).default;n("d115c620",i,!0,{sourceMap:!1,shadowMode:!1})},789:function(e,t,r){"use strict";r(575)},790:function(e,t,r){"use strict";r.r(t)},791:function(e,t,r){"use strict";r(576)},792:function(e,t,r){"use strict";r.r(t)},967:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.checkLoading,expression:"checkLoading"}],staticClass:"dsf-common-user-import dsf-common-user-import-style"},[r("div",{staticClass:"dsf-common-user-import-head"},[r("span"),r("div",[r("el-switch",{attrs:{value:!e.tooltipError},on:{input:function(t){e.tooltipError=!e.tooltipError}}}),e._v(" 显示错误详情 ")],1)]),r("div",{ref:"import-body",staticClass:"dsf-common-user-import-body"},[e.tableHeight?r("dsf-el-table",{staticStyle:{width:"100%"},attrs:{data:e.paginationTableData,border:"",stripe:"","tree-props":e.treeProps,"row-key":"_rowId",height:e.tableHeight,"default-expand-all":"","row-class-name":e.rowClassName}},[r("el-table-column",{attrs:{label:"序号",width:"90",fixed:"left",resizable:!1},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}],null,!1,3056706777)}),e._l(e.headers,(function(t,i,n){return r("el-table-column",e._b({key:n,attrs:{prop:t.name,resizable:!1},scopedSlots:e._u([{key:"default",fn:function(n){return[r("div",{staticClass:"table-cell-warp",attrs:{tooltip:e.tooltipError}},[r("div",{staticClass:"table-cell-warp-text"},[e.getTableRowCellIsReadOnly(n.row._rowId,t)?r("span",{staticClass:"cell-proxy-text"},[e._v(" "+e._s(e.getOriginFiledValue(n.row._rowId,t.name))+" ")]):r("el-input",{attrs:{value:e.getOriginFiledValue(n.row._rowId,t.name),size:"small"},on:{input:function(r){return e.setOriginFiledValue(n.row._rowId,t.name,r)},change:function(r){return e.setOriginFiledChange(n.row._rowId,t.name,r)}}})],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.getTableRowIsShowErrorInfo(n.row._rowId,t.name,"errorInfo"),expression:"\n                getTableRowIsShowErrorInfo(\n                  scope.row._rowId,\n                  header.name,\n                  'errorInfo'\n                )\n              "}],staticClass:"cell-err-msg"},[e._v(" "+e._s(e.getOriginFiledErrorMessage(n.row._rowId,t.name))+" ")]),r("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.getTableRowIsShowErrorInfo(n.row._rowId,t.name,"tooltipError"),expression:"\n                getTableRowIsShowErrorInfo(\n                  scope.row._rowId,\n                  header.name,\n                  'tooltipError'\n                )\n              "}],attrs:{disabled:!e.getTableRowIsShowTooltipErrorInfo(n.row._rowId,t.name),placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(e.getOriginFiledErrorMessage(n.row._rowId,t.name))+" ")]),r("dsf-icon",{attrs:{name:"jinggao",disabled:!e.getTableRowIsShowTooltipErrorInfo(n.row._rowId,t.name)}})],1),e.getTableRowIsShowIdentifying(n,i)?[r("div",{staticClass:"cell-identifying",attrs:{type:n.row.type,title:1==n.row.type?"Excel表格":"数据库"}},[1==n.row.type?r("dsf-icon",{attrs:{name:"tab-template"}}):r("dsf-icon",{attrs:{name:"qian1"}})],1)]:e._e()],2)]}}],null,!0)},"el-table-column",t,!1),[t.isRequired?r("template",{slot:"header"},[r("span",{class:{"table-require-cell":t.isRequired}},[e._v(" "+e._s(t.label)+" ")])]):e._e()],2)})),r("el-table-column",{attrs:{prop:"address",label:"操作",width:"280",fixed:"right",align:"left",resizable:!1},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.operateBtnList,(function(i,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.getIsShowBtnGroup(t,i),expression:"getIsShowBtnGroup(scope, group)"}],key:n,staticClass:"radio-button-group",attrs:{num:i.btns.length,disabled:e.getIsDisabledBtnGroup(t,i)}},e._l(i.btns,(function(i){return r("div",{key:i.value,staticClass:"radio-button-item",attrs:{type:i.value,ac:t.row.operateType==i.value,disabled:e.getIsDisabledBtn(t,i)},on:{click:function(r){return e.rowOperateTypeChange(t,i)}}},[e._v(" "+e._s(i.label)+" ")])})),0)}))}}],null,!1,2587124695)})],2):e._e()],1),r("div",{staticClass:"dsf-common-user-import-foot"},[r("span"),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("span",[e._v("共"+e._s(e.total)+"条")]),r("el-pagination",{attrs:{background:"",layout:"prev, pager, next, jumper",total:e.tableData.length,"page-size":e.pageSize,"current-page":e.pageNum},on:{"current-change":function(t){return e.pageNum=t},"size-change":function(t){return e.pageSize=t}}})],1)]),r("UserMergePanel",{attrs:{visible:e.mergePanelVisible,currentMergeRowId:e.currentMergeRowId},on:{close:e.mergePanelClose}})],1)},n=[],o=r(3),a=r.n(o),s=r(34),l=r.n(s),u=r(33),d=r.n(u),c=dsf.validate.map,p=l()((function e(){d()(this,e),a()(this,"state",!0),a()(this,"message","")})),f={unique:function(e,t){var r=new p;return r},isRequired:function(e,t){var r=new p;return r.state=!(""==e||null==e||void 0==e),r.message="该字段是必填",r},number:function(e,t){var r=new p,i=c["isNumberUnder"].validator,n=c["isNumberOver"].validator,o=c["isNumber"].validator,a=c["precision"].validator,s=t.min,l="number"==dsf.type(s),u=t.max,d="number"==dsf.type(u),f=t.scaleDecimal,g="number"==dsf.type(f),h="该字段应该是";return!l&!d&!g?h+="数字":(l&&d?h+="".concat(s,"-").concat(u,"之间"):l?h+="大于或等于".concat(s):d&&(h+="小于或等于".concat(s)),g&&(h+=",并且保留".concat(f,"位小数")),h+="的数字"),"function"!=dsf.type(o)||o(e)?(g&&"function"==dsf.type(a)&&!a(e,f)||l&&"function"==dsf.type(i)&&i(e,s)||d&&"function"==dsf.type(n)&&n(e,u))&&(r.state=!1):r.state=!1,r.state||(r.message=h),r},chinese:function(e,t){var r=new p,i=e.length,n=c["isChinese"].validator,o=t.min,a="number"==dsf.type(o),s=t.max,l="number"==dsf.type(s),u="该字段应该是";return a&&l?u+="长度在".concat(o,"-").concat(s,"之间的"):a?u+="长度大于或等于".concat(o,"的"):l&&(u+="长度小于或等于".concat(o,"的")),u+="全中文字符","function"!=dsf.type(n)||n(e)?(a&&i<o||l&&i>s)&&(r.state=!1):r.state=!1,r.state||(r.message=u),r},email:function(e,t){var r=new p,i=c["isEmail"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段是电子邮箱"),r},letterNumber:function(e,t){var r=new p,i=c["isCombination"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段只能包含数字或字母"),r},postalCode:function(e,t){var r=new p,i=c["isPostcode"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段是邮政编码"),r},numberPlate:function(e,t){var r=new p,i=c["isPlateNumber"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段是车牌号"),r},telNumber:function(e,t){var r=new p,i=c["isMobileOrTelPhone"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段是手机号或座机号"),r},phoneNumber:function(e,t){var r=new p,i=c["isTelPhone"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段是座机号"),r},mobileNumber:function(e,t){var r=new p;return/^1\d{10}$/.test(e)||(r.state=!1),r.state||(r.message="该字段是手机号"),r},idCardForce:function(e,t){var r=new p,i=c["isIDCardFull"].validator;return"function"!=dsf.type(i)||i(e)||(r.state=!1),r.state||(r.message="该字段是15或18位身份证号"),r},idCard:function(e){var t=new p,r=c["isIDCard"].validator;return"function"!=dsf.type(r)||r(e)||(t.state=!1),t.state||(t.message="该字段是15或18位身份证号"),t},string:function(e){var t=new p,r=e.length,i=rule.min,n="number"==dsf.type(i),o=rule.max,a="number"==dsf.type(o),s="该字段应该是";return n&&a?s+="长度在".concat(i,"-").concat(o,"之间的"):n?s+="长度大于或等于".concat(i,"的"):a&&(s+="长度小于或等于".concat(i,"的")),s+="字符串",("string"==dsf.type(e)||n&&r<i||a&&r>o)&&(t.state=!1),t.state||(t.message=s),t}};function g(e){var t;if(!f[e])return new p;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return null===(t=f[e])||void 0===t?void 0:t.call.apply(t,[f].concat(i))}var h={validate:g,validateMap:f},v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{"custom-class":"dsf-common-user-merge-panel dsf-common-user-import-style",title:"合并操作",visible:e.visible,width:"95vw","destroy-on-close":!0,"show-close":!1,"append-to-body":""}},[r("div",{staticStyle:{"margin-bottom":"12px",color:"red"}},[e._v(" 双击单元格选择要合并的数据 ")]),r("div",{ref:"dialog-body",staticClass:"dialog-body",staticStyle:{height:"65vh"}},[e.isInit&&e.tableHeight?r("dsf-el-table",{attrs:{border:"",stripe:"",data:e.tableData,height:e.tableHeight,"row-class-name":e.rowClassName},on:{"cell-dblclick":e.cellDblclick}},e._l(e.headers,(function(t,i){return r("el-table-column",e._b({key:i,attrs:{prop:t.name,resizable:!1},scopedSlots:e._u([{key:"default",fn:function(i){return[r("div",["field"==t.name?r("span",[e._v(" "+e._s(i.row.fieldLabel)+" ")]):e.getTableRowCellIsReadOnly(t,i)?r("span",[e._v(" "+e._s(e.getOriginFiledValue(t.name,i.row.fieldKey))+" ")]):r("el-input",{attrs:{value:e.getOriginFiledValue(t.name,i.row.fieldKey)},on:{input:function(r){return e.setOriginFiledValue(t.name,i.row.fieldKey,r)},change:function(r){return e.setOriginFiledChange(t.name,i.row.fieldKey,r)}}})],1),3===e.getOriginFiledStatus(t.name,i.row.fieldKey)?r("div",{staticClass:"cell-err-msg"},[e._v(" "+e._s(e.getOriginFiledErrorMessage(t.name,i.row.fieldKey))+" ")]):e._e(),"field"!=t.name?[r("div",{directives:[{name:"show",rawName:"v-show",value:e.getCellFiledIsSelected(t.name,i.row.fieldKey),expression:"getCellFiledIsSelected(header.name, scope.row.fieldKey)"}],key:e.updateTableKey,staticClass:"cell-selected"},[r("dsfIcon",{attrs:{name:"dui"}})],1)]:e._e()]}}],null,!0)},"el-table-column",t,!1))})),1):e._e()],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("dsf-button",{on:{click:function(t){return e.cancel()}}},[e._v("取 消")]),r("dsf-button",{attrs:{type:"primary"},on:{click:function(t){return e.confirm()}}},[e._v("确 定")])],1)])},w=[],m={inject:["$userImport","CONFLICT_TYPE","OPERATE_TYPE","FIELD_ERROR_TYPE","FIELD_ERROR_TYPE_MESSAGE"],props:{visible:{default:!1},currentMergeRowId:{default:null}},data:function(){return{headers:[],tableData:[],isInit:!1,updateTableKey:1,tableHeight:0}},computed:{getTableRow:function(){return this.$userImport.getTableRow},getOriginFiledValue:function(){return this.$userImport.getOriginFiledValue},getOriginFiledErrorMessage:function(){return this.$userImport.getOriginFiledErrorMessage},getOriginFiledStatus:function(){return this.$userImport.getOriginFiledStatus},setOriginFiledValue:function(){return this.$userImport.setOriginFiledValue},setOriginFiledStatus:function(){return this.$userImport.setOriginFiledStatus},setOriginRowFieldListCache:function(){return this.$userImport.setOriginRowFieldListCache},getOriginRowFieldListCache:function(){return this.$userImport.getOriginRowFieldListCache},removeOriginRowFieldListCache:function(){return this.$userImport.removeOriginRowFieldListCache},getOriginFiled:function(){return this.$userImport.getOriginFiled},setDefineProperty:function(){return this.$userImport.setDefineProperty},getOriginRow:function(){return this.$userImport.getOriginRow},checkRowVerifyNoPassed:function(){return this.$userImport.checkRowVerifyNoPassed},headerPersonnelSystemUpdateKeyMap:function(){return this.$userImport.headerPersonnelSystemUpdateKeyMap},positionError:function(){return this.$userImport.positionError},originDataMap:function(){return this.$userImport.originDataMap}},methods:{getTableRowCellIsReadOnly:function(e,t){var r=this.getTableRow(e.name);return r._rowId==this.currentMergeRowId?4===r.type||3===r.type&&!this.headerPersonnelSystemUpdateKeyMap.has(t.row.fieldKey):e.name!=this.currentMergeRowId},rowClassName:function(e){return"table-row-".concat(e.row.fieldKey)},init:function(){var e=this,t=this.getOriginRow(this.currentMergeRowId);this.setOriginRowFieldListCache(this.currentMergeRowId,_.cloneDeep(t.fieldList));var r=[];this.$userImport.headers.forEach((function(e){var t={fieldKey:e.name,fieldLabel:e.label};r.push(t)})),this.tableData=r;var i=[{name:"field",label:"字段",width:"180",fixed:"left"},{name:this.currentMergeRowId,label:"合并结果",width:"180",fixed:"left"}];t.children.forEach((function(e,t){i.push({name:e._rowId,label:"数据".concat(t+1),width:"180"})})),this.headers=i,this.$nextTick((function(){e.tableHeight=e.$refs["dialog-body"].clientHeight})),this.isInit=!0},cancel:function(){var e=this.currentMergeRowId,t=this.getOriginRow(e);this.$set(t,"fieldList",this.getOriginRowFieldListCache(e,!0)),this.$emit("close","cancel")},confirm:function(){var e=this;setTimeout((function(){var t=e.checkRowVerifyNoPassed(e.currentMergeRowId,!0);if(t)return e.positionError($(".table-row-".concat(t))),dsf.layer.message("请把错误全部处理完",!1);e.$emit("close","confirm")}))},getCellFiledIsSelected:function(e,t){var r=this.getOriginFiled(this.currentMergeRowId,t),i=this.getTableRow(e);return e==this.currentMergeRowId?!(4==i.type||3==i.type&&!this.headerPersonnelSystemUpdateKeyMap.has(t))&&!(null!==r&&void 0!==r&&r.selectOriginRowId):(null===r||void 0===r?void 0:r.selectOriginRowId)==e},cellDblclick:function(e,t,r,i){var n=t.property;if("field"!=t.property&&n!=this.currentMergeRowId){var o=e.fieldKey,a=this.getTableRow(this.currentMergeRowId);if(4!=a.type&&(3!=a.type||this.headerPersonnelSystemUpdateKeyMap.has(o))){var s=this.getOriginFiled(this.currentMergeRowId,o);(null===s||void 0===s?void 0:s.selectOriginRowId)!=n&&(this.setOriginFiledStatus(s,this.FIELD_ERROR_TYPE.success),this.setOriginFiledValue(this.currentMergeRowId,o,this.getOriginFiledValue(n,o)),this.setOriginFiledChange(this.currentMergeRowId,o),this.setDefineProperty(s,"selectOriginRowId",n),this.updateTableKey++)}}},setOriginFiledChange:function(e,t,r){this.$userImport.setOriginFiledChange(e,t,r);var i=this.getOriginFiled(this.currentMergeRowId,t);null!==i&&void 0!==i&&i.selectOriginRowId&&(delete i.selectOriginRowId,this.updateTableKey++)}},watch:{visible:function(e){e?this.init():this.isInit=!1}},created:function(){},mounted:function(){}},y=m,b=(r(789),r(0)),R=Object(b["a"])(y,v,w,!1,null,null,null),I=R.exports,T={normal:"normal",sqlManyToMany:"sqlManyToMany",sqlOneToMany:"sqlOneToMany",excelOneToMany:"excelOneToMany"},O={merge:"merge",custom:"custom",update:"update",revokeRerge:"revokeRerge",add:"add",cover:"cover",ignore:"ignore"},F={success:1,repeat:2,format:3},M=a()(a()(a()({},F.success,""),F.repeat,"不能重复"),F.format,"格式有问题"),E={name:"DsfUserImportPanel",mixins:[$mixins.propertyDialogSetting],inject:["$dialog"],components:{UserMergePanel:I},provide:function(){return{$userImport:this,CONFLICT_TYPE:T,OPERATE_TYPE:O,FIELD_ERROR_TYPE:F,FIELD_ERROR_TYPE_MESSAGE:M}},props:{importId:{default:""},queryFormData:{default:"{}"},servicePrefix:{default:""},fileData:{default:function(){return[]}},importOptions:{default:function(){return[]}}},data:function(){var e=this;return{pageSize:5,pageNum:1,tableData:[],total:0,originData:[],treeProps:{children:"children"},mergePanelVisible:!1,currentMergeRowId:null,oldOriginRowFieldListCache:{},tooltipError:!1,operateBtnMap:{merge:{label:"合并",value:O.merge,handler:function(t,r){e.currentMergeRowId=t.row._rowId,e.mergePanelVisible=!0}},custom:{label:"自定义",value:O.custom,handler:function(e,t){e.row.operateType=t.value}},update:{label:"更新",value:O.update,handler:function(e,t){var r,i=e.row;null===i||void 0===i||null===(r=i.children)||void 0===r||r.forEach((function(e){e.operateType==O.cover&&(e.operateType=null)})),i.operateType=t.value}},revokeRerge:{label:"撤销合并",value:O.revokeRerge,handler:function(t,r){e.revokeRergeRow(t.row._rowId)}},add:{label:"新增",value:O.add,handler:function(e,t){e.row.operateType=t.value}},cover:{label:"覆盖",value:O.cover,handler:function(t,r){e.coverOperateRow(t.row._rowId,r),t.row.operateType=r.value},disable:function(e){var t,r;return(null===e||void 0===e||null===(t=e.row)||void 0===t||null===(t=t._parent)||void 0===t?void 0:t.operateType)==O.merge||(null===e||void 0===e||null===(r=e.row)||void 0===r||null===(r=r._parent)||void 0===r?void 0:r.operateType)==O.update}},ignore:{label:"忽略",value:O.ignore,handler:function(e,t){e.row.operateType=e.row.operateType==O.ignore?null:O.ignore}}},verifyFormatMap:{phone:function(t,r){var i;if(!dsf.validate.map.isMobileOrTelPhone.validator(t))return"".concat(null!==(i=e.getHeaderFieldLabel(r))&&void 0!==i?i:"手机号").concat(M[F.format])},name:function(t,r){var i;if(!/[\u4e00-\u9fa5]/.test(t))return"".concat(null!==(i=e.getHeaderFieldLabel(r))&&void 0!==i?i:"姓名","必须包含中文")}},tableHeight:null,isInit:!1,checkLoading:!1}},computed:{headers:function(){return this.importOptions||[]},headerMap:function(){var e={};return this.headers.forEach((function(t){return e[t.name]=t})),e},headerSingleKeyMap:function(){var e=new Set;return this.headers.forEach((function(t){return!!t.single&&e.add(t.name)})),e},headerPersonnelSystemUpdateKeyMap:function(){var e=new Set;return this.headers.forEach((function(t){return!!t.allowUpdatePersonnelSystem&&e.add(t.name)})),e},paginationTableData:function(){var e;return(null===(e=this.tableData)||void 0===e?void 0:e.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize))||[]}},methods:{getHeaderIsPersonnelSystemUpdate:function(e){return this.headerPersonnelSystemUpdateKeys.find},getTableRowIsShowIdentifying:function(e,t){return 0===t&&(e.row.isMergeRow||1!=e.row.type)},getIsShowBtnGroup:function(e,t){var r;return dsf.isUnDef(t.show)||(null===(r=t.show)||void 0===r?void 0:r.call(t,e))},getIsDisabledBtnGroup:function(e,t){var r;return 1==(null===t||void 0===t?void 0:t.disable)||(null===(r=t.disable)||void 0===r?void 0:r.call(t,e))},getIsDisabledBtn:function(e,t){var r;return 1==(null===t||void 0===t?void 0:t.disable)||(null===(r=t.disable)||void 0===r?void 0:r.call(t,e))},getTableRowIsShowErrorInfo:function(e,t,r){if("tooltipError"==r?!this.tooltipError:this.tooltipError)return!1;var i=this.getTableRow(e);if(i.operateType==O.ignore)return!1;if(i.isMergeRow&&null!==i&&void 0!==i&&i.children)return!i.children.some((function(e){return e.operateType==O.cover}));var n=this.getOriginFiledStatus(e,t);return n!=F.success},getTableRowIsShowTooltipErrorInfo:function(e,t){var r=this.getTableRow(e);if(r.operateType==O.ignore)return!1;var i=this.getOriginFiledStatus(e,t);return this.tooltipError&&i&&i!=F.success},getTableMainRowType:function(e){var t=this.getTableRow(e);return null===t||void 0===t?void 0:t.type},getTableChildrenRowIsDisabled:function(e){var t,r,i=this.getTableRow(e);return(null===i||void 0===i||null===(t=i._parent)||void 0===t?void 0:t.operateType)!=O.custom&&(null===i||void 0===i||null===(r=i._parent)||void 0===r?void 0:r.operateType)!=O.update},getTableChildrenRowIsCoverDisabled:function(e){var t,r=this.getTableRow(e);return(null===r||void 0===r||null===(t=r._parent)||void 0===t?void 0:t.operateType)!=O.custom},getTableRowCellIsReadOnly:function(e,t){var r,i=this.getTableRow(e);return i.operateType==O.ignore||(i.isMergeRow?4==i.type||3==i.type&&!this.headerPersonnelSystemUpdateKeyMap.has(t.name)||i.operateType!=O.update&&i.operateType!=O.add:(null===i||void 0===i||null===(r=i._parent)||void 0===r?void 0:r.operateType)==O.merge)},getHeaderFieldLabel:function(e){var t;return null===(t=this.headerMap)||void 0===t||null===(t=t[null===e||void 0===e?void 0:e.field])||void 0===t?void 0:t.label},setOriginFiledStatus:function(e,t,r){var i;(e.status=t,t!=F.success&&dsf.isUnDef(r))&&(r="".concat(null!==(i=this.getHeaderFieldLabel(e))&&void 0!==i?i:"参数").concat(M[t]));e.message=r},mergePanelClose:function(e){var t,r=this,i=this.currentMergeRowId,n=this.getTableRow(i);"confirm"==e&&(null===n||void 0===n||null===(t=n.children)||void 0===t||t.forEach((function(e){var t=e._rowId;return r.getTableRow(t).operateType=O.ignore})),n.operateType=O.merge);this.$nextTick((function(){r.verifyRepeatTreeField(i)})),this.currentMergeRowId=null,this.mergePanelVisible=!1},rowOperateTypeChange:function(e,t){t.handler(e,t),this.verifyRepeatTreeField(e.row._rowId)},coverOperateRow:function(e,t){var r,i=this.getTableRow(e);null===(r=this.getTableRow(i._parent._rowId))||void 0===r||null===(r=r.children)||void 0===r||r.forEach((function(e){e.operateType==O.cover&&(e.operateType=null)})),i.operateType=t.value},cloneOriginRow:function(e){var t=this,r=this.getOriginRow(e),i=_.cloneDeep(r),n=r.children;if(this.setDefineProperty(i,"_rowId",r._rowId),null!==n&&void 0!==n&&n.length){var o=[];n.forEach((function(e){o.push(t.cloneOriginRow(e._rowId))})),i.children=o}return i},revokeRergeRow:function(e){var t=this;dsf.layer.confirm({title:"提示",message:"是否要撤销合并操作？"}).then((function(){t.resetOldMergeRow(e);var r=t.getTableRow(e);r.operateType=null,r.conflictType!=T.excelOneToMany&&(r.operateType=O.custom)}))},setOriginRowFieldListCache:function(e,t){this.oldOriginRowFieldListCache[e]=t},getOriginRowFieldListCache:function(e,t){var r=this;return setTimeout((function(){t&&r.removeOriginRowFieldListCache(e)})),this.oldOriginRowFieldListCache[e]},removeOriginRowFieldListCache:function(e){delete this.oldOriginRowFieldListCache[e]},resetOldMergeRow:function(e){var t=this.getOriginRow(e);this.$set(t,"fieldList",this.getOriginRowFieldListCache(e,!0))},rowClassName:function(e){var t="";return e.row._rowId&&(t+=" table-row-".concat(e.row._rowId)),e.row.isMergeRow?t+=" merge-main-row":e.row.isMergeChildrenRow&&(t+=" merge-children-row"),t},getTableRow:function(e){return this.tableDataMap[e]},getOriginRow:function(e){return this.originDataMap[e]},getOriginFiled:function(e,t){var r;return null===(r=this.getOriginRow(e))||void 0===r||null===(r=r.fieldList)||void 0===r?void 0:r[t]},getOriginFiledValue:function(e,t){var r;return(null===(r=this.getOriginFiled(e,t))||void 0===r?void 0:r.value)||""},getOriginFiledStatus:function(e,t){var r;return(null===(r=this.getOriginFiled(e,t))||void 0===r?void 0:r.status)||""},getOriginFiledErrorMessage:function(e,t){var r;return(null===(r=this.getOriginFiled(e,t))||void 0===r?void 0:r.message)||""},setOriginFiledValue:function(e,t,r){var i=this.getOriginFiled(e,t);if(i){var n;if(dsf.isString(r))r=null===(n=r)||void 0===n?void 0:n.trim();else dsf.isUnDef(r)&&(r="");i.value=r}},setOriginFiledChange:function(e,t){var r=this.getOriginFiled(e,t);r&&(this.verifyFormatField(r,t),this.headerSingleKeyMap.has(t)&&r.status==F.success&&this.verifyRepeatTreeField(e))},initData:function(e){this.isInit=!1,this.tableDataMap={},this.originDataMap={},this.tableData=this.buildTreeTableData(e),this.originData=e,this.total=Object.keys(this.tableDataMap).length||0,this.isInit=!0},buildTreeTableData:function(e,t){var r=this,i=[];return null===e||void 0===e||e.forEach((function(e){var n,o=r.createTableRow(e,t);r.tableDataMap[o._rowId]=o,null!==(n=e.children)&&void 0!==n&&n.length&&(o.children=r.buildTreeTableData(e.children,o)),i.push(o)})),i},getTableRowId:function(){var e=dsf.uuid();while(this.originDataMap[e])e=dsf.uuid();return e},createTableRow:function(e,t){var r=this,i=this.getTableRowId();this.setDefineProperty(e,"_rowId",i),this.originDataMap[i]=e;var n=null===e||void 0===e?void 0:e.children,o={_rowId:i,isMergeRow:null===n||void 0===n?void 0:n.length,isMergeChildrenRow:!!t,operateType:null,conflictType:T.normal,type:e.type};this.setDefineProperty(o,"_parent",t);var a=[];return o.isMergeRow||o.isMergeChildrenRow?o.isMergeRow?1!=o.type?4==o.type?(o.operateType=O.ignore,a=[{btns:[]}]):n.some((function(e){var t=e.type;return 1!=t}))?(o.conflictType=T.sqlManyToMany,a=[{btns:[O.update,O.ignore]}]):(o.operateType=O.custom,o.conflictType=T.sqlOneToMany,a=[{btns:[O.merge,O.custom,O.update],show:function(e){return e.row.operateType!=O.merge}},{btns:[O.revokeRerge],show:function(e){return e.row.operateType==O.merge}}]):(o.conflictType=T.excelOneToMany,a=[{btns:[O.merge,O.add,O.ignore],show:function(e){return e.row.operateType!=O.merge}},{btns:[O.revokeRerge],show:function(e){return e.row.operateType==O.merge}}]):o.isMergeChildrenRow&&(a=1!=o.type?4==o.type?[{btns:[]}]:[{btns:[O.update,O.ignore]}]:1!=t.type?4==t.type||t.conflictType==T.sqlManyToMany?[{btns:[O.add,O.ignore]}]:[{btns:[O.add,O.cover,O.ignore],disable:function(e){var t;return(null===e||void 0===e||null===(t=e.row)||void 0===t||null===(t=t._parent)||void 0===t?void 0:t.operateType)==O.merge}}]:[{btns:[O.add,O.ignore],disable:function(e){var t;return(null===e||void 0===e||null===(t=e.row)||void 0===t||null===(t=t._parent)||void 0===t?void 0:t.operateType)==O.merge}}]):a=[{btns:[O.ignore]}],a.forEach((function(e){return e.btns=e.btns.map((function(e){return r.operateBtnMap[e]}))})),o.operateBtnList=a,o},setDefineProperty:function(e,t,r){Object.defineProperty(e,t,{get:function(){return r},enumerable:!1,configurable:!0})},verifyFormatField:function(e,t){var r=e.value,i=this.headerMap[t];this.setOriginFiledStatus(e,F.success);var n=h.validate("isRequired",r,i),o=n.state;i.isRequired||(n.state=!0),n.state&&o&&i.validationMethod&&(n=h.validate(i.validationMethod,r,i)),n.state||this.setOriginFiledStatus(e,F.format,n.message)},verifyRepeatTreeField:function(e){var t,r=this,i=this.getTableRow(e);if(i.isMergeRow||i.isMergeChildrenRow){var n=[];null!==(t=i)&&void 0!==t&&t._parent?(n.push(i._parent._rowId),i=i._parent):n.push(i._rowId),i.children.forEach((function(e){n.push(e._rowId)})),n.forEach((function(e){var t=r.getOriginFiled(e,"phone");r.verifyFormatField(t,"phone")})),n.forEach((function(e){var t=r.getTableRow(e);if(t.operateType!=O.ignore&&t.operateType!=O.custom){var i=!0;if(n.forEach((function(t){if(e!==t){var n=r.getTableRow(t);n.operateType!=O.ignore&&o.call(r,e,t)&&(i=!1)}})),!i){var a=r.getOriginFiled(e,"phone");r.setOriginFiledStatus(a,F.repeat)}}}))}function o(e,t){if(this.getOriginFiledStatus(e)===F.format)return!1;var r=this.getTableRow(e),i=this.getTableRow(t);return(r.operateType!=O.cover||i.operateType!=O.custom)&&this.getOriginFiledValue(e,"phone")==this.getOriginFiledValue(t,"phone")}},checkRowVerifyNoPassed:function(e,t){var r,i=this,n=this.getTableRow(e),o=this.getOriginRow(e),a=o.fieldList,s=function(e){if(a[e].status!=F.success){if(n.operateType==O.ignore||n.operateType==O.custom)return 0;if(a[e].status==F.repeat){if(n.operateType==O.merge||t)return 0;if(n.operateType==O.add){if("phone"==e){var r,o=[],s=null===n||void 0===n?void 0:n.children;null!==n&&void 0!==n&&n._parent&&(o.push(n._parent._rowId),s=n._parent.children),null===(r=s)||void 0===r||r.map((function(e){var t=e._rowId;return t!=n._rowId&&o.push(t)}));var l=o.some((function(t){var r=i.getTableRow(t);return i.getOriginFiledStatus(r._rowId,e)==F.repeat&&(r.operateType==O.cover||r.operateType==O.add||r.operateType==O.update)}));if(l)return{v:e}}return 0}return 0}return{v:e}}};for(var l in a)if(r=s(l),0!==r&&r)return r.v;return null},getOutputFieldList:function(e){var t={};for(var r in e)t[r]=e[r].value;return t},positionError:function(e){e.addClass("table-row-flicker"),e[0].scrollIntoView(),setTimeout((function(){e.removeClass("table-row-flicker")}),1e3)},outputSaveData:function(){var e=this,t=a()(a()(a()(a()(a()({},O.merge,4),O.cover,3),O.add,1),O.ignore,5),O.update,3),r={verifyFormat:"检查问题是否处理完成",operateError:"请在右侧操作栏中对重复人员进行处理"};try{var i=[];return this.tableData.forEach((function(r){var n=r._rowId,o=e.getOriginRow(n),a=r.operateType,s={id:o.id,type:o.type,deptIdOld:o.deptIdOld,button:t[a],fieldList:e.getOutputFieldList(o.fieldList)},l=e.checkRowVerifyNoPassed(n);if(r.isMergeRow){if(!a)throw{type:"operateError",rowId:n};if(a!=O.ignore&&l)throw{type:"verifyFormat",rowId:n,fieldKey:l};var u;r.children.forEach((function(n){var o=n._rowId,l=e.getOriginRow(o),d=n.operateType,c={id:l.id,type:l.type,deptIdOld:l.deptIdOld,button:t[d],fieldList:e.getOutputFieldList(l.fieldList)};if(a==O.merge)c.button=t[O.ignore];else if(!d)throw{type:"operateError",rowId:o};var p,f=e.checkRowVerifyNoPassed(o);if((a!=O.merge||d!=O.ignore)&&f)throw{type:"verifyFormat",rowId:o,fieldKey:f};d==O.cover&&(u=!0,c.button=t.ignore,s.button=t.cover,3==r.type?null===(p=Array.from(e.headerPersonnelSystemUpdateKeyMap))||void 0===p||p.forEach((function(t){s.fieldList[t]=e.getOriginFiledValue(o,t)})):s.fieldList=_.cloneDeep(c.fieldList));c.button!=t.ignore&&i.push(c)})),u||a!=O.custom||(s.button=t.ignore)}else if(a!==O.ignore){if(l)throw{type:"verifyFormat",rowId:n,fieldKey:l};s.button=t.add}s.button!=t.ignore&&i.push(s)})),i}catch(l){console.error(l);var n,o=null===l||void 0===l?void 0:l.type;if(o)if(dsf.layer.message(r[o],!1),this.tableData.some((function(e,t){var r;if(l.rowId,e._rowId==l.rowId||null!==e&&void 0!==e&&null!==(r=e.children)&&void 0!==r&&r.some((function(e){return e._rowId==l.rowId})))return n=t,!0})),n>=0){var s=Math.ceil((n+1)/this.pageSize);s!=this.pageNum&&(this.pageNum=s),this.$nextTick((function(){e.positionError($(".table-row-".concat(l.rowId)))}))}return!1}},checkOutputSaveData:function(){var e,t,r=this,i=this.outputSaveData();if(!1===i)return Promise.reject("有错误未处理");var n={};try{n=JSON.parse(this.queryFormData)}catch(a){n={}}var o=dsf.url.queryStringStringify({appKey:null===(e=n)||void 0===e?void 0:e.appKey,pid:null===(t=n)||void 0===t?void 0:t.pid,importId:this.importId});return this.checkLoading=!0,dsf.http.post("/import/user/check?"+o,JSON.stringify(i),{headers:{"Content-Type":"application/json"}},this.servicePrefix).then((function(e){if(e.data.success){if(e.data.data.accomplish)return Promise.resolve();dsf.layer.message("导入数据存在错误，需继续进行调整",!1),r.initData(e.data.data.pieceList||[])}else dsf.layer.message(e.data.message,!1);return Promise.reject()})).finally((function(){r.checkLoading=!1}))},yes:function(){return this.checkOutputSaveData()}},created:function(){this.initData(this.fileData||[])},mounted:function(){this.tableHeight=this.$refs["import-body"].clientHeight}},C=E,S=(r(791),Object(b["a"])(C,i,n,!1,null,null,null));t["default"]=S.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_import.js.map