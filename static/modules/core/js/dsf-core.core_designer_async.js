/*!
 * Name: @dsf/cli-core
 * Version: 5.17.0-alpha.5
 * Description: 核心模块
 * BuildTime: 2024/6/19 17:49:24
*/
(("undefined"!==typeof self?self:this)["webpackJsonpcore"]=("undefined"!==typeof self?self:this)["webpackJsonpcore"]||[]).push([[4],{309:function(e,t,n){"use strict";n.r(t);var a=n(17),r=n.n(a),i=n(1),o=n.n(i),s=n(45),c=n.n(s),u=n(24),l=n.n(u),d=["form","question","exam"];function p(e,t,n,a){a=dsf.isDef(a)?a:n.metadataDifferentSources;var r=function(n,a,r,i,o){M(a,r,(function(a){a&&(n=dsf.designer.createViewMetaData(e,t)),i(n)}),(function(){i()}))};return new Promise((function(n,i){var o=dsf.designer.createViewMetaData(e,t);if("prototype"!=o.mode&&"form"==o.pageState&&a)if(o.metadata&&!dsf.isEmptyObject(o.metadata)){var s=[],c=[],u=!1;if(_.each(o.metadata,(function(e,t){var n=t.split("."),a=n[0];n[1]&&n[1];if(e.ref&&!e.pinyinField&&e.ref.isFormControl&&!e.ref.isOneToMany&&0==e.level){var r={ctrl:e.ref,source:a};e.$isNew&&(u=!0),dsf.array.ensure(c,a),s.push(r)}})),c.length>0){var l="";u&&(1==c.length?l="发现当前页面有新增的字段，默认属于<b style='color:blue'>".concat(c[0],"</b>元数据下,确定提交吗?"):c.length>1&&(l="发现当前页面有多组元数据，分别是:<b style='color:blue'>".concat(c.join("，"),"</b>,确定提交吗?"))),l?(l+="<br/><div style='color:red;font-weight:bold'>注：提交后将创建数据表和字段，如提交了错误的元数据所产生的字段需人为处理！！！！</div>",dsf.layer.confirm({message:l,confirmButtonText:"确定提交",cancelButtonText:"我要修改"}).then((function(){n(o)})).catch((function(){window.setTimeout((function(){r(o,s,c,n,i)}),500)}))):n(o)}else r(o,s,c,n,i)}else n(o);else n(o)}))}function f(e){return m.apply(this,arguments)}function m(){return m=c()(l.a.mark((function e(t){var n,a,r,i,o;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$refs.viewProxy,a="",r="",i=null,e.prev=4,e.next=7,p(n,t.mobile,t,!1);case 7:if(i=e.sent,!i){e.next=20;break}return i.mode="prototype",e.next=12,x(n);case 12:if(!t.postSaveBefore||!dsf.isFunction(t.postSaveBefore)){e.next=15;break}return e.next=15,t.postSaveBefore({metadata:i});case 15:return e.next=17,O(t,n,i);case 17:o=e.sent,r="布局已经自动暂存",t.$emit("saved",o);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e["catch"](4),dsf.error(e.t0),a="";case 26:return e.prev=26,e.next=29,t.$nextTick();case 29:return a?dsf.layer.pc.message(a,!1):r&&dsf.layer.pc.message(r),e.finish(26);case 31:case"end":return e.stop()}}),e,null,[[4,22,26,31]])}))),m.apply(this,arguments)}function v(e){var t=e.$refs.viewProxy;dsf.designer.recursionLayoutTree(t,null,null,(function(e){e.isFormControl&&e.caption&&(e.caption=e.caption.toLowerCase())}))}function g(e,t){return h.apply(this,arguments)}function h(){return h=c()(l.a.mark((function e(t,n){var a,r;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return a=t.$refs.viewProxy,r=dsf.layer.pc.loading({text:"正在解析布局..."}),v(t),e.next=7,t.$nextTick();case 7:return e.abrupt("return",new Promise((function(e,i){window.setTimeout(c()(l.a.mark((function o(){var s,c;return l.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return"","",s=null,c=null,o.prev=4,o.next=7,t.$nextTick();case 7:return o.next=9,p(a,t.mobile,t,t.metadataDifferentSources);case 9:if(s=o.sent,!s){o.next=24;break}if(!t.postSaveBefore||!dsf.isFunction(t.postSaveBefore)){o.next=14;break}return o.next=14,t.postSaveBefore({metadata:s});case 14:return r.text="表单公式编译",o.next=17,t.$nextTick();case 17:return o.next=19,x(a);case 19:return r.text="数据提交中...",o.next=22,n({designer:t,page:a,md:s});case 22:c=o.sent,e(c);case 24:o.next=30;break;case 26:o.prev=26,o.t0=o["catch"](4),dsf.error(o.t0),i(o.t0);case 30:return o.prev=30,o.next=33,t.$nextTick();case 33:return dsf.layer.pc.closeLoading(r),t=null,r=null,c=null,s=null,o.finish(30);case 39:case"end":return o.stop()}}),o,null,[[4,26,30,39]])}))),500)})));case 8:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function y(e,t){return new Promise((function(n,a){if((e||"").trim()){for(var r=[".ds-page"+(t?'[module-name="'+t+'"]':"")+"{",e,"}"],i=dsf.config.designer.scss||[],s=['@charset "utf-8";'],c=0;c<i.length;c++)s.push('@import "'.concat(i[c],'";'));r=[].concat(s,o()(r)).join("\r\n"),dsf.scss.compile(r,(function(e){return dsf.config.designer.scssDir+"scss/"+e})).then((function(e){var t=dsf.beautify.css(e,{indent_size:"2",indent_char:" "});n(t)})).catch((function(e){var t="编译错误:"+e.message;dsf.error(t),a(t)}))}else n("")}))}function x(e){return b.apply(this,arguments)}function b(){return b=c()(l.a.mark((function e(t){var n,a,r;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n={},dsf.recursionComponentProps(t,(function(e){e.isFormControl&&(n[e.designId]=e)})),e.t0=l.a.keys(n);case 3:if((e.t1=e.t0()).done){e.next=10;break}return a=e.t1.value,r=n[a],e.next=8,k(r,n);case 8:e.next=3;break;case 10:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function w(e,t,n){return S.apply(this,arguments)}function S(){return S=c()(l.a.mark((function e(t,n,a){var r,i;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=n.metadata.inSubTable,e.next=3,dsf.ufunc.compile(t,(function(e){var t=e.node,n=e.ownerFunction,i=e.varMap;if("variable"==t.type){var o=t.express,s=T(o,i,a);return s}if("express"==t.type&&t.vs.length){var c=[],u=t.vs,l=t.express;_.each(u,(function(e){var t=e.express,n=i[t],r=n.replace("{{^^","").replace("^^}}",""),o=a[r]&&a[r].metadata||null;o&&o.inSubTable&&c.push(o.inSubTable),n=T(t,i,a),l=l.replace(t,n)}));var d=l,p=n.pol||!1;if(p&&c.length>0&&r!=c[0]){var f="function fn_"+dsf.uuid()+"(__local__){return  ("+l+");}";d="$loopSubTable('"+c[0]+"',"+f+")"}return d}}));case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function k(e,t){return C.apply(this,arguments)}function C(){return C=c()(l.a.mark((function e(t,n){var a,r;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isFormControl){e.next=19;break}if(a=t.formula.formula.trim(),a){e.next=5;break}return delete t.formula.realFormula,e.abrupt("return");case 5:return e.prev=5,console.time("-------编译公式代码----"),e.next=9,w(a,t,n);case 9:r=e.sent,console.timeEnd("-------编译公式代码----"),t.formula.realFormula=r,e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](5),console.error("公式编译错误",e.t0),t.formula.realFormula="";case 19:case"end":return e.stop()}}),e,null,[[5,15]])}))),C.apply(this,arguments)}function T(e,t,n){var a=e,r=/\{\{(.)+?\}\}/g,i=/\^\^((.)+?)\^\^/g,o=t[a];return o=o.replace(r,(function(e,t,a,r){var o=e.replace(i,(function(e,t,a,r){var i=t.split("."),o=i[0]||"",s=i[1]||"",c=n[o]&&n[o].metadata||null;return c.inSubTable?"TO_VALUE(__local__['"+n[o].metadata_fullcode+"'],'"+s+"')":"TO_VALUE($viewData['"+n[o].metadata_fullcode+"'],'"+s+"')"}));return o.replace(/\{\{|\}\}/g,"")})),o}function N(e){return D.apply(this,arguments)}function D(){return D=c()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(1!=t.tpl){e.next=10;break}return t.loading=!0,n=t.$refs.viewProxy,e.next=5,t.$nextTick();case 5:return dsf.designer.recursionLayoutTree(n,null,null,(function(e){e.metadata&&e.metadata.isFromMetaData&&(e.metadata_fullcode="")})),e.next=8,t.$nextTick();case 8:return e.next=10,J(t,n).finally((function(){t.loading=!1}));case 10:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function L(e,t,n){return F.apply(this,arguments)}function F(){return F=c()(l.a.mark((function e(t,n,a){var r,i,o,s,c,u,p,f,m,v,g,h,y,x,b,w,S,k,C=arguments;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=C.length>3&&void 0!==C[3]&&C[3],i=C.length>4?C[4]:void 0,dsf.isDef(r)&&dsf.isFunction(r)&&(i=r,r=!1),o=null,a&&(s=I.call(t,a.metadata),dsf.isEmptyObject(s)||(o=s)),c="",c=dsf.designer.isPrototypePage(n)?dsf.designer.getStaticValue(n):{},u=(t.page.context.B||"")+"."+(t.page.context.M||""),p=dsf.designer.getLayoutInfo(n,r,!1),f=t.showLogic,m=void 0,v=void 0,n.compileRender&&(g=dsf.designer.convertTemplateAndControlData(p),h=Vue.compile(g.tpl),_.each(h.staticRenderFns||[],(function(e){if(e){dsf.isUnDef(m)&&(m=[]);var t=e.toString();t=t.substring(t.indexOf("{")+1,t.lastIndexOf("}")),m.push(t)}})),m=JSON.stringify(m),y=h.render.toString(),v=y.substring(y.indexOf("{")+1,y.lastIndexOf("}"))),x={layout:p,showLogic:f,render:v,staticRenderFns:m,doc:t.pageDocument,css:"",scss:t.extScssCode||"",nameSpace:u,moduleName:u+"."+(t.page.name||""),stateSetting:t.pageStateSetting||[],staticValue:c,mdDict:o,designerNode:{metadataGroup:{},controlGroup:{},businessControlGroup:{},fromTemplateId:t.fromTemplateId}},i&&i(x),x.designerNode["metadataGroup"]=_.map(t.useMetaGroup.groups,(function(e){return{name:e.title||e.name,id:e.id,type:e.type}})),x.designerNode["businessControlGroup"]=_.map(t.useBusinessControlGroup.groups,(function(e){return{name:e.title,id:e.id,type:e.type}})),x.designerNode["controlGroup"]=_.map(t.useControlsGroup.groups,(function(e){return{name:e.title,id:e.id,type:e.type}})),a&&d.indexOf(n.pageType)>=0&&([],_.each(a.metadata,(function(e,t){var n=t.split("."),a=n[0],r=a.replace(/_/g,"."),i=_.find(x.designerNode["metadataGroup"],(function(e){return e.id==r}));i||x.designerNode["metadataGroup"].push({name:r+"元数据",id:r,type:3})}))),e.next=20,dsf.designer.compileCss(t.extScssCode,x.moduleName);case 20:return b=e.sent,t.extCssCode=b,x.css=t.extCssCode,w=t.extJsCode,w=dsf.beautify.js(w,{indent_size:"2",indent_char:" ",keep_array_indentation:!1,break_chained_methods:!0,wrap_line_length:0,space_after_anon_function:!0}),S="/",k={isMobile:t.mobile,md:JSON.stringify(a,(function(e,t){return"ref"==e||e.startsWith("$")?void 0:t})),stateSetting:JSON.stringify(x.stateSetting||[]),layout:['<script type="text/template" id="layout">\n'.concat(dsf.designer.controlToJson(x.layout,(function(e,t){return"$isNew"==e?void 0:t})),"\n<").concat(S,"script>"),x.render?'<script type="text/template" id="render">\n'.concat(x.render,"\n<").concat(S,"script>"):"",x.staticRenderFns?'<script type="text/template" id="staticRenderFns">\n'.concat(x.staticRenderFns,"\n<").concat(S,"script>"):"",'<script type="text/template" id="css">\n'.concat(x.css,"\n<").concat(S,"script>"),'<script type="text/template" id="scss">\n'.concat(x.scss,"\n<").concat(S,"script>"),'<script type="text/template" id="showLogic">\n'.concat(JSON.stringify(x.showLogic,(function(e,t){return"$error"==e?void 0:t})),"\n<").concat(S,"script>"),'<script type="text/template" id="showLogicCompile">\n'.concat(q(t,x.showLogic),"\n<").concat(S,"script>"),'<script type="text/template" id="designer">\n'.concat(JSON.stringify(x.designerNode),"\n<").concat(S,"script>"),'<script type="text/template" id="staticValue">\n'.concat(JSON.stringify(x.staticValue),"\n<").concat(S,"script>"),'<script type="text/template" id="doc">\n'.concat(x.doc?dsf.escapeFilter(x.doc.trim()):"","\n<").concat(S,"script>"),'<script type="text/template" id="metadatedict">\n'.concat(x.mdDict?JSON.stringify(x.mdDict):"","\n<").concat(S,"script>")].join("\n"),extJsCode:w,templateid:t.fromTemplateId,pageName:t.page.name,namespace:u,pageTitle:t.page.title},Object.defineProperty(k,"$info",{enumerable:!1,get:function(){return x}}),e.abrupt("return",k);case 29:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)}function O(e,t,n,a,r){return B.apply(this,arguments)}function B(){return B=c()(l.a.mark((function e(t,n,a,r,i){var o,s,c,u,d,p,f;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L(t,n,a,i);case 3:return o=e.sent,s=o.$info.designerNode,r=r||t.saveRequest||t.$webAPI.pageBuild,e.next=8,r(o);case 8:if(c=e.sent,u=c.data,"20000"!=u.state){e.next=20;break}return _.forOwn(a.metadata,(function(e,t){var n;null===e||void 0===e||null===(n=e.ref)||void 0===n||null===(n=n.metadata)||void 0===n||delete n.$isNew,null===e||void 0===e||delete e.$isNew})),d=$("<div>"+o.layout+"</div>"),p=d.find("#layout"),f={md:a,layout:JSON.parse(p.get(0).innerHTML),extjs:t.extJsCode,extCss:t.extCssCode,showLogic:t.showLogic||{}},t.saved=!0,t.loadMetaDataGroup(s["metadataGroup"]),e.abrupt("return",f);case 20:throw u.message;case 21:e.next=26;break;case 23:throw e.prev=23,e.t0=e["catch"](0),e.t0;case 26:return e.prev=26,e.finish(26);case 28:case"end":return e.stop()}}),e,null,[[0,23,26,28]])}))),B.apply(this,arguments)}function G(e){return P.apply(this,arguments)}function P(){return P=c()(l.a.mark((function e(t){var n,a,r,i,o;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="",a="",e.prev=2,e.next=5,g(t,function(){var e=c()(l.a.mark((function e(t){var n,a,r,i,o;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.designer,a=t.page,r=t.md,e.t0=l.a.keys(n.postSaveBeforeList);case 2:if((e.t1=e.t0()).done){e.next=10;break}if(i=e.t1.value,o=n.postSaveBeforeList[i](),!dsf.isPromise(o)){e.next=8;break}return e.next=8,o;case 8:e.next=2;break;case 10:return e.next=12,O(n,a,r);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:o=e.sent,a="保存成功",t.$emit("saved",o),null===(r=window)||void 0===r||null===(r=r.opener)||void 0===r||null===(i=r.postMessage)||void 0===i||i.call(r,{type:"designerSaved"},"*"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](2),dsf.error(e.t0),n=dsf.isString(e.t0)?e.t0:e.t0.message||"保存失败";case 15:return e.prev=15,e.next=18,t.$nextTick();case 18:return n?dsf.layer.pc.message(n,!1):a&&dsf.layer.pc.message(a),e.finish(15);case 20:case"end":return e.stop()}}),e,null,[[2,11,15,20]])}))),P.apply(this,arguments)}function I(e){var t={};if(!e)return t;for(var n in e){var a=n.split("."),r=a[0],i=a[1]?a[1]:"";if(1!=e[n].level||i){var o,s,c,u,l,d,p,f,m=e[n].valueAttributes,v=(null===(o=e[n])||void 0===o||null===(o=o.validate)||void 0===o||o.rules,_.keyBy(m,"code")),g=(null===(s=e[n])||void 0===s?void 0:s.dataSource)||null;t[n]={id:n,name:e[n].name,disperseFields:dsf.isDef(null===e||void 0===e||null===(c=e[n])||void 0===c?void 0:c.disperseFields)?null===e||void 0===e||null===(u=e[n])||void 0===u?void 0:u.disperseFields:void 0,itemFields:dsf.isDef(null===(l=e[n])||void 0===l?void 0:l.itemFields)?null===(d=e[n])||void 0===d?void 0:d.itemFields:void 0,valueField:(null===(p=e[n])||void 0===p?void 0:p.valueField)||void 0,type:"field",level:0,hidden:e[n].hidden,fieldsLength:e[n].valueAttributes&&e[n].valueAttributes.length,valueAttributes:e[n].valueAttributes&&_.map(e[n].valueAttributes,"code"),valueAttributesDetail:v,order:e[n].order,required:e[n].required,rmId:e[n].rmId||"",dataSource:g,inColumn:(null===e||void 0===e||null===(f=e[n])||void 0===f?void 0:f.inColumn)||void 0},t[r]&&(t[n].level=1,t[n].inSubTable=r)}else t[n]={id:n,name:e[n].name||"",type:"subtable",fieldsLength:0,valueAttributesDetail:{},valueAttributes:[],level:1,order:e[n].order,rmId:e[n].rmId||""}}return t}function A(e,t){var n=e;dsf.layer.openDialog({title:"保存到",fullscreen:!1,content:"DesBusinessComponent",width:"500px",height:"500px",btns:[{text:"确定",handler:function(a){var r,i=a.radioData,o=_.map(t,(function(e,t){var a=e.metadata,r=[];return a="array"==dsf.type(a)?a:[a],_.each(a,(function(e){null!==e&&void 0!==e&&e.metadata&&(e.metadata.id="",e.metadata.at="",r.push(e.metadata))})),{code:e.props.caption,name:e.businessLabel||e.props.label,thumbnail:e.thumbnail,version:"5.0",terminalText:n.mobile?"mobile":"pc",terminalValue:n.mobile?"1":"0",modeText:"原型模式^研发模式",modeValue:"0^1",origin:n.business+"."+n.module+"."+n.pageName,md:r?JSON.stringify(r):"",groupId:i._id,content:JSON.stringify(e.props,(function(e,t){return"designId"===e?"":"isDesign"==e?void 0:t}))}}));return new Promise((function(t,a){n.loading=!0,n.$http.get("component/checkBcName",{name:o[0].name,pid:o[0].groupId}).then((function(e){var t=e.data,n=t.success,a=t.message,r=t.data;if(n)return r>0?1:2;throw a})).then((function(e){return 1!=e?e:new Promise((function(e,t){n.loading=!1,dsf.layer.confirm({title:"提示",message:"存在相同名称业务组件，是否覆盖",confirmButtonText:"是",cancelButtonText:"否",distinguishCancelAndClose:!0,params:{distinguishCancelAndClose:!0}}).then((function(){e(3),n.loading=!0})).catch((function(t){if("cancel"==t)return e(2);a()}))}))})).then((function(e){return 3!=e?e:new Promise((function(e,t){dsf.layer.openDialog({title:"组件列表",width:"900px",height:"500px",params:{path:"/pc/dsfa/rm/ctl/list/repeatednamelist?name=".concat(o[0].name,"&pid=").concat(o[0].groupId)},btns:[{text:"确定",handler:function(t){return t.yes().then((function(t){if(0==t)return Promise.reject();r=t._id,e(2)}))}},{text:"取消",handler:function(){r=void 0,a(),e(5)}}]})}))})).then((function(t){return 2!=t?t:n.$http.post("component/saveBC",{bcStrs:JSON.stringify(o),coveredId:r}).then((function(t){var a=t.data;if(a.success){dsf.layer.pc.message("保存成功",!0);var r=(e.useBusinessControlGroup.groups||[]).map((function(e){return{id:e.id,title:e.title,type:e.type}}));r.length&&n.loadBusinessComponetGroup(r)}else dsf.layer.pc.message(a.message,!1)}))})).catch((function(e){a(),dsf.httpError(e,{message:"保存出现错误"})})).finally((function(){n.loading=!1,t()}))}))}},{text:"取消"}]})}function J(e,t){e.loading=!0;var n=dsf.designer.getLayoutInfo(t,!1,!1);n=dsf.designer.controlToJson(n);var a=e.extScssCode||"",r=(e.page.context.B||"")+"."+(e.page.context.M||""),i=(e.page.name,{metadataGroup:{},controlGroup:{},businessControlGroup:{}});i["metadataGroup"]=_.map(e.useMetaGroup.groups,(function(e){return{name:e.name,id:e.id,type:e.type}})),i["businessControlGroup"]=_.map(e.useBusinessControlGroup.groups,(function(e){return{name:e.title,id:e.id,type:e.type}})),i["controlGroup"]=_.map(e.useControlsGroup.groups,(function(e){return{name:e.title,id:e.id,type:e.type}}));var o="/",s={type:t.queryString.templateType?t.queryString.templateType:e.mobile?2:1,layout:['<script type="text/template" id="layout">\n'.concat(n,"\n<").concat(o,"script>"),'<script type="text/template" id="css"><'.concat(o,"script>"),'<script type="text/template" id="scss">\n'.concat(a,"\n<").concat(o,"script>"),'<script type="text/template" id="designer">\n'.concat(JSON.stringify(i),"\n<").concat(o,"script>"),'<script type="text/template" id="metadatedict"><'.concat(o,"script>")].join("\n"),desButtonRules:JSON.stringify(e.buttons),pageName:e.page.name,namespace:r};return e.$webAPI.pageSaveTemplate(s).done((function(t){2e4==t.state?e.$message("保存成功",!0):e.$message(t.message,!1)})).error((function(t){e.$message("保存失败",!1)})).always((function(){e.loading=!1}))}function M(e,t,n,a){var r=!1;dsf.layer.openDialog({title:"元数据修正",content:"DesMetaDataSource",width:"1200px",height:"60vh",params:{source:e,dict:t},closed:function(){r||a&&a()},btns:[{text:"确定",handler:function(e){var t=e.yes();if(!1===t)return!1;var a=!1;_.each(t,(function(e,t){if(e.isChange){a=!0;var n=e.ctrl;n.metadata.isuser=!0,n.metadata.id=e.mdkey.replace(/_/g,".")+"."+n.metadata.code,n.metadata.at=e.mdkey.replace(/_/g,".")}})),r=!0,n&&n(a)}},{text:"取消",handler:function(){a&&a()}}]})}function j(e,t,n){return"date"==n?(e="toDate(".concat(e,")"),t="toDate(".concat(t,")")):"time"==n&&(e="toDate('2000/01/01'+".concat(e,")"),t="toDate('2000/01/01'+".concat(t,")")),[e,t]}var V={null:function(e){return"isNull(".concat(e,")")},notnull:function(e){return"!isNull(".concat(e,")")},like:function(e,t){return"isLike(".concat(e,",").concat(t,")")},slike:function(e,t){return"_.startsWith(".concat(e,",").concat(t,")")},elike:function(e,t){return"_.endsWith(".concat(e,",").concat(t,")")},eq:function(e,t,n){var a=j(e,t,n),i=r()(a,2);return e=i[0],t=i[1],"".concat(e,"==").concat(t)},noteq:function(e,t,n){var a=j(e,t,n),i=r()(a,2);return e=i[0],t=i[1],"".concat(e,"!=").concat(t)},gt:function(e,t,n){var a=j(e,t,n),i=r()(a,2);return e=i[0],t=i[1],"".concat(e,">").concat(t)},gteq:function(e,t,n){var a=j(e,t,n),i=r()(a,2);return e=i[0],t=i[1],"".concat(e,">=").concat(t)},lt:function(e,t,n){var a=j(e,t,n),i=r()(a,2);return e=i[0],t=i[1],"".concat(e,"<").concat(t)},lteq:function(e,t,n){var a=j(e,t,n),i=r()(a,2);return e=i[0],t=i[1],"".concat(e,"<=").concat(t)}};function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.allComponentProps,a=e.getExtendShowLogic,i=[],s={pre:[],fns:{}};dsf.isFunction(a)&&(s=a(e)||{pre:[],fns:{}}),_.each(t,(function(e,t){var a=e.mode,o=e.advanced,c=void 0===o?"":o,u=e.options,l=void 0===u?[]:u,d="";if("advanced"==a)d=c.replace(/[\n\s]*\/\*\*([\n\s*]|.)+\*\*\/[\n\s]*/g,"");else if("options"==a){var p=[],f={},m=0;_.each(l,(function(e){var t=[];_.each(e,(function(e){var a=e.type,i=e.ctrl,o=e.ctrlCode,s=e.operator,c=(e.valueType,e.value);if("follow"==a)t.push('!fnMap["'.concat(i,'"]||').concat("true"==s?"":"!",'fnMap["').concat(i,'"].call(this,d,l)'));else if("operation"==a){var u,l=o.split("|"),d=r()(l,2),p=d[0],v=d[1],g=n[i],h=g.metadata,y=h.inColumn,x=h.valueAttributes,b=y?"l['".concat(g.metadata_fullcode,"']"):"d['".concat(g.metadata_fullcode,"']");f[g.metadata_fullcode]?u=f[g.metadata_fullcode].simpleCode:(u=dsf.math.numToEnglishLetter(++m),f[g.metadata_fullcode]={simpleCode:u,code:"let ".concat(u,"=").concat(b)});var w,_=V[s];"null"==s||"notnull"==s?w=_(u):(w=x.length>1?_("v['".concat(p,"']"),"'".concat(c,"'"),v):_("v","'".concat(c,"'"),v),w="isNull(".concat(u,")?!0:isMeet(").concat(u,",function(v){return ").concat(w,"})")),t.push(w)}})),1==t.length?p.push(t.join("&&")):t.length>1&&p.push("("+t.join(")&&(")+")")})),f=_.map(f,"code"),f=f.length?f.join(",")+";":"",1==p.length?d="function(d,l){".concat(f,"return ").concat(p[0],"}"):p.length>1&&(d="function(d,l){".concat(f,"return (").concat(p.join(")||("),")}"))}var v=d?[d]:[];s.fns[t]&&(v.push(s.fns[t]),delete s.fns[t]),v.length&&(d="'".concat(t,"':").concat(1==v.length?v[0]:v),i.push(d))})),_.each(s.fns,(function(e,t){var n="'".concat(t,"':").concat(e);i.push(n)}));var c=[].concat(o()(s.pre),["function isNull(v){return dsf.isUnDef(v)||v === ''||(dsf.isArray(v)&&!v.length)||dsf.isEmptyObject(v)}","function isLike(v1,v2){return v1.indexOf(v2)>-1}","function toDate(v){return isNaN(v)?'':dsf.date.parse(v)}","function isMeet(v,f){return dsf.isArray(v)?!!_.find(v,f):f(v)}"]);return i.length>0?"".concat(c.join(";"),";var fnMap={").concat(i.join(","),"};"):""}t["default"]={createAndCheckMetaDataSource:p,autoSaveLayout:f,customPostLayout:g,compileFormulaCode:x,convertFormulaCodeToRealCode:k,postTemplateLayoutInfo:J,saveLayoutToTemplate:N,getPostLayoutParams:L,postLayoutInfo:O,saveLayout:G,compileCss:y,saveToBusinessComponentGroup:A,compileShowLogic:q}}}]);
//# sourceMappingURL=../../../smap/core/dsf-core.core_designer_async.js.map