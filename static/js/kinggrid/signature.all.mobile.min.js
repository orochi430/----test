/*
 artDialog v6.0.5 | https://github.com/aui/artDialog kgDialog*/
 var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
 $jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
 $jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};
 $jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
 $jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
 $jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
 $jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
 $jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");
 $jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
 $jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
 this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(p){this.asyncThrow_(p)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(e){c||(c=!0,a.call(b,e))}}var b=this,c=!1;
 return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(m){this.reject_(m);return}"function"==typeof b?
 this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);
 this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(p){c.reject(p)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(v){f(v)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
 e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,e){for(var d=$jscomp.makeIterator(a),f=d.next();!f.done;f=d.next())c(f.value).callWhenSettled_(b,
 e)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");
 $jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
 !function(){function a(b){b=c[b];return"object"==typeof b?b:(b.exports||(b.exports={},b.exports=b.call(b.exports,a,b.exports,b)||b.exports),b.exports)}function b(a,b){c[a]=b}var c={};b("jquery",function(){return jQuery});b("popup",function(a){function b(){this.destroyed=!1;this.__popup=c("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body");this.__backdrop=this.__mask=c("<div />").css({opacity:.7,background:"#000"});this.node=this.__popup[0];
 this.backdrop=this.__backdrop[0];d++}var c=a("jquery"),d=0,h=!("minWidth"in c("html")[0].style),m=!h;return c.extend(b.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(a){if(this.destroyed)return this;var e=this.__popup,d=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=a||this.follow,!this.__ready){if(e.addClass(this.className).attr("role",this.modal?
 "alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),h||c(window).on("resize",c.proxy(this.reset,this)),this.modal)a={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||b.zIndex},e.addClass(this.className+"-modal"),m||c.extend(a,{position:"absolute",width:c(window).width()+"px",height:c(document).height()+"px"}),d.css(a).attr({tabindex:"0"}).on("focus",c.proxy(this.focus,this)),this.__mask=d.clone(!0).attr("style","").insertAfter(e),
 d.addClass(this.className+"-backdrop").insertBefore(e),this.__ready=!0;e.html()||e.html(this.innerHTML)}return e.addClass(this.className+"-show").show(),d.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(a){return!this.destroyed&&this.open&&(void 0!==a&&(this.returnValue=a),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),
 this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove");b.current===this&&(b.current=null);this.__popup.remove();this.__backdrop.remove();this.__mask.remove();h||c(window).off("resize",this.reset);this.__dispatchEvent("remove");for(var a in this)delete this[a];return this},reset:function(){var a=this.follow;return a?this.__follow(a):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var a=this.node,e=this.__popup,d=b.current,f=this.zIndex=b.zIndex++;
 (d&&d!==this&&d.blur(!1),c.contains(a,this.__getActive()))||(d=e.find("[autofocus]")[0],!this._autofocus&&d?this._autofocus=!0:d=a,this.__focus(d));return e.css("zIndex",f),b.current=this,e.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(a){var b=this.__activeElement;return!1!==a&&this.__focus(b),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(a,b){return this.__getEventListener(a).push(b),
 this},removeEventListener:function(a,b){a=this.__getEventListener(a);for(var c=0;c<a.length;c++)b===a[c]&&a.splice(c--,1);return this},__getEventListener:function(a){var b=this.__listener;return b||(b=this.__listener={}),b[a]||(b[a]=[]),b[a]},__dispatchEvent:function(a){var b=this.__getEventListener(a);this["on"+a]&&this["on"+a]();for(a=0;a<b.length;a++)b[a].call(this)},__focus:function(a){try{this.autofocus&&!/^iframe$/i.test(a.nodeName)&&a.focus()}catch(l){}},__getActive:function(){try{var a=document.activeElement,
 b=a.contentDocument;return b&&b.activeElement||a}catch(r){}},__center:function(){this.__popup[0].style.left="0px";var a=this.__popup,b=c(window),e=c(document),d=this.fixed,f=d?0:e.scrollLeft();e=d?0:e.scrollTop();d=b.width();var g=b.height();b=a.width();var h=a.height();g=382*(g-h)/1E3+e;a=a[0].style;a.left=Math.max(parseInt((d-b)/2+f),f)+"px";a.top=Math.max(parseInt(g),e)+"px"},__follow:function(a){var b=a.parentNode&&c(a),e=this.__popup;if(this.__followSkin&&e.removeClass(this.__followSkin),b){var d=
 b.offset();if(0>d.left*d.top)return this.__center()}var f=this.fixed,g=c(window);d=c(document);var h=g.width(),m=g.height(),p=d.scrollLeft(),E=d.scrollTop();d=e.width();g=e.height();var G=b?b.outerWidth():0,K=b?b.outerHeight():0,z=this.__offset(a);a=z.left;z=z.top;a=f?a-p:a;z=f?z-E:z;p=f?0:p;f=f?0:E;h=p+h-d;m=f+m-g;E={};var y=this.align.split(" "),C=this.className+"-",w={top:"bottom",bottom:"top",left:"right",right:"left"},F={top:"top",bottom:"top",left:"left",right:"left"},A=[{top:z-g,bottom:z+K,
 left:a-d,right:a+G},{top:z,bottom:z-g+K,left:a,right:a-d+G}];d={left:a+G/2-d/2,top:z+K/2-g/2};var L={left:[p,h],top:[f,m]};c.each(y,function(a,b){A[a][b]>L[F[b]][1]&&(b=y[a]=w[b]);A[a][b]<L[F[b]][0]&&(y[a]=w[b])});y[1]||(F[y[1]]="left"===F[y[0]]?"top":"left",A[1][y[1]]=d[F[y[1]]]);this.__followSkin=C+=y.join("-")+" "+this.className+"-follow";b&&e.addClass(C);E[F[y[0]]]=parseInt(A[0][y[0]]);E[F[y[1]]]=parseInt(A[1][y[1]]);e.css(E)},__offset:function(a){var b=a.parentNode,d=b?c(a).offset():{left:a.pageX,
 top:a.pageY};a=b?a:a.target;b=a.ownerDocument;a=b.defaultView||b.parentWindow;if(a==window)return d;a=a.frameElement;var e=c(b);b=e.scrollLeft();e=e.scrollTop();a=c(a).offset();return{left:d.left+a.left-b,top:d.top+a.top-e}}}),b.zIndex=1024,b.current=null,b});b("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",
 padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="checkInput" class="ui-dialog-checkInput"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'});
 b("dialog",function(a){var b=a("jquery"),c=a("popup"),d=a("dialog-config"),h=d.cssUri;h&&(a=a[a.toUrl?"toUrl":"resolve"])&&(h=a(h),h='<link rel="stylesheet" href="'+h+'" />',b("base")[0]?b("base").before(h):b("head").append(h));var m=0,p=new Date-0;h=!("minWidth"in b("html")[0].style);var l="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),r=!h&&!l,q=function(a,c,d){var e=a=a||{};"string"!=typeof a&&1!==a.nodeType||(a={content:a,fixed:!l});a=b.extend(!0,
 {},q.defaults,a);a.original=e;e=a.id=a.id||p+m;var f=q.get(e);return f?f.focus():(r||(a.fixed=!1),a.quickClose&&(a.modal=!0,a.backdropOpacity=0),b.isArray(a.button)||(a.button=[]),void 0!==d&&(a.cancel=d),a.cancel&&a.button.push({id:"cancel",value:a.cancelValue,callback:a.cancel,display:a.cancelDisplay}),void 0!==c&&(a.ok=c),a.ok&&a.button.push({id:"ok",value:a.okValue,callback:a.ok,autofocus:!0}),q.list[e]=new q.create(a))};h=function(){};h.prototype=c.prototype;h=q.prototype=new h;return q.create=
 function(a){var d=this;b.extend(this,new c);var e=(a.original,b(this.node).html(a.innerHTML)),f=b(this.backdrop);return this.options=a,this._popup=e,b.each(a,function(a,b){"function"==typeof d[a]?d[a](b):d[a]=b}),a.zIndex&&(c.zIndex=a.zIndex),e.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",!1===this.cancel?"none":"").attr("title",this.cancelValue).on("click",
 function(a){d._trigger("cancel");a.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),a.quickClose&&f.on("onmousedown"in document?"mousedown":"click",function(){return d._trigger("cancel"),!1}),this.addEventListener("show",function(){f.css({opacity:0,background:a.backdropBackground}).animate({opacity:a.backdropOpacity},150)}),this._esc=function(a){var b=a.target,e=b.nodeName,f=/^input|textarea$/i;a=a.keyCode;c.current!==d||f.test(e)&&"button"!==b.type||
 27===a&&d._trigger("cancel")},b(document).on("keydown",this._esc),this.addEventListener("remove",function(){b(document).off("keydown",this._esc);delete q.list[this.id]}),m++,q.oncreate(this),this},q.create.prototype=h,b.extend(h,{content:function(a){var c=this._$("content");return"object"==typeof a?(a=b(a),c.empty("").append(a.show()),this.addEventListener("beforeremove",function(){b("body").append(a.hide())})):c.html(a),this.reset()},title:function(a){return this._$("title").text(a),this._$("header")[a?
 "show":"hide"](),this},width:function(a){return this._$("content").css("width",a),this.reset()},height:function(a){return this._$("content").css("height",a),this.reset()},button:function(a){a=a||[];var c=this,d="",e=0;return this.callbacks={},"string"==typeof a?(d=a,e++):b.each(a,function(a,f){var g=f.id=f.id||f.value;a="";c.callbacks[g]=f.callback;!1===f.display?a=' style="display:none"':e++;d+='<button type="button" i-id="'+g+'"'+a+(f.disabled?" disabled":"")+(f.autofocus?' autofocus class="ui-dialog-autofocus"':
 "")+">"+f.value+"</button>";c._$("button").on("click","[i-id="+g+"]",function(a){b(this).attr("disabled")||c._trigger(g);a.preventDefault()})}),this._$("button").html(d),this._$("footer")[e?"show":"hide"](),this},statusbar:function(a){return this._$("statusbar").html(a)[a?"show":"hide"](),this},_$:function(a){return this._popup.find("[i="+a+"]")},_trigger:function(a){a=this.callbacks[a];return"function"!=typeof a||!1!==a.call(this)?this.close().remove():this}}),q.oncreate=b.noop,q.getCurrent=function(){return c.current},
 q.get=function(a){return void 0===a?q.list:q.list[a]},q.list={},q.defaults=d,q});window.KG_Dialog=a("dialog")}();var maxTickDepth=100,toString=Object.prototype.toString,nextTick="function"===typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},isArray=Array.isArray||function(a){return"[object Array]"===toString.call(a)};function slice(a,b){var c=a.length,d=Array(c);for(b=b||0;c-- >b;)d[c-b]=a[c];return d}function carry(a,b){try{b.apply(null,slice(arguments,2))}catch(c){a(c)}}
 function defer(a,b){var c=slice(arguments,2);nextTick(function(){try{b.apply(null,c)}catch(d){a(d)}})}
 function Thenjs(a,b){if(a instanceof Thenjs)return a;if(!(this instanceof Thenjs))return new Thenjs(a,b);this._finally=this._error=this._fail=this._result=this._nextThen=this._chain=this._success=this._each=this._eachSeries=this._parallel=this._series=null;if(!arguments.length)return this;var c=genContinuation(this,b);try{"function"===typeof a?a(c):null==a?c():"function"===typeof a.toThunk?a.toThunk()(c):"function"===typeof a.then?a.then(function(a){c(null,a)},c):c(null,a)}catch(d){c(d)}}
 Thenjs.defer=defer;Thenjs.each=function(a,b,c){return thenFactory(function(c){defer(c,each,c,a,b)},null,c)};Thenjs.eachSeries=function(a,b,c){return thenFactory(function(c){defer(c,eachSeries,c,a,b)},null,c)};Thenjs.parallel=function(a,b){return thenFactory(function(b){defer(b,parallel,b,a)},null,b)};Thenjs.series=function(a,b){return thenFactory(function(b){defer(b,series,b,a)},null,b)};Thenjs.nextTick=function(a){var b=slice(arguments,1);nextTick(function(){a.apply(null,b)})};
 Thenjs.onerror=function(a){console.error("Thenjs caught error: ",a);throw a;};var proto=Thenjs.prototype;proto.fin=proto.all=proto["finally"]=function(a){return thenFactory(function(b,c){c._finally=wrapTaskHandler(b,a)},this)};proto.then=function(a,b){return thenFactory(function(c,d){d._success=wrapTaskHandler(c,a);d._error=b&&wrapTaskHandler(c,b)},this)};
 proto.fail=proto["catch"]=function(a){return thenFactory(function(b,c){c._fail=wrapTaskHandler(b,a);c._success=function(){b.apply(null,[null].concat(slice(arguments)))}},this)};proto.each=function(a,b){return thenFactory(function(c,d){d._each=function(d,f){each(c,a||d,b||f)}},this)};proto.eachSeries=function(a,b){return thenFactory(function(c,d){d._eachSeries=function(d,f){eachSeries(c,a||d,b||f)}},this)};
 proto.parallel=function(a){return thenFactory(function(b,c){c._parallel=function(c){parallel(b,a||c)}},this)};proto.series=function(a){return thenFactory(function(b,c){c._series=function(c){series(b,a||c)}},this)};proto.toThunk=function(){var a=this;return function(b){a._result?(b.apply(null,a._result),a._result=!1):!1!==a._result&&(a._finally=b)}};
 function continuation(a){var b=this,c=arguments;if(!1!==b._result){!b._result&&b._chain&&b.debug.apply(b,["\nChain "+b._chain+": "].concat(slice(c)));b._result=!1;try{continuationExec(b,c,a)}catch(d){nextTick(function(){continuationError(b,d,a)})}}}function continuationExec(a,b,c){if(a._finally)return a._finally.apply(null,b);if(null!=c)throw c;if(c=a._success||a._each||a._eachSeries||a._parallel||a._series)return c.apply(null,slice(b,1));a._result=b}
 function continuationError(a,b,c){var d=a,e=a._error||a._fail;a._nextThen&&null==c&&(e=null,d=a._nextThen);for(;!e&&d;)e=d._fail,d=d._nextThen;if(e)return e(b);if(Thenjs.onerror)return Thenjs.onerror(b);d._result=[b]}function genContinuation(a,b){function c(){return continuation.apply(a,arguments)}c._isCont=!0;b&&(proto.debug="function"===typeof b?b:defaultDebug,a._chain=1);return c}
 function thenFactory(a,b,c){var d=new Thenjs;c=genContinuation(d,c);a(c,b);if(!b)return d;b._nextThen=d;b._chain&&(d._chain=b._chain+1);b._result&&nextTick(function(){continuation.apply(b,b._result)});return d}function wrapTaskHandler(a,b){return b._isCont?b:function(){b.apply(null,[a].concat(slice(arguments)))}}function parallelNext(a,b,c,d){function e(e,g){if(!c.finished){if(null!=e)return c.finished=!0,a(e);b[d]=g;return 0>--c.i&&a(null,b)}}e._isCont=!0;return e}
 function each(a,b,c){var d,e=[],f={};if(!isArray(b))return a(errorify(b,"each"));f.i=d=b.length-1;if(0>d)return a(null,e);for(var g=0;g<=d;g++)c(parallelNext(a,e,f,g),b[g],g,b)}function parallel(a,b){var c,d=[],e={};if(!isArray(b))return a(errorify(b,"parallel"));e.i=c=b.length-1;if(0>c)return a(null,d);for(var f=0;f<=c;f++)b[f](parallelNext(a,d,e,f),f,b)}
 function eachSeries(a,b,c){function d(p,l){if(null!=p)return a(p);f[e]=l;if(++e>m)return a(null,f);g=0<--h?carry:(h=maxTickDepth,defer);g(a,c,d,b[e],e,b)}var e=0,f=[],g,h=maxTickDepth;d._isCont=!0;if(!isArray(b))return a(errorify(b,"eachSeries"));var m=b.length-1;if(0>m)return a(null,f);c(d,b[0],0,b)}
 function series(a,b){function c(m,p){if(null!=m)return a(m);e[d]=p;if(++d>h)return a(null,e);f=0<--g?carry:(g=maxTickDepth,defer);f(a,b[d],c,d,b)}var d=0,e=[],f,g=maxTickDepth;c._isCont=!0;if(!isArray(b))return a(errorify(b,"series"));var h=b.length-1;if(0>h)return a(null,e);b[0](c,0,b)}function defaultDebug(){console.log.apply(console,arguments)}function errorify(a,b){return Error("The argument "+(a&&a.toString())+' in "'+b+'" is not Array!')}Thenjs.NAME="Thenjs";Thenjs.VERSION="1.3.4";
 var instance,root=window,KG=function(){function a(a,b){var c=q.length,d=a.constructor;d=v.is("Function",d)&&d.prototype||ObjProto;var e="constructor";for(v.has(a,e)&&!_.contains(b,e)&&b.push(e);c--;)e=q[c],e in a&&a[e]!==d[e]&&!_.contains(b,e)&&b.push(e)}function b(a){a=JSON.stringify(a);return e?a.replace(/\\u([0-9a-fA-F]{2,4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))}):a}function c(){var a=navigator.userAgent.toLowerCase();return"micromessenger"==a.match(/MicroMessenger/i)?!1:
 "qq"==a.match(/QQ/i)?!1:"weibo"==a.match(/WeiBo/i)?!1:null!=a.match(/Android/i)?null==a.match(/browser/i):null!=a.match(/iPhone/i)?null==a.match(/safari/i):null==a.match(/macintosh/i)&&null==a.match(/windows/i)}function d(a){for(var c=[],d=0;d<a.length;d++){var e={};e.type=P[Object.prototype.toString.call(a[d]).slice(8,-1)];e.value=a[d];c.push(e)}return b(c)}var e=!1;root.JSON&&(e='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));var f=!!window.ActiveXObject||"ActiveXObject"in window,g=function(a,
 b){a=this.words=a||[];this.sigBytes=void 0!=b?b:4*a.length};g.prototype={clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-b%4*8;a.length=Math.ceil(b/4)},toString:function(a){return(a||h).stringify(this)}};var h={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,
 2),16)<<24-d%8*4;return new g.init(c,b/2)}},m={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-d%4*8;return new g(c,b)}},p={stringify:function(a){try{return decodeURIComponent(escape(m.stringify(a)))}catch(W){throw Error("Malformed UTF-8 data");}},parse:function(a){return m.parse(unescape(encodeURIComponent(a)))}},
 l=function(a){this.map=a};l.map={};l.of=function(a){a=a||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var b=l.map[a];b||(b=new l(a));return b};l.prototype={decodeByte:function(a){var b=a.length,c=this.map,d=c.charAt(64);d&&(d=a.indexOf(d),-1!=d&&(b=d));d=[];for(var e=0,f=0;f<b;f++)if(f%4){var Q=c.indexOf(a.charAt(f-1))<<f%4*2,h=c.indexOf(a.charAt(f))>>>6-f%4*2;d[e>>>2]|=(Q|h)<<24-e%4*8;e++}return new g(d,e)},decode:function(a){return p.stringify(this.decodeByte(a))},encode:function(a){if(a)return this.encodeByte(p.parse(a))},
 encodeByte:function(a){var b=a.words,c=a.sigBytes,d=this.map;a.clamp();a=[];for(var e=0;e<c;e+=3)for(var f=(b[e>>>2]>>>24-e%4*8&255)<<16|(b[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|b[e+2>>>2]>>>24-(e+2)%4*8&255,g=0;4>g&&e+.75*g<c;g++)a.push(d.charAt(f>>>6*(3-g)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")}};var r=!{toString:null}.propertyIsEnumerable("toString"),q="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" "),t=function(a,b){var c=a.length,
 d=[];for(b=b||0;c-- >b;)d[c-b]=a[c];return d},x=function(){},v={Utf8:p,Base64:l,slice:t,boolean:function(a,b,c){return!(a.hasOwnProperty(b)?!a[b]:!c)},rand:function(a){return Math.ceil((9301*(new Date).getTime()+49297)%233280/233280*a)},addEvent:function(a){var b=c();return a?function(a,b,c){b=b.split(" ");for(var d=0;d<b.length;d++)a.attachEvent("on"+b[d],function(b){b.target=a;b.preventDefault=x;b.stopPropagation=x;c(b)})}:function(a,c,d){void 0===a.eventList&&(a.eventList={});for(var e=c.split(" "),
 f=0;f<e.length;f++){for(var g in a.eventList)if(g===e[f])return;b?a.addEventListener(e[f],d):document.addEventListener.apply(a,[e[f]].concat(v.slice(arguments,2)));a.eventList[e[f]]=!0}}}(root.document.attachEvent),extend:function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),Q=g.length,h=0;h<Q;h++){var O=g[h];b&&void 0!==c[O]||(c[O]=f[O])}return c}}(function(b){if(!v.is("Object",b))return[];var c=[],d;for(d in b)c.push(d);
 r&&a(b,c);return c}),filter:function(a,b){var c={},d=b;if(v.is("String",b)){var e=v.slice(arguments,1);d=function(a){for(var b=0;b<e.length;b++)if(e[b]===a)return!1;return!0}}for(var f in a)(e=d.call(a,f))&&(c[f]=a[f]);return c},convertText:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].replace(/(\S)/ig,"<span>$1</span>").replace(/\n|\r/ig,"<span><br></span>").replace(/\s/ig,"<span>&nbsp;</span>");return b},handleEdittable:function(a,b){var c=[],d=0,e=0;$.each(a.find("span"),function(b,g){b=
 $(g).text()||$(g).html();var h={};"<br>"==b&&(d=0,e=f?e+$(g).height()/2:e+$(g).height(),b="");0==e&&(e=$(g).height());d>=a.width()-$(g).width()&&(d=0,e+=$(g).height());h.txt=b;h.left=d;h.top=e;c.push(h);""!=b&&(d+=$(g).width())});return c},val:function(a,b){if(v.is("Function",a)){var c=3>arguments.length?[]:[].slice.call(arguments).slice(2);return a.apply(b,c)}return a},$:function(a){var b=document.getElementById(a);if(!b){var c=document.getElementsByName(a);c&&0<c.length&&(b=c[0])}b||(c=document.getElementsByTagName(a))&&
 0<c.length&&(b=c[0]);return b},keys:function(b){if(!v.is("Object",b))return[];if(nativeKeys)return nativeKeys(b);var c=[],d;for(d in b)v.has(b,d)&&c.push(d);r&&a(b,c);return c},contains:function(a,b,c){var d=a&&a.length;"number"==typeof d&&0<=d&&d<=MAX_ARRAY_INDEX||(a=_.values(a));return 0<=_.indexOf(a,b,"number"==typeof c&&c)},values:function(a){for(var b=_.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},has:function(a,b){return null!=a&&Object.prototype.hasOwnProperty.call(a,b)},
 inherit:function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.uber=b.prototype},is:function(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return void 0!==b&&null!==b&&c===a},colorRgb:function(a){a=a.toLowerCase();var b=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(a&&b.test(a)){if(4===a.length){var c="#";for(b=1;4>b;b+=1)c+=a.slice(b,b+1).concat(a.slice(b,b+1));a=c}c=[];for(b=1;7>b;b+=2)c.push(parseInt("0x"+a.slice(b,b+2)));return"RGB("+c.join(",")+
 ")"}return a},colorHex:function(a){if(/^(rgb|RGB)/.test(a)){for(var b=a.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),c="#",d=0;d<b.length;d++){var e=Number(b[d]).toString(16);"0"===e&&(e+=e);c+=e}7!==c.length&&(c=a);return c.toUpperCase()}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)&&(b=a.replace(/#/,"").split(""),6!==b.length&&3===b.length))for(a="#",d=0;d<b.length;d+=1)a+=b[d]+b[d];return a.toUpperCase()},dateConvert:function(a,b){var c=["\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split(""),
 "\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split("")];a=a.match(/^(\d{2}|\d{4})(\u5e74)(\d{1,2})(\u6708)(\d{1,2})(\u65e5)$/);var d="";if(null!=a){for(var e=1;e<a.length;e+=2){var f=a[e];if(2==f.length)f="1"==f.charAt(0)?"0"==f.charAt(1)?"\u5341":"\u5341"+c[b-1][f.charAt(1)]:"0"==f.charAt(1)?c[b-1][f.charAt(0)]+"\u5341":c[b-1][f.charAt(0)]+"\u5341"+c[b-1][f.charAt(1)];else{for(var g="",h=0;h<f.length;h++)g+=c[b-1][f.charAt(h)];f=g}d+=f+a[e+1]}return d}},formatDate:function(a,b){var c=
 "Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getMonth()],d={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));/(MMM)/.test(b)&&(b=b.replace(RegExp.$1,"$"));for(var e in d)(new RegExp("("+e+")")).test(b)&&(a=d[e],2==RegExp.$1.length&&(a=("00"+d[e]).substr((""+d[e]).length)),b=b.replace(RegExp.$1,
 a));b=b.replace("$",c);/[*]/gi.test(b)&&(c=b.replace(/[*]/gi,""),b=this.dateConvert(c,b.length-c.length));return b},template:function(a,b){for(var c=/<%([^%>]+)?%>/g,d=/(^( )?(var|if|for|else|switch|case|break|{|}))(.*)?/g,e="var r=[];\n",f=0,g=function(a,b){b?e+=a.match(d)?a+"\n":"r.push("+a+");\n":e+=""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':"";return g},h;h=c.exec(a);)g(a.slice(f,h.index))(h[1],!0),f=h.index+h[0].length;g(a.substr(f,a.length-f));e+='return r.join("");';return(new Function(e.replace(/[\r\t\n]/g,
 ""))).apply(b,t(arguments,2))},first:function(a,b){return a.substring(0,1)[b?"toLowerCase":"toUpperCase"]()+a.substring(1)},html2Escape:function(a){return a.replace(/[<>&"]/g,function(a){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[a]})},conversion_getDPI:function(){var a=[];if(window.screen.deviceXDPI)a[0]=window.screen.deviceXDPI,a[1]=window.screen.deviceYDPI;else{var b=document.createElement("DIV");b.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden";
 document.body.appendChild(b);a[0]=parseInt(b.offsetWidth);a[1]=parseInt(b.offsetHeight);b.parentNode.removeChild(b)}return a},pxConversionMm:function(a){return a/this.conversion_getDPI()[0]*25.4},eosFormatTime:function(a){var b=a.split(" ")[0],c=a.split(" ")[1].split(":");a=c.slice(1,c.length).join(":");c=parseInt(c[0])+8;c=(24>c?c:c%24).toString();return b+" "+(10>c?"0"+c:c)+":"+a}},D=function(a){this.name=a};D.prototype={on:function(a,b){this.__getEventListener(a).push(b);return this},off:function(a,
 b){a=this.__getEventListener(a);for(var c=0;c<a.length;c++)b===a[c]&&a.splice(c--,1);return this},clear:function(a){0<this.__getEventListener(a).length&&(this.__listener[a]=[]);return this},trigger:function(a){var b,c=this.__getEventListener(a),d=Array.prototype.slice.call(arguments);this["on"+a]&&(b=this["on"+a].apply(this,d.slice(1)));for(var e=0;e<c.length;e++)c[e].apply(this,d.slice(1));return b},__getEventListener:function(a){var b=this.__listener;b||(b=this.__listener={});b[a]||(b[a]=[]);return b[a]}};
 var J=function(a,b){var c=0,d="",e;for(e in a){var f=a[e];if(void 0!=f){var g=function(a){0<c&&(d+=b);d+=e+"="+a;c++};if(v.is("Array",f))for(var h=0;h<f.length;h++)g(f[h]);else g(f)}}H.trigger("formatData",d);return d},E=function(a,b){var c="";b=b||"";if(v.is("Array",a))for(var d=0;d<a.length;d++)0<d&&(c+=b),c+=J(a[d],b);else c=J(a,b);return c},G={result:!1,errcode:"interErr"},K={result:!1,errcode:"responseErr"},z={result:!1,errcode:"connectionErr"},y={result:!1,errcode:"parseErr"},C={result:!1,errcode:"timeoutErr"},
 w=function(a,b){H.trigger.apply(H,["response",b].concat(this));t(arguments,1);a&&a(b)},F=function(a,b){this.url=a;this.data=b;H.trigger("beforeJSONP",a,b)},A=F.prototype;A.parseData=function(){var a="",b=this.data;if(v.is("String",b))a=b;else if(v.is("Object",b))for(var c in b)b[c]&&(a+="&"+c+"="+encodeURIComponent(b[c]));else if(v.is("Array",b))for(var d=0;d<b.length;d++){var e=b[d];for(c in e)e[c]&&(a+="&"+c+"="+encodeURIComponent(e[c]))}a+="&hookback="+this.name;a+="&_="+(new Date).getTime();a=
 a.substr(1);H.trigger("parseData",a);return a};A.getJSON=function(a){var b=this,c=b.url,d=b.data,e=this.name="jsonp_"+(new Date).getTime()+"_"+v.rand(1E5);c=c+(-1===c.indexOf("?")?"?":"&")+this.parseData(d);var f=document.createElement("script");f.type="text/javascript";f.src=c;f.id=e;f.charset="utf-8";var g=function(){setTimeout(function(){clearTimeout(h);f.parentNode.removeChild(f);try{delete window[e]}catch(u){}},1)};window[e]=function(c){b._execed=!0;w.call(b,a,c)};f.onload=function(){g();b._execed||
 w.call(b,a,y)};f.onerror=function(){g();void 0!==Signature.options.isResponseErr&&Signature.options.isResponseErr||w.call(b,a,K)};var h=setTimeout(function(){g();w.call(b,a,C)},I.options.timeout);(c=document.getElementsByTagName("head"))&&c[0]&&c[0].appendChild(f)};var L=function(a,b){this.url=a;this.data=b;this.xdr=new XDomainRequest};L.prototype.getJSON=function(a){var b=this.xdr;b.onload=function(){try{var c=JSON.parse(b.responseText)}catch(X){w.call(b,a,y);return}w.call(b,a,c)};b.onerror=function(){w.call(b,
 a,z)};b.timeout=I.options.timeout;b.ontimeout=function(){w.call(b,a,C)};b.open("POST",this.url);b.send(E(this.data,"\r\n"))};var B=function(a,b){if(window.XMLHttpRequest)var c=new XMLHttpRequest;else if(window.ActiveXObject)for(var d=0;d<activexName.length;d++)try{c=new ActiveXObject(activexName[d]);break}catch(Y){}this.xhr=c;this.url=a;this.data=b};B.prototype.getJSON=function(a){var b=this.xhr,c=!1;b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status||304==b.status)try{var d=JSON.parse(b.responseText);
 w.call(b,a,d)}catch(Z){w.call(b,a,y)}else c&&w.call(b,a,K)};b.open("POST",this.url,!0);b.onerror=function(){w.call(b,a,z)};b.timeout=I.options.timeout;b.ontimeout=function(){c=!0;w.call(b,a,C)};b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var d=E(this.data,"\r\n");b.send(d)};XMLHttpRequest.prototype._send=function(a){Signature.setRequestHeader(this);this.send(a)};Function.prototype.before=function(a){var b=this;return function(){a.apply(this,arguments);return b.apply(this,arguments)}};
 XMLHttpRequest.prototype.send=XMLHttpRequest.prototype.send.before(function(){Signature.setRequestHeader(this)});var n="withCredentials"in XMLHttpRequest.prototype?!1:"undefined"!=typeof XDomainRequest?!0:!1,M=function(a,b,c){H.trigger.apply(H,["beforeAjax"].concat(t(arguments)));return c?new F(a,b):n?new L(a,b):new B(a,b)},P={Boolean:"BOOL",String:"BSTR",Number:"LONG"},I=function(){};I.errCode={1E4:"\u7cfb\u7edf\u9519\u8bef",20001:"\u5bc6\u94a5\u76d8\u4fe1\u606f\u9519\u8bef",20003:"\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u5bc6\u7801",
 20004:"\u8bf7\u8f93\u5165\u5bc6\u7801!",11100:"\u7b7e\u7ae0\u670d\u52a1\u5668\u9519\u8bef",111E3:"\u5f53\u524d\u7528\u6237\u6ca1\u6709\u7b7e\u7ae0",111001:"\u8be5\u7528\u6237\u6ca1\u6709\u516c\u7ae0",111002:"\u8be5\u7528\u6237\u6ca1\u6709\u79c1\u7ae0",111003:"\u8be5\u7528\u6237\u6ca1\u6709\u6cd5\u4eba\u7ae0",111004:"\u8be5\u7528\u6237\u6ca1\u6709\u6cd5\u4eba\u7b7e\u540d\u5370\u7ae0",111005:"\u8be5\u7528\u6237\u6ca1\u6709\u624b\u5199\u7b7e\u540d\u5370\u7ae0",11101:"\u5f53\u524d\u7528\u6237\u6ca1\u6709\u7b7e\u7ae0",
 11102:"\u5370\u7ae0\u9519\u8bef",11103:"\u8bc1\u4e66\u8fc7\u671f",11104:"\u5370\u7ae0\u8fc7\u671f",11105:"\u83b7\u53d6\u7b7e\u7ae0\u4fe1\u606f\u5931\u8d25!",11106:"\u83b7\u53d6\u8bc1\u4e66\u4fe1\u606f\u5931\u8d25!",11107:"\u672a\u641c\u7d22\u5230\u60a8\u8981\u7684\u7b7e\u7ae0!",11108:"\u672a\u8bbe\u7f6e\u7b7e\u7ae0\u5bc6\u7801!",11109:"\u64cd\u4f5c\u5931\u8d25\uff0c\u7b7e\u7ae0\u52a9\u624b\u672a\u542f\u7528\u6216\u672a\u6388\u6743",11110:"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u62d4\u6389\u5f53\u524d\u94a5\u5319\u76d8\u518d\u8fdb\u884c\u64cd\u4f5c",
 11111:"\u5141\u8bb8\u79fb\u52a8\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u539f\u7b7e\u7ae0\u5bc6\u94a5\u5141\u8bb8\u79fb\u52a8\uff01",11112:"\u5141\u8bb8\u79fb\u52a8\u5931\u8d25\uff0c\u8be5\u7b7e\u7ae0\u6570\u636e\u6ca1\u6709\u5141\u8bb8\u79fb\u52a8\u8bf7\u6c42\u6743\u9650\uff01",11113:"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u624b\u5199\u7b7e\u540d\u3002",11114:"\u8bf7\u63d2\u5165\u5f53\u524d\u7b7e\u7ae0\u6240\u5c5e\u5bc6\u94a5\u76d8",11115:"\u5f53\u524d\u7528\u6237\u6ca1\u6709\u64cd\u4f5c\u8be5\u7b7e\u7ae0\u6743\u9650",
 none:"\u5ba2\u6237\u7aef\u672a\u77e5\u5f02\u5e38!",signErr:"\u7b7e\u540d\u5931\u8d25",serverErr:"\u8c03\u7528\u4ea7\u54c1\u7ec4\u4ef6\u5f02\u5e38",parseErr:"\u6570\u636e\u683c\u5f0f\u5f02\u5e38",responseErr:"\u4ea7\u54c1\u7ec4\u4ef6\u54cd\u5e94\u5f02\u5e38",connectionErr:"\u4ea7\u54c1\u7ec4\u4ef6\u8fde\u63a5\u5f02\u5e38",timeoutErr:"\u8bf7\u6c42\u54cd\u5e94\u8d85\u65f6",interErr:"\u83b7\u53d6\u63a5\u53e3\u5f02\u5e38","-7":"\u7b7e\u540d\u7ec4\u4ef6\u9519\u8bef"};v.extend(I.errCode,{then:{"-1":"\u8bf7\u5b89\u88c5\u5ba2\u6237\u7aef",
 "-2":"\u8bf7\u63d2\u5165\u5f53\u524d\u7b7e\u7ae0\u6240\u5c5e\u7684\u5bc6\u94a5\u76d8","-3":"\u672a\u5b89\u88c5\u624b\u673a\u76fe\u7ec4\u4ef6","-12":"\u83b7\u53d6\u8bc1\u4e66\u5931\u8d25","-13":"\u7b7e\u540d\u65f6\uff0c\u52a0\u8f7d\u8bc1\u4e66\u5931\u8d25","-15":"\u7b7e\u540d\u6570\u636e\u4e0d\u80fd\u4e3a\u7a7a","-16":"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","-17":"\u89e3\u6790\u8bc1\u4e66\u5931\u8d25","-18":"\u672a\u5b89\u88c5\u624b\u673a\u76fe\u7ec4\u4ef6","-19":"\u624b\u673a\u76fe\u767b\u5f55\u5931\u8d25",
 1:"\u6ca1\u6709\u68c0\u6d4b\u5230\u5bc6\u94a5\u76d8",2:"\u5bc6\u94a5\u76d8\u6ca1\u6709\u6b63\u786e\u521d\u59cb\u5316",3:"\u5bc6\u94a5\u76d8\u9a71\u52a8\u672a\u5b89\u88c5",4:"\u53ea\u80fd\u63d2\u5165\u4e00\u4e2a\u5bc6\u94a5\u76d8",7:"\u5bc6\u7801\u9519\u8bef\u6216\u5bc6\u94a5\u76d8\u88ab\u9501\u5b9a",8:"\u975e\u6cd5\u6388\u6743",9:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25",10:"\u624b\u673a\u76fe\u767b\u5f55\u5931\u8d25",11:"\u5f53\u524d\u5bc6\u94a5\u76d8\u6ca1\u6709\u5370\u7ae0",12:"\u83b7\u53d6\u5370\u7ae0\u4fe1\u606f\u5931\u8d25",
 35:"\u94a5\u5319\u76d8\u672a\u751f\u6548\uff0c\u4e0d\u80fd\u7b7e\u7ae0\uff01",36:"\u94a5\u5319\u76d8\u5df2\u8fc7\u671f\uff0c\u4e0d\u80fd\u7b7e\u7ae0\uff01",37:"\u6388\u6743\u4fe1\u606f\u7ed3\u6784\u975e\u6cd5\uff01",38:"\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u7ecf\u8fc7\u671f\u6216\u8fd8\u672a\u751f\u6548\uff01",39:"\u7b7e\u7ae0\u8bc1\u4e66\u4e0d\u53d7\u9881\u53d1\u673a\u6784\u4fe1\u4efb\uff01",40:"\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",41:"\u7b7e\u7ae0\u8bc1\u4e66\u6839\u8bc1\u4e66\u672a\u5b89\u88c5\u6216\u65e0\u6548\u7684\u6839\u8bc1\u4e66\uff01",
 42:"\u540a\u9500\u5217\u8868\u6587\u4ef6\u4e0d\u5b58\u5728",43:"\u672a\u68c0\u6d4b\u5230\u8bc1\u4e66",44:"\u6839\u8bc1\u4e66\u6587\u4ef6\u4e0d\u5b58\u5728",45:"\u6839\u8bc1\u4e66\u548c\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u914d\u5957",46:"\u540a\u9500\u5217\u8868\u548c\u8be5\u8bc1\u4e66\u7684\u540a\u9500\u5217\u8868\u4e0d\u914d\u5957","-101":"\u83b7\u53d6\u5bc6\u94a5\u76d8\u6709\u6548\u671f\u5f02\u5e38","-103":"\u5bc6\u94a5\u76d8\u672a\u751f\u6548","-104":"\u671f\u9650\u8bb8\u53ef\u5df2\u8fc7\u671f",
 "-999":"\u91d1\u683c\u7ec4\u4ef6\u672a\u77e5\u9519\u8bef","30001@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u7b7e\u540d\u503c\u5931\u8d25\uff01","30002@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5236\u7ae0\u4eba\u8bc1\u4e66\u6709\u6548\u671f\u5931\u8d25\uff01","30003@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u7684\u6709\u6548\u671f\u5931\u8d25\uff01",
 "30004@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u6709\u6548\u6027\u5931\u8d25\uff01","30005@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u7b7e\u7ae0\u6570\u636e\u5931\u8d25\uff01","-7@KGCrySignMessage":"\u7b7e\u540d\u7ec4\u4ef6\u9519\u8bef","8@KGVerifySign":"\u9a8c\u8bc1\u5931\u6548","1@KGVerifySign":"\u672a\u5b89\u88c5\u7b7e\u540d\u7ec4\u4ef6","2@KGCrySignMessage":"\u83b7\u53d6\u8bc1\u4e66\u5931\u8d25",
 "3@KGCrySignMessage":"\u7b7e\u540d\u65f6\uff0c\u52a0\u8f7d\u8bc1\u4e66\u5931\u8d25","5@KGCrySignMessage":"\u7b7e\u540d\u6570\u636e\u4e0d\u80fd\u4e3a\u7a7a","6@KGCrySignMessage":"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","7@KGCrySignMessage":"\u89e3\u6790\u8bc1\u4e66\u5931\u8d25"},KGRunFingerPrints:{"-1":"\u8bbe\u5907\u7c7b\u578b\u8bbe\u7f6e\u9519\u8bef","-2":"\u6ca1\u6709\u5b89\u88c5\u6307\u7eb9\u7ec4\u4ef6","-3":"\u6307\u7eb9\u91c7\u96c6\u5931\u8d25"},KGRunHandWritten:{"-1":"\u8bbe\u5907\u7c7b\u578b\u8bbe\u7f6e\u9519\u8bef",
 "-2":"\u6ca1\u6709\u5b89\u88c5\u624b\u5199\u7ec4\u4ef6","-3":"\u6388\u6743\u7801\u4e0d\u6b63\u786e","-4":"\u7b7e\u540d\u53d6\u6d88","-5":"\u65e0\u670d\u52a1\u53ef\u7528","-6":"\u7b7e\u540d\u8bbe\u5907\u9519\u8bef","-7":"\u672a\u77e5\u9519\u8bef"},KGGetTSWithDigest:{1:"\u83b7\u53d6\u65f6\u95f4\u6233\u5f02\u5e38",2:"\u83b7\u53d6\u65f6\u95f4\u6233\u5931\u8d25",3:"\u54cd\u5e94\u6570\u636e\u4e3a\u7a7a"},KGGetTSURLInfo:{1:"\u65f6\u95f4\u6233\u672a\u542f\u7528"},KGValidate_GM:{"-1":"\u6ca1\u6709\u5b89\u88c5\u7b7e\u540d\u7ec4\u4ef6",
 "-2":"\u6ca1\u6709\u516c\u5171\u6a21\u5757\u7ec4\u4ef6","-3":"KCL280 \u9a8c\u8bc1\u5931\u8d25\uff0c\u672a\u77e5\u539f\u56e0\u7684\u9a8c\u8bc1\u5931\u8d25",1:"KCL272_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5df2\u8fc7\u671f\u6216\u672a\u751f\u6548\uff01",2:"KCL274 \u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u9a8c\u8bc1\u672a\u901a\u8fc7!",3:" KCL270_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",
 4:" KCL276 \u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u5b89\u88c5\u672a\u6210\u529f!",5:" KCL266_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u540a\u9500\u5217\u8868\uff01",6:"KCL260_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u7b7e\u7ae0\u4eba\u8bc1\u4e66\uff01",7:"KCL262_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u7b7e\u7ae0\u4eba\u6839\u8bc1\u4e66\uff01",
 8:"KCL264_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u5339\u914d\uff01",9:"KCL268_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u540a\u9500\u5217\u8868\u4e0d\u5339\u914d\uff01",10:"KCL273_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u5df2\u8fc7\u671f\u6216\u672a\u751f\u6548",11:"KCL275 \u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u9a8c\u8bc1\u672a\u901a\u8fc7!",
 12:"KCL271_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",13:"KCL277_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u5b89\u88c5\u672a\u6210\u529f!",14:"KCL267_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u5236\u7ae0\u4eba\u8bc1\u4e66\u540a\u9500\u5217\u8868\uff01",15:"KCL281_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u5236\u7ae0\u4eba\u8bc1\u4e66\uff01",
 16:"KCL263_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u5236\u7ae0\u4eba\u6839\u8bc1\u4e66\uff01",17:"KCL265_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u5339\u914d\uff01",18:"KCL269_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u540a\u9500\u5217\u8868\u4e0d\u5339\u914d\uff01",
 19:"KCL261_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u4e0d\u5728\u5370\u7ae0\u7684\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5217\u8868\u4e2d\uff01",20:"KCL278_\u9a8c\u8bc1\u5370\u7ae0\u5236\u7ae0\u65f6\u95f4\u5931\u8d25\uff0c\u5370\u7ae0\u672a\u751f\u6548\uff01",21:"KCL279 \u9a8c\u8bc1\u5370\u7ae0\u5236\u7ae0\u65f6\u95f4\u5931\u8d25\uff0c\u5370\u7ae0\u5df2\u7ecf\u8fc7\u671f\uff01"},KGValidateCertificate:{"-1":"\u6ca1\u6709\u5b89\u88c5\u7b7e\u540d\u7ec4\u4ef6",
 "-2":"\u672a\u77e5\u9519\u8bef",1:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u7ecf\u8fc7\u671f\u6216\u8fd8\u672a\u751f\u6548\uff01",2:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u4e0d\u53d7\u9881\u53d1\u673a\u6784\u4fe1\u4efb\uff01",3:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",4:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u6839\u8bc1\u4e66\u672a\u5b89\u88c5\u6216\u65e0\u6548\u7684\u6839\u8bc1\u4e66\uff01",5:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u540a\u9500\u5217\u8868\u6587\u4ef6\u4e0d\u5b58\u5728\uff01",
 6:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u8bc1\u4e66\uff01",7:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u6839\u8bc1\u4e66\u6587\u4ef6\u4e0d\u5b58\u5728\uff01",8:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u6839\u8bc1\u4e66\u548c\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u914d\u5957\uff01",9:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u540a\u9500\u5217\u8868\u548c\u8be5\u8bc1\u4e66\u7684\u540a\u9500\u5217\u8868\u4e0d\u914d\u5957\uff01"},KG_MSG:{in_input_msg:"\u8bf7\u8f93\u5165\u5bc6\u7801\uff01",in_verification_msg:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01",
 timestamp_time:"(\u65f6\u95f4\u6765\u6e90\u4e8e\u65f6\u95f4\u6233\u670d\u52a1\u5668)",server_time:"(\u65f6\u95f4\u6765\u6e90\u4e8e\u7b7e\u7ae0\u670d\u52a1\u5668)",local_time:"(\u65f6\u95f4\u6765\u6e90\u4e8e\u672c\u5730)",modify_signdata:"\u7b7e\u540d\u6570\u636e\u88ab\u7be1\u6539",normal_signdata:"\u7b7e\u540d\u6570\u636e\u9a8c\u8bc1\u6b63\u5e38",success_signdata:"\u6570\u5b57\u7b7e\u540d\u6210\u529f\uff01",invalid_signdata:"\u7b7e\u7ae0\u65e0\u6548\uff0c\u4e0d\u80fd\u6267\u884c\u6570\u5b57\u7b7e\u540d\uff01",
 cannot_move:"\u8fd9\u4e2a\u5370\u7ae0\u4e0d\u662f\u4f60\u5f53\u524d\u63d2\u5165\u7684key\u7684\u5370\u7ae0\uff0c\u4e0d\u80fd\u79fb\u52a8\uff01"},KG_TITLE:{SignatureMoveNot:"\u7981\u6b62\u79fb\u52a8",SignatureMoveDo:"\u5141\u8bb8\u79fb\u52a8",SignSignature:"\u6570\u5b57\u7b7e\u540d",SignVerify:"\u7b7e\u540d\u9a8c\u8bc1",SignatureVerify:"\u7b7e\u7ae0\u9a8c\u8bc1",RevokeSignature:"\u64a4\u9500\u7b7e\u7ae0",KinggridSignature:"\u7535\u5b50\u7b7e\u7ae0",DateSet:"\u65e5\u671f\u8bbe\u7f6e",HWSignature:"\u624b\u5199\u7b7e\u6279",
 scanBCSignature:"\u626b\u7801\u7b7e\u7ae0",moveSignature:"\u79fb\u52a8\u7b7e\u7ae0",ProtectedDataSet:"\u4fdd\u62a4\u9879\u8bbe\u7f6e"},KGVerifyGBSealAction:{"-1":"\u670d\u52a1\u5668\u901a\u8baf\u5931\u8d25",1:"\u5370\u7ae0\u7ed3\u6784\u4f53\u4e3a\u7a7a",2:"\u5370\u7ae0\u72b6\u6001\u65e0\u6548",3:"\u89e3\u6790\u5f02\u5e38",4:"\u5370\u7ae0\u5df2\u5220\u9664",5:"\u5370\u7ae0\u672a\u5236\u4f5c",6:"\u5370\u7ae0\u5df2\u51bb\u7ed3"},KGfontColor:{"\u9ed1":"black","\u7ea2":"red","\u84dd":"blue","\u7eff":"green"}});
 I.msg=function(a,b){return I.errCode[a]||(b?I.errCode[b][a]:I.errCode[a])||a};I.options={_version:"1.0",timeout:2E4};I.Utils=v;I.Listener=D;var T=function(a,b){H.trigger("ajaxRequest",arguments);return I.ajax?function(c){(new S(a,b)).getJSON(function(a){c(null,a)})}:function(c){M(a,b,!1).getJSON(function(a){c(null,a)})}},N=function(a,b,c,d){H.trigger("beforeProg",arguments);var e={value:'{"GetInterface":{"progid":"'+b+'","interface":"'+c+'"},"usercode":"'+d+'"}'};return function(b){M(a+"/GetInterface",
 e,!1).getJSON(function(a){H.trigger("resonseProg",a);"none"==a.type?b(null,K):"0"===a.value?b(null,G):b(null,a)})}},O=function(a,b,c,e){H.trigger("beforeMethod",arguments);var f=Array.prototype.slice.call(arguments).slice(4);0==f.length?f='{"MethodCall":{"caller":"'+b+'","function":"'+e+'"},"usercode":"'+c+'"}':(f='"params":'+d(f),f='{"MethodCall":{"caller":"'+b+'","function":"'+e+'",'+f+'},"usercode":"'+c+'"}');var g={value:f};return function(b){M(a+"/MethodCall",g,!1).getJSON(function(a){H.trigger("responseMethod",
 a);"none"!=a.type&&b(null,a.value?a.value:a)})}},V=function(a,b,c){H.trigger("beforeAttr",arguments);var e=Array.prototype.slice.call(arguments).slice(3);0==e.length?e='{"PropertyCall":{"caller":"'+b+'","property":"'+c+'"}}':(e='"params":'+d(e),e='{"MethodCall":{"caller":"'+b+'","property":"'+c+'",'+e+"}}");var f={value:e};return function(b){M(a,f,!0).getJSON(function(a){H.trigger("responseMethod",a);"none"!=a.type&&b(null,a.value)})}},S=function(a,b){this.url=a;this.data=b;H.trigger("beforeAjaxJ",
 a,b)};S.prototype.getJSON=function(a){var b=this;$.ajax({url:this.url,contentType:"text/plain;charset=utf-8",type:"POST",data:E(this.data,"\r\n"),success:function(c){w.call(b,a,c)},error:function(c,d,e){w.call(b,a,z)}})};Thenjs.onerror=function(a){if(v.is("String",a))alert("[error]"+a);else throw a;};var U=function(a){this.serverUrl=a;this.thenjs=Thenjs(function(a){a(null)})};A=U.prototype;A.init=function(a,b,c){this.progid=a;this.interid=b;this.clientCode=c;return this};A.fail=function(a){var b=
 this;b.thenjs=b.thenjs.fail(function(c,d){var e=a.call(b,c,d);c(b.respData(void 0==e?d:e))});return b};A.fin=function(a){var b=this;b.thenjs=b.thenjs.fin(function(c,d,e){a.call(b,c,d,e)});return b};A.then=function(a){var b=this;b.thenjs=b.thenjs.then(function(c,d){a.call(b,function(a,d){b.respData(d);c(a,d)},d)});return b};A.series=function(a){this.thenjs=this.thenjs.series(a);return this};A.calArgs=function(a){for(var b=this._data,c=[],d=0;d<a.length;d++){var e=a[d];v.is("Function",e)&&(e=e.call(this,
 b));v.is("Array",e)?c=c.concat(e):c.push(e)}return c};A.msg=function(a,b,c,d){b=b||this._method;c=c||this.progid;d=I.errCode.then;H.trigger("msgArg",a,b,c);return I.errCode[a]||d[a+"@"+b+"."+c]||d[a+"@"+b]||d[a]||a};A.ret=function(a){var b=this;this.then(function(c,d){var e=a.call(b,d);c(null,b.respData(void 0==e?d:e))});return this};A.respData=function(a){a&&(this._data=a);return this._data};A.attr=function(a){var b=this,c=t(arguments);b.series([function(a){var d=b.calArgs(c);b._method=d[0];V.apply(null,
 [b.serverUrl,b.proid].concat(d))(a)}]).then(function(a,c){a(null,b.respData(c[0]))});return this};A.attrSeries=function(){var a=this,b=[];a.initProid();for(var c=0;c<arguments.length;c++)b.push(function(){var b=a.calArgs(arguments);return function(c){a._method=b[0];V.apply(null,[a.serverUrl,a.proid].concat(b))(c)}}.apply(null,arguments[c]));a.series(b).then(function(b,c){a.respData(c);b(null,c)});return this};A.initProid=function(){var a=this;this.series([N(a.serverUrl,a.progid,a.interid,a.clientCode)]).then(function(b,
 c){c=c[0];H.trigger("initProid",c);c.value?(a.proid=c.value,b(null,c)):b(c.errcode)});return this};A.invokeSeries=function(){var a=this,b=[];a.initProid();for(var c=0;c<arguments.length;c++)b.push(function(){var b=a.calArgs(arguments);return function(c){a._method=b[0];O.apply(null,[a.serverUrl,a.proid,a.clientCode].concat(b))(c)}}.apply(null,arguments[c]));a.series(b).then(function(b,c){a.respData(c);b(null,c)});return this};A.invoke=function(a){var b=this;b.initProid();var c=t(arguments);b.series([function(a){var d=
 b.calArgs(c);b._method=d[0];O.apply(null,[b.serverUrl,b.proid,b.clientCode].concat(d))(a)}]).then(function(a,c){b.respData(c[0]);a(null,c[0])});return this};A.request=function(a,b){var c=this;c.series([T(c.serverUrl+a,b)]).then(function(a,b){b=b[0];c.respData(b);a(null,b)});return this};var H=new D("kgthen");I.addRequestListener=function(a,b){H.on(a,b)};I.surry=function(a,b,c,d){return(new U(a||"http://127.0.0.1:9581")).init(b,c,d)};I.KgThen=U;return I};
 function KGInstance(){null==instance&&(instance=new KG);return instance}root.kinggrid=KGInstance();var Utils=kinggrid.Utils,config=kinggrid.options,isIE8=!1;root.JSON&&(isIE8='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));var dialog=root.KG_Dialog;
 dialog&&dialog.create&&(dialog.create.prototype.button=function(a){a=a||[];var b=this,c="",d=0;this.callbacks={};"string"===typeof a?(c=a,d++):$.each(a,function(a,f){var e=f.id=f.id||f.value;"cancel"==e&&(f.value="\u53d6\u6d88");a="";b.callbacks[e]=f.callback;!1===f.display?a=' style="display:none"':d++;c+='<button type="button" i-id="'+e+'"'+("cancel"==e?' class="kg-default-btn-red" ':"")+a+(f.disabled?" disabled":"")+(f.autofocus?isIE8?' class="ui-dialog-autofocus kg-primary-btn-red"':' autofocus class="ui-dialog-autofocus kg-primary-btn-red"':
 "")+">"+f.value+"</button>";b._$("button").on("click","[i-id="+e+"]",function(a){$(this).attr("disabled")||b._trigger(e);a.preventDefault()})});this._$("button").html(c);this._$("footer")[d?"show":"hide"]();return this});
 var dialogConfig={okValue:"\u786e\u5b9a",cancelValue:"\u5173\u95ed",modal:!0,fixed:!0,backdropOpacity:.2,skin:"kg-ui-dialog"},toBase64Img=function(a){var b=a.imgdata;0==b.indexOf(a.signsn)&&(b=a.imgdata.substring(65));return Utils.Base64.of().encodeByte(Utils.Base64.of(a.signsn).decodeByte(b))},dialogList={},createDialog;createDialog=function(a,b){b.id=a;return"undefined"!=typeof root.iframeDialog&&root.iframeDialog?root.top.KG_Dialog(b):root.KG_Dialog(b)};
 var kingDialog=function(a,b){var c=this;if(!(c instanceof kingDialog))return new kingDialog(a,b);var d=Utils.extend({},plus.dialogConfig,b),e=d.onOk;e&&(delete d.onOk,d.ok=function(){return e.call(c)});var f=d.onCancel;f&&(delete d.onCancel,d.cancel=function(){return f.call(c)});c.init(a,d);c.options=b;c.id=a},dialogProto=kingDialog.prototype;dialogProto.init=function(a,b){this[0]=createDialog(a,b);return this};dialogProto.on=function(a,b){this[0]["on"+a]=b};
 dialogProto.show=function(a){this.options.iconClose&&this[0]._$("close").hide();this.options.onShow&&this.options.onShow.call(this);this[0].show();return this};dialogProto.remove=function(){this[0].remove();delete this[0]};dialogProto.close=function(){this[0].close();return this};dialogProto.content=function(a){this[0].content(a);this[0].reset();return this};dialogProto.find=function(a){return this[0]._popup.find(a)};
 Thenjs.onerror=function(a){plus.hideLoading();if(Utils.is("String",a))"client"==Signature.options.sealType&&Signature.options.isResponseErr&&"connectionErr"==a?console.warn(kinggrid.msg(a,"then")):Signature.options.errorCall?Signature.options.errorCall.call(null,{result:!1,errcode:a}):plus.alert(kinggrid.msg(a,"then"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()});else throw a;
 };var Switcher=function(a,b){var c=this;c.target=$(a);b&&$.each(b,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b});c.init()};
 Utils.extend(Switcher.prototype,{running:!1,index:0,animate:!0,init:function(){var a=this.target,b=this.wrapper=a.find(".kg-wrapper"),c=this.guide=a.find(".kg-guide");a=b.children(".kg-slide");var d=parseInt(a.css("height")),e=a.outerWidth(!0);b.css({height:d,width:a.length*e});this.count=a.length;b=parseFloat(this.index,10)||0;d=b+1;a.each(function(a){this.setAttribute("index",a);c.append('<span index="'+a+'"></span>')});this.guide.html(d+"/"+this.count);this._active(b)},_active:function(a){var b=
 this.index;this.wrapper.children().eq(b).removeClass("active");this.guide.children().eq(b).removeClass("active");this.wrapper.children().eq(a).addClass("active");this.guide.children().eq(a).addClass("active");this.index=a;this.guide.html(a+1+"/"+this.count)},to:function(a){var b=this;if(!b.running){var c=a%this.count;c!=b.index&&(b.running=!0,a=b.wrapper.children().eq(c),a=-c*a.outerWidth(!0),this.animate?this.wrapper.animate({left:a},100,function(){b._active(c);b.running=!1}):(this.wrapper.css({left:a}),
 b._active(c),b.running=!1))}},swipePrev:function(){var a=this.index-1;0>a&&(a=this.wrapper.children().length-1);this.to(a)},swipeNext:function(){var a=this.index+1,b=this.wrapper.children().length;a+1>b&&(a=0);this.to(a)}});Utils.Switcher=Switcher;var Tab=function(a){this.target=a;var b=this.nav=this.target.find(".kg-nav");this.content=this.target.find(".kg-tab-content");a=this.items=b.children();b=b.children(".active");0==b.length&&(b=a.eq(0));this._getClassName();this.active(b);this.init()};
 Tab.prototype={active:function(a){this.activeLi&&(this.activeContent.removeClass("active"),this.activeLi.removeClass("active"));a.addClass("active");var b=a.children("a").attr("kg-target");this.target.find(".kg-nav li a").each(function(){$(this).removeClass(this.className)});a.children("a").addClass(this.className);b=this.target.find("."+b);b.addClass("active");this.activeLi=a;this.activeContent=b},init:function(){var a=this;this.target.find(".kg-nav li").click(function(b){b.preventDefault();b=$(this);
 b.hasClass("active")||a.active(b)});a._location()},_location:function(){var a=this.items.length,b=document.body.clientWidth,c=Signature.options.isMobile&&375>b?b:430;this.items.each(function(b,e){b=$(e).width();b=(c-b*a)/2;$(e).offset({left:b})})},_getClassName:function(){var a=this;this.target.find(".kg-nav li a").each(function(){a.className=$(this).attr("class")})}};Utils.tab=function(a){return new Tab(a)};
 var plus={dialogConfig:dialogConfig,alertConfig:{},loadingConfig:{}},internationalization=Utils.internationalization=function(){try{$("[i-id=cancel]").html($.kgi18n.prop("Close"));$("[data-kgi18n-html]").each(function(a){$(this).html($.kgi18n.prop($(this).data("kgi18n-html")));$(this).addClass("kg-fontFamily")});$("[data-kgi18n-value]").each(function(a){$(this).val($.kgi18n.prop($(this).data("kgi18n-value")));$(this).addClass("kg-fontFamily")});$("[data-kgi18n-title]").each(function(a){$(this).attr("title",
 $.kgi18n.prop($(this).data("kgi18n-title")));$(this).addClass("kg-fontFamily")});$(".kg-default-btn-red").each(function(){$(this).addClass("kg-fontFamily")});$(".kg-primary-btn-red").each(function(){$(this).addClass("kg-fontFamily")});$(".kg-default-btn-blue").each(function(){$(this).addClass("kg-fontFamily")});$(".kg-primary-btn-blue").each(function(){$(this).addClass("kg-fontFamily")});$(".kg-tab-content").find(".kg-label").each(function(a){$(this).removeClass().addClass("kg-label").addClass(Signature.options.Global+
 "-label")});$(".kg-tab-content").find(".kg-value").each(function(a){$(this).removeClass().addClass("kg-value").addClass(Signature.options.Global+"-value")});var a=$("[data-kgi18n-html=SignatureDate]").next().html();if(a)for(var b=a.indexOf("("),c=a.substring(b),d="(\u65f6\u95f4\u6765\u6e90\u4e8e\u65f6\u95f4\u6233\u670d\u52a1\u5668);(\u6642\u9593\u4f86\u6e90\u65bc\u6642\u9593\u6233\u670d\u52d9\u5668);(The time comes from the timestamp server);(\u65f6\u95f4\u6765\u6e90\u4e8e\u7b7e\u7ae0\u670d\u52a1\u5668);(\u6642\u9593\u4f86\u6e90\u65bc\u7c3d\u7ae0\u670d\u52d9\u5668);(Time comes from signature server);(\u65f6\u95f4\u6765\u6e90\u4e8e\u672c\u5730);(\u6642\u9593\u4f86\u6e90\u65bc\u672c\u5730);(Time comes from local)".split(";"),
 e=0;e<d.length;e++)c==d[e]&&(a=3>e?a.substring(0,b)+$.kgi18n.prop("KG_MSGtimestamp_time"):3<=e&&6>e?a.substring(0,b)+$.kgi18n.prop("KG_MSGserver_time"):a.substring(0,b)+$.kgi18n.prop("KG_MSGlocal_time"),$("[data-kgi18n-html=SignatureDate]").next().html(a))}catch(f){}},showCacheDialog=function(a,b,c){var d=dialogList[a];if(!d){var e=c.okCall;e&&delete c.okCall;c=Utils.extend({onOk:function(){var a=!0;e&&(a=0==e.call(this)?!1:!0);a&&this.close().remove();return!1},cancel:!1},c);d=dialogList[a]=plus.showDialog(a,
 c)}d.on("remove",function(){delete dialogList[a]});d.content(b);internationalization();return d};plus.alert=function(a,b,c){b=Utils.extend({title:$.kgi18n.prop("OtherInfoTip"),onShow:function(){Signature.editThemeColor();return c},okCall:b},plus.alertConfig);return showCacheDialog("alert",'<div class="kg-dialog kg-alert" ><i class="kg-icon kg-icon-attention-circled"></i>'+a+"</div>",b)};
 plus.showLoading=function(a){a=Utils.extend({onOk:!1},plus.loadingConfig);return showCacheDialog("loading",'<div class="kg-loading"><img title="\u52a0\u8f7d\u4e2d..." src="data:image/gif;base64,R0lGODlhIAAgALMAAP///7Ozs/v7+9bW1uHh4fLy8rq6uoGBgTQ0NAEBARsbG8TExJeXl/39/VRUVAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQAAACwAAAAAIAAgAAAE5xDISSlLrOrNp0pKNRCdFhxVolJLEJQUoSgOpSYT4RowNSsvyW1icA16k8MMMRkCBjskBTFDAZyuAEkqCfxIQ2hgQRFvAQEEIjNxVDW6XNE4YagRjuBCwe60smQUDnd4Rz1ZAQZnFAGDd0hihh12CEE9kjAEVlycXIg7BAsMB6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YEvpJivxNaGmLHT0VnOgGYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHQjYKhKP1oZmADdEAAAh+QQFBQAAACwAAAAAGAAXAAAEchDISasKNeuJFKoHs4mUYlJIkmjIV54Soypsa0wmLSnqoTEtBw52mG0AjhYpBxioEqRNy8V0qFzNw+GGwlJki4lBqx1IBgjMkRIghwjrzcDti2/Gh7D9qN774wQGAYOEfwCChIV/gYmDho+QkZKTR3p7EQAh+QQFBQAAACwBAAAAHQAOAAAEchDISWdANesNHHJZwE2DUSEo5SjKKB2HOKGYFLD1CB/DnEoIlkti2PlyuKGEATMBaAACSyGbEDYD4zN1YIEmh0SCQQgYehNmTNNaKsQJXmBuuEYPi9ECAU/UFnNzeUp9VBQEBoFOLmFxWHNoQw6RWEocEQAh+QQFBQAAACwHAAAAGQARAAAEaRDICdZZNOvNDsvfBhBDdpwZgohBgE3nQaki0AYEjEqOGmqDlkEnAzBUjhrA0CoBYhLVSkm4SaAAWkahCFAWTU0A4RxzFWJnzXFWJJWb9pTihRu5dvghl+/7NQmBggo/fYKHCX8AiAmEEQAh+QQFBQAAACwOAAAAEgAYAAAEZXCwAaq9ODAMDOUAI17McYDhWA3mCYpb1RooXBktmsbt944BU6zCQCBQiwPB4jAihiCK86irTB20qvWp7Xq/FYV4TNWNz4oqWoEIgL0HX/eQSLi69boCikTkE2VVDAp5d1p0CW4RACH5BAUFAAAALA4AAAASAB4AAASAkBgCqr3YBIMXvkEIMsxXhcFFpiZqBaTXisBClibgAnd+ijYGq2I4HAamwXBgNHJ8BEbzgPNNjz7LwpnFDLvgLGJMdnw/5DRCrHaE3xbKm6FQwOt1xDnpwCvcJgcJMgEIeCYOCQlrF4YmBIoJVV2CCXZvCooHbwGRcAiKcmFUJhEAIfkEBQUAAAAsDwABABEAHwAABHsQyAkGoRivELInnOFlBjeM1BCiFBdcbMUtKQdTN0CUJru5NJQrYMh5VIFTTKJcOj2HqJQRhEqvqGuU+uw6AwgEwxkOO55lxIihoDjKY8pBoThPxmpAYi+hKzoeewkTdHkZghMIdCOIhIuHfBMOjxiNLR4KCW1ODAlxSxEAIfkEBQUAAAAsCAAOABgAEgAABGwQyEkrCDgbYvvMoOF5ILaNaIoGKroch9hacD3MFMHUBzMHiBtgwJMBFolDB4GoGGBCACKRcAAUWAmzOWJQExysQsJgWj0KqvKalTiYPhp1LBFTtp10Is6mT5gdVFx1bRN8FTsVCAqDOB9+KhEAIfkEBQUAAAAsAgASAB0ADgAABHgQyEmrBePS4bQdQZBdR5IcHmWEgUFQgWKaKbWwwSIhc4LonsXhBSCsQoOSScGQDJiWwOHQnAxWBIYJNXEoFCiEWDI9jCzESey7GwMM5doEwW4jJoypQQ743u1WcTV0CgFzbhJ5XClfHYd/EwZnHoYVDgiOfHKQNREAIfkEBQUAAAAsAAAPABkAEQAABGeQqUQruDjrW3vaYCZ5X2ie6EkcKaooTAsi7ytnTq046BBsNcTvItz4AotMwKZBIC6H6CVAJaCcT0CUBTgaTg5nTCu9GKiDEMPJg5YBBOpwlnVzLwtqyKnZagZWahoMB2M3GgsHSRsRACH5BAUFAAAALAEACAARABgAAARcMKR0gL34npkUyyCAcAmyhBijkGi2UW02VHFt33iu7yiDIDaD4/erEYGDlu/nuBAOJ9Dvc2EcDgFAYIuaXS3bbOh6MIC5IAP5Eh5fk2exC4tpgwZyiyFgvhEMBBEAIfkEBQUAAAAsAAACAA4AHQAABHMQyAnYoViSlFDGXBJ808Ep5KRwV8qEg+pRCOeoioKMwJK0Ekcu54h9AoghKgXIMZgAApQZcCCu2Ax2O6NUud2pmJcyHA4L0uDM/ljYDCnGfGakJQE5YH0wUBYBAUYfBIFkHwaBgxkDgX5lgXpHAXcpBIsRADs="></div>',a)};
 plus.hideLoading=function(){var a=dialogList.loading;a&&a.close().remove()};plus.hideDialog=function(a){(a=root.KG_Dialog.list[a])&&a.close().remove()};plus.showDialog=function(a,b){a=kingDialog(a,b);a.show();internationalization();return a};
 var template=plus.template={sealTpl_noInput:'<div class="kg-dialog kg-dialog-runSignature" id="sealTpl-dialog"><% if(this.thirdConfig != null){%><div class="kg-postil" id="kg-postil" ><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="TextPostil">\u6587\u5b57\u6279\u6ce8</label></div><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><div class="kg-sm kg-sm-3" data-kgi18n-html="CommonLanguage">\u5e38\u7528\u8bed\uff1a</div><div class="kg-sm kg-sm-5"><select id="i-kg-common-lang" style="width:90px;" ><option value=""></option><% for(var i = 0;this.thirdConfig != null && this.thirdConfig.commonlang != null && i<this.thirdConfig.commonlang.length;i++){ %><option value=""><% this.thirdConfig.commonlang[i]%></option><% }%></select></div><div class="kg-sm kg-sm-2"><a href="#" title="\u5b57\u4f53" class="kg-fontSet kg-fontSet-font" id="kg-fontSet"><i class="kg-font-text"></i></a><a href="#" title="\u7f16\u8f91" class="kg-fontSet kg-fontSet-edit" id="kg-fontSet"><i class="kg-font-edit"></i></a></div></div></div><div class="kg-common-lang"><div class="kg-form"><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><textarea id="kg-postil-value" class="kg-sm kg-sm-10 kg-postil-value" maxlength="140"></textarea></div></div></div></div><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="SignaturePicture">\u7b7e\u7ae0\u56fe\u7247</label></div></div><% } %><div class=" kg-switcher" id="kg-switcher" ><a class="arrow-left arrow" href="#"><i class="kg-icon kg-icon-angle-left kg-primary-arrow-red"><</i></a><a class="arrow-right arrow" href="#"><i class="kg-icon kg-icon-angle-right kg-primary-arrow-red">></i></a><div class="kg-pagin"><d\tiv class="kg-guide"></div>\t</div><div class="kg-container"><div class="kg-wrapper"><% var seals = this.seals; %><% for(var i=0;i<seals.length;i++) {%><div class="kg-slide" title="<%seals[i].signname%>"><div class="kg-image"><div class="title"><%seals[i].signname%></div><a class="kg-img" href="#" ><img src="data:image/<%seals[i].imgext.substring(1)%>;base64,<%arguments[arguments.length-1](seals[i])%>"></a></div><div class="kg-shade" style="z-index:100;"><img width="100%" height="100%"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="></div></div><%}%></div></div></div><div class="kg-form"><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-addDate"><div class="kg-sm kg-sm-8"><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%> id="<%this.isMobile%>" class="<%this.isMobile?"":"kg-primary-check-red"%>" checked="checked">&nbsp;<label for="kg-addDate" data-kgi18n-html="AddData">\u9644\u52a0\u65f6\u95f4</label>&nbsp;&nbsp;&nbsp;&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%> id="<%this.isMobile%>" class="<%this.isMobile?" ":"kg-primary-check-red"%>" >&nbsp;<label for="kg-addDate" data-kgi18n-html="AddData">\u9644\u52a0\u65f6\u95f4</label>&nbsp;&nbsp;&nbsp;&nbsp;<%}%><input type="button"  name="dateSet" id="kg-dateSet" class="kg-second-btn-red" data-kgi18n-value="Setting" value="\u8bbe\u7f6e"/><% if(this.showProtectedBtn){%>&nbsp;<input type="button"  name="proDataSet" class="kg-second-btn-red" id="kg-protectedDataSet" data-kgi18n-value="Protection" value="\u4fdd\u62a4\u9879"/><%}%></div></div></div></div></div>',sealTpl:'<div class="kg-dialog kg-dialog-runSignature" id="sealTpl-dialog"><%if(this.thirdConfig != null){%><div class="kg-postil" id="kg-postil"><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="TextPostil">\u6587\u5b57\u6279\u6ce8</label></div><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><div class="kg-sm kg-sm-3" data-kgi18n-html="CommonLanguage">\u5e38\u7528\u8bed\uff1a</div><div class="kg-sm kg-sm-5"><select id="i-kg-common-lang" style="width:90px;" ><option value=""></option><% for(var i = 0;this.thirdConfig != null && this.thirdConfig.commonlang != null && i<this.thirdConfig.commonlang.length;i++){ %><option value=""><% this.thirdConfig.commonlang[i]%></option><% }%></select></div><div class="kg-sm kg-sm-2"><a href="#" title="\u5b57\u4f53" class="kg-fontSet kg-fontSet-font" id="kg-fontSet"><i class="kg-font-text"></i></a><a href="#" title="\u7f16\u8f91" class="kg-fontSet kg-fontSet-edit" id="kg-fontSet"><i class="kg-font-edit"></i></a></div></div></div><div class="kg-common-lang"><div class="kg-form"><div class="form-item clearfix"><div class="kg-sm kg-sm-1"></div><textarea id="kg-postil-value" class="kg-sm kg-sm-10 kg-postil-value" maxlength="140"></textarea></div></div></div></div><div class="kg-form"><div class="form-item clearfix i-postil"><div class="kg-sm kg-sm-1"></div><label class="kg-sm kg-sm-8 kg-postil-label" data-kgi18n-html="SignaturePicture">\u7b7e\u7ae0\u56fe\u7247</label></div></div><%} %><div class=" kg-switcher" id="kg-switcher" ><a class="arrow-left arrow" href="#"><i class="kg-icon kg-icon-angle-left kg-primary-arrow-red"><</i></a><a class="arrow-right arrow" href="#"><i class="kg-icon kg-icon-angle-right kg-primary-arrow-red">></i></a><div class="kg-pagin"><d\tiv class="kg-guide"></div></div><div class="kg-container" ><div class="kg-wrapper"><% var seals = this.seals; %><% for(var i=0;i<seals.length;i++) {%><div class="kg-slide" title="<%seals[i].signname%>"><div class="kg-image"><div class="title"><%seals[i].signname%></div><a class="kg-img" href="#" ><img src="data:image/<%seals[i].imgext.substring(1)%>;base64,<%arguments[arguments.length-1](seals[i])%>"></a></div><div class="kg-shade" style="z-index:100;"><img width="100%" height="100%"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="></div></div><%}%></div></div></div><div class="kg-form"><% if(this.verification){%><div class="form-item clearfix i-password"><div class="kg-sm kg-sm-2"></div><div class="kg-sm kg-sm-8"><div style="position:relative"><input name="" style="text-indent:10px" id="kg-verification" class="form-control"/><span class="kg-verificationButton <%this.Global%>-verificationButton kg-second-btn-red" title="\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801" data-kgi18n-html="VerifyCode">\u9a8c\u8bc1\u7801</span><span class="kg-tip <%this.Global%>-tip"></span><span class="kg-tipText"></span><span class="kg-verificationMark"/></div></div><div class="kg-sm kg-sm-2"></div></div><%}else{%><% if(!this.noPassWord){%><div class="form-item clearfix i-password"><div class="kg-sm kg-sm-2"></div><label class="<%this.Global%>-sm <%this.Global%>-password-l kg-label" data-kgi18n-html="PassWord">\u5bc6\u7801</label><div class="<%this.Global%>-sm <%this.Global%>-password-r"><input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div><div class="kg-sm kg-sm-2"></div></div><%}%><%}%><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-password kg-pwd"><div class="<%this.Global%>-sm <%this.Global%>-remenberPwd"><% if(this.verification){%><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate"   class="<%this.isMobile?"":"kg-primary-check-red"%>" checked="checked">&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">\u9644\u52a0\u65f6\u95f4</label>&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%>" >&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">\u9644\u52a0\u65f6\u95f4</label>&nbsp;<%}%><input type="button"  name="dateSet" id="kg-dateSet" class="kg-second-btn-red" data-kgi18n-value="Setting" value="\u8bbe\u7f6e"/><%}else{%><% if(this.showRememberPwd){%><input type="checkbox" name="remenberPwd" class="<%this.isMobile?"":"kg-primary-check-red"%>" id="kg-remenberPwd">&nbsp;<label style="display:inline;"  for="kg-remenberPwd" data-kgi18n-html="RememberMe">\u8bb0\u4f4f\u5bc6\u7801</label><%}%><%}%><% if(this.showProtectedBtn){%>&nbsp;<input type="button"  name="proDataSet" id="kg-protectedDataSet" class="kg-second-btn-red" data-kgi18n-value="Protection" value="\u4fdd\u62a4\u9879"/><%}%></div></div></div><div class="kg-sm kg-sm-2"></div><% if(this.verification){%><%}else{%><div class="form-item clearfix i-addDate"><div class="<%this.Global%>-sm <%this.Global%>-addDate"><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate"   class="<%this.isMobile?"":"kg-primary-check-red"%>" checked="checked">&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">\u9644\u52a0\u65f6\u95f4</label>&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate" class="<%this.isMobile?"":"kg-primary-check-red"%>" >&nbsp;<label style="display:inline;" for="kg-addDate" data-kgi18n-html="AddData">\u9644\u52a0\u65f6\u95f4</label>&nbsp;<%}%><input type="button"  name="dateSet" id="kg-dateSet" class="kg-second-btn-red" data-kgi18n-value="Setting" value="\u8bbe\u7f6e"/></div></div><%}%></div></div></div>',
 inputTpl:'<div id="kg-verifyPass" class="kg-dialog kg-dialog-password"><div class="kg-form"><div class="form-item clearfix i-password"><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="PassWord">\u5bc6\u7801</label><div class="kg-sm kg-sm-8"><input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div></div><div class="kg-sm kg-sm-3"></div><div class="kg-sm kg-sm-8"><input type="checkbox" name="remenberPwd" class="<%this.isMobile?"":"kg-primary-check-red"%>" id="kg-remenberPwd" >&nbsp;<label for="kg-remenberPwd" data-kgi18n-html="RememberMe">\u8bb0\u4f4f\u5bc6\u7801</label></div></div></div></div>',
 prompt:'<div id="kg-verifyPass" class="kg-dialog kg-dialog-prompt"><div class="kg-promtInfo"></div></div>'},font=plus.fontTemplate={fontFormat:"yyyy-M-d;yyyy.M.d;yyyy/M/d;yyyy\u5e74M\u6708d\u65e5;yy/M/d;yy.M.d;yyyy-MM-dd;yyyy/MM/dd;yyyy.MM.dd;yyyy\u5e74M\u6708d\u65e5*;yyyy\u5e74M\u6708d\u65e5**;MM/dd;MM.dd;M/d;M.d;d-MMM-yyyy;d-MMM-yy;yyyy-M-d hh:mm:ss".split(";"),fontFamily:"@Arial Unicode MS;@Fixedsys;@Malgun Gothic;@Malgun Gothic Semilight;@Meiryo;@Meiryo UI;@Microsoft JhengHei;@Microsoft JhengHei Light;@Microsoft JhengHei UI;@Microsoft JhengHei UI Light;@Microsoft YaHei UI;@Microsoft YaHei UI Light;@MingLiU_HKSCS-ExtB;@MingLiU-ExtB;@MS Gothic;@MS PGothic;@MS UI Gothic;@PMingLiU-ExtB;@SimSun-ExtB;@System;@Terminal;@Yu Gothic;@Yu Gothic Light;@Yu Gothic Medium;@Yu Gothic UI;@Yu Gothic UI Light;@Yu Gothic UI Semibold;@Yu Gothic UI Semilight;@\u7b49\u7ebf;@\u7b49\u7ebf Light;@\u65b9\u6b63\u5170\u4ead\u8d85\u7ec6\u9ed1\u7b80\u4f53;@\u65b9\u6b63\u8212\u4f53;@\u65b9\u6b63\u59da\u4f53;@\u4eff\u5b8b;@\u9ed1\u4f53;@\u534e\u6587\u5f69\u4e91;@\u534e\u6587\u4eff\u5b8b;@\u534e\u6587\u884c\u6977;@\u534e\u6587\u7425\u73c0;@\u534e\u6587\u6977\u4f53;@\u534e\u6587\u96b6\u4e66;@\u534e\u6587\u5b8b\u4f53;@\u534e\u6587\u7ec6\u9ed1;@\u534e\u6587\u65b0\u9b4f;@\u534e\u6587\u4e2d\u5b8b;@\u6977\u4f53;@\u96b6\u4e66;@\u5b8b\u4f53;@\u5fae\u8f6f\u96c5\u9ed1;@\u5fae\u8f6f\u96c5\u9ed1 Light;@\u65b0\u5b8b\u4f53;@\u5e7c\u5706;ADMUI3Lg;ADMUI3Sm;Agency FB;Algerian;Arial;Arial Black;Arial Narrow;Arial Rounded MT Bold;Arial Unicode MS;Axure Handwriting;Baskerville Old Face;Bauhaus 93;Bell MT;Berlin Sans FB;Berlin Sans FB Demi;Bernard MT Condensed;Blackadder ITC;Bodoni MT;Bodoni MT Black;Bodoni MT Condensed;Bodoni MT Poster Compressed;Book Antiqua;Bookman Old Style;Bookshelf Symbol 7;Bradley Hand ITC;Britannic Bold;Broadway;Brush Script MT;Calibri;Calibri Light;Californian FB;Calisto MT;Cambria;Cambria Math;Candara;Castellar;Centaur;Century;Century Gothic;Century Schoolbook;Chiller;Colonna MT;Comic Sans MS;Consolas;Constantia;Cooper Black;Copperplate Gothic Bold;Copperplate Gothic Light;Corbel;Courier;Courier New;Curlz MT;Default;Ebrima;Edwardian Script ITC;Elephant;Engravers MT;Eras Bold ITC;Eras Demi ITC;Eras Light ITC;Eras Medium ITC;Euro Sign;Felix Titling;Fixedsys;Footlight MT Light;Forte;Franklin Gothic Book;Franklin Gothic Demi;Franklin Gothic Demi Cond;Franklin Gothic Heavy;Franklin Gothic Medium;Franklin Gothic Medium Cond;Freestyle Script;French Script MT;Gabriola;Gadugi;Garamond;Georgia;Gigi;Gill Sans MT;Gill Sans MT Condensed;Gill Sans MT Ext Condensed Bold;Gill Sans Ultra Bold;Gill Sans Ultra Bold Condensed;Gloucester MT Extra Condensed;Goudy Old Style;Goudy Stout;Haettenschweiler;Harlow Solid Italic;Harrington;High Tower Text;Impact;Imprint MT Shadow;Informal Roman;Javanese Text;Jokerman;Juice ITC;Kristen ITC;Kunstler Script;Leelawadee UI;Leelawadee UI Semilight;Lucida Bright;Lucida Calligraphy;Lucida Console;Lucida Fax;Lucida Handwriting;Lucida Sans;Lucida Sans Typewriter;Lucida Sans Unicode;Magneto;Maiandra GD;Malgun Gothic;Malgun Gothic Semilight;Marlett;Matura MT Script Capitals;Meiryo;Meiryo UI;Microsoft Himalaya;Microsoft JhengHei;Microsoft JhengHei Light;Microsoft JhengHei UI;Microsoft JhengHei UI Light;Microsoft New Tai Lue;Microsoft PhagsPa;Microsoft Sans Serif;Microsoft Tai Le;Microsoft YaHei UI;Microsoft YaHei UI Light;Microsoft Yi Baiti;MingLiU_HKSCS-ExtB;MingLiU-ExtB;Mistral;Modern;Modern No. 20;Mongolian Baiti;Monotype Corsiva;MS Gothic;MS Outlook;MS PGothic;MS Reference Sans Serif;MS Reference Specialty;MS Sans Serif;MS Serif;MS UI Gothic;MT Extra;MV Boli;Myanmar Text;Niagara Engraved;Niagara Solid;Nirmala UI;Nirmala UI Semilight;OCR A Extended;Old English Text MT;Onyx;Palace Script MT;Palatino Linotype;Papyrus;Parchment;Perpetua;Perpetua Titling MT;Playbill;PMingLiU-ExtB;Poor Richard;Pristina;Rage Italic;Ravie;Rockwell;Rockwell Condensed;Rockwell Extra Bold;Roman;Script;Script MT Bold;Segoe MDL2 Assets;Segoe Print;Segoe Script;Segoe UI;Segoe UI Black;Segoe UI Emoji;Segoe UI Historic;Segoe UI Light;Segoe UI Semibold;Segoe UI Semilight;Segoe UI Symbol;Showcard Gothic;SimSun-ExtB;Sitka Banner;Sitka Display;Sitka Heading;Sitka Small;Sitka Subheading;Sitka Text;Small Fonts;Snap ITC;Stencil;Sylfaen;Symbol;System;Tahoma;TeamViewer11;Tempus Sans ITC;Terminal;Times New Roman;Trebuchet MS;Tw Cen MT;Tw Cen MT Condensed;Tw Cen MT Condensed Extra Bold;Verdana;Viner Hand ITC;Vivaldi;Vladimir Script;Webdings;Wide Latin;Wingdings;Wingdings 2;Wingdings 3;Yu Gothic;Yu Gothic Light;Yu Gothic Medium;Yu Gothic UI;Yu Gothic UI Light;Yu Gothic UI Semibold;Yu Gothic UI Semilight;ZWAdobeF;\u7b49\u7ebf;\u7b49\u7ebf Light;\u65b9\u6b63\u5170\u4ead\u8d85\u7ec6\u9ed1\u7b80\u4f53;\u65b9\u6b63\u8212\u4f53;\u65b9\u6b63\u59da\u4f53;\u4eff\u5b8b;\u9ed1\u4f53;\u534e\u6587\u5f69\u4e91;\u534e\u6587\u4eff\u5b8b;\u534e\u6587\u884c\u6977;\u534e\u6587\u7425\u73c0;\u534e\u6587\u6977\u4f53;\u534e\u6587\u96b6\u4e66;\u534e\u6587\u5b8b\u4f53;\u534e\u6587\u7ec6\u9ed1;\u534e\u6587\u65b0\u9b4f;\u534e\u6587\u4e2d\u5b8b;\u6977\u4f53;\u96b6\u4e66;\u5b8b\u4f53;\u5fae\u8f6f\u96c5\u9ed1;\u5fae\u8f6f\u96c5\u9ed1 Light;\u65b0\u5b8b\u4f53;\u5e7c\u5706".split(";"),
 fontSize:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72],fontColor:"#000000 #800000 #008000 #808000 #000080 #800080 #008080 #808080 #C0C0C0 #FFFFFF #FF0000 #00FF00 #FFFF00 #0000FF #FF00FF #00FFFF".split(" "),fontPosition:[["center","middle","inside","",""],["center","bottom","inside","",""],["right","middle","inside","",""],["right","bottom","inside","",""],["right","top","outside","left",""],["center","top","outside","","below"],["left","middle","outside","right",""],["right","top","outside","",
 "below"],["left","bottom","outside","right",""],["left","top","outside","right","below"]],position:"\u5c45\u4e2d \u5c45\u4e2d\u4e0b(\u7ae0\u5185) \u5c45\u53f3\u4e2d(\u7ae0\u5185) \u5c45\u53f3\u4e0b(\u7ae0\u5185) \u5c45\u5de6\u4e0a(\u7ae0\u5916) \u5c45\u4e2d\u4e0b(\u7ae0\u5916) \u5c45\u53f3\u4e2d(\u7ae0\u5916) \u5c45\u53f3\u4e0b(\u7ae0\u4e0b) \u5c45\u53f3\u4e0b(\u7ae0\u53f3) \u5c45\u53f3\u4e0b(\u7ae0\u53f3\u4e0b)".split(" ")},fontFamily=plus.fontFamily=[{ename:"sans-serif",zname:"sans-serif"},{ename:"SimSun",
 zname:"\u5b8b\u4f53"},{ename:"SimHei",zname:"\u9ed1\u4f53"},{ename:"Microsoft Yahei",zname:"\u5fae\u8f6f\u96c5\u9ed1"},{ename:"Microsoft JhengHei",zname:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{ename:"KaiTi",zname:"\u6977\u4f53"},{ename:"NSimSun",zname:"\u65b0\u5b8b\u4f53"},{ename:"FangSong",zname:"\u4eff\u5b8b"},{ename:"PingFang SC",zname:"\u82f9\u65b9"}],dafaultDate=plus.dafaultDate="2017/01/01 12:00:00",defaultFont=plus.defaultFont={fontFormat:plus.fontTemplate.fontFormat[0],fontFamily:"\u5b8b\u4f53",
 fontSize:12,fontColor:"#000000",position:plus.fontTemplate.position[0]};
 plus.kgFont=function(a){var b={};b.fontFormat=a.fontFormat?a.fontFormat:plus.defaultFont.fontFormat;b.fontFamily=a.fontFamily?a.fontFamily:plus.defaultFont.fontFamily;b.fontSize=a.fontSize?a.fontSize:plus.defaultFont.fontSize;b.fontColor=a.fontColor?a.fontColor:plus.defaultFont.fontColor;null!=a.position?(a=jQuery.inArray(a.position,plus.fontTemplate.position),b.fontPosition=plus.fontTemplate.fontPosition[a]):a.fontPositionIndex?b.fontPosition=plus.fontTemplate.fontPosition[a.fontPositionIndex]:(a=
 jQuery.inArray(plus.defaultFont.position,plus.fontTemplate.position),b.fontPosition=plus.fontTemplate.fontPosition[a]);return b};var formatArgs=function(a){var b=[a],c=Utils.slice(arguments,1),d;if(0<c.length){var e=c[0];1<c.length&&(d=c.slice(1))}b.push(e);return b.concat(d)};plus.showTplDialog=function(a,b,c){var d=Utils.slice(arguments,2),e=Utils.extend({content:function(){return Utils.template.apply(null,[template[a]].concat(d))}},b);return plus.showDialog(a,e)};
 plus.showTemplateDialog=function(a){var b=formatArgs.apply(null,Utils.slice(arguments));return plus.showTplDialog.apply(plus,b)};plus.create=function(a){Utils.extend(this,plus);this.king=a};var noop=function(){plus.hideLoading();return!0};proto=plus.create.prototype;var kingPlus=function(a){return 0==arguments.length?plus:new plus.create(a)};kingPlus.changeSkin=function(a){Utils.extend(kingDialog.prototype,a)};root.kingPlus=kingPlus;jQuery.kgi18n={};jQuery.kgi18n.map={};
 var debug=function(a){window.console&&console.log("i18n::"+a)};Function.prototype.method=function(a,b){this.prototype[a]=b;return this};String.prototype.trim||(String.method("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.method("ltrim",function(){return this.replace(/^\s+/g,"")}),String.method("rtrim",function(){return this.replace(/\s+$/g,"")}));
 jQuery.kgi18n.properties=function(a){a=jQuery.extend({name:"Messages",language:"",path:"",namespace:null,mode:"vars",cache:!1,debug:!1,encoding:"UTF-8",async:!1,callback:null},a);a.namespace&&"string"==typeof a.namespace&&(a.namespace.match(/^[a-z]*$/)?jQuery.kgi18n.map[a.namespace]={}:(debug("Namespaces can only be lower case letters, a - z"),a.namespace=null));a.path.match(/\/$/)||(a.path+="/");a.language=this.normaliseLanguageCode(a);var b=a.name&&a.name.constructor===Array?a.name:[a.name];a.totalFiles=
 2*b.length+(5<=a.language.length?b.length:0);a.debug&&debug("totalFiles: "+a.totalFiles);a.filesLoaded=0;b.forEach(function(b){a.language.substring(0,2);if(5<=a.language.length){var c=a.language.substring(0,5);c=a.path+b+"_"+c+".properties"}loadAndParseFiles([c],a)});a.callback&&!a.async&&a.callback()};
 jQuery.kgi18n.prop=function(a){var b=[].slice.call(arguments);if(2==b.length)if($.isArray(b[1]))var c=b[1];else if("object"===typeof b[1]){var d=b[1].namespace;var e=b[1].replacements;b.splice(-1,1);e&&Array.prototype.push.apply(b,e)}e=d?jQuery.kgi18n.map[d][a]:jQuery.kgi18n.map[a];if(null===e)return"["+(d?d+"#"+a:a)+"]";var f;if("string"==typeof e){for(f=0;-1!=(f=e.indexOf("\\",f));)e="t"==e.charAt(f+1)?e.substring(0,f)+"\t"+e.substring(f++ +2):"r"==e.charAt(f+1)?e.substring(0,f)+"\r"+e.substring(f++ +
 2):"n"==e.charAt(f+1)?e.substring(0,f)+"\n"+e.substring(f++ +2):"f"==e.charAt(f+1)?e.substring(0,f)+"\f"+e.substring(f++ +2):"\\"==e.charAt(f+1)?e.substring(0,f)+"\\"+e.substring(f++ +2):e.substring(0,f)+e.substring(f+1);var g=[],h;for(f=0;f<e.length;)if("'"==e.charAt(f))if(f==e.length-1)e=e.substring(0,f);else if("'"==e.charAt(f+1))e=e.substring(0,f)+e.substring(++f);else{for(h=f+2;-1!=(h=e.indexOf("'",h));)if(h==e.length-1||"'"!=e.charAt(h+1)){e=e.substring(0,f)+e.substring(f+1,h)+e.substring(h+
 1);f=h-1;break}else e=e.substring(0,h)+e.substring(++h);-1==h&&(e=e.substring(0,f)+e.substring(f+1))}else if("{"==e.charAt(f))if(h=e.indexOf("}",f+1),-1==h)f++;else{var m=parseInt(e.substring(f+1,h));!isNaN(m)&&0<=m?(f=e.substring(0,f),""!==f&&g.push(f),g.push(m),f=0,e=e.substring(h+1)):f=h+1}else f++;""!==e&&g.push(e);e=g;d?jQuery.kgi18n.map[settings.namespace][a]=g:jQuery.kgi18n.map[a]=g}if(!e||0===e.length)return"";if(1==e.length&&"string"==typeof e[0])return e[0];d="";f=0;for(h=e.length;f<h;f++)d=
 "string"==typeof e[f]?d+e[f]:c&&e[f]<c.length?d+c[e[f]]:!c&&e[f]+1<b.length?d+b[e[f]+1]:d+("{"+e[f]+"}");return d};function callbackIfComplete(a){a.debug&&(debug("callbackIfComplete()"),debug("totalFiles: "+a.totalFiles),debug("filesLoaded: "+a.filesLoaded));a.async&&a.filesLoaded===a.totalFiles&&a.callback&&a.callback()}
 function loadAndParseFiles(a,b){b.debug&&debug("loadAndParseFiles");null!==a&&0<a.length?loadAndParseFile(a[0],b,function(){a.shift();loadAndParseFiles(a,b)}):callbackIfComplete(b)}var xhr;if(window.XMLHttpRequest)xhr=new XMLHttpRequest;else if(window.ActiveXObject)for(var activexName=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<activexName.length;i++)try{xhr=new ActiveXObject(activexName[i]);break}catch(a){}
 function loadAndParseFile(a,b,c){b.debug&&(debug("loadAndParseFile('"+a+"')"),debug("totalFiles: "+b.totalFiles),debug("filesLoaded: "+b.filesLoaded));null!==a&&"undefined"!==typeof a&&(xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&(b.debug&&(debug("Succeeded in downloading "+a+"."),debug(xhr.responseText)),parseData(xhr.responseText,b),c())},xhr.open("GET",a,b.cache),xhr.onerror=function(){b.debug&&debug("Failed to download or parse "+a+". errorThrown: ");404===jqXHR.status&&
 --b.totalFiles;c()},xhr.send())}
 function parseData(a,b){var c="";a=a.split(/\n/);for(var d=/(\{\d+})/g,e=/\{(\d+)}/g,f=/(\\u.{4})/ig,g=0,h=a.length;g<h;g++){var m=a[g];m=m.trim();if(0<m.length&&"#"!=m.match("^#")){var p=m.split("=");if(0<p.length){m=decodeURI(p[0]).trim();for(var l=1==p.length?"":p[1];-1!=l.search(/\\$/);)l=l.substring(0,l.length-1),l+=a[++g].trimRight();for(var r=2;r<p.length;r++)l+="="+p[r];l=l.trim();if("map"==b.mode||"both"==b.mode)(p=l.match(f))&&p.forEach(function(a){l=l.replace(a,unescapeUnicode(a))}),b.namespace?
 jQuery.kgi18n.map[b.namespace][m]=l:jQuery.kgi18n.map[m]=l;if("vars"==b.mode||"both"==b.mode)if(l=l.replace(/"/g,'\\"'),checkKeyNamespace(m),d.test(l)){var q=!0,t="",x=[];l.split(d).forEach(function(a){!d.test(a)||0!==x.length&&-1!=x.indexOf(a)||(q||(t+=","),t+=a.replace(e,"v$1"),x.push(a),q=!1)});c+=m+"=function("+t+"){";m='"'+l.replace(e,'"+v$1+"')+'"';c+="return "+m+";};"}else c+=m+'="'+l+'";'}}}eval(c);b.filesLoaded+=1}
 function checkKeyNamespace(a){if(/\./.test(a)){var b="";a=a.split(/\./);for(var c=0,d=a.length;c<d;c++){var e=a[c];0<c&&(b+=".");b+=e;eval("typeof "+b+' == "undefined"')&&eval(b+"={};")}}}
 jQuery.kgi18n.normaliseLanguageCode=function(a){var b=a.language;if(!b||2>b.length)a.debug&&debug("No language supplied. Pulling it from the browser ..."),b=navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage||"en",a.debug&&debug("Language from browser: "+b);b=b.toLowerCase();b=b.replace(/-/,"_");3<b.length&&(b=b.substring(0,3)+b.substring(3).toUpperCase());return b};
 function unescapeUnicode(a){var b=[];a=parseInt(a.substr(2),16);0<=a&&a<Math.pow(2,16)&&b.push(a);return b.reduce(function(a,b){return a+String.fromCharCode(b)},"")}
 var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;b&&c.mixIn(b);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},
 clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);this.sigBytes+=a;return this},clamp:function(){var b=
 this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8;b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,
 c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},m=g.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-d%4*8;return new f.init(c,b)}},p=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(m.stringify(a)))}catch(t){throw Error("Malformed UTF-8 data");
 }},parse:function(a){return m.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=p.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=e/(4*g);h=b?a.ceil(h):a.max((h|0)-this._minBufferSize,0);b=h*g;e=a.min(4*b,e);if(b){for(var l=0;l<b;l+=g)this._doProcessBlock(d,l);l=d.splice(0,b);c.sigBytes-=
 e}return new f.init(l,e)},clone:function(){var a=e.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=l.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){l.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,
 c){return(new r.HMAC.init(a,c)).finalize(b)}}});var r=c.algo={};return c}(Math);
 (function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher,e=[];b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],f=c[1],g=c[2],r=c[3],q=c[4],t=0;80>t;t++){if(16>t)e[t]=a[b+t]|0;else{var x=e[t-3]^e[t-8]^e[t-14]^e[t-16];e[t]=x<<1|x>>>31}x=(d<<5|d>>>27)+q+e[t];x=20>t?x+((f&g|~f&r)+1518500249):40>t?x+((f^g^r)+1859775393):60>t?x+((f&g|f&r|g&r)-1894007588):x+((f^g^
 r)-899497514);q=r;r=g;g=f<<30|f>>>2;f=d;d=x}c[0]=c[0]+d|0;c[1]=c[1]+f|0;c[2]=c[2]+g|0;c[3]=c[3]+r|0;c[4]=c[4]+q|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296);b[(d+64>>>9<<4)+15]=c;a.sigBytes=4*b.length;this._process();return this._hash},clone:function(){var a=d.clone.call(this);a._hash=this._hash.clone();return a}});a.SHA1=d._createHelper(b);a.HmacSHA1=d._createHmacHelper(b)})(this);
 var $=window.jQuery;kingPlus=window.kingPlus;isIE8=!1;root.JSON&&(isIE8='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));var canCanvas=!0;try{root.document.createElement("canvas").getContext("2d")}catch(a){canCanvas=!1}function stringify(a){a=JSON.stringify(a);return isIE8?a.replace(/\\u([0-9a-fA-F]{2,4})/g,function(a,c){return String.fromCharCode(parseInt(c,16))}):a}var now=function(){return(new Date).getTime()};function rnd(a){return(9301*a+49297)%233280/233280}
 function rand(){var a=""+Math.ceil(99999*rnd((new Date).getTime())),b=5-a.length;if(0<b)for(var c=0;c<b;c++)a="0"+a;return a}Utils=kinggrid.Utils;
 var $window=$(window),$document=$(document),html=document.documentElement,isIE6=!("minWidth"in html.style),isLosecapture=!isIE6&&"onlosecapture"in html,isSetCapture="setCapture"in html,isTouch,EventTypes,getEvent=function(a){isTouch&&(a=a.originalEvent?a.originalEvent.touches.item(0):a.touches.item(0));return a},Drag=function(a){this.start=$.proxy(this.start,this);this.over=$.proxy(this.over,this);this.end=$.proxy(this.end,this);this.onstart=this.onover=this.onend=$.noop;EventTypes||(isTouch="mousedown"!=
 a.type,EventTypes={start:isTouch?"touchstart":"mousedown",over:isTouch?"touchmove":"mousemove",end:isTouch?"touchend":"mouseup"})};
 Drag.prototype={start:function(a){a=this.startFix(a);globalLisenter.trigger("dragStart",this,a);$document.on(EventTypes.over,this.over).on(EventTypes.end,this.end);this.onstart(a);return!1},over:function(a){a=this.overFix(a);globalLisenter.trigger("dragOver",this,a);this.onover(a);return!1},end:function(a){a=this.endFix(a);globalLisenter.trigger("dragEnd",this,a);$document.off(EventTypes.over,this.over).off(EventTypes.end,this.end);this.onend(a);return!1},startFix:function(a){a=getEvent(a);this.target=
 $(a.target);this.selectstart=function(){return!1};$document.on("selectstart",this.selectstart).on("dblclick",this.end);if(isLosecapture)this.target.on("losecapture",this.end);else $window.on("blur",this.end);isSetCapture&&this.target[0].setCapture();return a},overFix:function(a){return a=getEvent(a)},endFix:function(a){a=getEvent(a);$document.off("selectstart",this.selectstart).off("dblclick",this.end);isLosecapture?this.target.off("losecapture",this.end):$window.off("blur",this.end);isSetCapture&&
 this.target[0].releaseCapture();return a}};
 Drag.create=function(a,b,c,d){var e=$(a),f=new Drag(b),g=EventTypes.start,h=function(){},m=a.className.replace(/^\s|\s.*/g,"")+"-drag-start",p=e[0].style,l,r,q,t,x=$document.scrollLeft(),v=$document.scrollTop(),D=0==d.left?0:d.left+e.width()-x,J=d.right-x,E=d.top-v,G=0==d.bottom?0:d.bottom-e.height()-v,K=0,z=0,y=parseInt(p.left),C=parseInt(p.top),w=y,F=C,A=y,L=C;c&&(w=parseInt(p.marginLeft),F=parseInt(p.marginTop),A=w,L=F);var B={onstart:h,onover:h,onend:h,off:function(){e.off(g,f.start)}},n={scale:function(){var a=
 1,b=e.parents(".kg-translate");null!=b&&(b=b.css("transform"),null!=b&&(b=b.split("(")[1].split(")")[0].split(","),a=b[0],b=b[3],a=Math.max(Math.sqrt(a*a),Math.sqrt(b*b))));return a}};f.onstart=function(b){var c="fixed"===e.css("position"),d=$document.scrollLeft(),f=$document.scrollTop(),g=e.width(),h=e.height();g*=n.scale();h*=n.scale();r=l=0;q=c?$window.width()-g+l:$document.width()-g;t=c?$window.height()-h+r:$document.height()-h;h=e.offset();g=this.startLeft=c?h.left-d:h.left;c=this.startTop=c?
 h.top-f:h.top;this.clientX=b.clientX;this.clientY=b.clientY;h=e.parent();h.is("body")||(K=h[0].getBoundingClientRect().left+d,z=h[0].getBoundingClientRect().top+f);d=b.clientX-e.offset().left+d-e.width();f=b.clientY-e.offset().top+f;0!=D?D+=d:D;0!=J?J+=d:J;0!=E?E+=f:E;0!=G?G+=f:G;e.addClass(m);B.onstart.call(a,b,g,c)};f.onover=function(b){var d=b.clientX,f=b.clientY;0!=D&&b.clientX<=D&&(d=D);0!=J&&b.clientX>=J&&(d=J);0!=E&&b.clientY<=E&&(f=E);0!=G&&b.clientY>=G&&(f=G);d=d-this.clientX+this.startLeft;
 f=f-this.clientY+this.startTop;var g=e[0].style;d=Math.max(l,Math.min(q,d));f=Math.max(r,Math.min(t,f));c?(d=g.marginLeft=(d-K-y)/n.scale()+"px",f=g.marginTop=(f-z-C)/n.scale()+"px"):(d=g.left=(d-K)/n.scale()+"px",f=g.top=(f-z)/n.scale()+"px");A=parseInt(d);L=parseInt(f);B.onover.call(a,b,d,f)};f.onend=function(b){var d=e.position(),f=d.left;d=d.top;e.removeClass(m);var g=e[0].style,h=!0;6>Math.abs(A-w)&&6>Math.abs(L-F)&&(h=!1);c?B.onend.call(a,b,h,g.marginLeft,g.marginTop):B.onend.call(a,b,h,f,d)};
 f.off=function(){e.off(g,f.start)};if(b)f.start(b);else e.on(g,f.start);return B};var Listener=kinggrid.Listener,Service=function(){};$.extend(Service.prototype,Listener.prototype);var SealService=function(){};SealService.className=SealService.name||"SealService";Utils.inherit(SealService,Service);$.extend(SealService.prototype,{loadSeal:function(){throw Error("must impl");},saveLog:function(){},verifyPwd:function(){throw Error("must impl");}});var CertService=function(){};
 CertService.className=CertService.name||"CertService";Utils.inherit(CertService,Service);$.extend(CertService.prototype,{sign:function(){throw Error("must impl");},verifySign:function(){throw Error("must impl");}});var KgObject=function(){};$.extend(KgObject.prototype,{getAttr:function(a){return this[a]},setAttr:function(a){var b=this;$.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})},removeAttr:function(a){delete this[a]}});
 var Signature=function(a,b){var c=this;c.signatureid=a;c.setSignatureData(b);c.on("load",function(){Signature.list[a]=this});c.on("remove",function(a){a=c._getLogInfo(Utils.extend(a||{},{LOGTYPE:"00",LOGSORT:"14",LOGMEMO:"\u64a4\u9500\u7b7e\u7ae0\u6210\u529f"}));c.sealService.saveLog(a);delete Signature.list[c.signatureid]});c.on("update",function(a){"signMeta"===c._item&&(a=c._getLogInfo(Utils.extend(a||{},{LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"\u6570\u5b57\u7b7e\u540d\u6210\u529f"})),c.sealService.saveLog(a))});
 c.on("fireremove",function(){Signature.removeList.push(c.signatureid)});c.on("fireupdate",function(){for(var a=!1,b=0;b<Signature.updateList.length;b++)if(Signature.updateList[b]===c){a=!0;break}a||Signature.updateList.push(c)});for(var d in Signature)Signature.hasOwnProperty(d)&&0==d.indexOf("on")&&(this[d]=Signature[d]);return this},blankImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=",blackImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mNoaGgAAAMEAYF1LgG8AAAAAElFTkSuQmCC",
 createImg=function(a,b,c){if(canCanvas){var d=root.document.createElement("canvas");d.height=c;d.width=b;var e=d.getContext("2d"),f=new Image;f.src=a;f.onload=function(){e.drawImage(f,0,0,b,c)}}else d=root.document.createElement("img"),d.style.width=b+"px",d.style.height=c+"px",d.setAttribute("src",a);return d};Utils.inherit(Signature,KgObject);$.extend(Signature.prototype,Listener.prototype);
 $.extend(Signature.prototype,{hashAlg:"sha1",encryptAlg:"RSA",_init:function(){},_getLogInfo:function(a,b){var c=decodeURIComponent(window.location.href);b=this.signatureData||b;return Utils.extend(a||{},{KEYSN:b.gbOvalue&&""!=b.gbOvalue?b.gbOvalue:b.keysn,SIGNSN:b.seal.signsn,DOCUMENTID:b.documentid,DOCUMENTNAME:b.documentname,APPVERSION:version.name,APPTYPE:"HTML",APPCODE:this.appcode,EXTPARAM2:c})},error:function(a,b,c,d){c=a;Utils.is("Object",a)&&(c=a.errcode&&"511"!=a.errcode?a.errcode:a.errmsg);
 c||(c="-999");b=Utils.is("String",b)?b:"then";plus.hideLoading();Signature.options.errorCall?Signature.options.errorCall.call(null,a,b):plus.alert(kinggrid.msg(c,b),function(){d&&d._beginDlgOkCall&&1==d._beginDlgOkCall||Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})},load:function(a){this.trigger("beforeLoad");this.setAttr(a);this.certService=new Signature.factory.cert[Signature.options.certType](a,
 this.signatureData);var b=this.signatureData;if(void 0!==a.extra&&null!==a.extra&&void 0!==a.extra[this.signatureid]){if(void 0!==a.extra[this.signatureid].scaleImage&&null!==a.extra[this.signatureid].scaleImage&&(b.seal.height*=a.extra[this.signatureid].scaleImage,b.seal.width*=a.extra[this.signatureid].scaleImage),void 0!=a.extra[this.signatureid].position){var c=$.extend({},b.position),d="",e;for(e in c)d=e;this.removeItem(b.position);this.updatePos(a.extra[this.signatureid].position,{marginLeft:null==
 a.extra[this.signatureid].offsetX?c[d].marginLeft:a.extra[this.signatureid].offsetX,marginTop:null==a.extra[this.signatureid].offsetY?c[d].marginTop:a.extra[this.signatureid].offsetY})}}else void 0!==a.scaleImage&&null!==a.scaleImage&&(b.seal.height*=a.scaleImage,b.seal.width*=a.scaleImage);this.sealService=new Signature.factory.seal[Signature.options.sealType](a,b);this._init();this.trigger("load");return this},toBase64Img:function(a){var b=a.imgdata,c=b.indexOf(a.signsn);if(-1==c)return b;b=a.imgdata.substring(c+
 65);return Utils.Base64.of().encodeByte(Utils.Base64.of(a.signsn).decodeByte(b))},clearImg:function(){if(this.imgEles)for(var a in this.imgEles)this.trigger("removeAt",this.imgEles[a][0]),this.imgEles[a].remove();this.imgEles={}},repaint:function(){this.clearImg();this.verify()},getUpdateType:function(){return this._item},updatePos:function(a,b){var c=this.signatureData.position[a];this._item="position";this.signatureData.position[a]=Utils.extend({},c,b)},updateItem:function(a,b){this._item=a;this.signatureData[a]=
 b},removeItem:function(a){for(var b in a)delete a[b]},fireUpdate:function(a){var b=this,c=function(c){a&&a(c);b[c?"update":"restore"]();delete b._item};Signature.asyn.update?Signature.asyn.update.call(b,c):(this.trigger("fireupdate"),c(!0));return this},restore:function(){this.setSignatureData(this.oriSignatureData);this.repaint()},update:function(){this.setSignatureData(this.signatureData);this.repaint();this.trigger("update");return this},remove:function(){this.clearImg();this.trigger("remove");
 for(var a in this)delete this[a];return this},fireRemove:function(a){var b=this,c=function(c){a&&a(c);c&&b.remove()};Signature.asyn.remove?Signature.asyn.remove.call(b,c):(this.trigger("fireremove"),c(!0));return this},hide:function(){if(this.imgEles)for(var a in this.imgEles)this.imgEles[a].hide()},createImg:function(){var a=this.signatureData,b=$(document.createElement("img"));if(0<a.appname.indexOf("H2TH5")){a.seal.imgext=".png";var c=a.seal.imgdata}else c=this.toBase64Img(a.seal);var d=blankImg;
 this.broken||(d="data:image/"+a.seal.imgext+";base64,"+c);b.css({width:Math.ceil(9600*parseFloat(a.seal.width)/254),height:Math.ceil(9600*parseFloat(a.seal.height)/254)}).attr({src:d});return b},show:function(){var a=this.signatureData.position,b=this.imgEles=this.imgEles||{},c;for(c in a){var d="kg-img-div-"+this.signatureid+"-"+c,e=b[d];e||(e=b[d]=this.showAt(c,a[c]));this._handleImg(e)}this.trigger("show")},showAt:function(a,b){this.trigger("beforeShowAt",a,b);var c=Utils.$(a),d=this.signatureData.position;
 -1!=this.signatureData.appname.indexOf("H2TH5")&&d.H2TH5&&(-1===d.H2TH5.marginTop.indexOf("px")&&(d.H2TH5.marginTop+="px",d.H2TH5.marginLeft+="px"),null===c&&(d=$("<div style='position:absolute;left:0;top:0;'></div>"),c=$("<div id='H2TH5'></div>"),d.append(c),$("body").append(d)));d=$(c);this.extra&&this.extra[this.signatureid]&&(c=this.extra[this.signatureid].scopePosition)&&(d=c instanceof Object?c.find("#"+a):$(Utils.$(c)).find("#"+a));if(0==d.length)if(Signature.options.defaultPos)a=Signature.options.defaultPos,
 d=$(Utils.$(a));else throw Error("no find position:"+a+" signatureid="+this.signatureid);var e=this.createImg();e.addClass("kg-img").attr("id","kg-img-"+this.signatureid);c=$(document.createElement("div")).addClass("kg-img-div").addClass("kg-img-div-"+a).attr({id:"kg-img-div-"+this.signatureid+"-"+a,elemid:a,signatureid:this.signatureid});var f=$(document.createElement("div")).css({position:"absolute"});f.append(e);c.append(f);c.css({width:e.width(),height:e.height()});var g=0,h=0,m=0,p=this.signatureData.dateTime,
 l=this.signatureData.postilFontSet;if(null!=p&&p.isCheck&&p.fontDate){var r=this.addDateToImg(p.fontDate,this.signatureData.timestamp.time,c,f);null!=this.imageAndDate&&this.imageAndDate&&"outside"==p.fontDate.fontPosition[2]&&("right"==p.fontDate.fontPosition[3]?g+=r.dateWidth:"left"==p.fontDate.fontPosition[3]&&(g+=r.dateWidth,m=r.dateWidth,f.css({right:0})),"below"==p.fontDate.fontPosition[4]&&(h+=r.dateHeight))}p=e.width()+g;if(null!=l&&null!=l.fontValue&&""!=l.fontValue.trim()){var q=this.calWidth(l.fontValue,
 l);p+=q;r=this.calHeight(l.fontSize);h+=r;f.css({left:q+m});this.addPostilFontToImg(l,c)}e=e.height()+h;null!=this.thirdConfig&&null!=this.thirdConfig.imgWh?(c.css({width:parseInt(this.thirdConfig.imgWh.width)>p?this.thirdConfig.imgWh.width:p,height:parseInt(this.thirdConfig.imgWh.height)>e?this.thirdConfig.imgWh.height:e}),f.css({left:Signature.isIE?"auto":"unset",right:g})):c.css({width:p,height:e});f=c;g="kg-default";if(h=d.attr("display"))d.addClass("display-"+h),g="kg-"+h,e=d,f=document.getElementById("kg-img-container-"+
 a),f||(f=document.createElement("div"),f.setAttribute("id","kg-img-container-"+a)),f=$(f).addClass(g+"-container"),f.append(c),c.attr("kg-display",!0);else if(e=d.offsetParent(),"html"==e[0].tagName.toLowerCase()||"relative"==e[0].style.position)e=$("body");c.addClass(g);e.append(f);h?"landscape"===h&&(d=f.children(),g=f.parent().width(),q=0,d.each(function(){q+=parseInt($(this).width())+1}),f.width(q>g?q:g)):this.calSealPos(d,c,f,b);this.trigger("showAt",c[0],a,b);return c},calSealPos:function(a,
 b,c,d){var e=a.offsetParent();c=c||b;if("html"==e[0].tagName.toLowerCase()||"relative"==e[0].style.position)e=$("body");a=a.offset();var f=e.offset();e.is("body")&&(f={top:0,left:0});c.css({top:a.top-f.top,left:a.left-f.left});d?(e=d.marginLeft,d=d.marginTop):(e=b.css("marginLeft"),d=b.css("marginTop"));b.css({marginLeft:e||0,marginTop:d||0})},addPostilFontToImg:function(a,b){var c=$(document.createElement("div"));c.addClass("kg-font-positl-div");var d=$(document.createElement("span"));d.css({color:a.fontColor,
 "font-family":a.fontFamily,"font-size":a.fontSize+"px"}).addClass("kg-font-positl-span");d.html(a.fontValue);c.append(d);b.prepend(c);return c},calWidth:function(a,b){var c=document.createElement("canvas").getContext("2d");c.font=b.fontSize+"px arial,"+b.fontFamily;return c.measureText(a).width+6},calHeight:function(a){return 1.5*parseInt(a)},getLength:function(a){return a.replace(/[\u0391-\uFFE5]/g,"aa").length},addDateToImg:function(a,b,c,d){b=kinggrid.Utils.formatDate(new Date(b),a.fontFormat);
 var e=$(document.createElement("div")).addClass("kg-date"),f=0,g=0;if(!a.fontPosition)for(var h=plus.fontTemplate.position.length,m=0;m<h;m++)if(plus.fontTemplate.position[m]==this.signdate.position){a.fontPosition=plus.fontTemplate.fontPosition[m];break}"outside"==a.fontPosition[2]&&("right"==a.fontPosition[3]?f+=c.width():"left"==a.fontPosition[3]&&(f-=c.width()),"below"==a.fontPosition[4]&&(g+=c.height()));e.css({width:c.width(),height:c.height(),top:g,left:f});f=$(document.createElement("div")).addClass("kg-date-tmb").css({width:c.width()});
 g=$(document.createElement("div")).addClass("kg-date-lcr").css({"text-align":a.fontPosition[0],"font-family":a.fontFamily,"font-size":a.fontSize+"px",color:a.fontColor});"bottom"==a.fontPosition[1]?f.css({bottom:0}):"middle"==a.fontPosition[1]&&g.css({"line-height":c.height()+"px"});g.html(b);f.html(g);e.html(f);d.append(e);c=this.calWidth(b,a);a=this.calHeight(a.fontSize);return{dateWidth:c,dateHeight:a}},canSign:function(){return!this.modified&&!Signature.options.readonly&&Signature.options.signable&&
 !this.signatureData.signMeta},canMove:function(a){(a=!Signature.options.readonly&&this.signatureData.moveable&&Signature.options.moveable&&!$(a).attr("kg-display"))&&Signature.options.moveable_self&&(a=this.signatureData.keysn==Signature.options.keysn);return a},canDelete:function(){return!Signature.options.readonly},_handleImg:function(a){a.show();if(0==a.children(".kg-shade").length){var b=$(document.createElement("div")).addClass("kg-shade");b.append(createImg(blankImg,a.width(),a.height()));a.append(b)}this._invalid(a);
 this.trigger("handleImg",a[0])},setSignatureData:function(a){Utils.is("String",a)?this.signatureData=JSON.parse(Utils.Base64.of().decode(a)):this.signatureData=a;this.oriSignatureData=JSON.parse(JSON.stringify(this.signatureData))},getSignatureid:function(){return this.signatureid},getSignatureData:function(){var a=JSON.stringify(this.signatureData);return Utils.Base64.of().encode(a)},getBase64Image:function(a,b,c,d){c="kg-img-div-"+a+"-"+c;c=document.getElementById(c);null!=c&&(isIE8?d(this,"",a,
 b):html2canvas(c).then(function(c){c=c.toDataURL("image/png").split(",");d(this,c,a,b)}))},_invalid:function(a){var b=a.children(".kg-invalid");if(0==b.length){b=$(document.createElement("div")).addClass("kg-hide").addClass("kg-invalid");a.append(b);var c=a.height()/3;b.css({top:c,height:c});c/=3;for(var d=a.width(),e=0;3>e;e++){var f=$(document.createElement("div")).height(c);0==e%2&&(f.addClass("kg-invalid-item"),f.append(createImg(blackImg,d,c)));b.append(f)}}if(this.modified){c="";for(d=0;d<this.modifiedItems.length;d++)e=
 this.modifiedItems[d],c+=e.desc+"["+e.field+"]\u7531{"+e.orivalue+"}\u66f4\u6539\u4e3a{"+e.newvalue+"};";a.attr("modified",c).addClass("error");b.removeClass("kg-hide")}else a.removeAttr("modified").removeClass("error"),b.addClass("kg-hide")},_verify:function(a,b){this.trigger("before_verify");a=this.verifyProtectedData(a);if(!b||b&&b.batchVerify||null==this.oriSignatureData.timestamp.timestampInfo)return this.show(),this.trigger("_verify"),!a;var c=this;this.getVerifyTimeStamp(this.oriSignatureData.timestamp.timestampInfo,
 function(a){c.timeVerify=a;c.show();c.trigger("_verify");b&&b.sucCall&&b.sucCall.call(c)})},verify:function(a,b){this.trigger("beforeVerify");a=this._verify(a,b);this.trigger("verify");return a},getVerifyProtectedItems:function(a,b){for(var c in a)if(void 0!=a[c]&&null!=a[c]){var d=a[c];if(d.field==b)return d}return null},getVerifyProtectedData:function(){for(var a=this.validatedData,b=this.signatureData.protectedData,c={},d=0;d<b.length;d++)if(void 0!=b[d]&&null!=b[d]){var e=b[d],f=e.field,g=a&&
 (a[f]||this.getVerifyProtectedItems(a,f)&&this.getVerifyProtectedItems(a,f).value);if(null==g){var h=Utils.$(f);if(h){if(g=h.getAttribute("kg-value")||h.value,void 0===g||null===g)g=h.innerHTML||h.innerText}else g=void 0!=e.name&&null!=e.name?document.getElementById(e.name).value:""}e=Utils.val(g,this);e=this._formatValue(e);c[f]=e}return c},getSignTimeStamp:function(a){for(var b={},c=0;c<a.length;c++)b[a[c].field]=a[c].value;return Utils.Base64.of().encode(stringify(b))},getValidatedTimeStamp:function(){var a=
 this.getVerifyProtectedData();a=stringify(a);return Utils.Base64.of().encode(a)},getVerifyTimeStamp:function(a,b){var c=this.getValidatedTimeStamp(),d=a.CertData;if("client"==Signature.options.sealType){var e=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);e.invoke("SetParamByName","TSCERTDATA",Utils.Base64.of().encode(d)).ret(function(){e.invoke("KGVerifyTSWithReq",a.TimeStampResponse,a.TimeStampResult,"",
 c,a.TimeStr,"").ret(function(a){b.call(this,a.result)})})}else $.ajax({url:Signature.options.serverUrl+"_key_verifyTimeStamp",type:"POST",data:{verifyed:c,cert:d,tsResp:a.TimeStampResponse},async:!1,success:function(a){b.call(this,a.result)},error:function(a){b.call(this,a)}})},getH5SignData:function(){var a=this.hashAlg,b=this.encryptAlg,c=CryptoJS.SHA1(this.getSignData()).toString();return[{hashAlg:a,encryptAlg:b,signdata:c}]},verifyProtectedData:function(a){a&&(this.validatedData=a);a={};$.extend(!0,
 a,this.signatureData.protectedData);Signature.verifyData&&(this.validatedData=Signature.verifyData(a));a=[];for(var b=this.getVerifyProtectedData(),c=this.signatureData.protectedData,d=0;d<c.length;d++)if(void 0!=c[d]&&null!=c[d]){var e=c[d],f=b[c[d].field];f!==e.value&&a.push({field:e.field,desc:e.desc,orivalue:e.value,newvalue:f})}this.modified=0<a.length;this.modifiedItems=a;return this.modified},verifySignData:function(a){var b=this;plus.showLoading();var c=this.certService;if(this.signatureData.signMeta.html2sign){c instanceof
 ServerCert||(c=new ServerCert(Signature.options),c.sData=b.signatureData);var d=b.getVerifyProtectedData();for(var e=this.signatureData.protectedData,f=[],g=0;g<e.length;g++){var h=e[g],m={},p;for(p in h)h.hasOwnProperty(p)&&(m[p]=h[p]);m.value=d[h.field];f.push(m)}d=stringify(f)}else d=this.getValidatedSignData();c.verifySign($.extend({seal:this.signatureData.seal,signeddata:this.signatureData.signMeta.signeddata,crtdata:this.signatureData.signMeta.certinfo.crtdata,keysn:this.signatureData.keysn,
 signsn:this.signatureData.seal.signsn,signdata:d},{successCall:function(c){plus.hideLoading();if(!c.errcode){b.signModified=!c.result;var d=b.verify(null,{sucCall:function(){a&&a(c)}})}null==d&&c.result||a&&a(c)}}))},_renderValue:function(a){return a.replace(/\r\n/ig,"<br>")},_formatValue:function(a,b){a&&(a=a.replace(/\r\n/ig,"\n"),a=a.replace(/\n/ig,"\r\n"));return a},getItemVal:function(a){var b;if(b=Utils.is("String",a)?Utils.$(a):a)return a=b.tagName.toLowerCase(),"input"===a||"textarea"===a||
 "select"===a?b.getAttribute("kg-value")||b.value:b.getAttribute("kg-value")||(isIE8?b.innerText:b.textContent);throw Error("No find protectedItem:"+a+" signatureid="+this.signatureid);},getProtectedData:function(a){var b=this,c=[],d=function(a){var c=Utils.$(a);if(c){var d={field:a};d.desc=c.getAttribute("kg-desc")||a;d.value=b.getItemVal(c);return d}throw Error("No find protectedItem:"+a+" signatureid="+this.signatureid);},e=function(a){if(Utils.is("String",a))a=d(a);else if(!Utils.is("Object",a)||
 !a.field)throw Error("Unsupported protectedItems:"+a.toString);Utils.is("Function",a.value)&&(a.value=a.value.call(b,a.field,a.desc));a.value=b._formatValue(a.value);return a};if(a)if(Utils.is("Array",a))for(var f=0,g=a.length;f<g;f++)c.push(e(a[f]));else c.push(e(a));return c},__findSignedData:function(a){if(Utils.is("String",a))return a.split(";")[0];if(Utils.is("Array",a))return a[0];throw Error("error signeddata: "+a);},getValidatedSignData:function(){var a=this.getVerifyProtectedData();a=stringify(a);
 a=Utils.Base64.of().encode(a);return CryptoJS.SHA1(a).toString()},getSignData:function(a){a=(a||this.signatureData).protectedData;for(var b={},c=0;c<a.length;c++)b[a[c].field]=a[c].value;return Utils.Base64.of().encode(stringify(b))},showSignSignatureDialog:function(a){var b=this,c=Signature.options.verification,d={target:Utils.is("Array",a.target)?a.target:[a.target],title:kinggrid.msg("SignSignature","KG_TITLE"),onCancel:function(){Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()},
 onShow:function(){var d=this;Signature.editThemeColor();if(c){var f=b.signatureData.keysn,g="",h=d.find(".kg-tipText");b.sealService.getTelphone({keysn:f,successCall:function(c){c.result?(h.html(c.phone),g=c.phone):b.errorCallback(c.massage,a.errorCall)}});h=d.find(".kg-tipText");h.html(g);h.click(function(){h.hide();d.find("#kg-revokeVerifyCode").focus()});d.find("#kg-revokeVerifyCode").click(function(){h.hide();d.find("#kg-revokeVerifyCode").focus()});var m=d.find(".kg-revokeMark");d.find(".kg-revokeBtn").click(function(c){plus.showLoading();
 var d=$(this);b.sealService.applySMSCode({keysn:f,successCall:function(c){if(c.result){clearInterval(f);plus.hideLoading();h.css({display:"block"}).html("\u5df2\u53d1\u9001\u9a8c\u8bc1\u7801");m.css({display:"block"});var e=60,f=setInterval(function(){0<=e?(10>e?e="0"+e:e,d.html(e+"\u79d2"),e--):(d.html("\u9a8c\u8bc1\u7801"),m.css({display:"none"}),h.html(g),clearInterval(f))},1E3)}else b.errorCallback(c.message,a.errorCall)}})});d.find("#kg-revokeVerifyCode").keydown(function(a){13==a.keyCode&&d.options.onOk.call(d)})}else setTimeout(function(){d.find("#kg-password").focus()},
 40),d.find("#kg-password").keydown(function(a){13==a.keyCode&&d.options.onOk.call(d)})},onOk:function(){var d=this,f=d.find("#kg-password"),g=d.find("#kg-revokeVerifyCode");if(c){if(!g.val())return plus.alert(kinggrid.msg("in_verification_msg","KG_MSG"),function(){g.focus()}),!1}else if(!f.val())return plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){f.focus()}),!1;b.sealService.checkKeysn.call(b,{keysn:b.signatureData.keysn},function(e){if(e.result)if(c&&g.val())plus.showLoading(),b.sealService.verifyPwd({verify:Signature.options.verification,
 pwd:g.val(),keysn:a.target.keysn,successCall:function(c){plus.hideLoading();if(c.result)return a._onOk.call(d,g.val()),!1;b.error(c,null,null,{_beginDlgOkCall:!0})}});else return a._onOk.call(d,f.val()),!1;else return b.error(e,null,null,{_beginDlgOkCall:!0}),!1})}};return b.showDialog("signSignatureBtl",d)},changeMoveAble:function(a,b){this.signatureData.moveable=a;this.fireUpdate();b&&b()},signSignature:function(a){var b=this,c={target:b,_onOk:function(c){var d=this,f=b.getH5SignData();b.runSign(f,
 c,function(c){c.result?b.fireUpdate(function(a){a&&d.remove()}):b.error(c,null,null,{_beginDlgOkCall:!0});a&&a(c)})}};if(b.signatureData.phoneshield)"client"==Signature.options.sealType&&b.sealService.getPhoneShieldLic({phoneshield:Signature.options.phoneshield},function(a){"1"==a.phoneshield||"3"==a.phoneshield?(kinggrid.options.timeout=1E3*(a.validatetime+10),c._onOk("")):"2"==a.phoneshield?b.error({errcode:"11110"},"then"):b.error({errcode:"11109"},"then")});else return b.showSignSignatureDialog(c)},
 showRevokeSignatureDialog:function(a){var b=this,c=Signature.options.verification,d={target:Utils.is("Array",a.target)?a.target:[a.target],title:kinggrid.msg("RevokeSignature","KG_TITLE"),quickClose:void 0==Signature.options.quickClose?!0:Signature.options.quickClose,onCancel:function(){Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()},onShow:function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call();var d=this;Signature.editThemeColor();if(c){var f=
 b.signatureData.keysn,g="",h=d.find(".kg-tipText");b.sealService.getTelphone({keysn:f,successCall:function(c){c.result?(h.html(c.phone),g=c.phone):b.errorCallback(c.massage,a.errorCall)}});h=d.find(".kg-tipText");h.html(g);h.click(function(){h.hide();d.find("#kg-revokeVerifyCode").focus()});d.find("#kg-revokeVerifyCode").click(function(){h.hide();d.find("#kg-revokeVerifyCode").focus()});var m=d.find(".kg-revokeMark");d.find(".kg-revokeBtn").click(function(c){plus.showLoading();var d=$(this);b.sealService.applySMSCode({keysn:f,
 successCall:function(c){if(c.result){clearInterval(f);plus.hideLoading();h.css({display:"block"}).html($.kgi18n.prop("sentSMSCode"));m.css({display:"block"});var e=60,f=setInterval(function(){0<=e?(10>e?e="0"+e:e,d.html(e+"\u79d2"),e--):(d.html("\u9a8c\u8bc1\u7801"),m.css({display:"none"}),h.html(g),clearInterval(f))},1E3)}else b.errorCallback(c.message,a.errorCall)}})});d.find("#kg-revokeVerifyCode").keydown(function(a){13==a.keyCode&&d.options.onOk.call(d)})}else setTimeout(function(){d.find("#kg-password").focus()},
 40),d.find("#kg-password").keydown(function(a){13==a.keyCode&&d.options.onOk.call(d)})},onOk:function(){var b=this.find("#kg-password"),d=this.find("#kg-revokeVerifyCode");if(c){if(!d.val())return plus.alert(kinggrid.msg("in_verification_msg","KG_MSG"),function(){d.focus()}),!1}else if(!b.val())return plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){b.focus()}),!1;a._onOk.call(this,c?d.val():b.val());return!1}};return b.showDialog("signSignatureBtl",d)},revokeSignature:function(a){var b=
 this,c=function(a){void 0!==Signature.options.delCallBack&&Signature.options.delCallBack?Signature.options.delCallBack(b.signatureid,b.signatureData)&&b.fireRemove(function(c){c&&(a.remove?a.remove():b.remove())}):b.fireRemove(function(c){c&&(a.remove?a.remove():b.remove())})};if("scanStamp"!=b.signatureData.stampType||Signature.options.clientConfig)if(d={target:b,_onOk:function(d,e){var f=this,g=b.signatureData.seal.esid;plus.showLoading();g?(plus.hideLoading(),b.sealService.getRemoveAuthority(b.signatureid,
 b.signatureData,function(b){b?(c(f,b),a&&a({result:!0})):f.remove()})):b.sealService.verifyPwd({verify:Signature.options.verification,pwd:d,keysn:b.signatureData.keysn,successCall:function(d){plus.hideLoading();d.result&&(void 0!=d.delkeysn?d.delkeysn==b.signatureData.keysn:1)?c(f):b.error(d,null,null,{_beginDlgOkCall:!0});a&&a(d)},phoneshield:e})}},b.signatureData.phoneshield&&"client"==Signature.options.sealType)b.sealService.getPhoneShieldLic({phoneshield:"1"},function(a){"1"==a.phoneshield||"3"==
 a.phoneshield?(kinggrid.options.timeout=1E3*(a.validatetime+10),d._onOk("","1")):"2"==a.phoneshield?b.error({errcode:"11110"},"then"):b.error({errcode:"11109"},"then")});else if(Signature.options.showNoPW&&"server"==Signature.options.sealType)d._onOk(Signature.options.password);else return b.showRevokeSignatureDialog(d);else{var d={title:kinggrid.msg("RevokeSignature","KG_TITLE"),target:b,onCancel:!1},e=Signature.ScanStamp.call(b,function(){return b.showDialog("scanStampdlg",d)},function(d){d.result?
 c(e.dialog):b.error(d,null,null,{_beginDlgOkCall:!0});a&&a(d)});e.getQrCodeImageByDelete(b.signatureData.esid)}},showDialog:function(a,b){var c=Utils.is("Array",b.target)?b.target:[b.target],d={title:kinggrid.msg("KinggridSignature","KG_TITLE"),onShow:function(){var a=this;Signature.editThemeColor();setTimeout(function(){a.find("#kg-password").focus()},40);a.find("#kg-password").keydown(function(b){13==b.keyCode&&a.options.onOk.call(a)})},onCancel:b.errCall||function(){plus.hideLoading();return!0},
 content:function(){var b=[Signature.options.template[a]].concat(c);return Utils.template.apply(null,b)}};b=Utils.extend(d,b);var e=plus.showDialog(a,b);if("showSealsBtl"===a){var f=e.find("#sealTpl-dialog"),g=!1,h=0,m=0,p=0,l=0;f.prevObject[0].onmousedown=function(a){g=!0;a=a||event;null!=a&&(h=a.clientX,m=a.clientY,p=parseInt(f.prevObject[0].style.top),l=parseInt(f.prevObject[0].style.left))};f.prevObject[0].onmousemove=function(a){if(g&&(a=a||event,null!=a)){var b=l+a.clientX-h;a=p+a.clientY-m;
 0<b&&0<a&&(f.prevObject[0].style.left=b+"px",f.prevObject[0].style.top=a+"px")}};f.prevObject[0].onmouseup=function(a){g&&(g=!1,l=p=m=h=0)}}"signatureInfoBtl"!=a&&"signInfoBtl"!=a||e.find(".ui-dialog-close").click(function(){e.close();Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()});return e},runMove:function(a,b,c){var d=this;globalLisenter.trigger("startMove",d,a,b);var e=function(a){var b=a.moveableRange;if(!b){for(d in a.position){var c=d;break}(a=$("#"+c).attr("kg-mita"))&&
 (b=a)}if(b){var d=$("#"+b);if(0<d.length)return b=d.offset().left,a=d.offset().left+d.outerWidth(),c=d.offset().top,d=d.offset().top+d.outerHeight(),{left:b,right:a,top:c,bottom:d}}return{left:0,right:0,top:0,bottom:0}};return"client"==Signature.options.sealType&&Signature.options.moveable_self&&d.keysn!=d.signatureData.keysn?(Signature.alert(kinggrid.msg("cannot_move","KG_MSG")),!1):function(a,b,c){var f=e(d.signatureData);b=Drag.create(b,a,!0,f);b.onend=function(a,b,e,f){c&&c(b,e,f);globalLisenter.trigger("endMove",
 d,a,e,f);b&&(a=$(this),d.updatePos(a.attr("elemid"),{marginLeft:e,marginTop:f}),d.fireUpdate())};a.preventDefault();return b}(a,b,c)},runSign:function(a,b,c){var d=this,e=d.signatureData;if(Signature.options._clientHW)return Signature.options._clientHW=!1,c({result:!0});plus.showLoading();d.certService.sign({seal:this.signatureData.seal,keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,documentid:this.signatureData.documentid,documentname:this.signatureData.documentname,password:b,
 phoneshield:this.signatureData.phoneshield,signMeta:a,successCall:function(b){plus.hideLoading();b.result&&(b.signeddata?(b.certinfo.algName=b.certinfo.algName.toUpperCase(),d.updateItem("signMeta",{hashAlg:a[0].hashAlg,encryptAlg:a[0].encryptAlg,signdata:a[0].signdata,signeddata:d.__findSignedData(b.signeddata),certinfo:b.certinfo,tsaInfo:b.tsaInfo})):(b.result=!1,b.errcode="signErr"),e.certType=Signature.options.certType);c&&c(b)}})}});plus=kingPlus();
 Signature.options=$.extend({savelogFlg:!0,b64Url:"/iWebSignature_base64",imageUrl:"/iWebSignature_image",languagesPath:"../kinggrid/languages",pw_enc_save:!0,autoCertMode:!0,showSealsDlg:!0,remberPwdAndShowSealsDlg:!0,showRememberPwd:!0,version:"iSignature_HTML5(V2.1)",verification:!1},kinggrid.options,{dialogConfig:{okValue:"\u786e  \u5b9a",cancelValue:"\u53d6  \u6d88",fixed:!0,backdropOpacity:.2,modal:!0},template:{},themeColor:{red:{"primary-background-color":"#C62929","primary-border-color":"#C62929",
 "primary-color":"#ffffff","primary-hover-background-color":"#e45a5a","primary-hover-border-color":"#e45a5a","primary-hover-color":"#ffffff","default-background-color":"#ffffff","default-border-color":"#cccccc","default-color":"#333333","default-hover-background-color":"#ffffff","default-hover-border-color":"#C62929","default-hover-color":"#C62929","second-background-color":"#fff","second-color":"#C62929","second-hover-background-color":"#fff4f4","second-hover-color":"#C62929","primary-select-image":'url("image/select_red.png") no-repeat center white',
 "primary-box-shadow":"0px 2px 6px rgba(198, 41, 41,.2)"},blue:{"primary-background-color":"#1890ff","primary-border-color":"#1890ff","primary-color":"#ffffff","primary-hover-background-color":"#4eaaff","primary-hover-border-color":"#4eaaff","primary-hover-color":"#ffffff","default-background-color":"#ffffff","default-border-color":"#cccccc","default-color":"#333333","default-hover-background-color":"#ffffff","default-hover-border-color":"#1890ff","default-hover-color":"#1890ff","second-background-color":"#fff",
 "second-color":"#1890ff","second-hover-background-color":"#eef7ff","second-hover-color":"#1890ff","primary-select-image":'url("image/select_blue.png") no-repeat center white',"primary-box-shadow":"0px 2px 6px rgba(0, 132, 255,.2)"}}},window.KGCONFIG);Signature.addProvider=function(a,b,c){Signature.factory[a][b]=c};var aisleKing;
 Signature.init=function(a,b){this.Seals={};Utils.extend(Signature.options,a);var c=Signature.options;b=b?b:a.okCall;c.serverUrl&&(c.b64Url="_signature_b64",c.imageUrl="_signature_image",0<c.serverUrl.indexOf("?")?c.serverUrl+="&action=rest":c.serverUrl+="?action=rest");"client"==c.sealType?(c.clientUrl=c.https,aisleKing=Signature.aisleKing=kinggrid.surry(c.clientUrl?c.clientUrl:"http://127.0.0.1:9581","IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)):
 aisleKing=Signature.aisleKing=kinggrid.surry(c.serverUrl||c.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);(a=c.clientConfig)&&"client"===c.sealType?(c.LANGUAGE=c.clientConfig.LANGUAGE,Signature.AXI("SetParamByName",a,b)):b&&b.call();b=jQuery.kgi18n.normaliseLanguageCode({});c.isMobile=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent);
 c.LANGUAGE?c.Global=c.LANGUAGE.substring(0,2):(c.LANGUAGE=b,2<jQuery.kgi18n.normaliseLanguageCode({}).length?c.Global=b.substring(0,2):c.Global=b);c.autoCertMode&&(c.icon_sign=!1,c.icon_signverify=!1);this.dynamicLoadCss(c.languagesPath+"/style/language_"+c.Global+".css");this.loadProperties();globalLisenter.trigger("init")};Signature.factory={cert:{},seal:{}};Signature.SealService=SealService;Signature.CertService=CertService;Signature.asyn={};
 Signature._create=function(a){var b=this;b.setAttr(a);b.certService=new Signature.factory.cert[b.certType](a);b.sealService=new Signature.factory.seal[b.sealType](a);b.on("createSignature",function(a,d,e){var c=a.signatureData;a=[];var g="\u76d6\u7ae0\u6210\u529f";c.phone&&null!=c.phone&&""!=c.phone&&(g="\u76d6\u7ae0\u6210\u529f\u3010\u624b\u673a\u77ed\u4fe1\u9a8c\u8bc1"+c.phone+"\u3011");c=b._getLogInfo({LOGTYPE:"00",LOGSORT:"13",LOGMEMO:g,LOGSORTSUBCLASS:"1301"});a.push(Utils.extend(d||{},c));e&&
 a.push(b._getLogInfo({LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"\u6570\u5b57\u7b7e\u540d\u6210\u529f"}));b.sealService.saveLog(a)});return this};var signature=function(){};signature.prototype=Signature.prototype;var prototype=new signature,emptyInput="";Signature.scanCallBack=function(){};Signature._create.prototype=prototype;
 $.extend(prototype,{keyData:null,sealExpired:function(a,b,c,d,e){var f=this,g=!0;if(void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid)return f.certExpired(b,c,d);if(void 0!==a.endata&&null!==a.endata){var h=a.endata;e=parseInt(c.substr(0,4));a=parseInt(c.substr(5,2));g=parseInt(c.substr(8,2));var m=parseInt(h.substr(0,4)),p=parseInt(h.substr(5,2));h=parseInt(h.substr(8,2));e>m?(f.errorCallback({errcode:"11104"},b.errorCall),g=!1):e==m?a>p?(f.errorCallback({errcode:"11104"},
 b.errorCall),g=!1):a==p?g>h?(f.errorCallback({errcode:"11104"},b.errorCall),g=!1):g=!0:g=!0:g=!0}else return a=Signature.options.serverUrl+"_key_sealIsExpired",e=(parseInt(e)+1).toString(),$.ajax({url:a,type:"POST",data:{keysn:f.keyData.keysn,year:(new Date).getFullYear(),month:(new Date).getMonth(),date:(new Date).getDate(),index:e},async:!1,success:function(a){if(a.error)return f.errorCallback({errcode:"11105"},b.errorCall),!1;if(0==a.result)return f.certExpired(b,c,d);f.errorCallback({errcode:"11104"},
 b.errorCall);return!1},error:function(a){f.errorCallback({errcode:"11105"},b.errorCall)}}),!1;return g?f.certExpired(b,c,d):g},certExpired:function(a,b,c){var d=this,e=!1;if(void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid)return!0;kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("KGGetCerInfo","").ret(function(f){var g=parseInt(b.substr(0,4)),h=parseInt(b.substr(5,
 2)),m=parseInt(b.substr(8,2));if(f.result){f=f.certinfo.notAfter;var p=parseInt(f.substr(0,4)),l=parseInt(f.substr(4,1));l=0==l?parseInt(f.substr(5,1)):parseInt(f.substr(4,2));var r=parseInt(f.substr(6,1));r=0==r?parseInt(f.substr(7,1)):parseInt(f.substr(6,2));g>p?d.errorCallback({errcode:"11103"},a.errorCall):g==p?h>l?d.errorCallback({errcode:"11103"},a.errorCall):h==l?m>r?d.errorCallback({errcode:"11103"},a.errorCall):e=!0:e=!0:e=!0}else d.errorCallback({errcode:"11106"},a.errorCall);void 0!==c&&
 null!==c&&c(e)});return e},errorCallback:function(a,b,c,d){b?(plus.hideLoading(),b.call(null,a,c)):this.error(a,c,null,d)},runHW:function(a,b){var c=this;plus.showLoading();if("undefined"!=typeof a.imageData&&null!=a.imageData)void 0!==a.beginCall&&a.beginCall&&a.beginCall.call(c),c.sealService.loadSeal({data:a.imageData,successCall:function(d){plus.hideLoading();if(d.result&&d.seals.length){for(var e in d.seals){d.seals=[{width:a.width,height:a.height,imgext:d.seals[e].imgext,signname:a.name,signsn:d.seals[e].signsn,
 username:d.seals[e].username,imgdata:a.imageData,sealTag:d.seals[e].sealTag||d.seals[e].sealtag,seSeal:d.seals[e].seSeal,headinfoex:d.seals[e].headinfoex}];break}c.keyData=d;c.showSeals(b)}else c.errorCallback({errcode:"111000"},a.errorCall)},errorCall:function(b){c.errorCallback(b,a.errorCall)}});else if(a.qrCodeUserUid){plus.hideLoading();var d={};d.qrCodeUserUid=a.qrCodeUserUid;d.seals=a.sealData;d.reuslt=!0;d.ServerTime=(new Date(+new Date+288E5)).toJSON().substr(0,19).replace("T"," ");d.username=
 a.username;d.esid=a.esid;a.stampType&&(d.stampType=a.stampType);c.keyData=d;c.showSeals(b)}},run:function(a){var b=this;b.showPromptDialog(function(){b.keyData?b.showSeals(a):(plus.showLoading(),void 0!==a.beginCall&&a.beginCall&&a.beginCall.call(b),b.sealService.loadSeal({successCall:function(c){plus.hideLoading();c.result?c.seals&&c.seals.length?(b.keyData=c,b.sealService.getKeysn({},function(d){Signature._getCookie("ksn")!=d&&Signature.clearRPW();Signature._showAndHideSealsDlg(b.keyData.seals);
 Signature.options.clientConfig||void 0===Signature.options.imgtag||0===Signature.options.imgtag||void 0!==c.ServerTime?(b.curDate=c.ServerTime,b.showSeals(a)):void 0!==b.serverUrl&&null!==b.serverUrl?(d={usercode:b.usercode,keysn:b.keyData.keysn,signname:b.signname,authcode:Signature.authcode},kinggrid.surry(b.serverUrl).request("_key_load",d).ret(function(c){c.result?(b.curDate=c.ServerTime,b.keyData=c,b.showSeals(a)):b.errorCallback(c,a.errorCall)})):(b.curDate=(new Date).toLocaleString(),b.showSeals(a))})):
 b.errorCallback({errcode:"11100"+Signature.options.imgtag},a.errorCall):b.errorCallback(c,a.errorCall)},errorCall:function(c){b.errorCallback(c,a.errorCall)}}));return this})},getSealsByKeysn:function(a,b,c){var d=this;d.sealService.loadSeal({successCall:function(a){if(a.result){var c=[];if(void 0!==b&&null!=b){for(var e=0;e<a.seals.length;++e)c[e]=d.toBase64Img(a.seals[e]);b(c)}}},errorCall:function(a){d.errorCallback(a,c.errorCall)}})},loadSeals:function(a,b){var c=this;c.sealService.loadSeal({successCall:function(b){void 0!==
 a&&null!==a&&null!==b&&void 0!==b.seals&&null!==b.seals&&a(b)},errorCall:function(a){c.errorCallback(a,b&&b.errorCall?b.errorCall:null)}})},runSS:function(a,b){var c=this;null!==b&&(c.keyData=b,null==b.seals||0==b.seals.length?c.errorCallback({errcode:"11107"},a.errorCall):void 0!==Signature.options.imgtag&&0!==Signature.options.imgtag&&void 0===b.ServerTime?void 0!==c.serverUrl&&null!==c.serverUrl?(b={usercode:c.usercode,keysn:c.keyData.keysn,signname:c.signname,authcode:Signature.authcode},kinggrid.surry(c.serverUrl).request("_key_load",
 b).ret(function(b){b.result?(c.curDate=b.ServerTime,c.keyData=b,c.showSeals(a)):c.errorCallback(b,a.errorCall)})):(c.curDate=(new Date).toLocaleString(),c.showSeals(a)):(c.curDate=b.ServerTime,c.showSeals(a)))},formatPos:function(a,b,c){var d={};if(a){var e=function(a){var e=a.elemid||a[0].id;e||(e="body");d[e]=void 0!=b&&void 0!=c?{marginLeft:b,marginTop:c}:Utils.filter(a,e)};if(Utils.is("Array",a))for(var f=0;f<a.length;f++)e(a[f]);else Utils.is("String",a)?d[a]=void 0!=b&&void 0!=c?{marginLeft:b,
 marginTop:c}:{}:e(a)}else d.body={};return d},exec:function(a,b,c,d,e,f){var g=this;delete g.signatureData;var h=null!=a.protectedItemsType&&"1"==a.protectedItemsType?a.protectedItems:g.getProtectedData(a.protectedItems);h={timestamp:{time:void 0==a.signtime?(new Date).getTime():(new Date(Date.parse(a.signtime.replace(/-/g,"/")))).getTime(),signtime:void 0==a.showtime?a.signtime:a.showtime,timestampInfo:a.timestampInfo},appname:Signature.options.version,documentid:void 0==a.documentid?g.documentid:
 a.documentid,documentname:void 0==a.documentname?g.documentname:a.documentname,moveable:Utils.boolean(a,"moveable",Signature.options.moveable),keysn:g.keyData.keysn,orgname:g.keyData.orgname,usercode:g.keyData.usercode,username:g.keyData.username||c.username,phoneshield:Signature.options.phoneshield?!0:!1,gbOvalue:g.keyData.gbOvalue,seal:c,phone:Signature.options.verification?g.keyData.phone:null,moveableRange:a.moveableRange,protectedData:h,sealType:a.sealType||g.sealType,extparam:a.extparam,ver:Signature.version,
 postilFontSet:a.postilFontSet,dateTime:a.datetime};g.keyData.stampType&&(h.stampType=g.keyData.stampType);c.esid&&(h.esid=c.esid);g.keyData.qrCodeUserUid&&(h.qrCodeUserUid=g.keyData.qrCodeUserUid);g.signatureData=h;g.certService.sData=g.signatureData;g.sealService.sData=g.signatureData;plus.showLoading();var m=Signature.options.autoCertMode||a.autoCert||g.autoCert||Signature.options.phoneshield&&"1"!=Signature.options.fjrsIsphone,p=function(a){var b=g.signatureData;if(a&&a.position){if(a.offsetX&&
 a.offsetY)a.changeOffsetXY&&a.changeOffsetXY(a),b.position=g.formatPos(a.position,a.offsetX,a.offsetY);else if(a.changeOffsetXY){var d={width:Math.ceil(9600*parseFloat(c.width)/254),height:Math.ceil(9600*parseFloat(c.height)/254)};d=a.changeOffsetXY(d);b.position=g.formatPos(a.position,d.offsetX,d.offsetY)}else b.position=g.formatPos(a.position);d=a.signatureid||g.genId();a&&a.scopePosition&&(void 0==Signature.options.extra&&(Signature.options.extra={}),Signature.options.extra[d]={scopePosition:a.scopePosition});
 b.timeid=(new Date).getTime();var e=(new Signature(d,b)).load(Signature.options);a.okCall&&(b={name:c.signname,height:c.height,width:c.width,imgdata:g.toBase64Img(c)},a.isBatchSignature?a.okCall.call(e,function(a){},a.documentid):a.okCall.call(e,function(b){g.trigger("createSignature",e,a.logMeta,m);b&&e.show()},b));plus.hideLoading()}else throw Error("no set position");};if(m||"scanStamp"===h.stampType){g.getSignData(h);var l=g.getH5SignData();if(a.signMeta)l[Utils.is("Array",a.signMeta)?"concat":
 "push"](a.signMeta);a.beforeSignCall&&a.beforeSignCall.call(g,l);e?"client"==Signature.options.sealType?g.runSign(l,d,function(h){h.result&&(p(a),f&&1<f.batchSignature.length&&(a.documentid=f.batchSignature[f.batchSignature.length-1].documentid,a.documentname=f.batchSignature[f.batchSignature.length-1].documentname,a.position=f.batchSignature[f.batchSignature.length-1].position,a.protectedItems=f.batchSignature[f.batchSignature.length-1].protectedItems,--f.batchSignature.length,g.exec(a,b,c,d,e,f)));
 b(h)}):g.sealService.verifyPwd({verify:Signature.options.verification,pwd:d,keysn:h.keysn,successCall:function(c){c.result?p(a):Signature.options.pwd_clear_flag&&g.onDeleteRPW?g.onDeleteRPW():null;b(c)},phoneshield:Signature.options.phoneshield}):g.keyData.noPassWord||g.signatureData.seal.esid?g.runSign(l,d,function(c){c.result?p(a):g.error(c,null,null,{_beginDlgOkCall:!0});b({result:!0})}):g.sealService.checkKeysn.call(g,{keysn:g.signatureData.keysn},function(c){c.result?g.runSign(l,d,function(c){if(c.result){var d=
 g.keyData.seals;setTimeout(function(){Signature._showAndHideSealsDlg(d)});p(a)}b(c)}):g.error(c,null,null,{_beginDlgOkCall:!0})})}else e?p(a):g.sealService.verifyPwd({verify:Signature.options.verification,pwd:d,keysn:h.keysn,successCall:function(c){if(c.result){var d=g.keyData.seals;setTimeout(function(){Signature._showAndHideSealsDlg(d)});p(a)}else Signature.options.pwd_clear_flag&&g.onDeleteRPW?g.onDeleteRPW():null;b(c)},phoneshield:Signature.options.phoneshield})},runPwd:function(a){var b=this;
 b.showPwdDialog({cancelCall:a.cancelCall,_onOk:function(c){Signature.options.showNoPW=!0;Signature.options.password=c;var d=this.find("#kg-remenberPwd").is(":checked");b.trigger("execSuccess",this,c,d);b.run($.extend(a,{beginCancalCall:function(){Signature.options.showNoPW=!1;Signature.options.password=emptyInput}}))}})},showPwdDialog:function(a){var b=this,c=a._onOk;b.showDialog("inputTpl",{onCancel:a.cancelCall,onShow:function(){var a=this;b.trigger("showSealsDialog_PW",a);Signature.editThemeColor();
 setTimeout(function(){a.find("#kg-password").focus()},40);a.find("#kg-password").keydown(function(b){13==b.keyCode&&a.options.onOk.call(a)})},onOk:function(){var a=this.find("#kg-password"),b=a.val();b?(c.call(this,b),this.remove()):plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){a.focus()});return!1},content:function(){return Utils.template.apply(null,[plus.template.inputTpl])}})},showPromptDialog:function(a){function b(){l.invoke("KGGetPublicParm","Customer","ValidateCertExpireTime",
 "").ret(function(a){typeof a==String&&"true"==a.toLowerCase()?Signature.options.password||Signature._getCookie("pwd")?(a=Signature._getCookie("pwd")||Signature.options.password,l.invoke("KGGetCerInfo",a).ret(function(a){c(m,a)})):h.showPwdDialog({cancelCall:function(){plus.hideLoading()},_onOk:function(a){var b=this,d=b.find("#kg-remenberPwd").is(":checked");l.invoke("KGGetCerInfo",a).ret(function(e){e.result?(Signature.options.password=a,h.trigger("execSuccess",b,a,d),c(m,e)):h.errorCallback({errmsg:e.errmsg})})}}):
 d(!0)})}function c(a,b){if(b.result){b=b.certinfo.notAfter;var c=(new Date(+new Date+288E5)).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");c=c.replace(/-/g,"/");a.days=f(b,c);l.invoke("KGGetPublicParm","Customer","ValidateCertUpdateURL","").ret(function(a){a&&(p=a)});l.invoke("KGGetPublicParm","Public","HintRemainingDays","").ret(function(b){a.days>b?d(!0):(a.certStatus=a.days<=b&&0<a.days?1:0,d())})}else Signature.options.password=emptyInput,h.errorCallback({errmsg:b.errmsg})}function d(b){if(!b){b=
 document.cookie.split("; ");for(var c=null,d=0;d<b.length;d++){var e=b[d].split("=");if("kg-certValidaty-dontShow"==e[0]){c=e[1];break}}b="true"==c}b?a&&a():h.showDialog("prompt",r)}function e(){p?window.open(p):h.errorCallback({errmsg:"\u83b7\u53d6\u5730\u5740\u5931\u8d25"})}function f(a,b){a=new Date(g(a));b=new Date(g(b));return Math.floor((a-b)/864E5)}function g(a){if(0<a.indexOf("/"))return a;var b=a.slice(0,4),c=a.slice(4,6),d=a.slice(6,8),e=a.slice(8,10),f=a.slice(10,12);a=a.slice(12,14);return b+
 "/"+c+"/"+d+" "+e+":"+f+":"+a}var h=this,m={},p="",l=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);h.clientConfig?b():a();var r={cancelCall:function(){},onShow:function(){Signature.editThemeColor();var a=Signature._color?Signature._color:"red";setTimeout(function(){root.iframeDialog?($(window.top.document).find("[i-id=cancel]").html($.kgi18n.prop("GoToRenewal")),$(window.top.document).find("[data-kgi18n-html]").each(function(a){$(this).html($.kgi18n.prop($(this).data("kgi18n-html")));
 $(this).addClass("kg-fontFamily")}),h.isMobile||$(window.top.document).find(".ui-dialog-button").css("float","right")):($("[i-id=cancel]").show(),$("[i-id=cancel]").html($.kgi18n.prop("GoToRenewal")),h.isMobile||$(".ui-dialog-button").css("float","right"))},100);$("[i-id=cancel]").click(e);var b=root.iframeDialog?$(window.top.document).find(".kg-promtInfo"):this.find(".kg-promtInfo");switch(m.certStatus){case 0:b.html('<i class="kg-icon-prompt"/><span data-kgi18n-html="RenewalPastDue"></span>');break;
 case 1:b.html('<i class="kg-icon-prompt"/><span data-kgi18n-html="RenewalInfoLeft"></span> <span id="kg-date">'+m.days+'</span> <span data-kgi18n-html="RenewalInfoRight"></span>'),this.find(".ui-dialog-checkInput").html('<div class="kg-tipCheck"><input type="checkbox" name="noPrompt" class="kg-primary-check-'+a+'" id="kg-noPrompt" >&nbsp;<label for="kg-noPrompt" data-kgi18n-html="NoPrompt">\u4e0d\u518d\u63d0\u793a</label></div>')}},onOk:function(){if(this.find("#kg-noPrompt").is(":checked")){var b=
 new Date;b.setTime(b.getTime()+864E5);document.cookie="kg-certValidaty-dontShow=true;expires=+"+b.toGMTString()}m.certStatus&&a&&a()},content:function(){return Utils.template.apply(null,[plus.template.prompt])}}},getPassCheck:function(a,b,c){if(a&&1==a)return a;if(void 0===c||!0===c||"auto"===c)try{return b.find("#kg-remenberPwd").is(":checked")}catch(d){}return!1},showSeals:function(a){var b=this,c={errorCall:a.errorCall,cancelCall:a.cancelCall,beginCancalCall:a.beginCancalCall,protectedItems:a.protectedItems,
 protectedItemsType:a.protectedItemsType,protectedItemsCheckedAll:void 0==a.protectedItemsCheckedAll?!0:a.protectedItemsCheckedAll,_onOk:function(c,d,e,f,g,q){var h=this,l=new plus.kgFont(null==h.fontSel?null==b.signdate?{}:b.signdate:h.fontSel),m=h.isCheck;!1!==Signature.options.showSealsDlg&&b.autoDlg||!Signature.options.signdate||!Signature.options.signdate.ischeck||(m=Signature.options.signdate.ischeck);a.protectedItems=null==h.proItems?0==a.protectedItemsCheckedAll?[]:a.protectedItems:h.proItems;
 a.datetime={isCheck:m,fontDate:l};l=new plus.kgFont(null==h.postilFontSet?null==b.thirdConfig||null==b.thirdConfig.postilFontSet?{}:b.thirdConfig.postilFontSet:h.postilFontSet,"0");l.fontValue=null!=b.postilFontSet&&null!=b.postilFontSet.fontValue?b.postilFontSet.fontValue:"";a.postilFontSet=l;void 0!=f&&null!=f?(a.signtime=f,void 0!=g&&null!=g?(a.showtime=g.TimeExt?(f+" ("+g.TimeExt+")").replace(/-/g,"/"):f.replace(/-/g,"/"),a.showtime+=kinggrid.msg("timestamp_time","KG_MSG"),a.timestampInfo=g):
 (a.showtime=(new Date(Date.parse(f.replace(/-/g,"/")))).toLocaleString(),a.showtime+=kinggrid.msg("server_time","KG_MSG"))):(a.signtime=void 0,a.showtime=(new Date).toLocaleString(),a.showtime+=kinggrid.msg("local_time","KG_MSG"));q=b.getPassCheck(q,h,Signature.options.showSealsDlg);void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid?a.batchSignature?b.sealService.verifyPwd({verify:Signature.options.verification,pwd:d,usercode:void 0==a.usercode?"":a.usercode,
 keysn:b.keyData.keysn,successCall:function(e){if(e.result){for(e=0;e<a.batchSignature.length&&(a.batchSignature[e].signtime=a.signtime,a.batchSignature[e].showtime=a.showtime,null!=a.position&&(a.batchSignature[e].position=a.position),a.batchSignature[e].autoCert=a.autoCert,a.batchSignature[e].okCall=a.okCall,a.batchSignature[e].cancelCall=a.cancelCall,a.batchSignature[e].beginCall=a.beginCall,a.batchSignature[e].endCall=a.endCall,null!=a.protectedItems&&(a.batchSignature[e].protectedItems=a.protectedItems),
 a.batchSignature[e].protectedItemsType=a.protectedItemsType,a.batchSignature[e].datetime=a.datetime,a.batchSignature[e].offsetX=a.offsetX,a.batchSignature[e].offsetY=a.offsetY,a.batchSignature[e].changeOffsetXY=a.changeOffsetXY,a.batchSignature[e].isBatchSignature=!0,b.exec(a.batchSignature[e],function(c){c.result?void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===
 Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",h,d,q):b.errorCallback(c,a.errorCall)},c,d,!0,a),void 0!==a.batchSignature[e].endCall&&a.batchSignature[e].endCall&&a.batchSignature[e].endCall.call(b),"client"!=Signature.options.sealType||!a.autoCert);++e);void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b);(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&h.remove()}else Signature.options.pwd_clear_flag&&b.onDeleteRPW?
 b.onDeleteRPW():null,b.errorCallback(e,a.errorCall)},phoneshield:Signature.options.phoneshield}):(b.exec(a,function(c){c.result?(void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",h,d,q),h.remove()):b.errorCallback(c,a.errorCall,null,{_beginDlgOkCall:!0})},c,d),void 0!==
 a.endCall&&a.endCall&&a.endCall.call(b)):void 0!==b.curDate&&null!==b.curDate&&b.sealExpired(c,a,b.curDate,function(e){e?a.batchSignature?b.sealService.verifyPwd({verify:Signature.options.verification,pwd:d,keysn:b.keyData.keysn,successCall:function(e){if(e.result){for(e=0;e<a.batchSignature.length&&(a.batchSignature[e].signtime=a.signtime,a.batchSignature[e].showtime=a.showtime,null!=a.position&&(a.batchSignature[e].position=a.position),a.batchSignature[e].autoCert=a.autoCert,a.batchSignature[e].okCall=
 a.okCall,a.batchSignature[e].cancelCall=a.cancelCall,a.batchSignature[e].beginCall=a.beginCall,a.batchSignature[e].endCall=a.endCall,null!=a.protectedItems&&(a.batchSignature[e].protectedItems=a.protectedItems),a.batchSignature[e].protectedItemsType=a.protectedItemsType,a.batchSignature[e].datetime=a.datetime,a.batchSignature[e].offsetX=a.offsetX,a.batchSignature[e].offsetY=a.offsetY,a.batchSignature[e].changeOffsetXY=a.changeOffsetXY,a.batchSignature[e].isBatchSignature=!0,b.exec(a.batchSignature[e],
 function(c){c.result?void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",h,d,q):b.errorCallback(c,a.errorCall)},c,d,!0),void 0!==a.batchSignature[e].endCall&&a.batchSignature[e].endCall&&a.batchSignature[e].endCall.call(b),"client"!=Signature.options.sealType||!a.autoCert);++e);
 void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b);(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&h.remove()}else b.errorCallback(e,a.errorCall)},phoneshield:Signature.options.phoneshield}):(b.exec(a,function(c){c.result?(void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||
 !0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",h,d,q),h.remove()):b.errorCallback(c,a.errorCall,null,{_beginDlgOkCall:!0})},c,d),void 0!==a.endCall&&a.endCall&&a.endCall.call(b)):b.errorCallback({errcode:"11103"},a.errorCall)},e)}};if(void 0!==Signature.options.showSealsDlg){var d=!0;if("auto"==Signature.options.showSealsDlg){var e=b.keyData;e.seals&&1==e.seals.length&&(d=!1)}b.autoDlg=d;if(!1!==Signature.options.showSealsDlg&&d)this.showSealsDialog(c);else if(void 0===Signature.options.password&&
 void 0!==b.password&&(Signature.options.password=b.password),d=Signature._getCookie("pwd"),!Signature.options.remberPwdAndShowSealsDlg&&d&&1==b.keyData.seals.length?Signature.options.password=d:Signature.options.showSealsDlg&&(Signature.options.showSealsDlg=!0),void 0===Signature.options.password)b.errorCallback({errcode:"11108"},a.errorCall);else{var f=b.getSignTimeStamp(b.getProtectedData(a.protectedItems));if(void 0!=Signature.options.timestamp&&1==Signature.options.timestamp)if("client"==Signature.options.sealType){var g=
 kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);g.invoke("KGGetTSURLInfo").ret(function(d){d.result?g.invoke("KGGetTSWithDigest",d.TimeStampUrl,d.TimeStampUserName,d.TimeStampPassword,f,"").ret(function(d){d.result?c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0,d.TimeStr,d):(b.errorCallback(d,a.errorCall,"KGGetTSWithDigest"),c._onOk.call(b,e.seals[0],pwdVal,0))}):(b.errorCallback(d,a.errorCall,
 "KGGetTSURLInfo"),c._onOk.call(b,e.seals[0],pwdVal,0))})}else $.ajax({url:Signature.options.serverUrl+"_key_getTimeStamp",type:"POST",data:{keysn:b.keyData.keysn,signTimeStamp:f},async:!1,success:function(a){a.result?c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0,a.timestamp):c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0)},error:function(a){c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0)}});else c._onOk.call(b,b.keyData.seals[0],Signature.options.password,
 0)}}else this.showSealsDialog(c)},showSealsDialog:function(a){var b=this,c=b.keyData;null!=b.signdate&&(c.signDateIsCheck=b.signdate.ischeck);var d=c.noPassWord=-1!=["scanStamp"].indexOf(c.stampType);c.isMobile=Signature.options.isMobile;c.showRememberPwd=Signature.options.showRememberPwd;var e=null!=a.protectedItemsType&&"1"==a.protectedItemsType?a.protectedItems:b.getProtectedData(a.protectedItems);c.showProtectedBtn=e&&0<e.length&&Signature.options.showProtectedBtn;c.verification=b.verification;
 for(var f=a.protectedItemsCheckedAll,g=[],h=0;e&&h<e.length;h++)g[h]=e[h],g[h].isChecked=f;null!=b.thirdConfig&&(c.thirdConfig=b.thirdConfig);c.newProItems=g;c.Global=Signature.options.Global;var m=[c],p=a._onOk,l=a.beginCancalCall;e={onCancel:a.cancelCall,onShow:function(){var d=this;Signature.editThemeColor();Signature.scanCallBack();var e=d.find(".kg-switcher");if(e.length){var f=new Utils.Switcher(e[0],{});e.find(".arrow-right").click(function(a){a.preventDefault();f.swipeNext()});e.find(".arrow-left").click(function(a){a.preventDefault();
 f.swipePrev()});e.find(".kg-guide span").click(function(a){a.preventDefault();f.to(+this.getAttribute("index"))});b.switcher=f}d.find("#kg-dateSet").click(function(a){b.showFontDialog(d)});d.find("#kg-fontSet").click(function(a){b.showPostilFontDialog(d)});null!=b.thirdConfig&&(null!=b.thirdConfig.commonlang&&d.find("#i-kg-common-lang").change(function(a){a=this.options[this.selectedIndex].innerHTML;d.find("#kg-postil-value").val(a)}),null!=b.thirdConfig.fontEditCall&&d.find(".kg-fontSet-edit").click(function(){b.thirdConfig.fontEditCall(b.thirdConfig)}),
 b.thirdConfig.postilFontSet&&(e=d.find("#kg-postil-value"),b.thirdConfig.postilFontSet.fontFamily&&e.css({fontFamily:b.thirdConfig.postilFontSet.fontFamily}),b.thirdConfig.postilFontSet.fontSize&&e.css({fontSize:b.thirdConfig.postilFontSet.fontSize}),b.thirdConfig.postilFontSet.fontColor&&e.css({color:b.thirdConfig.postilFontSet.fontColor})));Signature.options.verification?setTimeout(function(){d.find("#kg-password").focus()},40):setTimeout(function(){d.find("#kg-verification").focus()},500);var g=
 Signature.options.keysn,h=b.keyData.phone,l=d.find(".kg-tipText");l.html(h);l.click(function(){l.hide();d.find("#kg-verification").focus()});d.find("#kg-verification").click(function(){l.hide();d.find("#kg-verification").focus()});d.find(".kg-verificationButton").click(function(c){plus.showLoading();var e=$(this),f=d.find(".kg-verificationMark");b.sealService.applySMSCode({keysn:g,successCall:function(c){if(c.result){clearInterval(g);plus.hideLoading();l.css({display:"block"}).html($.kgi18n.prop("sentSMSCode"));
 f.css({display:"block"});var d=60,g=setInterval(function(){0<=d?(10>d?d="0"+d:d,e.html(d+"\u79d2"),d--):(e.html("\u9a8c\u8bc1\u7801"),f.css({display:"none"}),l.html(h),clearInterval(g))},1E3)}else b.errorCallback(c.massage,a.errorCall)}})});Signature.options.password&&d.find("#kg-password").val(Signature.options.password);b.trigger("showSealsDialog",d);Signature.options.showNoPW&&Signature.options.phoneshield||b.trigger("showSealsDialog_PW",d);d.find("#kg-password").keydown(function(a){13==a.keyCode&&
 d.options.onOk.call(d)});d.find("#kg-verification").keydown(function(a){13==a.keyCode&&d.options.onOk.call(d)});d.find("#kg-protectedDataSet").click(function(e){b.showProtectedDataDialog(d,a,c)})},onOk:function(){var e=this,f=e.find("#kg-password"),g=f.val()||Signature.options.password,h=e.find("#kg-verification").val(),l=e.find(".kg-wrapper .active");e.isCheck=e.find("#kg-addDate").is(":checked");var m=e.find("#kg-remenberPwd").is(":checked"),J=e.find("#kg-postil-value").val();b.postilFontSet=null==
 b.postilFontSet?{}:b.postilFontSet;b.postilFontSet.fontValue=J;if(Signature.options.verification){if(!h)return plus.alert(kinggrid.msg("in_verification_msg","KG_MSG"),function(){setTimeout(function(){f.focus()},100)}),!1;g=h}else if(!Signature.options.phoneshield&&!d&&!g)return plus.alert(kinggrid.msg("in_input_msg","KG_MSG"),function(){setTimeout(function(){f.focus()},100)}),!1;h=b.keyData.seals[l.attr("index")].SealTag||b.keyData.seals[l.attr("index")].sealtag;if("client"==Signature.options.sealType&&
 h&&"GM"==h){var E=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);h=b.keyData.seals[l.attr("index")].SealCert||b.keyData.seals[l.attr("index")].signercert;J=b.keyData.seals[l.attr("index")].ValidStart||b.keyData.seals[l.attr("index")].validstart;var G=b.keyData.seals[l.attr("index")].ValidEnd||b.keyData.seals[l.attr("index")].validend,K=b.keyData.seals[l.attr("index")].CertList||b.keyData.seals[l.attr("index")].certlist;
 E.invoke("KGValidate_GM","",h,J,G,K,"").ret(function(d){if(d.result)if(void 0!=Signature.options.timestamp&&1==Signature.options.timestamp){var f=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);f.invoke("KGGetTSURLInfo").ret(function(d){d.result?f.invoke("KGGetTSWithDigest",d.TimeStampUrl,d.TimeStampUserName,d.TimeStampPassword,b.getSignTimeStamp(b.getProtectedData(a.protectedItems)),"").ret(function(d){d.result?
 p.call(e,c.seals[l.attr("index")],g,l.attr("index"),d.TimeStr,d,m?!0:!1):(b.errorCallback(d,a.errorCall,"KGGetTSWithDigest"),p.call(e,c.seals[l.attr("index")],g,l.attr("index"),void 0,void 0,m?!0:!1))}):b.errorCallback(d,a.errorCall,"KGGetTSWithDigest")})}else p.call(e,c.seals[l.attr("index")],g,l.attr("index"),void 0,void 0,m?!0:!1);else return b.errorCallback(d,a.errorCall,"KGValidate_GM"),!1})}else if("client"==Signature.options.sealType&&b.keyData.seals[l.attr("index")].sealtag&&"GB"==b.keyData.seals[l.attr("index")].sealtag){E=
 kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);var z=b.keyData.seals[l.attr("index")];E.invoke("KGVerifyGBSealAction",z.sesealinfo,z.signsn).ret(function(c){if(c.result)b.keyData.gbOvalue=c.ovalue,p.call(e,z,g,l.attr("index"),void 0,void 0,m?!0:!1);else return b.errorCallback(c,a.errorCall,"KGVerifyGBSealAction"),!1})}else{l=e.find(".kg-wrapper .active");e.isCheck=e.find("#kg-addDate").is(":checked");var y=
 b.getSignTimeStamp(b.getProtectedData(a.protectedItems));void 0!=Signature.options.timestamp&&1==Signature.options.timestamp?"client"==Signature.options.sealType?(E=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),E.invoke("KGGetTSURLInfo").ret(function(d){d.result?E.invoke("KGGetTSWithDigest",d.TimeStampUrl,d.TimeStampUserName,d.TimeStampPassword,y,"").ret(function(d){d.result?p.call(e,c.seals[l.attr("index")],
 g,l.attr("index"),d.TimeStr,d):(b.errorCallback(d,a.errorCall,"KGGetTSWithDigest"),p.call(e,c.seals[l.attr("index")],g,l.attr("index")))}):b.errorCallback(d,a.errorCall,"KGGetTSURLInfo")})):$.ajax({url:Signature.options.serverUrl+"_key_getTimeStamp",type:"POST",data:{keysn:b.keyData.keysn,signTimeStamp:y},async:!1,success:function(a){if(a.result)if(a.TimeStampResponse){var b=Utils.eosFormatTime(a.TimeStr);p.call(e,c.seals[l.attr("index")],g,l.attr("index"),b,a)}else p.call(e,c.seals[l.attr("index")],
 g,l.attr("index"),a.timestamp);else p.call(e,c.seals[l.attr("index")],g,l.attr("index"))},error:function(a){p.call(e,c.seals[l.attr("index")],g,l.attr("index"))}}):p.call(e,c.seals[l.attr("index")],g,l.attr("index"));return!1}},content:function(){m.push(b.toBase64Img);var a=[Signature.options.template.showSealsBtl].concat(m);if(Signature.options.showNoPW||Signature.options.phoneshield)a=[Signature.options.template.showSealsBtl_nopassword].concat(m);return Utils.template.apply(null,a)}};void 0!==l&&
 l&&(e=Utils.extend({onCancel:function(){void 0!==l&&l&&l.call(b);this.close()}},e));Signature.options.showNoPW||Signature.options.phoneshield?b.showDialog("showSealsBtl_nopassword",e):b.showDialog("showSealsBtl",e);Signature.options.showSignExpirePrompt&&null!=c.currenttime&&void 0!=c.currenttime&&null!=c.overdate&&void 0!=c.overdate&&(e=new Date(c.currenttime),f=Math.floor(((new Date(c.overdate)).getTime()-e.getTime())/864E5),f<=c.hintdays&&0<=f&&(localStorage.getItem("lastAlertDate")&&null!=localStorage.getItem("lastAlertDate")&&
 ""!=localStorage.getItem("lastAlertDate")?(g=localStorage.getItem("lastAlertDate"),g=new Date(g),0<e.getTime()-g.getTime()&&b.showExpirtDialog("\u5f53\u524d\u7528\u6237\u8fd8\u6709"+f+"\u5929\u8fc7\u671f\uff0c\u8bf7\u53ca\u65f6\u66f4\u65b0\uff01",c.currenttime)):b.showExpirtDialog("\u5f53\u524d\u7528\u6237\u8fd8\u6709"+f+"\u5929\u8fc7\u671f\uff0c\u8bf7\u53ca\u65f6\u66f4\u65b0\uff01",c.currenttime)))},showProtectedDataDialog:function(a,b,c){var d=[{newProData:c.newProItems,proItemsCheckedAll:b.protectedItemsCheckedAll}],
 e={title:kinggrid.msg("ProtectedDataSet","KG_TITLE"),content:function(){d.push(Utils.html2Escape);var a=[Signature.options.template.protectedDataSetBtl].concat(d);return Utils.template.apply(null,a)},onShow:function(){Signature.editThemeColor()},onOk:function(){for(var d=c.newProItems.length;d--;)f.find("input[name='kg-proItem']").each(function(a,b){if(this.checked&&$(this).val()==c.newProItems[d].field)return c.newProItems[d].isChecked=!0,!1;c.newProItems[d].isChecked=!1});var e=[];if(null!=b.protectedItemsType&&
 "1"==b.protectedItemsType)for(var m=0;m<c.newProItems.length;m++)c.newProItems[m].isChecked&&e.push(c.newProItems[m]);else for(m=0;m<c.newProItems.length;m++)c.newProItems[m].isChecked&&e.push(c.newProItems[m].field);a.proItems=e}},f=plus.showDialog("protectedDataSetBtl",e);f.find("#kg-proData-items").on("click",function(a){"LABEL"==a.target.tagName&&f.find("#kg-selectedProData").text($(a.target).text().split("]")[1]);if("checkbox"==a.target.type)if($(a.target).is(":checked")){a=!0;for(var c=f.find("input[name='kg-proItem']"),
 d=0;d<c.length;d++)if(!c[d].checked){a=!1;break}a&&(f.find("input[name='selectAll']")[0].checked=!0,b.protectedItemsCheckedAll=!0)}else f.find("input[name='selectAll']")[0].checked=!1,b.protectedItemsCheckedAll=!1});f.find("#kg-selectBox").on("click",function(a){if($(a.target).is(":checked")){b.protectedItemsCheckedAll=!0;a=f.find("input[name='kg-proItem']");for(var d=0;d<a.length;d++)a[d].checked=!0,c.newProItems[d].isChecked=!0}else for(b.protectedItemsCheckedAll=!1,a=f.find("input[name='kg-proItem']"),
 d=0;d<a.length;d++)a[d].checked=!1,c.newProItems[d].isChecked=!1});return f},showPostilFontDialog:function(a){var b=null==this.thirdConfig||null==this.thirdConfig.postilFontSet?{}:this.thirdConfig.postilFontSet,c=plus.defaultFont,d=null==b.fontFamily?c.fontFamily:b.fontFamily,e=null==b.fontSize?c.fontSize:b.fontSize;c=c.fontColor;null!=b.fontColor&&/^#([0-9a-fA-f]{6})$/.test(b.fontColor)&&(c=b.fontColor.toUpperCase());null!=a.postilFontSet&&(d=a.postilFontSet.fontFamily,e=a.postilFontSet.fontSize,
 c=a.postilFontSet.fontColor);var f=[{fontFamily:this.getArrayPush(Signature.options.fontTemplate.fontFamily,d),fontSize:this.getArrayPush(Signature.options.fontTemplate.fontSize,e),fontColor:this.getArrayPush(Signature.options.fontTemplate.fontColor,c),dFontFamily:d,dFontSize:e,dFontColor:c}];b={title:$.kgi18n.prop("FontSetting"),content:function(){var a=[Signature.options.template.fontSetBtl].concat(f);return Utils.template.apply(null,a)},onShow:function(){Signature.editThemeColor()},onOk:function(){a.postilFontSet=
 {fontFamily:this.find("#kg-fontFamily").val(),fontSize:this.find("#kg-fontSize").val(),fontColor:kinggrid.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor"))};a.find("#kg-postil-value").css("font-family",a.postilFontSet.fontFamily);a.find("#kg-postil-value").css("font-size",a.postilFontSet.fontSize+"px");a.find("#kg-postil-value").css("color",a.postilFontSet.fontColor)}};var g=plus.showDialog("fontSetBtl",b);g.find("#kg-select-color").on("click",function(){g.find(".kg-color-div").css("display",
 "block");g.find("#kg-color-ul").css("display","block")});g.find("#kg-color-ul li a").click(function(){$("#kg-select-color").css("backgroundColor",$(this).css("backgroundColor"));g.find(".kg-color-div").css("display","none");g.find("#kg-color-ul").css("display","none")});g.find(".kg-color-div").on("mouseover",function(a){this.contains(a.fromElement||a.relatedTarget)||$(this).show()});g.find(".kg-color-div").on("mouseout",function(a){this.contains(a.toElement||a.relatedTarget)||$(this).hide()});return g},
 showFontDialog:function(a){var b=this,c=plus.dafaultDate,d=null==b.signdate?{}:b.signdate,e=plus.defaultFont;b=this;b=null==d.fontFormat?e.fontFormat:d.fontFormat;var f=null==d.fontFamily?e.fontFamily:d.fontFamily,g=null==d.fontSize?e.fontSize:d.fontSize,h=e.fontColor;null!=d.fontColor&&/^#([0-9a-fA-f]{6})$/.test(d.fontColor)&&(h=d.fontColor.toUpperCase());d=null==d.position?e.position:d.position;null!=a.fontSel&&(b=a.fontSel.fontFormat,f=a.fontSel.fontFamily,g=a.fontSel.fontSize,h=a.fontSel.fontColor,
 d=plus.fontTemplate.position[a.fontSel.fontPositionIndex]);var m=this.getArrayPush(Signature.options.fontTemplate.fontFormat,b),p=[{fontFormat:this.getFormatDate(m,c),fontFamily:this.getArrayPush(Signature.options.fontTemplate.fontFamily,f),fontSize:this.getArrayPush(Signature.options.fontTemplate.fontSize,g),fontColor:this.getArrayPush(Signature.options.fontTemplate.fontColor,h),fontPosition:Signature.options.fontTemplate.position,dFontFormat:kinggrid.Utils.formatDate(new Date(c),b),dFontFamily:f,
 dFontSize:g,dFontColor:h,dFontPosition:d}];c={title:kinggrid.msg("DateSet","KG_TITLE"),content:function(){var a=[Signature.options.template.dateSetBtl].concat(p);return Utils.template.apply(null,a)},onShow:function(){Signature.editThemeColor()},onOk:function(){var b=this.find("#kg-fontFormat").get(0).selectedIndex;a.fontSel={fontFormat:m[b],fontFamily:this.find("#kg-fontFamily").val(),fontSize:this.find("#kg-fontSize").val(),fontColor:kinggrid.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor")),
 fontPositionIndex:this.find("#kg-fontPosition").get(0).selectedIndex}}};var l=plus.showDialog("dateSetBtl",c);l.find("#kg-select-color").on("click",function(){"block"==l.find(".kg-color-div").css("display")?(l.find(".kg-color-div").css("display","none"),l.find("#kg-color-ul").css("display","none")):(l.find(".kg-color-div").css("display","block"),l.find("#kg-color-ul").css("display","block"))});l.find("#kg-color-ul li a").click(function(a){a.stopPropagation();l.find("#kg-select-color").css("backgroundColor",
 $(this).css("backgroundColor"));l.find("#kg-select-color").css("borderColor",$(this).css("backgroundColor"));l.find(".kg-color-div").css("display","none");l.find("#kg-color-ul").css("display","none")});l.find(".kg-color-div").on("mouseover",function(a){this.contains(a.fromElement||a.relatedTarget)||$(this).show()});l.find(".kg-color-div").on("mouseout",function(a){this.contains(a.toElement||a.relatedTarget)||$(this).hide()});return l},getArrayPush:function(a,b){-1==jQuery.inArray(b,a)&&a.push(b);
 return a},getFormatDate:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=kinggrid.Utils.formatDate(new Date(b),a[d]);return c},genId:function(){return now()+rand()},getSeal:function(a){return this.keyData.seals[a]},saveSignature:function(a,b,c,d){var e=this;if(void 0!=a&&void 0!=b&&void 0!=c){var f=Signature.options.clientCode||"",g=Signature.options.keysn;a=void 0!=Signature.options.cache_path&&null!=Signature.options.cache_path?{clientCode:f,keysn:g,documentId:a,signatureId:b,signaturedata:c,
 cachepath:Signature.options.cache_path}:{clientCode:f,keysn:g,documentId:a,signatureId:b,signaturedata:c,cachepath:""};kinggrid.surry(Signature.options.serverUrl).request("_signature_saveHtmlSignature",a).ret(function(a){void 0!==d&&null!==d&&d.call(e,a)})}},removeSignature:function(a,b,c){var d=this;void 0!=a&&void 0!=b&&(a={documentId:a,signatureId:b},kinggrid.surry(Signature.options.serverUrl).request("_signature_reomveHtmlSignature",a).ret(function(a){void 0!==c&&null!==c&&c.call(d,a)}))},getSaveSignatures:function(a,
 b,c){void 0!=a&&kinggrid.surry(Signature.options.serverUrl).request("_signature_getHtmlSignature",{documentId:a}).ret(function(a){Signature._verfiyInfotoServer=a.verfiyInfotoServer;a.result?b(a.sign):c&&c(a.result)})},showExpirtDialog:function(a,b){plus.showDialog("showExpirtDialog",{content:'<div class="kg-dialog kg-dialog-runSignature" id="sealExpirt-dialog"><div class="kg-dialog-content">'+a+'</div><div ><input type="checkbox" name="noMorePrompts" id="kg-noMorePrompts">&nbsp;<label for="kg-noMorePrompts">\u4e0d\u518d\u63d0\u793a</label></div> </div>',
 onOk:function(){this.find("#kg-noMorePrompts").is(":checked")&&localStorage.setItem("lastAlertDate",b)},onCancel:function(){}})},getRPW:function(a){if(this.ongetRPW)return this.ongetRPW(a)}});
 $.extend(Signature.options,{certType:"client",sealType:"client",clientUrl:"http://127.0.0.1:9581",moveable:!0,signable:!0,fontTemplate:plus.fontTemplate,template:{showSealsBtl:plus.template.sealTpl,showSealsBtl_nopassword:plus.template.sealTpl_noInput,signSignatureBtl:'<div id="kg-dialog-sign" class="kg-dialog kg-dialog-password kg-dialog-sign"><div class="kg-form"><div class="form-item clearfix"><% if(this.verification){%><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="VerifyCode">\u9a8c\u8bc1\u7801</label><div class="kg-sm kg-sm-7" style="position:relative"> <input type="password" style="text-indent:10px" name="kgpassword" autocomplete="new-password" id="kg-revokeVerifyCode" class="form-control"><span class="kg-verificationButton kg-revokeBtn kg-second-btn-red" style="width:70px;font-size:12px" title="\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801" data-kgi18n-title="SMSCodeTip" data-kgi18n-html="VerifyCode">\u9a8c\u8bc1\u7801</span><span class="kg-tip" style="right:70px"></span><span class="kg-tipText"></span><span class="kg-verificationMark kg-revokeMark"/></div><%}else{%><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="PassWord">\u5bc6\u7801</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div><%}%> </div></div></div>',protectedDataSetBtl:'<div id="kg-setProData" class="kg-dialog "><div id="kg-pro-data" class="kg-sm-13 kg-dialog-proData "><% var newProData = this.newProData; %><% var isAllChecked = this.proItemsCheckedAll; %><div id="kg-proData-items" class="kg-dialog-proData-items"><% for(var i=0;i<newProData.length;i++){%><div class="kg-dialog-proData-item"><% var proId = "proItem"+i; %><% var filedd = newProData[i].desc && newProData[i].desc != "" ? newProData[i].desc : newProData[i].field; %><% var content = "[" + filedd+"]" + arguments[0](newProData[i].value); %><% if(newProData[i].isChecked){ %><input type="checkbox" checked name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" custom="pro-value"><% content%></label>&nbsp;<% } %><% else{ isAllChecked = false; %><input type="checkbox" name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label"  custom="pro-value"><% content%></label>&nbsp;<% } %></div><%}%></div><div class="kg-dialog-line"></div><div class="kg-dialog-proData-selProData"><label id="kg-selectedProData" class="kg-selProData"></label></div></div><div ><% if(isAllChecked){ %><input type="checkbox" checked  name="selectAll" id="kg-selectBox" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value" data-kgi18n-html="SelectAll">\u5168\u90e8\u9009\u4e2d</label>&nbsp;<% } else{ %><input type="checkbox"  name="selectAll" id="kg-selectBox" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value" data-kgi18n-html="SelectAll">\u5168\u90e8\u9009\u4e2d</label>&nbsp;<% } %></div></div>',
 dateSetBtl:'<div id="kg-setDate" class="kg-dialog kg-dialog-Date"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Format">\u683c\u5f0f</label><div class="kg-sm kg-sm-6"><select name="fontFormat" id="kg-fontFormat" class="kg-select kg-fontFormat"><% var fontFormat = this.fontFormat; %><% for(var i=0;i<fontFormat.length;i++) {%><% if(fontFormat[i] == this.dFontFormat){%><option class="kg-option" value="<% fontFormat[i]%>" selected><% fontFormat[i]%></option><%}else{%><option class="kg-option" value="<% fontFormat[i]%>"><% fontFormat[i]%></option><%}%><%}%></select></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Font">\u5b57\u4f53</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Size">\u5c3a\u5bf8</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Color">\u989c\u8272</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Location">\u4f4d\u7f6e</label><div class="kg-sm kg-sm-6"><select name="fontPosition" id="kg-fontPosition" class="kg-select kg-fontPosition"><% var fontPosition = this.fontPosition; %><% for(var i=0;i<fontPosition.length;i++) {%><% if(fontPosition[i] == this.dFontPosition){%><option class="kg-option" value="<% fontPosition[i]%>" selected ><% fontPosition[i]%></option><%}else{%><option class="kg-option" value="<% fontPosition[i]%>" ><% fontPosition[i]%></option><%}%><%}%></select></div> </div></div></div>',
 fontSetBtl:'<div id="kg-setFont" class="kg-dialog kg-dialog-font"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Font">\u5b57\u4f53\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Size">\u5c3a\u5bf8\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Color">\u989c\u8272\uff1a</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div></div></div>'}});
 Signature.list={};Signature.updateList=[];Signature.removeList=[];
 function formartSignatureData(a,b,c){var d=[],e={};for(m in a){var f={},g=a[m];Utils.is("String",g)&&0!=g.indexOf("ey")?(f["b64_"+m]=a[m],d.push(f)):e[m]=g}var h=[];(function(a){for(var b in a)h.push((new Signature(b,a[b])).load(Signature.options))})(e);if(a=d.length){e=Signature.options.signSize||5;var m=Math.ceil(a/e);for(f=1;f<=m;f++){g=e*(f-1);var p=e*f>a?a:e*f;aisleKing=kinggrid.surry(Signature.options.serverUrl);aisleKing.request(Signature.options.b64Url,d.slice(g,p)).ret(function(a){if(a.result)for(var b in a){if(0==
 b.indexOf("b64_")){var c=a[b];Utils.is("String",c)&&(c=JSON.parse(c));h.push((new Signature(b.substring(4),c)).load(Signature.options))}}else Signature.prototype.error.call(null,a)})}}void 0!==aisleKing&&null!==aisleKing&&(d=function(){b&&b(1==h.length?h[0]:h)},a?aisleKing.fin(d):d(),c&&c())}
 Signature.loadSignature=function(a,b,c,d){var e={};void 0==Signature.options.extra&&(Signature.options.extra={});e[a]=b;void 0!==e.extra&&null!==e.extra&&(Signature.options.extra[e.signatureid]=e.extra);formartSignatureData(e,c||function(a){Signature.verify()},d)};
 Signature.loadSignatures=function(a,b,c){var d={};void 0==Signature.options.extra&&(Signature.options.extra={});if(Utils.is("Array",a))for(var e=0;e<a.length;e++){var f=a[e];d[f.signatureid]=f.signatureData;void 0!==f.extra&&null!==f.extra&&(Signature.options.extra[f.signatureid]=f.extra)}else for(e in a)d[e]=a[e];formartSignatureData(d,b||function(){Signature.verify()},c)};
 Signature.resetSignaturePos=function(a){void 0==Signature.options.extra&&(Signature.options.extra={});if(Utils.is("Array",a))for(var b=0;b<a.length;b++){var c=a[b];void 0!==c.extra&&null!==c.extra&&(Signature.options.extra[c.signatureid]=c.extra)}else for(b in a)Signature.options.extra[b]=a[b]};Signature.clearRPW=function(){var a=Signature.create();if(a.onDeleteRPW)a.onDeleteRPW()};var globalLisenter=new Listener("Signature");Signature.addLiseter=function(a,b){globalLisenter.on(a,b)};
 Signature.verify=function(){var a=Signature.list,b=[];globalLisenter.trigger("beforeVerify",d);for(var c in a){var d=a[c];d._verify(null,{batchVerify:!0})||b.push(d);globalLisenter.trigger("eachVerify",d)}globalLisenter.trigger("verify",d);return b};Signature._getCookie=function(a){return getCookie(a)};
 Signature._showAndHideSealsDlg=function(a){Signature.options.showSealsDlg&&(Signature._getCookie("pwd")&&1==a.length&&!Signature.options.remberPwdAndShowSealsDlg?Signature.options.showSealsDlg=!1:Signature.options.showSealsDlg=!0)};
 Signature.verifySignByList=function(a){var b=[];globalLisenter.trigger("beforeVerify",d);for(var c in a){var d=a[c],e=d._verify(null,{batchVerify:!0}),f=d.signatureData,g={};g.appname=f.appname;g.documentid=f.documentid;g.documentname=f.documentname;g.keysn=f.keysn;g.orgname=f.orgname;g.timestamp=f.timestamp;g.usercode=f.usercode;g.username=f.username;g.signname=f.seal.signname;g.signsn=f.seal.signsn;e||(g.modifiedItems=d.modifiedItems);b.push(g);globalLisenter.trigger("eachVerify",d)}globalLisenter.trigger("verify",
 d);return b};Signature.bind=function(a){Utils.extend(Signature.asyn,a)};
 Signature.loadProperties=function(){jQuery.kgi18n.properties({name:"language",path:Signature.options.languagesPath+"/lang/",mode:"map",language:Signature.options.LANGUAGE?Signature.options.LANGUAGE:jQuery.kgi18n.normaliseLanguageCode({}),cache:!1,encoding:"UTF-8",callback:function(){for(var a in kinggrid.errCode)if(Utils.is("Object",kinggrid.errCode[a]))for(var b in kinggrid.errCode[a])kinggrid.errCode[a][b]=$.kgi18n.prop(a+b);else kinggrid.errCode[a]=$.kgi18n.prop("errCode"+a);for(a in plus.fontTemplate.position)plus.fontTemplate.position[a]=
 $.kgi18n.prop("position"+a);plus.dialogConfig.okValue=$.kgi18n.prop("Confirm");plus.dialogConfig.cancelValue=$.kgi18n.prop("Close");plus.defaultFont.position=$.kgi18n.prop("position0");a=$(".kgImgIcons").find(".kg-img-icon");for(b=0;b<a.length;b++){var c=$(a[b]).attr("id"),d=c.indexOf("-",11)+1,e=c.indexOf("-",d);c=c.substring(d,e);$(a[b]).attr("title",$.kgi18n.prop("Title"+c))}}})};
 Signature.dynamicLoadCss=function(a){var b=document.getElementsByTagName("head")[0];root.iframeDialog&&(b=window.top.document.getElementsByTagName("head")[0]);for(var c=b.getElementsByTagName("link"),d=0;d<c.length;d++)0<c[d].href.indexOf("/languages/")&&b.removeChild(c[d]);c=document.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=a;b.appendChild(c)};Signature.show=function(){var a=Signature.list,b;for(b in a)a[b].show()};Signature.hide=function(){var a=Signature.list,b;for(b in a)a[b].hide()};
 Signature.isIE=function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1}();Signature.setRequestHeader=function(a){if(!this.options.clientConfig){var b=this.options.RequestHeaderList,c;for(c in b)a.setRequestHeader(c,b[c])}};Signature.getAuthCode=function(a,b){window.OnecodeJSBridge?window.OnecodeJSBridge.call("getAuthCode",{},function(c){c.status?a(c.authCode):b(c.errorMsg)}):b("OnecodeJSBridge\u521d\u59cb\u5316\u5931\u8d25, \u8bf7\u5728\u7801\u4e0a\u529e\u4e8b\u5c0f\u7a0b\u5e8f\u6216\u8005\u662fAPP\u4e2d\u6253\u5f00")};
 Signature.ScanStamp=function(a,b,c){function d(){O=document.getElementById("kg-exitSessionContainer");V=document.getElementById("kg-exitSessionClick");O.style.display="flex";V.addEventListener("click",e)}function e(){G.sealService.exitSession(n,function(a){a.result&&(Signature.userToken=usetToken=null,E(),D())})}function f(){N.innerHTML="";M.forEach(function(a,b){b=document.createElement("option");b.value=a.entityCode;b.innerText=a.entityName;N.appendChild(b)})}function g(a){l(a.target.value)}function h(){(new Promise(function(a,
 b){Signature.getAuthCode(a,b)})).then(function(a){G.sealService.establishSession(a,function(a){var b=a.data,d=a.message;0==a.code?(Signature.userToken=b.token,1==c?l():m()):Signature.alert(d)})})}function m(){G.sealService.queryUserCompany(Signature.userToken,function(a){var b=a.data.data,d=a.data.code;a=a.data.message;0==d?(M=Array.prototype.slice.call(b.companys).filter(function(a){return"0"===a.sealMakeStatus||"4"===a.sealMakeStatus}),M.push({entityName:"\u6388\u6743\u5370\u7ae0",entityCode:1}),
 M.push({entityName:"\u6388\u6743\u5370\u7ae02",entityCode:12}),l(M[0].entityCode)):6===d?(Signature.userToken=null,q(z,c)):Signature.alert(a)})}function p(a){for(var b=N.getElementsByTagName("option"),c=0;c<b.length;c++)if(b[c].value==a){b[c].setAttribute("selected","selected");break}}function l(a){n=Signature.userToken;if(1==a)var d=3;else d=c,2==c&&p(a);G.sealService.getUserSeals(n,d,a,function(a){var d=[];d=a.data.data;var e=a.data.code;a=a.data.message;0==e?(a=d.userInfo,d=d.seals,A=a.userId,
 L=a.userName,"stamp"==z&&(0<d.length?(d=d.map(function(a){a.imgdata=a.imageData;delete a.imageData;var b=1/(720/254);a.height=Utils.pxConversionMm(Math.round(.15*a.height/b));a.width=Utils.pxConversionMm(Math.round(.15*a.width/b));a.version=4;"1"==S&&(a.scanId=C);a.imgext=".png";return a}),a={qrCodeUserUid:A,username:L,stampType:"scanStamp",sealData:d},D(),b(a)):1<M.length?l(M[0].entityCode):Signature.alert("\u8be5\u7528\u6237\u6ca1\u6709\u53ef\u7528\u5370\u7ae0\uff01")),"delete"==z&&G.sealService.getSealauthority(C,
 K,Signature.userToken,function(a){a.result?(C=null,b(a)):(D(),Signature.alert(a.errmsg))})):6===e?(Signature.userToken=null,q(z,c)):Signature.alert(a)})}function r(a){G.sealService.getQrCodeToken(function(b){B=b.stampSystemUrl+"/qr";b=Utils.Base64.of("=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").decode(b.requestParameters);y=decodeURIComponent(b.split("&")[0]);w=decodeURIComponent(b.split("&")[1]);I="?token="+y+"&checkCode="+w;a&&a()})}function q(a,b){Q.classList.add("hide");
 G.sealService.getQRCodeImage(a,b,function(a){a.result?(a.session&&(S=a.session),1==S&&(Signature.userToken=null,F=a.image,W.src="data:image/png;base64,"+F,C=a.qrcodeId,r(t)),2==S&&(Signature.userToken?1==b?(Signature.scanCallBack=d,l()):(Signature.scanCallBack=function(){T=document.getElementById("kg-companySelectContainer");N=document.getElementById("kg-companySelect");T.style.display="block";N.addEventListener("change",g);f();d()},m()):Signature.options.isMobile?h():(F="data:image/png;base64,"+
 a.image,W.src=F,C=a.qrcodeId,r(t)))):(Q.classList.remove("hide"),C=null,G.errorCallback(a,Signature.options.errorCall))})}function t(){P=$.ajax({type:"get",url:B+"/user/get/"+C+I,timeout:75E3,success:function(a){if(a){var b=a.data,d=a.code;a=a.message;C=b.scanId;if(0==d){if(1==S){Signature.userToken=null;A=b.userInfo?b.userInfo.userId:void 0;L=b.userInfo?b.userInfo.userName:void 0;var e=[];b.seals&&0<b.seals.length&&(e=b.seals.map(function(a){delete a.isGmSeal;delete a.isPersonal;a.imgdata=a.imageData;
 a.imgext=".png";a.qrcodeId=C;a.scanId=b.scanId;a.scanSealType=c;a.signname=a.sealName;a.sealData&&(a.sealTag="GM");delete a.sealName;delete a.imageData;var d=1/(720/254);a.height=Utils.pxConversionMm(Math.round(.15*a.height/d));a.width=Utils.pxConversionMm(Math.round(.15*a.width/d));a.version=4;return a}));d={code:d,message:a,scanId:b.scanId,qrCodeUserUid:b.userInfo?b.userInfo.userId:void 0,qrCodeUserName:b.userInfo?b.userInfo.userName:void 0,seals:e,status:0==d};x(d)}2==S&&(Signature.userToken=b.userToken,
 1==c?l():m())}else d={code:d,message:a},x(d)}else Q.classList.remove("hide")},error:function(){Q.classList.remove("hide")}})}function x(a){if(1==a.status&&0==a.code)a.scanId&&a.qrCodeUserUid&&(A=a.qrCodeUserUid,L=a.qrCodeUserName,"stamp"==z&&(0<a.seals.length?(U=a.seals,D(),b({qrCodeUserUid:A,username:L,stampType:"scanStamp",sealData:U})):(D(),Signature.alert("\u8be5\u7528\u6237\u6ca1\u6709\u53ef\u7528\u5370\u7ae0\uff01"))),"delete"==z&&G.sealService.getSealauthority(C,K,Signature.userToken,function(a){a.result?
 (C=null,b(a)):(D(),Signature.alert(a.errmsg))}));else if(801==a.code)setTimeout(function(){r(t)},3E3);else if(802==a.code)Q.classList.remove("hide");else if(803==a.code)D();else return Signature.alert(a.message)}function v(){P&&P.abort()}function D(){v();H.close()}function J(){H.show()}function E(){U=[]}var G=this,K,z,y,C,w,F,A,L,B,n,M,P,I,T,N,O,V,S="1";c=c||"";var U=[];var H=a();var Q=H.find("#kg-qrCodeImgForeground")[0];var W=H.find("#kg-qrcodeImg")[0];H.find("#kg-qrCodeExpires");H.find(".ui-dialog-close").click(v);
 J();Q.addEventListener("click",function(){q(z,c)});return{open:J,close:D,sealData:U,dialog:H,clearSealData:E,getQrCodeImageByStamp:function(){z="stamp";q("stamp",c)},getQrCodeImageByDelete:function(a){K=a;z="delete";q("delete")}}};
 Signature.editThemeColor=function(a){if(Signature._color!=a){Signature._color=a?a:Signature._color;if(Signature.isIE){if(!Signature._color)return;a="kg-primary-arrow- kg-primary-btn- kg-default-btn- kg-second-btn- kg-title- kg-primary-check-".split(" ")}else{a=Signature.options.themeColor[a];for(k in a)document.documentElement.style.setProperty("--"+k,a[k]);a=["kg-primary-check-"]}for(var b="red"==Signature._color?"blue":"red",c=0;c<a.length;c++)for(var d=$("."+a[c]+b),e=0;e<d.length;e++)"red"==Signature._color?
 ($(d[e]).toggleClass(a[c]+"red"),$(d[e]).toggleClass(a[c]+"blue")):"blue"==Signature._color&&($(d[e]).toggleClass(a[c]+"blue"),$(d[e]).toggleClass(a[c]+"red"))}};Signature._verfiyInfotoServer=!1;
 Signature.AXI=function(a,b,c){Signature.authcode=f;var d=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),e;for(e in b){var f=b[e];""!==e&&""!==f?d.invoke(a,e,f):null!==e&&""!==e?d.invoke(a,e):d.invoke(a)}d.ret(function(a){a.result&&(Signature.options.moveable_self?(Signature.options.fjrsIsphone&&d.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),d.invoke("KGGetKeyOtherInfo","0").ret(function(b){b.result&&
 (b=b.Res.substring(1,b.Res.length-1),Signature.options.keysn=b);void 0!==c&&null!==c&&c(a)})):void 0!==c&&null!==c&&c(a))});return d};Signature.showAndHideBySignatureId=function(a,b){var c=Signature.list,d;for(d in c)0<=d.indexOf(a)&&(b?c[d].show():c[d].hide())};Signature.addIcon=function(a){var b=Signature.options.icons||[];b.push(a);Signature.options.icons=b};
 Signature.create=function(a){var b=$.extend({},Signature.options,a);void 0!==a&&void 0!==a.imgtag&&(Signature.options.imgtag=a.imgtag);void 0!==a&&void 0!==a.password&&(Signature.options.password=a.password);return new Signature._create(b)};$.extend(Signature.prototype,{saveSignatures:function(){},getSignatures:function(){}});var ClientSeal=function(a){var b=this;$.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})};Utils.inherit(ClientSeal,Signature.SealService);
 var ClientCert=function(a){var b=this;$.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})};Utils.inherit(ClientCert,Signature.CertService);
 $.extend(ClientSeal.prototype,{saveLog:function(a){var b=[];Utils.is("Object",a)?b.push(a):b=a;a=stringify({MSG:b});Signature.options.savelogFlg&&kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("SetParamByName","SAVEMSG",a)},loadSeal:function(a){var b=this,c=a.successCall,d=a.errorCall,e=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);
 b.appcode?e.invoke("SetParamByName","APPCODE",b.appcode):b.appcode="";void 0!==Signature.options.imgtag&&e.invoke("SetParamByName","SIGNTYPE",Signature.options.imgtag);Signature.options.fjrsIsphone&&e.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone);e.invoke("KGGetKeyInfo").ret(function(e){if(e.result){Signature.options.fjrsIsphone&&localStorage.setItem("fjrsToken",e.fjrs_token);Signature.options.phoneshield=!e.phoneshield||"1"!=e.phoneshield&&"3"!=e.phoneshield?!1:!0;Signature.options.phoneshield&&
 (kinggrid.options.timeout=1E3*(e.validatetime+10));if(""==e.seals)if(null!=a.data){e.seals={};var f={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"};e.seals[0]=f}else{d.call(b,{result:!1,errcode:"11"});return}else{if(Signature.options.signname||Signature.options.signindex){Signature.options.signname=Utils.is("Array",Signature.options.signname)?Signature.options.signname:[Signature.options.signname];var h=[];for(f=0;f<e.seals.length;f++){var m=e.seals[f];void 0!==m&&f==Signature.options.signindex&&
 h.push(e.seals[f]);for(var p=0,l=Signature.options.signname.length;p<l;p++)void 0!==m&&m.signname==Signature.options.signname[p]&&e.seals[Signature.options.signindex]!=m&&h.push(e.seals[f])}0==h.length?(e.result=!1,e.errcode="11101"):e.seals=h}for(f=0;f<e.seals.length;f++)m=e.seals[f],h=m.imgdata.substring(0,65),m=m.imgdata.substring(65),e.seals[f].imgdata=Utils.Base64.of().encodeByte(Utils.Base64.of(h).decodeByte(m))}a.isHW&&!e.seals.length&&(f={signname:"",width:"",signsn:null,height:"",imgdata:"",
 imgext:".png"},e.seals[0]=f,Signature.options._clientHW=!0);c.call(b,e)}else d.call(b,e)})},verifyPwd:function(a){var b=this,c=a.pwd,d=a.phoneshield?"1":"0",e=a.successCall;null==c&&(c="");var f=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);f.invoke("SetParamByName","ISPHONE",d);f.invoke("SetParamByName","FJRSISPHONE",a.phoneshield?a.phoneshield:"0");d&&f.invoke("SetParamByName","FJRSDELKEYSN",a.keysn);
 f.invoke("KGVerifyPin",c,a.keysn).ret(function(a){e.call(b,a)})},getKeysn:function(a,b){var c=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),d=a&&a.key?a.key:"0",e=Signature.options.getKeysnCallBack;Signature.options.fjrsIsphone&&(c.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),c.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken")));c.invoke("KGGetKeyOtherInfo",d).ret(function(a){if(a.result)"0"==
 d?(a=a.Res.substring(1,a.Res.length-1),b(a)):b(a);else{if(e)return e(a.result,a.errcode);plus.alert(kinggrid.msg(a.errcode,"then"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})}})},getPhoneShieldLic:function(a,b){a=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);Signature.options.fjrsIsphone&&
 a.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone);a.invoke("KGPhoneShieldLic").ret(function(a){b(a)})},checkKeysn:function(a,b){this.sealService.getKeysn({},function(c){a.keysn==c?b({result:!0}):b({result:!1,errcode:"11114"})})},getRemoveAuthority:function(a,b,c){c(!0)}});
 $.extend(ClientCert.prototype,{verifySign:function(a){var b=this,c=a.successCall,d=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);a.seal&&a.seal.sealtag&&"GB"==a.seal.sealtag&&d.invoke("SetParamByName","GBSIGNSN",a.seal.signsn);Signature.options.fjrsIsphone&&d.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone);d.invoke("SetParamByName","KEYSN",a.keysn);d.invoke("SetParamByName","SIGNSN",
 a.signsn);d.invoke("KGVerifySignMessage","123456",a.signdata,a.signeddata).ret(function(e){var f=e.result||"-8"!==e.errcode?e:{result:!1};f.result&&a.seal&&"GB"==a.seal.sealtag?d.invoke("KGVerifyGBStampAction",a.signeddata).ret(function(a){a.result||(f={result:!1});c.call(b,f)}):c.call(b,f)});a.seal&&a.seal.sealtag&&"GB"==a.seal.sealtag&&d.invoke("SetParamByName","GBSIGNSN","")},parseDate:function(a){var b=new Date;b.setFullYear(a.substring(0,4),+a.substring(4,6)-1,a.substring(6,8));b.setHours(a.substring(8,
 10),a.substring(10,12),a.substring(12,14),0);return b.getTime()},sign:function(a){var b=this,c=a.successCall,d=a.signMeta,e=[],f=[],g=a.seal,h=a.phoneshield?"1":"0",m=a.password;null==m&&(m="");for(var p=0;p<d.length;p++){var l=d[p];e.push(l.signdata);f.push(""+l.signdata.length)}d=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);d.invoke("SetParamByName","ISPHONE",h);g&&g.sealtag&&("GB"==g.sealtag&&(h=g.sesealinfo,
 d.invoke("SetParamByName","CLEARGBSESEALINFO",""),d.invoke("SetParamByName","GBSESEALINFO",h),d.invoke("SetParamByName","GBSIGNSN",g.signsn)),"GM"==g.sealtag&&d.invoke("SetParamByName","ISGM","1"));Signature.options.fjrsIsphone&&(d.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),d.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken")));d.invoke("SetParamByName","KEYSN",a.keysn);d.invoke("SetParamByName","SIGNSN",a.signsn);d.invoke("KGCrySignMessage",m,e.join(";"),
 +f[0]).ret(function(a){a=$.extend({},a);a.result&&(a.certinfo.notAfter=b.parseDate(a.certinfo.notAfter),a.certinfo.notBefore=b.parseDate(a.certinfo.notBefore));c.call(b,a)});g&&g.sealtag&&"GB"==g.sealtag&&(d.invoke("SetParamByName","CLEARGBSESEALINFO",""),d.invoke("SetParamByName","GBSIGNSN",""))}});Signature.addProvider("cert","client",ClientCert);Signature.addProvider("seal","client",ClientSeal);
 var ServerSeal=function(a,b){var c=this;c.sData=b;$.each(a,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b})};Utils.inherit(ServerSeal,Signature.SealService);var ServerCert=function(a,b){var c=this;c.sData=b;$.each(a,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b})};Utils.inherit(ServerCert,Signature.CertService);
 $.extend(ServerSeal.prototype,{getSealsUrl:"_key_load",verifyInputUrl:"_key_verify",saveLogUrl:"_signature_saveLog",applySMSCodeUrl:"_sms_applySMSCode",checkSMSCodeUrl:"_sms_checkSMSCode",telphoneUrl:"_sms_telphone",getQRCodeUrl:"_scan_getQrCodeImage",sealAuthorityUrl:"_scan_sealAuthority",getQRCodeTokenUrl:"_scan_getQrCodeToken",queryUserCompanyUrl:"_scan_queryUserCompany",getUserSealsUrl:"_scan_getUserSeals",establishSessionUrl:"_scan_establishSession",exitSessionUrl:"_scan_exitSession",saveLog:function(a){a=
 stringify(a);Signature.options.savelogFlg&&kinggrid.surry(this.serverUrl).request(this.saveLogUrl,{loginfo:a}).ret(function(a){a.result||Signature.prototype.error.call(null,a)})},getPwdSaveTime:function(a,b){kinggrid.surry(Signature.options.serverUrl).request("_signature_getPwdSaveTime").ret(function(c){a(c.result?c.pwdTime:b)})},loadSeal:function(a){var b=this,c=a.successCall,d=a.errorCall,e={usercode:b.usercode,keysn:b.keysn,authcode:b.authcode,password:Signature.options.password,sealTag:Signature.options.sealTag,
 certContext:Signature.options.cert};kinggrid.surry(b.serverUrl).request(b.getSealsUrl,e).ret(function(e){if(e.result){if(void 0!==Signature.options.imgtag&&null!==Signature.options.imgtag){var f=[],h;for(h in e.seals){var m=e.seals[h];void 0!==m&&parseInt(m.imgtag)==Signature.options.imgtag&&(f[f.length]=e.seals[h])}e.seals=f}if(Signature.options.signname||Signature.options.signindex){Signature.options.signname=Utils.is("Array",Signature.options.signname)?Signature.options.signname:[Signature.options.signname];
 f=[];for(h in e.seals){m=e.seals[h];void 0!==m&&h==Signature.options.signindex&&f.push(e.seals[h]);for(var p=0,l=Signature.options.signname.length;p<l;p++)void 0!==m&&m.signname==Signature.options.signname[p]&&e.seals[Signature.options.signindex]!=m&&f.push(e.seals[h])}0==f.length?(e.result=!1,e.errcode="11101"):e.seals=f}if(!e.seals.length)if(a.isHW)e.seals=[],e.seals[0]={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"};else{e="11101";Signature.options.imgtag&&(e="11100"+Signature.options.imgtag);
 d.call(b,{result:!1,errcode:e});return}c.call(b,e)}else d.call(b,e)})},verifyPwd:function(a){var b=this,c=a.successCall,d=kinggrid.surry(b.serverUrl);a.verify?(a={keysn:a.keysn,verifyCode:a.pwd},d.request(b.checkSMSCodeUrl,a).ret(function(a){c.call(b,a)})):(a={usercode:void 0==b.sData?a.usercode:b.sData.usercode,keysn:void 0==b.sData?a.keysn:b.sData.keysn,password:a.pwd},d.request(b.verifyInputUrl,a).ret(function(a){c.call(b,a)}))},applySMSCode:function(a){var b={keysn:a.keysn};kinggrid.surry(this.serverUrl).request(this.applySMSCodeUrl,
 b).ret(function(b){a.successCall&&a.successCall(b)})},getTelphone:function(a){var b={keysn:a.keysn};kinggrid.surry(this.serverUrl).request(this.telphoneUrl,b).ret(function(b){a.successCall&&a.successCall(b)})},checkKeysn:function(a,b){a.keysn==Signature.options.keysn?b({result:!0}):b({result:!1,errcode:"11115"})},getKeysn:function(a,b){b(Signature.options.keysn)},getQRCodeImage:function(a,b,c){var d={},e=kinggrid.surry(this.serverUrl);d.way={stamp:"1","delete":"2"}[a];d.scanSealType=b;e.request(this.getQRCodeUrl,
 d).ret(function(a){c(a)})},getSealauthority:function(a,b,c,d){a={scanId:a,esid:b,userToken:c};kinggrid.surry(this.serverUrl).request(this.sealAuthorityUrl,a).ret(function(a){d(a)})},getRemoveAuthority:function(a,b,c){Signature.options.clientConfig&&c(!0);b.seal.esid&&"scanStamp"!=b.stampType?(a={documentId:b.documentid,documentName:b.documentname,esid:b.seal.esid,signeddata:b.signMeta.signeddata},kinggrid.surry(Signature.options.serverUrl).request("_signature_authentication",a).ret(function(a){a.result?
 c(!0):(Signature.prototype.error.call(null,a),c(!1))})):c(!0)},getQrCodeToken:function(a){kinggrid.surry(this.serverUrl).request(this.getQRCodeTokenUrl).ret(function(b){a(b)})},queryUserCompany:function(a,b){kinggrid.surry(this.serverUrl).request(this.queryUserCompanyUrl,{userToken:a}).ret(function(a){b(a)})},getUserSeals:function(a,b,c,d){kinggrid.surry(this.serverUrl).request(this.getUserSealsUrl,{userToken:a,category:b,entityCode:c}).ret(function(a){d(a)})},establishSession:function(a,b){kinggrid.surry(this.serverUrl).request(this.establishSessionUrl,
 {authCode:a}).ret(function(a){b(a)})},exitSession:function(a,b){kinggrid.surry(this.serverUrl).request(this.exitSessionUrl,{userToken:a}).ret(function(a){b(a)})}});
 $.extend(ServerCert.prototype,{signUrl:"_sign",verifySignUrl:"_sign_verify",verifySign:function(a){var b=this,c=b.sData,d=a.successCall,e=!!c.stampType;kinggrid.surry(b.serverUrl).request(b.verifySignUrl,{certType:c.certType,isUTF8:c.isUTF8,signsn:c.seal.signsn,html2sign:c.signMeta.html2sign,keysn:c.keysn,isScan:e,signdata:a.signdata,signeddata:c.signMeta.signeddata,crtdata:c.signMeta.certinfo.crtdata,sealTag:c.seal.sealTag||c.seal.sealtag}).ret(function(a){d.call(b,a)})},sign:function(a){for(var b=
 this,c=a.signMeta,d=a.successCall,e=[],f=a.seal.sealTag,g=0;g<c.length;g++){var h=c[g];if("GM"==f||"SM2"==Signature.options.certAlgorithm)h.hashAlg="SM3",h.encryptAlg="SM2";e.push("$"+(h.hashAlg||b.hashAlg)+"|"+(h.encryptAlg||b.encryptAlg)+"$"+h.signdata)}"scanStamp"===b.sData.stampType?(c=a.seal.sealData,e={keysn:a.keysn,scanSealType:a.seal.scanSealType,scanId:a.seal.scanId,esid:a.seal.esid,documentId:a.documentid,documentName:a.documentname,signdata:e.join(";"),signsn:a.signsn,scanStamp:!0,userToken:Signature.userToken,
 sealData:c}):e=Signature.options.verification?{keysn:a.keysn,signdata:e.join(";"),signsn:a.signsn,sealTag:f}:{keysn:a.keysn,password:a.password,signdata:e.join(";"),signsn:a.signsn,sealTag:f};a.seal.esid&&(e.esid=a.seal.esid,e.documentId=a.documentid,e.documentName=a.documentname);e.seSeal=a.seal.seSeal;e.version=a.seal.version;kinggrid.surry(b.serverUrl).request(b.signUrl,e).ret(function(a){a.result&&(a.certinfo.algName=a.certinfo.algName.replace("with",""));d.call(b,a)})}});
 Signature.addProvider("cert","server",ServerCert);Signature.addProvider("seal","server",ServerSeal);Signature.alert=plus.alert;var version=Signature.version={name:"1.0.20",code:100};root.Signature=Signature;"use strict";function getLen(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function dot(a,b){return a.x*b.x+a.y*b.y}function getAngle(a,b){var c=getLen(a)*getLen(b);if(0===c)return 0;a=dot(a,b)/c;1<a&&(a=1);return Math.acos(a)}function cross(a,b){return a.x*b.y-b.x*a.y}
 function getRotateAngle(a,b){var c=getAngle(a,b);0<cross(a,b)&&(c*=-1);return 180*c/Math.PI}
 var AlloyFinger=function(a,b){this.preV={x:null,y:null};this.pinchStartLen=null;this.scale=1;this.isDoubleTap=!1;this.rotate=b.rotate||function(){};this.pointStart=b.pointStart||function(){};this.multipointStart=b.multipointStart||function(){};this.multipointEnd=b.multipointEnd||function(){};this.pinch=b.pinch||function(){};this.swipe=b.swipe||function(){};this.tap=b.tap||function(){};this.doubleTap=b.doubleTap||function(){};this.longTap=b.longTap||function(){};this.singleTap=b.singleTap||function(){};
 this.pressMove=b.pressMove||function(){};this.x1=this.x2=this.y1=this.y2=this.swipeTimeout=this.longTapTimeout=this.touchTimeout=this.tapTimeout=this.now=this.last=this.delta=null;this.preTapPosition={x:null,y:null};a.addEventListener("touchstart",this.start.bind(this),!1);a.addEventListener("touchmove",this.move.bind(this),!1);a.addEventListener("touchend",this.end.bind(this),!1);a.addEventListener("touchcancel",this.cancel.bind(this),!1)};
 AlloyFinger.prototype={start:function(a){if(a.touches){this.now=Date.now();this.x1=a.touches[0].pageX;this.y1=a.touches[0].pageY;this.delta=this.now-(this.last||this.now);this.pointStart(a);null!==this.preTapPosition.x&&(this.isDoubleTap=0<this.delta&&250>=this.delta&&30>Math.abs(this.preTapPosition.x-this.x1)&&30>Math.abs(this.preTapPosition.y-this.y1));this.preTapPosition.x=this.x1;this.preTapPosition.y=this.y1;this.last=this.now;var b=this.preV;if(1<a.touches.length){var c=a.touches[1].pageY-this.y1;
 b.x=a.touches[1].pageX-this.x1;b.y=c;this.pinchStartLen=getLen(b);this.multipointStart(a)}this.longTapTimeout=setTimeout(function(){this.longTap(a)}.bind(this),750)}},move:function(a){if(a.touches){var b=this.preV,c=a.touches.length,d=a.touches[0].pageX,e=a.touches[0].pageY;this.isDoubleTap=!1;1<c?(c={x:a.touches[1].pageX-d,y:a.touches[1].pageY-e},null!==b.x&&(0<this.pinchStartLen&&(a.scale=getLen(c)/this.pinchStartLen,this.pinch(a)),a.angle=getRotateAngle(c,b),this.rotate(a)),b.x=c.x,b.y=c.y):null!==
 this.x2&&(a.deltaX=d-this.x2,a.deltaY=e-this.y2,this.pressMove(a));this._cancelLongTap();this.x2=d;this.y2=e;a.preventDefault()}},end:function(a){if(a.changedTouches){this._cancelLongTap();var b=this;2>a.touches.length&&this.multipointEnd(a);this.x2&&30<Math.abs(this.x1-this.x2)||this.y2&&30<Math.abs(this.preV.y-this.y2)?(a.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){b.swipe(a)},0)):this.tapTimeout=setTimeout(function(){b.isDoubleTap?(b.doubleTap(a),
 clearTimeout(b.touchTimeout),b.isDoubleTap=!1):b.touchTimeout=setTimeout(function(){b.singleTap(a)},250)},0);this.preV.x=0;this.preV.y=0;this.scale=1;this.x1=this.x2=this.y1=this.y2=this.pinchStartLen=null}},cancel:function(){clearTimeout(this.touchTimeout);clearInterval(this.tapTimeout);clearInterval(this.longTapTimeout);clearInterval(this.swipeTimeout)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_swipeDirection:function(a,b,c,d){return Math.abs(a-b)>=Math.abs(c-d)?0<a-b?"Left":
 "Right":0<c-d?"Up":"Down"}};Utils=kinggrid.Utils;
 Utils.extend(Signature.options.template,{infoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-info"><%var autoCertMode = Signature.options.autoCertMode; %><%var modified = this.modified;%><%var timeVerify = this.timeVerify;%><%var tsaInfo = !!this.signatureData.signMeta?this.signatureData.signMeta.tsaInfo:0; %><%var canSign = this.signatureData.signMeta || this.canSign(); %><div class="kg-title success <%modified?"kg-hide":""%>" style="padding:0 0 15px 0"><i class="kg-icon"></i><div><span a="<%canSign%>" data-kgi18n-html="VerifyNormal">\u68c0\u6d4b\u7ed3\u679c\uff1a\u4fdd\u62a4\u6570\u636e\u6b63\u5e38\uff01</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-title danger  <%modified?"":"kg-hide"%> "  style="padding:20px 0"><i class="kg-icon"></i><div><span data-kgi18n-html="VerifyTamper">\u68c0\u6d4b\u7ed3\u679c\uff1a\u4fdd\u62a4\u6570\u636e\u88ab\u7be1\u6539\uff01</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" class="kg-title-red" kg-target="signatureinfo" data-kgi18n-html="SignInfo">\u7b7e\u7ae0\u4fe1\u606f</a></li><%if(autoCertMode){%><%if(canSign){%><li class=""><a href="#" class="kg-title-red" kg-target="certinfo" data-kgi18n-html="CertInfo">\u8bc1\u4e66\u4fe1\u606f</a></li><%if(!!tsaInfo){%><li class=""><a href="#" class="kg-title-red" kg-target="tsaInfo"  data-kgi18n-html="tStampInfo">\u65f6\u95f4\u6233\u4fe1\u606f</a></li><%}%><%}%><%}{%><%if(this.icon_sign == null || this.icon_sign == true){%><%if(canSign){%><li class="" ><a href="#" class="kg-title-red" kg-target="certinfo" data-kgi18n-html="CertInfo">\u8bc1\u4e66\u4fe1\u606f</a></li><%if(!!tsaInfo){%><li class=""><a href="#" class="kg-title-red" kg-target="tsaInfo"  data-kgi18n-html="tStampInfo">\u65f6\u95f4\u6233\u4fe1\u606f</a></li><%}%><%}%><%}%><%}%></ul><div class="kg-tab-content"><div class="kg-tab-pane active signatureinfo"><% var SDATA = this.signatureData; %><% var modifiedItems = this.modifiedItems; %><% var scanStamp = this.signatureData.stampType;%><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Application">\u5e94\u7528\u7a0b\u5e8f\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.appname%></span></div><%if(SDATA.orgname){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="AuthorizedUnit">\u6388\u6743\u5355\u4f4d\uff1a</label><span class="kg-value  <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.orgname%></span></div><%}%><%if(SDATA.username){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="UserName">\u7528\u6237\u540d\u79f0\uff1a</label><span class="kg-value  <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.username%></span></div><%}%><%if(SDATA.keysn){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="KeySequence">\u5bc6\u94a5\u5e8f\u5217\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.keysn%></span></div><%}%><%if(SDATA.seal.signname){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureName">\u7b7e\u7ae0\u540d\u79f0\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%SDATA.seal.signname%></span></div><%}%><%if(SDATA.seal.signsn){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureSequence">\u7b7e\u7ae0\u5e8f\u5217\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin-top:5px;"><%SDATA.seal.signsn%></span></div><%}%><%if(SDATA.timestamp.signtime){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureDate">\u7b7e\u7ae0\u65e5\u671f\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin-top:5px;"><%SDATA.timestamp.signtime%></span></div><%}%></div><%if(this.icon_remove == null || this.icon_remove == true){%><div><button type="button" id="revoke_<%this.signatureid%>" class="kg-button" i-id="revoke" data-kgi18n-html="RevokeSign" >\u64a4\u9500\u7b7e\u7ae0</button></div><%}%></div><%if(canSign){%><div class="kg-tab-pane certinfo"><%var noCertInfo = !this.signatureData.signMeta; %><%if(!noCertInfo){%><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-meta" style="padding-bottom:20px;"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Version">\u7248\u672c\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>">V<%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SerialNumber">\u5e8f\u53f7\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin-top:5px;"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureAlgorithm">\u7b7e\u540d\u7b97\u6cd5\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Issuer">\u9881\u53d1\u8005\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height: 17px;margin-top:5px;"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="User">\u4f7f\u7528\u8005\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height: 17px;margin-top:5px;"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">\u6709\u6548\u671f\u4ece\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span><label  class="kg-to-sm">~</label><span class="<%this.Global%>-value mf-0 <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div><%}else{%><div class="kg-meta"><div class="clearfix kg-item kg-visble "><label class="kg-label"></label><span class="kg-value">----------------------------------------------------------------------------------------------------------------------</span></div><div class="clearfix kg-item kg-nosign">\u5f53\u524d\u6587\u6863\u672a\u505a\u6570\u5b57\u7b7e\u540d</div><div class="clearfix kg-item kg-visble"><label class="kg-label"></label><span class="kg-value">--------------------------------------------------------------------</span></div></div><%}%><%if(noCertInfo){%><div><button type="button" id="sign_<%this.signatureid%>" class="kg-button" data-kgi18n-html="DigitalSign">\u6570\u5b57\u7b7e\u540d</button></div><%}else{%><%}%></div><%if(!!tsaInfo){%><div class="kg-tab-pane tsaInfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaTime">\u65f6\u95f4\u6233\u65f6\u95f4\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%tsaInfo.tsaTime%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSubject" >\u8bc1\u4e66\u4f7f\u7528\u8005\uff1a</label><span class="kg-value <%this.Global%>-value" <%this.isMobile?"mobile-value":""%>"> <%tsaInfo.tsaCert.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSerialNumber">\u8bc1\u4e66\u5e8f\u5217\u53f7\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%tsaInfo.tsaCert.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaIssuerDN">\u65f6\u95f4\u6233\u673a\u6784\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>" style="line-height:17px;margin:4px 0;"><%tsaInfo.tsaCert.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSigAlg">\u7b7e\u540d\u7b97\u6cd5\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>">" style="line-height:17px;margin:4px 0;"><%tsaInfo.tsaCert.oid%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">\u6709\u6548\u671f\u4ece\uff1a</label><span class="kg-value <%this.Global%>-value <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(tsaInfo.tsaCert.startDate) , "yyyy-MM-dd hh:mm:ss")%></span><label  class="kg-to-sm">~</label><span class="<%this.Global%>-value mf-0 <%this.isMobile?"mobile-value":""%>"><%kinggrid.Utils.formatDate(new Date(tsaInfo.tsaCert.endDate) , "yyyy-MM-dd hh:mm:ss")%></span></div></div></div><%}%><%}%></div></div></div></div>',handwritedlg:'<div class="kg-dialog kg-dialog-info" id="kg-handwrite"><div class="kg-hw-content"><div class="kg-hw-info kg-hw-model"><span data-kgi18n-html="Model">\u6a21\u5f0f</span><select id="hw_model"><option value="0" data-kgi18n-html="HWSignatrue">\u624b\u5199\u7b7e\u540d</option><option value="1" data-kgi18n-html="TextApproval">\u6587\u5b57\u7b7e\u6279</option></select></div><div class="kg-hw-info kg-hw-name"><span data-kgi18n-html="Name">\u540d\u79f0</span><input type="text" data-kgi18n-value="HWApproval" value="\u624b\u5199\u7b7e\u6279" id="nameid" style="margin-left:1px;width:76px;height:16px;"/></div><div class="kg-hw-info kg-hw-color"><span data-kgi18n-html="Color">\u989c\u8272</span><select id="hw_color"><option value="black" data-kgi18n-html="KGfontColor\u9ed1">\u9ed1</option><option value="red" data-kgi18n-html="KGfontColor\u7ea2">\u7ea2</option><option value="blue" data-kgi18n-html="KGfontColor\u84dd">\u84dd</option><option value="green" data-kgi18n-html="KGfontColor\u7eff">\u7eff</option></select></div><div class="kg-hw-info kg-hw-linewidth kg-hw-handwrite"><span data-kgi18n-html="PenWidth">\u7b14\u5bbd</span><select id="hw_width"><% for(var i=1;i<=8;i++) {%><option value="<%i%>"><%i%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontFamily kg-hw-written"><span data-kgi18n-html="Font">\u5b57\u4f53</span><select id="hw_fontFamily"><% for(var i=0;i<this.fontFamily.length;i++) {%><option value="<%this.fontFamily[i].ename%>"><%this.fontFamily[i].zname%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontSize kg-hw-written"><span data-kgi18n-html="FontSize">\u5b57\u53f7</span><select id="hw_fontSize"><% for(var i=16;i<=80;i+=4) {%><option value="<%i%>"<%i==24?"selected":""%>><%i%></option><%}%></select></div></div><div class="kg-hw-canvas"><div id="kg-hw-span" class="kg-hw-written kg-hw-text-span"></div><textarea class="kg-hw-written kg-hw-text-edit" spellcheck="false"></textarea><canvas id="canvasId" width=700px height=300px></canvas></div><div id="div-judge" class="kg-tab-content" align="center"><button type="button" id="clearid" class="kg-button" data-kgi18n-html="Clear">\u6e05\u9664</button><button type="button" id="okid" class="kg-button" data-kgi18n-html="Sign">\u7b7e\u540d</button></div></div>',
 barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label" data-kgi18n-html="QrCodeContent">\u4e8c\u7ef4\u7801\u5185\u5bb9</label><textarea id="bcId" align="center" rows="3" cols="25"></textarea><br/><br/><div id="output"><br /></div><div id="div-judge" class="kg-tab-content"><button type="button" id="bc_clearid" class="kg-button" data-kgi18n-html="Clear">\u6e05\u9664</button><button type="button" id="bc_okid" class="kg-button" data-kgi18n-html="Confirm">\u786e\u8ba4</button></div></div>',
 scanbarcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-scanBC"><div id="contentHolder" style="width:320px;height:320px; background:red;"><video id="html5_qrcode_video" height="320px" width="320px" autoplay></video><canvas id="qr-canvas" width="320px" height="320px" style="display:none;"></canvas> <br/></div></div>',scanStampdlg:'<div class="kg-dialog" id="kg-scanStampdlg"><div id="support"></div><div id="scanStampContent"><div id="kg-qrCodeImgForeground" class="hide" data-kgi18n-html="QrcodeInvalid">\u4e8c\u7ef4\u7801\u5df2\u5931\u6548\uff0c\u70b9\u51fb\u5237\u65b0</div><img id="kg-qrcodeImg" width="320px" height="320px"/></div></div>'});
 Signature._create.prototype.onshowSealsDialog=function(a){var b=this;a.find(".arrow").hide();a=a.find("#kg-switcher");b.switcher.animate=!1;new AlloyFinger(a[0],{swipe:function(a){b.switcher["Left"===a.direction?"swipePrev":"swipeNext"]()},tap:function(){b.switcher.swipeNext()}})};
 Signature.prototype.onhandleImg=function(a){var b=this,c=function(a){var c=b.verify();Signature._verfiyInfotoServer&&(a=[],c=b._getLogInfo({LOGTYPE:"00",LOGSORT:"33",LOGMEMO:c?"\u6587\u6863\u9a8c\u8bc1\u6210\u529f":"\u6587\u6863\u9a8c\u8bc1\u5931\u8d25"}),a.push(c),b.sealService.saveLog(a));b.signatureInfo()},d=function(){if(void 0!==Signature.options.extra){var b=a.attributes.signatureid.nodeValue;if(b&&(b=Signature.options.extra[b],null!=b&&void 0!==b&&b.icon_move))return b.icon_move()}}();d=void 0==
 d?!0:d;b.canMove(a)&&d?Utils.addEvent(a,"mousedown touchstart",function(d){d.originalEvent=d;b.runMove(d,a,function(a){a||c()});d.preventDefault();d.stopPropagation()}):Signature.options.verifyResType?Utils.addEvent(a,Signature.options.verifyResType,c):Utils.addEvent(a,"click",c)};
 Signature.prototype.signatureInfo=function(){var a=this;return a.showDialog("infoBtl",{target:a,onShow:function(){var b=this,c=b.find(".kg-tab");b.tab=Utils.tab(c);if(c=b.find("#verifysign_"+a.signatureid)[0])c.onclick=function(){a.verifySignData(function(b){b.result?Signature.alert(kinggrid.msg("normal_signdata","KG_MSG")):b.errcode?a.error(b):Signature.alert(kinggrid.msg("modify_signdata","KG_MSG"))})};if(c=b.find("#sign_"+a.signatureid)[0])c.onclick=function(){a.signSignature(function(a){a.result&&
 (Signature.alert(kinggrid.msg("success_signdata","KG_MSG")),b.remove())})};if(null==a.icon_remove||1==a.icon_remove)b.find("#revoke_"+a.signatureid)[0].onclick=function(){a.revokeSignature(function(a){a.result&&b.remove()})}}})};
 Signature.prototype.handWriteDlg=function(a,b){var c=0,d=0,e=0,f=!1,g=Number(a.image_width)||8,h=Number(a.image_height)||8,m=a.canvas_width,p=a.canvas_height;c=Math.max(parseInt(a.canvas_width),300)-30;d=parseInt(a.canvas_height);this.fontFamily=plus.fontFamily;Utils.extend(a,{title:kinggrid.msg("HWSignature","KG_TITLE"),target:this});var l=this.showDialog("handwritedlg",a),r=l.find("#canvasId")[0];c<screen.availWidth&&540<screen.availWidth?(r.width=c,r.height=d):screen.availWidth>screen.availHeight?
 700<screen.availWidth?(r.width=c=670,d=r.height=.9*(screen.availHeight-210),a.noCutting&&(f=!0,r.height=d=a.canvas_height,r.width=c=screen.availWidth-30)):(r.width=.95*screen.availWidth,d=r.height=.9*(screen.availHeight-210)):a.noCutting&&a.canvas_width&&a.canvas_height&&a.canvas_width<screen.availWidth?(r.width=c=a.canvas_width,r.height=d=a.canvas_height):(a.noCutting&&(f=!0,r.height=d=a.canvas_height),c=r.width=.83*(screen.availWidth-190)+190);a.dlg=l;a.canvas_height=r.height;a.canvas_width=r.width;
 a.hideToolBar&&(a.canvas_height+=$(".kg-hw-content").height(),Signature.hideToolBar=a.hideToolBar);var q=l.find(".kg-hw-text-span").css({height:r.height,width:r.width}),t=l.find(".kg-hw-text-edit").css({height:r.height,width:r.width}),x;l.find(".kg-hw-content").width(c);$(".kg-dialog-info").width("auto");l.find("#hw_width").val(a.lineSize||5);l[0].reset();a.toolBarHeight=$(".kg-hw-content").height();var v=new SignaturePad(r,a);if(a.fontColor)if(0==a.fontColor.indexOf("#"))l.find("#hw_color").val(a.fontColor),
 v.setColor(a.fontColor),q.css({color:a.fontColor}),t.css({color:a.fontColor});else for(c=["black","red","blue","green"],d=0;4>d;d++)if(c[d]==a.fontColor){l.find("#hw_color").val(a.fontColor);v.setColor(a.fontColor);q.css({color:a.fontColor});t.css({color:a.fontColor});break}a.buttonText&&l.find("#okid").html(a.buttonText);a.hideToolBar&&l.find(".kg-hw-content").css("display","none");l.find("#hw_color").change(function(){var a=l.find("#hw_color").val();v.setColor(a);q.css({color:a});t.css({color:a})});
 l.find("#hw_width").change(function(){var a=l.find("#hw_width").val();v.setSize(a)});l.find("#hw_model").change(function(a){"0"==a.target.value?(e=0,l.find(".kg-hw-written").css({display:"none"}),l.find(".kg-hw-handwrite").css({display:"block"}),v.setWebHandWrite(x,{fontStyle:"normal",fontSize:q.css("font-size"),fontFamily:q.css("font-family"),fontColor:q.css("color")}),x=[],q.html(""),t.val("")):"1"==a.target.value&&(e=1,l.find(".kg-hw-handwrite").css({display:"none"}),l.find(".kg-hw-written").css({display:"block"}))});
 t.keyup(function(a){a=Utils.convertText(this.value);parseFloat(t.css("line-height"))*a.split("<br>").length>parseFloat(t.css("height"))?console.warn("\u6587\u5b57\u8d85\u8fc7\u9650\u5236"):q.html(a);x=Utils.handleEdittable(q,a)});l.find("#hw_fontFamily").change(function(a){q.css({"font-family":this.value});t.css({"font-family":this.value})});l.find("#hw_fontSize").change(function(a){q.css({"font-size":this.value+"px","line-height":6+1.2*this.value+"px"});t.css({"font-size":this.value+"px","line-height":6+
 1.2*this.value+"px"});x=Utils.handleEdittable(q,q.html())});c=l.find("#clearid");d=l.find("#okid");c&&c.click(function(){x=[];q.html("");t.val("");v.clear()});d&&d.click(function(){l.close();Signature.hideToolBar=null;v.setWebHandWrite(x,{fontStyle:"normal",fontSize:q.css("font-size"),fontFamily:q.css("font-family"),fontColor:q.css("color")});v.toDataURL(function(c){var d=a.canvas_height/a.canvas_width;var e=c.imageData;var q=function(a){return parseFloat(a.width)>parseFloat(a.height)};if(f){var r=
 new Image;r.onload=function(){var d=document.createElement("canvas");d.width=2*m;d.height=2*p;d.getContext("2d").drawImage(r,0,0,r.width,r.height);d=d.toDataURL();c.imageData=d.replace(/^data:image\/\w+;base64,/,"");c.name=a.name||l.find("#nameid").val();c.width=Utils.pxConversionMm(m/10);c.height=Utils.pxConversionMm(p/10);b(c);l.remove()};r.src=e}else c.imageData=c.imageData.replace(/^data:image\/\w+;base64,/,""),c.name=a.name||l.find("#nameid").val(),c.height=Utils.pxConversionMm(c.height)/a.canvas_height,
 c.width=Utils.pxConversionMm(c.width)/a.canvas_width,a.noCutting?(c.width=Utils.pxConversionMm(a.canvas_width/10),c.height=Utils.pxConversionMm(a.canvas_height/10)):(c.height=Utils.pxConversionMm(c.height)/a.canvas_height,c.width=Utils.pxConversionMm(c.width)/a.canvas_width,q(c)?(e=g/c.width,c.width=g,c.height=c.height*e*d):(e=h/c.height,c.height=h,c.width=c.width*e/d)),b(c),l.remove()},{mode:e,noCutting:a.noCutting,display_width:2*a.canvas_width,display_height:2*a.canvas_height})})};
 Signature.prototype.barCodeDlg=function(a,b){var c={title:$.kgi18n.prop("OtherInfoQrCode"),target:this,onCancel:!1},d=this.showDialog("barcodedlg",c);c=d.find("#bc_clearid");var e=d.find("#bc_okid"),f=d.find("#bcId");c&&c.click(function(){f.val("")});e&&e.click(function(){d.close();var c=d.find("#output").qrcode(f.val());c={height:a.image_height||"5",width:a.image_width||"5",imageData:c,name:$.kgi18n.prop("OtherInfoQrCode")};b(c)})};
 Signature.prototype.scanStampDlg=function(a,b){if(!Signature.options.clientConfig){var c=this,d={title:kinggrid.msg("scanBCSignature","KG_TITLE"),target:c,onCancel:!1};Signature.ScanStamp.call(c,function(){return c.showDialog("scanStampdlg",d)},function(a){b(a)},a.type).getQrCodeImageByStamp()}};
 Signature.prototype.scanBCDlg=function(a,b){var c={title:kinggrid.msg("scanBCSignature","KG_TITLE"),target:this,onCancel:!1},d=this.showDialog("scanbarcodedlg",c);try{var e=document.getElementById("qr-canvas").getContext("2d"),f=document.getElementById("html5_qrcode_video");c={video:!0,audio:!1};window.navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL||
 window.oURL;window.navigator.getUserMedia&&window.navigator.getUserMedia(c,function(a){f.src=window.URL.createObjectURL(a);f.play()},function(a){alert("\u51fa\u9519\u4fe1\u606f: "+a.name)});var g=setInterval(function(){if(e){e.drawImage(f,0,0,640,480);var c=e.getImageData(0,0,640,480);if(c=jsQR.decodeQRFromImage(c.data,c.width,c.height))d.close(),window.clearInterval(g),a.content=c,c={height:a.image_height||"5",width:a.image_width||"5",imageData:$("#output").qrcode(c),name:$.kgi18n.prop("OtherInfoQrCode")},
 b(c)}},2E3)}catch(h){printHtml("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 CANVAS")}};function getsec(a){var b=1*a.substring(1,a.length);a=a.substring(0,1);if("s"==a)return 1E3*b;if("h"==a)return 36E5*b;if("d"==a)return 864E5*b}plus=kingPlus();Utils.extend(plus.alertConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});Utils.extend(plus.loadingConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});Utils.extend(plus.dialogConfig,{cancelDisplay:!1,quickClose:!0});
 getsec=function(a){var b=1*a.substring(1,a.length);a=a.substring(0,1);if("s"==a)return 1E3*b;if("h"==a)return 36E5*b;if("d"==a)return 864E5*b};
 var setCookie=function(a,b,c){var d=getsec(c);c=new Date;c.setTime(c.getTime()+1*d);b=escape(b);(new RegExp(/[0-9A-Za-z]/)).test(b)&&(document.cookie=a+"="+b+";expires="+c.toGMTString())},getCookie=function(a){var b;return(b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(b[2]):null},delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1);var c=getCookie(a);null!=c&&(document.cookie=a+"="+c+";expires="+b.toGMTString())};
 Signature.prototype.onshowSealsDialog_PW=function(a){var b=this,c;b.sealService.getKeysn({},function(d){b.keysn=c=d;"true"==getCookie("ck")&&a.find("#kg-remenberPwd").attr("checked","checked");if(a.find("#kg-remenberPwd").is(":checked")&&(d=getCookie("ksn"),c==d)){d=a.find("#kg-password");var e=getCookie("pwd");Signature.options.pw_enc_save&&(e=Utils.Base64.of().decode(e));null!=e?d.val(e):d.val("123")}})};
 Signature.prototype.onexecSuccess=function(a,b,c){var d=this,e;d.sealService.getKeysn({},function(a){d.keysn=e=a;if(c){var f=getCookie("ksn");a=Signature.options.pw_timeout;var h=function(a){if(e!=f){if("undefined"==typeof a||0>a.indexOf("s")&&0>a.indexOf("h")&&0>a.indexOf("d"))a="s1800";Signature.options.pw_enc_save&&(b=Utils.Base64.of().encode(b));setCookie("ksn",e,a);setCookie("pwd",b,a);setCookie("ck","true",a)}};Signature.options.pw_server_timeout?d.sealService.getPwdSaveTime(h,a):h(a)}else!Signature.options.pwd_clear_flag&&
 Signature.options.remberPwdAndShowSealsDlg&&(delCookie("ksn"),delCookie("pwd"),delCookie("ck"))})};Signature.prototype.ongetRPW=function(a){if(getCookie("ksn")==a)return a=getCookie("pwd"),Signature.options.pw_enc_save&&(a=Utils.Base64.of().decode(a)),a};Signature.prototype.onDeleteRPW=function(){delCookie("ksn");delCookie("pwd");delCookie("ck")};
 var SignaturePad=function(a){function b(b,c,f){function d(a){0>a.type.indexOf("mouse")&&(t=!0);return a}function e(a){a=d(a||window.event);if((a.stopPropagation(),"mousedown"!=a.type&&"touchstart"!=a.type)||$(a.target)[0].id!=n.canvasName||t&&1<a.touches.length)return 0;if(1===a.which||t&&1==a.touches.length)q=!0,"svg"!=n.writeType&&(D.fillStyle=G,D.globalAlpha=E),C=a=T(t?a.touches[0]:a),w.unshift({time:(new Date).getTime(),dis:0,x:a.x,y:a.y}),L&&(B={top:a.y,right:a.x,bottom:a.y,left:a.x},L=!1),a=
 w,p(a),m(a);"function"==typeof n.touchstartCallback&&n.touchstartCallback()}function m(a){if(!(1>=a.length)){var b,c,d,e,f,g,h,l,O;2>=a.length?(b=a[1].x,e=a[1].y,d=a[1].x+.5*(a[0].x-a[1].x),g=a[1].y+.5*(a[0].y-a[1].y),c=b+.5*(d-b),f=e+.5*(g-e),h=a[1].r,O=a[1].r+.5*(a[0].r-a[1].r)):(b=a[2].x+.5*(a[1].x-a[2].x),e=a[2].y+.5*(a[1].y-a[2].y),c=a[1].x,f=a[1].y,d=c+.5*(a[0].x-c),g=f+.5*(a[0].y-f),h=a[2].r+.5*(a[1].r-a[2].r),l=a[1].r,O=l+.5*(a[0].r-l));var m=[];for(a=0;5>a;a++){var p=a/4;l=(1-p)*(1-p)*b+
 2*p*(1-p)*c+p*p*d;p=(1-p)*(1-p)*e+2*p*(1-p)*f+p*p*g;var q=h+(O-h)/5*a;if(m.push({x:l,y:p,r:q}),3==m.length){var u=m[0].x;var r=m[0].y;var R=m[0].r;var v=m[1].x,t=m[1].y,A=m[2].x,B=m[2].y;var w=m[2].r;m=[];var x=v-u;var z=t-r;var y=2*Math.sqrt(x*x+z*z+1E-4);x=x/y*R;var C=z=z/y*R;var E=-x;var F=v-A;R=t-B;y=2*Math.sqrt(F*F+R*R+1E-4);F=F/y*w;R=R/y*w;w=-R;y=F;m.push({mx:u+C,my:r+E,color:"#1A1A1A"});m.push({c1x:v+C,c1y:t+E,c2x:v+w,c2y:t+y,ex:A+w,ey:B+y});m.push({c1x:A+w-F,c1y:B+y-R,c2x:A-w-F,c2y:B-y-R,
 ex:A-w,ey:B-y});m.push({c1x:v-w,c1y:t-y,c2x:v-C,c2y:t-E,ex:u-C,ey:r-E});m.push({c1x:u-C-x,c1y:r-E-z,c2x:u+C-x,c2y:r+E-z,ex:u+C,ey:r+E});m[0].mx=m[0].mx.toFixed(1);m[0].mx=parseFloat(m[0].mx);m[0].my=m[0].my.toFixed(1);m[0].my=parseFloat(m[0].my);for(u=1;u<m.length;u++)m[u].c1x=m[u].c1x.toFixed(1),m[u].c1x=parseFloat(m[u].c1x),m[u].c1y=m[u].c1y.toFixed(1),m[u].c1y=parseFloat(m[u].c1y),m[u].c2x=m[u].c2x.toFixed(1),m[u].c2x=parseFloat(m[u].c2x),m[u].c2y=m[u].c2y.toFixed(1),m[u].c2y=parseFloat(m[u].c2y),
 m[u].ex=m[u].ex.toFixed(1),m[u].ex=parseFloat(m[u].ex),m[u].ey=m[u].ey.toFixed(1),m[u].ey=parseFloat(m[u].ey);u=m;u[0].color=G;n.bethelPoint.push(u);r=void 0;if("svg"==n.writeType){void 0===r&&(r=u[0].color);v="M "+u[0].mx+" "+u[0].my+" C";for(t=1;t<u.length;t++)v+=" "+u[t].c1x+" "+u[t].c1y,v+=" "+u[t].c2x+" "+u[t].c2y,v+=" "+u[t].ex+" "+u[t].ey;J.path(v).attr("stroke",r).attr("stroke-width",1).attr("fill",r)}else{D.beginPath();D.moveTo(u[0].mx,u[0].my);void 0!=r?(D.fillStyle=r,D.strokeStyle=r):(D.fillStyle=
 u[0].color,D.strokeStyle=u[0].color);for(r=1;r<u.length;r++)D.bezierCurveTo(u[r].c1x,u[r].c1y,u[r].c2x,u[r].c2y,u[r].ex,u[r].ey);D.stroke();D.fill()}m=[{x:l,y:p,r:q}]}}}}function p(a){if(1>=a.length)return void(a[0].r=1);for(var b=(n.distance({x:a[0].x,y:a[0].y},{x:a[1].x,y:a[1].y}),0),c=0,d=0;d<a.length-1&&(b+=a[d].dis,c+=a[d].time-a[d+1].time,!(b>z));d++);a[0].r=Math.min(c/(1*b)*n.pressure+n.lineMin,n.lineMax)*K}function l(a){return a=a.toFixed(4),parseFloat(a)}function r(a){if(/^(rgb|RGB)/.test(a)){for(var b=
 a.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),c="#",d=0;d<b.length;d++){var e=Number(b[d]).toString(16);2>e.length&&(e="0"+e);c+=e}return 7!==c.length&&(c=a),c}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)){b=a.replace(/#/,"").split("");if(6===b.length)return a;if(3===b.length)for(a="#",d=0;d<b.length;d+=1)a+=b[d]+b[d]}return a}var q=!1,t;this.writeType="canvas";this.canvasName=b;this.lineMin=.5;this.lineMax=2;this.pressure=1;this.linePrack=[];this.chirography=[];this.currentChirography={};this.transformpdfData=
 [];this.canvasHeight=this.canvasWidth=0;this.currentBethelLinePoint=[];this.bethelPoint=[];var x=null,v=null,D=null,J=null,E=1,G="#1A1A1A",K=1.5,z=100,y=0,C={},w=[],F=2,A=2,L=!0,B={top:0,right:0,bottom:0,left:0},n=this;this.clearCanvasCallback=this.touchendCallback=this.touchmoveCallback=this.touchstartCallback="";this.init=function(a,b,d,f){n.writeType="canvas";n.canvas=c.dlg.find("#"+n.canvasName)[0];D=n.canvas.getContext("2d");D.rotate(45*Math.PI/180);D.fillStyle="rgba(0,0,0,1)";var g=n.canvas;
 void 0==a&&(a=720);void 0==b&&(b=1280);void 0==d&&(d=720);void 0==f&&(f=1280);F=d/a;A=f/b;$(g).width(a);$(g).attr("width",d);$(g).height(b);$(g).attr("height",f);n.canvasWidth=d;n.canvasHeight=f;c.dlg.find("#"+n.canvasName)[0].addEventListener("mousedown",e,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("mousemove",M,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("mouseup",P,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("mouseout",P,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchstart",
 e,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchmove",M,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchend",P,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchcancel",I,!1)};this.initSVG=function(b,d,f,g){n.writeType="svg";void 0==b&&(b=720);void 0==d&&(d=1280);void 0==f&&(f=720);void 0==g&&(g=1280);F=f/b;A=g/d;n.canvas=a.getElementById(n.canvasName);J=new Snap(n.canvas);J.attr({width:b,height:d,viewBox:"0, 0, "+f+", "+g});c.dlg.find("#"+n.canvasName)[0].addEventListener("mousedown",
 e,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("mousemove",M,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("mouseup",P,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("mouseout",P,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchstart",e,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchmove",M,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchend",P,!1);c.dlg.find("#"+n.canvasName)[0].addEventListener("touchcancel",I,!1)};this.newCanvas=function(b,
 c,d,e,f){var g=this.canvas,h=$(g)[0].id;h=a.getElementById(h).getContext("2d");var l=h.getImageData(0,0,g.width,g.height);void 0==b&&(b=720);void 0==c&&(c=1280);void 0==d&&(d=720);void 0==e&&(e=1280);F=d/b;A=e/c;$(g).width(b);$(g).attr("width",d);$(g).height(c);$(g).attr("height",e);n.canvasWidth=d;n.canvasHeight=e;b=parseInt(g.width*(1-1/f));g.height;console.log(b);h.putImageData(l,parseInt(b),0)};this.setCanvasSize=function(a,b,c,d,e,f){void 0==a&&(a=this.width);void 0==b&&(b=this.height);void 0==
 innerWidth&&(innerWidth=this.innverWidth);void 0==innerHeight&&(innerHeight=this.innerheight);c=D.getImageData(0,0,this.innerWidth,this.innerHeight);F=innerWidth/a;A=innerHeight/b;$(this.canvas).width(a);$(this.canvas).attr("width",innerWidth);$(this.canvas).height(b);$(this.canvas).attr("height",innerHeight);this.canvasWidth=innerWidth;this.canvasHeight=innerHeight;D.putImageData(c,0,0)};this.setLineColor=function(a){G=a};this.setLineSize=function(a){K=a};this.setSmoothness=function(a){z=a};this.setLineMin=
 function(a){this.lineMin=a};this.setLineMax=function(a){this.lineMax=a};this.showAllSign=function(b){var c=$(this.canvas)[0].id;c=a.getElementById(c);var d=c.getContext("2d");b=parseFloat(1/b);d.scale(b,b);b=new Image;return b.src=c.toDataURL("image/png"),b};var M=function(a){a=a||window.event;if((n.touchmoveCallback&&n.touchmoveCallback(),"mousemove"!=a.type&&"touchmove"!=a.type)||$(a.target)[0].id!=n.canvasName)return 0;if(t&&1<a.touches.length)return a.stopPropagation(),a.preventDefault(),a.cancelable&&
 (a.defaultPrevented||a.preventDefault()),0;if(q||t&&1==a.touches.length)a.cancelable&&(a.defaultPrevented||a.preventDefault()),a=T(t?a.touches[0]:a),a.y<B.top&&(B.top=a.y),0>a.y&&(B.top=0),a.x>B.right&&(B.right=a.x),0>=n.canvasWidth-a.x&&(B.right=n.canvasWidth),a.y>B.bottom&&(B.bottom=a.y),0>=n.canvasHeight-a.y&&(B.bottom=n.canvasHeight),a.x<B.left&&(B.left=a.x),0>a.x&&(B.left=0),y=C,C=a,w.unshift({time:(new Date).getTime(),dis:n.distance(C,y),x:a.x,y:a.y}),a=w,p(a),m(a);"function"==typeof n.touchmoveCallback&&
 n.touchmoveCallback()},P=function(a){a=d(a||window.event);if((a.stopPropagation(),"mouseup"!=a.type&&"touchend"!=a.type)||$(a.target)[0].id!=n.canvasName)return 0;if(1===a.which&&q||t&&!(1<a.touches.length)){q=!1;a=T(t?a.changedTouches[0]:a);if(y=C,C=a,w.unshift({time:(new Date).getTime(),dis:n.distance(C,y),x:a.x,y:a.y}),2<w.length)w[0].time,w[w.length-1].time,w.length;"canvas"==n.writeType?(a=w,p(a),m(a),n.chirography.unshift({lineSize:K,lineColor:G}),n.linePrack.unshift(w)):n.overlapInCanvas(w);
 w=[];"function"==typeof n.touchendCallback&&n.touchendCallback()}},I=function(a){a=d(a||window.event);a.type},T=function(b){if(null==x||null==n.offsetTop)if("svg"==n.writeType)x=$(n.canvas).offset().left,v=$(n.canvas).offset().top;else{var d=0;x=n.canvas.offsetLeft;v=n.canvas.offsetTop;for(var e=n.canvas.parentNode;100>d&&e.tagName&&"BODY"!=e.tagName;)x+=e.offsetLeft,v+=e.offsetTop,e=e.parentNode,d++}d=b.clientX-x;b=b.clientY-v+100+c.toolBarHeight;c.hideToolBar&&(b-=c.toolBarHeight);window!=top&&
 root.iframeDialog&&(b+=$(window.top.document).find(".kg-hw-content").height());c.isMobile&&(b+=a.body.scrollTop||a.documentElement.scrollTop);d*=F;b*=A;return{x:d,y:b}};this.distance=function(a,b){var c=b.x-a.x;a=b.y-a.y;return Math.sqrt(c*c+a*a)};this.reWriteCanvas=function(){D.restore()};this.writeCanvas=function(){n.clearCanvas();for(var a=0;a<n.linePrack.length;a++){var b=n.linePrack[n.linePrack.length-a-1],c=[];D.fillStyle=n.chirography[n.chirography.length-a-1].lineColor;K=n.chirography[n.chirography.length-
 a-1].lineSize;G=n.chirography[n.chirography.length-a-1].lineColor;for(var d=0;d<b.length;d++){c.unshift(b[b.length-d-1]);var e=c;p(e);m(e)}}return!0};this.clearCanvas=function(){"function"==typeof n.clearCanvasCallback&&n.clearCanvasCallback();D&&D.clearRect(0,0,n.canvas.width,n.canvas.height);J&&J.clear()};this.clearCanvasAndData=function(){n.clearCanvas();n.linePrack=[];n.chirography=[];n.bethelPoint=[];L=!0};this.overlapInCanvas=function(a){a=a[0];for(var b=0;b<n.linePrack.length;b++)for(var c=
 n.linePrack[b],d=0;d<c.length;d++)if(400>(a.x-c[d].x)*(a.x-c[d].x)+(a.y-c[d].y)*(a.y-c[d].y)){n.linePrack.splice(b,1);n.chirography.splice(b,1);n.writeCanvas();break}};this.overlapLine=function(a,b,c,d){D.isPointInPath(20,50)};this.saveImage=function(){return this.canvas.toDataURL.apply(this.canvas,arguments)};this.coordinateSystem=function(a,b){return{x:a,y:b}};this.transformpdf=function(){for(var a=this.linePrack,b=0;b<a.length;b++){var c=a[b];if(!(2>c.length)){var d,e=c.length;var f=1*c[e-1].x+
 .1;var g=1*c[e-1].y;var h=c[e-1].r;var l=1*c[e-2].x+.1;var m=1*c[e-2].y;var p=c[e-2].r;var r=l-f;var q=m-g;var u=2*Math.sqrt(r*r+q*q+1E-4);r=r/u*h;var t=q=q/u*h;var v=-r;var w=[];for(d=3;d<=c.length;d++){var D=1*c[e-d].x;var A=1*c[e-d].y;var B=c[e-d].r;h=(l+D)/2;var x=(m+A)/2;p=(p+B)/2;var y=l-h;var z=m-x;u=2*Math.sqrt(y*y+z*z+1E-4);y=y/u*p;z=z/u*p;u=-z;var C=y;w[0]=n.coordinateSystem(f+t,g+v);w[1]=n.coordinateSystem(l+t,m+v);w[2]=n.coordinateSystem(l+u,m+C);w[3]=n.coordinateSystem(h+u,x+C);w[4]=
 n.coordinateSystem(h+u-y,x+C-z);w[5]=n.coordinateSystem(h-u-y,x-C-z);w[6]=n.coordinateSystem(h-u,x-C);w[7]=n.coordinateSystem(l-u,m-C);w[8]=n.coordinateSystem(l-t,m-v);w[9]=n.coordinateSystem(f-t,g-v);w[10]=n.coordinateSystem(f-t-r,g-v-q);w[11]=n.coordinateSystem(f+t-r,g+v-q);w[12]=n.coordinateSystem(f+t,g+v);f=h;g=x;l=D;m=A;p=B;r=-y;q=-z;t=u;v=C;n.transformpdfData.push(w)}h=1*c[0].x;x=1*c[0].y;y=l-h;z=m-x;w[0]=n.coordinateSystem(f+t,g+v);w[0]=n.coordinateSystem(f+t,g+v)}}};this.getExtrema=function(){B=
 {top:this.canvasHeight*A,right:0,bottom:0,left:this.canvasWidth*F};for(var a=0;a<this.linePrack.length;a++)for(var b=0;b<this.linePrack[a].length;b++)this.linePrack[a][b].y<B.top&&(B.top=this.linePrack[a][b].y),this.linePrack[a][b].y>B.bottom&&(B.bottom=this.linePrack[a][b].y),this.linePrack[a][b].x>B.right&&(B.right=this.linePrack[a][b].x),this.linePrack[a][b].x<B.left&&(B.left=this.linePrack[a][b].x)};var N=function(a,b,c,d,e){return{x:a*Math.cos(c)-b*Math.sin(c)+d,y:a*Math.sin(c)+b*Math.cos(c)+
 e}};this.calcRotateCanvasInfo=function(){for(var a,b,c,d,e=[],f=[],g=B.bottom-B.top+60,h=B.right-B.left+60,m=0;m<this.linePrack.length;m++){e[m]=[];f[m]={lineSize:this.chirography[m].lineSize,lineColor:this.chirography[m].lineColor};for(var n=0;n<this.linePrack[m].length;n++)a=this.linePrack[m][n].x-B.left+30,b=this.linePrack[m][n].y-B.top+30,c=-Math.PI/2,d=B.right-B.left+60,a=N(a,b,c,0,d),e[m][n]={x:l(a.x),y:l(a.y),dis:this.linePrack[m][n].dis,time:this.linePrack[m][n].time,r:this.linePrack[m][n].r}}return{canvasWidth:g/
 F,canvasHeight:h/A,canvasInnerWidth:g,canvasInnerHeight:h,linePrack:e,chirography:f,bethelPoint:this.bethelPoint}};this.destory=function(){};this.centreRotate=function(a){for(var b,c=-(Math.min(n.canvasWidth*Math.cos(a),0)+Math.min(n.canvasHeight*Math.cos(a+Math.PI/2),0)),d=-(Math.min(n.canvasWidth*Math.sin(a),0)+Math.min(n.canvasHeight*Math.sin(a+Math.PI/2),0)),e=0;e<n.bethelPoint.length;e++){b=N(n.bethelPoint[e][0].mx,n.bethelPoint[e][0].my,a,c,d);n.bethelPoint[e][0].mx=b.x;n.bethelPoint[e][0].my=
 b.y;for(var f=1;f<n.bethelPoint[e].length;f++)b=N(n.bethelPoint[e][f].c1x,n.bethelPoint[e][f].c1y,a,c,d),n.bethelPoint[e][f].c1x=b.x,n.bethelPoint[e][f].c1y=b.y,b=N(n.bethelPoint[e][f].c2x,n.bethelPoint[e][f].c2y,a,c,d),n.bethelPoint[e][f].c2x=b.x,n.bethelPoint[e][f].c2y=b.y,b=N(n.bethelPoint[e][f].ex,n.bethelPoint[e][f].ey,a,c,d),n.bethelPoint[e][f].ex=b.x,n.bethelPoint[e][f].ey=b.y}b=Math.abs(n.canvasWidth*Math.sin(a))+Math.abs(n.canvasHeight*Math.sin(a+Math.PI/2));n.canvasWidth=Math.abs(n.canvasWidth*
 Math.cos(a))+Math.abs(n.canvasHeight*Math.cos(a+Math.PI/2));n.canvasHeight=b};this.toSVG=function(a){a=a?new Snap(a):new Snap;for(var b=0;b<this.bethelPoint.length;b++){for(var c="M "+l(this.bethelPoint[b][0].mx/this.canvasHeight)+" "+l(this.bethelPoint[b][0].my/this.canvasHeight)+" C",d=1;d<this.bethelPoint[b].length;d++)c+=" "+l(this.bethelPoint[b][d].c1x/this.canvasHeight)+" "+l(this.bethelPoint[b][d].c1y/this.canvasHeight),c+=" "+l(this.bethelPoint[b][d].c2x/this.canvasHeight)+" "+l(this.bethelPoint[b][d].c2y/
 this.canvasHeight),c+=" "+l(this.bethelPoint[b][d].ex/this.canvasHeight)+" "+l(this.bethelPoint[b][d].ey/this.canvasHeight);a.path(c).attr("stroke",this.bethelPoint[b][0].color).attr("stroke-width",1/this.canvasHeight).attr("fill",this.bethelPoint[b][0].color)}b="0 0 "+l(this.canvasWidth/this.canvasHeight)+" 1";return a.attr("viewBox",b),a.attr("width",l(this.canvasWidth/this.canvasHeight)+"px"),a.attr("height","1px"),a.outerSVG()};this.toCommonSVG=function(a){a=a?new Snap(a):new Snap;for(var b=0;b<
 n.bethelPoint.length;b++){for(var c="M "+l(n.bethelPoint[b][0].mx)+" "+l(n.bethelPoint[b][0].my)+" C",d=1;d<n.bethelPoint[b].length;d++)c+=" "+l(n.bethelPoint[b][d].c1x)+" "+l(n.bethelPoint[b][d].c1y),c+=" "+l(n.bethelPoint[b][d].c2x)+" "+l(n.bethelPoint[b][d].c2y),c+=" "+l(n.bethelPoint[b][d].ex)+" "+l(n.bethelPoint[b][d].ey);a.path(c).attr("stroke",n.bethelPoint[b][0].color).attr("stroke-width",1).attr("fill",n.bethelPoint[b][0].color)}return a.attr("viewBox","0 0 "+n.canvasWidth+" "+n.canvasHeight),
 a.attr("width",n.canvasWidth+"px"),a.attr("height",n.canvasHeight+"px"),a.outerSVG()};this.pathToSVG=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=$("body").width(),d=$("body").height();if(1==b){b="svg"+Math.floor(1E4*Math.random());var e=$("<svg id="+b+"></svg>");e.css("position","fixed");$("body").prepend(e);b=new Snap("#"+b);b.attr("width",c+"px");b.attr("height",d+"px");for(e=0;e<a.length;e++){for(var f="M "+l(a[e][0].mx*c)+" "+l((1-a[e][0].my)*d)+" C",g=1;g<a[e].length;g++)f+=
 " "+l(a[e][g].c1x*c)+" "+l((1-a[e][g].c1y)*d),f+=" "+l(a[e][g].c2x*c)+" "+l((1-a[e][g].c2y)*d),f+=" "+l(a[e][g].ex*c)+" "+l((1-a[e][g].ey)*d);b.path(f).attr("stroke",a[e][0].color).attr("stroke-width",1).attr("fill","none")}}else Object.keys(a).forEach(function(b){b=a[b];for(var e=0;e<b.length;e++){var f="svg"+e+Math.floor(1E4*Math.random()),g=$("<svg id="+f+"></svg>");g.css("position","fixed");$("body").prepend(g);f="#"+f;f=new Snap(f);f.attr("width",c+"px");f.attr("height",d+"px");for(g=0;g<b[e].length;g++){for(var h=
 "M "+b[e][g][0].mx*c+" "+(1-b[e][g][0].my)*d+" C",l=1;l<b[e][g].length;l++)h+=" "+b[e][g][l].c1x*c+" "+(1-b[e][g][l].c1y)*d,h+=" "+b[e][g][l].c2x*c+" "+(1-b[e][g][l].c2y)*d,h+=" "+b[e][g][l].ex*c+" "+(1-b[e][g][l].ey)*d;f.path(h).attr("stroke",b[e][g][0].color).attr("stroke-width",1).attr("fill",b[e][g][0].color)}}})};this.SVGToPath=function(a,b,c,d,e,f,g,h,m,n){if(void 0===a||void 0===b||void 0===c||void 0===d||void 0===e||void 0===f||void 0===g)return void console.log("\u53c2\u6570\u7f3a\u5931");
 b=new Snap(b);var p=[];if(void 0===h||void 0===m||void 0===n){var q=parseFloat(b.attr("height"));h=parseFloat(b.getBBox().width);m=parseFloat(b.getBBox().height);n=q/m}var t="";return b.selectAll("path").forEach(function(a){for(var b,c=a.attr("d").split(" "),h=[],m=0;m<c.length;m++)b=c[m].split(","),2==b.length?(h.push(b[0]),h.push(b[1])):h.push(b[0]);b=[];for(m=0;m<h.length;m++){c=h[m];if(isNaN(parseInt(c.slice(0,1)))){if(t=c.slice(0,1),1==h[m].length&&"Z"!=t)continue;c=c.slice(1)}switch(t){case "M":var q=
 h[m+1];m++;var u=a.attr("stroke");u="none"==u?"#000000":r(u);console.log(l(1-(parseFloat(q)*n+g)/e));b.push({mx:l(parseFloat(c)*n/d+f/d),my:l(1-(parseFloat(q)*n+g)/e),color:u});break;case "Q":b.push({c1x:l(parseFloat(c)*n/d+f/d),c1y:l(1-(parseFloat(h[m+1])*n+g)/e),c2x:l(parseFloat(c)*n/d+f/d),c2y:l(1-(parseFloat(h[m+1])*n+g)/e),ex:l(parseFloat(h[m+2])*n/d+f/d),ey:l(1-(parseFloat(h[m+3])*n+g/e))});m+=3;break;case "C":b.push({c1x:l(parseFloat(c)*n/d+f/d),c1y:l(1-(parseFloat(h[m+1])*n+g)/e),c2x:l(parseFloat(h[m+
 2])*n/d+f/d),c2y:l(1-(parseFloat(h[m+3])*n+g)/e),ex:l(parseFloat(h[m+4])*n/d+f/d),ey:l(1-(parseFloat(h[m+5])*n+g)/e)});m+=5;break;case "L":b.push({c1x:l(parseFloat(c)*n/d+f/d),c1y:l(1-(parseFloat(h[m+1])*n+g)/e),c2x:l(parseFloat(c)*n/d+f/d),c2y:l(1-(parseFloat(h[m+1])*n+g)/e),ex:l(parseFloat(c)*n/d+f/d),ey:l(1-(parseFloat(h[m+1])*n+g)/e)});m++;break;case "Z":p.push(b),b=[]}}b.length&&p.push(b)}),void 0===a[c]&&(a[c]=[]),a[c].push(p),a};this.SVGToPathNoPage=function(a,b,c,d,e,f,g,h){if(void 0===a||
 void 0===b||void 0===c||void 0===d||void 0===e)return void console.log("\u53c2\u6570\u7f3a\u5931");a=new Snap(a);var m=[];if(void 0===f||void 0===g||void 0===h){var n=parseFloat(a.attr("height"));f=parseFloat(a.getBBox().width);g=parseFloat(a.getBBox().height);h=g/n}var p="";return a.selectAll("path").forEach(function(a){for(var f,g=a.attr("d").split(" "),n=[],q=0;q<g.length;q++)f=g[q].split(","),2==f.length?(n.push(f[0]),n.push(f[1])):n.push(f[0]);f=[];for(q=0;q<n.length;q++){g=n[q];if(isNaN(parseInt(g.slice(0,
 1)))){if(p=g.slice(0,1),1==n[q].length&&"Z"!=p)continue;g=g.slice(1)}switch(p){case "M":var t=n[q+1];q++;var v=a.attr("stroke");v="none"==v?"#000000":r(v);f.push({mx:l(parseFloat(g)*h/b+d/b),my:l(1-(parseFloat(t)*h+e)/c),color:v});break;case "Q":f.push({c1x:l(parseFloat(g)*h/b+d/b),c1y:l(1-(parseFloat(n[q+1])*h+e)/c),c2x:l(parseFloat(g)*h/b+d/b),c2y:l(1-(parseFloat(n[q+1])*h+e)/c),ex:l(parseFloat(n[q+2])*h/b+d/b),ey:l(1-(parseFloat(n[q+3])*h+e/c))});q+=3;break;case "C":f.push({c1x:l(parseFloat(g)*
 h/b+d/b),c1y:l(1-(parseFloat(n[q+1])*h+e)/c),c2x:l(parseFloat(n[q+2])*h/b+d/b),c2y:l(1-(parseFloat(n[q+3])*h+e)/c),ex:l(parseFloat(n[q+4])*h/b+d/b),ey:l(1-(parseFloat(n[q+5])*h+e)/c)});q+=5;break;case "L":f.push({c1x:l(parseFloat(g)*h/b+d/b),c1y:l(1-(parseFloat(n[q+1])*h+e)/c),c2x:l(parseFloat(g)*h/b+d/b),c2y:l(1-(parseFloat(n[q+1])*h+e)/c),ex:l(parseFloat(g)*h/b+d/b),ey:l(1-(parseFloat(n[q+1])*h+e)/c)});q++;break;case "Z":m.push(f),f=[]}}f.length&&m.push(f)}),m}}var c=function(a,c){this.times=2;
 this.canvas=a;this.isSign=!1;c.isMobile=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent);this.painting=new b("canvasId",c);this.initCanvas(c);this.painting.touchstartCallback=c.onBegin;this.painting.touchendCallback=c.onEnd;this.lineSize=c.lineSize||5;this.setSize(this.lineSize);this.lineMax=c.lineMax||4;this.painting.setLineMax(this.lineMax);this.lineMin=c.lineMin||.5;this.painting.setLineMin(this.lineMin);
 this.smoothness=c.smoothness||100;this.painting.setSmoothness(this.smoothness)};c.prototype.initCanvas=function(a){var b=a.canvas_width;a=a.canvas_height;this.painting.init(b,a,b*this.times,a*this.times);this.canvas.getContext("2d").fillStyle="rgba(0,0,0,0)"};c.prototype.setSize=function(a){this.painting.setLineSize(a)};c.prototype.setColor=function(a){this.painting.setLineColor(a)};c.prototype.clear=function(){this.isSign=!1;this.painting.clearCanvasAndData()};c.prototype.setWebHandWrite=function(a,
 b){var c=this.canvas.getContext("2d");c.textAlign="left";c.textBaseline="bottom";c.shadowBlur=0;c.font=b.fontStyle+" "+parseFloat(b.fontSize)*this.times+"px "+b.fontFamily;c.fillStyle=b.fontColor;for(b=0;a&&b<a.length;b++){var d=a[b];c.fillText(d.txt,d.left*this.times,d.top*this.times)}};c.prototype.toDataURL=function(b,c){for(var d=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height),e=d.data,h=d.width,m=0,p=d.height,l=0,r=0;r<this.canvas.width;r++)for(var q=0;q<d.height;q++){var t=
 4*(r+d.width*q);if(0<e[t]||0<e[t+1]||e[t+2]||0<e[t+3])l=Math.max(q,l),m=Math.max(r,m),p=Math.min(q,p),h=Math.min(r,h)}h++;m++;p++;l++;d=this.painting.saveImage();var x=new Image;x.src=d;x.onload=function(){var d=a.createElement("canvas");d.width=m-h;d.height=l-p;var e=d.getContext("2d");1==c.mode&&c.noCutting&&(d.width=c.display_width,d.height=c.display_height,p=h=0);0==c.mode&&c.noCutting&&(d.width=d.width>c.display_width?d.width:c.display_width,d.height=d.height>c.display_height?d.height:c.display_height,
 p=h=0);e.drawImage(x,h,p,d.width,d.height,0,0,d.width,d.height);e={};e.imageData=d.toDataURL();e.width=d.width;e.height=d.height;b(e)}};"use strict";return c}(document);
 // V3.0.0.540    
 export default Signature
 