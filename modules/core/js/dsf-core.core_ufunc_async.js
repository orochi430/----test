/*!
 * Name: @dsf/cli-core
 * Version: 5.17.0-alpha.5
 * Description: 核心模块
 * BuildTime: 2024/6/19 17:49:24
*/
(("undefined"!==typeof self?self:this)["webpackJsonpcore"]=("undefined"!==typeof self?self:this)["webpackJsonpcore"]||[]).push([[10],{308:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),_cache__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(62),UTILS={isDate:function(e){return e?e instanceof Date?isNaN(e.getTime())?"":e:"string"===typeof e?isNaN(new Date(e.replace(/-/g,"/")))?"":new Date(e.replace(/-/g,"/")):void 0:""}};function AVG(){for(var e=Array.prototype.slice.call(arguments),t=-1,r=-1,n=0;n<e.length;n++)"boolean"===typeof e[n]&&(t=n);t>-1&&(r=e.slice(t+1,t+2).length?e.slice(t+1,t+2)[0]:1,e=e.slice(0,t));var a=[];_.each(e,(function(e){dsf.isArray(e)?_.each(e,(function(e){a.push(e)})):a.push(e)}));var i=a.filter((function(e){return dsf.isNumber(e)}));a=i;var u=a.length,o=dsf.math.sum(a),s=r>-1?1*dsf.math.toFixed(Number(o/u),r):Number(o/u);return s}function SUM(){var e=Array.prototype.slice.call(arguments),t=[],r=0;return _.each(e,(function(e){dsf.isArray(e)?_.each(e,(function(e){t.push(e)})):t.push(e)})),_.each(t,(function(e){if(dsf.isNumber(e)){var t=dsf.math.add(r,parseFloat(e));r=t.toNumber()}})),r}function SUB(){var e,t=Array.prototype.slice.call(arguments),r=[];return _.each(t,(function(e){dsf.isArray(e)?_.each(e,(function(e){r.push(e)})):r.push(e)})),_.each(r,(function(t){if(dsf.isNumber(t)){if(void 0===e)return void(e=t);var r=dsf.math.sub(e,parseFloat(t));e=r.toNumber()}})),e}function MUL(){var e,t=Array.prototype.slice.call(arguments),r=[];return _.each(t,(function(e){dsf.isArray(e)?_.each(e,(function(e){r.push(e)})):r.push(e)})),_.each(r,(function(t){if(dsf.isNumber(t)){if(void 0===e)return void(e=t);var r=dsf.math.mul(e,parseFloat(t));e=r.toNumber()}})),e}function DIV(){var e,t=Array.prototype.slice.call(arguments),r=[];return _.each(t,(function(e){dsf.isArray(e)?_.each(e,(function(e){r.push(e)})):r.push(e)})),_.each(r,(function(t){if(dsf.isNumber(t)){if(void 0===e)return void(e=t);var r=dsf.math.div(e,parseFloat(t));e=r.toNumber()}})),e}function MIN(){var e=Array.prototype.slice.call(arguments),t=[];return _.each(e,(function(e){dsf.isArray(e)?_.each(e,(function(e){t.push(e)})):t.push(e)})),Math.min.apply(window,t)}function MAX(){var e=Array.prototype.slice.call(arguments),t=[];return _.each(e,(function(e){dsf.isArray(e)?_.each(e,(function(e){t.push(e)})):t.push(e)})),Math.max.apply(window,t)}function LOG(e,t){if(isNaN(Number(e))||isNaN(Number(t)))return"";var r=Math.log(e)/Math.log(t);return Math.abs(Math.round(r)-r)<=Math.pow(2,-51)?Math.round(r):r}function COUNTIF(){for(var args=Array.prototype.slice.call(arguments),func=args.pop(),sum=0,i=0;i<args.length;i++)/[>!=<==]/g.test(func)?eval(args[i]+func+"")&&(sum+=1):args[i]===func&&(sum+=1);return sum}function MOD(e,t){return e%t}function FIXED(e,t){return isNaN(Number(e))||isNaN(Number(t))?"":dsf.math.toFixed(Number(e),Number(t))}function NUMBER(e){if(dsf.isUnDef(e))return null;if(dsf.isArray(e)){var t=[];return _.each(e,(function(e){dsf.isNumber(e)&&t.push(parseFloat(e))})),t}return dsf.isNumber(e)?parseFloat(e):void 0}function FLOATCALCUATE(e){return e?String(e).split(".")[1]&&17===String(e).split(".")[1].length&&String(Number(e+1)).length<String(e).length?isNaN(Number(String(e).split(".")[0]+"."+String(Number(e+1)).split(".")[1]))?"":Number(String(e).split(".")[0]+"."+String(Number(e+1)).split(".")[1]):Number(e):""}function DATEDELTA(d,days,flag){var date=eval("(function(){return "+UTILS.isDate+" })()")(d);return date?1==flag?new Date(date.getTime()+24*days*3600*1e3):new Date(date.getTime()-24*days*3600*1e3):""}function DAYDT(d){var date=eval("(function(){return "+UTILS.isDate+" })()")(d);return date?date.getDate():""}function DA_YS(s,e){var sdate=eval("(function(){return "+UTILS.isDate+" })()")(s),edate=eval("(function(){return "+UTILS.isDate+" })()")(e);return sdate&&edate?(edate.getTime()-sdate.getTime())/864e5:""}function WEEKDAY(d,firstday,type){var date=eval("(function(){return "+UTILS.isDate+" })()")(d);return date?0===firstday?1===type?new Date(date.getTime()-24*(date.getDay()-1)*3600*1e3):new Date(date.getTime()+24*(7-date.getDay())*3600*1e3):1===type?new Date(date.getTime()-24*date.getDay()*3600*1e3):new Date(date.getTime()+24*(6-date.getDay())*3600*1e3):""}function FORMAT(d,fmt){var date=eval("(function(){return "+UTILS.isDate+" })()")(d);if(!date)return"";var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};for(var k in/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt}function END_OF_MONTH(d){var date=eval("(function(){return "+UTILS.isDate+" })()")(d);if(!date)return"";var new_year=date.getFullYear(),month=date.getMonth()+1,new_month=month++;month>12&&(new_month-=12,new_year++);var new_date=new Date(new_year,new_month,1);return new Date(new_date.getTime()-864e5)}function TIME_BELONG_HOUR(current,start,end){return current=eval("(function(){return "+UTILS.isDate+" })()")(current),start=eval("(function(){return "+UTILS.isDate+" })()")(start),end=eval("(function(){return "+UTILS.isDate+" })()")(end),current&&start&&end?current.getTime()>=start.getTime()&&current.getTime()<=end.getTime():""}function AND(){for(var e=Array.prototype.slice.call(arguments),t=0;t<e.length;t++)if(!e[t])return!1;return!0}function OR(){for(var e=Array.prototype.slice.call(arguments),t=0;t<e.length;t++)if(e[t])return!0;return!1}function IF(e,t,r){return e?t:r}function CONCATENATE(){for(var e=Array.prototype.slice.call(arguments),t="",r=0;r<e.length;r++)t+=e[r]?e[r]+"":"";return t}function DELETEWHITESPACE(e){return e?(e+="",e.replace(/\s+?/g,"")):""}function LEN(e){return e?(e+="",e.length+""):""}function LOWER(e){return e?(e+="",e.toLowerCase()):""}function UPPER(e){return e?(e+="",e.toUpperCase()):""}function STRING(e){return e+""}function SUB_STRING(e,t,r){return STRING(e).substring(t,r)}function IDCARD_VALIDATE(e){var t=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/,r=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;return!(!t.test(e)&&!r.test(e))}function IDCARD_BIRTH(e,t){if(!e)return"";var r="";if(18===(e+"").length?r=(e+"").slice(6,14):15===(e+"").length&&(r="19"+(e+"").slice(6,12)),!t)return r;var n={"M+":r.slice(4,6),"d+":r.slice(6)};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,r.slice(0,4).substr(4-RegExp.$1.length))),n)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return t}function IDCARD_SEX(e){return e?18===(e+"").length?String(e).slice(16,17)%2===0?2:1:15===(e+"").length?String(e).slice(14)%2===0?2:1:void 0:""}function ARRAY_SIZE(e){return e?e.length:0}function TO_ARRAY(e,t){return e&&"undefined"!==e?t?e.split(t):e.split(""):[]}function ARRAY_TO_STR(e){return Array.isArray(e)?e.map((function(e){return e.toString()})).join(","):""}function GET_FORMDATA(){var e,t,r,n,a,i=Array.prototype.slice.call(arguments),u=i[0]||null;return Array.isArray(i[1])?(r=i[1],r=_.filter(r,(function(e){return _.isNumber(e)}))):(_.isNumber(i[1])&&(e=i[1]),_.isNumber(i[2])&&(t=i[2])),Array.isArray(u)?(_.isArray(r)?r.length>0&&(a=_.filter(u,(function(e,t){return r.indexOf(t)>=0}))):a=u.slice(e,t),1==(null===(n=a)||void 0===n?void 0:n.length)?a[0]:a):u}var created=function created(fn){return eval("(function ".concat(fn," (){\n    var args = Array.prototype.slice.call(arguments)\n    //不是数字无法进行计算\n    for(var i=0;i<args.length;i++){\n      if(isNaN(args[i]*1)){\n        return ''\n      }\n    }\n    return  Math['").concat(fn,"'.toLowerCase()].apply(null,args)\n  })"))},customMathematical=[["AVG",AVG.toString(),!0],["SUM",SUM.toString(),!0],["SUB",SUB.toString(),!0],["DIV",DIV.toString(),!0],["MUL",MUL.toString(),!0],["MAX",MAX.toString(),!0],["MIN",MIN.toString(),!0],["GET_FORMDATA",GET_FORMDATA.toString(),!0],["ABS",created("ABS").toString()],["MOD",MOD.toString()],["POW",created("POW").toString()],["FLOOR",created("FLOOR").toString()],["CEIL",created("CEIL").toString()],["COUNTIF",COUNTIF.toString()],["ROUND",created("ROUND").toString()],["LOG",LOG.toString()],["SQRT",created("SQRT").toString()],["FIXED",FIXED.toString()],["FLOATCALCUATE",FLOATCALCUATE.toString()],["NUMBER",NUMBER.toString()],["DATEDELTA",DATEDELTA.toString()],["DAYDT",DAYDT.toString()],["DA_YS",DA_YS.toString()],["WEEKDAY",WEEKDAY.toString()],["FORMAT",FORMAT.toString()],["END_OF_MONTH",END_OF_MONTH.toString()],["TIME_BELONG_HOUR",TIME_BELONG_HOUR.toString()],["AND",AND.toString()],["OR",OR.toString()],["IF",IF.toString()],["CONCATENATE",CONCATENATE.toString()],["DELETEWHITESPACE",DELETEWHITESPACE.toString()],["LEN",LEN.toString()],["LOWER",LOWER.toString()],["UPPER",UPPER.toString()],["STRING",STRING.toString()],["SUB_STRING",SUB_STRING.toString()],["IDCARD_VALIDATE",IDCARD_VALIDATE.toString()],["IDCARD_BIRTH",IDCARD_BIRTH.toString()],["IDCARD_SEX",IDCARD_SEX.toString()],["ARRAY_SIZE",ARRAY_SIZE.toString()],["TO_ARRAY",TO_ARRAY.toString()],["ARRAY_TO_STR",ARRAY_TO_STR.toString()]],ufuncPools=Object(_cache__WEBPACK_IMPORTED_MODULE_2__["a"])(500);function ufunc(e){var t=e.realFormula.trim(),r=t,n=ufuncPools.get(r);if(n)return n;var a="\n  var $$index = dsf.isDef(__local__.$index) ? __local__.$index : null;\n  with(__vm__){\n    return ".concat(r,";\n  }\n  "),i="\n  function TO_VALUE(val, attr) {\n    if (dsf.isUnDef(val)) {\n      return null;\n    }\n    var value = !attr ? val : val[attr];\n    if (dsf.isUnDef(value)) {\n      return null;\n    }\n    if (dsf.isNumber(value)) {\n      return parseFloat(value)\n    }\n    if (dsf.isString(value)) {\n      if (value.indexOf('NaN') >= 0 || value.indexOf('Infinity') >= 0 || value.indexOf('-Infinity') >= 0|| value.indexOf('undefined') >= 0) {\n        dsf.warn(\"无效的值被忽略\")\n        return \"\"\n      }\n    }\n    return value;\n  };\n  ",u="".concat(i,"\n    var UTILS = ").concat(JSON.stringify(UTILS,(function(e,t){return"function"===typeof t?t+"":t})),";").concat(e.func,";");_.each(customMathematical,(function(e,t){e[0],e[1],e[2];~r.indexOf(e[0])&&(u+=e[1]+";")}));try{return n=new Function("__vm__","__local__",[u,a].join("\r\n")),ufuncPools.put(r,n),n}catch(o){throw Error("执行公式异常:".concat(r,"----").concat(o))}}var reg=/\_\_\$\$(\d)+\$\$\_\_/g,esprima,estraverse,escodegen=null;function readFormulaExpress(e){for(var t=!1,r=["'",'"'],n=e.trim(),a=-1,i=-1,u={},o=[],s=0;s<n.length;s++){var c=n[s];if(r.includes(c)&&"\\"!==n.charAt(s-1)&&(t=!0,r=c),t)t=!1,r="";else if("{"==c&&"{"==n.charAt(s+1)&&"^"==n.charAt(s+2)&&"^"==n.charAt(s+3))a=s,i=s;else if("^"==c&&"^"==n.charAt(s+1)&&"}"==n.charAt(s+2)&&"}"==n.charAt(s+3)){i=s+3;var _=n.substring(a,i+1),l="__$$"+s+"$$__";u[l]=_,o.push(l),a=-1,i=-1,s+=3;continue}-1==a&&-1==i&&o.push(c)}var f=esprima.parseScript(o.join(""));return{tree:f.body,code:o.join(""),varMap:u}}function createFormulaCodeStr(e,t){var r=replaceCode(e.tree,t),n=escodegen.generate(r);return n}function replaceCode(e,t){var r=null;try{r=estraverse.replace(e,{enter:function(e){e=dsf.isArray(e)?e:[e];for(var r=[],n=0;n<e.length;n++){var a=e[n],i=null;"ExpressionStatement"==a.type&&(a.expression=replaceCode(a.expression,t),r.push(a)),"CallExpression"==a.type?(i=createFunctionCode(a,t),r.push(i)):isBinaryExpression(a)?(i=createBinaryExpressionCode(a,t),r.push(i)):isVariable(a)?(i=createVariableCode(a,t),r.push(i)):r.push(a)}return r[0]}})}catch(n){dsf.error(n)}return r}function isVariable(e){return!("Identifier"!=e.type||(reg.lastIndex=0,!reg.test(e.name)))}function isBinaryExpression(e){return"BinaryExpression"==e.type}function isFunctionCall(e){return"CallExpression"==e.type}function createAstNode(e){var t=esprima.parseScript(e),r=[];if(t&&t.body)for(var n=0;n<t.body.length;n++)"ExpressionStatement"==t.body[n].type?r.push(t.body[n].expression):"FunctionDeclaration"==t.body[n].type&&r.push(t.body[n]);return r[0]}function createVariableCode(e,t){var r=t&&t({type:"variable",express:e.name});return r?createAstNode(r):e}function createFunctionCode(e,t){var r=e.callee,n=e.arguments,a=_.find(customMathematical,(function(e){return e[0]==r.name}));a&&a[2]&&(e.pol=!0);for(var i={type:"function",name:r.name,pol:e.pol,args:[]},u=[],o=function(){var e=n[s],r=[],a=replaceCode(e,(function(e){"variable"==e.type&&dsf.array.ensure(r,e,(function(t){return t.name==e.name}))})),o=escodegen.generate(a);if(r.length){var c=t&&t({type:"express",express:o,vs:r},i);u.push(c||o)}else u.push(o)},s=0;s<n.length;s++)o();var c=i.name+"("+u.join(",")+")";return e=createAstNode(c),e}function createBinaryExpressionCode(e,t){return e.left&&(e.left=replaceCode(e.left,t)),e.right&&(e.right=replaceCode(e.right,t)),e}function compile(e,t){return _compile.apply(this,arguments)}function _compile(){return _compile=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark((function e(t,r){var n,a,i,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,dsf.ast.javascript();case 3:return n=e.sent,esprima=n.esprima,estraverse=n.estraverse,escodegen=n.escodegen,a=readFormulaExpress(t),i=function(e,t){if(r)return r({node:e,ownerFunction:t,varMap:a.varMap})},u=createFormulaCodeStr(a,i),e.abrupt("return",u);case 13:throw e.prev=13,e.t0=e["catch"](0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,13]])}))),_compile.apply(this,arguments)}ufunc.compile=compile,__webpack_exports__["default"]=ufunc}}]);
//# sourceMappingURL=../../../smap/core/dsf-core.core_ufunc_async.js.map