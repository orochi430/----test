/*!
 * Name: @dsf/cli-core
 * Version: 5.17.0-alpha.5
 * Description: 核心模块
 * BuildTime: 2024/6/19 17:49:24
*/
(("undefined"!==typeof self?self:this)["webpackJsonpcore"]=("undefined"!==typeof self?self:this)["webpackJsonpcore"]||[]).push([[6],{295:function(e,n,i){"use strict";i.r(n);var t=i(17),s=i.n(t),o=i(45),l=i.n(o),a=i(24),r=i.n(a);function d(e,n){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=u(e))||n&&e&&"number"===typeof e.length){i&&(e=i);var t=0,s=function(){};return{s:s,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return l=e.done,e},e:function(e){a=!0,o=e},f:function(){try{l||null==i.return||i.return()}finally{if(a)throw o}}}}function u(e,n){if(e){if("string"===typeof e)return c(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,n):void 0}}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var i=0,t=new Array(n);i<n;i++)t[i]=e[i];return t}var f=null,v=null,p="",h=null,m=null,g=null,D=null,w=0,y=[],b=[],I="",L=null,k=null,$="",C="";function x(e,n,i,t,s){return S.apply(this,arguments)}function S(){return S=l()(r.a.mark((function e(n,i,t,o,l){var a,d,u,c,f,v,p,h,m;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=s()(n,2),d=a[0],u=a[1],c=F(d,i),d.sPID&&dsf.flow.autoReceive(o,d),!i.isLinkSend||i.line){e.next=16;break}return h=o.buttons.indexOf(i),e.next=7,o.getFlowBtns(c.param,i,o.buttons,h);case 7:if(f=e.sent,!dsf.isString(f)){e.next=12;break}return i.disabled=!1,dsf.layer.message(f,!1),e.abrupt("return");case 12:if(u&&(null===(m=t.$vm)||void 0===m||m[u](f,l)),null===(v=f)||void 0===v||v.forEach((function(e){return e.disabled=!1})),!((null===(p=f)||void 0===p?void 0:p.length)>1)){e.next=16;break}return e.abrupt("return");case 16:P(c);case 17:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function P(e){Y("post",e.url,e.param).done((function(e){O(e,!1)})).catch((function(e){dsf.error(e),dsf.layer.message("发送异常",!1),v=null})).finally((function(){setTimeout((function(){D.disabled=!1}),1e3)}))}function R(e){var n,i=e.SendParams.Lines,t=i.length>1?null===(n=i.filter((function(e){return e.LineID==p})))||void 0===n?void 0:n[0]:i[0];if(t){var s=[{text:"确定",handler:function(e){if(e.$refs.view.validate()){var n=e.$refs.view.yes();return g.$vm.loading=!0,I=n.sReceivers,H(n.sReceivers,v,""),!0}return!1}}];dsf.global.$isMobile&&s.unshift({text:"取消"}),dsf.layer.openDialog({showClose:!dsf.global.$isMobile,fullscreen:dsf.global.$isMobile,title:"选择发送对象",width:dsf.global.$isMobile?"100vw":"1050px",height:dsf.global.$isMobile?"100vh":"calc(85vh - 120px)",btnPosition:"bottom",params:{wfId:h,line:t,curLinkId:m,path:dsf.global.$isMobile?"#/mobile/dsfa/flow/freedom/mobile-index":"/dsfa/flow/freedom/index"},btns:s})}}function T(e){var n,i={1:function(e){return e.UserName},2:function(e){return"".concat(e.DeptName,"-").concat(e.RoleName)},3:function(e){return e.JobName},4:function(e){return"".concat(e.UserName,"-").concat(e.RelationName)},5:function(e){return e.RobotName}},t={};null===e||void 0===e||null===(n=e.Links)||void 0===n||n.forEach((function(e){if([0,-1,-2].includes(e.Status)&&e.LinkUser){var n,s=(null===(n=t[e.LineID])||void 0===n?void 0:n.list)||[],o=e.LineID,l=e.CC,a=e.LineName;t[o]={isCC:3===l||4===l,LineName:a,LineID:o,list:s},s.push(i[e.LinkUser.Type](e.LinkUser)),t[o].list=_.uniq(s)}}));var s=Object.values(t).sort((function(e,n){return e.isCC-n.isCC})),o="发送成功",l="已发送至：";[2e4,20001,20003].includes(null===e||void 0===e?void 0:e.Code)?o="":[20004,20005].includes(null===e||void 0===e?void 0:e.Code)&&(o=D.completed?g.$replace(D.completed,g.$expressParams(e)):"文件已办结",l="提示"),dsf.layer.openDialog({type:"dialog",title:l,width:dsf.global.$isMobile?"96%":"640px",height:"auto",overflow:"auto",content:"SendFlowDialog",footerAlign:"center",showClose:!1,params:{listMap:s,msg:o,countDownTime:w},btns:[{text:"确定",class:"sendFlow ".concat(dsf.global.$isMobile?"van-dialog__confirm":""),handler:function(){return K(0),!0}}]})}function N(e){var n,i;if(g.$vm["flowGetCurrentLine"]&&(p=g.$vm["flowGetCurrentLine"](D,e,g),p)){var t={sRequestID:v,sLineID:p};Y("post","wfr/sendToLine",t).done((function(e){O(e)}))}else{var s=[];null!==(n=e.SendParams)&&void 0!==n&&null!==(n=n.Lines)&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.SendToLineID&&s.push({text:"返回",class:"plain",handler:function(){var n,i={sRequestID:v,sLineID:null===(n=e.SendParams.Lines[0])||void 0===n?void 0:n.BackLineID};return Y("post","wfr/setLineToBack",i).done((function(e){O(e)})),!0}}),f=dsf.layer.openDialog({title:"请选择要发送的环节：",width:"400px",height:"auto",overflow:"auto",footerAlign:"center",content:"ChooseSendNode",params:{lines:(null===(i=e.SendParams)||void 0===i||null===(i=i.Lines)||void 0===i?void 0:i.filter((function(e){return 0==e.ccLine||dsf.isUnDef(e.ccLine)})))||[],chooseNode:function(n){var i,t,s;return null===(i=g.$vm)||void 0===i||!i["flowChooseNode"]||(null===(t=g.$vm)||void 0===t||null===(s=t["flowChooseNode"])||void 0===s?void 0:s.call(t,n,e,g))},callback:function(e,n,i){p=i.LineID,O(e.data,n)},requestID:v,type:"next"},btns:s})}}function M(e){var n,i;if(g.$vm["flowGetCurrentLine"]&&(p=g.$vm["flowGetCurrentLine"](D,e,g),p)){var t={sRequestID:v,sLineID:p};Y("post","wfr/sendToLine",t).done((function(e){O(e)}))}else{var s=!(null===e||void 0===e||null===(n=e.SendParams)||void 0===n||null===(n=n.Lines)||void 0===n||null===(n=n[0])||void 0===n||!n.SendToLineID),o=s?e.SendParams.Lines[0].SendToLineID:"",l=50*e.SendParams.Lines.length+62+(s?44:0);f=dsf.layer.openDialog({height:l+"px",hasHeader:!1,hasFooter:!1,content:"DsfMobileChooseSendNode",params:{requestID:v,lines:(null===(i=e.SendParams)||void 0===i||null===(i=i.Lines)||void 0===i?void 0:i.filter((function(e){return 0==e.ccLine||dsf.isUnDef(e.ccLine)})))||[],title:"请选择要发送的环节：",chooseNode:function(n){var i,t,s;return null===(i=g.$vm)||void 0===i||!i["flowChooseNode"]||(null===(t=g.$vm)||void 0===t||null===(s=t["flowChooseNode"])||void 0===s?void 0:s.call(t,n,e,g))},callback:function(e,n,i){p=i.LineID,O(e.data,n)},showBack:s,back:function(){E(o)}},btns:[]})}}function E(e){var n={sRequestID:v,sLineID:e};Y("post","wfr/setLineToBack",n).done((function(e){2e4==e.state&&O(e)}))}function B(e,n){var i=e.SendParams.Lines,t=i.map((function(e){return e.LineID})).join();f=dsf.layer.openDialog({title:"请选择办理人",width:"1200px",height:"480px",overflow:"hidden",content:"ChooseSendTree",params:{lines:i},btns:[{text:"返回",type:"plain",class:"choose-send-node ".concat(n?"":"hide"),handler:function(n){var i,t={sRequestID:v,sLineID:null===(i=e.SendParams)||void 0===i||null===(i=i.Lines)||void 0===i?void 0:i[0].SendToLineID};return Y("post","wfr/setLineToBack",t).done((function(e){O(e)})),!0}},{text:"选择模板",class:dsf.global.$isMobile?"hide":"",handler:function(e){var n={sLineIDs:t};return Y("post","wfr/getHandlerTemplateList",n).done((function(n){if(n.success){var i=n.data;i.forEach((function(e){e.id=e.dsfa_wf_link_handler_template,e.label=e.template_name})),dsf.layer.openDialog({title:"选择模板",width:"330px",height:"420px",overflow:"hidden",content:"DsfFlowSelectTree",params:{treeData:i,showDel:!0,delUrl:"wfr/delHandlerTemplate"},btns:[{text:"确定",handler:function(n){var i,t=null===(i=n.$refs.treeForm.getCheckedNodes())||void 0===i?void 0:i[0],s=t.receiverName?JSON.parse(t.receiverName):null;if(s)s.forEach((function(n){var i,t=d(e.linesData);try{var s=function(){var t=i.value;if(t.LineID===n.LineID){var s,o=e.$refs["selectTree-"+t.LineID][0].$refs.treeForm;null===(s=n.selectDepts)||void 0===s||s.forEach((function(e){o.getNode(e.id)?o.setChecked(e.id,!0):t.selectDepts.push(e)}))}};for(t.s();!(i=t.n()).done;)s()}catch(o){t.e(o)}finally{t.f()}}));else{var o,l=t.receiver.split(";"),a=d(l);try{var r=function(){var n,i=o.value,t=i.split(":"),s=t[0],l=d(e.linesData);try{var a=function(){var i=n.value;i.selectDepts=[],i.checked=[],i.LineID===s&&e.$nextTick((function(){i.checked=t[1].split(",")}))};for(l.s();!(n=l.n()).done;)a()}catch(r){l.e(r)}finally{l.f()}};for(a.s();!(o=a.n()).done;)r()}catch(u){a.e(u)}finally{a.f()}}return!0}}]})}})),!1}},{text:"保存模板",class:dsf.global.$isMobile?"hide":"",handler:function(e){return!!e.validate()&&(dsf.layer.prompt({message:"模板名称",inputPlaceholder:"请输入模板名称",inputType:"input",inputPattern:/\S/,inputErrorMessage:"模板名称不能为空",confirmButtonText:"确定",inputValidator:function(e){return!(e&&e.length>50)||"模板名称长度不能超过50"}}).then((function(n){var i=n.value,s=e.yes(),o=e.getCC(),l={templateName:i,sLineIDs:t,sReceivers:s,receiverName:JSON.stringify(o)};Y("post","wfr/saveHandlerTemplate",l).done((function(e){e.success?dsf.layer.message("保存成功",!0):dsf.layer.message(e.message,!1)}))})),!1)}},{text:"确定",type:"",handler:function(e){if(e.validate()){var n,i=e.yes();return H(i,v),null===(n=document.querySelector(".close-send-node"))||void 0===n||n.click(),!0}return!1}}]})}function U(e,n){f=dsf.layer.openDialog({showClose:!1,title:"请选择办理人",fullscreen:!0,width:"100vw",height:"100vh",customClass:"work_flow-usersDialog",content:"DsfMobileChooseUsers",btnPosition:"bottom",hasFooter:!0,params:{lines:e.SendParams.Lines,RequiredOpinion:e.SendParams.RequiredOpinion},btns:[{text:"取消"},{text:"返回",class:"choose-send-node ".concat(n?"":"hide"),handler:function(n){var i,t={sRequestID:v,sLineID:null===(i=e.SendParams)||void 0===i||null===(i=i.Lines)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.SendToLineID};return Y("post","wfr/setLineToBack",t).done((function(e){2e4==e.state?O(e):dsf.layer.message(e.message,!1)})),!0}},{text:"确定",handler:function(e){if(e.validate()){var n=e.yes(),i={sRequestID:v,sReceivers:n.sReceivers};if(n.disposeIdea){var t=n.disposeIdea,s={Content:t.inputValue,Attachments:t.multipleFiles};i.sOpinion=JSON.stringify(s)}return Y("post","wfr/sendToReceivers",i).done((function(e){2e4==e.state?O(e):dsf.layer.message(e.message,!1)})),!0}return!1}}]})}function O(e,n){if(f&&(f.close(),f=null),e.success){var i=e.data,t=i.Code;if(v=i.RequestID,[2e4,20001,20003,20004,20005].includes(t))T(i);else if(81e3==t)dsf.global.$isMobile?M(i):N(i);else if([82e3,81100].includes(t))dsf.global.$isMobile?U(i,n):B(i,n);else if(82001==t)R(i);else if(83e3==t)V(i,!0);else if(97e3==t)V(i,!1);else{var s=i.Message;i.EsMessage&&(s=s+"."+i.EsMessage),dsf.layer.message(s||"未知流程类型发送",!1)}}else{var o=e.data;v=null;var l=(null===o||void 0===o?void 0:o.Message)||e.message;e.EsMessage&&(l=l+"."+e.EsMessage),dsf.layer.message(l||"发送异常",!1)}}function F(e,n){var i=e.sWFID,t=e.sObjectID,s=e.sObjectName,o=e.sPID,l=e.sCurLinkID,a=e.sCurNodeID,r=e.sExInfos,d=e.sReceivers,u=e.sOpinion,c=e.sLineIDs,f=e.countDownTime,v=e.ds_security_level,g=n.line,D=n.IsSPSend,y=D?"wfr/startSPSend":"wfr/startSend",b={sWFID:i,sObjectID:t,sObjectName:s||"",sCurNodeID:a||"",sExInfos:dsf.isObject(r)?JSON.stringify(r):r,sReceivers:d,securityClassValue:null===v||void 0===v?void 0:v.value,securityLevelExpiryDate:null===v||void 0===v?void 0:v.expirydate};return o&&(y=D?"wfr/spSend":"wfr/send",b={sPID:o,sCurLinkID:l,sExInfos:dsf.isObject(r)?JSON.stringify(r):r,sReceivers:d,securityClassValue:null===v||void 0===v?void 0:v.value,securityLevelExpiryDate:null===v||void 0===v?void 0:v.expirydate}),u&&(b.sOpinion=u),c?b.sLineIDs=c:g&&(b.sLineIDs=g.LineID),h=b.sWFID,p=b.sLineIDs,m=b.sCurLinkID,b.sPID,w=f||3,{param:b,url:n.flowUrl||y}}function A(e,n,i){dsf.layer.openDialog({title:"请填写退回原因",width:"534px",height:dsf.global.$isMobile?"60vh":"228px",showClose:!1,btnPosition:"bottom",params:{path:dsf.global.$isMobile?"dsfa/flow/basic/mobile-sendbackdialog":"dsfa/flow/basic/sendbackdialog",showUser:1!==(null===n||void 0===n?void 0:n.length),backLinks:n,showLoopback:0!=i},btns:[{text:"确认",handler:function(){var n=l()(r.a.mark((function n(i){var t,s,o;return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,i.yes();case 2:if(t=n.sent,!t){n.next=6;break}return o={sPID:e[0]||null,sCurLinkID:e[1]||null,sReason:t.sReason||null,sBackLinkID:t.sBackLinkID,bLoopback:1==(null===(s=t.bLoopback)||void 0===s?void 0:s.value)},n.abrupt("return",Y("post","wfr/sendBack",o).done((function(e){var n;return"21000"==(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.Code)?(g.$dispatch("sendBack",e.data),dsf.layer.message("退回成功",!0),K(),!0):(!g.$listeners.sendBackError&&dsf.layer.message(e.data.Message||"退回异常",!1),g.$dispatch("sendBackError",e.data.Message||"退回异常"),!1)})).catch((function(e){return!g.$listeners.sendBackError&&dsf.layer.message("退回异常",!1),g.$dispatch("sendBackError","退回异常"),!1})));case 6:return n.abrupt("return",!1);case 7:case"end":return n.stop()}}),n)})));function i(e){return n.apply(this,arguments)}return i}()},{text:"取消"}]})}function q(e,n){var i,t,s,o;if(0===(null===e||void 0===e?void 0:e.level))W(e,n);else if(null!==e&&void 0!==e&&null!==(i=e.data)&&void 0!==i&&i.children&&1===(null===e||void 0===e?void 0:e.level)){var l;n(null===(l=y[0])||void 0===l?void 0:l.children)}else"1"!=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t._type)&&((null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.UserCount)>0||(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.DeptCount)>0)?W(e,n,e.data.id):n([])}function j(e){dsf.http.get(C||"oua/searchUserByOrg",{keyWord:e}).done((function(e){if(e.success){var n=dsf.isEmptyObject(e.data)?null:J(e.data,"1","user");y=n?[n]:[],k.params.treeData=y}}))}function W(e,n,i){dsf.http.get($||"oua/getUserByCurUnit",{sFID:i,isAsy:!0}).done((function(e){if(null!==e&&void 0!==e&&e.success){var t=J(e.data,"1","user");if(i?t=t.children:(b.push(t.id),y=[t],t=[t]),n)return null===n||void 0===n?void 0:n(t)}}))}function J(e,n,i){var t;if(e.label=e.NAME||e._name,e.id=e.id||e._id,e.type=e.TYPE||e._type,n&&(e.disabled=e.type!=n),i&&("dept"===i&&0==e.DeptCount||"user"===i&&(1===e.type||0==e.DeptCount&&0==e.UserCount))&&(e.leaf=!0),e.attributes={NAME:e.label,id:e.id,FID:e.pid,type:e.type},delete e.NAME,delete e.Atts,delete e.TYPE,delete e.FID,(null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t.length)>0)for(var s=0;s<e.children.length;s++)J(e.children[s],n,i);return e}function V(e,n){var i,t,s=null===e||void 0===e||null===(i=e.warnUserNames)||void 0===i?void 0:i.length,o=null===e||void 0===e||null===(t=e.warnUserNames)||void 0===t?void 0:t.join("、");s>20&&(o=e.warnUserNames.splice(0,20).join("、")),dsf.layer.openDialog({title:"<div class='flow-security-title'><i class='el-alert__icon el-icon-warning'></i><span>提示</span></div>",width:"440px",height:"auto",customClass:"flow-security",template:'<div>\n      <span class="user">'.concat(o||"","</span>\n      <span>").concat(s>20?"等"+s:"","用户密级过低，不能处理此任务").concat(n?"，是否继续发送？":"","</span>\n    </div>"),btns:[{text:"仍发送",class:{"ds-hide":!n},handler:function(n){var i=[],t=e.SendParams.Lines;return t=t.filter((function(e){return e.Selected})),t.forEach((function(e){var n,t,s,o;"-1"!=(null===e||void 0===e||null===(n=e.Receivers)||void 0===n?void 0:n.Dept.ID)&&(null===e||void 0===e||null===(t=e.Receivers)||void 0===t||null===(t=t.Dept)||void 0===t?void 0:t.Objs.length)>0?null===e||void 0===e||null===(s=e.Receivers)||void 0===s||null===(s=s.Dept)||void 0===s||null===(s=s.Objs)||void 0===s||s.forEach((function(n){i.push("".concat(e.LineID,":").concat(n.ID))})):null===e||void 0===e||null===(o=e.Receivers)||void 0===o||null===(o=o.Dept)||void 0===o||null===(o=o.ChildDepts)||void 0===o||o.forEach((function(n){var t;null===n||void 0===n||null===(t=n.Objs)||void 0===t||t.forEach((function(n){i.push("".concat(e.LineID,":").concat(n.ID))}))}))})),H(I||i.join(";"),e.RequestID,1),I=null,!0}},{text:"取消"}]})}function H(e,n,i){var t={sRequestID:n,sReceivers:e,ignoreWarn:i};Y("post","wfr/sendToReceivers",t).done((function(e){O(e),g.$vm.loading=!1}))}function G(e,n,i){g=e.owner,L=e._self.$form,D=e.targetButton,D.disabled=!0;var t={};return n.forEach((function(n,i){t[n]=e.params[i]||dsf.url.queryString(n)})),i&&setTimeout((function(){D.disabled=!1}),200),t}function z(e,n,i){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:22e3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"操作成功";Y("post",e,n).done((function(e){var n,o,l;2e4==e.state?(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.Code)===t?(g.$dispatch(i,e),null===(o=L)||void 0===o||null===(l=o.$viewDataReset)||void 0===l||l.call(o),dsf.layer.message(s,!0),K()):dsf.layer.message(e.data.Message||"操作失败",!1):dsf.layer.message(e.message,!1)})).finally((function(){setTimeout((function(){D&&(D.disabled=!1)}),200)}))}function Y(e,n,i,t,s){var o=g.$baseUrl||"";return o?(dsf.config.serviceFullPath[o]&&(o=dsf.config.serviceFullPath[o]),n=dsf.url.getWebPath(n,o),s="/"):s="",dsf.http[e](n,i,t||{},s)}function K(){return Q.apply(this,arguments)}function Q(){return Q=l()(r.a.mark((function e(){var n,i,t,s,o,l,a,d,u,c,k,$,C,x,S,P,R,T,N,M,E,_,B,U,O,F,A,q,j=arguments;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=j.length>0&&void 0!==j[0]?j[0]:500,e.next=3,new Promise((function(e){return setTimeout(e,t)}));case 3:if(null===(n=g)||void 0===n||null===(i=n.$dispatch)||void 0===i||i.call(n,"closeOpener"),!L){e.next=14;break}if(!dsf.global.$isMobile){e.next=10;break}return window.sendFlowTimer&&(clearTimeout(window.sendFlowTimer),delete window.sendFlowTimer),L.reloadParentViewData(),g.$router.go(-1),e.abrupt("return",!0);case 10:if(null!==(s=g)&&void 0!==s&&null!==(s=s.$vm)&&void 0!==s&&s.$dialog)null===(a=g.$vm.$dialog)||void 0===a||null===(a=a.openerVm)||void 0===a||null===(d=a.reloadData)||void 0===d||d.call(a,!0),null===(u=g.$vm.$dialog)||void 0===u||null===(c=u.close)||void 0===c||c.call(u);else if(null!==(o=g)&&void 0!==o&&null!==(o=o.$vm)&&void 0!==o&&o.$openerVm)null===(k=g.$vm.$openerVm)||void 0===k||null===($=k.reloadData)||void 0===$||$.call(k,!0),null===(C=g.$vm)||void 0===C||null===(x=C.$closeWindow)||void 0===x||x.call(C);else if(null!==(l=window)&&void 0!==l&&l.opener){try{null===(S=(P=window.opener).reloadData)||void 0===S||S.call(P,!0)}catch(r){}window.close()}else null===(R=g)||void 0===R||null===(T=R.reloadData)||void 0===T||T.call(R),dsf.layer.closeWindow();g=null,e.next=16;break;case 14:null!==(N=g)&&void 0!==N&&null!==(N=N.$vm)&&void 0!==N&&N.$dialog?(null===(E=(_=g.$vm.$dialog).reloadData)||void 0===E||E.call(_,!0),null===(B=(U=g.$vm).reloadData)||void 0===B||B.call(U,!0)):null!==(M=g)&&void 0!==M&&null!==(M=M.$vm)&&void 0!==M&&M.reloadData?null===(O=(F=g.$vm).reloadData)||void 0===O||O.call(F,!0):null===(A=g)||void 0===A||null===(q=A.reloadData)||void 0===q||q.call(A),g=null;case 16:f=null,v=null,p="",h=null,m=null,"",g=null,D=null,w=0,y=[],b=[],I="",L=null;case 29:case"end":return e.stop()}}),e)}))),Q.apply(this,arguments)}n["default"]={send:function(e){return l()(r.a.mark((function n(){var i,t,s,o,l,a,d,u,c,f,v,p;return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(D=e.targetButton,g=e.owner,i=g.$vm,L=e._self.$form,!i["flowBtnAction"]){n.next=10;break}return n.next=7,i["flowBtnAction"](e);case 7:if(t=n.sent,t){n.next=10;break}return n.abrupt("return");case 10:if(D.disabled=!0,!L){n.next=35;break}return null===i||void 0===i||null===(s=i.flows)||void 0===s||null===(s=s.disposeIdea)||void 0===s||null===(o=s.setDoSave)||void 0===o||o.call(s,!1),l={isSilent:!0,isRefresh:!1,savedClose:!1},n.prev=14,n.next=17,L.formSave(l);case 17:if(u=n.sent,null===u||void 0===u||!u.data){n.next=25;break}if(f=null===i||void 0===i||null===(c=i.$dialog)||void 0===c||null===(c=c.dialogArgs)||void 0===c||null===(c=c.data)||void 0===c?void 0:c[0],!i.$refs.wfinfo){n.next=23;break}return n.next=23,i.$refs.wfinfo.flowSend(u.data,e.targetButton,f);case 23:n.next=26;break;case 25:setTimeout((function(){D.disabled=!1}),200);case 26:null===i||void 0===i||null===(a=i.flows)||void 0===a||null===(a=a.disposeIdea)||void 0===a||null===(d=a.setDoSave)||void 0===d||d.call(a,!0),n.next=33;break;case 29:n.prev=29,n.t0=n["catch"](14),dsf.error(n.t0),setTimeout((function(){D.disabled=!1}),200);case 33:n.next=40;break;case 35:if(p=null===(v=e.params)||void 0===v?void 0:v[0],!dsf.isObject(p)){n.next=39;break}return x(e.params,D,g,e._self),n.abrupt("return");case 39:dsf.layer.message("用法错误，检查一下页面是否是表单，或者列表中相应的参数是否设置",!1);case 40:case"end":return n.stop()}}),n,null,[[14,29]])})))()},sendBack:function(e){var n=e.params,i=G(e,["sPID","sCurLinkID"]);Y("post","wfr/getSendBackLink",i).done((function(e){var i;null!==e&&void 0!==e&&null!==(i=e.data)&&void 0!==i&&i.BackLinks?A(n,e.data.BackLinks,e.data.sendBackType):(!g.$listeners.sendBackError&&dsf.layer.message(e.data.Message||"退回异常",!1),g.$dispatch("sendBackError",e.data.Message||"退回异常"))})).catch((function(e){dsf.error(e),!g.$listeners.sendBackError&&dsf.layer.message("退回异常",!1),g.$dispatch("sendBackError","退回异常")})).finally((function(){setTimeout((function(){e.targetButton.disabled=!1}),200)}))},destroy:function(e){var n=G(e,["sPID","sCurLinkID"]),i="wfr/destroy";z(i,n,"destroy",20006)},recovery:function(e){var n=G(e,["sPID","sCurLinkID"]),i=22e3;"system_flow_forceRecovery"===e.targetButton.actionName&&(n.bForce=!0,i=22e3);var t=e.targetButton.actionName,s="system_flow_forceClose"===t?"forceClose":"recovery";i="system_flow_forceClose"===t?20007:22e3,z("wfr/"+s,n,s,i)},recoveryLink:function(e){var n=G(e,["sPID","sCurLinkID","sRecoveryLinkID","bForce"]);if(n.sRecoveryLinkID){n.bForce=!!n.bForce;var i="wfr/recoveryLink";z(i,n,"recoveryLink")}else dsf.layer.message("sRecoveryLinkID为空，不能操作",!1)},applyRecovery:function(e){var n=G(e,["sPID","sCurLinkID","sRecoveryLinkID"]);if(n.sRecoveryLinkID){var i="wfr/applyRecovery";z(i,n,"applyRecovery",22001,"申请回收中")}else dsf.layer.message("sRecoveryLinkID为空，不能操作",!1)},situation:function(e){var n=G(e,["isDialog","sPID"],!0),i=n.sPID,t=n.isDialog,s="/dsfa/flow/processinfo?sPID=".concat(i);t?dsf.layer.openDialog({title:"",width:"90vw",height:"80vh",params:{path:dsf.url.getWebPath(s)},btns:[]}):(s="/page.html#/pc".concat(s),dsf.layer.openWindow(s))},changeHandler:function(e){var n=G(e,["sPID","sCurLinkID","assignUrl","searchUrl"],!0);$=n.assignUrl,C=n.searchUrl,k=dsf.layer.openDialog({title:"请选择办理人",width:"500px",height:"420px",overflow:"hidden",content:"DsfFlowSelectTree",params:{lazy:!0,loadNode:q,defaultKeys:b,treeData:y,showSearch:!0,customerSearch:j,setIcon:function(e,n){return"0"==e.data.Level?["icon-chengshi"]:"1"==e.data._type?["icon-icon_user"]:"-1"==e.data.Level?["icon-ziyuanguanli"]:["icon-tab_home_unchecked"]}},btns:[{text:"确定",handler:function(n){var i,t,o,l,a=(null===n||void 0===n||null===(i=n.$refs)||void 0===i||null===(i=i.treeForm)||void 0===i?void 0:i.getCheckedNodes())||[];if(0===(null===a||void 0===a?void 0:a.length))return dsf.layer.message("请选择一个办理人",!1),!1;var r=s()(e.params,2),d=r[0],u=r[1];(null===(t=d)||void 0===t?void 0:t.indexOf("."))>-1&&(d=e.data[d]),(null===(o=u)||void 0===o?void 0:o.indexOf("."))>-1&&(u=e.data[u]);var c={sPID:d||dsf.url.queryString("sPID"),sCurLinkID:u||dsf.url.queryString("sCurLinkID"),userId:null===(l=a[0])||void 0===l?void 0:l.id,admin:!!e._self.queryString.admin};return Y("post","/wfr/changeHandler",c).done((function(e){var n=e.data,i=n.Code;return 24e3==i?(g.$dispatch("changeHandler",e.data),dsf.layer.message("更换成功",!0),K()):O(e),Promise.resolve()}))}},{text:"取消"}]})},addComment:function(e){var n,i,t=G(e,["sPID","sCurLinkID","sOpinion"],!0),s=t.sPID,o=t.sCurLinkID,l=t.sOpinion;dsf.layer.openDialog({title:"处理意见",width:dsf.global.$isMobile?"100vw":"880px",height:dsf.global.$isMobile?"100vw":"500px",content:dsf.global.$isMobile?"DsfMobileFlowAddComment":"DsfFlowAddComment",hasFooter:!1,footerAlign:"center",params:{$vm:e._self.$vm,flow:{sPID:s||(null===(n=e.owner)||void 0===n?void 0:n.sPID)||null,sCurLinkID:o||(null===(i=e.owner)||void 0===i?void 0:i.sCurLinkID)||null,sOpinion:!L&&l?JSON.parse(l):null,admin:!!e._self.queryString.admin}},dialogArgs:{},btns:[]})},autoReceive:function(e,n){var i=(null===n||void 0===n?void 0:n.sCurLinkID)||e.sCurLinkID;Y("post","/wfr/receive",{sPID:(null===n||void 0===n?void 0:n.sPID)||e.sPID,sCurLinkID:i}).done((function(n){if(n.success){var t,s,o;if(23e3===(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.Code))null===(o=e.$vm.flows)||void 0===o||null===(o=o.flowProcess)||void 0===o||o.forEach((function(e){i===e.linkid&&(e.rusername=dsf.session.get("user_name"),e.ruserid="",e.STATUS=1)}));93004===(null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.Code)&&dsf.layer.openDialog({title:"<div class='flow-security-title'><i class='el-alert__icon el-icon-warning'></i><span>提示</span></div>",width:"440px",height:"auto",customClass:"flow-security",template:'<div>\n                <span class="opinion">'.concat(n.data.Message||"","</span>\n              </div>"),onClosed:K,btns:[{text:"确认",handler:function(e){return K(),!0}}]})}}))},getLinkCurInfo:function(e,n){g=n,L=n.$form,n.sPID&&Y("get","/wfr/getLinkInfoByLinkID",{sPID:n.sPID,sLinkID:n.sCurLinkID}).done((function(i){var t,s=i.data;if(s&&(null!==(t=n.$vm)&&void 0!==t&&t.flows&&n.$set(n.$vm.flows,"flowCurInfo",s),"-1"==s.operationStatus?dsf.layer.openDialog({title:"<div class='flow-security-title'><i class='el-alert__icon el-icon-warning'></i><span>提示</span></div>",width:"440px",height:"auto",customClass:"flow-security",template:'<div>\n                  <span class="user">'.concat(s.applyRecycleUserName||"","</span>\n                  <span>用户向您发起了申请回收此文件！</span>\n                </div>"),onClosed:K,btns:[{text:"确认",handler:function(e){return new Promise((function(e,i){Y("post","wfr/agreeApplyRecovery",{sPID:n.sPID,sCurLinkID:n.sCurLinkID},{},!0).done((function(n){2e4!==n.data.Code&&22e3!==n.data.Code&&dsf.layer.message(n.data.Message,!1),setTimeout((function(){e()}),1e3)}))}))}}]}):"-3"==s.operationStatus&&dsf.layer.openDialog({title:"<div class='flow-security-title'><i class='el-alert__icon el-icon-warning'></i><span>提示</span></div>",width:"440px",height:"auto",customClass:"flow-security",template:"<div>\n                  <span>该环节已被回收！</span>\n                </div>",onClosed:K,btns:[{text:"确认",handler:function(e){return!0}}]}),0!=s.STATUS&&1!=s.STATUS||0!=s.cc&&!dsf.isUnDef(s.cc)||!e||dsf.flow.autoReceive(n),2==s.STATUS)){var o,l=dsf.mix({},n.queryString,{isHide:!0}),a={pageName:n.$form.pageName,nameSpace:n.$form.nameSpace,query:l};if(l)if(null!==n&&void 0!==n&&null!==(o=n.$frame)&&void 0!==o&&o.independent)n.$frame.urlChange(a,!0);else if(n.$dialog){var r;null===(r=n.$dialog)||void 0===r||null===(r=r.currentView)||void 0===r||r.urlChange(a,!0)}else n.$router.replace({path:n.$route.path,query:l})}}))},startSend:function(e){e.countDown&&(w=e.countDown),m=e.param.sCurLinkID,p=e.param.sLineIDs,P(e)},urge:function(e){var n=G(e,["sPID","sCurLinkID"],!0),i=n.sPID,t=n.sCurLinkID;dsf.layer.openDialog({title:"催办理由",width:"600px",height:"166px",params:{path:"dsfa/flow/basic/urge"},btns:[{text:"确认",handler:function(){var e=l()(r.a.mark((function e(n){var s,o;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.yes();case 2:if(s=e.sent,s){e.next=5;break}return e.abrupt("return",!1);case 5:o={sPID:i,sCurLinkID:t,sReason:s},Y("post","wfr/urge",o).done((function(e){var n;"25000"==(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.Code)?(g.$dispatch("flow-urge",e.data),dsf.layer.message("催办成功",!0),K()):(!g.$listeners.flowUrgeError&&dsf.layer.message(e.data.Message||"催办异常",!1),g.$dispatch("flowUrgeError",e.data.Message||"催办异常"))})).catch((function(e){!g.$listeners.flowUrgeError&&dsf.layer.message("催办异常",!1),g.$dispatch("flowUrgeError","催办异常")}));case 7:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}()},{text:"取消"}]})}}}}]);
//# sourceMappingURL=../../../smap/core/dsf-core.core_flow_async.js.map