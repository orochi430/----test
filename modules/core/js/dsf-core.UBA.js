/*!
 * Name: @dsf/cli-core
 * Version: 5.17.0-alpha.5
 * Description: 核心模块
 * BuildTime: 2024/6/19 17:49:24
*/
(("undefined"!==typeof self?self:this)["webpackJsonpcore"]=("undefined"!==typeof self?self:this)["webpackJsonpcore"]||[]).push([[0],{298:function(n,t,e){"use strict";e.r(t),e.d(t,"urlWatch",(function(){return y}));var r=e(45),o=e.n(r),a=e(1),i=e.n(a),c=e(24),u=e.n(c),f=Math.abs(Math.floor(dsf.config.UBA.timingStep||1))||1,s=Math.abs(Math.floor(dsf.config.UBA.requestStep||60))||60,d="routerWather",l=[],v=new Map,h=!1,g=null,p=!1,w=function(){return Math.floor((new Date).getTime()/1e3)};function b(){window&&(m(),window.addEventListener("beforeunload",(function(n){for(var t=0;t<l.length;t++)l[t].et||(l[t].et=g);$()})),dsf.event.addVisiblityChangeEvent((function(n){"hidden"==document.visibilityState?p=!0:"visible"==document.visibilityState&&(p=!1)})),window.setInterval(x,1e3*s))}function m(){g=w(),window.setInterval((function(){p||(g+=f)}),1e3*f)}function y(){return h||(h=!0,S()),{urlEnter:function(n,t,e){},urlLeave:function(n,t,e){},routerEnter:function(n,t,e){"/"!==n.path&&k(n,t,e)},routerLeave:function(n,t,e){"/"!==t.path&&M(n,t,e)}}}function k(n,t,e){var r,o=window.location,a=o.pathname,i=o.origin,c=o.search,u="".concat(i).concat(a).concat(c,"#").concat(n.path),f=dsf.md5(dsf.uuid()+(new Date).getTime());e.$ubaMark=f;var s=(null===t||void 0===t?void 0:t.path)||"";s="/"==s||""==s?document.referrer:"".concat(i).concat(a).concat(c,"#").concat(s);var d={cu:u,su:s,st:g,et:null,rnd:f,br:dsf.client.info.browser,ds:"".concat(window.screen.width,"*").concat(window.screen.height),os:dsf.client.info.os,dr:dsf.client.info.device,token:dsf.getToken()||"",appKey:null===(r=dsf.config)||void 0===r||null===(r=r.UBA)||void 0===r?void 0:r.appKey};l.push(d),v.set(e.$ubaMark,d)}function M(n,t,e){if(e.$ubaMark&&v.has(e.$ubaMark)){var r=v.get(e.$ubaMark);r.et=g}}function $(){var n=dsf.storage.local.get(d,[]),t={};_.each(n,(function(n){return t[n.uid]=n})),_.each(l,(function(n){return t[n.uid]=n}));var e=_.values(t);e.length>0?dsf.storage.local.set(d,e):dsf.storage.local.remove(d)}function S(){var n=dsf.storage.local.get(d,[]);l.unshift.apply(l,i()(n));for(var t=0;t<l.length;t++)v.set(l[t].uid,l[t]);dsf.storage.local.remove(d)}var x=function(){var n=dsf.mix(!0,[],l);n=n.filter((function(n){if(n.st&&n.et)return n.ct=n.et-n.st,!0})),E(n)},E=function(){var n=o()(u.a.mark((function n(){var t,e,r,o,a=arguments;return u.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:[];case 1:if(e=t.shift(),!e){n.next=10;break}return r=dsf.url.queryStringStringify(e),o=dsf.url.getWebPath("c.gif",$$webRoot.analytics),n.next=6,A("".concat(o,"?").concat(r));case 6:dsf.array.remove(l,(function(n){return n.rnd==e.rnd})),v.delete(e.rnd),n.next=1;break;case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),A=function(n){return new Promise((function(t,e){var r=new Image;r.src=n,r.onload=function(){t()},r.onerror=function(){t()}}))};b()}}]);
//# sourceMappingURL=../../../smap/core/dsf-core.UBA.js.map