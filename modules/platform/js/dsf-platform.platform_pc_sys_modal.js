/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[68],{1e3:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.validateing,expression:"validateing"}],staticClass:"ds-verify ds-nineGrid-verify",class:e.pageState},[a("div",{staticClass:"panel"},["loading"!=e.pageState?a("div",{staticClass:"img-box"},e._l(e.imageVirtualPath,(function(t){return a("div",{key:t.src,class:{active:t.selected},on:{click:function(a){return e.selectHandle(t,a)}}},[a("img",{attrs:{src:t.src}})])})),0):e._e(),"loading"==e.pageState?a("div",{staticClass:"loader"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],attrs:{"element-loading-text":"拼命加载中"}})]):e._e()]),a("div",{staticClass:"control msg",class:{error:"verifyErr"==e.pageState,success:"verifySucc"==e.pageState}},["verifySucc"==e.pageState?[a("i",{class:["iconfont","icon-"+e.iconName]}),e._v(" 验证成功 ")]:"verifyErr"==e.pageState?[a("i",{class:["iconfont","icon-"+e.iconName]}),e._v(" 验证失败 ")]:"loaded"==e.pageState?[a("i",{staticClass:"iconfont icon-shuaxin",attrs:{title:"刷新"},on:{click:e.controlClick}}),e._v(" 请选取图片中含有"),a("span",[e._v('"'+e._s(e.answer)+'"')]),e._v(" 的共"),a("b",[e._v(e._s(e.num))]),e._v("张图片 ")]:"loadErr"==e.pageState?[a("i",{staticClass:"iconfont icon-shuaxin",attrs:{title:"刷新"},on:{click:e.controlClick}}),e._v(" 加载异常 ")]:[e._v("加载中")]],2)])},i=[],r=a(430),n={name:"DsfPlatformNineGridVerify",ctrlCaption:"九宫格验证",mixins:[r["a"]],data:function(){return{codeMode:5,imageVirtualPath:[],answer:"",num:+dsf.config.setting_security_login_code_difficulty+1,record:0}},methods:{getImgsHandle:function(e){this.answer=e.answer;var t=[];_.forEach(e.imageVirtualPath,(function(e){t.push({src:"code/getGridImage?code="+e,selected:!1,x:0,y:0})})),this.imageVirtualPath=t},refreshHandle:function(){this.record=0,this.imageVirtualPath=[]},selectHandle:function(e,t){var a=this;if("loaded"==this.pageState)if(e.selected=!e.selected,e.x=parseInt(t.layerX),e.y=parseInt(t.layerY),e.time=(new Date).getTime(),e.selected&&this.record<this.num){if(this.record++,this.record==this.num){var s=[];this.xArray=[],this.yArray=[],this.timeStampArray=[],s=_.map(this.imageVirtualPath,(function(e){var t=e.selected,s=e.x,i=e.y,r=e.time;return t&&(a.xArray.push(s),a.yArray.push(i),a.timeStampArray.push(r)),t?1:-1})),this.validate(s.join(","))}}else e.selected||this.record--},controlClick:function(){var e=this.pageState;"loaded"!=e&&"loadErr"!=e||this.refresh()}}},o=n,l=a(0),c=Object(l["a"])(o,s,i,!1,null,null,null);t["default"]=c.exports},401:function(e,t,a){var s=a(429);function i(e,t){if(null==e)return{};var a,i,r=s(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}e.exports=i,e.exports.__esModule=!0,e.exports["default"]=e.exports},429:function(e,t){function a(e,t){if(null==e)return{};var a,s,i={},r=Object.keys(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||(i[a]=e[a]);return i}e.exports=a,e.exports.__esModule=!0,e.exports["default"]=e.exports},430:function(e,t,a){"use strict";t["a"]={mixins:[$mixins.control],data:function(){return{pageState:"loading",bgImgSrc:"",codeId:null,validateing:!1,codeMode:null}},computed:{iconName:function(){return"verifySucc"==this.pageState?"duigou":"verifyErr"==this.pageState?"guanbi2":"shuangjiantouyou"}},created:function(){this.getImgs()},methods:{getImgs:function(){var e=this;this.$http.get("code/getCode",{codeMode:this.codeMode}).done((function(t){var a,s=t.data,i=t.success,r=t.message;i?(null===(a=e.getImgsHandle)||void 0===a||a.call(e,s),e.codeId=s.id,e.pageState="loaded",e.lastTimeStamp=s.timeStamp,e.xArray=[],e.yArray=[],e.timeStampArray=[]):(e.pageState="loadErr",dsf.layer.message(r,!1))})).error((function(){e.pageState="loadErr",dsf.layer.message("获取异常",!1)}))},refresh:function(){var e;"loading"!=this.pageState&&(null===(e=this.refreshHandle)||void 0===e||e.call(this),this.pageState="loading",this.getImgs())},validate:function(e){var t=this;if(!this.validateing){var a=this;this.validateing=!0,new Promise((function(t,s){var i,r,n={code:"04"+dsf.sm2.encode(e+"",dsf.config.setting_public_smpublickey),codeId:a.codeId,behavior:"04"+dsf.sm2.encode(JSON.stringify({lastTimeStamp:a.lastTimeStamp,x:a.xArray,y:a.yArray,timeStamp:a.timeStampArray}),dsf.config.setting_public_smpublickey),codeMode:a.codeMode};null===a||void 0===a||null===(i=a.$attrs)||void 0===i||null===(r=i.validateFn)||void 0===r||r.call(i,n,t,s,a.$dialog)})).done((function(e){var t=[21003,21001,21004];e.success?a.pageState="verifySucc":t.includes(e.state)?(a.pageState="verifyErr",setTimeout((function(){a.refresh()}),1e3)):(a.pageState="verifyErr",setTimeout((function(){a.$dialog.close()}),1e3))})).catch((function(){a.pageState="verifyErr",setTimeout((function(){a.refresh()}),1e3)})).finally((function(){t.validateing=!1}))}}}}},506:function(e,t,a){var s=a(637);"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a(19).default;i("448dda22",s,!0,{sourceMap:!1,shadowMode:!1})},507:function(e,t,a){var s=a(639);"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a(19).default;i("165f7862",s,!0,{sourceMap:!1,shadowMode:!1})},508:function(e,t,a){var s=a(641);"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a(19).default;i("161fcdfc",s,!0,{sourceMap:!1,shadowMode:!1})},509:function(e,t,a){var s=a(643);"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a(19).default;i("ffc00100",s,!0,{sourceMap:!1,shadowMode:!1})},636:function(e,t,a){"use strict";a(506)},637:function(e,t,a){"use strict";a.r(t)},638:function(e,t,a){"use strict";a(507)},639:function(e,t,a){"use strict";a.r(t)},640:function(e,t,a){"use strict";a(508)},641:function(e,t,a){"use strict";a.r(t)},642:function(e,t,a){"use strict";a(509)},643:function(e,t,a){"use strict";a.r(t)},960:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"catalogue-warp"},[1===e.step?[a("SelectList",{attrs:{selectKeys:e.selectKeys,operateType:e.operateType},on:{close:e.cancel,changeStep:e.changeStep}})]:e._e(),2===e.step?[a("OperateList",{attrs:{importData:e.importDataUpdate,targetKeys:e.targetKeysUpdate},on:{close:e.cancel,changeStep:e.changeStep}})]:e._e()],2)},i=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"catalogue-options"},[a("div",{staticClass:"catalogue-options-center"},[a("div",{staticClass:"catalogue-options-center-left"},[a("el-scrollbar",{staticClass:"catalogue-options-scroll"},[a("el-tree",{ref:"tree",attrs:{"show-checkbox":"",props:e.defaultProps,"empty-text":e.loading?"数据加载中...":"暂无数据","highlight-current":!0,data:e.Treedata,"node-key":"_id","default-checked-keys":e.checkedKeys,"default-expanded-keys":e.expandedKeys,"expand-on-click-node":!1},on:{check:e.checkKeys,"current-change":e.currNodeChange},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node"},[a("i",{staticClass:"iconfont",class:s.expanded?"icon-dakai":"icon-wenjianjia",staticStyle:{color:"#c78511"}}),e._v("   "),a("span",{domProps:{innerHTML:e._s(e.dsf.safe.xss(i[e.defaultProps.label]))}})])}}])})],1)],1),a("div",{staticClass:"catalogue-options-center-right"},[a("div",{staticClass:"catalogue-options-out-box"},[a("el-table",{ref:"multipleTable",staticClass:"catalogue-options-table",attrs:{size:"small",height:"100%",data:e.tableData,border:""},on:{select:e.selectTable,"select-all":e.selectTable}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),a("el-table-column",{attrs:{label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["_name"]))])]}}])}),a("el-table-column",{attrs:{label:"类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["typeText"]))])]}}])}),a("el-table-column",{attrs:{label:"标识简称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["code"]))])]}}])})],1)],1)])]),a("div",{staticClass:"catalogue-options-footer"},[a("div",{staticClass:"catalogue-options-footer-left"},["export"!==e.operateType?[e._v(" "+e._s(e.operaType)+"到目录下方   "),a("el-cascader",{ref:"cascader",staticClass:"cascader",attrs:{size:"small",options:e.data,props:Object.assign({},e.defaultProps,{checkStrictly:!0}),clearable:""},on:{change:e.change}})]:e._e()],2),a("div",["copy"===e.operateType||"move"===e.operateType?[a("DsfButton",{on:{click:e.nextStep}},[e._v("下一步")])]:[a("DsfButton",{on:{click:e.exportData}},[e._v("导出")])],a("DsfButton",{staticClass:"plain",on:{click:e.cancel}},[e._v("取消")])],2)])])},n=[],o=a(2),l=a.n(o),c=a(4),d=a.n(c),u=a(1),p=a.n(u),f={name:"selectList",inject:["operateType","selectKeys","limitKeys"],data:function(){return{tableData:[],data:[],Treedata:[],defaultProps:{children:"children",label:"_name",key:"_id",value:"_id"},loading:!1,currentNode:"",checkedKeys:[],expandedKeys:[]}},created:function(){this.initLoadData("left"),"export"!==this.operateType&&this.initLoadData("bottom")},computed:{operaType:function(){var e="";switch(this.operateType){case"copy":e="复制";break;case"move":e="移动";break;case"import":e="导入";break}return e}},mounted:function(){this.checkedKeys=this.$refs.tree.getCheckedKeys()},watch:{checkedKeys:{handler:function(e){var t=this,a=this.defaultProps.key;this.tableData.forEach((function(s){t.$refs.multipleTable.toggleRowSelection(s,e.includes(s[a]))}))},deep:!0}},methods:{change:function(){this.$refs.cascader.toggleDropDownVisible(!1)},nextStep:function(){var e=this,t=this.$refs.tree.getCheckedNodes(!1,!1),a=this.$refs.cascader.getCheckedNodes(!0);if(0===t.length)return dsf.layer.message("请选择内容",!1),!1;if(0===a.length)return dsf.layer.message("请选择目录",!1),!1;var s=t.map((function(e){return e._id})),i=a[0].data._id,r=dsf.layer.loading();this.$http.post("rm/moveRmData",JSON.stringify({rmIds:s,targetId:i}),{headers:{"Content-Type":"application/json; charset=utf-8"}},!0).done((function(t){t.success?e.$emit("changeStep",{step:2,data:{importData:t.data,targetKeys:i}}):dsf.layer.message(t.message,!1)})).always((function(){dsf.layer.closeLoading(r)}))},exportData:function(){var e=this.$refs.tree.getCheckedNodes(!1,!1).map((function(e){return e._id}));if(0===e.length)return dsf.layer.message("请选择导出内容",!1),!1;var t="rm/exportRm",a="",s="";this.$baseUrl&&(s=this.$baseUrl||""),s&&(t=dsf.url.getWebPath(t,s),a="/"),t=dsf.url.getWebPath(t,a);var i='<form method="post">\n                        <input type="text" name="rmIdStr"/>\n                    </form>',r=$(i);r.find("input[type=text]").val(JSON.stringify(e)),r.attr("action",t),r.appendTo("body").submit().remove()},initLoadData:function(e){var t=this,a=dsf.layer.loading(),s=this.selectKeys.length?this.selectKeys.join(","):"",i=this.limitKeys.length?this.limitKeys.join(","):"",r={};"bottom"===e?(r={excludes:s},i&&(r.rmIds=i)):r={rmIds:s},this.$http.get("rm/getRmTree",r,null,!0).done((function(a){if(a.success){var s=t.defaultProps.key,i=[];if(i=Array.isArray(a.data)?a.data:[a.data],"bottom"===e)t.data=i;else{t.Treedata=i;var r=[],n=function e(t){t.forEach((function(t){r.push(t[s]),t.children&&e(t.children)}))};n(t.Treedata),t.$refs.tree.setCheckedKeys(r),t.expandedKeys=i.map((function(e){return e[s]}))}}else dsf.layer.message(a.message,!1)})).error((function(e){var t;dsf.layer.message(e.message||(null===(t=e.error)||void 0===t?void 0:t.message)||"查询目录失败",!1)})).always((function(){t.loading=!1,dsf.layer.closeLoading(a)}))},currNodeChange:function(e,t){var a=this;return d()(p.a.mark((function t(){var s;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=a.defaultProps.key,!a.currentNode||a.currentNode[s]!==e[s]){t.next=3;break}return t.abrupt("return",!1);case 3:return a.currentNode=e,a.$refs.tree.setChecked(e[s],!0,!0),t.next=7,a.initTable();case 7:a.checkedKeys=a.$refs.tree.getCheckedKeys();case 8:case"end":return t.stop()}}),t)})))()},checkKeys:function(e,t){var a=this.$refs.tree.getCheckedKeys();this.checkedKeys=a},initTable:function(){var e=l()(this.Treedata);while(e.length){var t,a=e.shift();null===(t=a.children)||void 0===t||t.forEach((function(t){e.push(t)})),a._id===this.currentNode._id&&(this.tableData=a.children||[],e=[])}},selectTable:function(e){var t=this,a=this.defaultProps.key,s=this.tableData.filter((function(t){return!e.some((function(e){return e[a]===t[a]}))})).map((function(e){return e[a]})),i=e.map((function(e){return e[a]}));s.forEach((function(e){return t.$refs.tree.setChecked(e,!1,!0)})),i.forEach((function(e){return t.$refs.tree.setChecked(e,!0,!0)}));var r=this.$refs.tree.getCheckedKeys();this.checkedKeys=r},cancel:function(){this.$emit("close")}}},h=f,m=a(0),g=Object(m["a"])(h,r,n,!1,null,null,null),v=g.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"catalogue-options"},[a("div",{staticClass:"catalogue-options-center"},[a("div",{staticClass:"catalogue-options-center-left"},[a("el-scrollbar",{staticClass:"catalogue-options-scroll"},[a("el-tree",{ref:"tree",attrs:{props:e.defaultProps,"empty-text":e.loading?"数据加载中...":"暂无数据","highlight-current":!0,data:e.data,"node-key":"importKey","default-expanded-keys":e.expandedKeys,"expand-on-click-node":!1},on:{"current-change":e.currNodeChange},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node",class:{"disabeled-tree":"0"===i.importData}},[i[e.defaultProps.children]?a("i",{staticClass:"iconfont",class:[s.expanded?"icon-dakai":"icon-wenjianjia"],staticStyle:{color:"#c78511"}}):a("i",{staticClass:"iconfont icon-shiyongwendang",staticStyle:{color:"#c78511"}}),e._v("   "),a("span",{staticClass:"custom-tree-node-name",attrs:{title:i[e.defaultProps.label]},domProps:{innerHTML:e._s(e.dsf.safe.xss(i[e.defaultProps.label]))}}),e._v("   "),e.conflictList.includes(i[e.defaultProps.nodeKey])||e.undefinedList.includes(i[e.defaultProps.nodeKey])||!0===i.error?a("i",{staticClass:"error iconfont icon--zhongdaweixian"}):e._e()])}}])})],1)],1),a("div",{staticClass:"catalogue-options-center-right"},[a("div",{staticClass:"catalogue-options-out-box"},[a("el-table",{ref:"multipleTable",staticClass:"catalogue-options-table",attrs:{size:"small",height:"100%","highlight-current-row":!1,"cell-class-name":e.tableRowClassName,data:e.tableData,border:""}},[a("el-table-column",{attrs:{label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"table-input",class:{error:!0===t.row["error"]&&"1"===t.row["errorType"]},attrs:{size:"small",disabled:"0"===t.row["importData"]},on:{change:function(a){return e.changeName(t)}},model:{value:t.row[e.defaultProps.label],callback:function(a){e.$set(t.row,e.defaultProps.label,a)},expression:"scope.row[defaultProps.label]"}})]}}])}),a("el-table-column",{attrs:{label:"类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["pageType"]))])]}}])}),a("el-table-column",{attrs:{label:"标识简称",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"table-input",class:{error:!0===t.row["error"]&&"1"!=t.row["errorType"]&&!t.row["cover"]},attrs:{size:"small",disabled:"0"===t.row["importData"]||!!t.row["cover"]},on:{change:function(a){return e.lintCode(t)}},model:{value:t.row["code"],callback:function(a){e.$set(t.row,"code",a)},expression:"scope.row['code']"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[!0!==t.row["error"]&&!t.row["cover"]||"1"==t.row["errorType"]?e._e():[a("el-button",{staticClass:"btn plain",class:{normal:"1"===t.row["cover"]},attrs:{size:"mini"},on:{click:function(a){return e.replace(t,"1")}}},[e._v("替换")]),"0"!==t.row["pageValue"]?a("el-button",{staticClass:"btn plain",class:{normal:"0"===t.row["cover"]},attrs:{size:"mini"},on:{click:function(a){return e.replace(t,"0")}}},[e._v("跳过")]):e._e()]]}}])}),a("el-table-column",{attrs:{label:"数据操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[["1","5","8"].includes(t.row["pageValue"])?a("el-button-group",[a("el-button",{staticClass:"btn plain",class:{normal:"0"!=t.row["copyType"]},attrs:{size:"mini"},on:{click:function(a){return e.copyRow(t,"1")}}},[e._v(" 复制 ")]),a("el-button",{staticClass:"btn plain",class:{normal:"0"==t.row["copyType"]},attrs:{size:"mini"},on:{click:function(a){return e.copyRow(t,"0")}}},[e._v(" 引用 ")])],1):e._e()]}}])}),a("el-table-column",{attrs:{label:"错误信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row["cover"]?e._e():a("span",{staticClass:"error"},[e._v(e._s(t.row["msg"]))])]}}])})],1)],1)])]),a("div",{staticClass:"catalogue-options-footer"},[a("div",{staticClass:"catalogue-options-footer-left"},[e._v(" "+e._s(e.operaType)+"到目录下方   "),a("el-cascader",{ref:"cascader",staticClass:"cascader",attrs:{size:"small",disabled:!0,options:e.targetdata,props:Object.assign({},e.defaultPropsCascader,{checkStrictly:!0}),clearable:""},model:{value:e.targetKeys,callback:function(t){e.targetKeys=t},expression:"targetKeys"}})],1),a("div",{staticClass:"btns"},[e.conflictList.length?a("span",{staticClass:"error"},[e._v(" 存在重复标识，请修改标识再操作 ")]):e.undefinedList.length?a("span",{staticClass:"error"},[e._v(" 存在未填写数据 ")]):e._e(),"import"!=e.operateType?a("DsfButton",{on:{click:e.preStep}},[e._v(" 上一步 ")]):e._e(),"import"===e.operateType?a("DsfButton",{on:{click:function(t){return e.operate("import")}}},[e._v(" 导入 ")]):e._e(),"copy"===e.operateType?a("DsfButton",{on:{click:function(t){return e.operate("copy")}}},[e._v(" 复制 ")]):e._e(),"move"===e.operateType?a("DsfButton",{on:{click:function(t){return e.operate("move")}}},[e._v(" 移动 ")]):e._e(),a("DsfButton",{staticClass:"plain",on:{click:e.cancel}},[e._v("取消")])],1)])])},b=[],_=a(401),x=a.n(_),C=["children"],k={name:"OperateList",inject:["operateType"],props:{importData:{type:Object,default:function(){return{}}},targetKeys:{type:String,default:""}},data:function(){return{tableData:[],data:this.importData.rmDataTrees,loading:!1,targetdata:[],defaultProps:{children:"children",label:"name",nodeKey:"importKey",value:"_id",disabled:function(e){return"0"===e.importData}},defaultPropsCascader:{children:"children",label:"_name",value:"_id"},currentNodeId:"",expandedKeys:[],conflictList:[],undefinedList:[],conflictItem:null}},computed:{operaType:function(){var e="";switch(this.operateType){case"copy":e="复制";break;case"move":e="移动";break;case"import":e="导入";break}return e}},created:function(){this.initTargetData(),this.initTable()},methods:{initTable:function(){if(this.compareTree(),this.tableData.length)return!1;if(this.conflictItem){var e=this.conflictItem.children;this.currentNodeId=this.conflictItem[this.defaultProps.value],this.tableData=[this.conflictItem].concat(l()(e||[]))}else{var t=l()(this.data);while(t.length){var a,s=t.shift();null===(a=s.children)||void 0===a||a.forEach((function(e){t.push(e)})),"1"===s.importData&&(this.expandedKeys=[s.importKey],t=[])}}},initTargetData:function(){var e=this,t=dsf.layer.loading();this.$http.get("rm/getRmTree",{},null,!0).done((function(t){if(t.success){var a=[];a=Array.isArray(t.data)?t.data:[t.data],e.targetdata=a}else dsf.layer.message(t.message,!1)})).error((function(e){var t;dsf.layer.message(e.message||(null===(t=e.error)||void 0===t?void 0:t.message)||"查询目录失败",!1)})).always((function(){e.loading=!0,dsf.layer.closeLoading(t)}))},compareTree:function(){this.conflictList=this.conflictDsf(this.data),this.undefinedList=this.undefinedDsf(this.data),this.conflictList.length&&(this.expandedKeys=this.conflictList)},currNodeChange:function(e){this.currentNodeId=e[this.defaultProps.value];var t=e.children;this.tableData=[e].concat(l()(t||[]))},conflictDsf:function(e){for(var t=[],a=this.defaultProps,s=0;s<e.length;s++){var i=e[s];if(i.children&&i.children.length>0)if(i.error&&i[a.label]&&i.code)this.conflictItem||(this.conflictItem=i),t.push(i[a.nodeKey]);else{var r=this.conflictDsf(i.children);r.length>0&&(t=[].concat(l()(t),[i[a.nodeKey]],l()(r)))}else i.error&&i[this.defaultProps.label]&&i.code&&(this.conflictItem||(this.conflictItem=i),t.push(i[a.nodeKey]))}return t},undefinedDsf:function(e){for(var t=[],a=this.defaultProps,s=0;s<e.length;s++){var i=e[s];if(i.children&&i.children.length>0)if(i[this.defaultProps.label]&&""!==i.code){var r=this.undefinedDsf(i.children);r.length>0&&(t=[].concat(l()(t),[i[a.nodeKey]],l()(r)))}else t.push(i[a.nodeKey]);else i[this.defaultProps.label]&&""!==i.code||t.push(i[a.nodeKey])}return t},tableRowClassName:function(e){var t=e.row;return"0"===t.importData?"disabled":""},errorSeting:function(e,t,a,s){e.error=t,e.errorType=a,e.msg=s},changeName:function(e){var t=e.row;if(!t[this.defaultProps.label])return this.errorSeting(t,!0,"1","请输入名称"),this.compareTree(),!1;t.cover?(this.errorSeting(t,!1),this.compareTree()):"1"==t.errorType&&this.lintCode(e)},extendTree:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=[],a=row,s=a.children,i=x()(a,C);return t.push(i),s?[].concat(t,l()(s.forEach(extendTree))):t})),checkChildren:function(e){var t=this,a=e.code,s=e.gid.split(".");s[s.length-1]=a,e.gid=s.join(".");var i=dsf.layer.loading();this.$http.post("rm/repetitionRmTree",JSON.stringify({tagId:this.importData.tagId,targetId:this.targetKeys,dataTrees:[e]}),{headers:{"Content-Type":"application/json; charset=utf-8"}},!0).done((function(a){if(a.success){var s=a.data.rmDataTrees[0],i=l()(t.data);while(i.length){var r,n=i.shift();if(n[t.defaultProps.nodeKey]===s[t.defaultProps.nodeKey]){s.msg&&(s.cover=null,s.error=!0);var o=s.children;Object.assign(n,s),t.tableData=[n].concat(l()(o||[]))}null===(r=n.children)||void 0===r||r.forEach((function(e){i.push(e)}))}t.initTable()}else t.errorSeting(e,!0,"2","该标识已存在")})).error((function(e){dsf.layer.message(e.message,!1)})).always((function(){dsf.layer.closeLoading(i)}))},lintCode:function(e){var t=this,a=e.row,s=a.code;if(!a[this.defaultProps.label])return this.errorSeting(a,!0,"1","请输入名称"),!1;if(!s)return this.errorSeting(a,!0,"2","请输入标识"),this.compareTree(),!1;if(a.cover)return a.error=!1,a.errorType=void 0,a.msg="",!1;if("0"===a.pageValue)return this.checkChildren(a),!1;var i=dsf.layer.loading(),r=a.gid.split(".");r[r.length-1]=s,a.gid=r.join("."),this.$http.post("rm/checkRepetition",{gId:a.gid,pageValue:a.pageValue,targetId:this.targetKeys},null,!0).done((function(e){e.success?t.errorSeting(a,!1):t.errorSeting(a,!0,"2","该标识已存在"),t.compareTree()})).error((function(e){dsf.layer.message(e.message,!1)})).always((function(){dsf.layer.closeLoading(i)}))},replace:function(e,t,a){var s,i=this,r=e.row;return!(!r.cover&&!r["error"])&&(r[this.defaultProps.label]?r.code?void(!r.cover||r.cover!=t||a?(r.cover=t,r.error=!1,r.msg="",null===(s=r.children)||void 0===s||s.forEach((function(e){return i.replace({row:e},t,!0)})),this.compareTree()):(r.cover=null,this.lintCode(e))):(this.errorSeting(r,!0,"2","请输入标识"),this.compareTree(),!1):(this.errorSeting(r,!0,"1","请输入名称"),this.compareTree(),!1))},copyRow:function(e,t){var a=e.row;a.copyType=t},preStep:function(){this.$emit("changeStep",{step:1})},cancel:function(e){this.$emit("close",e)},operate:function(e){var t=this,a=0,s="导入";if(this.conflictList.length)return dsf.layer.message("有重复标识",!1),!1;if(this.undefinedList.length)return dsf.layer.message("有未填写数据",!1),!1;switch(e){case"copy":s="复制";break;case"move":a=1,s="移动";break}var i=dsf.layer.loading();this.$http.post("rm/importRm",JSON.stringify({tagId:this.importData.tagId,targetRmId:this.targetKeys,cut:a,importData:this.data}),{headers:{"Content-Type":"application/json; charset=utf-8"}},!0).done((function(e){e.success?(dsf.layer.message("".concat(s,"成功")),t.cancel(!0)):dsf.layer.message("".concat(s,"失败"),!1)})).error((function(e){var t;dsf.layer.message(e.message||(null===(t=e.error)||void 0===t?void 0:t.message)||"请求异常",!1)})).always((function(){dsf.layer.closeLoading(i)}))}}},S=k,w=Object(m["a"])(S,y,b,!1,null,null,null),T=w.exports,D=dsf.component({name:"DsfCatalogueOptions",ctrlCaption:"资源目录操作",mixins:[$mixins.control],components:{SelectList:v,OperateList:T},provide:function(){return{operateType:this.operateType,selectKeys:this.selectKeys,limitKeys:this.limitKeys}},computed:{_importData:function(){return this.importData}},props:{operateType:{type:String,default:"copy"},selectKeys:{type:Array,default:function(){return[]}},limitKeys:{type:Array,default:function(){return[]}},importData:{type:Object,default:function(){return{}}},targetKeys:{type:String,default:""}},data:function(){return{importDataUpdate:this.importData,targetKeysUpdate:this.targetKeys,step:"import"!==this.operateType?1:2}},watch:{step:function(e){switch(e){case 1:"copy"===this.operateType&&this.alterTitle("选择复制内容"),"move"===this.operateType&&this.alterTitle("选择移动内容");break;case 2:"copy"!==this.operateType&&"move"!==this.operateType||this.alterTitle("已选数据"),"export"===this.operateType&&this.alterTitle("导出"),"import"===this.operateType&&this.alterTitle("导入");break}}},methods:{alterTitle:function(e){this.$dialog&&$(this.$dialog.$el).find(".el-dialog__title").text(e)},cancel:function(e){var t,a;this.$dispatch("moveSuccessEnd",e),null===(t=this.$dialog)||void 0===t||t.close(),e&&(null===(a=this.$dialog)||void 0===a||null===(a=a.openerVm)||void 0===a||a.reloadData())},changeStep:function(e){var t=this,a=e.step,s=e.data;2===a&&(this.importDataUpdate=s.importData,this.targetKeysUpdate=s.targetKeys),this.$nextTick((function(){t.step=a}))}}}),N=D,E=(a(640),Object(m["a"])(N,s,i,!1,null,null,null));t["default"]=E.exports},961:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"catalogue-warp"},[1===e.step?[a("SelectList",{attrs:{selectKeys:e.selectKeys,operateType:e.operateType},on:{close:e.cancel,changeStep:e.changeStep}})]:e._e(),2===e.step?[a("OperateList",{attrs:{importData:e.importDataUpdate,targetKeys:e.targetKeysUpdate},on:{close:e.cancel,changeStep:e.changeStep}})]:e._e()],2)},i=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"catalogue-options"},[a("div",{staticClass:"catalogue-options-center"},[a("div",{staticClass:"catalogue-options-center-left"},[a("el-scrollbar",{staticClass:"catalogue-options-scroll"},[a("el-tree",{ref:"tree",attrs:{"show-checkbox":"",props:e.defaultProps,"empty-text":e.loading?"数据加载中...":"暂无数据","highlight-current":!0,data:e.Treedata,"node-key":"_id","default-checked-keys":e.checkedKeys,"default-expanded-keys":e.expandedKeys,"expand-on-click-node":!1},on:{check:e.checkKeys,"current-change":e.currNodeChange},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node"},[a("i",{staticClass:"iconfont",class:s.expanded?"icon-dakai":"icon-wenjianjia",staticStyle:{color:"#c78511"}}),e._v("   "),a("span",{domProps:{innerHTML:e._s(e.dsf.safe.xss(i[e.defaultProps.label]))}})])}}])})],1)],1),a("div",{staticClass:"catalogue-options-center-right"},[a("div",{staticClass:"catalogue-options-out-box"},[a("el-table",{ref:"multipleTable",staticClass:"catalogue-options-table",attrs:{size:"small",height:"100%",data:e.tableData,border:""},on:{select:e.selectTable,"select-all":e.selectTable}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),a("el-table-column",{attrs:{label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["_name"]))])]}}])}),a("el-table-column",{attrs:{label:"标识简称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["code"]))])]}}])}),a("el-table-column",{attrs:{label:"PC菜单是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["status_text"]))])]}}])}),a("el-table-column",{attrs:{label:"快捷菜单是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["scstatus_text"]))])]}}])}),a("el-table-column",{attrs:{label:"移动端菜单是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row["mobile_status_text"]))])]}}])})],1)],1)])]),a("div",{staticClass:"catalogue-options-footer"},[a("div",{staticClass:"catalogue-options-footer-left"},["export"!==e.operateType?[e._v(" "+e._s(e.operaType)+"到目录下方   "),a("el-cascader",{ref:"cascader",staticClass:"cascader",attrs:{size:"small",options:e.data,props:Object.assign({},e.defaultProps,{checkStrictly:!0}),clearable:""},on:{change:e.change}})]:e._e()],2),a("div",["copy"===e.operateType||"move"===e.operateType?[a("DsfButton",{on:{click:e.nextStep}},[e._v("下一步")])]:e._e(),a("DsfButton",{staticClass:"plain",on:{click:e.cancel}},[e._v("取消")])],2)])])},n=[],o=a(2),l=a.n(o),c=a(4),d=a.n(c),u=a(1),p=a.n(u),f={name:"selectList",inject:["operateType","selectKeys","gids"],data:function(){return{tableData:[],data:[],Treedata:[],defaultProps:{children:"children",label:"_name",key:"_id",value:"_id"},loading:!1,currentNode:"",checkedKeys:[],expandedKeys:[]}},created:function(){this.initLoadData("left"),"export"!==this.operateType&&this.initLoadData("bottom")},computed:{operaType:function(){var e="";switch(this.operateType){case"copy":e="复制";break;case"move":e="移动";break;case"import":e="导入";break}return e}},mounted:function(){this.checkedKeys=this.$refs.tree.getCheckedKeys()},watch:{checkedKeys:{handler:function(e){var t=this,a=this.defaultProps.key;this.tableData.forEach((function(s){t.$refs.multipleTable.toggleRowSelection(s,e.includes(s[a]))}))},deep:!0}},methods:{change:function(){this.$refs.cascader.toggleDropDownVisible(!1)},nextStep:function(){var e=this,t=this.$refs.tree.getCheckedNodes(!1,!1),a=this.$refs.cascader.getCheckedNodes(!0);if(0===t.length)return dsf.layer.message("请选择内容",!1),!1;if(0===a.length)return dsf.layer.message("请选择目录",!1),!1;var s=t.map((function(e){return e._id})),i=a[0].data._id,r=dsf.layer.loading(),n="menu2/copyMenuData",o={menuIds:s,targetId:i,appKey:dsf.url.queryString("appKey")};this.$http.post(n,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}},!0).done((function(t){t.success?e.$emit("changeStep",{step:2,data:{importData:t.data,targetKeys:i}}):dsf.layer.message(t.message,!1)})).always((function(){dsf.layer.closeLoading(r)}))},initLoadData:function(e){var t=this,a=dsf.layer.loading(),s=this.selectKeys.length?this.selectKeys.join(","):"",i=this.gids.length?this.gids.join(","):"",r={},n="/menu2/list/tree?appKey="+dsf.url.queryString("appKey");r="bottom"===e?{excludes:s}:{gid:i},this.$http.get(n,r,null,!0).done((function(a){if(a.success){var s=t.defaultProps.key,i=[];if(i=Array.isArray(a.data)?a.data:[a.data],"bottom"===e)t.data=i;else{t.Treedata=i;var r=[],n=function e(t){t.forEach((function(t){r.push(t[s]),t.children&&e(t.children)}))};n(t.Treedata),t.$refs.tree.setCheckedKeys(r),t.expandedKeys=i.map((function(e){return e[s]}))}}else dsf.layer.message(a.message,!1)})).error((function(e){var t;dsf.layer.message(e.message||(null===(t=e.error)||void 0===t?void 0:t.message)||"查询目录失败",!1)})).always((function(){t.loading=!1,dsf.layer.closeLoading(a)}))},currNodeChange:function(e,t){var a=this;return d()(p.a.mark((function t(){var s;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=a.defaultProps.key,!a.currentNode||a.currentNode[s]!==e[s]){t.next=3;break}return t.abrupt("return",!1);case 3:return a.currentNode=e,a.$refs.tree.setChecked(e[s],!0,!0),t.next=7,a.initTable();case 7:a.checkedKeys=a.$refs.tree.getCheckedKeys();case 8:case"end":return t.stop()}}),t)})))()},checkKeys:function(e,t){var a=this.$refs.tree.getCheckedKeys();this.checkedKeys=a},initTable:function(){var e=l()(this.Treedata);while(e.length){var t,a=e.shift();null===(t=a.children)||void 0===t||t.forEach((function(t){e.push(t)})),a._id===this.currentNode._id&&(this.tableData=a.children||[],e=[])}},selectTable:function(e){var t=this,a=this.defaultProps.key,s=this.tableData.filter((function(t){return!e.some((function(e){return e[a]===t[a]}))})).map((function(e){return e[a]})),i=e.map((function(e){return e[a]}));s.forEach((function(e){return t.$refs.tree.setChecked(e,!1,!0)})),i.forEach((function(e){return t.$refs.tree.setChecked(e,!0,!0)}));var r=this.$refs.tree.getCheckedKeys();this.checkedKeys=r},cancel:function(){this.$emit("close")}}},h=f,m=a(0),g=Object(m["a"])(h,r,n,!1,null,null,null),v=g.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"catalogue-options"},[a("div",{staticClass:"catalogue-options-center"},[a("div",{staticClass:"catalogue-options-center-left"},[a("el-scrollbar",{staticClass:"catalogue-options-scroll"},[a("el-tree",{ref:"tree",attrs:{props:e.defaultProps,"empty-text":e.loading?"数据加载中...":"暂无数据","highlight-current":!0,data:e.data,"node-key":"_id","default-expanded-keys":e.expandedKeys,"expand-on-click-node":!1},on:{"current-change":e.currNodeChange},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node",class:{"disabeled-tree":"0"===i.importData}},[i[e.defaultProps.children]?a("i",{staticClass:"iconfont",class:[s.expanded?"icon-dakai":"icon-wenjianjia"],staticStyle:{color:"#c78511"}}):a("i",{staticClass:"iconfont icon-shiyongwendang",staticStyle:{color:"#c78511"}}),e._v("   "),a("span",{staticClass:"custom-tree-node-name",attrs:{title:i[e.defaultProps.label]},domProps:{innerHTML:e._s(e.dsf.safe.xss(i[e.defaultProps.label]))}}),e._v("   "),e.undefinedList.includes(i[e.defaultProps.nodeKey])||!0===i.error?a("i",{staticClass:"error iconfont icon--zhongdaweixian"}):e._e()])}}])})],1)],1),a("div",{staticClass:"catalogue-options-center-right"},[a("div",{staticClass:"catalogue-options-out-box"},[a("el-table",{ref:"multipleTable",staticClass:"catalogue-options-table",attrs:{size:"small",height:"100%","highlight-current-row":!1,"cell-class-name":e.tableRowClassName,data:e.tableData,border:""}},[a("el-table-column",{attrs:{label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"table-input",class:{error:!0===t.row["error"]&&"1"===t.row["errorType"]},attrs:{size:"small",disabled:"0"===t.row["importData"]},on:{change:function(a){return e.changeName(t)}},model:{value:t.row[e.defaultProps.label],callback:function(a){e.$set(t.row,e.defaultProps.label,a)},expression:"scope.row[defaultProps.label]"}})]}}])}),a("el-table-column",{attrs:{label:"标识简称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"table-input",attrs:{size:"small",disabled:"0"===t.row["importData"]},model:{value:t.row["code"],callback:function(a){e.$set(t.row,"code",a)},expression:"scope.row['code']"}})]}}])}),a("el-table-column",{attrs:{label:"PC菜单是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.status_text)+" ")]}}])}),a("el-table-column",{attrs:{label:"快捷菜单是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.scstatus_text)+" ")]}}])}),a("el-table-column",{attrs:{label:"移动端菜单是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.mobile_status_text)+" ")]}}])})],1)],1)])]),a("div",{staticClass:"catalogue-options-footer"},[a("div",{staticClass:"catalogue-options-footer-left"},[e._v(" "+e._s(e.operaType)+"到目录下方   "),a("el-cascader",{ref:"cascader",staticClass:"cascader",attrs:{size:"small",disabled:!0,options:e.targetdata,props:Object.assign({},e.defaultPropsCascader,{checkStrictly:!0}),clearable:""},model:{value:e.targetKeys,callback:function(t){e.targetKeys=t},expression:"targetKeys"}})],1),a("div",{staticClass:"btns"},[e.undefinedList.length?a("span",{staticClass:"error"},[e._v(" 存在未填写数据 ")]):e._e(),"import"!=e.operateType?a("DsfButton",{on:{click:e.preStep}},[e._v(" 上一步 ")]):e._e(),"import"===e.operateType?a("DsfButton",{on:{click:function(t){return e.operate("import")}}},[e._v(" 导入 ")]):e._e(),"copy"===e.operateType?a("DsfButton",{on:{click:function(t){return e.operate("copy")}}},[e._v(" 复制 ")]):e._e(),"move"===e.operateType?a("DsfButton",{on:{click:function(t){return e.operate("move")}}},[e._v(" 移动 ")]):e._e(),a("DsfButton",{staticClass:"plain",on:{click:e.cancel}},[e._v("取消")])],1)])])},b=[],_={name:"OperateList",inject:["operateType"],props:{importData:{type:Array,default:function(){return[]}},targetKeys:{type:String,default:""}},data:function(){return{tableData:[],data:this.importData,loading:!1,targetdata:[],defaultProps:{children:"children",label:"name",nodeKey:"_id",value:"_id",disabled:function(e){return"0"===e.importData}},defaultPropsCascader:{children:"children",label:"_name",value:"_id"},currentNodeId:"",expandedKeys:[],undefinedList:[]}},computed:{operaType:function(){var e="";switch(this.operateType){case"copy":e="复制";break;case"move":e="移动";break;case"import":e="导入";break}return e}},created:function(){this.initTargetData(),this.initTable()},methods:{initTable:function(){if(this.tableData.length)return!1;var e=l()(this.data);while(e.length){var t,a=e.shift();null===(t=a.children)||void 0===t||t.forEach((function(t){e.push(t)})),"1"===a.importData&&(this.expandedKeys=[a._id],e=[])}},initTargetData:function(){var e=this,t=dsf.layer.loading();this.$http.get("/menu2/list/tree?appKey="+dsf.url.queryString("appKey"),{},null,!0).done((function(t){if(t.success){var a=[];a=Array.isArray(t.data)?t.data:[t.data],e.targetdata=a}else dsf.layer.message(t.message,!1)})).error((function(e){var t;dsf.layer.message(e.message||(null===(t=e.error)||void 0===t?void 0:t.message)||"查询目录失败",!1)})).always((function(){e.loading=!0,dsf.layer.closeLoading(t)}))},compareTree:function(){this.undefinedList=this.undefinedDsf(this.data)},currNodeChange:function(e){this.currentNodeId=e[this.defaultProps.value];var t=e.children;this.tableData=[e].concat(l()(t||[]))},undefinedDsf:function(e){for(var t=[],a=this.defaultProps,s=0;s<e.length;s++){var i=e[s];if(i.children&&i.children.length>0)if(i[this.defaultProps.label]){var r=this.undefinedDsf(i.children);r.length>0&&(t=[].concat(l()(t),[i[a.nodeKey]],l()(r)))}else t.push(i[a.nodeKey]);else i[this.defaultProps.label]||t.push(i[a.nodeKey])}return t},tableRowClassName:function(e){var t=e.row;return"0"===t.importData?"disabled":""},errorSeting:function(e,t,a,s){this.$set(e,"error",t),this.$set(e,"errorType",a),this.$set(e,"msg",s)},changeName:function(e){var t=e.row;if(!t[this.defaultProps.label])return this.errorSeting(t,!0,"1","请输入名称"),this.compareTree(),!1;t.cover?(this.errorSeting(t,!1),this.compareTree()):"1"==t.errorType&&this.lintCode(e)},lintCode:function(e){var t=e.row;return t[this.defaultProps.label]?t.cover?(this.$set(t,"error",!1),this.$set(t,"errorType",void 0),this.$set(t,"msg",""),!1):(this.errorSeting(t,!1),void this.compareTree()):(this.errorSeting(t,!0,"1","请输入名称"),!1)},preStep:function(){this.$emit("changeStep",{step:1})},cancel:function(e){this.$emit("close",e)},operate:function(e){var t=this,a="导入";if(this.undefinedList.length)return dsf.layer.message("有未填写数据",!1),!1;switch(e){case"copy":a="复制";break;case"move":1,a="移动";break}var s=dsf.layer.loading();this.$http.post("menu2/copyMenu",JSON.stringify({targetId:this.targetKeys,data:this.data}),{headers:{"Content-Type":"application/json; charset=utf-8"}},!0).done((function(e){e.success?(dsf.layer.message("".concat(a,"成功")),t.cancel(!0)):dsf.layer.message("".concat(a,"失败"),!1)})).error((function(e){var t;dsf.layer.message(e.message||(null===(t=e.error)||void 0===t?void 0:t.message)||"请求异常",!1)})).always((function(){dsf.layer.closeLoading(s)}))}}},x=_,C=Object(m["a"])(x,y,b,!1,null,null,null),k=C.exports,S=dsf.component({name:"DsfMenuOptions",ctrlCaption:"菜单目录操作",mixins:[$mixins.control],components:{SelectList:v,OperateList:k},provide:function(){return{operateType:this.operateType,selectKeys:this.selectKeys,gids:this.gids}},computed:{_importData:function(){return this.importData}},props:{operateType:{type:String,default:"copy"},selectKeys:{type:Array,default:function(){return[]}},gids:{type:Array,default:function(){return[]}},importData:{type:Object,default:function(){return{}}},targetKeys:{type:String,default:""}},data:function(){return{importDataUpdate:this.importData,targetKeysUpdate:this.targetKeys,step:"import"!==this.operateType?1:2}},watch:{step:function(e){switch(e){case 1:"copy"===this.operateType&&this.alterTitle("选择复制内容"),"move"===this.operateType&&this.alterTitle("选择移动内容");break;case 2:"copy"!==this.operateType&&"move"!==this.operateType||this.alterTitle("已选数据"),"export"===this.operateType&&this.alterTitle("导出"),"import"===this.operateType&&this.alterTitle("导入");break}}},methods:{alterTitle:function(e){this.$dialog&&$(this.$dialog.$el).find(".el-dialog__title").text(e)},cancel:function(e){var t,a;this.$dispatch("moveSuccessEnd",e),null===(t=this.$dialog)||void 0===t||t.close(),e&&(null===(a=this.$dialog)||void 0===a||null===(a=a.openerVm)||void 0===a||a.reloadData())},changeStep:function(e){var t=this,a=e.step,s=e.data;2===a&&(this.importDataUpdate=s.importData,this.targetKeysUpdate=s.targetKeys),this.$nextTick((function(){t.step=a}))}}}),w=S,T=(a(642),Object(m["a"])(w,s,i,!1,null,null,null));t["default"]=T.exports},995:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-header",[a("div",{staticStyle:{"text-align":"right",height:"auto",margin:"0px -20px"}},[a("DsfButton",{attrs:{size:"small",type:"plain"},on:{click:function(t){return e.toChoose("clear")}}},[e._v("清除")]),a("DsfButton",{attrs:{size:"small",type:"plain"},on:{click:function(t){return e.toChoose("election")}}},[e._v("反选")]),a("DsfButton",{attrs:{size:"small"},on:{click:function(t){return e.toChoose("all")}}},[e._v("全选")])],1)]),a("el-main",{staticStyle:{padding:"0px"}},[a("el-checkbox-group",{on:{change:e.handleCheckedChange},model:{value:e.checkboxData,callback:function(t){e.checkboxData=t},expression:"checkboxData"}},e._l(e.listData,(function(t){return a("el-checkbox",{key:t.key,attrs:{label:t.key}},[e._v(e._s(t.alias))])})),1)],1)],1)},i=[],r={name:"DesDataGridExpColChoose",mixins:[$mixins.propertyDialogSetting],data:function(){return{checkboxData:[],listData:this.$attrs["excelMetas"]}},created:function(){this.listData.length&&(this.checkboxData=_.map(this.listData,(function(e){return e.key})))},methods:{toChoose:function(e){var t=this,a=this,s={clear:function(){t.checkboxData=[]},election:function(){t.checkboxData=_.map(_.filter(a.listData,(function(e){return!a.checkboxData.includes(e.key)})),"key")},all:function(){t.checkboxData=t.checkboxData.length<t.listData.length?_.map(t.listData,(function(e){return e.key})):[]}};s[e]&&s[e]()},handleCheckedChange:function(e){this.checkboxData=e},yes:function(){var e=this,t={cols:_.filter(this.listData,(function(t){return e.checkboxData.includes(t.key)}))||[],keys:this.checkboxData||[]};return t}}},n=r,o=a(0),l=Object(o["a"])(n,s,i,!1,null,null,null);t["default"]=l.exports},996:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"des-common-import-error-data-eidt"},[a("div",{staticClass:"table-haed"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.infoText,expression:"infoText"}],staticStyle:{width:"50%",padding:"12px 0"}},[e._v(" "+e._s(e.infoText)+" ")])]),a("div",{staticClass:"table-main"},[e.height?a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{height:e.height,data:e.showTableData,border:"",stripe:""}},[e._l(e.headers,(function(t){return a("el-table-column",{key:t.property,attrs:{label:t.text,"header-align":"center","min-width":e.getTableMinWidth(t)||"0px"},scopedSlots:e._u([{key:"header",fn:function(){return[t.isRequired?a("span",{staticStyle:{color:"red","margin-right":"3px"}},[e._v(" * ")]):e._e(),e._v(" "+e._s(t.text)+" ")]},proxy:!0},{key:"default",fn:function(s){var i=s.row;return[a("div",{staticClass:"table-col"},[i[t.property]?[a("div",{staticClass:"table-col-main"},[a("el-input",{attrs:{size:"mini"},on:{change:function(a){return e.inputChange(t,i,i._id)}},model:{value:i[t.property].value,callback:function(a){e.$set(i[t.property],"value",a)},expression:"row[header.property].value"}})],1),e.getShowMessage(i[t.property])?a("div",{staticClass:"table-col-msg",attrs:{promptType:i[t.property].promptType}},[e._v(" "+e._s(i[t.property].msg)+" ")]):e._e()]:a("div",[e._v(" "+e._s(i[t.property])+" ")])],2)]}}],null,!0)})})),a("el-table-column",{attrs:{fixed:"right",width:"60px",label:"操作","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"table-col"},[a("dsf-button",{staticClass:"table-col-icon",attrs:{title:"删除",size:"small","btn-style":"icon-text",icon:"guanbi2"},on:{click:function(t){return t.stopPropagation(),e.remove(s)}}})],1)]}}],null,!1,3335267719)})],2):e._e()],1),a("div",{staticClass:"table-footer"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[50,100,150,200],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},i=[],r={name:"DesCommonImportErrorDataEidt",mixins:[$mixins.propertyDialogSetting],inject:["$dialog"],props:{fileData:{default:function(){}},servicePrefix:{default:""},infoText:{default:""}},computed:{showTableData:function(){var e=this.tableData,t=this.currentPage,a=this.pageSize,s=(t-1)*a;return this.resize(),e.slice(s,s+a)},isAllConform:function(){return this.tableData.some((function(e){}))}},data:function(){return{headers:[],tableData:[],count:0,height:0,currentPage:1,pageSize:50,rowErrors:{},loading:!0}},created:function(){var e=this;if(this.fileData){this.headers=this.fileData.header,this.tableData=this.fileData.errorData,this.count=this.fileData.count,this.rowRules={},this.dsfValidate=dsf.validate.map||{};for(var t=0;t<this.fileData.rowRules.length;t++){var a=this.fileData.rowRules[t];this.rowRules[a.fieldName]=a}this.buildRowErrors(),this.resize(),setTimeout((function(){e.$nextTick((function(){e.loading=!1}))}))}},mounted:function(){this.height=$(this.$el).find(".table-main")[0].clientHeight},methods:{getShowMessage:function(e){return 1==(null===e||void 0===e?void 0:e.isError)&&(null===e||void 0===e?void 0:e.msg)},getTableMinWidth:function(e){return this.rowRules[e.property].headWidth},buildRowErrors:function(){for(var e=this,t=this.tableData,a=function(a){(function(){var s=t[a];for(var i in s)if(s[i].isError)return e.rowErrors[s._id]=!0;delete e.rowErrors[s._id]})()},s=0;s<t.length;s++)a(s)},resize:function(){var e=this;this.resizeSetTimeout&&clearTimeout(this.resizeSetTimeout),this.resizeSetTimeout=setTimeout((function(){e.$nextTick((function(){e.doLayout()}))}),200)},doLayout:function(){this.elTable=this.$refs.table,this.elTable&&this.elTable.doLayout()},remove:function(e){dsf.array.remove(this.tableData,e)},inputChange:function(e,t,a){var s=this.rowRules[e.property],i=t[e.property],r=s.validationMethod||"";r=n(r),r=this["validate"+r],1==s.isRequired?this.validateIsRequired(i,s,a):!dsf.isUnDef(i.value)&&""!==i.value&&r?r(i,s,a):i.isError=0,this.rowIsError(t)},rowIsError:function(e){for(var t in e)if(e.isError)return this.rowErrors[e._id]=!0;delete this.rowErrors[e._id]},validateIsRequired:function(e,t,a){var s=e.value;e.isError=""==s||null==s||void 0==s?1:0,e.isError&&(e.msg="该字段是必填")},validateUnique:function(e,t,a){e.isError=Number(!!this.tableData.some((function(s){return a!=s._id&&e.value===s[t.fieldName].value}))),e.isError&&(e.msg="该字段已重复")},validateNumber:function(e,t,a){var s=e.value,i=this.dsfValidate["isNumberUnder"].validator,r=this.dsfValidate["isNumberOver"].validator,n=this.dsfValidate["isNumber"].validator,o=this.dsfValidate["precision"].validator,l=t.min,c="number"==dsf.type(l),d=t.max,u="number"==dsf.type(d),p=t.scaleDecimal,f="number"==dsf.type(p),h="该字段应该是";!c&!u&!f?h+="数字":(c&&u?h+="".concat(l,"-").concat(d,"之间"):c?h+="大于或等于".concat(l):u&&(h+="小于或等于".concat(l)),f&&(h+=",并且保留".concat(p,"位小数")),h+="的数字"),"function"!=dsf.type(n)||n(s)?f&&"function"==dsf.type(o)&&!o(s,p)||c&&"function"==dsf.type(i)&&i(s,l)||u&&"function"==dsf.type(r)&&r(s,d)?e.isError=1:e.isError=0:e.isError=1,e.isError&&(e.msg=h)},validateChinese:function(e,t,a){var s=e.value,i=s.length,r=this.dsfValidate["isChinese"].validator,n=t.min,o="number"==dsf.type(n),l=t.max,c="number"==dsf.type(l),d="该字段应该是";o&&c?d+="长度在".concat(n,"-").concat(l,"之间的"):o?d+="长度大于或等于".concat(n,"的"):c&&(d+="长度小于或等于".concat(n,"的")),d+="全中文字符","function"!=dsf.type(r)||r(s)?e.isError=o&&i<n||c&&i>l?1:0:e.isError=1,e.isError&&(e.msg=d)},validateEmail:function(e,t,a){var s=e.value,i=this.dsfValidate["isEmail"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是电子邮箱")},validateLetterNumber:function(e,t,a){var s=e.value,i=this.dsfValidate["isCombination"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段只能包含数字或字母")},validatePostalCode:function(e,t,a){var s=e.value,i=this.dsfValidate["isPostcode"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是邮政编码")},validateNumberPlate:function(e,t,a){var s=e.value,i=this.dsfValidate["isPlateNumber"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是车牌号")},validateTelNumber:function(e,t,a){var s=e.value,i=this.dsfValidate["isMobileOrTelPhone"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是手机号或座机号")},validatePhoneNumber:function(e,t,a){var s=e.value,i=this.dsfValidate["isTelPhone"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是座机号")},validateMobileNumber:function(e,t,a){var s=e.value;/^1\d{10}$/.test(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是手机号")},validateIdCardForce:function(e,t,a){var s=e.value,i=this.dsfValidate["isIDCardFull"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是15或18位身份证号")},validateIdCard:function(e,t,a){var s=e.value,i=this.dsfValidate["isIDCard"].validator;"function"!=dsf.type(i)||i(s)?e.isError=0:e.isError=1,e.isError&&(e.msg="该字段是15或18位身份证号")},validateString:function(e,t,a){var s=e.value,i=s.length,r=t.min,n="number"==dsf.type(r),o=t.max,l="number"==dsf.type(o),c="该字段应该是";n&&l?c+="长度在".concat(r,"-").concat(o,"之间的"):n?c+="长度大于或等于".concat(r,"的"):l&&(c+="长度小于或等于".concat(r,"的")),c+="字符串","string"==dsf.type(s)?e.isError=1:e.isError=n&&i<r||l&&i>o?1:0,e.isError&&(e.msg=c)},handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e},uplodError:function(){var e=this,t=this.tableData,a=dsf.layer.loading();return this.$http.post("/import/recheck",{id:this.fileData.uuid,data:JSON.stringify(t.map((function(e){var t={_id:e._id};for(var a in e)"_id"!=a&&(t[a]=e[a].value);return t})))},this.servicePrefix).then((function(t){var s=t.data;dsf.layer.closeLoading(a);try{if(s&&s.success&&s.data){var i=s.data||{},r=i.count,n=i.errorData,o=i.header,l=i.status;return 1==l?Promise.resolve(s):(e.headers=o||[],e.tableData=n||[],e.count=r||0,dsf.layer.message("有错误数据请修改",!1),e.buildRowErrors(),e.resize(),Promise.reject("有错误数据请修改"))}return 20126==s.state?dsf.layer.alert(s.message||"未知错误"):(dsf.layer.message(s.message,!1),Promise.reject("未知错误"))}catch(c){return console.error(c),Promise.reject(c)}})).catch((function(e){return dsf.layer.closeLoading(a),Promise.reject(e)}))},yes:function(){return this.uplodError()}}};function n(e){return e?e.trim().toLowerCase().replace(e[0],e[0].toUpperCase()):""}var o=r,l=(a(636),a(0)),c=Object(l["a"])(o,s,i,!1,null,null,null);t["default"]=c.exports},997:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.scriptLoaded?a("div",{staticClass:"ds-export-setting"},[!e.customInterface&&e.isNewversion?[a("div",{staticClass:"ds-export-setting-item",style:{"margin-top":e.showExportCustomFieldsSetting?"0":"20px"}},[a("p",[e._v("文件名")]),a("el-input",{model:{value:e.fileNameCopy,callback:function(t){e.fileNameCopy=t},expression:"fileNameCopy"}})],1),e.showExportCustomFieldsSetting?a("div",{staticClass:"ds-export-setting-item"},[a("p",[e._v("模板")]),a("el-select",{attrs:{placeholder:"请选择模板","popper-class":"ds-export-setting-template-select"},on:{change:e.selectChange},model:{value:e.template,callback:function(t){e.template=t},expression:"template"}},e._l(e.templateSelectOptions,(function(t,s){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[a("span",[e._v(e._s(t.name))]),a("i",{staticClass:"el-icon-close",on:{click:function(a){return a.stopPropagation(),e.deleteTemplate(t,s)}}})])})),1),a("DsfButton",{on:{click:e.setTemplate}},[e._v("设置")])],1):e._e()]:e._e(),e.allowList.length>1?a("div",{staticClass:"ds-export-setting-box"},[a("div",{staticClass:"title"},[e._v("导出文件类型")]),a("div",{staticClass:"content file-box"},[e._l(e.allowList,(function(t){return[a("div",{key:t.value,staticClass:"file-radio",class:{active:e.extName===t.value},on:{click:function(a){e.extName=t.value}}},[a("i",{staticClass:"iconfont",class:t.icon,style:{color:t.color}}),a("span",[e._v(e._s(t.text))])])]}))],2)]):e._e(),e.showExportCustomFieldsSetting&&!e.hiddenFieldsSetting?a("div",{staticClass:"ds-export-setting-row"},[a("div",{staticClass:"ds-export-setting-box-wrap"},[a("div",{staticClass:"ds-export-setting-box"},[a("div",{staticClass:"title",staticStyle:{display:"flex","justify-content":"space-between"}},[a("span",[e._v("可选列")]),a("span",[e._v(" 全选"),a("el-checkbox",{staticClass:"ds-export-setting-box-check_all",attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}}),e._v(" 共"+e._s((e.fields||[]).length)+"列")],1)]),a("div",[a("form",{attrs:{action:""},on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.search.apply(null,arguments)}}},[a("el-input",{staticStyle:{padding:"10px 8px 10px 8px"},attrs:{size:"small"},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1)]),a("dsf-virtual-scroll",[e.allowList.length?e._e():a("div",{staticClass:"no-data"},[e._v("暂无可导出的列")]),a("div",{staticClass:"el-checkbox-group"},e._l(e.fieldResult,(function(t){return a("el-checkbox",{key:t.id,attrs:{value:e.selectedIds.indexOf(t.id)>-1},on:{change:function(a){return e.checkboxChange(t,a)}}},[e._v(" "+e._s(t.caption)+" ")])})),1)])],1),a("div",{staticClass:"ds-export-setting-box"},[a("div",{staticClass:"title"},[a("span",[e._v(" 已选列 "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.selectedIds.length,expression:"selectedIds.length"}]},[e._v(" ("+e._s(e.selectedIds.length)+") ")])]),a("span",{staticClass:"tips"},[e._v("拖动列可排序")])]),a("dsf-virtual-scroll",[e.selectedIds.length?a("draggable",e._b({staticClass:"field-list",model:{value:e.selectedFields,callback:function(t){e.selectedFields=t},expression:"selectedFields"}},"draggable",e.options,!1),[e._l(e.selectedFields,(function(t){return[a("div",{key:t.id,staticClass:"field-item"},[a("span",[e._v(e._s(t.caption))]),a("i",{staticClass:"closeBt iconfont icon-guanbi2",on:{click:function(a){return a.stopPropagation(),e.checkboxChange(t,!1)}}})])]}))],2):a("div",{staticClass:"no-data"},[e._v(" 请从左侧选择需要导出的列 ")])],1)],1)]),!e.customInterface&&e.isNewversion?a("div",{staticClass:"template-setting"},[a("p",[e._v("模板名称")]),a("el-input",{model:{value:e.templateName,callback:function(t){e.templateName=t},expression:"templateName"}}),a("DsfButton",{on:{click:e.saveTemplate}},[e._v("保存")])],1):e._e()]):e._e(),a("div",{staticClass:"ds-export-setting-bottom-button",style:e.getStyle()},[a("el-popover",{attrs:{placement:"top",width:"200",trigger:"manual","popper-class":"ds-export-setting-export-button-popover"},model:{value:e.popovervisible,callback:function(t){e.popovervisible=t},expression:"popovervisible"}},[a("div",{staticClass:"tips-message"},[a("DsfIcon",{attrs:{name:"icon-mine-bbh"}}),a("p",[e._v("由于导出时间较长请稍后到文件下载列表中查看")])],1),a("DsfButton",{attrs:{slot:"reference"},on:{click:function(t){return e.clickHandler("export")}},slot:"reference"},[e._v(" 导出 ")])],1),e.showDownloadButton?a("div",{staticClass:"ds-export-setting-downloadlist-button-wrap"},[e.unreadCount>0?a("div",{staticClass:"ds-export-setting-unread-count"},[a("span",[e._v(e._s(e.unreadCount))])]):e._e(),a("DsfButton",{on:{click:function(t){return e.clickHandler("downloadlist")}}},[e._v(" 下载列表 ")])],1):e._e(),a("DsfButton",{attrs:{type:"plain"},on:{click:function(t){return e.clickHandler("cancel")}}},[e._v("取消")])],1)],2):e._e()},i=[],r=a(4),n=a.n(r),o=a(1),l=a.n(o),c={ppt:["icon-ppt","#BF3919"],word:["icon-word1","#1554B8"],excel:["icon-excel","#0F773D"],pdf:["icon-pdf","#B70807"]},d={name:"DsfExportSetting",props:{allow:{type:Array,default:function(){return[]}},fields:{type:Array,default:function(){return[]}},fileName:{type:String,default:""},fieldIds:{type:Array,default:function(){return[]}},showExportCustomFieldsSetting:{type:Boolean,default:!1},nameSpace:{type:String,default:""},pageName:{type:String,default:""},customInterface:{type:Boolean,default:!1},isNewversion:{type:Boolean,default:!1},exportCallback:{type:Function,default:null},showDownloadButton:{type:Boolean,default:!1}},data:function(){return{scriptLoaded:!1,options:{animation:300,forceFallback:!0,draggable:".field-item",filter:".icon-guanbi2",ghostClass:"ghost",chosenClass:"active"},allowList:[],extName:"",selectedIds:[],selectedFields:[],checkAll:!1,indeterminate:!1,searchStr:"",searchInput:"",template:"",templateSelectOptions:[],templateName:"",unreadCount:0,popovervisible:!1,hiddenPopoverTimer:null,hiddenFieldsSetting:!1,fileNameCopy:""}},created:function(){var e,t,a=this;this.loadScript(),_.each(this.allow,(function(e){var t=e.split("|"),s="",i="",r="#999",n=null;if(1==t.length?(s=t[0],i=t[0]):2==t.length?(s=t[0],i=t[1]):3==t.length?(s=t[0],i=t[1],1==t[2]?a.extName=i:t[2].indexOf("icon-")>-1&&(n=t[2])):4==t.length?(s=t[0],i=t[1],n=t[2],1==t[3]&&(a.extName=i)):5==t.length&&(s=t[0],i=t[1],n=t[2],r=t[3],1==t[4]&&(a.extName=i)),!n){var o=c[s.toLocaleLowerCase()];o?(n=o[0],r=o[1]):n="icon-shiyongwendang"}var l={text:s,value:i,icon:n,color:r};a.allowList.push(l)})),!this.extName&&this.allowList.length>=0&&(this.extName=this.allowList[0].value);var s=[],i=[];null!==(e=this.fieldIds)&&void 0!==e&&e.length?_.forEach(this.fieldIds,(function(e){var t=_.find(a.fields,(function(t){return t.id===e}));t&&(s.push(t.id),i.push(t))})):null!==(t=this.fields)&&void 0!==t&&t.length&&(s=_.map(this.fields,"id"),i=_.cloneDeep(this.fields)),this.selectedIds=s,this.selectedFields=i,null!=dsf.storage.session.get("dsExportSettingHiddenFieldsSetting")&&(this.hiddenFieldsSetting=dsf.storage.session.get("dsExportSettingHiddenFieldsSetting")),this.fileNameCopy=this.fileName},computed:{fieldResult:function(){var e=this,t=this.fields;return this.searchStr?_.filter(this.fields,(function(t){return t.caption.indexOf(e.searchStr)>=0})):t}},mounted:function(){this.showExportCustomFieldsSetting&&this.getTemplate(),this.showDownloadButton&&this.getFilecount(!0)},methods:{getStyle:function(){return!this.showExportCustomFieldsSetting||this.hiddenFieldsSetting?{"margin-top":"36px"}:{}},clickHandler:function(e){var t;switch(e){case"export":this.exportCallback(this,this.fileNameCopy||"数据导出");break;case"downloadlist":this.clearUnreadCount(),this.$openWindow(!0,"#/pc/dsfa/async/list?mark=".concat(this.nameSpace,".").concat(this.pageName));break;case"cancel":null===this||void 0===this||null===(t=this.$parent)||void 0===t||null===(t=t.$parent)||void 0===t||t.close();break}},deleteTemplate:function(e,t){var a=this;dsf.layer.confirm({title:"",message:"确认删除【".concat(e.name,"】模板？")}).then(n()(l.a.mark((function s(){var i,r;return l.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,a.deleteTemplateRequest(e.id);case 2:i=s.sent,i&&(a.template===e.id&&(r=_.cloneDeep(a.templateSelectOptions),r.length>1?(a.template=r[t===r.length-1?t-1:t+1].id,a.selectChange(a.template)):a.template=""),a.templateSelectOptions.splice(t,1));case 4:case"end":return s.stop()}}),s)}))))},deleteTemplateRequest:function(e){var t=this;return n()(l.a.mark((function a(){var s;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=!1,a.next=3,t.$http.post("/export/temp/delete",{exportTempIds:e}).done((function(e){var t=e.message,a=e.success;s=a,dsf.layer.message(t||"请求异常",a)}));case 3:return a.abrupt("return",s);case 4:case"end":return a.stop()}}),a)})))()},selectChange:function(e){var t=_.find(this.templateSelectOptions,(function(t){return t.id===e}));if(t){this.templateName=null===t||void 0===t?void 0:t.name;var a=t.fields.split(","),s=_.filter(this.fieldResult,(function(e){return a.includes(e.id)}));s=s.sort((function(e,t){return a.indexOf(e.id)-a.indexOf(t.id)})),this.selectedIds=_.map(s,"id"),this.selectedFields=_.cloneDeep(s)}},getTemplate:function(){var e=this;this.$http.get("/export/temp/query",{pageId:"".concat(this.nameSpace,".").concat(this.pageName)}).done((function(t){var a=t.data,s=t.message,i=t.success;i?(e.templateSelectOptions=[],_.forEach(a,(function(t){e.isequal(t.fields)&&(e.template=t.id,e.templateName=t.name),e.templateSelectOptions.push(t)}))):dsf.layer.message(s||"请求异常",!1)}))},isequal:function(e){var t=this.selectedIds,a=e.split(","),s=_.filter(a,(function(e){return!t.includes(e)}));return a.length===t.length&&0===s.length},setTemplate:function(){this.popovervisible&&(this.popovervisible=!1),this.hiddenFieldsSetting=!this.hiddenFieldsSetting,dsf.storage.session.set("dsExportSettingHiddenFieldsSetting",this.hiddenFieldsSetting)},saveTemplate:function(){var e=this;if(this.selectedFields.length)if(this.templateName){var t=_.map(this.selectedFields,"id").join(","),a=_.find(this.templateSelectOptions,(function(t){return e.templateName&&t.name===e.templateName}))||{},s=(null===a||void 0===a?void 0:a.id)||"",i={id:s,pageId:"".concat(this.nameSpace,".").concat(this.pageName),name:this.templateName,fields:t,order:this.templateSelectOptions.length+1};this.$http.post("/export/temp/save",i).done((function(t){var a=t.message,s=t.success;s&&e.getTemplate(),dsf.layer.message(a||"请求异常",s)}))}else dsf.layer.message("请输入模板名称",!1);else dsf.layer.message("请选择要导出的数据字段",!1)},asyncExportFunc:function(e,t,a,s,i){var r=this,n=e.getQueryInfo(),o=e.isAllSelected?[]:_.map(e.multipleSelection,"_id"),l=dsf.mix({rule:e.caption+"."+t,query:JSON.stringify(n.query),order:JSON.stringify(n.order),filter:JSON.stringify(n.filter),fileName:a,extName:this.extName,params:JSON.stringify(s),namespace:e.$vm?e.$vm.nameSpace:"",pageName:e.$vm?e.$vm.pageName:"",ids:o.join(","),serialNum:i?1:0,client_info:dsf.base64.encode(JSON.stringify(dsf.client.info)),fields:JSON.stringify(_.map(this.selectedFields,"id"))},e.queryString),c=dsf.layer.loading();e.isAllPageSelect&&(l.checkbox=e.isAllSelected||0===o.length?"all":"page"),this.$http.get("/office/excel/export/metaAsync",l,!0).done((function(e){var t=e.success,a=e.message;if(t){dsf.layer.message("提交导出任务成功",!0);var s=setTimeout((function(){r.getFilecount(),clearTimeout(s)}),500)}else dsf.layer.message(a,!1)})).always((function(){dsf.layer.closeLoading(c)}))},getFilecount:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||(this.popovervisible=!0);var a=t?0:1;this.$http.get("/async/task/unread?mark=".concat(this.nameSpace,".").concat(this.pageName)).then((function(s){var i=s.data,r=i.data,n=i.success,o=i.message;n?(e.unreadCount=r||a,!e.popovervisible||e.hiddenPopoverTimer||t||(e.hiddenPopoverTimer=setTimeout((function(){e.popovervisible=!1,clearTimeout(e.hiddenPopoverTimer),e.hiddenPopoverTimer=null}),5e3))):(dsf.layer.message(o||"请求异常",!1),e.popovervisible=!1)}))},clearUnreadCount:function(){this.unreadCount=0},search:function(){this.searchStr=this.searchInput},handleCheckAllChange:function(e){var t=this;this.isIndeterminate=!1,e?_.each(this.fields,(function(e){dsf.array.ensure(t.selectedIds,e.id),dsf.array.ensure(t.selectedFields,e)})):_.each(this.fields,(function(e){dsf.array.remove(t.selectedIds,e.id),dsf.array.remove(t.selectedFields,(function(t){return t.id===e.id}))}))},checkAllChange:function(){},yes:function(){return{extName:this.extName,fields:this.selectedFields,fieldIds:_.map(this.selectedFields,"id")}},loadScript:function(e){var t=this;dsf.http.importFiles([dsf.url.getWebPath("$/js/libs/vuedraggable/Sortable-1.13.0.js"),dsf.url.getWebPath("$/js/libs/vuedraggable/vuedraggable.umd.js")]).then((function(){t.scriptLoaded=!0,null===e||void 0===e||e()})).catch((function(e){console.error(e),dsf.layer.message("加载fabric文件报错",!1)}))},checkboxChange:function(e,t){t?(dsf.array.ensure(this.selectedIds,e.id),dsf.array.ensure(this.selectedFields,e)):(dsf.array.remove(this.selectedIds,e.id),dsf.array.remove(this.selectedFields,(function(t){return t.id===e.id})))}},watch:{selectedIds:{handler:function(e,t){this.selectedIds.length?this.fields.length!=this.selectedIds.length?(this.isIndeterminate=!0,this.checkAll=!1):(this.isIndeterminate=!1,this.checkAll=!0):(this.checkAll=!1,this.isIndeterminate=!1)},immediate:!0}}},u=d,p=(a(638),a(0)),f=Object(p["a"])(u,s,i,!1,null,null,null);t["default"]=f.exports},998:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.validateing,expression:"validateing"}],staticClass:"ds-verify ds-slide-verify",class:e.pageState},[a("div",{staticClass:"panel"},[a("div",{staticClass:"toolbar"},[a("i",{staticClass:"iconfont icon-shuaxin",attrs:{title:"刷新"},on:{click:e.refresh}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showImg,expression:"showImg"}],staticClass:"img-box"},[e.bgImgSrc?a("img",{attrs:{alt:"验证背景",src:"data:image/png;base64,"+e.bgImgSrc},on:{load:e.imgLoadSuccess}}):e._e(),e.sliceImgSrc?a("img",{staticClass:"slice",style:{left:e.sliderLeft+"px",top:e.sliceTop+"px"},attrs:{alt:"验证滑块",src:"data:image/png;base64,"+e.sliceImgSrc},on:{load:e.imgLoadSuccess}}):e._e()]),a("div",{staticClass:"loader"},["loading"==e.pageState?a("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],attrs:{"element-loading-text":"拼命加载中"}}):e._e(),"loadErr"==e.pageState?a("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],attrs:{"element-loading-text":"加载异常","element-loading-spinner":"el-icon-close"}}):e._e()])]),a("div",{staticClass:"control",class:{moving:e.moving,error:"verifyErr"==e.pageState,success:"verifySucc"==e.pageState,open:"loaded"==e.pageState}},[a("div",{staticClass:"bar",style:{width:e.sliderLeft+44+"px"}}),a("div",{ref:"slider",staticClass:"slider",style:{left:e.sliderLeft+"px"}},[a("i",{class:["iconfont","icon-"+e.iconName]})]),a("div",{staticClass:"text-box"},[e._v("向右拖动滑块填充拼图")])])])},i=[],r=a(430),n={name:"DsfPlatformSlideVerify",ctrlCaption:"滑块验证",mixins:[r["a"]],data:function(){return{loadSuccImgNum:0,sliceImgSrc:"",sliderLeft:-1,moving:!1,sliceTop:0,codeMode:3}},computed:{showImg:function(){return 2==this.loadSuccImgNum}},mounted:function(){this.initDrag()},methods:{initDrag:function(){var e=this;$(this.$refs.slider).draggable({axis:"x",containment:"parent",start:function(t,a){e.moving=!0},drag:function(t,a){e.sliderLeft=a.position.left,e.xArray.push(parseInt(a.position.left)),e.yArray.push(parseInt(t.offsetY)),e.timeStampArray.push((new Date).getTime())},stop:function(t,a){e.validate(parseInt(e.sliderLeft))}})},getImgsHandle:function(e){this.bgImgSrc=e.originalImageBase64,this.sliceImgSrc=e.sliderImageBase64,this.sliceTop=e.y},imgLoadSuccess:function(){this.loadSuccImgNum++},refreshHandle:function(){this.moving=!1,this.sliderLeft=-1,this.loadSuccImgNum=0}}},o=n,l=a(0),c=Object(l["a"])(o,s,i,!1,null,null,null);t["default"]=c.exports},999:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.validateing,expression:"validateing"}],staticClass:"ds-verify ds-select-verify",class:e.pageState},[a("div",{staticClass:"panel"},[a("div",{staticClass:"toolbar"},[a("i",{staticClass:"iconfont icon-shuaxin",attrs:{title:"刷新"},on:{click:e.refresh}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:"loading"!=e.pageState,expression:"pageState!='loading'"}],staticClass:"img-box"},[e.bgImgSrc&&"loading"!=e.pageState?a("img",{attrs:{alt:"验证背景",src:"data:image/png;base64,"+e.bgImgSrc}}):e._e()]),a("div",{staticClass:"loader",on:{click:e.selectHandle}},["loading"==e.pageState?a("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],attrs:{"element-loading-text":"拼命加载中"}}):e._e(),e._l(e.results,(function(t,s){return a("span",{key:t.x,staticClass:"img-water",style:{left:t.left+"px",top:t.top+"px"},attrs:{index:s}},[e._v(e._s(s+1))])}))],2)]),a("div",{staticClass:"control msg",class:{error:"verifyErr"==e.pageState,success:"verifySucc"==e.pageState}},["verifySucc"==e.pageState?[a("i",{class:["iconfont","icon-"+e.iconName]}),e._v(" 验证成功 ")]:"verifyErr"==e.pageState?[a("i",{class:["iconfont","icon-"+e.iconName]}),e._v(" 验证失败 ")]:"loaded"==e.pageState?[e._v(" 请依次点击"),e._l(e.words,(function(t,s){return a("span",{key:s},[e._v('"'+e._s(t)+'"')])}))]:"loadErr"==e.pageState?[e._v(" 加载异常 ")]:[e._v("加载中")]],2)])},i=[],r=a(430),n={name:"DsfPlatformSelectVerify",ctrlCaption:"点选验证",mixins:[r["a"]],data:function(){return{codeMode:4,words:[],results:[],num:0,behavior:[]}},methods:{getImgsHandle:function(e){this.bgImgSrc=e.imageBase64,this.words=e.words,this.num=e.words.length},refreshHandle:function(){this.bgImgSrc=null,this.bgImgwords=null,this.results=[],this.num=0,this.behavior=[]},selectHandle:function(e){var t=this;if("loaded"==this.pageState)if("img-water"===e.target.className)this.results.splice(e.target.getAttribute("index"),1);else if(this.results.push({left:parseInt(e.offsetX),top:parseInt(e.offsetY),time:(new Date).getTime()}),this.num&&this.results.length==this.num){var a=[],s=[];this.xArray=[],this.yArray=[],this.timeStampArray=[],_.forEach(this.results,(function(e){var i=e.left,r=e.top,n=e.time;a.push(i),s.push(r),t.xArray.push(i),t.yArray.push(r),t.timeStampArray.push(n)})),this.validate(a.join(",")+";"+s.join(","))}}}},o=n,l=a(0),c=Object(l["a"])(o,s,i,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_sys_modal.js.map