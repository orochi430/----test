/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[53],{731:function(e,t,n){var i=n(732),o=n(733);function s(e,t,n){if(o())return Reflect.construct.apply(null,arguments);var s=[null];s.push.apply(s,t);var a=new(e.bind.apply(e,s));return n&&i(a,n.prototype),a}e.exports=s,e.exports.__esModule=!0,e.exports["default"]=e.exports},732:function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t,i)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},733:function(e,t){function n(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(e.exports=n=function(){return!!t},e.exports.__esModule=!0,e.exports["default"]=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},984:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"edit",staticClass:"dsf-monaco-editor-custom",style:e.style})},o=[],s=n(731),a=n.n(s),r=n(2),l=n.n(r),c=n(3),d=n.n(c),u=n(8),h=n.n(u),m={},f={},g={};function p(e,t){if(dsf.isArray(t)){var n=[],i=e.trim().replace(/[\s\S]+[ ;]+([\s\S]+)/,""),o=i.split("."),s=o.splice(-1),a=function(e,i){var o=[];function s(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=-1,a=0;a<t.length;a++){if(t[a].value==e[n]||t[a].name==e[n]){i=a,o=t[a].children||[];break}o=[]}-1===i||dsf.isUnDef(e[n+1])||s(t[i].children,n+1)}if(0===e.length?o=t:s(t),o.length)for(var a=0;a<o.length;a++){var r=o[a],l=r.name,c=r.value,d=r.type,u=r.detail;n.push({label:l,kind:monaco.languages.CompletionItemKind[d||"Function"],insertText:"".concat(c).concat("Function"===d?"()":""),detail:u,filterText:l.replace(/[\u4e00-\u9fa5\w]/g,"$&-"),sortText:"1"})}};return 0!==o.length?a(o,s[0]):a([],s[0]),{suggestions:n}}return{suggestions:[]}}var v=function(e,t,n){if(e&&t.length){dsf.isEmptyObject(m)&&_.map(Object.keys(m),(function(e){var t;null===(t=m[e])||void 0===t||t.dispose()}));var i=function(t,i){var o={startLineNumber:i.lineNumber,startColumn:1,endLineNumber:i.lineNumber,endColumn:i.column},s=t.getValueInRange(o);if(n&&dsf.isFunction(n)){var a=n(t,i,s),r=a.suggestions;return{suggestions:r}}var l=p(s,e),c=l.suggestions;return{suggestions:c}};_.forEach(t,(function(e){m[e]=monaco.languages.registerCompletionItemProvider(e,{provideCompletionItems:i,triggerCharacters:[".","@","#"]})}))}},C=function(e,t){_.forEach(t,(function(e){m[e]=monaco.languages.registerCompletionItemProvider(e,{provideCompletionItems:function(){},triggerCharacters:["."]})}))},b=function(e,t){_.forEach(e,(function(e){g[e]=monaco.languages.registerHoverProvider(e,{provideHover:function(e,n){var i=e.getLineContent(n.lineNumber),o=t(e,n,i);return o}})}))},I=function(){for(var e in m){var t;null===(t=m[e])||void 0===t||t.dispose(),m[e]=null}for(var n in f){var i;null===(i=f[n])||void 0===i||i.dispose(),f[n]=null}for(var o in g){var s;null===(s=g[o])||void 0===s||s.dispose(),g[o]=null}};function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M={name:"DsfMonacoCustom",props:{language:{type:String,default:"javascript"},editText:{type:String,default:""},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"100%"},theme:{type:String,default:"vs"},turnOnBlock:{type:Boolean,default:!1},completionItems:{type:Array,default:function(){return[]}},config:{type:Object,default:function(){return{}}},loadTip:{type:Object,default:function(){return{type:"local",isOpenTip:!1,localLanguage:[],jupyterLanguage:[]}}},loadTipCustom:{type:Function,default:null},suggestionSelectCallBack:{type:Function,default:null},loadHover:{type:Object,default:function(){return{isOpen:!1,hoverCb:dsf.noop,language:[]}}},jupyterWs:{type:Object,default:function(){return null}},model:{type:String,default:""},cancelJsDiagnostics:{type:Boolean,default:!1},cancelJsCompletionItems:{type:Boolean,default:!1},customBlockStyle:{type:Function}},computed:{style:function(){var e=this.width,t=this.height,n=-1!==e.toString().indexOf("%")?e:"".concat(e,"px"),i=-1!==t.toString().indexOf("%")?t:"".concat(t,"px");return{width:n,height:i}}},watch:{config:{handler:function(e){this.editerInstance&&this.editerInstance.updateOptions(e)},deep:!0},editText:function(e){this.editerInstance&&(this.editerInstance.setValue(e||""),this.handleParseZero2decoration())},width:function(e){this.updateLayout()},height:function(){this.updateLayout()},completionItems:function(e,t){var n=JSON.stringify(e),i=JSON.stringify(t);this.editerInstance&&n!==i&&this.loadTip.isOpenTip&&this.handleLoadCodeTip(e),this.completionItemCeche=e},jupyterWs:{handler:function(e){e&&this.editerInstance&&this.loadJupyterTip&&this.handleOpenCodeTip()},immediate:!0}},mounted:function(){var e=this;window.$components.platform.MonacoEditor.loader("",this.createdEditer),this.__resizeObserver=new ResizeObserver((function(t){var n=h()(t,1),i=n[0];i&&e.updateLayout()})),this.__resizeObserver.observe(this.$el)},data:function(){return{editerInstance:null,editModels:{},completionItemCeche:[],suggestionCommand:null,decorationsCollection:null,firstSelection:null,selectBlock:{}}},methods:{createdEditer:function(){var e=this,t=this.$refs.edit,n=this.createModel(this.model||dsf.uuid(),this.language),i=n.model;if(i){this.editerInstance=window.monaco.editor.create(t,O({model:i,theme:this.theme,unicodeHighlight:{invisibleCharacters:!1}},this.config)),this.cancelJsDiagnostics&&monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!0}),this.cancelJsCompletionItems&&monaco.languages.typescript.javascriptDefaults.setModeConfiguration({completionItems:!1,documentRangeFormattingEdits:!0}),this.editerInstance.addAction({id:"ctrls",label:"ctrls",keybindings:[monaco.KeyMod.chord(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyS)],run:function(){var t=e.editerInstance.getValue();e.$emit("editorSave",t)}}),this.suggestionSelectCallBack&&(this.suggestionCommand=window.monaco.editor.registerCommand("editor.suggest",(function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];e.suggestionSelectCallBack(i)})));var o=this,s=_.throttle((function(e){var t=e.changes,n=o.editerInstance.getValue();dsf.isEmptyObject(o.selectBlock)||(o.handleParseZero2decoration(),o.selectBlock={}),o.$emit("changeValue",{changes:t,value:n})}),50);this.editerInstance.onDidChangeModelContent(s),this.$emit("editLoaded",this.editerInstance),this.turnOnBlock&&(this.editerInstance.onDidChangeCursorSelection(this.handleChangeCursorSelection),this.editerInstance.onMouseDown((function(){setTimeout((function(){e.firstSelection=e.editerInstance.getPosition()}),50)})),this.editerInstance.onMouseUp((function(){setTimeout((function(){var t=e.editerInstance.getSelection();e.selectBlock=e.handleIsIndecorationRange(t,!0,!0,!0),e.firstSelection=null}),50)})),this.editerInstance.addAction({id:"backspace",label:"backspace",keybindings:[monaco.KeyCode.Backspace],run:function(){return e.handleResetBackspace()}}),this.editerInstance.addAction({id:"delete",label:"delete",keybindings:[monaco.KeyCode.Delete],run:function(){return e.handleResetBackspace(!0)}}),this.editerInstance.onKeyDown((function(t){var n=t.metaKey,i=t.ctrlKey,o=t.keyCode,s=dsf.client.isMac()?n:i;(s&&(56===o||52===o)||55===o)&&setTimeout((function(){e.handleParseZero2decoration()}),50)})),this.handleParseZero2decoration()),this.loadTip.isOpenTip&&this.handleLoadCodeTip(),this.loadHover.isOpen&&this.handleLoadHoverTip()}},_utilGetDecorationInRangeData:function(e){var t=this.editerInstance.getDecorationsInRange(e),n=null;if(t.length)for(var i=0,o=t.length;i<o;i++){var s,a=null===(s=t[i])||void 0===s?void 0:s.options;if(/^editor-/.test(null===a||void 0===a?void 0:a.inlineClassName)){n=a.description;break}}return null===n&&(n=this.editerInstance.getModel().getValueInRange(e).replace(/\u200b/g,"")),n},handleResetBackspace:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.editerInstance.getPosition(),n=t.lineNumber,i=t.column,o=this.editerInstance.getSelection(),s=o.endColumn,a=o.endLineNumber,r=o.startColumn,l=o.startLineNumber,c={},d=!1;c=l===a&&r===s?this.handleIsIndecorationRange(o,e,!0):this.handleIsIndecorationRange(o,!1,!0,!0),dsf.isEmptyObject(c)?c=e?{lineNumbers:[l,a],columns:[r,s===r?s+1:s]}:{lineNumbers:[l,a],columns:[r===s?r-1:r,s]}:d=!0;var u=new monaco.Range(c.lineNumbers[0],c.columns[0],c.lineNumbers[1],c.columns[1]);if(d){var h=0,m=[];while(h<c.ranges.length){var f=c.ranges[h];m.push({code:this._utilGetDecorationInRangeData(f),range:f}),h++}this.$emit("deleteBlockCode",m)}if(this.editerInstance.executeEdits("",[{range:u,text:"",forceMoveMarkers:!0}]),d&&this.handleParseZero2decoration(),1===i&&1!==n){var g=this.editerInstance.getModel().getLineMaxColumn(n)-1;this.editerInstance.executeEdits("",[{range:new monaco.Range(n-1,this.editerInstance.getModel().getLineMaxColumn(n-1),n,0),text:"",forceMoveMarkers:!0}]),this.editerInstance.setPosition({lineNumber:n-1,column:this.editerInstance.getModel().getLineMaxColumn(n-1)-g})}},handleChangeCursorSelection:function(e){var t=e.selection,n=e.source,i=e.oldSelections,o=["mouse","keyboard"];if(this.decorationsCollection&&o.includes(n)){var s=!this.firstSelection,a={};if(a=this.handleIsIndecorationRange(t),s){if(!dsf.isEmptyObject(a)){var r=h()(a.columns,2),l=r[0],c=r[1],d=this.editerInstance.getPosition(),u=d.column,m=d.lineNumber;if("mouse"===n){var f={lineNumber:m,column:(l+c)/2>u?l:c};this.editerInstance.setPosition(f)}else{var g=t.endLineNumber!==i[0].endLineNumber,p="";p=g?(l+c)/2>=u?l:c:t.endColumn>i[0].endColumn?c:l;var v={lineNumber:m,column:p};this.editerInstance.setPosition(v)}}}else{var C=t.positionLineNumber,b=t.positionColumn,I=this.firstSelection,y=I.lineNumber,O=I.column;dsf.isEmptyObject(a)&&(a={columns:[t.positionColumn,t.positionColumn]}),C>y||C===y&&b>O?this.editerInstance.setSelection({endColumn:a.columns[1],endLineNumber:C,startColumn:this.firstSelection.column,startLineNumber:this.firstSelection.lineNumber}):this.editerInstance.setSelection({endColumn:O,endLineNumber:y,startColumn:a.columns[0],startLineNumber:C})}this.prevPosition=t}},handleIsIndecorationRange:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.decorationsCollection){var o=this.decorationsCollection.getRanges(),s=0,a={};while(s<o.length){var r=o[s],l=r.startLineNumber,c=r.startColumn+ +!t,d=r.endColumn+ +n;if(i){var u=e.endColumn,h=e.endLineNumber,m=e.startColumn,f=e.startLineNumber;e.containsRange(r)&&(a.index?(a.index.push(s),a.ranges.push(r)):a={lineNumbers:[f,h],columns:[m,u],index:[s],ranges:[r]}),s++}else{if(l===e.positionLineNumber&&_.inRange(e.positionColumn,c,d))return{lineNumbers:[l,l],columns:[r.startColumn,r.endColumn],index:[s],ranges:[r]};s++}}return a}return{}},getAllBlockMessage:function(){return this.handleParseZero2decoration(),this.decorationsCollection.getRanges()},handleParseZero2decoration:function(){var e=this.editerInstance.getModel().findMatches(/\u200b[^\u200b]+\u200b/,!1,!0);if(e.length){for(var t=[],n=0;n<e.length;n++){var i=e[n].range,o=this._utilGetDecorationInRangeData(i);t.push({range:i,options:this.handleDecorationOption(o)})}this.decorationsCollection?this.decorationsCollection.set(t):this.decorationsCollection=this.editerInstance.createDecorationsCollection(t)}else{var s;null===(s=this.decorationsCollection)||void 0===s||s.clear()}},handleLoadHoverTip:function(){b(this.loadHover.language,this.loadHover.hoverCb)},handleLoadCodeTip:function(e){"local"===this.loadTip.type?v(e||this.completionItemCeche,this.loadTip.localLanguage,this.loadTipCustom):C(this.jupyterWs,this.loadTip.jupyterLanguage)},createModel:function(e,t,n){var i,o=dsf.isUnDef(n)?this.editText||"":n;if(null!==(i=this.editModels[e])&&void 0!==i&&i.model)return this.editModels[e];var s=window.monaco.editor.createModel(o,t);return this.editModels[e]={model:s,viewState:null},{model:s}},changeLang:function(e,t){var n,i=null===(n=this.editModels[t])||void 0===n?void 0:n.model;i&&window.monaco.editor.setModelLanguage(i,e)},changeModel:function(e,t){var n=this.editModels[t];if(n){var i=this.editerInstance.saveViewState();n.viewState=i}var o=this.editModels[e];o.model?(this.editerInstance.setModel(o.model),o.viewState&&this.editerInstance.restoreViewState(o.viewState),this.turnOnBlock&&this.handleParseZero2decoration()):dsf.layer.message("编辑器不存在该Model",!1)},addModel:function(e,t,n,i){var o=this,s=this.editModels[i];if(s){var a=this.editerInstance.saveViewState();s.viewState=a}var r=this.createModel(e,t,n),l=r.model,c=r.viewState;l&&(this.editerInstance.setModel(l),this.turnOnBlock&&this.handleParseZero2decoration(),c&&this.editerInstance.restoreViewState(c),this.$nextTick((function(){o.editerInstance.layout()})))},delModel:function(e){var t,n=this,i=null===(t=this.editModels[e])||void 0===t?void 0:t.model;i&&(i.dispose(),setTimeout((function(){delete n.editModels[e]}),50))},getValue:function(){return this.editerInstance.getValue()},addCode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"focus",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="";if(dsf.isString(e)?i=e:dsf.isObject(e)&&(i=e.value),this.editerInstance){var o,s=null;if("focus"===t){var r=this.editerInstance.getSelection();s=new monaco.Range(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn)}else{var c=this.editerInstance.getModel().getLineCount();s=new monaco.Range(c+1,1,c+1,1)}var d={range:s,text:i,forceMoveMarkers:!0};if(this.turnOnBlock&&n.isAddBlock){var u,h,m;if(d.text="​".concat(i,"​"),null!==n&&void 0!==n&&null!==(u=n.afterContent)&&void 0!==u&&u.value)d.text+=null===n||void 0===n||null===(m=n.afterContent)||void 0===m?void 0:m.value;var f=[s.startLineNumber,s.startColumn,s.startLineNumber,s.startColumn+i.length+2];if(dsf.isEmptyObject(this.selectBlock))if(this.decorationsCollection){var g=[];g.push.apply(g,l()(this.getAllDecoration(d.range,d.text.length))),this.editerInstance.executeEdits("",[d]),g.push({range:a()(monaco.Range,f),options:this.handleDecorationOption(e)}),this.decorationsCollection.set(g)}else this.editerInstance.executeEdits("",[d]),this.decorationsCollection=this.editerInstance.createDecorationsCollection([{range:a()(monaco.Range,f),options:this.handleDecorationOption(e)}]);else this.editerInstance.executeEdits("",[d]);if(!dsf.isUnDef(null===n||void 0===n||null===(h=n.afterContent)||void 0===h?void 0:h.position)){var p=this.editerInstance.getPosition(),v=p.column,C=p.lineNumber,b=v+n.afterContent.position;this.editerInstance.setPosition(new monaco.Position(C,b))}}else{var I=this.handleIsIndecorationRange(s);this.editerInstance.executeEdits("",[d]),dsf.isEmptyObject(I)&&this.handleParseZero2decoration()}this.editerInstance.focus();var y=(null===(o=d.text.match(/\n/g))||void 0===o?void 0:o.length)||0,O=d.text.split("\n").pop().length,M=y+s.startLineNumber,x=0===y?s.startColumn+O:O;return{endColumn:x,endLineNumber:M,startColumn:s.startColumn,startLineNumber:s.startLineNumber}}},handleDecorationOption:function(e){return dsf.isFunction(this.customBlockStyle)?this.customBlockStyle(e):{inlineClassName:(null===e||void 0===e?void 0:e.className)||"editor-custom-block",stickiness:monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,description:e}},updateLayout:function(){this.editerInstance&&this.editerInstance.layout()},setValue:function(e){this.editerInstance.setValue(e)},handleGetAllDeracations:function(){return this.editerInstance.getModel().getAllDecorations("",!0)},getAllDecoration:function(e,t){for(var n=e.startColumn,i=e.startLineNumber,o=this.editerInstance.getModel().getAllDecorations("",!0),s=[],a=0,r=o.length;a<r;a++){var l=o[a],c=l.options,d=c.inlineClassName,u=void 0===d?"":d,h=c.stickiness,m=c.description,f=void 0===m?{}:m;if(/^editor-/.test(u)){var g=l.range,p=g.endColumn,v=g.startColumn,C=g.startLineNumber,b={};b=i===C&&v>=n?new monaco.Range(i,v+t,i,p+t):l.range,s.push({range:b,options:{inlineClassName:u,stickiness:h,description:f}})}}return s}},beforeDestroy:function(){var e,t,n,i,o;for(var s in this.cancelJsDiagnostics&&monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),this.cancelJsCompletionItems&&monaco.languages.typescript.javascriptDefaults.setModeConfiguration({completionItems:!0}),null===(e=this.__resizeObserver)||void 0===e||e.disconnect(),I(),this.editModels){var a,r,l;null===(a=this.editModels[s])||void 0===a||null===(r=(l=a).dispose)||void 0===r||r.call(l)}this.editerInstance&&(null===(i=this.editerInstance)||void 0===i||null===(o=i.dispose)||void 0===o||o.call(i));null===(t=this.suggestionCommand)||void 0===t||null===(n=t.dispose)||void 0===n||n.call(t)}},x=M,S=n(0),N=Object(S["a"])(x,i,o,!1,null,null,null);t["default"]=N.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_monacoCustom.js.map