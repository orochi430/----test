/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[52],{1005:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dsf-login-quick"},[s("div",{staticClass:"login-box-info"},[s("el-input",{attrs:{disabled:e.$attrs.loading,placeholder:e.$attrs.phonePlaceholder,size:"medium","prefix-icon":"iconfont icon-icon_phone"},on:{input:function(t){e.showPhoneMessage=!1,e.showPhoneErr=!1}},model:{value:e.username,callback:function(t){e.username="string"===typeof t?t.trim():t},expression:"username"}}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showPhoneMessage||e.showPhoneErr,expression:"showPhoneMessage || showPhoneErr"}],staticClass:"errMsg"},[e._v(" "+e._s(e.username?"请输入正确的手机号码":"手机号码不能为空")+" ")])],1),s("div",{staticClass:"login-box-phonecode"},[s("el-input",{attrs:{disabled:e.$attrs.loading,placeholder:"短信验证码",size:"medium","prefix-icon":"1 iconfont icon-suo"},on:{input:function(t){e.showSmsCodeErr=!1}},model:{value:e.smsCode,callback:function(t){e.smsCode="string"===typeof t?t.trim():t},expression:"smsCode"}}),s("div",{staticClass:"phone-code",class:{iscoding:e.timer,disabled:e.getCodeDisabled},on:{click:e.handleGetCode}},[s("span",{class:{"iscoding-click":e.codeClicking}},[e._v(" "+e._s(e.dsf.isString(e.codeString)?e.codeString:e.codeString+"s")+" ")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showSmsCodeErr,expression:"showSmsCodeErr"}],staticClass:"errMsg"},[e._v(" 请输入短信验证码 ")])],1),e.$attrs.isShowCode?s("div",{staticClass:"login-box-info login-code login-verification-img-code"},[s("el-input",{attrs:{disabled:e.$attrs.loading,type:"text",placeholder:e.$attrs.codePlaceholder,size:"medium","prefix-icon":"iconfont icon-yanzhengma1"},on:{input:function(t){e.showCodeErr=!1}},model:{value:e.code,callback:function(t){e.code="string"===typeof t?t.trim():t},expression:"code"}}),s("img",{staticClass:"img-code",attrs:{src:e.$attrs.codeUrl},on:{click:function(t){return e.$emit("updateCodeUrl")}}}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showCodeErr,expression:"showCodeErr"}],staticClass:"errMsg"},[e._v(" 验证码不能为空 ")])],1):e._e()])},o=[],n=s(3),a=s.n(n);function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function l(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){a()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var c={name:"loginUser",inheritAttrs:!1,inject:{$login:{default:{}}},data:function(){return{username:"",smsCode:"",code:"",showPhoneMessage:!1,codeString:"获取验证码",timer:null,codeClicking:!1,gettingCode:!1,showPhoneErr:!1,showSmsCodeErr:!1,showCodeErr:!1}},computed:{getCodeDisabled:function(){return!(!0!==this.gettingCode&&!this.timer)}},methods:{handlePhone:function(){dsf.validate("isMobile",this.username)?this.showPhoneMessage=!1:this.showPhoneMessage=!0},validateFiled:function(){this.username=_.trim(this.username),this.smsCode=_.trim(this.smsCode);var e=!1;return""===this.username?(this.showPhoneErr=!0,e=!0):this.showPhoneErr=!1,dsf.validate("isMobile",this.username)?this.showPhoneErr=!1:(this.showPhoneErr=!0,e=!0),""===this.smsCode?(this.showSmsCodeErr=!0,e=!0):this.showSmsCodeErr=!1,""===this.code&&this.$attrs.isShowCode?(this.showCodeErr=!0,e=!0):this.showCodeErr=!1,!e},handleGetCode:function(){var e=this;this.getCodeDisabled||(this.gettingCode=!0,this.timer?this.codeClicking||(this.codeClicking=!0,setTimeout((function(){e.codeClicking=!1}),400)):dsf.validate("isMobile",this.username)?this.$login.submitBefore((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=l(l({},t),{},{phone:e.username});e.$http.post("user/quickLoginSendSms",o).done((function(t){null===s||void 0===s||s(t),t.success?(i&&(e.code=t.data,null===i||void 0===i||i.close()),e.codeString=60,e.timer=setInterval((function(){dsf.isString(e.codeString)?e.codeString=59:e.codeString>0?e.codeString--:(clearInterval(e.timer),e.timer=null,e.codeString="获取验证码")}),1e3)):dsf.layer.message(t.message,!1)})).catch((function(e){null===s||void 0===s||s()})).always((function(){e.gettingCode=!1}))}),!0,(function(){e.gettingCode=!1})):(this.gettingCode=!1,this.showPhoneErr=!0))},getLoginFileds:function(){var e=this.username,t=this.smsCode,s=this.code;return{userName:e,smsCode:t,code:s||"good",behavior:"04"+dsf.sm2.encode(JSON.stringify({lastTimeStamp:this.$login.lastTimeStamp}),dsf.config.setting_public_smpublickey)}},handleClearCode:function(){this.code=""}},beforeDestroy:function(){this.timer&&clearInterval(this.timer)}},d=c,u=s(0),p=Object(u["a"])(d,i,o,!1,null,null,null);t["default"]=p.exports},1006:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ds-logged-in"},[i("div",{staticClass:"title"},[e._v("登录确认")]),i("div",{staticClass:"desc"},[e._v("为了保障您的账户安全，请确认是否继续使用以下账号登录")]),i("div",{staticClass:"info-box"},[i("img",{attrs:{src:s(427),alt:""}}),i("div",{staticClass:"box"},[i("div",{staticClass:"user-icon",style:{"background-image":"url("+e.defaultUserIcon+")"}},[i("img",{directives:[{name:"show",rawName:"v-show",value:e.showIcon,expression:"showIcon"}],attrs:{src:e.iconUrl,alt:""},on:{error:e.headLoadError,load:e.headLoadSuccess}})]),i("div",{staticClass:"info"},[i("div",[e._v(e._s(e.info.username))]),i("div",[e._v(e._s(e.info.mainDeptName))])])])]),i("div",{staticClass:"button",on:{click:e.goHandler}},[e._v("进入系统")]),i("div",{staticClass:"button",on:{click:e.loginOutHander}},[e._v("退出登录")])])},o=[],n={name:"loggedIn",inject:{$login:{default:null}},props:{info:{type:Object,default:function(){return{}}}},data:function(){return{showIcon:!1,loading:!1}},computed:{defaultUserIcon:function(){var e=dsf.config.setting_public_user_default_header;return this.$replace(e)},iconUrl:function(){var e,t,s=(null===(e=(null===this||void 0===this||null===(t=this.info)||void 0===t?void 0:t.photo)||[])||void 0===e||null===(e=e[0])||void 0===e?void 0:e.absolutePath)||null;return s}},methods:{headLoadSuccess:function(){this.showIcon=!0},headLoadError:function(){this.showIcon=!1},loginOutHander:function(){var e=this;if(!this.loading){this.loading=!0;var t=this.$login.loginOut;t?t():dsf.layer.confirm("您确定要退出吗?").then((function(){e.$webAPI.loginOut().then((function(t){var s=t.success,i=t.message;s?(e.$login.loginState="none",dsf.clearLoginInfo()):dsf.layer.message(i,!1)})).catch((function(e){dsf.layer.message("退出失败",!1)}))})).catch((function(){})).finally((function(){e.loading=!1}))}},goHandler:function(){if(!this.loading)if(this.$login.isLoggedIn()){this.loading=!0;var e=this.$route.query.from;e=e?decodeURIComponent(e):dsf.config.setting_public_login_success_to,e&&location.replace(e)}else this.$login.loginState="none",dsf.layer.message(dsf.config.setting_public_token_invalid,!1)}},destroyed:function(){this.loading=!1}},a=n,r=s(0),l=Object(r["a"])(a,i,o,!1,null,null,null);t["default"]=l.exports},1007:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-login-page",class:{"is-remembered":e.isRemembered&&"loginUser"==e.loginTemplateActive.template}},[s("div",{staticClass:"login-header"},[e.logo?s("img",{ref:"logo",staticClass:"logo",attrs:{src:e._f("imgFormat")(e.logo),alt:e.title}}):e._e(),e.title?s("div",{staticClass:"site-name"},[e._v(e._s(e.title))]):e._e()]),s("div",{staticClass:"login-section",style:{"background-image":e.carouselItem?"":"url("+e.backgroundImage+")"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:"none"===e.loginState,expression:"loginState === 'none'"}],ref:"loginBox",staticClass:"login-box",class:{"has-passwordtool":e.hasPasswordtool,"has-privacy":e.openPrivacy}},[s("el-form",{nativeOn:{submit:function(e){e.preventDefault()}}},[e._t("default",(function(){return[e._t("form",(function(){return[s("div",{staticClass:"login-box-title single"},[1==e.$loginTemplateList.length?s("div",{staticClass:"login-box-normal"},[s("div",[e._v(e._s(e.$loginTemplateList[0].name))])]):e._l(e.$loginTemplateList,(function(t){return s("div",{key:t.template,staticClass:"login-box-normal",class:{"login-box-active":t.template===e.loginTemplateActive.template},on:{click:function(s){return e.handleChangeLogin(t)}}},[s("div",[e._v(e._s(t.name))])])}))],2),s(e.loginTemplateActive.component,e._b({ref:"loginTemplate",tag:"components",attrs:{isShowCode:e.isShowCode,codePlaceholder:e.codePlaceholder,userNamePlaceholder:e.userNamePlaceholder,passwordPlaceholder:e.passwordPlaceholder,phonePlaceholder:e.phonePlaceholder,codeUrl:e.codeUrl,codeState:e.codeState,isForgotPassword:e.isForgotPassword,loading:e.loading,"login-success":e.setStateIsLogin},on:{updateCodeUrl:e.updateCodeUrl,toForgotPassword:e.toForgotPassword}},"components",e.$attrs,!1)),!0!==e.loginTemplateActive.hideButton?s("div",{staticClass:"login-box-button"},[s("el-button",{attrs:{loading:e.loading,type:"info","native-type":"submit",size:"small"},on:{click:e.submit}},[e._v("登 录")]),e.isRemembered&&"loginUser"==e.loginTemplateActive.template?s("el-button",{attrs:{type:"plain","native-type":"submit",size:"small"},on:{click:function(t){e.isRemembered=!1}}},[e._v("切换账号")]):e._e()],1):e._e(),e.openPrivacy?s("div",{staticClass:"login-box-privacy"},[e.privacyRequired?[s("el-tooltip",{attrs:{transition:"el-zoom-in-center",manual:!0,"popper-class":"login-box-privacy",effect:"dark",content:"请先同意并勾选上述协议",placement:"bottom-start"},model:{value:e.showPrivacyTip,callback:function(t){e.showPrivacyTip=t},expression:"showPrivacyTip"}},[s("el-checkbox",{model:{value:e.privacyChecked,callback:function(t){e.privacyChecked=t},expression:"privacyChecked"}},[e._v(" 我已阅读并同意 ")])],1),s("span",{staticClass:"content",attrs:{title:"点击查看"},on:{click:function(t){return t.stopPropagation(),e.lookPrivacy.apply(null,arguments)}}},[e._v("隐私协议")])]:[e._v("登录即表示您已阅读并同意"),s("span",{staticClass:"content",attrs:{title:"点击查看"},on:{click:e.lookPrivacy}},[e._v("隐私协议")])]],2):e._e()]}))]}))],2)],1),"have"===e.loginState?s("DsfLoginIn",{staticClass:"login-box",attrs:{info:e.loggedInfo}}):e._e(),e.carouselItem?s("el-carousel",{staticClass:"login-carousel",attrs:{interval:e.carouselInterval}},e._l(e.carouselItem,(function(e){return s("el-carousel-item",{key:e},[s("img",{attrs:{src:e}})])})),1):e._e()],1),s("div",{staticClass:"login-footer"},[e._t("footer",(function(){return[s("div",{staticClass:"product-version",domProps:{innerHTML:e._s(e.dsf.safe.xss(e.productVersion))}})]}),{productVersion:e.productVersion})],2)])},o=[],n=s(8),a=s.n(n),r=s(3),l=s.n(r);function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach((function(t){l()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var u={name:"DsfPlatformLogin",provide:function(){return{$login:this}},data:function(){return this.openPrivacy="1"===dsf.config.setting_public_open_privacy,this.privacyRequired=!(!this.openPrivacy||"1"!==dsf.config.setting_public_privacy_required),{loading:!1,carouselHeight:0,carouselInterval:Number(dsf.config.setting_public_carousel_interval)||3e3,codeUrl:"",codeState:"loading",loginTemplateActive:{},productVersion:dsf.config.setting_public_product_version||"",loginState:"loading",loggedInfo:{},isRemembered:!1,codeMode:null,privacyChecked:!this.privacyRequired,showPrivacyTip:!1}},props:{loginTemplateList:{type:Array,default:function(){var e=[{name:"用户登录",template:"loginUser",component:"DsfLoginUser",visible:!0,hideButton:!1},{name:"快捷登录",template:"loginQuick",component:"DsfLoginQuick",visible:1==dsf.config.setting_security_sms_quick_login,hideButton:!1}];return e}},logo:{type:String,default:function(){return dsf.config.setting_public_login_logo}},title:{type:String,default:function(){return dsf.config.setting_public_login_title}},isForgotPassword:{type:Boolean,default:!0},isShowCode:{type:Boolean,default:function(){return 1==dsf.config.setting_security_login_image_code_verify&&"1"!=dsf.config.setting_security_login_code_type}},login:{type:Function,default:null},userNamePlaceholder:{type:String,default:"账户名称"},passwordPlaceholder:{type:String,default:"密码"},phonePlaceholder:{type:String,default:"请输入手机号码"},codePlaceholder:{type:String,default:"请输入验证码"},imgCodeUrl:{type:String,default:function(){return dsf.isUnDef(dsf.config.setting_security_login_code_type)?"/code/imageBase64":"code/getCode"}},backgroundImage:{type:String,default:function(){return dsf.config.setting_public_login_bg||s(90)}},customSetStateIsLogin:{type:Function,default:null},loginOut:{type:Function,default:null}},created:function(){this.loginTemplateActive=this.$loginTemplateList[0],this.isShowCode&&this.updateCodeUrl(),this.getLoginState()},computed:{carouselItem:function(){var e=dsf.config.setting_public_carousel_picture,t=""!=e&&dsf.isDef(e)&&e.split(",");return t&&t.map((function(e){return dsf.url.getWebPath(e)}))},$loginTemplateList:function(){return this.loginTemplateList.filter((function(e){return e.visible}))},hasPasswordtool:function(){var e="1"===dsf.config.setting_public_hide_remeber_pwd,t="1"===dsf.config.setting_public_hide_forget_pwd;return!e||this.isForgotPassword&&!t}},methods:{lookPrivacy:function(){var e=this,t=[];this.privacyRequired&&!this.privacyChecked&&t.push({text:"同意",handler:function(){e.privacyChecked=!0}}),this.$openDialog({title:"隐私协议",width:"1000px",height:"60vh",template:"<DsfVirtualScroll class='ds-tree-box' scroll-y>"+(dsf.config.setting_public_privacy_content||"")+"</DsfVirtualScroll>",customClass:"ds-login-page_privacy",footerAlign:"center",btns:t})},toForgotPassword:function(){this.$openDialog({title:"找回密码",width:"720px",height:"420px",content:"DsfPlatformForgotPassword",btns:[]})},updateCodeUrl:function(){var e=this;if(this.isShowCode){this.codeState="loading";var t=this.imgCodeUrl;dsf.http.get(t,null,{cache:!1}).done((function(t){var s=t.success,i=t.data,o=t.message;s?(e.codeId=i.id,e.codeUrl="data:image/png;base64,"+i.imageBase64,e.codeState="success",e.lastTimeStamp=i.timestamp):(e.codeState="fail",dsf.layer.message(o,!1))})).error((function(){e.codeState="fail",dsf.layer.message("获取验证码失败",!1)}))}},submit:function(){var e=this;this.showPrivacyTip=!1,this.privacyChecked||setTimeout((function(){e.showPrivacyTip=!0}),26),dsf.session.remove(dsf.config.setting_public_tokenkey);var t,s="loginQuick"!=this.loginTemplateActive.template;this.login?"function"==dsf.type(this.login)&&this.submitBefore((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,i=d(d({},e.getLoginTemplateFields()),{},{codeId:e.codeId,privacyChecked:e.privacyChecked},t);e.login(i).then((function(t){null===s||void 0===s||s(t),t&&t.success&&2e4==t.state&&e.setStateIsLogin(t)})).catch((function(e){dsf.warn("登录不成功"),null===s||void 0===s||s()}))}),s):null!==(t=this.$refs.loginTemplate)&&void 0!==t&&t.validateFiled()&&this.privacyChecked&&this.submitBefore(this.loginHandler,s)},submitBefore:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;if(t&&1==dsf.config.setting_security_login_image_code_verify&&"1"==dsf.config.setting_security_login_code_type){var i,o,n=Math.floor(3*Math.random()),a=[{codeMode:3,content:"DsfPlatformSlideVerify",name:"滑块验证",width:"390px"},{codeMode:4,content:"DsfPlatformSelectVerify",name:"点选验证",width:"390px"},{codeMode:5,content:"DsfPlatformNineGridVerify",name:"九宫格验证",width:"396px"}];if(null!==(i=dsf.config.setting_security_login_code_mode_advance)&&void 0!==i&&null!==(o=i.split)&&void 0!==o&&o.call(i,"^")){var r=dsf.config.setting_security_login_code_mode_advance.split("^"),l=r.length;1==l?n=r[0]-3:2==l&&(a.splice(Number(_.difference(["3","4","5"],r)[0])-3,1),n=Math.floor(2*Math.random()))}this.codeMode=a[n].codeMode,dsf.layer.openDialog({title:"请完成安全验证",width:a[n].width,content:a[n].content,customClass:"ds-login-page_verifydialog",params:{args:this,validateFn:e},closed:function(){null===s||void 0===s||s()}})}else null===e||void 0===e||e()},loginHandler:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.loading=!0;var o={loginUser:"login",loginQuick:"loginQuick"},n=this.getLoginTemplateFields(),a=this.codeMode;1==dsf.config.setting_security_login_image_code_verify&&"1"!=dsf.config.setting_security_login_code_type&&(a=dsf.config.setting_security_login_code_mode),this.$webAPI[o[this.loginTemplateActive.template]](d(d(d({},n),{},{codeId:this.codeId},t),{},{codeMode:a})).then((function(t){var i=t.data,o=t.success,a=t.message,r=t.state;if(null===s||void 0===s||s({data:i,success:o,message:a,state:r}),o)i.rememberToken?dsf.storage.local.set("rememberToken",l()({},n.userName,i.rememberToken)):dsf.storage.local.remove("rememberToken"),e.setStateIsLogin(i);else if(20555==r){var c;null===(c=e.$refs.loginTemplate)||void 0===c||c.handleResetPwdCode(),dsf.layer.message(a,!1)}else e.updateCodeUrl(),dsf.layer.message(a,!1)})).catch((function(t){null===i||void 0===i||i(t),e.updateCodeUrl(),t&&dsf.layer.message(t.message||"未知错误",!1),null===s||void 0===s||s()})).finally((function(){e.loading=!1}))},setStateIsLogin:function(e){dsf.session.set("isLogin",1);var t=this.$route.query.from;t?t=decodeURIComponent(t):dsf.isFunction(this.customSetStateIsLogin)?t=this.customSetStateIsLogin(e):null!==e&&void 0!==e&&e.redirectPath&&(t=e.redirectPath),t||(t=dsf.config.setting_public_login_success_to),location.replace(t)},getLoginTemplateFields:function(){var e;return(null===(e=this.$refs.loginTemplate)||void 0===e?void 0:e.getLoginFileds())||{}},handleChangeLogin:function(e){var t;this.loginTemplateActive=e,null===(t=this.$refs.loginTemplate)||void 0===t||t.handleClearCode(),this.updateCodeUrl()},getLoginState:function(){var e=this;this.isLoggedIn()?dsf.http.get("login/getUserInfo").done((function(t){var s=t.success,i=t.data;s?(e.loggedInfo=i,e.loginState="have"):e.loginState="none"})).error((function(){e.loginState="none"})):this.loginState="none"},isLoggedIn:function(){return 1==dsf.session.get("isLogin")&&!dsf.isUnDef(dsf.getToken())}},watch:{privacyChecked:function(e,t){e!=t&&(this.showPrivacyTip=!!this.privacyRequired&&!e)}},mounted:function(){var e=this;this.$refs.loginBox&&this.privacyRequired&&(this.__resizeObserver=new ResizeObserver((function(t){var s=a()(t,1),i=s[0];i&&e.showPrivacyTip&&(e.showPrivacyTip=!1,setTimeout((function(){e.showPrivacyTip=!0}),10))})),this.__resizeObserver.observe(this.$refs.loginBox))},beforeDestroy:function(){this.__resizeObserver&&this.__resizeObserver.disconnect()}},p=u,h=(s(783),s(0)),f=Object(h["a"])(p,i,o,!1,null,null,null);t["default"]=f.exports},1008:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dsf-forgot-password-control"},[s("div",{staticClass:"dsf-forgot-password-step"},e._l(e.steps,(function(t,i){return s("div",{key:"dsf-forgot-password-step-item"+i,staticClass:"forgot-password-step",class:{"current-step":e.step>=i+1}},[0!=i?s("div",{staticClass:"left-line",style:e.getStyle()}):e._e(),s("div",{staticClass:"step-cricle"},[s("div",{staticClass:"cricle normal"},[e._v(e._s(i+1))]),s("p",[e._v(e._s(t.label))])]),i<e.steps.length-1?s("div",{staticClass:"right-line",style:e.getStyle()}):e._e()])})),0),s("div",{staticClass:"ds-forgot-password-content"},[e.showAccountModule?[s("div",{staticClass:"dsf-forgot-password-content"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.account,expression:"account"}],staticClass:"dsf-forgot-password-input",attrs:{type:"text",placeholder:"请输入手机号|身份证号|登录名"},domProps:{value:e.account},on:{input:function(t){t.target.composing||(e.account=t.target.value)}}})])]:e._e(),e.showPhoneOrEmail?s("div",{staticClass:"dsf-forgot-password-tab"},[s("div",{staticClass:"dsf-forgot-password-tab-item",class:{"password-tab-item-active":0===e.tabActive},on:{click:function(t){return e.tabClick(0)}}},[s("p",[e._v("手机号验证")])]),s("div",{staticClass:"dsf-forgot-password-tab-item",class:{"password-tab-item-active":1===e.tabActive},on:{click:function(t){return e.tabClick(1)}}},[s("p",[e._v("邮箱验证")])])]):e._e(),e.showPhoneModule?[s("div",{staticClass:"dsf-forgot-password-content"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"}],staticClass:"dsf-forgot-password-input",attrs:{type:"text",maxlength:"11",placeholder:"请输入手机号"},domProps:{value:e.phone},on:{input:function(t){t.target.composing||(e.phone=t.target.value)}}})])]:e._e(),e.showEmailModule?[s("div",{staticClass:"dsf-forgot-password-content"},[s("div",{staticClass:"dsf-forgot-password-email"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"dsf-forgot-password-input",attrs:{type:"text",placeholder:"请输入邮箱地址"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),s("div",{staticClass:"dsf-forgot-password-input-e"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.emailcode,expression:"emailcode"}],staticClass:"dsf-forgot-password-input",attrs:{type:"text",placeholder:"请输入邮箱验证码"},domProps:{value:e.emailcode},on:{input:function(t){t.target.composing||(e.emailcode=t.target.value)}}}),s("p",{on:{click:e.sendEmailCode}},[e._v(e._s(e.mailTimeMsg))])])])])]:e._e(),e.showResetPwdModule?s("div",{staticClass:"dsf-forgot-password-content"},[s("p",{staticClass:"step-title"},[e._v("设置新密码")]),s("div",{staticClass:"dsf-forgot-password-input-btn"},["checkbox"===e.type?s("input",{directives:[{name:"model",rawName:"v-model",value:e.newpwd,expression:"newpwd"}],attrs:{placeholder:"设置新密码",type:"checkbox"},domProps:{checked:Array.isArray(e.newpwd)?e._i(e.newpwd,null)>-1:e.newpwd},on:{change:function(t){var s=e.newpwd,i=t.target,o=!!i.checked;if(Array.isArray(s)){var n=null,a=e._i(s,n);i.checked?a<0&&(e.newpwd=s.concat([n])):a>-1&&(e.newpwd=s.slice(0,a).concat(s.slice(a+1)))}else e.newpwd=o}}}):"radio"===e.type?s("input",{directives:[{name:"model",rawName:"v-model",value:e.newpwd,expression:"newpwd"}],attrs:{placeholder:"设置新密码",type:"radio"},domProps:{checked:e._q(e.newpwd,null)},on:{change:function(t){e.newpwd=null}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.newpwd,expression:"newpwd"}],attrs:{placeholder:"设置新密码",type:e.type},domProps:{value:e.newpwd},on:{input:function(t){t.target.composing||(e.newpwd=t.target.value)}}}),s("i",{staticClass:"icon iconfont",class:{"icon-icon-invisible":"password"===e.type,"icon-icon-visible":"text"===e.type},on:{click:e.changeIcon}})]),s("div",{staticClass:"dsf-forgot-password-input-btn"},["checkbox"===(e.showConfirmNewpwd?"text":"password")?s("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmNewpwd,expression:"confirmNewpwd"}],attrs:{placeholder:"确认新密码",type:"checkbox"},domProps:{checked:Array.isArray(e.confirmNewpwd)?e._i(e.confirmNewpwd,null)>-1:e.confirmNewpwd},on:{change:function(t){var s=e.confirmNewpwd,i=t.target,o=!!i.checked;if(Array.isArray(s)){var n=null,a=e._i(s,n);i.checked?a<0&&(e.confirmNewpwd=s.concat([n])):a>-1&&(e.confirmNewpwd=s.slice(0,a).concat(s.slice(a+1)))}else e.confirmNewpwd=o}}}):"radio"===(e.showConfirmNewpwd?"text":"password")?s("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmNewpwd,expression:"confirmNewpwd"}],attrs:{placeholder:"确认新密码",type:"radio"},domProps:{checked:e._q(e.confirmNewpwd,null)},on:{change:function(t){e.confirmNewpwd=null}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmNewpwd,expression:"confirmNewpwd"}],attrs:{placeholder:"确认新密码",type:e.showConfirmNewpwd?"text":"password"},domProps:{value:e.confirmNewpwd},on:{input:function(t){t.target.composing||(e.confirmNewpwd=t.target.value)}}}),s("i",{staticClass:"icon iconfont",class:{"icon-icon-invisible":!e.showConfirmNewpwd,"icon-icon-visible":e.showConfirmNewpwd},on:{click:function(t){e.showConfirmNewpwd=!e.showConfirmNewpwd}}})]),s("p",{staticClass:"step-tip"},[e._v(e._s(e.notice))])]):e._e(),e.showSuccessTipsModule?[e._m(0)]:e._e(),s("p",{staticClass:"error-msg"},[s("i",{directives:[{name:"show",rawName:"v-show",value:e.errorMessage,expression:"errorMessage"}],staticClass:"iconfont icon-tixingshixin"}),s("span",[e._v(e._s(e.errorMessage))])]),s("el-button",{staticClass:"dsf-forgot-password-next-btn",attrs:{type:"primary"},on:{click:e.buttonClickHandler}},[e._v(" "+e._s(e.buttonLabel)+" ")])],2),s("el-dialog",{attrs:{width:"480px","modal-append-to-body":!0,visible:e.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,"custom-class":"ds-forgot-password-get-phone-code-dialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"forgot-password-dialog"},[s("div",{staticClass:"title"},[e._v("手机短信验证码")]),s("div",{staticClass:"phone"},[e._v("当前手机号："+e._s(e.hiddenPhone))]),s("div",{staticClass:"dsf-forgot-password-input-2"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.code,expression:"code"}],attrs:{type:"text",placeholder:"请输入验证码"},domProps:{value:e.code},on:{input:function(t){t.target.composing||(e.code=t.target.value)}}}),s("el-button",{staticClass:"dsf-forgot-password-next-btn",class:{disabled:e.interval||e.gettingcode},attrs:{type:"primary",disabled:Boolean(e.interval)||e.gettingcode,loading:e.gettingcode},on:{click:e.getCode}},[e._v(" "+e._s(e.timeMsg)+" ")])],1),s("p",{staticClass:"error-msg"},[e.codeAuthResult&&e.code?s("i",{staticClass:"iconfont icon-tixingshixin"}):e._e(),s("span",[e._v(e._s(e.codeAuthResult))])]),s("el-button",{staticClass:"dsf-forgot-password-dialog-next-btn",class:{disabled:!e.code},attrs:{type:"primary",disabled:!e.code},on:{click:e.codeCheck}},[e._v(" 下一步 ")])],1)])],1)},o=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dsf-forgot-password-content"},[s("div",{staticClass:"step-three"},[s("div",{staticClass:"step-succss"},[s("i",{staticClass:"el-icon-check"})]),s("p",{staticClass:"success-tip"},[e._v("登录密码更新成功")])])])}],n=s(4),a=s.n(n),r=s(1),l=s.n(r),c=["phone","mail","all"],d={0:"phone",1:"mail",2:"all",3:"account_and_phone",4:"account_and_mail",5:"account_and_phone_or_mail"},u=dsf.component({name:"DsfPlatformForgotPassword",ctrlCaption:"忘记密码",mixins:[$mixins.control],data:function(){return{step:1,account:"",phone:"",gettingcode:!1,email:"",emailcode:"",disabled:!0,errorMessage:"",dialogVisible:!1,time:this.countdownTimes,countdownTimes:0,type:"password",newpwd:"",confirmNewpwd:"",notice:"",interval:null,code:"",isCodeSend:!1,codeAuthResult:"",token:"",tabActive:0,checkPhone:!1,showConfirmNewpwd:!1}},props:{title:{type:String,default:"忘记密码"},intervalUrl:{type:String,default:":/user/password/getUpdatePwdRule"},getCodeUrl:{type:String,default:":/user/password/sendUpdatePwdSms"},authCodeUrl:{type:String,default:":/user/password/checkUpdatePwdSms"},alterPwdUrl:{type:String,default:":/user/password/updatePwdByForget"},authUrl:{type:String,default:"oua2/user/pwd/verify"},sendUpdatePwdEmail:{type:String,default:":/user/password/sendUpdatePwdEmail"},checkUpdatePwdEmail:{type:String,default:":/user/password/checkUpdatePwdEmail"},checkStrengthPwdByEmail:{type:String,default:":/user/password/checkStrengthPwdByEmail"},updatePwdByEmail:{type:String,default:":/user/password/updatePwdByEmail"}},computed:{forget_pwd_setting_mode:function(){var e,t=(null===(e=dsf)||void 0===e||null===(e=e.config)||void 0===e?void 0:e.setting_public_forget_pwd_setting)||"5";return c.includes(t)?t:d[t]},timeMsg:function(){return this.interval?this.time+" s":this.isCodeSend?"重新获取":"获取短信验证码"},mailTimeMsg:function(){return this.interval?this.time+" s":this.isCodeSend?"重新获取":"发送验证码"},hiddenPhone:function(){return this.phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")},verifyAccount:function(){return["account_and_phone","account_and_mail","account_and_phone_or_mail"].includes(this.forget_pwd_setting_mode)},steps:function(){var e=[{label:"账号验证",handler:"accountCheck"},{label:"手机验证",handler:"phoneCheck"},{label:"邮箱验证",handler:"emailCheck"},{label:"手机、邮箱验证",handler:"phoneOrEmailCheck"}],t=[],s=this.forget_pwd_setting_mode;return this.verifyAccount&&t.push(e[0]),["phone","account_and_phone"].includes(s)&&t.push(e[1]),["mail","account_and_mail"].includes(s)&&t.push(e[2]),["all","account_and_phone_or_mail"].includes(s)&&t.push(e[3]),t.concat([{label:"设置操作",handler:"setpwd"},{label:"完成",handler:"confrim"}])},showAccountModule:function(){return 1===this.step&&this.forget_pwd_setting_mode.indexOf("account")>-1},showPhoneOrEmail:function(){return 1===this.step&&"all"===this.forget_pwd_setting_mode||2===this.step&&"account_and_phone_or_mail"===this.forget_pwd_setting_mode},showPhoneModule:function(){return!(!this.showPhoneOrEmail||0!==this.tabActive)||(1===this.step&&"phone"===this.forget_pwd_setting_mode||2===this.step&&"account_and_phone"===this.forget_pwd_setting_mode)},showEmailModule:function(){return!(!this.showPhoneOrEmail||1!==this.tabActive)||(1===this.step&&"mail"===this.forget_pwd_setting_mode||2===this.step&&"account_and_mail"===this.forget_pwd_setting_mode)},showResetPwdModule:function(){return!!(2===this.step&&!this.verifyAccount||3===this.step&&this.verifyAccount)},showSuccessTipsModule:function(){return(3===this.step&&!this.verifyAccount||4===this.step)&&(dsf.storage.local.remove("rememberToken"),!0)},buttonLabel:function(){return this.showResetPwdModule?"下一步":this.showSuccessTipsModule?"确定":"请点击验证"}},watch:{code:function(){this.codeAuthResult=""},step:function(e){2===e&&(this.dialogVisible=!1)},dialogVisible:function(e){e||(this.interval&&clearInterval(this.interval),this.time=this.countdownTimes,this.interval=null)},emailcode:function(e){this.codeAuthResult="",""!=e&&this.disabled?this.disabled=!1:""!==e||this.disabled||(this.disabled=!0)}},mounted:function(){this.isDesign||this.getInterval()},beforeDestroy:function(){this.clearInterval()},methods:{clearInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.interval&&clearInterval(this.interval),this.time=this.countdownTimes,this.interval=null})),getStyle:function(){return{width:4===this.steps.length?"50px":"86px"}},buttonClickHandler:function(){var e;null===this||void 0===this||null===(e=this[this.steps[this.step-1].handler])||void 0===e||e.call(this)},accountCheck:function(){this.account?(this.errorMessage="",this.step+=1):this.errorMessage="请输入账号"},phoneCheck:function(){""===this.phone?this.errorMessage="手机号不能为空":/^1(3|4|5|7|8|9|6)\d{9}$/.test(this.phone)?(this.errorMessage="",this.code="",this.dialogVisible=!0):this.errorMessage="手机格式不正确"},codeCheck:function(){var e=this;return a()(l.a.mark((function t(){var s,i,o;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.authCode();case 2:s=t.sent,i=s.err,o=s.token,i?e.codeAuthResult=i:(e.token=o,e.dialogVisible=!1,e.step+=1);case 6:case"end":return t.stop()}}),t)})))()},emailCheck:function(){var e=this;if(this.email&&this.emailcode){this.errorMessage="";var t={code:this.emailcode,email:this.email};this.verifyAccount&&(t.account=this.account),this.httpRequestHandler("get",this.checkUpdatePwdEmail,t,(function(t){e.token=t,e.step+=1}),"验证码错误")}else""===this.email?this.errorMessage="邮箱地址不能为空":""===this.emailcode&&(this.errorMessage="请输入验证码")},phoneOrEmailCheck:function(){0===this.tabActive?this.phoneCheck():this.emailCheck()},setpwd:function(){var e=this;return a()(l.a.mark((function t(){var s,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.errorMessage="",e.newpwd){t.next=5;break}e.errorMessage="请输入新密码",t.next=22;break;case 5:if(e.confirmNewpwd){t.next=9;break}e.errorMessage="请再次输入新密码",t.next=22;break;case 9:if(e.newpwd==e.confirmNewpwd){t.next=13;break}e.errorMessage="两次密码输入不一致",t.next=22;break;case 13:if(["mail","account_and_mail"].includes(e.forget_pwd_setting_mode)||1==e.tabActive){t.next=21;break}return t.next=16,e.alterPassword();case 16:s=t.sent,i=s.err,i?e.errorMessage=i:e.step+=1,t.next=22;break;case 21:e.httpRequestHandler("post",e.updatePwdByEmail,{token:e.token,param:dsf.sm2.encode(e.newpwd,dsf.config.setting_public_smpublickey)},(function(t){e.step+=1}));case 22:case"end":return t.stop()}}),t)})))()},confrim:function(){var e,t;this.$listeners["complete"]?this.$dispatch("complete"):null===this||void 0===this||null===(e=this.$dialog)||void 0===e||null===(t=e.close)||void 0===t||t.call(e)},tabClick:function(e){this.errorMessage="",this.tabActive=e},getInterval:function(){var e=this;this.httpRequestHandler("get",this.intervalUrl,{},(function(t){e.countdownTimes=t.interval,e.time=t.interval,e.notice=t.notice}),"layerErrorMessage")},sendEmailCode:function(){var e=this;return a()(l.a.mark((function t(){var s;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.interval){t.next=2;break}return t.abrupt("return",!1);case 2:""===e.email?e.errorMessage="邮箱地址不能为空":/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(e.email)?(e.errorMessage="",s={email:e.email},e.verifyAccount&&(s.account=e.account),e.httpRequestHandler("post",e.sendUpdatePwdEmail,s,(function(t){dsf.layer.message("发送成功"),e.interval=setInterval((function(){e.time--,e.time<=0&&(clearInterval(e.interval),e.interval=null,e.time=e.countdownTimes)}),1e3)}),"layerErrorMessage")):e.errorMessage="邮箱格式不正确";case 3:case"end":return t.stop()}}),t)})))()},changeIcon:function(){"text"===this.type?this.type="password":this.type="text"},getCode:function(){var e=this;if(!this.gettingcode){this.gettingcode=!0;var t={phone:this.phone};this.verifyAccount&&(t.account=this.account),this.httpRequestHandler("post",this.getCodeUrl,t,(function(){e.isCodeSend=!0,dsf.layer.message("发送成功"),e.interval=setInterval((function(){e.time--,e.time<=0&&(clearInterval(e.interval),e.interval=null,e.time=e.countdownTimes)}),1e3)}),"layerErrorMessage")}},authCode:function(){var e=this;return new Promise((function(t){e.httpRequestHandler("get",e.authCodeUrl,{phone:e.phone,code:e.code},(function(e){t({err:null,token:e})}),(function(e){t({err:e||"请求异常",token:null})}))}))},alterPassword:function(){var e=this;return new Promise((function(t){e.httpRequestHandler("post",e.alterPwdUrl,{phone:e.phone,token:e.token,param:dsf.sm2.encode(e.newpwd,dsf.config.setting_public_smpublickey)},(function(e){t({err:null,token:e})}),(function(e){t({err:e||"请求异常",token:null})}))}))},httpRequestHandler:function(e,t,s,i,o){var n=this,a=dsf.layer.loading();this.$http[e](t,s).done((function(e){var t=e.success,s=e.data,a=e.message,r=e.state;t?i(s):(20531==r?(n.step-=1,n.code="",n.emailcode="",n.errorMessage=o||a):"layerErrorMessage"===o?dsf.layer.message(a||"请求异常",!1):dsf.isFunction(o)?o(a):n.errorMessage=o||a,n.clearInterval())})).error((function(e){dsf.error(e),dsf.layer.message((null===e||void 0===e?void 0:e.message)||"请求异常",!1),n.clearInterval()})).always((function(){dsf.layer.closeLoading(a),n.gettingcode&&(n.gettingcode=!1)}))},reLogin:function(){this.$listeners["complete"]?this.$dispatch("complete"):this.$router.go(-1)}}}),p=u,h=(s(785),s(0)),f=Object(h["a"])(p,i,o,!1,null,null,null);t["default"]=f.exports},1009:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"dsf-alter-password-control"},[e.step?e._e():s("div",{staticClass:"step-box"},[s("p",{staticClass:"title"},[e._v(" "+e._s(e.title)),s("span",[e._v(e._s(e.notice))])]),"1"==e.isCheckOldPwd?[s("div",{staticClass:"dsf-alter-password-label"},[e._v("旧密码")]),s("el-input",{staticClass:"dsf-alter-password-input",attrs:{type:e.showOldPwd?"text":"password",placeholder:"请输入旧密码",autocomplete:"on"},model:{value:e.oldPwd,callback:function(t){e.oldPwd=t},expression:"oldPwd"}},[s("i",{staticClass:"icon-view iconfont",class:["icon-icon-"+(e.showOldPwd?"visible":"invisible")],attrs:{slot:"suffix"},on:{click:function(t){e.showOldPwd=!e.showOldPwd}},slot:"suffix"})]),s("br")]:e._e(),s("div",{staticClass:"dsf-alter-password-label"},[e._v("新密码")]),s("el-input",{staticClass:"dsf-alter-password-input",attrs:{type:e.showNewPwd?"text":"password",placeholder:"请输入新密码"},model:{value:e.newPwd,callback:function(t){e.newPwd=t},expression:"newPwd"}},[s("i",{staticClass:"icon-view iconfont",class:["icon-icon-"+(e.showNewPwd?"visible":"invisible")],attrs:{slot:"suffix"},on:{click:function(t){e.showNewPwd=!e.showNewPwd}},slot:"suffix"})]),s("br"),s("div",{staticClass:"dsf-alter-password-label"},[e._v("确认新密码")]),s("el-input",{staticClass:"dsf-alter-password-input",attrs:{type:e.showConfirmPwd?"text":"password",placeholder:"请再次输入新密码"},model:{value:e.confirmPwd,callback:function(t){e.confirmPwd=t},expression:"confirmPwd"}},[s("i",{staticClass:"icon-view iconfont",class:["icon-icon-"+(e.showConfirmPwd?"visible":"invisible")],attrs:{slot:"suffix"},on:{click:function(t){e.showConfirmPwd=!e.showConfirmPwd}},slot:"suffix"})]),e.alterResult?s("p",{staticClass:"error-msg"},[s("i",{staticClass:"iconfont icon-tixingshixin"}),e._v(" "+e._s(e.alterResult)+" ")]):e._e(),s("br"),"1"==e.isCheckCode?[s("div",{staticClass:"dsf-alter-password-label"},[e._v("验证码")]),s("div",{staticClass:"dsf-alter-password-code-wrap"},[s("el-input",{staticClass:"dsf-alter-password-input",attrs:{placeholder:"请输入验证码"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),s("el-button",{staticClass:"dsf-alter-password-code-btn",class:{disabled:e.codeDisabled},attrs:{type:"primary",disabled:e.codeDisabled,size:"mini"},on:{click:e.getCode}},[e._v(" 获取验证码"),e.codeDisabled?s("span",[e._v("("+e._s(e.codeIntervalTime)+")")]):e._e()])],1),e.codeResult?s("p",{staticClass:"error-msg"},[s("i",{staticClass:"iconfont icon-tixingshixin"}),e._v(" "+e._s(e.codeResult)+" ")]):e._e(),s("br")]:e._e(),s("p",{staticStyle:{color:"red","font-size":"14px",height:"30px","line-height":"30px","margin-top":"15px"}},[e._v(" "+e._s(e.tips)+" ")]),s("el-button",{staticClass:"dsf-alter-password-btn",class:{disabled:e.nextStepDisabled},attrs:{type:"primary",disabled:e.nextStepDisabled},on:{click:e.nextStep}},[e._v(" 下一步 ")])],2),e.step?s("div",{staticClass:"step-box"},[e._m(0),s("p",{staticClass:"success-tip"},[e._v("登录密码修改成功,"+e._s(e.setTimeout)+"秒后自动退出")]),s("el-button",{staticClass:"dsf-alter-password-success-btn",attrs:{type:"primary"},on:{click:e.backLogin}},[e._v(" 重新登录 ")])],1):e._e()])},o=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"step-succss"},[s("i",{staticClass:"el-icon-check"})])}],n=dsf.component({name:"DsfPlatformAlterPassword",ctrlCaption:"修改密码",mixins:[$mixins.control],props:{title:{type:String,default:"修改密码"},alterUrl:{type:String,default:"oua2/user/pwd/selfupdate"},intervalUrl:{type:String,default:":/user/password/getUpdatePwdRule"},errorTips:{type:String,default:"新密码不能与旧密码一样，请重新输入"},onSuccess:{default:null},codeUrl:{type:String,default:"password/sendUpdatePwdCode"}},computed:{nextStepDisabled:function(){var e=this.oldPwd,t=this.newPwd,s=this.confirmPwd,i=this.code,o=this.isCheckOldPwd,n=this.isCheckCode;return!t||t!==s||("1"==o&&"1"==n?!(e&&e!=t&&i):"1"==o&&"0"==n?!(e&&e!=t):"0"==o&&"1"==n?!i:"0"!=o||"0"!=n)}},data:function(){return{showOldPwd:!1,showNewPwd:!1,showConfirmPwd:!1,loading:!1,notice:"密码设置6到20位,必须包含大写字母、小写字母、数字",step:!1,oldPwd:"",newPwd:"",confirmPwd:"",code:"",alterResult:"",codeResult:"",tips:"",setTimeout:5,codeDisabled:!1,codeIntervalTime:60,codeIntervalFn:null,isCheckOldPwd:1,isCheckCode:0}},mounted:function(){var e=this;this.loading=!0,this.$http.get(this.intervalUrl,{}).done((function(t){var s=t.success,i=t.data;s&&(e.notice=i.notice,e.isCheckOldPwd=(null===i||void 0===i?void 0:i.checkOldPwd)||"1",e.isCheckCode=(null===i||void 0===i?void 0:i.checkSmsCode)||"0")})).error((function(e){dsf.error(e)})).always((function(){e.loading=!1}))},methods:{nextStep:function(){this.alterPwd()},setTimeoutExit:function(){var e=this;this.setTimeout<=0?this.backLogin():(this.setTimeout--,clearTimeout(this.stopExit),this.stopExit=setTimeout((function(){e.setTimeoutExit()}),1e3))},alterPwd:function(){var e=this,t=dsf.sm2.encode(this.oldPwd,dsf.config.setting_public_smpublickey),s=dsf.sm2.encode(this.newPwd,dsf.config.setting_public_smpublickey);this.$http.post(this.alterUrl,{oldParam:"1"==this.isCheckOldPwd?t:"",param:s,code:this.code||""}).done((function(t){var s=t.success,i=t.message;s?e.loginOut():e.alterResult=i})).error((function(e){dsf.error(e),dsf.layer.message((null===e||void 0===e?void 0:e.message)||"请求异常",!1)})).always((function(){}))},loginOut:function(){var e=this;this.$webAPI.loginOut().then((function(t){var s,i=t.success,o=t.message;i?(dsf.clearLoginInfo(),dsf.storage.local.remove("rememberToken"),e.step=!0,null===(s=e.onSuccess)||void 0===s||s.call(e),e.setTimeoutExit()):dsf.layer.message(o,!1)})).catch((function(e){console.error(e),dsf.layer.message("退出失败",!1)}))},backLogin:function(){this.$listeners["complete"]?this.$dispatch("complete"):location.replace(dsf.config.setting_public_pc_login_page)},checkPwd:_.debounce((function(){!this.oldPwd&&"0"!=this.isCheckOldPwd||!this.newPwd&&!this.confirmPwd||("1"!=this.isCheckOldPwd||this.oldPwd!==this.newPwd&&this.oldPwd!==this.confirmPwd?this.newPwd&&this.confirmPwd&&this.newPwd!=this.confirmPwd?this.tips="两次新密码输入不一致，请重新输入":this.tips="":this.tips=this.errorTips)}),300),getCode:function(){var e=this;this.codeResult="",this.codeDisabled=!0;var t=this.codeIntervalTime;this.codeIntervalFn=setInterval((function(){e.codeIntervalTime--,0==e.codeIntervalTime&&(e.codeDisabled=!1,e.codeIntervalTime=t,clearInterval(e.codeIntervalFn))}),1e3),this.$http.post(this.codeUrl).done((function(t){var s=t.success,i=t.message;s||(e.codeResult=i,e.codeDisabled=!1,clearInterval(e.codeIntervalFn))})).error((function(t){dsf.error(t),e.codeDisabled=!1,clearInterval(e.codeIntervalFn),dsf.layer.message((null===t||void 0===t?void 0:t.message)||"请求异常",!1)})).always((function(){}))}},beforeDestroy:function(){clearTimeout(this.stopExit),clearInterval(this.codeIntervalFn)},watch:{oldPwd:function(e){this.checkPwd()},newPwd:function(){this.alterResult="",this.checkPwd()},confirmPwd:function(){this.alterResult="",this.checkPwd()}}}),a=n,r=(s(787),s(0)),l=Object(r["a"])(a,i,o,!1,null,null,null);t["default"]=l.exports},426:function(e,t,s){e.exports=s.p+"modules/platform/img/info-bg.png"},427:function(e,t,s){e.exports=s.p+"modules/platform/img/info.png"},428:function(e,t,s){e.exports=s.p+"modules/platform/img/usericon.png"},572:function(e,t,s){var i=s(784);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=s(19).default;o("2696866b",i,!0,{sourceMap:!1,shadowMode:!1})},573:function(e,t,s){var i=s(786);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=s(19).default;o("644239fd",i,!0,{sourceMap:!1,shadowMode:!1})},574:function(e,t,s){var i=s(788);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=s(19).default;o("24e73e3b",i,!0,{sourceMap:!1,shadowMode:!1})},783:function(e,t,s){"use strict";s(572)},784:function(e,t,s){"use strict";s.r(t)},785:function(e,t,s){"use strict";s(573)},786:function(e,t,s){"use strict";s.r(t)},787:function(e,t,s){"use strict";s(574)},788:function(e,t,s){"use strict";s.r(t)},90:function(e,t,s){e.exports=s.p+"modules/platform/img/loginBg.png"},969:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dsf-login-user"},[e.$login.isRemembered?i("div",{staticClass:"info-box"},[i("img",{attrs:{src:s(426),alt:""}}),i("div",{staticClass:"box"},[e._m(0),i("div",{staticClass:"info"},[i("div",{attrs:{title:e.username}},[e._v(e._s(e.username))])])])]):[i("div",{staticClass:"login-box-info"},[i("el-input",{attrs:{disabled:e.$attrs.loading,placeholder:e.$attrs.userNamePlaceholder,size:"medium","prefix-icon":"el-icon-user-solid"},model:{value:e.username,callback:function(t){e.username="string"===typeof t?t.trim():t},expression:"username"}})],1),i("div",{staticClass:"login-box-info"},[i("el-input",{attrs:{disabled:e.$attrs.loading,type:e.showPasswordText?"text":"password",placeholder:e.$attrs.passwordPlaceholder,size:"medium","prefix-icon":"1 iconfont icon-suo"},model:{value:e.password,callback:function(t){e.password="string"===typeof t?t.trim():t},expression:"password"}},[i("i",{staticClass:"icon-view iconfont",class:["icon-icon-"+(e.showPasswordText?"visible":"invisible")],attrs:{slot:"suffix"},on:{click:function(t){e.showPasswordText=!e.showPasswordText}},slot:"suffix"})])],1)],e.$attrs.isShowCode?i("div",{staticClass:"login-box-info"},[i("imgCode",{attrs:{disabled:e.$attrs.loading,placeholder:e.$attrs.codePlaceholder,src:e.$attrs.codeUrl,state:e.$attrs.codeState},on:{changeCode:function(t){return e.$emit("updateCodeUrl")}},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1):e._e(),!e.hideRemeberPwd||e.$attrs.isForgotPassword&&!e.hideForgetPwd?i("div",{staticClass:"login-box-info login-password",class:{only:e.hideRemeberPwd||!(e.$attrs.isForgotPassword&&!e.hideForgetPwd)}},[e.hideRemeberPwd?e._e():i("el-checkbox",{model:{value:e.remember,callback:function(t){e.remember=t},expression:"remember"}},[e._v("记住密码")]),e.$attrs.isForgotPassword&&!e.hideForgetPwd?i("div",{staticClass:"login-box-forgot-password"},[i("span",{on:{click:function(t){return e.$emit("toForgotPassword")}}},[e._v("忘记密码?")])]):e._e()],1):e._e()],2)},o=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"user-icon"},[i("img",{attrs:{src:s(428)}})])}],n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-verification-img-code"},[s("el-input",{attrs:{disabled:e.disabled,type:"text",placeholder:e.placeholder,size:"medium","prefix-icon":"iconfont icon-yanzhengma1"},model:{value:e.codeProxy,callback:function(t){e.codeProxy="string"===typeof t?t.trim():t},expression:"codeProxy"}}),s("div",{staticClass:"img-code"},[s("img",{directives:[{name:"show",rawName:"v-show",value:e.handleShow(!0),expression:"handleShow(true)"}],class:"success"===e.state?"img-code-success":"img-code-fail",attrs:{src:e.getImgSrc()},on:{click:e.handleChangeCode}}),s("svg",{directives:[{name:"show",rawName:"v-show",value:e.handleShow(!1),expression:"handleShow(false)"}],staticClass:"img-code-loading",attrs:{x:"0px",y:"0px",viewBox:"0 0 100 100"}},[s("path",{attrs:{fill:"gray",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"}})])])],1)},a=[],r={props:{src:{type:String,default:""},value:{type:String,default:""},disabled:{type:Boolean},placeholder:{type:String},state:{type:String}},data:function(){return{srcProxy:"",isError:!1,failSrc:"data:image/png;base64,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"}},computed:{codeProxy:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}},methods:{handleChangeCode:function(){this.$emit("changeCode")},handleShow:function(e){return e^"loading"===this.state},getImgSrc:function(){return"success"===this.state?this.src:this.failSrc}}},l=r,c=s(0),d=Object(c["a"])(l,n,a,!1,null,null,null),u=d.exports,p={name:"loginUser",components:{imgCode:u},inheritAttrs:!1,inject:{$login:{default:{}}},created:function(){if(this.rememberToken=dsf.storage.local.get("rememberToken"),_.isObject(this.rememberToken)&&!this.hideRemeberPwd){var e=Object.keys(this.rememberToken)[0],t=Object.values(this.rememberToken)[0];this.username=e,this.password=t,this.oldPsd=t,this.remember=!0,this.$login.isRemembered=!0}},watch:{"$login.isRemembered":function(e,t){t&&!e&&(this.password="")}},data:function(){return this.hideRemeberPwd="1"===dsf.config.setting_public_hide_remeber_pwd,this.hideForgetPwd="1"===dsf.config.setting_public_hide_forget_pwd,{username:"",password:"",oldPsd:"",remember:!1,code:"",showPasswordText:!1}},methods:{getTypeText:function(e){var t=this.$attrs[e];if(t.indexOf("输入")>-1){var s=t.indexOf("输入")+2;return t.slice(s)}return t},validateFiled:function(){this.username=_.trim(this.username),this.password=_.trim(this.password),this.code=_.trim(this.code);var e="";return""===this.username&&(e+=this.getTypeText("userNamePlaceholder")),""===this.password&&(e+=(e?"、":"")+this.getTypeText("passwordPlaceholder")),""===this.code&&this.$attrs.isShowCode&&(e+=(e?"、":"")+this.getTypeText("codePlaceholder")),!e||(dsf.layer.message(e+"不能为空！",!1),!1)},getLoginFileds:function(){var e=this.username,t=this.password,s=this.remember,i=this.oldPsd;return{userName:e,password:dsf.safe.passwordEncode(t),remember:s,rememberToken:this.$login.isRemembered?dsf.safe.passwordEncode(i):"",code:this.code||"good",behavior:"04"+dsf.sm2.encode(JSON.stringify({lastTimeStamp:this.$login.lastTimeStamp}),dsf.config.setting_public_smpublickey)}},handleResetPwdCode:function(){dsf.storage.local.remove("rememberToken"),this.$login.isRemembered=!1,this.code="",this.password=""},handleClearCode:function(){this.code=""}}},h=p,f=Object(c["a"])(h,i,o,!1,null,null,null);t["default"]=f.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_login_module.js.map