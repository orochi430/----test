/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[10],{389:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var i="/file/upload/",o={CONFIG_FILE_LOADED:"config_file_loaded",KEY_DELETE:"key_delete",KEY_CTRL_D:"key_ctrl_d",BODY_EMPTY_CLICK:"body_empty_click",SEAT_POP:"seat_pop",GET_ACTIVE_SEAT:"get_active_seat",CLEAN_ALL_SEAT_NUM:"clean_all_seat_num",CLEAN_SELECT_SEAT_NUM:"clean_select_seat_num",AFTER_QUICK_ORDER:"after_quick_order",PERSON_REVERT_TREE:"person_revert_tree",LEFT_CLICK_SEAT:"left_click_seat",AUTO_SEAT:"auto_seat",LEVEL_UP:"level_up",LEVEL_DOWN:"level_down"}},390:function(t,e,n){"use strict";var i=n(33),o=n.n(i),a=n(34),s=n.n(a),r=function(){function t(){o()(this,t),this.events={}}return s()(t,[{key:"listen",value:function(t,e){if(void 0===this.events[t])this.events[t]=[e];else{var n=this.events[t];if(!_.isArray(n))return void"请使用 on 来监听 ".concat(t," 事件");n.push(e)}}},{key:"dispatch",value:function(t,e){var n=this.events[t];n&&_.isArray(n)&&n.forEach((function(t){t(e)}))}},{key:"on",value:function(t,e){void 0===this.events[t]?this.events[t]=e:_.isArray(this.events[t])&&"请使用 listen 来监听 ".concat(t," 事件")}},{key:"emit",value:function(t,e){var n=this.events[t];n&&(_.isArray(n)||n(e))}},{key:"off",value:function(t){this.events[t]=void 0}},{key:"clear",value:function(){this.events={}}},{key:"$getAllListener",value:function(){return Object.entries(this.events)}}]),t}(),l=new r;window.$simpleEventBus=l,e["a"]=l},391:function(t,e,n){"use strict";n.d(e,"j",(function(){return a})),n.d(e,"i",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return l})),n.d(e,"c",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return h})),n.d(e,"g",(function(){return d})),n.d(e,"f",(function(){return p}));var i=n(389),o=n(390);function a(t,e){var n=this,o={headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(t,e){return t}]},a=dsf.layer.loading();n.$http.post(i["b"],t,o).done((function(t){if(!dsf.isDef(t.data)||!t.success)return dsf.layer.message(t.message,!1),e&&e("error"),!1;e&&e(t.data)})).error((function(t){dsf.layer.message("上传图片失败",!1),e&&e("error")})).always((function(){dsf.layer.closeLoading(a)}))}function s(t){var e=t.member[0],n=t.height-e.height*t.rows,i=t.width-e.width*t.cols,o=t.rows>1?n/(t.rows-1):0,a=t.cols>1?i/(t.cols-1):0;t.member.forEach((function(t){t.rowIndex>0&&(t.top=_.floor((t.height+o)*t.rowIndex,2)),t.colIndex>0&&(t.left=_.floor((t.width+a)*t.colIndex,2))}))}function r(t){var e=t.member[0],n=t.width-e.width*t.cols;return 1===t.cols?0:_.floor(n/(t.cols-1),2)}function l(t){var e=t.member[0],n=t.height-e.height*t.rows;return 1===t.rows?0:_.floor(n/(t.rows-1),2)}function c(){var t,e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.items.forEach((function(t){t.isFrozenSty=!0,e.selectedItems.forEach((function(e){t.id===e.id&&(t.isFrozenSty=!1)}))})),(null===this||void 0===this||null===(t=this.groups)||void 0===t?void 0:t.length)>0&&this.groups.forEach((function(t){t.isFrozenSty=!0,t.isFrozenMemberSty=!0,e.selectedItems.forEach((function(e){t.id===e.id&&(t.isFrozenSty=!1,!n&&(t.isFrozenMemberSty=!1))}))}))}function u(){this.items.forEach((function(t){t.isFrozenSty=!1})),this.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1}))}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dsf-seat-upload";$("input[name='".concat(t,"']")).remove();var e=document.createElement("input");return e.type="file",e.accept="image/*",e.style.display="none",e.name=t,document.body.appendChild(e),e}function h(){var t=this;if(!_.isEmpty(t.postData.backgroundImage)){var e=t.postData.backgroundImage.width,n=t.postData.backgroundImage.height,i=t.postData.canvasSet.width||$(".seat-designer-page").width(),o=i/e;t.postData.canvasSet.width=i,t.postData.canvasSet.height=n*o,$("#panel_bg").css("background-image","url("+t.postData.backgroundImage.absolutePath+")")}}function d(t,e){var n,a=function(t){switch(t){case 17:t="ctrl";break;case 68:t="d";break;case 65:t="a";break;case 46:t="delete";break;case 16:t="shift";break;case 83:t="s";break;default:t=null}return t};$("body").on("keydown",(function(s){if(n=a(s.keyCode),n){var r=t.indexOf(n);-1===r&&t.push(n);var l=t.join("-");e.includes(l)&&(s.stopPropagation(),s.preventDefault()),"ctrl-d"===l&&o["a"].emit(i["a"].KEY_CTRL_D),"delete"===l&&o["a"].emit(i["a"].KEY_DELETE)}})),$("body").on("keyup",(function(e){e.stopPropagation(),e.preventDefault(),n=a(e.keyCode),_.pull(t,n)}))}function p(t,e){return{id:t.id,pid:t.parentId,belong:t.belong,currentState:t.stateList[1],person:e,seatNum:t.seatNum}}},444:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(33),o=n.n(i),a=n(34),s=n.n(a),r=function(){function t(e,n){var i=this;o()(this,t),this.config=e,n||this.alert("url里面缺少必要的opt参数"),this.config[n]||this.alert("[".concat(this.config.name,"] url里面的opt参数没有对应的配置项")),Object.getOwnPropertyNames(this.config[n]).forEach((function(t){i[t]=i.config[n][t]}))}return s()(t,[{key:"alert",value:function(t){throw dsf.layer.alert({title:"警告",type:"warning",message:t}),new Error(t)}}]),t}()},610:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-box"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.canvasSet,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"画布宽"}},[n("el-input-number",{attrs:{controls:!1,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.width,callback:function(e){t.$set(t.canvasSet,"width",e)},expression:"canvasSet.width"}})],1),n("el-form-item",{attrs:{label:"画布高"}},[n("el-input-number",{attrs:{controls:!1,disabled:t.hasBg,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.height,callback:function(e){t.$set(t.canvasSet,"height",e)},expression:"canvasSet.height"}})],1)],1)],1)},o=[],a={name:"WidthInput",props:{canvasSet:{type:Object,required:!0},hasBg:{type:Boolean}},data:function(){return{}},watch:{canvasSet:{handler:function(t){var e=this,n=t.width,i=t.height,o=$(".seat-designer-page").offset().left,a=$(".seat-designer-page").offset().top,s=$(window).height(),r=$(window).width();n&&n+o>r?$(".seat-designer-center").css({"overflow-x":"scroll"}):$(".seat-designer-center").css({"overflow-x":"auto"}),i&&i+a>s?$(".seat-designer-center").css("overflow-y","scroll"):$(".seat-designer-center").css("overflow-y","auto"),e.$store.commit("seatDesign/changeCompelPanelSize",t)},deep:!0}}},s=a,r=n(0),l=Object(r["a"])(s,i,o,!1,null,null,null);e["a"]=l.exports},829:function(t,e,n){t.exports=n.p+"modules/platform/img/image.png"},952:function(t,n,i){"use strict";i.r(n);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ds-designer ds-seat-container ds-seat-design"},[n("div",{staticClass:"designer-head"},[n("top-tools",t._b({on:{"save-layout":t.saveLayout}},"top-tools",t.postData,!1,!0))],1),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"seat-designer-center"},[n("left-tools"),n("seat-canvas",{scopedSlots:t._u([{key:"seat",fn:function(){return[n("seat-item",t._b({},"seat-item",t.postData,!1,!0))]},proxy:!0},{key:"seatPop",fn:function(){return[n("seat-pop")]},proxy:!0}])}),n("right-tools")],1)])])},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer_tools"},[t._l(t.layout.buttons,(function(t,e){return n("DsfButton",{key:e,attrs:{icon:t.icon,text:t.text,"btn-style":"icon-text"},on:{click:function(e){return t.handler(e,t)}}})})),n("width-input",{attrs:{"canvas-set":t.canvasSet,"has-bg":t.hasBg}})],2)},r=[],l=i(3),c=i.n(l),u=i(391),f=i(390),h=i(389),d=i(610);function p(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=m(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function m(t,e){if(t){if("string"===typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var b={name:"TopTools",props:{items:{type:Array,default:function(){return[]}},groups:{type:Array,default:function(){return[]}},backgroundImage:{type:Object,default:function(){return{url:"",width:0,height:0}}},canvasSet:{type:Object,default:function(){return{width:void 0,height:void 0}}},hasBg:{type:Boolean,default:!1}},components:{widthInput:d["a"]},data:function(){return{normalButtons:[{text:"保存",icon:"baocun",handler:this.saveLayout},{text:"序号设置",icon:"shuzishurukuang",handler:this.setNum},{text:"底图",icon:"tupiantianjia",handler:this.updateBG},{text:"复位",icon:"shuaxin",handler:this.restoreLayout},{text:"回退",icon:"shangyibu1",handler:this.backStep}],numButtons:[{text:"确定",icon:"dui1",handler:this.numSave},{text:"取消",icon:"icon2",handler:this.numCancel},{text:"回退",icon:"shangyibu1",handler:this.backStep},{text:"全部清空",icon:"shanchu",handler:this.numClean}],layout:{buttons:[]}}},computed:y({},Vuex.mapState("seatDesign",["compelPanelSize","switchNumSet","haveSelectedItems"])),watch:{"canvasSet.width":function(t){var e=this;if(this.hasBg)if(t){var n=t/this.backgroundImage.width;this.canvasSet.height=this.backgroundImage.height*n}else this.$nextTick((function(){var t=$(".seat-designer-page").width(),n=t/e.backgroundImage.width;e.canvasSet.height=e.backgroundImage.height*n}))},switchNumSet:function(t){this.layout.buttons=t?this.numButtons:this.normalButtons},haveSelectedItems:function(t){var e,n=[{text:"确定",icon:"dui1",handler:this.numSave},{text:"取消",icon:"icon2",handler:this.numCancel},{text:"回退",icon:"shangyibu1",handler:this.backStep}];e=t?[{text:"当前清空",icon:"kongjianweixuan",handler:this.numClear}]:[{text:"全部清空",icon:"shanchu",handler:this.numClean}],this.numButtons=n.concat(e),this.switchNumSet&&(this.layout.buttons=n.concat(e))}},created:function(){this.layout.buttons=this.normalButtons},methods:{backStep:function(){},setNum:function(){this.$store.commit("seatDesign/changeSwitchNumSet",!0)},numSave:function(){this.$store.commit("seatDesign/changeSwitchNumSet",!1)},numCancel:function(){this.$store.commit("seatDesign/changeSwitchNumSet",!1)},numClean:function(){f["a"].emit(h["a"].CLEAN_ALL_SEAT_NUM)},numClear:function(){f["a"].emit(h["a"].CLEAN_SELECT_SEAT_NUM)},saveLayout:function(){var t,e={},n=function(t){return t.seatNum?e[t.seatNum]?(dsf.layer.message("座位序号必须是唯一的，不能相同",!1),!1):(e[t.seatNum]=t.seatNum,!0):(dsf.layer.message("座位序号不能为空",!1),!1)},i=p(this.items);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(!/^sec/.test(o.type)&&!n(o))return}}catch(f){i.e(f)}finally{i.f()}var a,s=p(this.groups);try{for(s.s();!(a=s.n()).done;){var r,l=a.value,c=p(l.member);try{for(c.s();!(r=c.n()).done;){var u=r.value;if(!n(u))return}}catch(f){c.e(f)}finally{c.f()}}}catch(f){s.e(f)}finally{s.f()}this.$emit("save-layout")},restoreLayout:function(){var t={width:this.compelPanelSize.width,height:this.compelPanelSize.height,scale:1,left:0,top:0};this.$store.commit("seatDesign/changePanelSize",t)},updateBG:function(){var t=this,e=Object(u["b"])("dsf-seat-bg-upload");$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var n=new FormData;n.append("file",e.files[0]);var i=function(n){if($(e).val(""),$(e).remove(),e=null,"error"===n)return t.$emit("update:hasBg",!1),!1;S.call(t,n[0])};u["j"].call(t,n,i)})),$(e).click()}}};function S(t){var e=this,n=new Image;n.src=dsf.url.getWebPath(t.relativePath),n.onload=function(){e.$emit("update:hasBg",!0),e.$emit("update:backgroundImage",{width:n.naturalWidth,height:n.naturalHeight,relativePath:t.relativePath,absolutePath:t.absolutePath})},n.onerror=function(){dsf.layer.message("图片加载失败",!1),e.$emit("update:hasBg",!1)}}var x=b,w=i(0),O=Object(w["a"])(x,s,r,!1,null,null,null),C=O.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer-left"},[n("div",{staticClass:"designer-left-tools"},t._l(t.leftMenu.group,(function(e,i){return n("el-collapse",{key:i,model:{value:t.leftMenu.activeName,callback:function(e){t.$set(t.leftMenu,"activeName",e)},expression:"leftMenu.activeName"}},[n("el-collapse-item",{attrs:{title:e.title,name:e.title}},[n("div",{staticClass:"ds-tools-group-content",staticStyle:{padding:"10px"}},t._l(e.items,(function(e,i){return n("div",{key:i,staticClass:"ds-tool-item",attrs:{name:e.name,"data-type":e.type}},[t._v(" "+t._s(e.name)+" ")])})),0)])],1)})),1)])},P=[];function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j={name:"LeftTools",data:function(){return{leftMenu:{activeName:["对象","辅助对象","自定义对象"],group:[{title:"对象",items:[{name:"座席",type:"seat"},{name:"床位",type:"bed"}]},{title:"辅助对象",items:[{name:"矩形",type:"sec_rect"}]},{title:"自定义对象",items:[{name:"床位"}]}]},originWidth:80,originHeight:80}},computed:L({},Vuex.mapState("seatDesign",{panelSize:"panelSize",compelPanelSize:"compelPanelSize"})),mounted:function(){var t=this;$(".ds-tool-item").draggable({addClasses:!1,helper:function(){var t=$(this).text();return $('<div class="drag-item">'.concat(t,"</div>"))},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(e,n){var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:e.pageX,y:e.pageY}),o=t.compelPanelSize.width||$(".seat-designer-page").width(),a=t.compelPanelSize.height||$(".seat-designer-page").height();if(i.x>=0&&i.x<=o&&i.y>=0&&i.y<=a){var s,r=$(e.target).data("type"),l=dsf.math.convertLocalCoordinate("#panel_outer",{x:e.pageX,y:e.pageY},t.panelSize.scale),c={id:dsf.uuid(),type:r,left:l.x,top:l.y,width:t.originWidth,height:t.originHeight,angle:0,isFrozenSty:!1,showText:1,seatTxt:"",seatNum:""};/^sec_/.test(r)?(s={bgImg:""},Object.assign(c,s)):(s={statusKv:"",stateList:[]},Object.assign(c,s)),t.$store.commit("seatDesign/addSeat2Panel",c)}}})}},z=j,E=Object(w["a"])(z,k,P,!1,null,null,null),D=E.exports,A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.showTool?n("div",{staticClass:"right-tool-box"},[n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(0)}}},[n("el-popover",{attrs:{value:t.groupVisible[0],placement:"left-start",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 度量 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(0)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"title"},[n("label",{staticClass:"label-box"},[t._v("当前对象：")]),n("span",{domProps:{textContent:t._s(t.getInfoTypeName())}})]),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("X")]),n("el-input-number",{attrs:{value:t.info.left,size:"mini",controls:!1},on:{change:function(e){return t.info.left=e}}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("Y")]),n("el-input-number",{attrs:{value:t.info.top,size:"mini",controls:!1},on:{change:function(e){return t.info.top=e}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("宽")]),n("el-input-number",{attrs:{value:t.info.width,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateWidth(e)}}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("高")]),n("el-input-number",{attrs:{value:t.info.height,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateHeight(e)}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("角度")]),n("el-input-number",{attrs:{value:t.info.angle,size:"mini",min:0,max:360,controls:!1},on:{change:function(e){return t.info.angle=e}}})],1),"group"===t.info.type?[n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("成员宽")]),n("el-input-number",{attrs:{value:t.memberWidth,size:"mini",controls:!1},on:{change:function(e){return t.upGroupMemberPos("width",e)}}}),n("label",{staticClass:"label-box"},[t._v("成员高")]),n("el-input-number",{attrs:{value:t.memberHeight,size:"mini",controls:!1},on:{change:function(e){return t.upGroupMemberPos("height",e)}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("行间距")]),n("el-input-number",{attrs:{value:t.memberSpaceTop,size:"mini",controls:!1},on:{change:function(e){return t.upGroupSize("row",e)}}}),n("label",{staticClass:"label-box"},[t._v("列间距")]),n("el-input-number",{attrs:{value:t.memberSpaceLeft,size:"mini",controls:!1},on:{change:function(e){return t.upGroupSize("col",e)}}})],1)]:t._e()],2),n("i",{staticClass:"iconfont icon-resize-",attrs:{slot:"reference"},slot:"reference"})])],1),n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(1)}}},[n("el-popover",{attrs:{value:t.groupVisible[1],placement:"left",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 属性 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(1)}}})]),n("div",{staticClass:"inner"},[t.infoIsSec?[n("div",{staticClass:"inner-item"},[n("p",[t._v("文本")]),n("el-input",{model:{value:t.info.seatTxt,callback:function(e){t.$set(t.info,"seatTxt",e)},expression:"info.seatTxt"}})],1)]:["bed"===t.info.type||"bed"===t.info.memberType?n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("宿舍")]),n("el-input",{attrs:{size:"mini"},model:{value:t.info.dormName,callback:function(e){t.$set(t.info,"dormName",e)},expression:"info.dormName"}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("楼层")]),n("el-input",{attrs:{size:"mini"},model:{value:t.info.floorName,callback:function(e){t.$set(t.info,"floorName",e)},expression:"info.floorName"}})],1):t._e(),"bed"===t.info.type||"bed"===t.info.memberType?n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("类型")]),n("el-select",{attrs:{size:"mini"},model:{value:t.info.dormType,callback:function(e){t.$set(t.info,"dormType",e)},expression:"info.dormType"}},t._l(t.sexList,(function(t,e){return n("el-option",{key:e,attrs:{label:t.txt,value:t.val}})})),1),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("备注")]),n("el-input",{attrs:{size:"mini"},model:{value:t.info.remark,callback:function(e){t.$set(t.info,"remark",e)},expression:"info.remark"}})],1):t._e(),"seat"===t.info.type||"seat"===t.info.memberType?n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("房间号")]),n("el-input",{attrs:{size:"mini"},model:{value:t.info.roomNum,callback:function(e){t.$set(t.info,"roomNum",e)},expression:"info.roomNum"}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("备注")]),n("el-input",{attrs:{size:"mini"},model:{value:t.info.remark,callback:function(e){t.$set(t.info,"remark",e)},expression:"info.remark"}})],1):t._e(),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box",staticStyle:{width:"80px","margin-right":"10px"}},[t._v("显示文本")]),n("el-radio-group",{model:{value:t.info.showText,callback:function(e){t.$set(t.info,"showText",e)},expression:"info.showText"}},[n("el-radio",{attrs:{label:1}},[t._v("是")]),n("el-radio",{attrs:{label:2}},[t._v("否")])],1)],1),t.info.member&&t.info.member.length>0?n("div",{staticClass:"inner-item",class:t.info.member.length>4?"scroll-container":""},t._l(t.info.member,(function(e,i){return n("div",{key:i},[n("div",{staticClass:"title"},[t._v(t._s(e.rowIndex+1)+"行"+t._s(e.colIndex+1)+"列:")]),n("label",{staticClass:"label-box"},[t._v("序号")]),n("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:e.seatNum},on:{change:function(n){return t.setNumber(n,e)}}}),n("label",{staticClass:"label-box"},[t._v("文本")]),n("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:e.seatTxt},on:{change:function(t){return e.seatTxt=t.target.value}}})])})),0):n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("序号")]),n("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:t.info.seatNum},on:{change:function(e){return t.setNumber(e,t.info)}}}),n("label",{staticClass:"label-box"},[t._v("文本")]),n("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:t.info.seatTxt},on:{change:function(e){return t.info.seatTxt=e.target.value}}})])]],2),n("i",{staticClass:"iconfont icon-xingzhuang-wenzi",attrs:{slot:"reference"},slot:"reference"})])],1),n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(2)}}},[n("el-popover",{attrs:{value:t.groupVisible[2],placement:"left-start",width:"365",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 上传 "),t.infoIsSec?t._e():n("i",{staticClass:"el-icon el-icon-s-tools",on:{click:function(e){t.dialogVisible=!0}}}),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(2)}}})]),t.infoIsSec?n("div",[n("div",{staticClass:"inner"},[n("div",{staticClass:"single-upload-box",on:{click:t.uploadSingle}},[t.info.bgImg?n("img",{attrs:{src:t.getImagePath(t.info.bgImg),alt:""}}):t._e()])])]):n("div",{staticClass:"inner inner-flex"},t._l(t.info.stateList,(function(e,i){return n("div",{key:e.statusValue,staticClass:"upload-box"},[n("div",{staticClass:"img-box",on:{click:function(n){return t.uploadMultiple(e)}}},[e.img?n("img",{attrs:{src:t.getImagePath(e.img)}}):t._e()]),n("p",[t._v(t._s(e.statusText))])])})),0),n("i",{staticClass:"iconfont icon-tupiantianjia",attrs:{slot:"reference"},slot:"reference"})])],1),n("el-dialog",{attrs:{title:"座位状态管理",visible:t.dialogVisible,modal:!1,width:"35%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("div",{staticClass:"dialog-box"},[n("p",{staticClass:"title"},[t._v("说明")]),n("p",[t._v("statusText - 座位状态")]),n("p",[t._v("statusValue - 座位状态对应的值")]),n("p",[t._v("couldSeat - 此状态下人员能否入座（1能、2否）")]),n("p",{staticClass:"title"},[t._v("默认状态")]),n("p",[n("span",[t._v("正常|1|1")]),n("span",[t._v("已排|2|1")])]),n("p",[n("span",[t._v("锁定|3|2")]),n("span",[t._v("禁用|4|2")])]),n("p",{staticClass:"title"},[t._v("自定义座位状态")]),n("el-input",{attrs:{type:"textarea",rows:5,placeholder:"statusText | statusValue | couldSeat 以|分隔，一行定义一种状态"},model:{value:t.info.statusKv,callback:function(e){t.$set(t.info,"statusKv",e)},expression:"info.statusKv"}})],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.saveStatus}},[t._v("确 定")])],1)])],1):t._e()},N=[];function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var V={name:"RightTools",props:{},data:function(){return{showTool:!1,sexList:[{val:null,txt:"请选择"},{val:1,txt:"男宿舍"},{val:2,txt:"女宿舍"}],defaultStateList:[{img:"",statusText:"正常",statusValue:1,couldSeat:1},{img:"",statusText:"已排",statusValue:2,couldSeat:1},{img:"",statusText:"锁定",statusValue:3,couldSeat:2},{img:"",statusText:"禁用",statusValue:4,couldSeat:2}],info:{stateList:[]},groupVisible:[!1,!1,!1],visiblePointer:null,oldVisibleStatus:!1,dialogVisible:!1}},computed:M(M({},Vuex.mapState("seatDesign",{activeId:"activeId"})),{},{memberWidth:function(){return _.isArray(this.info.member)?this.info.member[0].width:void 0},memberHeight:function(){return _.isArray(this.info.member)?this.info.member[0].height:void 0},memberSpaceTop:function(){return _.isArray(this.info.member)?Object(u["e"])(this.info):void 0},memberSpaceLeft:function(){return _.isArray(this.info.member)?Object(u["d"])(this.info):void 0},infoIsSec:function(){return/^sec_/.test(this.info.type)}}),watch:{activeId:function(t){var e=this;if(t)f["a"].emit(h["a"].GET_ACTIVE_SEAT,(function(t){_.isArray(t.stateList)&&0!==t.stateList.length||(t.stateList=_.cloneDeep(e.defaultStateList)),e.info=t})),this.showTool=!0,this.$nextTick((function(){e.$set(e.groupVisible,e.visiblePointer,e.oldVisibleStatus)}));else{this.showTool=!1;var n=new Array(3);this.groupVisible=_.fill(n,!1)}},info:{handler:function(t){this.$store.commit("seatDesign/changeSeatInfo",t)},deep:!1}},methods:{uploadSingle:function(){var t=this,e=Object(u["b"])();$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var n=new FormData;n.append("file",e.files[0]);var i=function(n){if($(e).val(""),$(e).remove(),e=null,"error"===n)return!1;t.info.bgImg=n[0].relativePath};u["j"].call(t,n,i)})),$(e).click()},uploadMultiple:function(t){var e=this,n=Object(u["b"])();n.multiple=!0,$(n).on("change",(function(){if(!n.files||0===n.files.length)return!1;for(var i=new FormData,o=0;o<n.files.length;o++){var a=n.files[o];i.append("file_"+o,a)}u["j"].call(e,i,(function(i){if($(n).val(""),$(n).remove(),n=null,"error"===i)return!1;1===i.length?t.img=i[0].relativePath:e.info.stateList.forEach((function(t,e){i[e]&&(t.img=i[e].relativePath)})),"group"===e.info.type&&(e.info.isFrozenMemberSty=!1,e.info.member.forEach((function(t){t.stateList=e.info.stateList})))}))})),$(n).click()},closeGroup:function(t){this.visiblePointer=t,this.$set(this.groupVisible,t,!1),this.oldVisibleStatus=!1},showGroup:function(t){this.visiblePointer=t;var e=new Array(3);this.groupVisible=_.fill(e,!1),this.$set(this.groupVisible,t,!0),this.oldVisibleStatus=!0},saveStatus:function(){var t=this;if(this.info.statusKv){var e,n,i=this.info.statusKv.split("\n"),o=_.cloneDeep(this.defaultStateList),a=[],s=[],r=!0,l="";if(i.some((function(t){if(e=t.split("|").map((function(t){return t.replace(/(^\s*)|(\s*$)/g,"")})),1!==+e[2]&&2!==+e[2])return r=!1,l="statusText|statusValue|couldSeat  当中的couldSeat只能为1或2",!0;var i=o.findIndex((function(t){return t.statusValue===+e[1]}));if(-1!==i)return r=!1,l="你的 statusValue 与系统默认的冲突了",!0;var c=s.indexOf(e[1]);if(-1!==c)return r=!1,l="你设置了重复的 statusValue",!0;s.push(e[1]),n={img:"",statusText:e[0],statusValue:+e[1],couldSeat:+e[2]},a.push(n)})),r){var c=_.differenceBy(a,o,"statusValue");this.info.stateList=_.concat(o,c).sort((function(t,e){return t.statusValue-e.statusValue})),"group"===this.info.type&&(this.info.isFrozenMemberSty=!1,this.info.member.forEach((function(e){e.stateList=t.info.stateList}))),this.dialogVisible=!1}else this.saveStatusError(l)}else this.dialogVisible=!1},saveStatusError:function(t){this.info.statusKv="",dsf.layer.alert(t)},getImagePath:function(t){return t?dsf.url.getWebPath(t):null},getInfoTypeName:function(){switch(this.info.type){case"seat":return"座位";case"bed":return"床位";case"group":if("seat"===this.info.memberType)return"座位组";if("bed"===this.info.memberType)return"床位组";break;case"sec_rect":return"矩形"}},updateWidth:function(t){this.info.width=t,this.info.isFrozenSty=!1,"group"===this.info.type&&(this.info.isFrozenMemberSty=!1,Object(u["i"])(this.info))},updateHeight:function(t){this.info.height=t,this.info.isFrozenSty=!1,"group"===this.info.type&&(this.info.isFrozenMemberSty=!1,Object(u["i"])(this.info))},upGroupMemberPos:function(t,e){var n=_.cloneDeep(this.info);n.member.forEach((function(n){"width"===t?n.width=e:n.height=e})),Object(u["i"])(n),this.info=n,this.info.isFrozenMemberSty=!1},upGroupSize:function(t,e){var n=_.cloneDeep(this.info),i=n.member[0];"row"===t?(n.height=(n.rows-1)*e+n.rows*i.height,Object(u["i"])(n)):"col"===t&&(n.width=(n.cols-1)*e+n.cols*i.width,Object(u["i"])(n)),this.info=n,this.info.isFrozenMemberSty=!1},setNumber:function(t,e){var n=t.target.value,i=n.replace(/[^0-9]/gi,"");i&&i.length>0?(t.target.value=parseInt(i),e.seatNum=parseInt(i)):(t.target.value="",e.seatNum="")}}},R=V,F=Object(w["a"])(R,A,N,!1,null,null,null),B=F.exports,Y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-designer-page",style:t.canvasCss,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.preRegion.apply(null,arguments)}}},[n("region",{attrs:{visible:t.regionVisible,region:t.regionRect}}),n("div",{style:t.panelSty,attrs:{id:"panel_outer"}},[t._t("seat"),n("div",{staticClass:"ds_seat_panel_bg",attrs:{id:"panel_bg"}})],2),t._t("seatPop")],2)},G=[],K=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"region",style:t.regionSty}):t._e()},q=[],U={name:"Region",props:{visible:{type:Boolean,default:!1},region:{type:Object,default:function(){return{}}}},data:function(){return{test:!1}},computed:{regionSty:function(){return{left:this.region.left+"px",top:this.region.top+"px",width:this.region.width+"px",height:this.region.height+"px"}}},methods:{}},W=U,X=Object(w["a"])(W,K,q,!1,null,null,null),H=X.exports;function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Z={name:"Canvas",components:{region:H},data:function(){return{regionVisible:!1,regionRect:{}}},computed:Q(Q({},Vuex.mapState("seatDesign",{compelPanelSize:"compelPanelSize",panelSize:"panelSize",canvasCss:function(t){var e=t.compelPanelSize,n=e.width,i=e.height,o=n?"".concat(n,"px"):"100%",a=i?"".concat(i,"px"):"100%";return{width:o,height:a}},panelParentSize:function(t){var e=t.compelPanelSize,n=e.width,i=e.height;return n=n||$(".seat-designer-page").width(),i=i||$(".seat-designer-page").height(),{width:n,height:i}}})),{},{panelSty:function(){return{width:this.panelSize.width?this.panelSize.width+"px":"100%",height:this.panelSize.height?this.panelSize.height+"px":"100%",left:this.panelSize.left+"px",top:this.panelSize.top+"px"}}}),watch:{compelPanelSize:{handler:function(t){var e=t.width,n=t.height,i={width:e,height:n,scale:1,left:0,top:0};this.$store.commit("seatDesign/changePanelSize",i)},deep:!0}},mounted:function(){var t=this;$(".seat-designer-page")[0].addEventListener("mousewheel",t.handleScroll)},methods:{handleScroll:function(t){if(t.ctrlKey||e.metaKey){var n=this,i=t.wheelDelta<0?"down":"up",o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY}),a=n.panelParentSize,s=a.width,r=a.height,l=s*n.panelSize.scale,c=r*n.panelSize.scale,u=o.x/l,f=o.y/c,h=n.panelSize.scale;if("up"===i?h+=.1:"down"===i&&(h-=.1),h>=.1){var d=$("#panel_outer"),p=s*h,m=r*h,g=d.position().left+o.x-p*u,v=d.position().top+o.y-m*f,y={scale:Math.round(10*h)/10,width:Math.floor(p),height:Math.floor(m),left:Math.floor(g),top:Math.floor(v)};n.$store.commit("seatDesign/changePanelSize",y)}t.preventDefault(),t.stopPropagation()}},preRegion:function(t){var e=this;e.$store.commit("seatDesign/changeActiveId","");var n=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});function i(t){e.regionVisible=!0;var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});e.$set(e.regionRect,"left",n.x>i.x?i.x:n.x),e.$set(e.regionRect,"top",n.y>i.y?i.y:n.y),e.$set(e.regionRect,"width",Math.abs(i.x-n.x)),e.$set(e.regionRect,"height",Math.abs(i.y-n.y))}function o(){$(document).off("mousemove.region"),e.$store.commit("seatDesign/changeRegionPosition",e.regionRect),e.regionVisible=!1,e.regionRect={}}$(document).off("mousemove.region"),$(document).on("mousemove.region",(function(t){i(t)})),$(document).one("mouseup.region",(function(){o()}))}}},tt=Z,et=Object(w["a"])(tt,Y,G,!1,null,null,null),nt=et.exports,it=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-item-container",class:t.switchNumSet?"set-num":"normal"},[t.verLine.visible?n("div",{staticClass:"vertical-line",style:t.verLineSty}):t._e(),t.horLine.visible?n("div",{staticClass:"horizontal-line",style:t.horLineSty}):t._e(),t.selectPosition.visible?n("div",{staticClass:"selected-box",style:t.selectSty,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectMove.apply(null,arguments)}}},[n("div",{staticClass:"select"},[t.switchNumSet?t._e():n("div",{staticClass:"anchor circle",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectRotate.apply(null,arguments)}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor line"}),t.switchNumSet?t._e():n("div",{staticClass:"anchor lt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lt")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor t",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"t")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor rt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rt")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor l",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"l")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor r",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"r")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor lb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lb")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor b",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"b")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor rb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rb")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor info"},[t._v(" 宽:"+t._s(t.selectPosition.width)+";高:"+t._s(t.selectPosition.height)+";角度:"+t._s(t.selectPosition.angle)+" ")])])]):t._e(),t._l(t.mitems,(function(e,i){return n("div",{key:e.id,staticClass:"seat-box",class:{active:t.activeId===e.id,hideText:2===e.showText},style:t.getItemSty(e),on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preMove(n,e)},contextmenu:function(n){return t.popMenu(n,e)}}},[n("div",{staticClass:"seat",on:{dblclick:function(n){return n.stopPropagation(),t.openEdit(n,e)}}},[t.switchNumSet?t._e():n("div",{staticClass:"anchor circle",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preRotate(n,e)}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor line"}),t.switchNumSet?t._e():n("div",{staticClass:"anchor lt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lt")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor t",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"t")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor rt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rt")}}}),t.switchNumSet?n("p",{staticClass:"num",on:{dblclick:function(n){return n.stopPropagation(),t.openSetNum(n,e)}}},[t._v(t._s(e.seatNum))]):n("p",[t._v(t._s(e.seatTxt))]),t.switchNumSet?t._e():n("div",{staticClass:"anchor l",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"l")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor r",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"r")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor lb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lb")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor b",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"b")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor rb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rb")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor info"},[t._v("宽:"+t._s(e.width)+";高:"+t._s(e.height)+";角度:"+t._s(e.angle))])])])})),t._l(t.groups,(function(e,i){return n("div",{key:e.id,staticClass:"group-box",class:{active:t.activeId===e.id,hideText:2===e.showText},style:t.getItemSty(e),on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preMove(n,e)},contextmenu:function(n){return t.popMenu(n,e)}}},[n("div",{staticClass:"group"},[t.switchNumSet?t._e():n("div",{staticClass:"anchor circle",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preRotate(n,e)}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor line"}),t.switchNumSet?t._e():n("div",{staticClass:"anchor lt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lt")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor t",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"t")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor rt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rt")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor l",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"l")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor r",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"r")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor lb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lb")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor b",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"b")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor rb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rb")}}}),t.switchNumSet?t._e():n("div",{staticClass:"anchor info"},[t._v("宽:"+t._s(e.width)+";高:"+t._s(e.height)+";角度:"+t._s(e.angle)+" ")]),t._l(e.member,(function(i,o){return n("div",{key:i.id,staticClass:"member",style:t.getMemberSty(i,e),on:{click:function(e){return e.stopPropagation(),t.setOrderNum(i)},dblclick:function(e){return e.stopPropagation(),t.openEdit(e,i)}}},[t.switchNumSet?n("p",{staticClass:"num",on:{dblclick:function(e){return e.stopPropagation(),t.openSetNum(e,i)}}},[t._v(t._s(i.seatNum))]):n("p",[t._v(t._s(i.seatTxt))])])}))],2)])}))],2)},ot=[];function at(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function st(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?at(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var rt={name:"SeatItem",props:{items:{type:Array,default:function(){return[]}},groups:{type:Array,default:function(){return[]}}},data:function(){return{selectedItems:[],rectMinSize:[40,40],selectPosition:{top:0,left:0,width:0,height:0,visible:!1},verLine:{left:0,visible:!1},horLine:{top:0,visible:!1},maxOrderNum:null}},computed:st(st({},Vuex.mapState("seatDesign",{panelSize:"panelSize",newSeatItem:"newSeatItem",newGroupItem:"newGroupItem",activeId:"activeId",regionPosition:"regionPosition",seatInfo:"seatInfo",switchNumSet:"switchNumSet"})),{},{mitems:function(){var t=this;return this.items.filter((function(e){return!(t.switchNumSet&&/^sec_/.test(e.type))}))},selectSty:function(){var t=this.panelSize.scale;return{width:this.selectPosition.width*t+"px",height:this.selectPosition.height*t+"px",left:this.selectPosition.left*t+"px",top:this.selectPosition.top*t+"px",transform:"rotate(".concat(this.selectPosition.angle,"deg)")}},verLineSty:function(){return{left:"".concat(this.verLine.left*this.panelSize.scale)+"px"}},horLineSty:function(){return{top:"".concat(this.horLine.top*this.panelSize.scale)+"px"}}}),watch:{newSeatItem:function(t){u["c"].call(this);var e=_.assign({},t);this.items.push(e)},newGroupItem:function(t){u["c"].call(this);var e=_.assign({},t);this.groups.push(e)},regionPosition:function(t){var e=this;if(_.isEmpty(t)||0===t.width||0===t.height)return u["c"].call(e),e.selectedItems=[],void _t.call(e);var n=_.concat(e.items,e.groups);e.selectedItems=_.filter(n,(function(t){return ut.call(e,t)})),u["c"].call(e),0!==e.selectedItems.length&&(1===e.selectedItems.length?e.$store.commit("seatDesign/changeActiveId",e.selectedItems[0].id):e.selectedItems.length>1&&(e.selectPosition=xt(e.selectedItems)))},seatInfo:{handler:function(t,e){if(u["c"].call(this),"group"===t.type){var n=_.findIndex(this.groups,(function(e){return e.id===t.id}));this.$set(this.groups,n,t)}else{var i=_.findIndex(this.items,(function(e){return e.id===t.id}));this.$set(this.items,i,t)}},deep:!1},"panelSize.scale":function(){this.items.forEach((function(t){t.isFrozenSty=!1})),this.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1}))},selectedItems:function(t){t&&t.length>0?this.$store.commit("seatDesign/changeHaveSelectedItems",!0):this.$store.commit("seatDesign/changeHaveSelectedItems",!1)},switchNumSet:function(t){u["h"].call(this),t&&lt.call(this)}},beforeDestroy:function(){$(document).off("mouseup.scaleSeatItem"),$(document).off("mousemove.scaleSeatItem")},mounted:function(){var t=this;f["a"].on(h["a"].KEY_CTRL_D,(function(){_t.call(t),t.selectedItems=[],t.$store.commit("seatDesign/changeActiveId","")})),f["a"].on(h["a"].KEY_DELETE,(function(){t.deleteActiveSeatItem()})),f["a"].on(h["a"].GET_ACTIVE_SEAT,(function(e){var n=_.concat(t.items,t.groups),i=n.find((function(e){return e.id===t.activeId}));e&&e(i)})),f["a"].on(h["a"].CLEAN_ALL_SEAT_NUM,(function(){t.items.forEach((function(t){t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null})),t.groups.forEach((function(t){t.member.forEach((function(t){t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null}))})),t.maxOrderNum=null})),f["a"].on(h["a"].CLEAN_SELECT_SEAT_NUM,(function(){t.selectedItems.forEach((function(t){"group"!==t.type?(t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null):t.member.forEach((function(t){t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null}))})),lt.call(t),t.clearSelectedItems()})),f["a"].on(h["a"].AFTER_QUICK_ORDER,(function(){lt.call(t),t.clearSelectedItems()}))},methods:{getItemSty:function(t){if(t.isFrozenSty)return t.style;var e={width:t.width*this.panelSize.scale+"px",height:t.height*this.panelSize.scale+"px",left:t.left*this.panelSize.scale+"px",top:t.top*this.panelSize.scale+"px",transform:"rotate(".concat(t.angle,"deg)")};return this.switchNumSet||"group"===t.type||(e.background=It(t)),t.style=e,e},getMemberSty:function(t,e){if(e.isFrozenMemberSty)return t.style;var n={width:t.width*this.panelSize.scale+"px",height:t.height*this.panelSize.scale+"px",left:t.left*this.panelSize.scale+"px",top:t.top*this.panelSize.scale+"px"};return this.switchNumSet||(n.background=It(e)),t.style=n,n},clearSelectedItems:function(){this.selectedItems=[],_t.call(this),this.$store.commit("seatDesign/changeActiveId","")},preScale:function(t,e,n){t.stopPropagation(),t.preventDefault();var i=this;u["c"].call(i,!1),"group"===e.type&&(e.isFrozenMemberSty=!1);var o=_.assign({},e),a=_.assign({},e),s=ht(o,n);function r(t){if(n&&s){var r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale),l=dt(s,o,a,r,n,"group"!==e.type?i.rectMinSize:Pt(o));_.assign(e,l),"group"===e.type&&Object(u["i"])(l)}}function l(){if($(document).off("mousemove.scaleSeatItem"),u["c"].call(i),"group"===e.type){var t=e.member[0];1===e.rows&&(e.height=t.height),1===e.cols&&(e.width=t.width)}}$(document).off("mousemove.scaleSeatItem"),$(document).on("mousemove.scaleSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),r(t)}),5)),$(document).one("mouseup.scaleSeatItem",(function(){l()}))},preMove:function(t,e){t.preventDefault(),t.stopPropagation();var n=this;if(this.switchNumSet)return u["c"].call(n),ct.call(n,e),void this.setOrderNum(e);ct.call(n,e),u["c"].call(n),n.verLine.visible=!1,n.horLine.visible=!1;var i=Ot.call(n),o=kt(i),a=e.left,s=e.top,r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);function l(t){var i=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale),l={x:i.x-r.x,y:i.y-r.y};e.left=parseInt(a+l.x),e.top=parseInt(s+l.y),n.verLine.visible=!1,n.horLine.visible=!1;var c=ft(e,["lt"]),u=kt(c),f=Ct(u,o,e);f&&(n.horLine.top=f.top,n.horLine.visible=_.isNumber(f.top),n.verLine.left=f.left,n.verLine.visible=_.isNumber(f.left))}function c(){$(document).off("mousemove.moveSeatItem"),u["c"].call(n),n.verLine.visible=!1,n.horLine.visible=!1}$(document).off("mousemove.moveSeatItem"),$(document).on("mousemove.moveSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),l(t)}),5)),$(document).one("mouseup.moveSeatItem",(function(){c()}))},preRotate:function(t,e){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var n=this;u["c"].call(n);var i=vt(e);function o(t){var o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);e.angle=pt(i,o)}function a(){$(document).off("mousemove.rotateSeatItem"),u["c"].call(n),$(".ds-seat-design").removeClass("is-rotating")}$(document).off("mousemove.rotateSeatItem"),$(document).on("mousemove.rotateSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),o(t)}),5)),$(document).one("mouseup.rotateSeatItem",(function(){a()}))},selectRotate:function(t){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var e=this;u["c"].call(e);var n=_.assign({},e.selectPosition),i=vt(n),o={},a=_.concat(e.items,e.groups);function s(t){var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),s=pt(i,a),r=s-n.angle;e.selectPosition.angle=s,e.selectedItems.forEach((function(t){var e=o[t.id],n=dsf.math.getRotatedPiont(e.left,e.top,i.x,i.y,s),a=n.x+e.width/2,l=n.y+e.height/2,c=dsf.math.getRotatedPiont(a,l,n.x,n.y,s);n=dsf.math.getRotatedPiont(n.x,n.y,c.x,c.y,-s),t.top=parseInt(n.y),t.left=parseInt(n.x),t.angle=(e.angle+r)%360,e.angle<0&&(t.angle=360+e.angle)}))}function r(){$(".ds-seat-design").removeClass("is-rotating"),e.selectPosition=xt(e.selectedItems),$(document).off("mousemove.rotateSelect"),u["c"].call(e)}a.forEach((function(t){o[t.id]=_.assign({},t)})),$(document).off("mousemove.rotateSelect"),$(document).on("mousemove.rotateSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),s(t)}),5)),$(document).one("mouseup.rotateSelect",(function(){r()}))},selectScale:function(t,e){t.stopPropagation(),t.preventDefault();var n=this;u["c"].call(n,!1);var i=_.assign({},n.selectPosition),o=_.assign({},n.selectPosition),a={},s=_.concat(n.items,n.groups);s.forEach((function(t){a[t.id]=_.assign({},t)}));var r=ht(i,e),l=mt(n.selectedItems,n.selectPosition);function c(t){if(e&&r){var s=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);n.selectPosition=dt(r,i,o,s,e,n.rectMinSize),n.selectedItems.forEach((function(t){var o=gt(a[t.id],i,n.selectPosition,e,l);"group"===o.type&&Object(u["i"])(o),_.assign(t,o)}))}}function f(){$(document).off("mousemove.scaleSelect"),u["c"].call(n),n.selectedItems.forEach((function(t){"group"===t.type&&(1===t.rows&&(t.height=a[t.id].height),1===t.cols&&(t.width=a[t.id].width))})),n.selectPosition=xt(n.selectedItems)}$(document).off("mousemove.scaleSelect"),$(document).on("mousemove.scaleSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),c(t)}),5)),$(document).one("mouseup.scaleSelect",(function(){f()}))},selectMove:function(t){if(t.preventDefault(),t.stopPropagation(),!this.switchNumSet){var e=this;u["c"].call(e);var n=e.selectPosition.left,i=e.selectPosition.top,o={},a=_.concat(e.items,e.groups);a.forEach((function(t){o[t.id]=_.assign({},t)}));var s=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale);$(document).off("mousemove.moveSelect"),$(document).on("mousemove.moveSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),r(t)}),5)),$(document).one("mouseup.moveSelect",(function(){l()}))}function r(t){var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),r={x:a.x-s.x,y:a.y-s.y},l=n+r.x,c=i+r.y;e.selectPosition.left=parseInt(l),e.selectPosition.top=parseInt(c),e.selectedItems.forEach((function(t){t.left=parseInt(o[t.id].left+r.x),t.top=parseInt(o[t.id].top+r.y)}))}function l(){$(document).off("mousemove.moveSelect"),u["c"].call(e)}},popMenu:function(t,e){if(!/^sec_/.test(e.type)&&3===t.which){t.preventDefault(),t.stopPropagation();var n=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});u["c"].call(this),ct.call(this,e),f["a"].emit(h["a"].SEAT_POP,{position:st({},n),seat:e,maxOrderNum:this.maxOrderNum})}},deleteActiveSeatItem:function(){if(0!==this.selectedItems.length){var t=_.differenceWith(this.items,this.selectedItems,(function(t,e){return t.id===e.id&&"group"!==e.type})),e=_.differenceWith(this.groups,this.selectedItems,(function(t,e){return t.id===e.id&&"group"===e.type}));this.$emit("update:items",t),this.$emit("update:groups",e),this.clearSelectedItems()}},setOrderNum:function(t,e){this.switchNumSet&&"group"!==t.type&&!t.seatNum&&(this.maxOrderNum?this.maxOrderNum+=1:this.maxOrderNum=1,t.seatNum=this.maxOrderNum,t.seatTxt=t.seatTxt||t.seatNum)},openEdit:function(t,e){if(!this.switchNumSet&&!$(t.target).hasClass("anchor")){var n=document.createElement("textarea"),i=function(t){e.seatTxt=t,$(n).remove(),n=null};$(t.target).append(n),$(n).val(e.seatTxt),$(n).on("blur",(function(){i($(this).val())})),$(n).bind("keypress",(function(t){13===t.keyCode&&i($(this).val())})),$(n).focus()}},openSetNum:function(t,e){var n=this,i=document.createElement("input"),o=function(t){t?(t=parseInt(t.replace(/[^0-9]/gi,"")),e.seatTxt==e.seatNum&&(e.seatTxt=t),e.seatNum=t,t>n.maxOrderNum?n.maxOrderNum=t:lt.call(n)):(e.seatTxt==e.seatNum&&(e.seatTxt=null),e.seatNum=null,lt.call(n)),$(i).remove(),i=null};$(t.target).append(i),$(i).val(e.seatNum),$(i).on("blur",(function(){o($(this).val())})),$(i).bind("keypress",(function(t){13===t.keyCode&&o($(this).val())})),$(i).focus()}}};function lt(){var t=[];_.concat(this.items,this.groups).forEach((function(e){"group"!==e.type?e.seatNum&&t.push(e.seatNum):e.member.forEach((function(e){e.seatNum&&t.push(e.seatNum)}))}));var e=t.sort((function(t,e){return t-e}));this.maxOrderNum=_.last(e)||null}function ct(t){this.activeId!==t.id&&(_t.call(this),this.selectedItems=[t],this.$store.commit("seatDesign/changeActiveId",t.id))}function ut(t){var e=ft(t),n=yt(e),i=this.panelSize,o=(i.left,i.top,i.scale),a=this.regionPosition,s=a.left,r=a.top,l=a.width,c=a.height,u=$(".seat-designer-page").offset(),f={x:s+u.left,y:r+u.top},h={x:s+u.left+l,y:r+u.top+c};f=dsf.math.convertLocalCoordinate("#panel_outer",f,o),h=dsf.math.convertLocalCoordinate("#panel_outer",h,o);var d=n.min_x>=f.x,p=n.max_x<=h.x,m=n.min_y>=f.y,g=n.max_y<=h.y;return d&&p&&m&&g}function ft(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["lt","rt","rb","lb"],n=t.angle,i=t.left,o=t.top,a=t.left+t.width,s=t.top+t.height,r={lt:0,lb:0,rt:0,rb:0},l=.5*(a-i)+i,c=.5*(s-o)+o;return e.includes("lt")&&(r.lt=dsf.math.getRotatedPiont(i,o,l,c,n)),e.includes("rt")&&(r.rt=dsf.math.getRotatedPiont(a,o,l,c,n)),e.includes("rb")&&(r.rb=dsf.math.getRotatedPiont(a,s,l,c,n)),e.includes("lb")&&(r.lb=dsf.math.getRotatedPiont(i,s,l,c,n)),r}function ht(t,e){var n={};e.length>1?(e.indexOf("l")>=0?n.x=t.left+t.width:n.x=t.left,e.indexOf("t")>=0?n.y=t.top+t.height:n.y=t.top):"r"===e||"b"===e?(n.x=t.left,n.y=t.top):"l"!==e&&"t"!==e||(n.x=t.left+t.width,n.y=t.top+t.height);var i={x:t.left+t.width/2,y:t.top+t.height/2};return n=dsf.math.getRotatedPiont(n.x,n.y,i.x,i.y,t.angle),n}function dt(t,e,n,i,o,a){var s,r,l=dsf.math.getDistance(t,i),c=dsf.math.getRadina(t,i,-dsf.math.a2r(e.angle)),u={x:Math.cos(c)*l+e.left,y:Math.sin(c)*l+e.top};if(o.indexOf("r")>=0?s=u.x-e.left:o.indexOf("l")>=0&&(s=e.left-u.x),o.indexOf("b")>=0?r=u.y-e.top:o.indexOf("t")>=0&&(r=e.top-u.y),o.length>1){var f=s/e.width;n.width=e.width*f,n.height=e.height*f}else dsf.isDef(s)?n.width=s:n.width=e.width,dsf.isDef(r)?n.height=r:n.height=e.height;n.width<a[0]&&(n.width=a[0]),n.height<a[1]&&(n.height=a[1]);var h={};o.length>1?(o.indexOf("r")>=0?h.x=t.x+n.width:o.indexOf("l")>=0?h.x=t.x-n.width:h.x=t.x,o.indexOf("b")>=0?h.y=t.y+n.height:o.indexOf("t")>=0?h.y=t.y-n.height:h.y=t.y):"r"===o||"b"===o?(h.x=t.x+n.width,h.y=t.y+n.height):"l"!==o&&"t"!==o||(h.x=t.x-n.width,h.y=t.y-n.height);var d=dsf.math.getRotatedPiont(h.x,h.y,t.x,t.y,e.angle),p={x:.5*(t.x+d.x),y:.5*(t.y+d.y)},m=dsf.math.getRotatedPiont(t.x,t.y,p.x,p.y,-e.angle);return o.length>1?(o.indexOf("r")>=0?n.left=m.x:o.indexOf("l")>=0?n.left=m.x-n.width:n.left=m.x-n.width/2,o.indexOf("b")>=0?n.top=m.y:o.indexOf("t")>=0?n.top=m.y-n.height:n.top=m.y-n.height/2):"r"===o||"b"===o?(n.left=m.x,n.top=m.y):"l"!==o&&"t"!==o||(n.left=m.x-n.width,n.top=m.y-n.height),bt(n),n}function pt(t,e){var n=dsf.math.getRadina(t,e),i=90+dsf.math.r2a(n);return i=Math.ceil(i)%360,i}function mt(t,e){var n={};return _.forEach(t,(function(t){var i=_.assign({},t);n[t.id]={left:(i.left-e.left)/e.width,top:(i.top-e.top)/e.height,width:i.width/e.width,height:i.height/e.height}})),n}function gt(t,e,n,i,o){var a=_.assign({},t),s=o[a.id];if(a.left=n.left+n.width*s.left,a.top=n.top+n.height*s.top,2===i.length){var r=n.width/e.width,l=n.height/e.height;r=.5*(r+l),a.width=r*t.width,a.height=r*t.height}else 1===i.length&&(a.width=n.width*s.width,a.height=n.height*s.height);return St(a),a}function vt(t){return{x:t.left+t.width/2,y:t.top+t.height/2}}function yt(t){var e,n,i,o;return _.forIn(t,(function(t){e=e||t.x,n=n||t.x,i=i||t.y,o=o||t.y,e=e<=t.x?e:t.x,n=n>=t.x?n:t.x,i=i<=t.y?i:t.y,o=o>=t.y?o:t.y})),{min_x:e,min_y:i,max_x:n,max_y:o}}function bt(t){t.top=parseInt(t.top),t.left=parseInt(t.left),t.width=parseInt(t.width),t.height=parseInt(t.height)}function St(t){t.top=Math.round(t.top),t.left=Math.round(t.left),t.width=Math.round(t.width),t.height=Math.round(t.height)}function xt(t){var e,n,i,o,a;return _.forEach(t,(function(t){a=ft(t),_.forIn(a,(function(t){e=e||t.x,n=n||t.x,i=i||t.y,o=o||t.y,e=e<=t.x?e:t.x,n=n>=t.x?n:t.x,i=i<=t.y?i:t.y,o=o>=t.y?o:t.y}))})),{left:wt(e),top:wt(i),width:wt(n-e),height:wt(o-i),angle:0,visible:!0}}function wt(t){return t<0?Math.floor(t):Math.ceil(t)}function _t(){this.selectPosition={top:0,left:0,width:0,height:0,angle:0,visible:!1}}function Ot(){var t=this,e=_.filter(_.concat(this.items,this.groups),(function(e){return e.id!==t.activeId}));return e.map((function(t){return ft(t,["lt"])}))}function Ct(t,e,n){for(var i={},o=0,a=0;a<e.length;a++)if(t.left>=e[a].left-3&&t.left<=e[a].left+3&&(i.left=e[a].left,o+=1,0===n.angle&&(n.left=i.left)),t.top>=e[a].top-3&&t.top<=e[a].top+3&&(i.top=e[a].top,o+=1,0===n.angle&&(n.top=i.top)),2===o)break;return i.left||i.top?i:null}function kt(t){var e=[],n={};return _.isArray(t)?(_.forEach(t,(function(t){n={left:Math.round(t.lt.x),top:Math.round(t.lt.y)},e.push(n)})),_.uniqWith(e,_.isEqual)):_.isObject(t)?{left:Math.round(t.lt.x),top:Math.round(t.lt.y)}:void 0}function Pt(t){var e=t.member[0];return[t.cols*e.width,t.rows*e.height]}function It(t){var e;if(/^sec_/.test(t.type))e=dsf.url.getAbsolutePath(t.bgImg);else{var n=_.isArray(t.stateList)&&t.stateList[0]&&t.stateList[0].img;if(!n)return"none";e=dsf.url.getAbsolutePath(t.stateList[0].img)}return"center / contain no-repeat url(".concat(e,")")}var Lt=rt,$t=Object(w["a"])(Lt,it,ot,!1,null,null,null),jt=$t.exports,zt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.popShow,expression:"popShow"}],staticClass:"seat-pop-box",style:t.sty},[n("ul",[t.switchNumSet?n("li",{on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.popDialog.apply(null,arguments)}}},[t._v("快速填充序号")]):n("li",{on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.popDialog.apply(null,arguments)}}},[t._v("方阵组")])]),n("el-dialog",{attrs:{visible:t.dialogVisible,title:"信息",width:"300px",modal:!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-form",{attrs:{model:t.form,size:"small"}},[t.switchNumSet?[n("el-form-item",{attrs:{label:"排序开始位置"}},[n("el-radio-group",{model:{value:t.form.orderPosition,callback:function(e){t.$set(t.form,"orderPosition",e)},expression:"form.orderPosition"}},[n("el-radio",{attrs:{label:"lt"}},[t._v("左上角")]),n("el-radio",{attrs:{label:"rt"}},[t._v("右上角")]),n("el-radio",{attrs:{label:"rb"}},[t._v("右下角")]),n("el-radio",{attrs:{label:"lb"}},[t._v("左下角")])],1)],1),n("el-form-item",{attrs:{label:"开始序号"}},[n("el-input-number",{attrs:{precision:0,controls:!1,min:1},model:{value:t.form.orderBegin,callback:function(e){t.$set(t.form,"orderBegin",e)},expression:"form.orderBegin"}})],1)]:[n("el-form-item",{attrs:{label:"列数"}},[n("el-input-number",{attrs:{precision:0,controls:!1,min:1},model:{value:t.form.colNum,callback:function(e){t.$set(t.form,"colNum",e)},expression:"form.colNum"}})],1),n("el-form-item",{attrs:{label:"个数"}},[n("el-input-number",{attrs:{precision:0,controls:!1,min:1},model:{value:t.form.total,callback:function(e){t.$set(t.form,"total",e)},expression:"form.total"}})],1)],n("el-form-item",{staticStyle:{"text-align":"right"}},[t.switchNumSet?n("el-button",{on:{click:t.quickOrder}},[t._v("确定")]):n("el-button",{on:{click:t.setGroup}},[t._v("创建")])],1)],2)],1)],1)},Et=[];function Dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function At(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Nt={name:"SeatPop",data:function(){return{dialogVisible:!1,form:{colNum:void 0,total:void 0,orderPosition:"lt",orderBegin:1},seat:{},position:{},popShow:!1}},computed:At(At({},Vuex.mapState("seatDesign",["switchNumSet"])),{},{sty:function(){return{left:this.position.x+"px",top:this.position.y+"px"}}}),mounted:function(){var t=this;f["a"].on(h["a"].SEAT_POP,(function(e){"group"!==e.seat.type&&t.switchNumSet?t.popShow=!1:(Object.assign(t,e),t.form.orderBegin=e.maxOrderNum+1,t.popShow=!0,"group"===e.seat.type?(t.form.colNum=e.seat.cols,t.form.total=e.seat.member.length):(t.form.colNum=void 0,t.form.total=void 0))})),f["a"].listen(h["a"].BODY_EMPTY_CLICK,(function(){t.popShow=!1}))},methods:{popDialog:function(t){t.stopPropagation(),t.preventDefault(),this.popShow=!0,this.dialogVisible=!0},setGroup:function(){"group"!==this.seat.type?this.setGroupBySeat():this.setGroupByGroup()},setGroupBySeat:function(){var t=this.form,e=t.total,n=t.colNum;if(!e||!n||1===e)return this.dialogVisible=!1,this.popShow=!1,!1;var i=Math.ceil(e/n),o=dsf.uuid();this.seat.parentId=o,this.seat.belong="group";var a=Tt.call(this,n,e,this.seat),s=this.seat.width*n,r=this.seat.height*i,l=At(At({},this.seat),{},{id:o,type:"group",cols:n,rows:i,width:s,height:r,memberType:this.seat.type,member:a,isFrozenSty:!1,isFrozenMemberSty:!1});this.$store.commit("seatDesign/addGroup2Panel",l),f["a"].emit(h["a"].KEY_DELETE),this.dialogVisible=!1,this.popShow=!1},setGroupByGroup:function(){var t=this.form,e=t.total,n=t.colNum,i=Math.ceil(e/n),o=this.seat.member[0];if(o.parentId=null,o.belong=null,1===e){var a=At(At({},o),{},{left:this.seat.left,top:this.seat.top,angle:this.seat.angle,stateList:this.seat.stateList,isFrozenSty:!1});this.$store.commit("seatDesign/addSeat2Panel",a)}else if(e>1){var s=dsf.uuid();o.parentId=s,o.belong="group";var r=Tt.call(this,n,e,o),l=o.width*n,c=o.height*i,u=At(At({},this.seat),{},{id:s,cols:n,rows:i,width:l,height:c,member:r,isFrozenSty:!1,isFrozenMemberSty:!1});this.$store.commit("seatDesign/addGroup2Panel",u)}f["a"].emit(h["a"].KEY_DELETE),this.dialogVisible=!1,this.popShow=!1},quickOrder:function(){var t=this;"lt"===this.form.orderPosition&&this.seat.member.forEach((function(e){e.seatNum==e.seatTxt&&(e.seatTxt=t.form.orderBegin),e.seatNum=t.form.orderBegin,t.form.orderBegin+=1})),f["a"].emit(h["a"].AFTER_QUICK_ORDER),this.dialogVisible=!1,this.popShow=!1}}};function Tt(t,e,n){for(var i=[],o=0;o<e;o++){var a=Math.floor(o/t),s=o%t,r=s*n.width,l=a*n.height,c=At(At({},n),{},{id:dsf.uuid(),left:r,top:l,colIndex:s,rowIndex:a,angle:0});i.push(c)}return i}var Mt=Nt,Vt=Object(w["a"])(Mt,zt,Et,!1,null,null,null),Rt=Vt.exports,Ft=i(444),Bt={name:"DsfSeatDesign",components:{topTools:C,leftTools:D,rightTools:B,SeatCanvas:nt,seatItem:jt,seatPop:Rt},data:function(){return{keyStack:[],postData:{_id:"",backgroundImage:{},canvasSet:{width:void 0,height:void 0},hasBg:!1,items:[],groups:[]}}},computed:{},watch:{"postData.backgroundImage":function(){u["a"].call(this)}},created:function(){var t=this,e=dsf.url.getWebPath("$/seat_config/seat/designSeatLayout.js");this.$http.importFiles(e).then((function(e){t.layoutConfig=new Ft["a"](designSeatLayoutConfig,t.$route.query.opt),t.bindShortKey(),t.getSeatInfo()}))},beforeDestroy:function(){$(document).off("keydown"),$(document).off("keyup")},methods:{saveLayout:function(){this.saveByPub()},bindShortKey:function(){var t=["ctrl","ctrl-d","ctrl-s"];Object(u["g"])(this.keyStack,t),$("body").on("click",(function(){f["a"].dispatch(h["a"].BODY_EMPTY_CLICK)}))},saveByDev:function(){var t=Yt.call(this),e=this.$route.query.id||dsf.uuid();t._id=e,localStorage.setItem("seat_"+e,JSON.stringify(t));var n=this.$route.query,i=Object.assign({},n,{id:e});this.$router.replace({path:this.$route.path,query:i})},saveByPub:function(){var t=this,e=Yt.call(this),n={pageName:"edit",namespace:"dsfa.seat.designcontent",data:JSON.stringify(e)},i=dsf.layer.loading();this.$http.post(this.layoutConfig.saveLayoutUrl,n).done((function(e){e.success?(t.postData._id=e.data._id,t.$router.replace({path:t.$route.path,query:{id:e.data._id}}),dsf.layer.message("保存成功")):dsf.layer.message("排座设计器保存失败",!1)})).error((function(t){dsf.layer.message("排座设计器保存失败",!1)})).always((function(){dsf.layer.closeLoading(i)}))},getSeatInfo:function(){this.getInfoPub()},getInfoDev:function(){var t=this.$route.query.id;if(t){var e=JSON.parse(localStorage.getItem("seat_"+t));e&&(_.isEmpty(e.canvasSet)&&(e.canvasSet={width:void 0,height:void 0}),this.postData=e)}},getInfoPub:function(){this.$route.query.id}}};function Yt(){var t=_.cloneDeep(this.postData);return t.items.forEach((function(t){t.isFrozenSty=!1})),t.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1})),t}var Gt=Bt,Kt=Object(w["a"])(Gt,o,a,!1,null,null,null);n["default"]=Kt.exports},953:function(t,n,i){"use strict";i.r(n);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ds-designer ds-seat-container ds-seat-design"},[n("div",{staticClass:"designer-head"},[n("top-tools",t._b({on:{"save-layout":t.saveLayout}},"top-tools",t.postData,!1,!0))],1),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"seat-designer-center"},[n("left-tools"),n("print-canvas",{scopedSlots:t._u([{key:"seat",fn:function(){return[n("seat-item",t._b({},"seat-item",t.postData,!1,!0))]},proxy:!0}])}),n("right-tools")],1)])])},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer_tools"},[t._l(t.layout.buttons,(function(t,e){return n("DsfButton",{key:e,attrs:{icon:t.icon,text:t.text,"btn-style":"icon-text"},on:{click:function(e){return t.handler(e,t)}}})})),n("div",{staticClass:"switch-warp"},[n("el-switch",{attrs:{value:t.showBorderLine},on:{change:t.changeShowBorder}}),n("span",{class:{active:t.showBorderLine}},[t._v("边线框")])],1),n("width-input",{attrs:{"canvas-set":t.canvasSet,"has-bg":t.hasBg}})],2)},r=[],l=i(3),c=i.n(l),u=i(596),f=i.n(u),h=i(391),d=i(390),p=i(389),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-box"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.canvasSet,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"画布宽"}},[n("el-input-number",{attrs:{controls:!1,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.width,callback:function(e){t.$set(t.canvasSet,"width",e)},expression:"canvasSet.width"}})],1),n("el-form-item",{attrs:{label:"画布高"}},[n("el-input-number",{attrs:{controls:!1,disabled:t.hasBg,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.height,callback:function(e){t.$set(t.canvasSet,"height",e)},expression:"canvasSet.height"}})],1)],1)],1)},g=[],v={name:"WidthInput",props:{canvasSet:{type:Object,required:!0},hasBg:{type:Boolean}},data:function(){return{}},watch:{canvasSet:{handler:function(t){var e=this,n=t.width,i=t.height,o=$(".seat-designer-page").offset().left,a=$(".seat-designer-page").offset().top,s=$(window).height(),r=$(window).width();n&&n+o>r?$(".seat-designer-center").css({"overflow-x":"scroll"}):$(".seat-designer-center").css({"overflow-x":"auto"}),i&&i+a>s?$(".seat-designer-center").css("overflow-y","scroll"):$(".seat-designer-center").css("overflow-y","auto"),e.$store.commit("printingDesign/changeCompelPanelSize",t)},deep:!0}}},y=v,b=i(0),S=Object(b["a"])(y,m,g,!1,null,null,null),x=S.exports;function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var C={name:"TopTools",props:{backgroundImage:{type:Object,default:function(){return{url:"",width:0,height:0}}},canvasSet:{type:Object,default:function(){return{width:void 0,height:void 0}}},hasBg:{type:Boolean,default:!1}},components:{widthInput:x},data:function(){return{normalButtons:[{text:"保存",icon:"baocun",handler:this.saveLayout},{text:"底图",icon:"tupiantianjia",handler:this.updateBG},{text:"复位",icon:"shuaxin",handler:this.restoreLayout},{text:"上一层",icon:"zhiding1",handler:this.levelUp},{text:"下一层",icon:"zhidi",handler:this.levelDown},{text:"回退",icon:"shangyibu1",handler:this.backStep},{text:"导出",icon:"yunduanxiazai",handler:this.exportImage}],layout:{buttons:[]}}},computed:O({},Vuex.mapState("printingDesign",["compelPanelSize","showBorderLine"])),watch:{"canvasSet.width":function(t){var e=this;if(this.hasBg)if(t){var n=t/this.backgroundImage.width;this.canvasSet.height=this.backgroundImage.height*n}else this.$nextTick((function(){var t=$(".seat-designer-page").width(),n=t/e.backgroundImage.width;e.canvasSet.height=e.backgroundImage.height*n}))}},created:function(){this.layout.buttons=this.normalButtons},methods:{backStep:function(){},saveLayout:function(){this.$emit("save-layout")},restoreLayout:function(){var t={width:this.compelPanelSize.width,height:this.compelPanelSize.height,scale:1,left:0,top:0};this.$store.commit("printingDesign/changePanelSize",t)},updateBG:function(){var t=this,e=Object(h["b"])("dsf-seat-bg-upload");$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var n=new FormData;n.append("file",e.files[0]);var i=function(n){if($(e).val(""),$(e).remove(),e=null,"error"===n)return t.$emit("update:hasBg",!1),!1;k.call(t,n[0])};h["j"].call(t,n,i)})),$(e).click()},levelUp:function(){d["a"].emit(p["a"].LEVEL_UP)},levelDown:function(){d["a"].emit(p["a"].LEVEL_DOWN)},changeShowBorder:function(t){this.$store.commit("printingDesign/changeShowBorderLine",t)},exportImage:function(){var t=dsf.layer.loading();$(".seat-designer-page .seat-box.border-dash").addClass("border-none");var e=document.getElementById("panel_outer");f()(e).then((function(e){var n=e.toDataURL("image/png"),i=document.createElement("a");i.style.display="none",i.download="证书套打.png",i.href=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),$(".seat-designer-page .seat-box.border-dash").removeClass("border-none"),dsf.layer.closeLoading(t)}))}}};function k(t){var e=this,n=new Image;n.src=dsf.url.getWebPath(t.relativePath),n.onload=function(){e.$emit("update:hasBg",!0),e.$emit("update:backgroundImage",{width:n.naturalWidth,height:n.naturalHeight,relativePath:t.relativePath,absolutePath:t.absolutePath})},n.onerror=function(){dsf.layer.message("图片加载失败",!1),e.$emit("update:hasBg",!1)}}var P=C,I=Object(b["a"])(P,s,r,!1,null,null,null),L=I.exports,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer-left"},[n("div",{staticClass:"designer-left-tools"},t._l(t.leftMenu.group,(function(e,i){return n("el-collapse",{key:i,model:{value:t.leftMenu.activeName,callback:function(e){t.$set(t.leftMenu,"activeName",e)},expression:"leftMenu.activeName"}},[n("el-collapse-item",{attrs:{title:e.title,name:e.title}},[n("div",{staticClass:"ds-tools-group-content",staticStyle:{padding:"10px"}},t._l(e.items,(function(e,i){return n("div",{key:i,staticClass:"ds-tool-item",attrs:{name:e.name,"data-type":e.type}},[t._v(" "+t._s(e.name)+" ")])})),0)])],1)})),1)])},z=[];function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var A={name:"LeftTools",data:function(){return{leftMenu:{activeName:["对象","辅助对象","自定义对象"],group:[{title:"对象",items:[{name:"文字",type:"text"},{name:"图片",type:"image"}]}]},originWidth:150,originHeight:150}},computed:D({},Vuex.mapState("printingDesign",{panelSize:"panelSize",compelPanelSize:"compelPanelSize"})),mounted:function(){var t=this;$(".ds-tool-item").draggable({addClasses:!1,helper:function(){var t=$(this).text();return $('<div class="drag-item">'.concat(t,"</div>"))},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(e,n){var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:e.pageX,y:e.pageY}),o=t.compelPanelSize.width||$(".seat-designer-page").width(),a=t.compelPanelSize.height||$(".seat-designer-page").height();if(i.x>=0&&i.x<=o&&i.y>=0&&i.y<=a){var s,r=$(e.target).data("type"),l=dsf.math.convertLocalCoordinate("#panel_outer",{x:e.pageX,y:e.pageY},t.panelSize.scale),c={id:dsf.uuid(),type:r,left:l.x,top:l.y,width:t.originWidth,height:t.originHeight,angle:0,isFrozenSty:!1,zIndex:1};"image"===r&&(s={bgImg:""},Object.assign(c,s)),"text"===r&&(s={text:"",fontFamily:"Microsoft YaHei",fontSize:20,letterSpacing:2,lineHeight:15,color:"#000",textAlign:"center",bold:!1,italic:!1,underline:!1,fontStyFrozen:!1},Object.assign(c,s)),t.$store.commit("printingDesign/addSeat2Panel",c)}}})}},N=A,T=Object(b["a"])(N,j,z,!1,null,null,null),M=T.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.showTool?n("div",{staticClass:"right-tool-box"},[n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(0)}}},[n("el-popover",{attrs:{value:t.groupVisible[0],placement:"left-start",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 度量 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(0)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"title"},[n("label",{staticClass:"label-box"},[t._v("当前对象：")]),n("span",{domProps:{textContent:t._s(t.getInfoTypeName())}})]),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("X")]),n("el-input-number",{attrs:{value:t.info.left,size:"mini",controls:!1},on:{change:function(e){return t.info.left=e}}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("Y")]),n("el-input-number",{attrs:{value:t.info.top,size:"mini",controls:!1},on:{change:function(e){return t.info.top=e}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("宽")]),n("el-input-number",{attrs:{value:t.info.width,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateWidth(e)}}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("高")]),n("el-input-number",{attrs:{value:t.info.height,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateHeight(e)}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("角度")]),n("el-input-number",{attrs:{value:t.info.angle,size:"mini",min:0,max:360,controls:!1},on:{change:function(e){return t.info.angle=e}}})],1)]),n("i",{staticClass:"iconfont icon-resize-",attrs:{slot:"reference"},slot:"reference"})])],1),"text"===t.info.type?n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(1)}}},[n("el-popover",{attrs:{value:t.groupVisible[1],placement:"left",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 属性 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(1)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("字体")]),n("el-select",{attrs:{value:t.info.fontFamily},on:{change:function(e){t.info.fontStyFrozen=!1,t.info.fontFamily=e}}},t._l(t.fontFamilyList,(function(t){return n("el-option",{key:t.val,attrs:{value:t.val,label:t.text}})})),1)],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("颜色")]),n("el-color-picker",{attrs:{value:t.info.color},on:{"active-change":function(e){t.info.fontStyFrozen=!1,t.info.color=e}}})],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("大小")]),n("div",{staticClass:"slider-warp"},[n("el-slider",{attrs:{value:t.info.fontSize,"show-input":"","show-input-controls":!1},on:{input:function(e){t.info.fontStyFrozen=!1,t.info.fontSize=e}}})],1)]),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("行间距")]),n("div",{staticClass:"slider-warp"},[n("el-slider",{attrs:{value:t.info.lineHeight,"show-input":"","show-input-controls":!1,min:10,max:50},on:{input:function(e){t.info.fontStyFrozen=!1,t.info.lineHeight=e}}})],1)]),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("字间距")]),n("div",{staticClass:"slider-warp"},[n("el-slider",{attrs:{value:t.info.letterSpacing,"show-input":"","show-input-controls":!1,max:50},on:{input:function(e){t.info.fontStyFrozen=!1,t.info.letterSpacing=e}}})],1)]),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("效果")]),n("el-button-group",[n("el-button",{class:{active:t.info.italic},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.italic=!t.info.italic}}},[n("dsf-icon",{attrs:{name:"zitixieti"}})],1),n("el-button",{class:{active:t.info.bold},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.bold=!t.info.bold}}},[n("dsf-icon",{attrs:{name:"zitijiacu"}})],1),n("el-button",{class:{active:t.info.underline},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.underline=!t.info.underline}}},[n("dsf-icon",{attrs:{name:"zitixiahuaxian"}})],1)],1)],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("对齐")]),n("el-button-group",[n("el-button",{class:{active:"left"===t.info.textAlign},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.textAlign="left"}}},[n("dsf-icon",{attrs:{name:"zuoduiqi"}})],1),n("el-button",{class:{active:"center"===t.info.textAlign},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.textAlign="center"}}},[n("dsf-icon",{attrs:{name:"juzhongduiqi"}})],1),n("el-button",{class:{active:"right"===t.info.textAlign},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.textAlign="right"}}},[n("dsf-icon",{attrs:{name:"youduiqi"}})],1)],1)],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("内容")]),n("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.info.text,callback:function(e){t.$set(t.info,"text",e)},expression:"info.text"}})],1)]),n("i",{staticClass:"iconfont icon-xingzhuang-wenzi",attrs:{slot:"reference"},slot:"reference"})])],1):t._e(),"image"===t.info.type?n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(2)}}},[n("el-popover",{attrs:{value:t.groupVisible[2],placement:"left-start",width:"365",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 上传 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(2)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"single-upload-box",on:{click:t.uploadSingle}},[t.info.bgImg?n("img",{attrs:{src:t.getImagePath(t.info.bgImg),alt:""}}):t._e()])]),n("i",{staticClass:"iconfont icon-tupiantianjia",attrs:{slot:"reference"},slot:"reference"})])],1):t._e()]):t._e()},R=[];function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function B(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?F(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Y={name:"RightTools",props:{},data:function(){return{showTool:!1,info:{},groupVisible:[!1,!1,!1],visiblePointer:null,oldVisibleStatus:!1,fontFamilyList:[{val:"SimSun",text:"宋体"},{val:"FangSong",text:"仿宋"},{val:"KaiTi",text:"楷书"},{val:"SimHei",text:"黑体"},{val:"Microsoft YaHei",text:"微软雅黑"},{val:"YouYuan",text:"幼圆"},{val:"LiSu",text:"隶书"}]}},computed:B({},Vuex.mapState("printingDesign",{activeId:"activeId"})),watch:{activeId:function(t){var e=this;if(t)d["a"].emit(p["a"].GET_ACTIVE_SEAT,(function(t){e.info=t})),this.showTool=!0,this.$nextTick((function(){e.$set(e.groupVisible,e.visiblePointer,e.oldVisibleStatus)}));else{this.showTool=!1;var n=new Array(3);this.groupVisible=_.fill(n,!1)}},info:{handler:function(t){this.$store.commit("printingDesign/changeSeatInfo",t)},deep:!1}},methods:{uploadSingle:function(){var t=this,e=Object(h["b"])();$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var n=new FormData;n.append("file",e.files[0]);var i=function(n){if($(e).val(""),$(e).remove(),e=null,"error"===n)return!1;t.info.bgImg=n[0].relativePath};h["j"].call(t,n,i)})),$(e).click()},closeGroup:function(t){this.visiblePointer=t,this.$set(this.groupVisible,t,!1),this.oldVisibleStatus=!1},showGroup:function(t){this.visiblePointer=t;var e=new Array(3);this.groupVisible=_.fill(e,!1),this.$set(this.groupVisible,t,!0),this.oldVisibleStatus=!0},getImagePath:function(t){return t?dsf.url.getWebPath(t):null},getInfoTypeName:function(){switch(this.info.type){case"text":return"文本";case"image":return"图片"}},updateWidth:function(t){this.info.width=t},updateHeight:function(t){this.info.height=t}}},G=Y,K=Object(b["a"])(G,V,R,!1,null,null,null),q=K.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-designer-page",style:t.canvasCss,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.preRegion.apply(null,arguments)}}},[n("region",{attrs:{visible:t.regionVisible,region:t.regionRect}}),n("div",{style:t.panelSty,attrs:{id:"panel_outer"}},[t._t("seat"),n("div",{staticClass:"ds_seat_panel_bg",attrs:{id:"panel_bg"}})],2),t._t("seatPop")],2)},W=[],X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"region",style:t.regionSty}):t._e()},H=[],J={name:"Region",props:{visible:{type:Boolean,default:!1},region:{type:Object,default:function(){return{}}}},data:function(){return{test:!1}},computed:{regionSty:function(){return{left:this.region.left+"px",top:this.region.top+"px",width:this.region.width+"px",height:this.region.height+"px"}}},methods:{}},Q=J,Z=Object(b["a"])(Q,X,H,!1,null,null,null),tt=Z.exports;function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var it={name:"Canvas",components:{region:tt},data:function(){return{regionVisible:!1,regionRect:{}}},computed:nt(nt({},Vuex.mapState("printingDesign",{compelPanelSize:"compelPanelSize",panelSize:"panelSize",canvasCss:function(t){var e=t.compelPanelSize,n=e.width,i=e.height,o=n?"".concat(n,"px"):"100%",a=i?"".concat(i,"px"):"100%";return{width:o,height:a}},panelParentSize:function(t){var e=t.compelPanelSize,n=e.width,i=e.height;return n=n||$(".seat-designer-page").width(),i=i||$(".seat-designer-page").height(),{width:n,height:i}}})),{},{panelSty:function(){return{width:this.panelSize.width?this.panelSize.width+"px":"100%",height:this.panelSize.height?this.panelSize.height+"px":"100%",left:this.panelSize.left+"px",top:this.panelSize.top+"px"}}}),watch:{compelPanelSize:{handler:function(t){var e=t.width,n=t.height,i={width:e,height:n,scale:1,left:0,top:0};this.$store.commit("printingDesign/changePanelSize",i)},deep:!0}},mounted:function(){var t=this;$(".seat-designer-page")[0].addEventListener("mousewheel",t.handleScroll)},methods:{handleScroll:function(t){if(t.ctrlKey||e.metaKey){var n=this,i=t.wheelDelta<0?"down":"up",o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY}),a=n.panelParentSize,s=a.width,r=a.height,l=s*n.panelSize.scale,c=r*n.panelSize.scale,u=o.x/l,f=o.y/c,h=n.panelSize.scale;if("up"===i?h+=.1:"down"===i&&(h-=.1),h>=.1){var d=$("#panel_outer"),p=s*h,m=r*h,g=d.position().left+o.x-p*u,v=d.position().top+o.y-m*f,y={scale:Math.round(10*h)/10,width:Math.floor(p),height:Math.floor(m),left:Math.floor(g),top:Math.floor(v)};n.$store.commit("printingDesign/changePanelSize",y)}t.preventDefault(),t.stopPropagation()}},preRegion:function(t){var e=this;e.$store.commit("printingDesign/changeActiveId","");var n=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});function i(t){e.regionVisible=!0;var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});e.$set(e.regionRect,"left",n.x>i.x?i.x:n.x),e.$set(e.regionRect,"top",n.y>i.y?i.y:n.y),e.$set(e.regionRect,"width",Math.abs(i.x-n.x)),e.$set(e.regionRect,"height",Math.abs(i.y-n.y))}function o(){$(document).off("mousemove.region"),e.$store.commit("printingDesign/changeRegionPosition",e.regionRect),e.regionVisible=!1,e.regionRect={}}$(document).off("mousemove.region"),$(document).on("mousemove.region",(function(t){i(t)})),$(document).one("mouseup.region",(function(){o()}))}}},ot=it,at=Object(b["a"])(ot,U,W,!1,null,null,null),st=at.exports,rt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-item-container normal"},[t.verLine.visible?n("div",{staticClass:"vertical-line",style:t.verLineSty}):t._e(),t.horLine.visible?n("div",{staticClass:"horizontal-line",style:t.horLineSty}):t._e(),t.selectPosition.visible?n("div",{staticClass:"selected-box",style:t.selectSty,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectMove.apply(null,arguments)}}},[n("div",{staticClass:"select"},[n("div",{staticClass:"anchor circle",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectRotate.apply(null,arguments)}}}),n("div",{staticClass:"anchor line"}),n("div",{staticClass:"anchor lt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lt")}}}),n("div",{staticClass:"anchor t",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"t")}}}),n("div",{staticClass:"anchor rt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rt")}}}),n("div",{staticClass:"anchor l",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"l")}}}),n("div",{staticClass:"anchor r",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"r")}}}),n("div",{staticClass:"anchor lb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lb")}}}),n("div",{staticClass:"anchor b",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"b")}}}),n("div",{staticClass:"anchor rb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rb")}}}),n("div",{staticClass:"anchor info"},[t._v(" 宽:"+t._s(t.selectPosition.width)+";高:"+t._s(t.selectPosition.height)+";角度:"+t._s(t.selectPosition.angle)+" ")])])]):t._e(),t._l(t.items,(function(e){return n("div",{key:e.id,staticClass:"seat-box",class:{active:t.activeId===e.id,"border-dash":!t.showBorderLine&&t.activeId!==e.id},style:t.getItemSty(e),on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preMove(n,e)}}},[n("div",{staticClass:"seat",on:{dblclick:function(n){return n.stopPropagation(),t.openEdit(n,e)}}},[n("div",{staticClass:"anchor circle",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preRotate(n,e)}}}),n("div",{staticClass:"anchor line"}),n("div",{staticClass:"anchor lt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lt")}}}),n("div",{staticClass:"anchor t",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"t")}}}),n("div",{staticClass:"anchor rt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rt")}}}),"text"===e.type?n("p",{style:t.getFontSty(e)},[t._v(t._s(e.text))]):t._e(),n("div",{staticClass:"anchor l",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"l")}}}),n("div",{staticClass:"anchor r",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"r")}}}),n("div",{staticClass:"anchor lb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lb")}}}),n("div",{staticClass:"anchor b",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"b")}}}),n("div",{staticClass:"anchor rb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rb")}}}),n("div",{staticClass:"anchor info"},[t._v("宽:"+t._s(e.width)+";高:"+t._s(e.height)+";角度:"+t._s(e.angle))])])])}))],2)},lt=[];function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ft={name:"SeatItem",props:{items:{type:Array,default:function(){return[]}}},data:function(){return{selectedItems:[],rectMinSize:[40,40],selectPosition:{top:0,left:0,width:0,height:0,visible:!1},verLine:{left:0,visible:!1},horLine:{top:0,visible:!1}}},computed:ut(ut({},Vuex.mapState("printingDesign",{panelSize:"panelSize",newSeatItem:"newSeatItem",activeId:"activeId",regionPosition:"regionPosition",seatInfo:"seatInfo",showBorderLine:"showBorderLine"})),{},{selectSty:function(){var t=this.panelSize.scale;return{width:this.selectPosition.width*t+"px",height:this.selectPosition.height*t+"px",left:this.selectPosition.left*t+"px",top:this.selectPosition.top*t+"px",transform:"rotate(".concat(this.selectPosition.angle,"deg)")}},verLineSty:function(){return{left:"".concat(this.verLine.left*this.panelSize.scale)+"px"}},horLineSty:function(){return{top:"".concat(this.horLine.top*this.panelSize.scale)+"px"}}}),watch:{newSeatItem:function(t){h["c"].call(this);var e=_.assign({},t);this.items.push(e)},regionPosition:function(t){var e=this;if(_.isEmpty(t)||0===t.width||0===t.height)return h["c"].call(e),e.selectedItems=[],void kt.call(e);e.selectedItems=_.filter(e.items,(function(t){return dt.call(e,t)})),h["c"].call(e),0!==e.selectedItems.length&&(1===e.selectedItems.length?e.$store.commit("printingDesign/changeActiveId",e.selectedItems[0].id):e.selectedItems.length>1&&(e.selectPosition=Ot(e.selectedItems)))},seatInfo:{handler:function(t,e){var n=_.findIndex(this.items,(function(e){return e.id===t.id}));this.$set(this.items,n,t)},deep:!1},selectedItems:function(t){t&&t.length>0?this.$store.commit("printingDesign/changeHaveSelectedItems",!0):this.$store.commit("printingDesign/changeHaveSelectedItems",!1)}},beforeDestroy:function(){$(document).off("mouseup.scaleSeatItem"),$(document).off("mousemove.scaleSeatItem")},mounted:function(){var t=this;d["a"].on(p["a"].KEY_CTRL_D,(function(){kt.call(t),t.selectedItems=[],t.$store.commit("printingDesign/changeActiveId","")})),d["a"].on(p["a"].KEY_DELETE,(function(){t.deleteActiveSeatItem()})),d["a"].on(p["a"].GET_ACTIVE_SEAT,(function(e){var n=t.items.find((function(e){return e.id===t.activeId}));e&&e(n)})),d["a"].on(p["a"].LEVEL_UP,(function(){_.isArray(t.selectedItems)&&0!==t.selectedItems.length&&(h["c"].call(t),t.selectedItems.forEach((function(t){return t.zIndex+=1})))})),d["a"].on(p["a"].LEVEL_DOWN,(function(){_.isArray(t.selectedItems)&&0!==t.selectedItems.length&&(h["c"].call(t),t.selectedItems.forEach((function(t){return t.zIndex=t.zIndex>1?t.zIndex-1:1})))}))},methods:{getItemSty:function(t){if(t.isFrozenSty)return t.style;var e=this.panelSize.scale,n={width:t.width*e+"px",height:t.height*e+"px",left:t.left*e+"px",top:t.top*e+"px",zIndex:t.zIndex,transform:"rotate(".concat(t.angle,"deg)")};return"text"!==t.type&&(n.background=$t(t)),t.style=n,n},getFontSty:function(t){var e=this.panelSize.scale;if(t.fontStyFrozen)return t.fontSty;var n={color:t.color,whiteSpace:"pre-wrap",fontSize:t.fontSize*e+"px",letterSpacing:t.letterSpacing*e+"px",lineHeight:t.lineHeight/10*t.fontSize*e+"px",textAlign:t.textAlign,fontStyle:t.italic?"italic":"normal",fontWeight:t.bold?"bold":"normal",fontFamily:t.fontFamily,textDecoration:t.underline?"underline":"none"};return t.fontSty=n,t.fontStyFrozen=!0,n},clearSelectedItems:function(){this.selectedItems=[],kt.call(this),this.$store.commit("printingDesign/changeActiveId","")},preScale:function(t,e,n){t.stopPropagation(),t.preventDefault();var i=this;h["c"].call(i,!1);var o=_.assign({},e),a=_.assign({},e),s=mt(o,n);function r(t){if(n&&s){var r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale),l=gt(s,o,a,r,n,i.rectMinSize);_.assign(e,l)}}function l(){h["c"].call(i),$(document).off("mousemove.scaleSeatItem")}$(document).off("mousemove.scaleSeatItem"),$(document).on("mousemove.scaleSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),r(t)}),5)),$(document).one("mouseup.scaleSeatItem",(function(){l()}))},preMove:function(t,e){t.preventDefault(),t.stopPropagation();var n=this;ht.call(n,e),h["c"].call(n),n.verLine.visible=!1,n.horLine.visible=!1;var i=Pt.call(n),o=Lt(i),a=e.left,s=e.top,r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);function l(t){var i=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale),l={x:i.x-r.x,y:i.y-r.y};e.left=parseInt(a+l.x),e.top=parseInt(s+l.y),n.verLine.visible=!1,n.horLine.visible=!1;var c=pt(e,["lt"]),u=Lt(c),f=It(u,o,e);f&&(n.horLine.top=f.top,n.horLine.visible=_.isNumber(f.top),n.verLine.left=f.left,n.verLine.visible=_.isNumber(f.left))}function c(){$(document).off("mousemove.moveSeatItem"),h["c"].call(n),n.verLine.visible=!1,n.horLine.visible=!1}$(document).off("mousemove.moveSeatItem"),$(document).on("mousemove.moveSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),l(t)}),5)),$(document).one("mouseup.moveSeatItem",(function(){c()}))},preRotate:function(t,e){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var n=this;h["c"].call(n);var i=St(e);function o(t){var o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);e.angle=vt(i,o)}function a(){$(document).off("mousemove.rotateSeatItem"),h["c"].call(n),$(".ds-seat-design").removeClass("is-rotating")}$(document).off("mousemove.rotateSeatItem"),$(document).on("mousemove.rotateSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),o(t)}),5)),$(document).one("mouseup.rotateSeatItem",(function(){a()}))},selectRotate:function(t){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var e=this;h["c"].call(e);var n=_.assign({},e.selectPosition),i=St(n),o={};function a(t){var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),s=vt(i,a),r=s-n.angle;e.selectPosition.angle=s,e.selectedItems.forEach((function(t){var e=o[t.id],n=dsf.math.getRotatedPiont(e.left,e.top,i.x,i.y,s),a=n.x+e.width/2,l=n.y+e.height/2,c=dsf.math.getRotatedPiont(a,l,n.x,n.y,s);n=dsf.math.getRotatedPiont(n.x,n.y,c.x,c.y,-s),t.top=parseInt(n.y),t.left=parseInt(n.x),t.angle=(e.angle+r)%360,e.angle<0&&(t.angle=360+e.angle)}))}function s(){$(".ds-seat-design").removeClass("is-rotating"),e.selectPosition=Ot(e.selectedItems),$(document).off("mousemove.rotateSelect"),h["c"].call(e)}e.items.forEach((function(t){o[t.id]=_.assign({},t)})),$(document).off("mousemove.rotateSelect"),$(document).on("mousemove.rotateSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),a(t)}),5)),$(document).one("mouseup.rotateSelect",(function(){s()}))},selectScale:function(t,e){t.stopPropagation(),t.preventDefault();var n=this;h["c"].call(n);var i=_.assign({},n.selectPosition),o=_.assign({},n.selectPosition),a={};n.items.forEach((function(t){a[t.id]=_.assign({},t)}));var s=mt(i,e),r=yt(n.selectedItems,n.selectPosition);function l(t){if(e&&s){var l=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);n.selectPosition=gt(s,i,o,l,e,n.rectMinSize),n.selectedItems.forEach((function(t){var o=bt(a[t.id],i,n.selectPosition,e,r);_.assign(t,o)}))}}function c(){$(document).off("mousemove.scaleSelect"),h["c"].call(n),n.selectPosition=Ot(n.selectedItems)}$(document).off("mousemove.scaleSelect"),$(document).on("mousemove.scaleSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),l(t)}),5)),$(document).one("mouseup.scaleSelect",(function(){c()}))},selectMove:function(t){t.preventDefault(),t.stopPropagation();var e=this;h["c"].call(e);var n=e.selectPosition.left,i=e.selectPosition.top,o={};e.items.forEach((function(t){o[t.id]=_.assign({},t)}));var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale);function s(t){var s=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),r={x:s.x-a.x,y:s.y-a.y},l=n+r.x,c=i+r.y;e.selectPosition.left=parseInt(l),e.selectPosition.top=parseInt(c),e.selectedItems.forEach((function(t){t.left=parseInt(o[t.id].left+r.x),t.top=parseInt(o[t.id].top+r.y)}))}function r(){$(document).off("mousemove.moveSelect"),h["c"].call(e)}$(document).off("mousemove.moveSelect"),$(document).on("mousemove.moveSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),s(t)}),5)),$(document).one("mouseup.moveSelect",(function(){r()}))},deleteActiveSeatItem:function(){if(0!==this.selectedItems.length){var t=_.differenceWith(this.items,this.selectedItems,(function(t,e){return t.id===e.id}));this.$emit("update:items",t),this.clearSelectedItems()}},openEdit:function(t,e){if("image"!==e.type&&!$(t.target).hasClass("anchor")){var n=document.createElement("textarea"),i=function(t){e.text=t,$(n).remove(),n=null};$(t.target).append(n),$(n).val(e.text),$(n).on("blur",(function(){i($(this).val())})),$(n).bind("keypress",(function(t){13===t.keyCode&&i($(this).val())})),$(n).focus()}}}};function ht(t){this.activeId!==t.id&&(kt.call(this),this.selectedItems=[t],this.$store.commit("printingDesign/changeActiveId",t.id))}function dt(t){var e=pt(t),n=xt(e),i=this.panelSize,o=(i.left,i.top,i.scale),a=this.regionPosition,s=a.left,r=a.top,l=a.width,c=a.height,u=$(".seat-designer-page").offset(),f={x:s+u.left,y:r+u.top},h={x:s+u.left+l,y:r+u.top+c};f=dsf.math.convertLocalCoordinate("#panel_outer",f,o),h=dsf.math.convertLocalCoordinate("#panel_outer",h,o);var d=n.min_x>=f.x,p=n.max_x<=h.x,m=n.min_y>=f.y,g=n.max_y<=h.y;return d&&p&&m&&g}function pt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["lt","rt","rb","lb"],n=t.angle,i=t.left,o=t.top,a=t.left+t.width,s=t.top+t.height,r={lt:0,lb:0,rt:0,rb:0},l=.5*(a-i)+i,c=.5*(s-o)+o;return e.includes("lt")&&(r.lt=dsf.math.getRotatedPiont(i,o,l,c,n)),e.includes("rt")&&(r.rt=dsf.math.getRotatedPiont(a,o,l,c,n)),e.includes("rb")&&(r.rb=dsf.math.getRotatedPiont(a,s,l,c,n)),e.includes("lb")&&(r.lb=dsf.math.getRotatedPiont(i,s,l,c,n)),r}function mt(t,e){var n={};e.length>1?(e.indexOf("l")>=0?n.x=t.left+t.width:n.x=t.left,e.indexOf("t")>=0?n.y=t.top+t.height:n.y=t.top):"r"===e||"b"===e?(n.x=t.left,n.y=t.top):"l"!==e&&"t"!==e||(n.x=t.left+t.width,n.y=t.top+t.height);var i={x:t.left+t.width/2,y:t.top+t.height/2};return n=dsf.math.getRotatedPiont(n.x,n.y,i.x,i.y,t.angle),n}function gt(t,e,n,i,o,a){var s,r,l=dsf.math.getDistance(t,i),c=dsf.math.getRadina(t,i,-dsf.math.a2r(e.angle)),u={x:Math.cos(c)*l+e.left,y:Math.sin(c)*l+e.top};if(o.indexOf("r")>=0?s=u.x-e.left:o.indexOf("l")>=0&&(s=e.left-u.x),o.indexOf("b")>=0?r=u.y-e.top:o.indexOf("t")>=0&&(r=e.top-u.y),o.length>1){var f=s/e.width;n.width=e.width*f,n.height=e.height*f}else dsf.isDef(s)?n.width=s:n.width=e.width,dsf.isDef(r)?n.height=r:n.height=e.height;n.width<a[0]&&(n.width=a[0]),n.height<a[1]&&(n.height=a[1]);var h={};o.length>1?(o.indexOf("r")>=0?h.x=t.x+n.width:o.indexOf("l")>=0?h.x=t.x-n.width:h.x=t.x,o.indexOf("b")>=0?h.y=t.y+n.height:o.indexOf("t")>=0?h.y=t.y-n.height:h.y=t.y):"r"===o||"b"===o?(h.x=t.x+n.width,h.y=t.y+n.height):"l"!==o&&"t"!==o||(h.x=t.x-n.width,h.y=t.y-n.height);var d=dsf.math.getRotatedPiont(h.x,h.y,t.x,t.y,e.angle),p={x:.5*(t.x+d.x),y:.5*(t.y+d.y)},m=dsf.math.getRotatedPiont(t.x,t.y,p.x,p.y,-e.angle);return o.length>1?(o.indexOf("r")>=0?n.left=m.x:o.indexOf("l")>=0?n.left=m.x-n.width:n.left=m.x-n.width/2,o.indexOf("b")>=0?n.top=m.y:o.indexOf("t")>=0?n.top=m.y-n.height:n.top=m.y-n.height/2):"r"===o||"b"===o?(n.left=m.x,n.top=m.y):"l"!==o&&"t"!==o||(n.left=m.x-n.width,n.top=m.y-n.height),wt(n),n}function vt(t,e){var n=dsf.math.getRadina(t,e),i=90+dsf.math.r2a(n);return i=Math.ceil(i)%360,i}function yt(t,e){var n={};return _.forEach(t,(function(t){var i=_.assign({},t);n[t.id]={left:(i.left-e.left)/e.width,top:(i.top-e.top)/e.height,width:i.width/e.width,height:i.height/e.height}})),n}function bt(t,e,n,i,o){var a=_.assign({},t),s=o[a.id];if(a.left=n.left+n.width*s.left,a.top=n.top+n.height*s.top,2===i.length){var r=n.width/e.width,l=n.height/e.height;r=.5*(r+l),a.width=r*t.width,a.height=r*t.height}else 1===i.length&&(a.width=n.width*s.width,a.height=n.height*s.height);return _t(a),a}function St(t){return{x:t.left+t.width/2,y:t.top+t.height/2}}function xt(t){var e,n,i,o;return _.forIn(t,(function(t){e=e||t.x,n=n||t.x,i=i||t.y,o=o||t.y,e=e<=t.x?e:t.x,n=n>=t.x?n:t.x,i=i<=t.y?i:t.y,o=o>=t.y?o:t.y})),{min_x:e,min_y:i,max_x:n,max_y:o}}function wt(t){t.top=parseInt(t.top),t.left=parseInt(t.left),t.width=parseInt(t.width),t.height=parseInt(t.height)}function _t(t){t.top=Math.round(t.top),t.left=Math.round(t.left),t.width=Math.round(t.width),t.height=Math.round(t.height)}function Ot(t){var e,n,i,o,a;return _.forEach(t,(function(t){a=pt(t),_.forIn(a,(function(t){e=e||t.x,n=n||t.x,i=i||t.y,o=o||t.y,e=e<=t.x?e:t.x,n=n>=t.x?n:t.x,i=i<=t.y?i:t.y,o=o>=t.y?o:t.y}))})),{left:Ct(e),top:Ct(i),width:Ct(n-e),height:Ct(o-i),angle:0,visible:!0}}function Ct(t){return t<0?Math.floor(t):Math.ceil(t)}function kt(){this.selectPosition={top:0,left:0,width:0,height:0,angle:0,visible:!1}}function Pt(){var t=this,e=_.filter(this.items,(function(e){return e.id!==t.activeId}));return e.map((function(t){return pt(t,["lt"])}))}function It(t,e,n){for(var i={},o=0,a=0;a<e.length;a++)if(t.left>=e[a].left-3&&t.left<=e[a].left+3&&(i.left=e[a].left,o+=1,0===n.angle&&(n.left=i.left)),t.top>=e[a].top-3&&t.top<=e[a].top+3&&(i.top=e[a].top,o+=1,0===n.angle&&(n.top=i.top)),2===o)break;return i.left||i.top?i:null}function Lt(t){var e=[],n={};return _.isArray(t)?(_.forEach(t,(function(t){n={left:Math.round(t.lt.x),top:Math.round(t.lt.y)},e.push(n)})),_.uniqWith(e,_.isEqual)):_.isObject(t)?{left:Math.round(t.lt.x),top:Math.round(t.lt.y)}:void 0}function $t(t){var e=dsf.url.getAbsolutePath(t.bgImg),n=i(829),o=t.bgImg?e:n;return"center / contain no-repeat url(".concat(o,")")}var jt=ft,zt=Object(b["a"])(jt,rt,lt,!1,null,null,null),Et=zt.exports,Dt=i(444),At={name:"DsfSeatDesign",components:{topTools:L,leftTools:M,rightTools:q,PrintCanvas:st,seatItem:Et},data:function(){return{keyStack:[],postData:{_id:"",backgroundImage:{},canvasSet:{width:void 0,height:void 0},hasBg:!1,items:[]}}},computed:{},watch:{"postData.backgroundImage":function(){h["a"].call(this)}},created:function(){var t=this,e=dsf.url.getWebPath("$/seat_config/seat/printingDesign.js");this.$http.importFiles(e).then((function(e){t.layoutConfig=new Dt["a"](printingDesignConfig,t.$route.query.opt),t.bindShortKey(),t.getSeatInfo()}))},beforeDestroy:function(){$(document).off("keydown"),$(document).off("keyup")},methods:{saveLayout:function(){this.saveByPub()},bindShortKey:function(){var t=["ctrl","ctrl-d","ctrl-s"];Object(h["g"])(this.keyStack,t)},saveByDev:function(){var t=Nt.call(this),e=this.$route.query.id||dsf.uuid();t._id=e,localStorage.setItem("printing_"+e,JSON.stringify(t));var n=this.$route.query,i=Object.assign({},n,{id:e});this.$router.replace({path:this.$route.path,query:i})},saveByPub:function(){var t=this,e=Nt.call(this),n={pageName:"edit",namespace:"dsfa.printing.designcontent",data:JSON.stringify(e)},i=dsf.layer.loading();this.$http.post(this.layoutConfig.saveLayoutUrl,n).done((function(e){e.success?(t.postData._id=e.data._id,t.$router.replace({path:t.$route.path,query:{id:e.data._id}}),dsf.layer.message("保存成功")):dsf.layer.message("证书套打保存失败",!1)})).error((function(t){dsf.layer.message("证书套打保存失败",!1)})).always((function(){dsf.layer.closeLoading(i)}))},getSeatInfo:function(){this.getInfoPub()},getInfoDev:function(){var t=this.$route.query.id;if(t){var e=JSON.parse(localStorage.getItem("printing_"+t));e&&(_.isEmpty(e.canvasSet)&&(e.canvasSet={width:void 0,height:void 0}),this.postData=e)}},getInfoPub:function(){this.$route.query.id}}};function Nt(){var t=_.cloneDeep(this.postData);return t.items.forEach((function(t){t.isFrozenSty=!1})),t}var Tt=At,Mt=Object(b["a"])(Tt,o,a,!1,null,null,null);n["default"]=Mt.exports},954:function(t,n,i){"use strict";i.r(n);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ds-designer ds-seat-container ds-seat-view"},[n("div",{staticClass:"designer-head"},[n("top-tools",t._b({attrs:{"relative-list":t.relativeList,"seat-obj":t.seatObj,"relative-obj":t.relativeObj},on:{"update:relativeList":function(e){t.relativeList=e},"update:relative-list":function(e){t.relativeList=e},save:t.save,clear:t.clear}},"top-tools",t.postData,!1,!0))],1),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"seat-designer-center"},[n("left-tree",{attrs:{"relative-list":t.relativeList,"person-obj":t.personObj,"seat-obj":t.seatObj,"relative-obj":t.relativeObj},on:{"update:relativeList":function(e){t.relativeList=e},"update:relative-list":function(e){t.relativeList=e},"update:personObj":function(e){t.personObj=e},"update:person-obj":function(e){t.personObj=e}}}),n("seat-canvas",{scopedSlots:t._u([{key:"seat",fn:function(){return[n("seat-item",t._b({attrs:{"relative-list":t.relativeList,"chosen-items":t.chosenItems,"key-stack":t.keyStack,"seat-obj":t.seatObj,"person-obj":t.personObj,"relative-obj":t.relativeObj},on:{"update:relativeList":function(e){t.relativeList=e},"update:relative-list":function(e){t.relativeList=e},"update:chosenItems":function(e){t.chosenItems=e},"update:chosen-items":function(e){t.chosenItems=e}}},"seat-item",t.postData,!1,!0))]},proxy:!0},{key:"seatPop",fn:function(){return[n("seat-pop",{attrs:{"relative-list":t.relativeList,"chosen-items":t.chosenItems,"seat-obj":t.seatObj,"relative-obj":t.relativeObj},on:{"update:relativeList":function(e){t.relativeList=e},"update:relative-list":function(e){t.relativeList=e},"update:chosenItems":function(e){t.chosenItems=e},"update:chosen-items":function(e){t.chosenItems=e}}})]},proxy:!0}])})],1)])])},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer_tools"},[t._l(t.layout.buttons,(function(t,e){return n("DsfButton",{key:e,attrs:{icon:t.icon,text:t.text,"btn-style":"icon-text"},on:{click:function(e){return t.handler(e,t)}}})})),n("width-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{"canvas-set":t.canvasSet,"has-bg":t.hasBg}})],2)},r=[],l=i(3),c=i.n(l),u=i(596),f=i.n(u),h=i(610),d=i(390),p=i(389),m=i(391);function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y={name:"TopTools",inject:["layoutConfigPointer"],props:{backgroundImage:{type:Object,default:function(){return{url:"",width:0,height:0}}},canvasSet:{type:Object,default:function(){return{width:void 0,height:void 0}}},hasBg:{type:Boolean,default:!1},relativeList:{type:Array,default:function(){return[]}},seatObj:{type:Object,default:function(){return null}},relativeObj:{type:Object,default:function(){return{}}}},components:{widthInput:h["a"]},data:function(){return{normalButtons:[{text:"保存",icon:"baocun",handler:this.save},{text:"自动排座",icon:"zidongpipei",handler:this.autoSeat},{text:"清空排座",icon:"guanbi2",handler:this.clearSeat},{text:"自动补位",icon:"zhiding2",handler:this.emptySeatUtilize},{text:"底图复位",icon:"shuaxin",handler:this.restoreLayout},{text:"导出",icon:"yunduanxiazai",handler:this.exportImage}],layout:{buttons:[]}}},computed:v(v({},Vuex.mapState("seatDesign",["compelPanelSize"])),{},{layoutConfig:function(){return this.layoutConfigPointer()}}),watch:{},created:function(){this.layout.buttons=this.normalButtons},methods:{save:function(){this.$emit("save")},restoreLayout:function(){var t={width:this.compelPanelSize.width,height:this.compelPanelSize.height,scale:1,left:0,top:0};this.$store.commit("seatDesign/changePanelSize",t)},autoSeat:function(){for(var t=!1,e=0;e<this.relativeList.length;e++){var n=this.relativeList[e];if(n.person&&2!==n.currentState.couldSeat){t=!0;break}}t?dsf.layer.confirm({title:"提醒",message:"该操作会清除当前所有已排人员重新排位，是否要继续?"}).then((function(){d["a"].emit(p["a"].AUTO_SEAT)})).catch((function(){})):d["a"].emit(p["a"].AUTO_SEAT)},clearSeat:function(){var t=this;dsf.layer.confirm({title:"提醒",message:"该操作将清除当前所有排座的信息,是否要继续?"}).then((function(){t.$emit("clear")})).catch((function(){}))},emptySeatUtilize:function(){for(var t,e=this,n=0;n<this.relativeList.length;n++){var i=this.relativeList[n];i.person&&(t=i.seatNum<t||!t?i.seatNum:t)}var o=[],a=[];for(var s in this.relativeObj){var r=this.relativeObj[s];s<t||2===r.currentState.couldSeat||(o.push(r),r.person&&a.push(r))}var l=this.relativeList.filter((function(t){var e=o.findIndex((function(e){return e.id===t.id}));return-1===e}));this.$emit("update:relativeList",l),this.$nextTick((function(){var n=0,i=0;while(i<a.length){var o,s=e.seatObj[t+n],r=a[i].person;if(2!==(null===(o=e.relativeObj[t+n])||void 0===o||null===(o=o.currentState)||void 0===o?void 0:o.couldSeat)){if(_.isFunction(e.layoutConfig.isSeatAble)){var l=e.layoutConfig.isSeatAble(s,r);if(!l){n++;continue}}e.relativeList.push(Object(m["f"])(s,r)),n++,i++}else n++}}))},exportImage:function(){var t=dsf.layer.loading(),e=document.getElementById("panel_outer");f()(e).then((function(e){var n=e.toDataURL("image/png"),i=document.createElement("a");i.style.display="none",i.download="排座.png",i.href=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),dsf.layer.closeLoading(t)}))}}},b=y,S=i(0),x=Object(S["a"])(b,s,r,!1,null,null,null),w=x.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer-left"},[n("div",{staticClass:"designer-left-tools"},[n("div",{staticClass:"title"},[n("span",[t._v(t._s(t.title))]),n("dsf-icon",{attrs:{name:"paixu"},on:{click:t.clickSort}})],1),n("el-tree",{ref:"leftTree",attrs:{data:t.list,props:t.leafProps,lazy:t.lazy,load:t.lazyLoad,"default-expand-all":!1,"expand-on-click-node":!1,"check-on-click-node":!0,"show-checkbox":t.openMultipleChoose,"filter-node-method":t.filterNode,"node-key":t.personIdAlias||"_id"},on:{"node-expand":t.nodeExpand},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return n("div",{staticClass:"my-tree-node",class:{draggable:i.draggable},attrs:{"data-id":i[t.leafProps.id]}},[t._v(" "+t._s(i[t.leafProps.label])+" ")])}}])})],1)])},C=[];function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I={name:"LeftTree",inject:["layoutConfigPointer","leftTreeConfigPointer"],props:{personObj:{type:Object,default:function(){return{}}},relativeList:{type:Array,default:function(){return[]}},seatObj:{type:Object,default:function(){return null}},relativeObj:{type:Object,default:function(){return{}}}},data:function(){return{title:"",leafProps:{},lazy:!1,isLeaf:"isLeaf",openMultipleChoose:!1,list:[]}},watch:{relativeList:{handler:function(){this.$refs.leftTree.setCheckedNodes([]),this.$refs.leftTree.filter()},deep:!0}},computed:P(P({},Vuex.mapState("seatDesign",["panelSize","compelPanelSize"])),{},{personIdAlias:function(){return this.leafProps.id},childrenAlias:function(){return this.leafProps.children},labelAlias:function(){return this.leafProps.label},seatedPerson:function(){for(var t={},e=0;e<this.relativeList.length;e++){var n=this.relativeList[e];if(n.person){var i=n["person"][this.personIdAlias];t[i]=n.person}}return t}}),created:function(){var t=this;d["a"].listen(p["a"].CONFIG_FILE_LOADED,(function(){t.leftTreeConfig=t.leftTreeConfigPointer(),t.layoutConfig=t.layoutConfigPointer(),Object.assign(t,t.leftTreeConfig),t.getLeafs(),t.addPersonRevertListener()}))},methods:{filterNode:function(t,e){return e["sys_seated"]=!!this.seatedPerson[e[this.personIdAlias]],!this.seatedPerson[e[this.personIdAlias]]},clickSort:function(){},getLeafs:function(){var t=this,e=this.leftTreeConfig.getLeafsUrl;this.$http.get(e).done((function(e){var n;n=_.isFunction(t.leftTreeConfig.dealRespond)?t.leftTreeConfig.dealRespond(e.data):e.data;var i={},o=[],a=function e(n){for(var a=0;a<n.length;a++){var s=n[a];_.isFunction(t.leftTreeConfig.isDragable)?s.draggable=t.leftTreeConfig.isDragable(s):s.draggable=!0,_.isFunction(t.leftTreeConfig.isUser)?(s.realUser=t.leftTreeConfig.isUser(s),s.realUser&&(o.push(s),i[s[t.personIdAlias]]=s)):(s.realUser=!0,o.push(s),i[s[t.personIdAlias]]=s),_.isArray(s[t.childrenAlias])&&s[t.childrenAlias].length>0&&e(s[t.childrenAlias])}return n};t.list=a(n),t.orderPerson=o,t.$emit("update:personObj",i),t.$nextTick((function(){t.$refs.leftTree.filter(),t.createInteraction(),t.listenAutoSeat()}))}))},lazyLoad:function(t,e){var n=this.leftTreeConfig.lazyLoadFunc;_.isFunction(n)&&n(t,e)},createInteraction:function(){var t=this;$(".my-tree-node.draggable").draggable({addClasses:!1,start:function(t){},helper:function(){var e,n;if(t.openMultipleChoose)n=t.$refs["leftTree"].getCheckedNodes(!0),n=n.filter((function(t){return t.realUser&&!t["sys_seated"]}));else{var i=$(this).data("id"),o=t.$refs["leftTree"].getNode(i);n=L(o)}if((null===(e=n)||void 0===e?void 0:e.length)>0){var a='<div class="drag-item">';return n.forEach((function(e){a+="<span data-id=".concat(e[t.personIdAlias],">").concat(e[t.labelAlias],"</span>")})),a+="</div>",$(a)}return $('<div class="drag-item" empty-person="true">没有可以排座的用户</div>')},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(t,e){},revert:"invalid"})},nodeExpand:function(){var t=this;this.$nextTick((function(){t.createInteraction()}))},addPersonRevertListener:function(){d["a"].on(p["a"].PERSON_REVERT_TREE,(function(t){$(".my-tree-node.draggable").draggable("option","revert",!0)}))},listenAutoSeat:function(){var t=this;d["a"].on(p["a"].AUTO_SEAT,(function(){var e=[],n=[];t.relativeList.forEach((function(i){2===i.currentState.couldSeat&&i.person&&(n.push(i),e.push(i.person[t.personIdAlias]))})),t.orderPerson=t.orderPerson.filter((function(n){return!_.includes(e,n[t.personIdAlias])}));var i=[],o=1,a=0;while(a<t.orderPerson.length){var s,r=t.orderPerson[a],l=t.seatObj[o],c=t.relativeObj[o];if(!l)break;if(2!==(null===c||void 0===c||null===(s=c.currentState)||void 0===s?void 0:s.couldSeat)){if(_.isFunction(t.layoutConfig.isSeatAble)){var u=t.layoutConfig.isSeatAble(l,r);if(!u){o++;continue}}i.push(Object(m["f"])(l,r)),o++,a++}else o++}t.$emit("update:relativeList",_.concat(n,i))}))}}};function L(t){if(t.isLeaf)return[t.data];var e=[],n=function t(n){for(var i=0;i<n.length;i++){var o,a=n[i],s=a.data.realUser,r=a.data.sys_seated;a.isLeaf&&s&&!r?e.push(a.data):(null===(o=a.childNodes)||void 0===o?void 0:o.length)>0&&t(a.childNodes)}};return n(t.childNodes),e}var j=I,z=Object(S["a"])(j,O,C,!1,null,null,null),E=z.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-designer-page",style:t.canvasCss,on:{click:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.canvasClick.apply(null,arguments)}}},[n("div",{style:t.panelSty,attrs:{id:"panel_outer"}},[t._t("seat"),n("div",{staticClass:"ds_seat_panel_bg",attrs:{id:"panel_bg"}})],2),t._t("seatPop")],2)},A=[];function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var M={name:"Canvas",data:function(){return{}},computed:T(T({},Vuex.mapState("seatDesign",{compelPanelSize:"compelPanelSize",panelSize:"panelSize",canvasCss:function(t){var e=t.compelPanelSize,n=e.width,i=e.height,o=n?"".concat(n,"px"):"100%",a=i?"".concat(i,"px"):"100%";return{width:o,height:a}},panelParentSize:function(t){var e=t.compelPanelSize,n=e.width,i=e.height;return n=n||$(".seat-designer-page").width(),i=i||$(".seat-designer-page").height(),{width:n,height:i}}})),{},{panelSty:function(){return{width:this.panelSize.width?this.panelSize.width+"px":"100%",height:this.panelSize.height?this.panelSize.height+"px":"100%",left:this.panelSize.left+"px",top:this.panelSize.top+"px"}}}),watch:{compelPanelSize:{handler:function(t){var e=t.width,n=t.height,i={width:e,height:n,scale:1,left:0,top:0};this.$store.commit("seatDesign/changePanelSize",i)},deep:!0}},mounted:function(){var t=this;$(".seat-designer-page")[0].addEventListener("mousewheel",t.handleScroll)},methods:{handleScroll:function(t){if(t.ctrlKey||e.metaKey){var n=this,i=t.wheelDelta<0?"down":"up",o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY}),a=n.panelParentSize,s=a.width,r=a.height,l=s*n.panelSize.scale,c=r*n.panelSize.scale,u=o.x/l,f=o.y/c,h=n.panelSize.scale;if("up"===i?h+=.1:"down"===i&&(h-=.1),h>=.1){var d=$("#panel_outer"),p=s*h,m=r*h,g=d.position().left+o.x-p*u,v=d.position().top+o.y-m*f,y={scale:Math.round(10*h)/10,width:Math.floor(p),height:Math.floor(m),left:Math.floor(g),top:Math.floor(v)};n.$store.commit("seatDesign/changePanelSize",y)}t.preventDefault(),t.stopPropagation()}},canvasClick:function(t){var e=this;e.$store.commit("seatDesign/changeActiveId","")}}},V=M,R=Object(S["a"])(V,D,A,!1,null,null,null),F=R.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-item-container normal"},[t._l(t.myItems,(function(e,i){return n("div",{key:e.id,staticClass:"seat-box",class:t.realSeatCss(e),style:t.getItemSty(e),attrs:{"data-id":e.id,"data-belong":e.type,"data-num":e.seatNum,"exist-person":!!e.person,"data-person":e.person?e.person[t.personNameAlias]:""},on:{contextmenu:function(n){return t.popMenu(n,e)},click:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.mulChooseSeat(n,e)}}},[n("div",{staticClass:"seat"},[e.person?[e.width*t.panelSize.scale>60?n("p",{staticClass:"person"},[t._v(t._s(e.person[t.personNameAlias]))]):n("p",{staticClass:"person",domProps:{textContent:t._s(e.person[t.personNameAlias].charAt(0))}})]:n("p",[t._v(t._s(e.seatTxt))])],2)])})),t._l(t.myGroups,(function(e,i){return n("div",{key:e.id,staticClass:"group-box",class:{hideText:2===e.showText},style:t.getItemSty(e)},[n("div",{staticClass:"group"},t._l(e.member,(function(i,o){return n("div",{key:i.id,staticClass:"member",class:t.realSeatCss(i),style:t.getMemberSty(i),attrs:{"data-id":i.id,"data-pid":e.id,"data-num":i.seatNum,"exist-person":!!i.person,"data-person":i.person?i.person[t.personNameAlias]:"","data-belong":"group"},on:{contextmenu:function(n){return t.popMenu(n,e,i)},click:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.mulChooseSeat(n,i,e)}}},[i.person?[i.width*t.panelSize.scale>60?n("p",{staticClass:"person"},[t._v(t._s(i.person[t.personNameAlias]))]):n("p",{staticClass:"person",domProps:{textContent:t._s(i.person[t.personNameAlias].charAt(0))}})]:n("p",[t._v(t._s(i.seatTxt))])],2)})),0)])})),n("el-dialog",{attrs:{title:"提示",visible:t.confirm.visible,"append-to-body":!0,width:"30%"},on:{"update:visible":function(e){return t.$set(t.confirm,"visible",e)}}},[n("div",[t._v(t._s(t.confirm.msg))]),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.seatCover}},[t._v("覆盖")]),n("el-button",{on:{click:t.seatInsert}},[t._v("插入")]),n("el-button",{on:{click:t.seatCancel}},[t._v("取消")])],1)])],2)},Y=[];function G(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=K(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function K(t,e){if(t){if("string"===typeof t)return q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(t,e):void 0}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var X={name:"SeatItem",inject:["layoutConfigPointer","leftTreeConfigPointer"],props:{keyStack:{type:Array,default:function(){return[]}},items:{type:Array,default:function(){return[]}},groups:{type:Array,default:function(){return[]}},seatObj:{type:Object,default:function(){return null}},relativeList:{type:Array,default:function(){return[]}},chosenItems:{type:Array,default:function(){return[]}},personObj:{type:Object,default:function(){return{}}},relativeObj:{type:Object,default:function(){return{}}}},data:function(){return{confirm:{visible:!1,msg:"",type:""}}},computed:W(W({},Vuex.mapState("seatDesign",{panelSize:"panelSize",activeId:"activeId"})),{},{myItems:function(){for(var t=_.cloneDeep(this.items),e=0;e<this.relativeList.length;e++)for(var n=0;n<t.length;n++){var i=this.relativeList[e],o=t[n];i.id===o.id&&Object.assign(o,i)}return t},myGroups:function(){for(var t=_.cloneDeep(this.groups),e=!1,n=0;n<this.relativeList.length;n++){e=!1;for(var i=0;i<t.length;i++){if(e)break;var o=this.relativeList[n],a=t[i];if(a.id===o.pid)for(var s=0;s<a.member.length;s++){var r=a.member[s];if(r.id===o.id){Object.assign(r,o),e=!0;break}}}}return t},personNameAlias:function(){return this.leftTreeConfig.leafProps.label},personIdAlias:function(){return this.leftTreeConfig.leafProps.id}}),watch:{"panelSize.scale":function(){this.items.forEach((function(t){t.isFrozenSty=!1})),this.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1}))},chosenItems:function(t){$("i.anchor").remove(),$(".chosen").removeClass("chosen");var e={},n={};t.forEach((function(t){e[t.id]=t,t.ischosenRreference&&(n[t.id]=t)})),$(".member").each((function(){var t=$(this).data("id");e[t]&&$(this).addClass("chosen"),n[t]&&$(this).append("<i class='anchor'></i>")})),$(".seat-box").each((function(){var t=$(this).data("id");e[t]&&$(this).addClass("chosen")}))}},beforeDestroy:function(){$(document).off("mouseup.scaleSeatItem"),$(document).off("mousemove.scaleSeatItem")},mounted:function(){var t=this;d["a"].on(p["a"].KEY_CTRL_D,(function(){})),d["a"].on(p["a"].KEY_DELETE,(function(){})),d["a"].listen(p["a"].BODY_EMPTY_CLICK,(function(){t.chosenItems.forEach((function(t){t.ischosenRreference=!1})),t.$emit("update:chosenItems",[])})),d["a"].listen(p["a"].CONFIG_FILE_LOADED,(function(){t.layoutConfig=t.layoutConfigPointer(),t.leftTreeConfig=t.leftTreeConfigPointer(),t.createInteraction()}))},methods:{mulChooseSeat:function(t,e,n){if(this.layoutConfig.openMultipleChoose){if($(".seat-item-container .person-info").remove(),t.stopPropagation(),t.preventDefault(),"ctrl"!==this.keyStack[0]&&"shift"!==this.keyStack[0]){var i=this.chosenItems.findIndex((function(t){return t.id===e.id}));if(-1===i)return void d["a"].dispatch(p["a"].BODY_EMPTY_CLICK)}if(d["a"].emit(p["a"].LEFT_CLICK_SEAT),"ctrl"===this.keyStack[0]){var o=this.chosenItems.findIndex((function(t){return t.id===e.id}));-1!==o?(this.chosenItems.splice(o,1),e.ischosenRreference&&(e.ischosenRreference=!1)):this.chosenItems.push(e)}else if("shift"===this.keyStack[0])if(n){var a=this.chosenItems.filter((function(t){return t.parentId===n.id}));if(0===a.length)e.ischosenRreference=!0,this.chosenItems.push(e);else{var s=a.find((function(t){return t.ischosenRreference}));if(s){var r,l;n.member.some((function(t,n){if(r&&l)return!0;e.id===t.id&&(r=n),s.id===t.id&&(l=n)}));var c=this.chosenItems.filter((function(t){return t.parentId!==n.id}));if(r===l)e.ischosenRreference=!1,this.$emit("update:chosenItems",c);else{var u=r<l?n.member.slice(r,l+1):n.member.slice(l,r+1),f=c.concat(u);this.$emit("update:chosenItems",f)}}else{var h=_.differenceBy(this.chosenItems,a,"id");e.ischosenRreference=!0,h.push(e),this.$emit("update:chosenItems",h)}}}else this.chosenItems.forEach((function(t){t.ischosenRreference=!1})),this.$emit("update:chosenItems",[e])}},realSeatCss:function(t){return[{realSeat:!/^sec/.test(t.type),hideText:2===t.showText}]},getItemSty:function(t){var e={width:t.width*this.panelSize.scale+"px",height:t.height*this.panelSize.scale+"px",left:t.left*this.panelSize.scale+"px",top:t.top*this.panelSize.scale+"px",transform:"rotate(".concat(t.angle,"deg)")};return"group"!==t.type&&(e.background=tt(t)),t.style=e,e},getMemberSty:function(t){var e={width:t.width*this.panelSize.scale+"px",height:t.height*this.panelSize.scale+"px",left:t.left*this.panelSize.scale+"px",top:t.top*this.panelSize.scale+"px"};return e.background=tt(t),e},popMenu:function(t,e,n){if(!/^sec_/.test(e.type)&&3===t.which){var i="group"!==e.type?e:n,o=this.chosenItems.findIndex((function(t){return t.id===i.id}));-1===o&&d["a"].dispatch(p["a"].BODY_EMPTY_CLICK),$(".active").removeClass("active");var a=H(t,!n);$(a).addClass("active"),t.preventDefault(),t.stopPropagation();var s=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});Z.call(this,e),d["a"].emit(p["a"].SEAT_POP,{position:W({},s),currentItem:i})}},createInteraction:function(){var t=this;this.$nextTick((function(){var e=t;$(".seat-item-container .realSeat").droppable({addClasses:!1,tolerance:"pointer",over:function(t,e){var n=$(t.target);n.hasClass("realSeat")&&n.css({"box-shadow":"0 0 5px inset #409eff"})},drop:function(t,n){var i=$(t.target);if(i.css("box-shadow","none"),!n.helper.attr("empty-person")){if("group"===i.data("belong")){var o=e.myGroups.find((function(t){return t.id===i.data("pid")}));e.dropSeatObj=o.member.find((function(t){return t.id===i.data("id")}))}else e.dropSeatObj=e.myItems.find((function(t){return t.id===i.data("id")}));var a=[];n.helper.children("span").each((function(){a.push($(this).data("id"))})),e.mPersonIds=a,J.call(e)}},out:function(t,e){var n=$(t.target);n.css("box-shadow","none")}}),$(".seat-item-container").on("mouseenter","[exist-person]",(function(t){var e;if(!$(this).hasClass("chosen")&&!((null===(e=$(this).find(".person-info"))||void 0===e?void 0:e.length)>0)){var n=$(this).attr("data-person");$(this).append('<div class="person-info">'.concat(n," <i></i></div>"))}})),$(".seat-item-container").on("mouseleave","[exist-person]",(function(){$(this).find(".person-info").remove()}))}))},seatCover:function(){var t=this.dropSeatObj.seatNum,e=0,n=0;while(n<this.mPersonIds.length){var i=this.relativeObj[t+e],o=this.personObj[this.mPersonIds[n]],a=this.seatObj[t+e];if(!a)break;if(_.isFunction(this.layoutConfig.isSeatAble)){var s=this.layoutConfig.isSeatAble(a,o);if(!s){e++;continue}}if(i){if(2===i.currentState.couldSeat){e++;continue}i.person=o,i.currentState=a.stateList[1]}else this.relativeList.push(Object(m["f"])(a,o));e++,n++}this.confirm.visible=!1},seatInsert:function(){},seatCancel:function(){this.dropSeatObj=null,this.mPersonIds=null,this.mPersonid=null,this.confirm.visible=!1},popConfirm:function(t){this.confirm={visible:!0,msg:"检测到您需要入座的座位上已经存在其他人员，您希望如何处理？",type:"warning"}}}};function H(t,e){var n=$(t.target);return e?n.hasClass("seat-box")?n:n.parents(".seat-box").eq(0):n.hasClass("member")?n:n.parents(".member").eq(0)}function J(){var t,e=this,n=this.mPersonIds;if((null===(t=this.chosenItems)||void 0===t?void 0:t.length)>0){var i=this.chosenItems.findIndex((function(t){return t.id===e.dropSeatObj.id}));if(-1===i)return void dsf.layer.confirm("您已选中了部分座位，只有将人员拖入选中的座位中，才能开始依序号排座");this.chosenItems.sort((function(t,e){return t.seatNum-e.seatNum}));var o,a=0,s={},r=G(this.chosenItems);try{for(r.s();!(o=r.n()).done;){var l,c=o.value;if(2!==(null===c||void 0===c||null===(l=c.currentState)||void 0===l?void 0:l.couldSeat)){if(c.person)return void this.popConfirm();var u=this.personObj[n[a]];if(_.isFunction(this.layoutConfig.isSeatAble)){var f=this.layoutConfig.isSeatAble(c,u);if(!f)continue}if(s[c.id]={seat:c,person:u},a+=1,a===n.length)break}}}catch(O){r.e(O)}finally{r.f()}Q.call(this,s)}else{for(var h=this.dropSeatObj.seatNum,d=0;d<n.length;d++){var p;if(null!==(p=this.relativeObj[h+d])&&void 0!==p&&p.person)return void this.popConfirm()}var g=0,v=0;while(v<n.length){var y,b=this.personObj[n[v]],S=this.relativeObj[h+g],x=this.seatObj[h+g];if(!x)return;if(2!==(null===S||void 0===S||null===(y=S.currentState)||void 0===y?void 0:y.couldSeat)){if(_.isFunction(this.layoutConfig.isSeatAble)){var w=this.layoutConfig.isSeatAble(x,b);if(!w){g++;continue}}S?(S.person=b,S.currentState=x.stateList[1]):this.relativeList.push(Object(m["f"])(x,b)),g++,v++}else g++}}}function Q(t){for(var e in t){var n=t[e].seat,i=t[e].person;this.relativeList.push(Object(m["f"])(n,i))}for(var o=0;o<this.chosenItems.length;o++){var a=this.chosenItems[o];if(t[a.id]){var s=t[a.id].seat,r=t[a.id].person;a.currentState=s.stateList[1],a.person=r}}}function Z(t){this.activeId!==t.id&&this.$store.commit("seatDesign/changeActiveId",t.id)}function tt(t){var e;if(/^sec_/.test(t.type))e=dsf.url.getAbsolutePath(t.bgImg);else if(t.currentState){if(!t.currentState.img)return"none";e=dsf.url.getAbsolutePath(t.currentState.img)}else{var n=_.isArray(t.stateList)&&t.stateList[0]&&t.stateList[0].img;if(!n)return"none";e=dsf.url.getAbsolutePath(t.stateList[0].img)}return"center / contain no-repeat url(".concat(e,")")}var et=X,nt=Object(S["a"])(et,B,Y,!1,null,null,null),it=nt.exports,ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.popShow,expression:"popShow"}],staticClass:"seat-pop-box",style:t.sty},[n("ul",[t.isExistPerson?n("li",{on:{click:t.removePerson}},[t._v("移除占用")]):t._e(),t.isExistPerson?n("li",{on:{click:t.splicePerson}},[t._v("移除占用并补位")]):t._e(),1!==t.couldSeat?n("li",{on:{click:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:(e.stopPropagation(),t.seat2work.apply(null,arguments))}}},[t._v("启用")]):t._e(),t._l(t.otherList,(function(e,i){return n("li",{key:i,on:{click:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:(n.stopPropagation(),t.clickOther(e))}}},[t._v(t._s(e.statusText))])}))],2),n("el-dialog",{attrs:{visible:t.dialogVisible,title:"信息",width:"300px",modal:!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}})],1)},at=[],st={name:"SeatPop",inject:["layoutConfigPointer","leftTreeConfigPointer"],props:{relativeList:{type:Array,default:function(){return[]}},chosenItems:{type:Array,default:function(){return[]}},seatObj:{type:Object,default:function(){return null}},relativeObj:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,currentItem:{currentState:{},stateList:[]},position:{},popShow:!1,state:null,couldSeat:1}},computed:{sty:function(){return{left:this.position.x+"px",top:this.position.y+"px"}},otherList:function(){var t=this,e=this.currentItem.stateList.slice(2);if(this.state){var n=e.findIndex((function(e){return e.statusValue===t.state}));-1!==n&&e.splice(n,1)}return e},personIdAlias:function(){return this.leftTreeConfig.leafProps.id},isExistPerson:function(){return this.chosenItems&&0!==this.chosenItems.length?this.chosenItems.some((function(t){return!!t.person})):!!this.currentItem.person&&3!==this.currentItem.currentState.statusValue},layoutConfig:function(){return this.layoutConfigPointer()},leftTreeConfig:function(){return this.leftTreeConfigPointer()}},mounted:function(){var t=this;d["a"].on(p["a"].SEAT_POP,(function(e){Object.assign(t,e);var n=e.currentItem.currentState;n?(t.couldSeat=n.couldSeat,t.state=n.statusValue):(t.couldSeat=1,t.state=null),t.popShow=!0})),d["a"].on(p["a"].LEFT_CLICK_SEAT,(function(){t.popShow=!1,$(".active").removeClass("active")})),d["a"].listen(p["a"].BODY_EMPTY_CLICK,(function(){t.popShow=!1,$(".active").removeClass("active")}))},methods:{popDialog:function(t){t.stopPropagation(),t.preventDefault(),this.popShow=!0,this.dialogVisible=!0},clickOther:function(t){if(this.chosenItems&&0!==this.chosenItems.length){for(var e=0;e<this.chosenItems.length;e++){var n=this.chosenItems[e],i=this.relativeObj[n.seatNum];rt.call(this,i,n,t)}this.$emit("update:chosenItems",[])}else{var o=this.relativeObj[this.currentItem.seatNum];rt.call(this,o,this.currentItem,t)}this.popShow=!1},seat2work:function(){if(this.chosenItems&&0!==this.chosenItems.length){for(var t=0;t<this.chosenItems.length;t++){var e=this.chosenItems[t],n=this.relativeObj[e.seatNum];n&&(n.currentState=n.person?e.stateList[1]:e.stateList[0])}this.$emit("update:chosenItems",[])}else{var i=this.relativeObj[this.currentItem.seatNum];i.currentState=i.person?this.currentItem.stateList[1]:this.currentItem.stateList[0]}this.popShow=!1},removePerson:function(){if(this.chosenItems&&0!==this.chosenItems.length)for(var t=0;t<this.chosenItems.length;t++){var e=this.chosenItems[t],n=this.relativeObj[e.seatNum];n&&3!==n.currentState.statusValue&&(n.person=null,n.currentState=e.stateList[0])}else{var i=this.relativeObj[this.currentItem.seatNum];if(3===i.currentState.statusValue)return;i.person=null,i.currentState=this.currentItem.stateList[0]}},splicePerson:function(){var t,e,n=this,i=[],o=[];if((null===(t=this.chosenItems)||void 0===t?void 0:t.length)>0){this.chosenItems.sort((function(t,e){return t.seatNum-e.seatNum})),e=this.chosenItems[0].seatNum;var a=function(){var t=n.relativeObj[s];if(s<e||2===t.currentState.couldSeat)return 0;i.push(t);var a=n.chosenItems.findIndex((function(e){return e.id===t.id}));if(-1!==a||!t.person)return 0;o.push(t)};for(var s in this.relativeObj)a();var r=this.relativeList.filter((function(t){var e=i.findIndex((function(e){return e.id===t.id}));return-1===e}));this.$emit("update:relativeList",r)}else{var l=this.relativeObj[this.currentItem.seatNum];for(var c in e=l.seatNum,this.relativeObj){var u=this.relativeObj[c];c<=e||2===u.currentState.couldSeat||(i.push(u),u.person&&o.push(u))}var f=this.relativeList.filter((function(t){if(t.id===l.id)return!1;var e=i.findIndex((function(e){return e.id===t.id}));return-1===e}));this.$emit("update:relativeList",f)}this.$nextTick((function(){var t=0,i=0;while(i<o.length){var a,s=n.seatObj[e+t],r=o[i].person;if(2!==(null===(a=n.relativeObj[e+t])||void 0===a||null===(a=a.currentState)||void 0===a?void 0:a.couldSeat)){if(_.isFunction(n.layoutConfig.isSeatAble)){var l=n.layoutConfig.isSeatAble(s,r);if(!l){t++;continue}}n.relativeList.push(Object(m["f"])(s,r)),t++,i++}else t++}}))}}};function rt(t,e,n){if(t)t.currentState=n,2===n.couldSeat&&3!==n.statusValue&&t.person&&(t.person=null);else{var i={id:e.id,pid:e.parentId,belong:e.belong,currentState:n,person:null,seatNum:e.seatNum};this.relativeList.push(i)}}var lt=st,ct=Object(S["a"])(lt,ot,at,!1,null,null,null),ut=ct.exports,ft=i(444),ht={name:"DsfSeatView",provide:function(){var t=this;return{layoutConfigPointer:function(){return t.layoutConfig},leftTreeConfigPointer:function(){return t.leftTreeConfig}}},data:function(){return{keyStack:[],postData:{_id:"",backgroundImage:{},canvasSet:{},hasBg:!1,items:[],groups:[]},leftList:[],personObj:{},relativeList:[],chosenItems:[],seatObj:null,layoutConfig:null,leftTreeConfig:null}},computed:{relativeObj:function(){for(var t={},e=0;e<this.relativeList.length;e++){var n=this.relativeList[e];t[n.seatNum]=n}return t}},watch:{"postData.backgroundImage":function(){m["a"].call(this)}},components:{topTools:w,leftTree:E,seatCanvas:F,seatItem:it,seatPop:ut},created:function(){var t=this,e=dsf.url.getWebPath("$/seat_config/seat/viewSeatLayout.js"),n=dsf.url.getWebPath("$/seat_config/seat/viewLeftTree.js");this.$http.importFiles([e,n]).then((function(e){t.layoutConfig=new ft["a"](viewSeatLayoutConfig,t.$route.query.opt),t.leftTreeConfig=new ft["a"](viewLeftTreeConfig,t.$route.query.opt),d["a"].dispatch(p["a"].CONFIG_FILE_LOADED),t.getSeatInfo(),t.bindShortKey()}))},methods:{getSeatInfo:function(){var t=this.$route.query.id;if(t){var e=JSON.parse(localStorage.getItem("seat_"+t));if(e){_.isEmpty(e.canvasSet)&&(e.canvasSet={width:void 0,height:void 0}),this.postData=e;var n={};e.items.forEach((function(t){n[t.seatNum]=t})),e.groups.forEach((function(t){t.member.forEach((function(t){n[t.seatNum]=t}))})),this.seatObj=n;var i=this.$route.query.relId;if(i){var o=JSON.parse(localStorage.getItem("relation_"+i));o&&(this.relativeList=o)}}}},bindShortKey:function(){var t=["ctrl","ctrl-d","ctrl-s"];Object(m["g"])(this.keyStack,t),$(".seat-designer-page").on("click",(function(){d["a"].dispatch(p["a"].BODY_EMPTY_CLICK)}))},save:function(){var t=this.$route.query.relId||dsf.uuid();localStorage.setItem("relation_"+t,JSON.stringify(this.relativeList));var e=this.$route.query,n=Object.assign({},e,{relId:t});this.$router.replace({path:this.$route.path,query:n})},clear:function(){this.relativeList=[]}}},dt=ht,pt=Object(S["a"])(dt,o,a,!1,null,null,null);n["default"]=pt.exports},96:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadding,expression:"loadding"}],staticStyle:{width:"100%",height:"100%",overflow:"hidden"}},[n("iframe",{ref:"iframe",staticStyle:{"border-style":"none",width:"100%",height:"100%"},attrs:{src:t.url}})])},o=[],a={name:"DesStaticListData",mixins:[$mixins.propertyDialogSetting],props:{designer:{type:Object,default:function(){return null}},value:{type:Object,default:function(){return{}}}},data:function(){return{loadding:!1,url:""}},beforeCreate:function(){},created:function(){},beforeMount:function(){},mounted:function(){var t=this,e=this;this.loadding=!0,this.$refs.iframe.getValue=function(){return t.value},this.$refs.iframe.onload=function(){e.loadding=!1},this.url=dsf.url.getWebPath("$/html/staticListData.html")},methods:{yes:function(){var t=this.$refs.iframe.contentWindow,e=t.yes();return e}},beforeDestroy:function(){this.$refs.iframe.getValue=null},destroyed:function(){}},s=a,r=n(0),l=Object(r["a"])(s,i,o,!1,null,null,null);e["default"]=l.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_designer_router_other.js.map