/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[21],{1017:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control mobile ds-me-user-info",class:{"ds-no-padding":!e.isDesign},style:e.controlStyle},[s("div",{staticClass:"ds-me-user-info-wrap"},[s("div",{staticClass:"ds-me-user-info-head",on:{click:e.headClick}},[s("van-image",{attrs:{width:"80",height:"80",fit:"cover",src:e.photoSrc},scopedSlots:e._u([{key:"error",fn:function(){return[s("van-image",{attrs:{width:"80",height:"80",fit:"cover",src:e.$replace(e.dsf.config.setting_public_user_default_header)}})]},proxy:!0}])})],1),s("div",{staticClass:"ds-me-user-info-name"},[e._v(e._s(e.info&&e.info.name||""))]),s("div",{staticClass:"ds-me-user-info-company ellipsis"},[e._v(" "+e._s(e.info&&e.info.unitDuty||"")+" ")])]),s("van-overlay",{attrs:{show:e.browseHeader},on:{click:function(t){e.browseHeader=!1}}},[s("div",{staticClass:"ds-me-user-info-head-browse-box",on:{click:function(e){e.stopPropagation()}}},[s("div",{staticClass:"ds-me-user-info-head-browse"},[s("van-image",{attrs:{width:"4rem",height:"4rem",fit:"cover",src:e.photoSrc},scopedSlots:e._u([{key:"error",fn:function(){return[s("van-image",{attrs:{width:"100%",height:"100%",fit:"cover",src:e.$replace(e.dsf.config.setting_public_user_default_header)}})]},proxy:!0}])}),s("div",{staticClass:"ds-me-user-info-head-browse-btns"},[s("van-button",{attrs:{type:"default"},on:{click:function(t){e.browseHeader=!1}}},[e._v(" 关闭 ")]),s("van-button",{attrs:{type:"info"},on:{click:e.uploadPhotoFn}},[e._v(" 重新上传 ")])],1),e.updatePhotoText?s("div",{staticClass:"ds-me-user-info-head-browse-text"},[e._v(" "+e._s(e.updatePhotoText)+" ")]):e._e()],1)])]),s("DsfMobileUploadPhoto",{ref:"upload-photo",staticClass:"ds-me-user-info-upload-photo",attrs:{"aspect-ratio":e.aspectRatio,"max-side-width":e.maxSideWidth,"is-resize":e.isResize,"is-round":e.isRound,maxFileSize:1048576,accept:e.isAndroid?"image/*":".jpg,.jpeg,.png",requestUrl:"/file/upload",simple:"","is-cut-pic":""},on:{"upload-complete":e.headUploadComplete}})],1)},o=[],i=dsf.component({name:"DsfMobileMeUserInfo",ctrlCaption:"我的-用户信息",mixins:[$mixins.control],props:{height:{type:String,default:"auto"},padding:{type:Array,default:function(){return[20,0,20,0]}},bgColor:{type:String,default:""},info:{type:Object,default:function(){return{photo:"",name:"员工名称",unitDuty:"xxxxxxxxx科技股份有限公司员工"}}},url:{type:String,default:""},updatePhotoUrl:{type:String,default:"/teas/mobile/student/updatePhoto"},updatePhotoText:{type:String,default:""},aspectRatio:{type:String,default:"1/1"},maxSideWidth:{type:Number,default:0},isResize:{type:Boolean,default:!1},isRound:{type:Boolean,default:!1}},computed:{photoSrc:function(){var e,t=null===(e=this.info)||void 0===e||null===(e=e.photo)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.relativePath;return t?dsf.url.getWebPath(t):this.$replace(dsf.config.setting_public_user_default_header)},controlStyle:function(){var e=this.padding,t=this.height,s=this.bgColor,n=this.isDesign,o={height:t,padding:e.join("px ")+"px"};return n&&(o.padding="10px"),s&&(o.backgroundColor=s),o}},data:function(){return{browseHeader:!1,isAndroid:dsf.client.android()}},watch:{url:{immediate:!0,handler:function(){this.getInfo()}}},methods:{getInfo:function(){var e=this,t=this.url,s=this.isDesign;if(this.$emit("update:info",{}),t&&!s){var n={};this.$http.get(t,n).done((function(t){var s=t.success,n=t.data,o=t.message;s?(n.photo=JSON.parse(n.photo),e.$emit("update:info",n||{})):dsf.layer.message(o,!1)})).error((function(e){console.error(e)}))}},headClick:function(){this.isDesign||(this.browseHeader=!0)},uploadPhotoFn:function(){var e,t=this.$refs["upload-photo"];t&&(null===(e=t.$el.querySelector("input"))||void 0===e||e.click())},headUploadComplete:function(e){var t=e.args;t&&t.success&&this.updatePhoto(t.data);var s=this.$refs["upload-photo"];s.beforeDelete()},updatePhoto:function(e){var t=this,s={photo:JSON.stringify(e)};this.$http.post(this.updatePhotoUrl,s).done((function(e){var s=e.success,n=e.message;s?(t.browseHeader=!1,t.getInfo()):dsf.layer.message(n,!1)})).error((function(){dsf.layer.message("上传头像失败",!1)}))}}}),r=i,a=s(0),u=Object(a["a"])(r,n,o,!1,null,null,null);t["default"]=u.exports},1018:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control mobile ds-me-menus",class:{"ds-no-padding":!e.isDesign},style:e.controlStyle},[s("div",{staticClass:"ds-me-menus-wrap",style:e.wrapStyle},[e._l(e.menus,(function(t,n){return[s("div",{key:n,staticClass:"ds-me-menus-row",style:e.rowStyle,on:{click:function(s){return e.menuRowClick(t,n)}}},[s("DsfIcon",{staticClass:"ds-me-menus-row-icon",style:e.iconStyle(n),attrs:{name:t&&t.icon||""}}),s("div",{staticClass:"ds-me-menus-row-label"},[e._v(" "+e._s(t&&t.name||"")+" ")]),s("div",{staticClass:"ds-me-menus-row-desc"},[e._v(" "+e._s(t&&t.subhead||"")+" ")]),t&&t.url?s("DsfIcon",{staticClass:"ds-me-menus-row-arrow",attrs:{name:"arrow-right"}}):e._e()],1)]}))],2)])},o=[],i=dsf.component({name:"DsfMobileMeMenus",ctrlCaption:"我的-菜单",mixins:[$mixins.control],props:{height:{type:String,default:"auto"},padding:{type:Array,default:function(){return[0,0,0,0]}},rowPadding:{type:Array,default:function(){return[0,15,0,12]}},rowMargin:{type:Array,default:function(){return[0,0,0,0]}},rowHeight:{type:Number,default:58},menus:{type:Array,default:function(){return[{id:"1",name:"个人信息",icon:"tab-addressBook-d",url:"1",subhead:""},{id:"2",name:"修改密码",icon:"password",url:"1",subhead:""}]}},url:{type:String,default:""},iconColorList:{type:Array,default:function(){return["#E74E42","#2495C7","#FFA529"]}}},computed:{controlStyle:function(){this.padding;var e=this.isDesign,t={};return e&&(t.padding="10px 0"),t},wrapStyle:function(){this.padding;var e=this.bgColor,t=this.isDesign,s={};return t&&(s.margin="0 10px"),e&&(s.backgroundColor=e),s},rowStyle:function(){var e=this,t=this.rowPadding,s=this.rowMargin,n=this.rowHeight,o={height:this.pxToRem(n),padding:t.map((function(t){return e.pxToRem(t)})).join(" "),margin:s.map((function(t){return e.pxToRem(t)})).join(" ")};return o}},data:function(){return{}},watch:{url:{immediate:!0,handler:function(){this.getMenus()}}},beforeCreate:function(){},created:function(){},beforeMount:function(){},mounted:function(){},methods:{getMenus:function(){var e=this,t=this.url,s=this.isDesign;if(t&&!s){this.$emit("update:menus",[]);var n={};this.$http.get(t,n).then((function(t){var s=t.data;s&&s.success?e.$emit("update:menus",s.data||[]):dsf.layer.message(s.message,!1)})).catch((function(e){console.error(error),dsf.layer.message((null===e||void 0===e?void 0:e.message)||"未知异常",!1)}))}},iconStyle:function(e){var t=this.iconColorList,s={},n=t&&t[e%t.length];return n&&(s.color=n),s},menuRowClick:function(e){e.url&&!this.isDesign&&this.$open({url:this.$replace(e.url,{}),state:4})}},beforeDestroy:function(){},destroyed:function(){}}),r=i,a=s(0),u=Object(a["a"])(r,n,o,!1,null,null,null);t["default"]=u.exports},1019:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ds-control mobile ds-me",class:{"ds-no-padding":!e.isDesign}},[s("div",{staticClass:"ds-me-wrap"},[e._t("user-info",(function(){return[s("DsfMobileMeUserInfo",e._b({attrs:{isDesign:e.isDesign,"aspect-ratio":e.aspectRatio,"max-side-width":e.maxSideWidth,"is-resize":e.isResize,"is-round":e.isRound}},"DsfMobileMeUserInfo",e.userInfoConfig,!1,!0))]}),null,e.userInfoConfig),s("div",{staticClass:"ds-me-menus-box"},[e._t("menus",(function(){return[s("DsfMobileMeMenus",e._b({attrs:{isDesign:e.isDesign}},"DsfMobileMeMenus",e.menusConfig,!1,!0))]})),e._t("custom-buttons"),e._t("buttons",(function(){return[s("div",{staticClass:"ds-me-menus-bottom-box"},[s("div",{staticClass:"ds-me-menus-bottom-line"}),e.changeGroup&&e.changeGroup.groupId?s("div",{staticClass:"ds-me-menus-bottom-btn",on:{click:e.toGoaddress}},[e._v(" 切换"+e._s("001"==e.dsf.session.get("userGroupCode")?"教职工":"学员")+" ")]):e._e(),e.showGroupChange?s("DsfMobileHomeChangeRole",{staticClass:"ds-me-menus-bottom-btn",attrs:{maxHeight:"70vh"}},[e._v("切换角色组")]):e._e(),s("div",{staticClass:"ds-me-menus-bottom-btn",on:{click:e.loginOut}},[e._v("退出登录")])],1)]}))],2)],2)])},o=[],i=s(4),r=s.n(i),a=s(1),u=s.n(a),d=dsf.component({name:"DsfMobileMe",ctrlCaption:"我的",mixins:[$mixins.control],props:{userInfoConfig:{type:Object,default:function(){return{url:"",updatePhotoUrl:""}}},menusConfig:{type:Object,default:function(){return{url:"",menus:[{id:"1",name:"个人信息",icon:"tab-addressBook-d",url:"1",subhead:""},{id:"2",name:"修改密码",icon:"password",url:"#/mobile/dsfa/platformhome/mobile-alterpassword",subhead:""}]}}},roleUrl:{type:String,default:""},aspectRatio:{type:String,default:"1/1"},maxSideWidth:{type:Number,default:0},isResize:{type:Boolean,default:!1},isRound:{type:Boolean,default:!1},loginOutSuccess:{type:Function,default:null},showGroupChange:{type:Boolean,default:!1}},data:function(){return{info:{},changeGroup:null}},computed:{},beforeCreate:function(){},created:function(){this.getRole(),dsf.isUnDef(this.menusConfig.menus)&&this.$set(this.menusConfig,"menus",[]),dsf.isUnDef(this.userInfoConfig.info)&&this.$set(this.userInfoConfig,"info",{})},beforeMount:function(){},mounted:function(){},methods:{loginOut:function(){var e=this;this.isDesign||dsf.layer.confirm("确定要退出吗?").then((function(){e.$webAPI.mobileLoginOut({},{}).then((function(t){var s=t.success,n=t.data,o=t.message;if(s)if(!dsf.client.weixin()&&window.$sharedPreferences&&$sharedPreferences.clear((function(){})),dsf.clearLoginInfo((function(){dsf.session.remove("allGroup"),dsf.session.remove("userGroupCode"),dsf.session.remove("class_name"),dsf.session.remove("stuName"),dsf.session.remove("stuClassBol"),dsf.session.remove("class_id"),dsf.session.remove("stuId"),dsf.session.remove("branchEnable"),dsf.session.remove("branch_id"),dsf.session.remove("allGroup")})),e.loginOutSuccess)"function"==dsf.type(e.loginOutSuccess)&&e.loginOutSuccess(n);else{var i=dsf.url.getMobileLogin();location.replace(i)}else dsf.layer.message(o||"请求异常",!1)})).catch((function(e){dsf.layer.message(e.message||"请求异常",!1)})).finally((function(){}))})).catch((function(){}))},getRole:function(){var e=this;this.isDesign||(this.changeGroup="",this.$http.get(this.roleUrl).then((function(t){var s=t.data;s&&s.success&&s.data&&(e.changeGroup=s.data||null)})).catch((function(){})))},toGoaddress:function(){var e=this,t=this.changeGroup,s=this.isDesign;t&&t.groupId&&!s&&this.$http.post("/CommonLogin/changeGroup",{groupId:t.groupId,terminalType:2}).then((function(t){var s=t.data;s&&s.success&&e.setStateIsLogin(s.data)}))},setStateIsLogin:function(e){var t=this;return r()(u.a.mark((function s(){var n,o,i,r,a,d,l;return u.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return dsf.storage.session.clear(),n=e.groupGo,o=t.$root.getAppId(),i="001"==dsf.getCookie("userGroupCode")?1:0,dsf.storage.local.set("logined",!0,!0),dsf.storage.local.set("userType",i,!0),r="",a=t.$route.query.from,n&&(d=dsf.url.parse(n),d.searchQuery["appid"]&&(o=d.searchQuery["appid"],delete d.searchQuery["appid"]),r=(d.protocol?d.origin:d.hostname)+d.pathname+(dsf.isEmptyObject(d.searchQuery)?"":"?"+dsf.url.queryStringStringify(d.searchQuery))+d.hash),r="",s.next=12,t.$root.initApp(o);case 12:a?r=decodeURIComponent(a):(r||(r=window.location.pathname,window.location.search&&(r+=window.location.search)),l=dsf.url.parse(r),l.hash||(r+="#"+t.$root.navs[0].href),location.replace(r));case 13:case"end":return s.stop()}}),s)})))()}},beforeDestroy:function(){},destroyed:function(){}}),l=d,c=s(0),f=Object(c["a"])(l,n,o,!1,null,null,null);t["default"]=f.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_mobile_me_module.js.map