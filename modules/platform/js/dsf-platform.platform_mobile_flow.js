/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[15],{1228:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isDesign?s("div",{staticClass:"ds-control ds-form-item ds-textbox mobile",class:e.getCss},[[s("van-field",{attrs:{type:"text",disabled:!0,"label-width":e.getLabelWidth(!0),label:"流程信息","input-align":"right"},model:{value:e.chooseFlow.name,callback:function(t){e.$set(e.chooseFlow,"name",t)},expression:"chooseFlow.name"}})]],2):e._e()},n=[],a=dsf.component({name:"DsfMobileFlowInfo",ctrlCaption:"流程信息",mixins:[$mixins.formControl,$mixins.flowInfo],methods:{}}),o=a,r=s(0),l=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=l.exports},1229:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ds-control ds-flow-process mobile",staticStyle:{padding:"0"}},[(e.isDesign||e.sPID)&&e.data.length>0?i("div",{staticClass:"ds-form-item ds-flowprocess mobile work_flow-process"},[i("div",{staticClass:"content"},e._l(e.data,(function(t){return i("div",{key:t.linkid,staticClass:"item",class:{"no-user":!t.rusername,unusual:"-4"==t.STATUS,noyj:!t.opinionatts||t.opinionatts&&!t.opinionatts.Content&&!t.opinionatts.Attachments}},[i("van-image",{attrs:{round:"",width:"40px",height:"40px",fit:"cover",src:"/oua2/getUserPhoto?type=relativePath&userId="+t.ruserid},scopedSlots:e._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[i("img",{staticClass:"header",attrs:{src:s(398)}})]},proxy:!0}],null,!0)}),i("van-image",{staticClass:"icon",attrs:{round:"",fit:"cover",src:e.getStateImg(t)}}),i("div",{staticClass:"des"},[i("p",{staticClass:"first-child"},[i("span",{staticClass:"title"},[e._v(e._s(t.nodename))]),i("span",{staticClass:"time"},[e._v(e._s(e.format(t.receivetime)))])]),t.rusername?i("p",[t.signTypeValue&&"0"!=t.signTypeValue?i("DsfMobileImage",{staticClass:"sign-user",attrs:{src:e._f("imgFormat")(t.signFilePath)},scopedSlots:e._u([{key:"error",fn:function(){return[i("span")]},proxy:!0}],null,!0)}):i("span",{staticClass:"name"},[e._v(" "+e._s(t.rusername)+" ")]),e.showResult&&"299"!==t.nodetype?i("span",{staticClass:"result"},[e._v(" ("+e._s(e.getResults(t))+") ")]):e._e()],1):e._e(),e.showOpinion&&e.showOpinion(t)?i("p",{staticClass:"yj"},[e._v(" "+e._s(t.opinionatts&&t.opinionatts.Content||e.processingOpinion)+" ")]):e._e(),i("p",{staticClass:"files"},[e.showFileList(t)?i("DsfMobileFlowFileList",{attrs:{Attachments:t.opinionatts.Attachments}}):e._e()],1),t.ccUsers?i("div",{staticClass:"cc-users"},[i("p",{staticClass:"cc-title"},[e._v(e._s(t.ccUsers[0].lineName)+"："+e._s(t.ccUsersCount)+"人")]),i("div",{staticClass:"cc"},[e._l(t.ccUsers,(function(t,n){return[n<4?i("div",{key:t.userId,staticClass:"cc-name",class:{"is-read":"0"!=t.status}},[i("div",{staticClass:"img"},[i("van-image",{attrs:{round:"",width:"100%",height:"100%",fit:"cover",src:"/oua2/getUserPhoto?type=relativePath&userId="+t.userId},scopedSlots:e._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[i("img",{staticClass:"header",attrs:{src:s(415)}})]},proxy:!0}],null,!0)})],1),i("p",[e._v(" "+e._s(t.userName))])]):e._e()]})),t.ccUsers.length>4?i("div",{staticClass:"cc-name more",on:{click:function(s){return e.moreCC(t)}}},[i("div",{staticClass:"img"},[e._v("...")]),i("p",{staticClass:"more"},[e._v("更多")])]):e._e()],2)]):e._e()])],1)})),0)]):e._e()])},n=[],a=s(607),o=dsf.component({name:"DsfMobileFlowProcess",mixins:[$mixins.control],ctrlCaption:"办理情况",components:{DsfMobileFlowFileList:a["a"]},props:{caption:{type:String,default:function(){return"wfprocess"}},orderDes:{type:Boolean,default:function(){return!1}},showResult:{type:Boolean,default:function(){return!1}},processingOpinion:{type:String,default:function(){return"无数据"}},results:{type:Object,default:function(){return{"-9":"提交","-8":"提交",0:"审核通过",1:"审核通过","-1":"不通过","-2":"返回修改"}}},getResults:{type:Function,default:function(e){return this.results[e.EXSTATUS]}},showOpinion:{type:Function,default:function(e){var t,s;return!e||0!==e.STATUS&&1!==e.STATUS?e&&(2===e.STATUS||-4===e.STATUS)&&"201"!==e.nodetype&&"299"!==e.nodetype:e.isCurrentUser&&((null===e||void 0===e||null===(t=e.opinionatts)||void 0===t?void 0:t.Content)||(null===e||void 0===e||null===(s=e.opinionatts)||void 0===s||null===(s=s.Attachments)||void 0===s?void 0:s.length)>0)}}},data:function(){return{sPID:this.$route.query.sPID,sCurLinkID:this.$route.query.sCurLinkID}},computed:{data:function(){var e,t=[];return!this.isDesign&&this.sPID||(t=[{nodename:"开始",EXSTATUS:-9,STATUS:0,linkid:"faedda583f7742948b0714f0f17d1085",opinionatts:JSON.stringify({Content:"同意"}),ruserid:"",pid:"af60e455757d48dd801d07b1538eb806",rusername:"平台管理员",rdeptname:"平台管理组",reachtime:"2020年01月06日 18:20:21",receivetime:"2020年01月06日 18:20:21"},{nodename:"审批",EXSTATUS:0,STATUS:1,linkid:"saedda583f7742948b0714f0f17d108c",opinionatts:JSON.stringify({Content:"同意"}),ruserid:"",pid:"sf60e455757d48dd801d07b1538eb806",rusername:"平台管理员",rdeptname:"平台管理组",reachtime:"2020年01月08日 18:21:25",receivetime:"2020年01月08日 18:22:30"},{nodename:"审批",EXSTATUS:-1,STATUS:-4,linkid:"saedda583f7742948b0714f0f17d1085",opinionatts:JSON.stringify({Content:"不同意"}),ruserid:"",pid:"sf60e455757d48dd801d07b1538eb806",rusername:"平台管理员",rdeptname:"平台管理组",reachtime:"2020年01月08日 18:21:25",receivetime:"2020年01月08日 18:22:30"},{nodename:"结束",nodetype:"299",EXSTATUS:2,STATUS:1,linkid:"caedda583f7742948b0714f0f17d1085",opinionatts:JSON.stringify({Content:""}),ruserid:"",pid:"cf60e455757d48dd801d07b1538eb806",rusername:"平台管理员",rdeptname:"平台管理组",reachtime:"2020年01月09日 18:23:21",receivetime:"2020年01月09日 20:23:21"}]),null!==(e=this.$vm)&&void 0!==e&&null!==(e=e.flows)&&void 0!==e&&e.flowProcess&&(t=_.cloneDeep(this.$vm.flows.flowProcess)),this.formatData(t)}},mounted:function(){var e=this.$dialog&&this.$dialog.dialogArgs&&this.$dialog.dialogArgs.data&&this.$dialog.dialogArgs.data[0]||null;this.sPID=e?e.sPID:this.$route.query.sPID||this.queryString.sPID,this.sCurLinkID=e?e.sCurLinkID:this.$route.query.sCurLinkID||this.queryString.sCurLinkID,this.sPID&&this.init()},methods:{init:function(){var e=this;this.$http.get("wfr/getProcessInfoByPID",{sPID:this.sPID}).then((function(t){var s,i;t.data.success&&(null!==(s=e.$vm)&&void 0!==s&&s.flows&&e.$set(e.$vm.flows,"flowProcess",t.data.data),t.data.data.forEach((function(t){t.linkid===e.sCurLinkID&&t.pid===e.sPID&&0!=t.STATUS&&1!=t.STATUS&&(i=dsf.mix({},e.$route.query,{isHide:!0}))})),i&&e.$router.replace({path:e.$route.path,query:i}))}))},moreCC:function(e){dsf.layer.openDialog({hasHeader:!1,title:"抄送人列表",height:"100vh",params:{path:"dsfa/flow/basic/mobile-ccuserlist?sPID=".concat(this.sPID,"&sCurLinkID=").concat(e.linkid)},btns:[{text:"确定"}]})},getStateImg:function(e){var t=e.STATUS;return"-31"==t?t="-3":"-1"==t&&(t="-2"),t||0===t?s(433)("./status".concat(t,".png")):null},showFileList:function(e){var t;return this.showOpinion(e)&&(null===(t=e.opinionatts)||void 0===t||null===(t=t.Attachments)||void 0===t?void 0:t.length)>0},format:function(e){return e?dsf.date.format(e,"mm-dd hh:ii"):""},formatData:function(e){var t=[];return e.forEach((function(e){e.opinionatts=JSON.parse(e.opinionatts),t.push(e)})),this.orderDes?t.reverse():t}}}),r=o,l=s(0),c=Object(l["a"])(r,i,n,!1,null,null,null);t["default"]=c.exports},1230:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isDesign||e.sPID&&e.sCurLinkID&&!e.queryString.isHide?s("div",{staticClass:"ds-control ds-form-item ds-textbox mobile dispose-idea",class:e.getCss},[s("div",{staticClass:"txt"},[s("van-field",{attrs:{placeholder:e.placeholder,type:e.isTextarea?"textarea":"text",rows:e.textareaRows,readonly:e.readOnly,required:e.required,disabled:e.disabled,"input-align":e.inputAlign,"error-message":e.errorsMsg,"error-message-align":e.inputAlign,"label-width":e.getLabelWidth(!0),label:e.showLabel&&e.label?e.label:""},model:{value:e.sOpinion.Content,callback:function(t){e.$set(e.sOpinion,"Content",t)},expression:"sOpinion.Content"}})],1),e.options.length>0?s("div",{staticClass:"template"},[s("div",e._l(e.options,(function(t,i){return s("span",{key:i,on:{click:function(s){e.sOpinion.Content=t.key_word}}},[e._v(e._s(t.key_word))])})),0)]):e._e(),e.visibleUpBtn||e.visibleUpImgBtn?s("div",{staticClass:"funs"},[e.visibleUpBtn?s("i",{staticClass:"iconfont icon-fujian",on:{click:function(t){return e.uploader(0)}}}):e._e(),e.visibleUpImgBtn?s("i",{staticClass:"iconfont icon-tupian",on:{click:function(t){return e.uploader(1)}}}):e._e()]):e._e(),s("van-uploader",{ref:"uploader",class:{no:0==e.sOpinion.Attachments.length},attrs:{"max-count":9,multiple:"","after-read":e.uploaderAfterRead,accept:e.acceptsType,capture:e.dsf.client.android()?"camera":null},on:{"click-preview":e.preview,delete:e.deleteFile},scopedSlots:e._u([{key:"preview-cover",fn:function(t){return[s("div",{staticClass:"preview-row"},[s("img",{class:t.isImage?"preview-img":"preview-icon",attrs:{src:t.isImage?t.url:e.$fileSuffixIcon(t)}}),t.isImage?e._e():s("div",{staticClass:"preview-cover"},[s("p",{staticClass:"van-ellipsis"},[e._v(e._s(t.originalFileName))])])])]}}],null,!1,2417831610),model:{value:e.sOpinion.Attachments,callback:function(t){e.$set(e.sOpinion,"Attachments",t)},expression:"sOpinion.Attachments"}})],1):e._e()},n=[],a=dsf.component({name:"DsfMobileDisposeIdea",ctrlCaption:"处理意见",mixins:[$mixins.formControl,$mixins.disposeIdea],data:function(){return{acceptTypes:[".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/*"],acceptsType:""}},methods:{uploader:function(e){var t=this;this.acceptsType=this.acceptTypes[e],this.$nextTick((function(){t.$refs.uploader.chooseFile()}))},uploaderAfterRead:function(e){var t=this;e.length||(e=[e]),_.forEach(e,(function(e){e.status="uploading",e.message="上传中...",t.$http.upload("file/upload",{file:e.file},!0).done((function(s){if(s.success&&2e4==s.state){e.status="done";var i=s.data[0];t.isImage(s.data[0])&&(i.url=dsf.url.getWebPath(i.relativePath),i.isImage=!0),t.sOpinion.Attachments.push(i),t.sOpinion.Attachments=t.sOpinion.Attachments.filter((function(e){return e.id}))}else 20104==s.state&&t.handleError(s,e)})).error((function(s){t.handleError(s,e)}))}))},isImage:function(e){return"jpeg"===e.suffix||"jpg"===e.suffix||"png"===e.suffix||"gif"===e.suffix},handleError:function(e,t){t.status="failed",t.message=e.message;var s=JSON.parse(JSON.stringify(e));"404"==s.status?dsf.layer.message("服务器异常",!1):dsf.layer.message(t.file.name+" "+s.message,!1)},preview:function(e){if(!this.isImage(e)){var t=dsf.url.getWebPath("preview/file"),s=dsf.config.setting_public_file_host,i=e.relativePath;this.filePath="".concat(t,"?url=").concat(s).concat(i),this.$openDialog({title:e.originalFileName||e.name,template:"<iframe :src=\"'".concat(this.filePath,'\'" width="100%" height="100%" frameborder="0"></iframe>'),height:"100vh",width:"100vw",position:"right"})}},deleteFile:function(e){this.sOpinion.Attachments.splice(this.sOpinion.Attachments.indexOf(e.data),1)}}}),o=a,r=s(0),l=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=l.exports},1231:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"choose-send-node mobile"},[e.hideHeader?e._e():s("header",{staticClass:"header"},[s("span",[e._v(e._s(e.title))]),s("span",{staticClass:"cancel",on:{click:e.close}},[e._v("取消")])]),s("van-list",e._l(e.lines,(function(t){return s("van-cell",{key:t.LineID,attrs:{title:"next"===e.type?t.Name:t.NodeName+"-"+t.LinkUser.RUserName},on:{click:function(s){return e.chooseLine(t)}}})})),1),e.showBack?s("footer",{staticClass:"footer"},[s("DsfMobileButton",{staticClass:"ds-button-bar-item",attrs:{title:"返回"},on:{click:e.back}},[e._v(" 返回 ")])],1):e._e()],1)},n=[],a=s(4),o=s.n(a),r=s(1),l=s.n(r),c=dsf.component({name:"DsfMobileChooseSendNode",props:{requestID:{type:String,default:function(){return""}},title:{type:String,default:function(){return""}},lines:{type:Array,default:function(){return[]}},chooseNode:{type:Function,default:null},callback:{type:Function,default:dsf.noop},showBack:{type:Boolean,default:!1},type:{type:String,default:function(){return"next"}},hideHeader:{type:Boolean,default:!1},back:{type:Function,default:dsf.noop}},data:function(){return{}},created:function(){},mounted:function(){},methods:{yes:function(){return this.$refs.picker.getValues()[0]},validate:function(){return!!this.$refs.picker.getValues()[0]||(dsf.layer.message("请选择要发送的环节",!1),!1)},chooseLine:function(e){var t=this;return o()(l.a.mark((function s(){var i,n,a,o;return l.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!t.chooseNode){s.next=6;break}return s.next=3,t.chooseNode(e);case 3:s.t0=s.sent,s.next=7;break;case 6:s.t0=!0;case 7:if(n=s.t0,n){s.next=10;break}return s.abrupt("return");case 10:"next"===t.type?(t.checked=e,a={sRequestID:t.requestID,sLineID:e.LineID},o=t.isBatch?"wfr/batchSendToLine":"wfr/sendToLine",t.$http.post(o,a).then((function(s){2e4==s.data.state&&t.callback(s,!0,e)}))):t.callback([e.PID,dsf.url.queryString("sCurLinkID")],e.ID),null===(i=document.querySelector(".close-send-node"))||void 0===i||i.click();case 12:case"end":return s.stop()}}),s)})))()},close:function(){this.$parent.close()}}}),u=c,d=s(0),f=Object(d["a"])(u,i,n,!1,null,null,null);t["default"]=f.exports},1232:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isDesign||e.sPID&&e.sCurLinkID?i("div",{staticClass:"ds-control ds-form-item ds-textbox",class:e.getCss},[e.showLabel?i("p",{staticClass:"van-cell"},[e._v(e._s(e.label))]):e._e(),e.data&&e.data.length>0?i("van-field",{attrs:{type:"text","input-align":"right"},scopedSlots:e._u([{key:"input",fn:function(){return e._l(e.data,(function(t,n){return i("div",{key:n,staticClass:"form-comment-box-value"},[i("p",{staticClass:"content"},[e._v(e._s(t.opinionatts&&t.opinionatts.Content))]),t.opinionatts&&t.opinionatts.Attachments&&t.opinionatts.Attachments.length>0?i("DsfMobileFlowFileList",{attrs:{Attachments:t.opinionatts.Attachments}}):e._e(),i("img",{staticClass:"icon",attrs:{src:s(443)}}),i("span",{staticClass:"name"},[e._v(e._s(t.rusername))]),i("span",{staticClass:"time"},[e._v(e._s(t.receivetime))])],1)}))},proxy:!0}],null,!1,1815162502)}):e._e(),e.isShowAdd?i("p",{staticClass:"van-cell"},[i("DsfMobileButton",{staticStyle:{width:"100%"},attrs:{size:"small"},on:{click:e.addComment}},[e._v(e._s(e.addCommentText))])],1):e._e()],1):e._e()},n=[],a=s(607),o=dsf.component({name:"DsfMobileFormCommentBox",mixins:[$mixins.formControl,$mixins.formCommentBox],ctrlCaption:"表单意见框",components:{DsfMobileFlowFileList:a["a"]}}),r=o,l=s(0),c=Object(l["a"])(r,i,n,!1,null,null,null);t["default"]=c.exports},1233:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"work_flow-usersDialog"},[i("div",{staticClass:"content",class:{isFristSend:0==e.RequiredOpinion||1==e.RequiredOpinion,"no-staffs":0==e.staffs.length}},[0==e.RequiredOpinion||1==e.RequiredOpinion?[i("div",{staticClass:"txt"},[i("van-field",{attrs:{rows:"2",autosize:"",type:"textarea",placeholder:"请输入审批意见"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),e.tpls.length>0?i("div",{staticClass:"template"},[i("div",e._l(e.tpls,(function(t,s){return i("span",{key:s,on:{click:function(s){e.message=t.key_word}}},[e._v(e._s(t.key_word))])})),0)]):e._e(),i("div",{staticClass:"funs"},[i("i",{staticClass:"iconfont icon-fujian",on:{click:function(t){return e.uploader(0)}}}),i("i",{staticClass:"iconfont icon-tupian",on:{click:function(t){return e.uploader(1)}}})]),i("van-uploader",{ref:"uploader",class:{no:0==e.uploaderData.length},attrs:{"max-count":9,multiple:"","after-read":e.uploaderAfterRead,accept:e.acceptsType,capture:e.dsf.client.android()?"camera":null},on:{"click-preview":e.preview},scopedSlots:e._u([{key:"preview-cover",fn:function(t){return[i("div",{staticClass:"preview-row"},[i("img",{class:t.isImage?"preview-img":"preview-icon",attrs:{src:t.isImage?t.url:e.$fileSuffixIcon(t)}}),t.isImage?e._e():i("div",{staticClass:"preview-cover"},[i("p",{staticClass:"van-ellipsis"},[e._v(e._s(t.originalFileName))])])])]}}],null,!1,2417831610),model:{value:e.uploaderData,callback:function(t){e.uploaderData=t},expression:"uploaderData"}}),i("van-popup",{style:{height:"80%",width:"100%"},model:{value:e.previewing,callback:function(t){e.previewing=t},expression:"previewing"}},[e.previewing?i("iframe",{style:{height:"100%",width:"100%"},attrs:{src:e.filePath}}):e._e()])]:e._e(),i("div",{staticClass:"users"},[i("p",[e._v("您即将发给：")]),e._l(e.data,(function(t){return i("div",{key:t.id,staticClass:"dept",class:{noSeletc:!Object.keys(t.selectDepts).length}},[i("div",{staticClass:"desc"},[i("div",{staticClass:"title"},[e._v(e._s(t.Name))]),t.isRole?e._e():i("div",{staticClass:"num"},[e._v(e._s(t.selectDepts.length||0)+"人审核")])]),i("div",{staticClass:"imgs"},[t.selectDepts&&t.selectDepts.length<=2?e._l(t.selectDepts,(function(n){return i("div",{key:n.ID,class:{noSeletc:!1}},[t.isRole?i("div",{staticClass:"is-role"},[i("i",{staticClass:"iconfont icon-nav-add-xjhy"})]):i("van-image",{attrs:{round:"",width:"40px",height:"40px",fit:"cover",src:"/oua2/getUserPhoto?type=relativePath&userId="+n.ID},scopedSlots:e._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[i("img",{staticClass:"header",attrs:{src:s(415)}})]},proxy:!0}],null,!0)}),i("p",{staticClass:"name"},[e._v(e._s(n._name))])],1)})):e._e(),t.selectDepts&&t.selectDepts.length>2?i("div",{staticClass:"all-users"},[i("div",{staticClass:"circle"},[e._l(t.selectDepts,(function(t,n){return[n<4?i("van-image",{key:t.ID,attrs:{width:"20",height:"20",fit:"cover",src:"/oua2/getUserPhoto?type=relativePath&userId="+t.ID},scopedSlots:e._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[i("img",{staticClass:"error-header",attrs:{width:"20",height:"20",src:s(415)}})]},proxy:!0}],null,!0)}):e._e()]}))],2),i("p",[e._v(e._s(t.selectDepts[0]._name)+"等"+e._s(t.selectDepts.length)+"人")])]):e._e(),i("div",{staticClass:"add",on:{click:function(s){return e.showPicker(t)}}},[i("i",{staticClass:"iconfont icon-hao"})])],2)])}))],2)],2),e.staffs.length>0?i("div",{staticClass:"regular-staff"},[i("p",{staticClass:"title"},[e._v("常用人员：")]),i("div",{staticClass:"staffs"},e._l(e.staffs,(function(t){return i("div",{key:t.userid,staticClass:"staff",on:{click:function(s){return e.selectStaff(t)}}},[i("van-image",{staticClass:"img",attrs:{round:"",width:"40px",height:"40px",fit:"cover",src:"/oua2/getUserPhoto?type=relativePath&userId="+t.userid},scopedSlots:e._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[i("img",{staticClass:"header",attrs:{src:s(415)}})]},proxy:!0}],null,!0)}),i("p",{staticClass:"name"},[e._v(e._s(t.userName))])],1)})),0)]):e._e()])},n=[],a=s(2),o=s.n(a),r=s(4),l=s.n(r),c=s(1),u=s.n(c),d={name:"DsfMobileChooseUsers",props:{lines:{type:Array,default:function(){return[]}},RequiredOpinion:{type:[String,Number],default:function(){return 0}}},data:function(){return{data:[],message:"",loader:null,tpls:[],isShowBack:!1,acceptTypes:[".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/*"],acceptsType:"",uploaderData:[],previewing:!1,filePath:"",staffs:[],ccLine:""}},created:function(){this.init(),this.getTemplate()},methods:{yes:function(){var e,t;return(this.message||(null===(e=this.uploaderData)||void 0===e?void 0:e.length)>0)&&(t={inputValue:this.message,multipleFiles:this.uploaderData}),{sReceivers:this.param.join(";"),disposeIdea:t}},validate:function(){var e,t=[],s=[],i=!1,n=!1,a=!1;this.data.forEach((function(e){var o,r;if(!e.Required||null!==e&&void 0!==e&&e.selectDepts&&0!==(null===e||void 0===e||null===(o=e.selectDepts)||void 0===o?void 0:o.length)||s.push(e.name),(null===e||void 0===e||null===(r=e.selectDepts)||void 0===r?void 0:r.length)>0){var l="".concat(e.LineID,":").concat(e.selectDepts.map((function(e){return e._id})).join());t.push(l),1!=e.ccLine&&(a=!0)}1==e.ccLine&&(i=!0),e.Selected&&1!=e.ccLine&&(n=!0)}));var o=null===(e=this.lines.filter((function(e){return e.sendEndNode})))||void 0===e?void 0:e[0];return null!==o&&void 0!==o&&o.sendEndNode&&(a=!0),!n&&i&&o&&t.push("".concat(o.LineID,":")),1!==this.RequiredOpinion||this.message||0!==this.uploaderData.length?s.length>0?(dsf.layer.message(s.join("，")+"为必选环节，请选择发送对象",!1),!1):a?(this.param=t,!0):(dsf.layer.message("请选择办理人",!1),!1):(dsf.layer.message("审批意见不能为空",!1),!1)},init:function(){var e=this;return l()(u.a.mark((function t(){var s;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e.lines.filter((function(t){return 1==t.ccLine&&(e.ccLine=t.LineID),t.Receivers})),!e.ccLine){t.next=5;break}return t.next=4,e.getStaffs();case 4:e.staffs=t.sent;case 5:s.forEach((function(t){var s;t.selectDepts=[],t.checked=[],null!==t&&void 0!==t&&null!==(s=t.Receivers)&&void 0!==s&&s.Dept&&(t.Receivers.Dept=e.getTreeData(t.Receivers.Dept,t))})),e.data=dsf.mix(!0,[],s);case 7:case"end":return t.stop()}}),t)})))()},getStaffs:function(){return this.$http.get("wfr/getUserNodeCcUserHistory",{lineId:this.ccLine,userSize:5}).done((function(e){return 2e4==e.state&&dsf.isArray(e.data)?e.data:[]}))},getTreeData:function(e,t){var s=this.format(e,null,t);return[s]},format:function(e,t,s){var i=this;e._name=e.Name,e._id=e.ID,e._type=e.Type,21!=e.Type&&22!=e.Type||(s.isRole=!0),1==s.ccLine&&this.staffs.length>0&&(e.isStaff=this.staffs.findIndex((function(t){return t.userId===e.sID}))>-1),s.MultiplayerEnabled?e._isDisabled=1!==e.Type&&2!==e.Type&&21!==e.Type:e._isDisabled=0==e.Type,t&&(e.deptName=t.Name,e.deptId=t.ID),2===(null===e||void 0===e?void 0:e.Selected)&&(e.required=!0);var n={};if(e.ChildDepts&&0===e.ChildDepts.length){var a=e.Objs&&e.Objs[0]||{};a.Objs||a.ChildDepts||2!==a.Type?(n.Name=e.Name,n.ID=e.ID,e.children=e.Objs,e.children.forEach((function(e){i.format(e,n,s)}))):(e._isDisabled=!1,e.ID=a.ID,e._id=a.ID,e._type=a.Type,e.deptName=e.Name,e.deptId=e.ID,e.Name=a.Name,e.Selected=a.Selected,e.sID=a.sID,e.required=2===a.Selected)}else if(e.ChildDepts){var r;if(n.Name=e.Name,n.ID=e.ID,e.children=e.ChildDepts,-1!=e.ID&&e.Objs)(r=e.children).push.apply(r,o()(e.Objs));e.children.forEach((function(e){i.format(e,n,s)}))}var l=s.MultiplayerEnabled;return l?e.Selected&&(s.checked.push(e.ID),s.selectDepts.push(e)):(1===(null===e||void 0===e?void 0:e.Selected)&&(s.selectDepts&&0===s.selectDepts.length||s.selectDepts&&2!==s.selectDepts[0].Selected)&&(s.checked=[e.ID],s.selectDepts=[e]),2===(null===e||void 0===e?void 0:e.Selected)&&(s.checked=[e.ID],s.selectDepts=[e])),e},selectStaff:function(e){var t=this;this.data.forEach((function(s){if(s.LineID==t.ccLine){var i="1_".concat(e.deptId,"_").concat(e.userId),n=s.selectDepts.findIndex((function(e){return e._id==i}));if(-1==n){var a={_id:i,_name:e.userName,sID:e.userId,deptId:e.deptId,deptName:e.deptName,_type:1};s.selectDepts.push(a)}}}))},getTemplate:function(){var e,t,s=this,i=dsf.layer.loading(),n="";this.$http.get("wfr/getOpinionKeyWord",{sPID:(null===(e=this.$route)||void 0===e||null===(e=e.query)||void 0===e?void 0:e.sPID)||(null===(t=this.queryString)||void 0===t?void 0:t.sPID)}).done((function(e){e.success?s.tpls=e.data||[]:n="获取意见模板，请求异常"})).error((function(e){n="获取意见模板，服务器异常"})).always((function(){dsf.layer.closeLoading(i),n&&dsf.layer.message(n,!1)}))},showPicker:function(e){var t=e.selectDepts.map((function(e){return{text:e._name,value:e._id,sID:e.sID,_id:e.sID,_type:e._type,deptName:e.deptName,deptId:e.deptId,required:e.required}}));dsf.layer.openDialog({title:"请选择",height:"100vh",hasHeader:!1,className:"choose-users",btnPosition:"bottom",params:{path:"dsfa/flow/basic/mobile-chooseusers",choiceParams:{value:t,maxTags:e.MultiplayerEnabled?0:1},line:e,staffs:this.staffs},btns:[{text:"确定",class:"cc-btn",handler:function(){var t=l()(u.a.mark((function t(s){var i,n;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=s.content,null===(i=n.validate)||void 0===i||!i.call(n)){t.next=6;break}return t.next=4,n.yes();case 4:return e.selectDepts=t.sent,t.abrupt("return",!0);case 6:return t.abrupt("return",!1);case 7:case"end":return t.stop()}}),t)})));function s(e){return t.apply(this,arguments)}return s}()}]})},uploader:function(e){var t=this;this.acceptsType=this.acceptTypes[e],this.$nextTick((function(){t.$refs.uploader.chooseFile()}))},isImage:function(e){return"jpeg"===e.suffix||"jpg"===e.suffix||"png"===e.suffix||"gif"===e.suffix},uploaderAfterRead:function(e){var t=this;e.length||(e=[e]),_.forEach(e,(function(e){e.status="uploading",e.message="上传中...",t.$http.upload("file/upload",{file:e.file},!0).done((function(s){if(s.success&&2e4==s.state){e.status="done";var i=s.data[0];t.isImage(i)&&(i.url=dsf.url.getWebPath(i.relativePath),i.isImage=!0),t.uploaderData.push(i),t.uploaderData=t.uploaderData.filter((function(e){return e.id}))}else 20104==s.state&&t.handleError(s,e)})).error((function(s){t.handleError(s,e)}))}))},handleError:function(e,t){t.status="failed",t.message=e.message;var s=JSON.parse(JSON.stringify(e));"404"==s.status?dsf.layer.message("服务器异常",!1):dsf.layer.message(t.file.name+" "+s.message,!1)},preview:function(e){if(!this.isImage(e)){var t=dsf.url.getWebPath("preview/file"),s=dsf.config.setting_public_file_host,i=e.relativePath;this.filePath="".concat(t,"?url=").concat(s).concat(i),this.$openDialog({title:e.originalFileName||e.name,template:"<iframe :src=\"'".concat(this.filePath,'\'" width="100%" height="100%" frameborder="0"></iframe>'),height:"100vh",width:"100vw",position:"right"})}}}},f=d,p=s(0),h=Object(p["a"])(f,i,n,!1,null,null,null);t["default"]=h.exports},1234:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"work_flow-usersDialog work_flow-re-choose-users"},[e.showSearch?i("van-search",{attrs:{placeholder:"请输入搜索关键字",shape:"round"},model:{value:e.searchStr,callback:function(t){e.searchStr=t},expression:"searchStr"}}):e._e(),i("div",{staticClass:"imgs"},e._l(e.realUsers,(function(t){return i("div",{key:t.ID,class:{noSeletc:!t.isSelect},on:{click:function(s){return e.changeUser(t)}}},[i("div",{staticClass:"avatar"},[i("van-image",{attrs:{round:"",width:"40px",height:"40px",fit:"cover",src:"/oua2/getUserPhoto?type=relativePath&userId="+t.ID},scopedSlots:e._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[i("img",{staticClass:"header",attrs:{src:s(398)}})]},proxy:!0}],null,!0)}),t.isSelect?i("van-icon",{attrs:{name:"checked"}}):e._e()],1),i("p",[e._v(e._s(t.Name))])])})),0)],1)},n=[],a={name:"DsfMobileReChooseUsers",props:{users:{type:Array,default:function(){return[]}},showSearch:{type:Boolean,default:!1},Multi:{type:Boolean,default:!1}},data:function(){return{searchStr:"",selected:[]}},computed:{realUsers:function(){var e=this;return this.users.filter((function(t){return t.Name.indexOf(e.searchStr)>-1}))}},methods:{yes:function(){return this.selected},validate:function(){return this.selected=this.users.filter((function(e){return e.isSelect})),0!=this.selected.length||(dsf.layer.message("请选择办理人",!1),!1)},changeUser:function(e){var t=this;this.Multi||this.users.forEach((function(e){t.$set(e,"isSelect",!1)})),this.$set(e,"isSelect",!e.isSelect)}}},o=a,r=s(0),l=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=l.exports},1235:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flow-mobile-add-comment"},[s("DsfMobileAddOpinion",{ref:"addOpinion",attrs:{sOpinion:e.sOpinion},on:{"update:sOpinion":function(t){e.sOpinion=t},"update:s-opinion":function(t){e.sOpinion=t}}}),s("div",{staticClass:"btns"},[s("span",{staticClass:"ds-button--icon-text addcomment-delete",on:{click:e.clearAll}},[s("i",{staticClass:"iconfont icon-delete"}),e._v(" 清 空")]),s("DsfMobileButton",{staticClass:"addcomment-sure",on:{click:e.sure}},[e._v("确 定")]),s("DsfMobileButton",{staticClass:"plain addcomment-cancel",on:{click:e.cancel}},[e._v("取 消")])],1)],1)},n=[],a={name:"DsfMobileFlowAddComment",inject:{$dialog:{default:null}},props:{$vm:{type:[Object,null],default:function(){return null}},flow:{type:[Object,null],default:function(){return null}}},data:function(){return{loaded:!1,tpls:[],sOpinion:{Content:"",Attachments:null}}},created:function(){this.initFlow()},methods:{yes:function(){return this.sOpinion},validate:function(){return!!this.sOpinion.Content||(dsf.layer.message("处理意见不能为空",!1),!1)},initFlow:function(){var e,t,s=this;null!==(e=this.$vm)&&void 0!==e&&null!==(e=e.flows)&&void 0!==e&&e.sOpinion&&(this.sOpinion=_.cloneDeep(this.$vm.flows.sOpinion)),null!==(t=this.flow)&&void 0!==t&&t.sOpinion&&(this.sOpinion=Object.assign(this.sOpinion,_.cloneDeep(this.flow.sOpinion))),this.$http.get("wfr/getOpinionKeyWord",{sPID:this.flow.sPID}).done((function(e){e.success&&(s.tpls=e.data||[]),s.loaded=!0}))},getValue:function(e){this.sOpinion.Attachments=JSON.parse(e.args)},upload:function(){this.$refs.uploadFile.openSelectFile()},clearAll:function(){this.sOpinion={Content:"",Attachments:[]},this.$refs.addOpinion.uploaderData=[]},sure:function(){var e=this;if(this.validate()){var t={sPID:this.flow.sPID,sCurLinkID:this.flow.sCurLinkID,sOpinion:JSON.stringify(this.sOpinion)};this.$http.get("wfr/opinion",t).done((function(t){if(t.success&&"24000"==t.data.Code){var s,i,n,a;if(null===(s=e.$vm.flows)||void 0===s||null===(s=s.flowProcess)||void 0===s||s.forEach((function(t){t.linkid===e.flow.sCurLinkID&&(t.opinionatts=JSON.stringify(_.clone(e.sOpinion)),t.rusername=dsf.session.get("user_name"),t.ruserid="")})),null!==(i=e.flow)&&void 0!==i&&i.sOpinion)null===(n=e.$vm)||void 0===n||n.reloadData();else null!==(a=e.$vm)&&void 0!==a&&a.flows&&(e.$vm.flows.sOpinion=e.sOpinion);e.$dialog.close()}else dsf.layer.message(t.data.message,!1)})).catch((function(e){dsf.layer.message("处理意见异常",!1)}))}},cancel:function(){this.$dialog.close()}}},o=a,r=s(0),l=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=l.exports},1236:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"work_flow-usersDialog"},[s("div",{staticClass:"content"},[[s("div",{staticClass:"txt"},[s("van-field",{attrs:{rows:"2",autosize:"",type:"textarea",maxlength:1e3,placeholder:"请输入审批意见"},model:{value:e.sOpinion.Content,callback:function(t){e.$set(e.sOpinion,"Content",t)},expression:"sOpinion.Content"}})],1),e.tpls.length>0?s("div",{staticClass:"template"},[s("div",e._l(e.tpls,(function(t,i){return s("span",{key:i,on:{click:function(s){e.sOpinion.Content=t.key_word}}},[e._v(e._s(t.key_word))])})),0)]):e._e(),s("div",{staticClass:"funs"},[s("i",{staticClass:"iconfont icon-fujian",on:{click:function(t){return e.uploader(0)}}}),s("i",{staticClass:"iconfont icon-tupian",on:{click:function(t){return e.uploader(1)}}})]),s("van-uploader",{ref:"uploader",class:{no:0==e.uploaderData.length},attrs:{"max-count":9,multiple:"","after-read":e.uploaderAfterRead,accept:e.acceptsType,capture:e.dsf.client.android()?"camera":null},on:{"click-preview":e.preview},scopedSlots:e._u([{key:"preview-cover",fn:function(t){return[s("div",{staticClass:"preview-row"},[s("img",{class:t.isImage?"preview-img":"preview-icon",attrs:{src:t.isImage?t.url:e.$fileSuffixIcon(t)}}),t.isImage?e._e():s("div",{staticClass:"preview-cover"},[s("p",{staticClass:"van-ellipsis"},[e._v(e._s(t.originalFileName))])])])]}}]),model:{value:e.uploaderData,callback:function(t){e.uploaderData=t},expression:"uploaderData"}})]],2)])},n=[],a={name:"DsfMobileAddOpinion",props:{sOpinion:{type:Object,default:function(){return{Content:"",Attachments:[]}}}},data:function(){return{message:"",loader:null,tpls:[],acceptTypes:[".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/*"],acceptsType:"",uploaderData:[],previewing:!1,filePath:""}},created:function(){this.init(),this.getTemplate()},methods:{init:function(){var e,t;null!==(e=this.sOpinion)&&void 0!==e&&e.Attachments&&(this.uploaderData=null===(t=this.sOpinion)||void 0===t?void 0:t.Attachments.map((function(e){return e.url=dsf.url.getWebPath(e.relativePath),e})))},getLinkName:function(e){var t=e.split("→");return t[t.length-1]},getUserData:function(e,t,s){if(e)for(var i in e.Objs&&(e.ChildDepts=e.ChildDepts.concat(e.Objs)),0!=e.Type&&(1*e.Selected>0&&(this.data[s]["selects"].push(e),this.data[s]["sNum"]++,e.isSelect=!0),e["index"]=this.data[s]["users"].length,this.data[s]["users"].push(e)),e.ChildDepts)this.getUserData(e.ChildDepts[i],e,s)},getTemplate:function(){var e,t,s=this,i=dsf.layer.loading(),n="";this.$http.get("wfr/getOpinionKeyWord",{sPID:(null===(e=this.$route)||void 0===e||null===(e=e.query)||void 0===e?void 0:e.sPID)||(null===(t=this.queryString)||void 0===t?void 0:t.sPID)}).done((function(e){e.success?s.tpls=e.data||[]:n="获取意见模板，请求异常"})).error((function(e){n="获取意见模板，服务器异常"})).always((function(){dsf.layer.closeLoading(i),n&&dsf.layer.toast(n,!1)}))},uploader:function(e){var t=this;this.acceptsType=this.acceptTypes[e],this.$nextTick((function(){t.$refs.uploader.chooseFile()}))},isImage:function(e){return"jpeg"===e.suffix||"jpg"===e.suffix||"png"===e.suffix||"gif"===e.suffix},uploaderAfterRead:function(e){var t=this;e.length||(e=[e]),_.forEach(e,(function(s,i){s.status="uploading",s.message="上传中...",t.$http.upload("file/upload",{file:s.file},!0).done((function(e){if("20000"==e.state){s.status="done";var i=e.data[0];t.isImage(i)&&(i.url=dsf.url.getWebPath(i.relativePath),i.isImage=!0),t.uploaderData.push(i),t.uploaderData=t.uploaderData.filter((function(e){return e.id}))}else 20104==e.state&&t.handleError(e,s)})).error((function(e){t.handleError(err,s)})).always((function(){i+1===e.length&&(t.sOpinion.Attachments=t.uploaderData.map((function(e){return e.data||e})),t.$emit("update:sOpinion",t.sOpinion))}))}))},handleError:function(e,t){t.status="failed",t.message=e.message;var s=JSON.parse(JSON.stringify(e));"404"==s.status?dsf.layer.message("服务器异常",!1):dsf.layer.message(t.file.name+" "+s.message,!1)},preview:function(e){if(e&&e.data&&e.data.contentType&&"image"!==e.data.contentType.slice(0,5)){var t=dsf.url.getWebPath("preview/file"),s=dsf.config.setting_public_file_host,i=e.data.relativePath;this.filePath="".concat(t,"?url=").concat(s).concat(i),this.previewing=!0}}}},o=a,r=s(0),l=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=l.exports},398:function(e,t,s){e.exports=s.p+"modules/platform/img/default-header.png"},403:function(e,t,s){e.exports=s.p+"modules/platform/img/status-2.png"},404:function(e,t,s){e.exports=s.p+"modules/platform/img/status-3.png"},405:function(e,t,s){e.exports=s.p+"modules/platform/img/status-4.png"},406:function(e,t,s){e.exports=s.p+"modules/platform/img/status0.png"},407:function(e,t,s){e.exports=s.p+"modules/platform/img/status1.png"},408:function(e,t,s){e.exports=s.p+"modules/platform/img/status2.png"},415:function(e,t,s){e.exports=s.p+"modules/platform/img/defaultHeader.png"},433:function(e,t,s){var i={"./status-2.png":403,"./status-3.png":404,"./status-4.png":405,"./status0.png":406,"./status1.png":407,"./status2.png":408};function n(e){var t=a(e);return s(t)}function a(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=a,e.exports=n,n.id=433},443:function(e,t,s){e.exports=s.p+"modules/platform/img/ry1.png"},607:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flow-mobile-file-list"},[s("van-uploader",{ref:"uploader",class:{no:0==e.files.length},attrs:{accept:e.acceptsType,capture:e.dsf.client.android()?"camera":null},on:{"click-preview":e.preview},scopedSlots:e._u([{key:"preview-cover",fn:function(t){return[s("div",{staticClass:"preview-row"},[s("img",{class:t.isImage?"preview-img":"preview-icon",attrs:{src:t.isImage?t.url:e.$fileSuffixIcon(t)}}),t.isImage?e._e():s("div",{staticClass:"preview-cover"},[s("p",{staticClass:"van-ellipsis"},[e._v(e._s(t.originalFileName))])])])]}}]),model:{value:e.files,callback:function(t){e.files=t},expression:"files"}})],1)},n=[],a={name:"DsfMobileFlowFileList",props:{Attachments:{type:Array,default:function(){return[]}}},data:function(){return{files:[],acceptsType:""}},watch:{Attachments:{handler:function(e){var t=this;this.files=e.map((function(e){return t.isImage(e)&&(e.url=dsf.url.getWebPath(e.relativePath),e.isImage=!0),e}))},immediate:!0}},created:function(){},mounted:function(){},methods:{isImage:function(e){return"jpeg"===e.suffix||"jpg"===e.suffix||"png"===e.suffix||"gif"===e.suffix},preview:function(e){if(!this.isImage(e)){var t=dsf.url.getWebPath("preview/file"),s=dsf.config.setting_public_file_host,i=e.relativePath;this.filePath="".concat(t,"?url=").concat(s).concat(i),this.$openDialog({title:e.originalFileName||e.name,template:"<iframe :src=\"'".concat(this.filePath,'\'" width="100%" height="100%" frameborder="0"></iframe>'),height:"100vh",width:"100vw",position:"right"})}}}},o=a,r=s(0),l=Object(r["a"])(o,i,n,!1,null,null,null);t["a"]=l.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_mobile_flow.js.map