/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[70],{1097:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.vLoading,expression:"vLoading"}],staticClass:"ds-control ds-tree",attrs:{"element-loading-text":"加载中..."}},[e.canInitTreeDom?[!e.filterText||+e.slotData.searchIsAsync&&e.needRenderSearchTree?e._e():a("DsfVirtualTree",e._b({ref:"tree2",staticClass:"filter-tree",class:["showCheckBox"+e.showCheckBox],attrs:{"empty-text":e.searchLoading?"":"暂无匹配数据",props:e.searchDefaultProps,"default-expand-all":!+e.slotData.searchIsAsync,"check-on-click-node":"expand"!==e.slotData.clickTextFun,"show-checkbox":"0"!=e.showCheckBox,"check-strictly":1==parseInt(e.maxNum)||"1"!=e.slotData.chooseOneNode,"expand-on-click-node":"expand"===e.slotData.clickTextFun,"node-key":e.nodeKey,"render-after-expand":!1},on:{check:e.checkSearch,"check-change":e.checkSearchChange,loadDataSuccess:e.loadDataSuccess},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data,i=t.node;return a("span",{staticClass:"el-tree-node__label",class:{is_disabled:e.isDisabledFn(n),is_excluded:e.isExcludedFn(n)},attrs:{nodeKey:n[e.nodeKey]}},[n.isBtn?a("el-button",{attrs:{type:"text",loading:n.loading}},[e._v(" "+e._s(n._name)+" ")]):[e._t("nodeLable",(function(){return[a("span",{domProps:{innerHTML:e._s(e.dsf.safe.xss(n._name))}})]}),{data:n,node:i})]],2)}}],null,!1,3227207902)},"DsfVirtualTree",e.searchTreeData,!1)),a("DsfVirtualTree",e._b({directives:[{name:"show",rawName:"v-show",value:!e.filterText||""==e.filterText,expression:"!filterText || filterText == ''"}],ref:"tree",class:["showCheckBox"+e.showCheckBox],attrs:{"empty-text":"1"===e.loading?"":"2"===e.loading?e.filterText?"暂无匹配数据":"暂无数据":"",props:e.defaultProps,"default-expand-all":!!e.$treeBox.isDesign,"check-on-click-node":"expand"!==e.slotData.clickTextFun,"default-expanded-keys":e.expandedKeys,"highlight-current":"0"==e.showCheckBox,"filter-node-method":e.filterNode,"show-checkbox":"0"!=e.showCheckBox,"check-strictly":1==parseInt(e.maxNum)||"1"!=e.slotData.chooseOneNode,"expand-on-click-node":"expand"===e.slotData.clickTextFun,"node-key":e.nodeKey,"render-after-expand":!1},on:{check:e.check,"node-click":e.nodeClick,"check-change":e.checkChange,loadDataSuccess:e.loadDataSuccess},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data,i=t.node;return a("span",{staticClass:"el-tree-node__label",class:{is_disabled:e.isDisabledFn(n),is_excluded:e.isExcludedFn(n)},attrs:{nodeKey:n[e.nodeKey]}},[n.isBtn?a("el-button",{attrs:{type:"text",loading:n.loading}},[e._v(" "+e._s(n._name)+" ")]):[e._t("nodeLable",(function(){return[a("span",{domProps:{innerHTML:e._s(e.dsf.safe.xss(n._name))}})]}),{data:n,node:i})]],2)}}],null,!1,3227207902)},"DsfVirtualTree",e.treeData,!1))]:e._e()],2)},i=[],s=a(2),o=a.n(s),l=a(3),r=a.n(l),d=dsf.component({name:"DsfTree",ctrlCaption:"树",mixins:[$mixins.control],props:{slotData:{type:Object,default:function(){return{}}},tabIndex:{type:[Number,String],default:0}},inject:{$treeBox:{default:null}},data:function(){var e,t;return this.searchCheckedNodes=[],this.getChildAllCodes=[],{filterText:"",defaultProps:{label:"_name",children:"children",disabled:this.setNodeDisable,isLeaf:"isLeaf",customClass:this.setNodeClass},data:[],loading:0,resolve:null,sqlUrls:[{user:"oua/getUserByCurDept",dept:"oua/getDeptByCurDept",userSearch:"oua/searchUserByCurDept",deptSearch:"oua/searchDeptByCurDept"},{user:"oua/getUserByCurUnit",dept:"oua/getDeptByCurUnit",userSearch:"oua/searchUserByCurUnit",deptSearch:"oua/searchDeptByCurUnit"},{user:"oua/getUserByOrg",dept:"oua/getDeptByOrg",userSearch:"oua/searchUserByOrg",deptSearch:"oua/searchDeptByOrg"}],_sqlUrl:this.sqlUrls,params:{},async:!1,asyncSql:"",expandedKeys:[],searchSqlUrlReal:null,searchData:[],searchLoading:!1,searchDefaultProps:{label:"_name",children:"children",disabled:this.setNodeDisableSearch,isLeaf:"isLeaf",customClass:this.setNodeClass},pageNumObj:{},_paginationSql:"",needRenderSearchTree:!1,maxNum:(null===(e=this.$treeBox)||void 0===e||null===(t=e.getMaxLength)||void 0===t?void 0:t.call(e))||0,canInitTreeDom:!1,vLoading:!1}},watch:{filterText:function(e,t){var a=this;e!=t&&(this.needRenderSearchTree=!0),this.$nextTick((function(){a.filter(e)}))}},computed:{nodeKey:function(){return this.slotData.nodeKey||"_id"},rightIstree:function(){var e;return"tree"===(null===(e=this.$treeBox)||void 0===e?void 0:e.typeStyle)},showCheckBox:function(){var e;return 1==(null===(e=this.$treeBox)||void 0===e||null===(e=e.slots)||void 0===e?void 0:e.length)&&this.rightIstree?"0":this.slotData.showCheckBox},treeData:function(){var e={};return this.async&&!this.$treeBox.isDesign?(e.lazy=!0,e.load=this.lazyLoad):e.data=this.data,e},searchTreeData:function(){var e={};return this.async&&!this.$treeBox.isDesign&&+this.slotData.searchIsAsync?(e.lazy=!0,e.load=this.searchLazyLoad):e.data=this.searchData,e},canChooseRoot:function(){var e=this.slotData,t=e.async,a=e.metaDataType,n=e.chooseOneNode,i=e.orgAsync;return+a>1&&"0"!=n?(4!=+a||"0"!=i)&&(!dsf.isUnDef(this.slotData.canChooseRoot)&&+this.slotData.canChooseRoot):"0"==n||!+t||(!!dsf.isUnDef(this.slotData.canChooseRoot)||+this.slotData.canChooseRoot)},needExpand:function(){var e=this.slotData.defaultOpenSeries;return 0!==e&&"0"!==e}},created:function(){this._paginationSql=this.slotData.paginationSql,this.loadData()},methods:{filter:function(e){var t=this;if(this.searchLoading=!0,this.searchData=[],this.needRenderSearchTree=!1,e!=this.filterText)this.filterText=e;else if(this.searchSqlUrlReal&&""!=e)+this.slotData.searchIsAsync||this.initLoadData(void 0,this.searchSqlUrlReal,e);else{var a;if(!this.searchSqlUrlReal)null===(a=this.$refs)||void 0===a||a.tree.filter(e),e&&this.$refs.tree.$nextTick((function(){var e,a=[],n=null===(e=t.$refs.tree)||void 0===e?void 0:e.filterNodeData,i=function e(t,a){t.forEach((function(t){var n=t.data,i=dsf.mix({},n);i.children=[],a.push(i),t.childNodes&&e(t.childNodes,i.children)}))};i(n,a),t.$refs.tree2.$once("loadDataSuccess",(function(){t.searchLoading=!1})),t.searchData=a}));this.$nextTick((function(){var e,a;null===(e=t.$treeBox)||void 0===e||null===(a=e.filterState)||void 0===a||a.call(e)}))}},reloadData:function(){this.loadData()},loadData:function(){var e=this;if(this.$treeBox.isDesign){var t=this.defaultProps.label,a=this.defaultProps.children,n=this.nodeKey,i=[r()(r()(r()({},t,"一级 1"),n,1),a,[r()(r()(r()({},t,"二级 1-1"),n,4),a,[r()(r()(r()({},t,"三级 1-1-1"),"icon","el-icon-info"),n,9),r()(r()(r()({},t,"三级 1-1-2"),"icon","el-icon-info"),n,10)])]),r()(r()(r()({},t,"一级 2"),n,2),a,[r()(r()({},t,"二级 2-1"),n,5),r()(r()({},t,"二级 2-2"),n,6)]),r()(r()(r()({},t,"一级 3"),n,3),a,[r()(r()({},t,"二级 3-1"),n,7),r()(r()({},t,"二级 3-2"),n,8)])];if(-1==+this.slotData.metaDataType){var s=this.slotData.staticData;i=s.indexOf("@[")?JSON.parse(s||"[]"):[]}if(this.openWebroot&&this.webrootName&&(i=[r()(r()(r()({},t,this.webrootName),a,i),n,0)]),this.data=i,this.needExpand)for(var o=0;o<this.data.length;o++)this.initExpand(this.data[o]);this.$nextTick((function(){var t,a;null===(t=e.$treeBox)||void 0===t||null===(a=t.setTreeObj)||void 0===a||a.call(t,e)})),this.canInitTreeDom=!0}else this.setRequestConfig()},loadDataSuccess:function(e){var t,a,n=this,i=e.data||[];null!==i&&void 0!==i&&i.length&&(null===(t=this.$treeBox)||void 0===t||null===(a=t.treeLoadData)||void 0===a||a.call(t,{target:this,args:i}));this.filterText&&null!==i&&void 0!==i&&i.length&&this.$nextTick((function(){var e,t=_.map(_.unionBy(null===(e=n.$treeBox)||void 0===e?void 0:e.selectedData,n.nodeKey),(function(e){return e[n.nodeKey]}));n.$refs.tree2.setCheckedKeys(t,!1,!0),+n.slotData.chooseOneNode&&n.checkSearch(),n.$nextTick((function(){var e,t;null===n||void 0===n||null===(e=n.$treeBox)||void 0===e||null===(t=e.$dispatch)||void 0===t||t.call(e,"searchLoadedEvent",{data:i,tabIndex:n.tabIndex,searchTreeVm:n.$refs.tree2})}))}));var s=1*this.slotData.metaDataType;-1==s&&"2"!=this.loading&&this.$nextTick((function(){var e,t;n.loading="2",n.filterText&&n.filter(n.filterText),null===(e=n.$treeBox)||void 0===e||null===(t=e.setTreeObj)||void 0===t||t.call(e,n)}))},setRequestConfig:function(){var e=this,t=1*this.slotData.metaDataType;if(-1==t){var a=this.slotData.staticData;return a=a.indexOf("@[")?JSON.parse(a||"[]"):this.isDesign?[]:this.$replace(a,this.$expressParams(this)),dsf.isObject(a)&&(a=new Array(a)),this.needExpand&&_.forEach(a,(function(t){e.initExpand(t,0)})),this.data=a,void(this.canInitTreeDom=!0)}if(this.params={},t>1){var n,i=this.sqlUrls[t-2],s=this.slotData.showType;this._paginationSql="/oua/getOrgMoreData",this._sqlUrl=i[s],4==t&&"0"==(null===(n=this.slotData)||void 0===n?void 0:n.orgAsync)||(this.searchSqlUrlReal=i[s+"Search"],this.async=!0,this.params={isAsy:!0},this.asyncSql=this._sqlUrl)}else{var o;this.async=1*((null===(o=this.slotData)||void 0===o?void 0:o.async)||0),this.searchSqlUrlReal=this.slotData.searchSqlUrl}if(4==t)this.params["sExplanLevel"]=this.slotData.showLevel,"user"==this.slotData.showType?this.asyncSql="oua/getUserByCurUnit":this.asyncSql="oua/getDeptByCurUnit";else if(0==t)this._sqlUrl=this.slotData.sqlUrl;else if(1==t){var l=this.slotData.chooseMetaData||{};"meta"===l.type?(this._sqlUrl="meta/tree/byName",this.params={name:l.code.id,namespace:this.$vm?this.$vm.nameSpace:"",pageName:this.$vm?this.$vm.pageName:"",order:"[]"}):"ds"===l.type&&(this._sqlUrl="meta/tree/dbSource",this.params={rmId:l.code})}var r=this.slotData.defaultOpenSeries;this.params.initTreeLevel=dsf.isUnDef(r)||""===r?"all":+r,this.canInitTreeDom=!0,this.async||this.initLoadData()},initLoadData:function(e,t,a,n){var i=this;dsf.mix(i.params,i.queryString);var s,o=i.params;t?(o.keyWord=a,o.sFID=null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s._id):i.loading="1";this.vLoading=!0,+i.slotData.pagination&&(o.pageSize=i.slotData.pageSize),1*i.slotData.metaDataType>1&&(o.excludeDept=i.$replace(i.slotData.excludeDept||"",i),o.excludeUser=i.$replace(i.slotData.excludeUser||"",i)),t&&(delete o.pageSize,this.$nextTick((function(){i.$refs.tree2.$once("loadDataSuccess",(function(){var e,t;i.searchLoading=!1,null===(e=i.$treeBox)||void 0===e||null===(t=e.filterState)||void 0===t||t.call(e)}))}))),i.$http.get(i.$replace(t||i._sqlUrl,i.$expressParams(i)),o,"1"==i.slotData.hasPrefix||i.slotData.metaDataType>0).done((function(a){if(a.success){var n=a.data,s={},o=[];dsf.isEmptyObject(n)&&(n=[]),Array.isArray(n)||(n=t&&+i.slotData.searchIsAsync?n.children:[n]);for(var l=0;l<n.length;l++){var r=n[l];s[r._id]=r,s[r.treeinfo_pid]?(s[r.treeinfo_pid]["children"]||(s[r.treeinfo_pid]["children"]=[]),s[r.treeinfo_pid]["children"].push(r)):o.push(r),t||(0==l&&(i.expandedKeys=[]),i.needExpand&&i.initExpand(r,0))}try{var d;null!==i&&void 0!==i&&null!==(d=i.$treeBox)&&void 0!==d&&null!==(d=d.$listeners)&&void 0!==d&&d.setDataBefore&&i.$treeBox.$dispatch("setDataBefore",{data:o,tabIndex:i.tabIndex,setData:function(e){o=e||o}})}catch(c){dsf.error(c)}if(t||(i.addMoreBtn(void 0,o),o=dsf.cloneDeepWith(o,(function(e){return e=_.clone(e),e.children&&i.addMoreBtn(e._id,e.children),e}))),t){if(i.searchData=o,e)return e(o)}else if(i.data=o,e)return e(o)}else dsf.layer.message(a.message,!1)})).error((function(e){var t;dsf.layer.message((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message),!1)})).always((function(){var e,a;t||(i.loading="2",i.filterText&&i.filter(i.filterText),null===(e=i.$treeBox)||void 0===e||null===(a=e.setTreeObj)||void 0===a||a.call(e,i));i.vLoading=!1}))},initExpand:function(e,t){var a,n=this.slotData.defaultOpenSeries;if(this.needExpand&&(!e.isLeaf&&(!(+this.slotData.metaDataType>1)||null!==(a=e.children)&&void 0!==a&&a.length||("dept"===this.slotData.showType?e.DeptCount:"user"!==this.slotData.showType||1!==e.type&&(e.DeptCount||e.UserCount))))){var i=this.defaultProps.children;if((dsf.isUnDef(n)||1*t<1*n)&&this.expandedKeys.push(e[this.nodeKey]),e[i]&&e[i].length>0){t=1*t+1;for(var s=0;s<e[i].length;s++)this.initExpand(e[i][s],t)}}},isDisabledFn:function(e){var t,a,n=!1;return this.slotData.types&&!this.$eval(this.slotData.types,e)&&(n=!0),(null!==(t=this.$treeBox)&&void 0!==t&&null!==(t=t.excludeIdsAll)&&void 0!==t&&null!==(a=t.includes)&&void 0!==a&&a.call(t,e[this.$treeBox.valueNodeKey])||e.isBtn)&&(n=!0),n},isExcludedFn:function(e){var t,a,n=!1;return(null!==(t=this.$treeBox)&&void 0!==t&&null!==(t=t.excludeIdsAll)&&void 0!==t&&null!==(a=t.includes)&&void 0!==a&&a.call(t,e[this.$treeBox.valueNodeKey])||e.isBtn)&&(n=!0),n},setNodeDisable:function(e,t){if(e.required&&t.checked)return!0;var a;+this.slotData.metaDataType>1&&(null!==e&&void 0!==e&&null!==(a=e.children)&&void 0!==a&&a.length||("dept"===this.slotData.showType?e.DeptCount:"user"!==this.slotData.showType||1!==e.type&&(e.DeptCount||e.UserCount))||(t.isLeaf=!0));return e._parent||Object.defineProperty(e,"_parent",{get:function(){return 1==t.level?{}:(null===t||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.data)||{};var e}}),!(1!=+this.maxNum||!this.isDisabledFn(e))||(!(this.canChooseRoot||e.isLeaf||!this.async||"0"==this.slotData.chooseOneNode||1!=t.level||this.filterText)||!!e.isBtn)},setNodeClass:function(e,t){return"".concat(this.isDisabledFn(e)?" is_disabled":""," ").concat(this.isExcludedFn(e)?" is_excluded":"")},asyncLoadData:function(e,t,a){var n,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=this,o=null,l={isAsy:i,sFID:null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n._id};if(4==+this.slotData.metaDataType&&(l["sExplanLevel"]=this.slotData.showLevel),a?(o=a,l.sFID=e.parentId,l.pageNum=this.pageNumObj[l.sFID],+this.slotData.metaDataType>1&&(l.withUser="user"===this.slotData.showType)):+this.slotData.metaDataType<=1?(o=s.slotData.asyncSqlUrl,i||(o=this.slotData.syncUrlForChild)):o=s.asyncSql,o)+s.slotData.pagination&&i&&(l.pageSize=s.slotData.pageSize),+s.slotData.metaDataType>1&&(l.excludeDept=s.$replace(s.slotData.excludeDept||"",s),l.excludeUser=s.$replace(s.slotData.excludeUser||"",s)),s.$http.get(s.$replace(o,s.$expressParams(s,e.data)),l,"1"==s.slotData.hasPrefix||s.slotData.metaDataType>0).done((function(n){if(n.success){var o=n.data,r={},d=[];dsf.isEmptyObject(o)&&(o=[]),Array.isArray(o)||(o=o.children||[]);for(var c=0;c<o.length;c++){var u=o[c];r[u._id]=u,r[u.treeinfo_pid]?(r[u.treeinfo_pid]["children"]||(r[u.treeinfo_pid]["children"]=[]),r[u.treeinfo_pid]["children"].push(u)):d.push(u)}try{var h;null!==s&&void 0!==s&&null!==(h=s.$treeBox)&&void 0!==h&&null!==(h=h.$listeners)&&void 0!==h&&h.setDataBefore&&s.$treeBox.$dispatch("setDataBefore",{data:d,tabIndex:s.tabIndex,setData:function(e){d=e||d}})}catch(p){dsf.error(p)}var f=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;s.$nextTick((function(){var n,i,o=[].concat(s.$refs.tree.getCheckedKeys(),_.map(s.searchCheckedNodes,(function(e){return e[s.nodeKey]})));(t.length&&(a?o=o.concat(t):_.pullAll(o,t)),s.$refs.tree.setCheckedKeys(o,!1,!0),e.checked||t.length)&&(null===(n=s.$treeBox)||void 0===n||null===(i=n.setSelectedData)||void 0===i||i.call(n,{target:s,args:{data:s.getSelectedData(),tabIndex:s.tabIndex}}))}))};if(a||!i)return t(d,f);if(s.addMoreBtn(l.sFID,d),t)return t(d,f)}else if(dsf.layer.message(n.message,!1),t&&a)return t([])})).error((function(e){var t;dsf.layer.message((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message),!1)}));else if(t&&a)return t([])},lazyLoad:function(e,t){var a,n,i;this.resolve=t,0===e.level?this.initLoadData(t):(1*this.slotData.metaDataType>1&&"user"==this.slotData.showType?(null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.UserCount)||(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.DeptCount):null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.DeptCount)||1*this.slotData.metaDataType>1&&e.data.children||1*this.slotData.metaDataType<=1?this.asyncLoadData(e,t):t([])},searchLazyLoad:function(e,t){this.initLoadData(t,this.searchSqlUrlReal,this.filterText,e)},filterNode:function(e,t,a){var n;if(null===(n=this.$treeBox)||void 0===n||null===(n=n.filterKeyInfo)||void 0===n||!n.length)return!0;var i=e.trim();if(i=""===i?[]:i.split(" "),!i.length)return!0;for(var s=0;s<i.length;s++)for(var o,l=null===(o=i[s])||void 0===o?void 0:o.toLowerCase(),r=0;r<((null===(d=this.$treeBox)||void 0===d?void 0:d.filterKeyInfo)||[]).length;r++){var d,c=!1,u=this.$treeBox.filterKeyInfo[r],h=t[u.code];if(!dsf.isUnDef(h)){h=(h+"").toLowerCase();var f=h.indexOf(l),p=u.operation;switch(p){case"like":c=f>-1;break;case"slike":c=0==f;break;case"elike":c=f+l.length==(h+"").length;break;case"eq":c=h==l;break;case"noteq":c=h!=l;break;case"lt":c=h<l;break;case"gt":c=h>l;break;case"lteq":c=h<=l;break;case"gteq":c=h>=l;break}}if(c)return!0}return!1},checkSearchChange:function(e,t,a){var n,i,s=this;if(null===this||void 0===this||null===(n=this.$treeBox)||void 0===n||!n.isResetSelectIng){if(this.filterNode(this.filterText,e)&&!this.isDisabledFn(e)){var o,l,r=e[this.nodeKey];if(t)if(1==+this.maxNum)null===(o=this.$refs)||void 0===o||null===(o=o.tree2)||void 0===o||null===(l=o.setCheckedKeys)||void 0===l||l.call(o,[r],!1,!0),this.searchCheckedNodes=[e];else this.searchCheckedNodes.push(e);this.checkChange(e,t,a,!0)}1!=+this.maxNum&&"2"==this.slotData.chooseOneNode&&null!==e&&void 0!==e&&null!==(i=e.children)&&void 0!==i&&i.length&&dsf.deepForEach(e.children,(function(e){s.$refs.tree2.setChecked(e[s.nodeKey],t,!0,!0)}))}},checkSearch:function(e){this.searchCheckedNodes=_.unionBy(this.searchCheckedNodes,this.nodeKey),this.check(e,{checkedKeys:this.$refs.tree.getCheckedKeys(),checkedNodes:this.$refs.tree.getCheckedNodes(),halfCheckedKeys:[],halfCheckedNodes:[]})},checkChange:function(e,t,a,n){var i,s,o,l,r,d,c=this;null!==this&&void 0!==this&&null!==(i=this.$treeBox)&&void 0!==i&&i.isResetSelectIng||(this.filterText&&!this.filterNode(this.filterText,e)||e.isBtn||this.rightIstree||(t||(null===(r=this.$treeBox)||void 0===r||null===(d=r.deleteDefaultSelect)||void 0===d||d.call(r,e),this.deleteSearchCheckedNodes(e[this.nodeKey],n)),1==+this.maxNum||this.filterText||"2"!=this.slotData.chooseOneNode||null===e||void 0===e||null===(s=e.children)||void 0===s||!s.length||this.needGetChildAll(e)||_.forEach(e.children,(function(e){c.$refs.tree.setChecked(e[c.nodeKey],t,!0,!0)})),(!this.checkRepeatKeys||null!==(o=this.checkRepeatKeys)&&void 0!==o&&o[0]&&(null===(l=this.checkRepeatKeys)||void 0===l||null===(l=l[0])||void 0===l?void 0:l[1])!=t)&&(this.checkRepeatKeys=[]),this.checkRepeatKeys.push([e,t])))},check:function(e,t){var a,n,i,s,l,r,d,c=this,u=this.$refs.tree,h=(null===u||void 0===u||null===(a=u.getNode)||void 0===a?void 0:a.call(u,e))||{};if(null!==(n=this.checkRepeatKeys)&&void 0!==n&&n.length){this.ischeckRepeatKeysIng=!0;while(this.checkRepeatKeys.length)this.checkRepeatKeyHandle.apply(this,o()(this.checkRepeatKeys.shift()));this.ischeckRepeatKeysIng=!1}if(this.needGetChildAll(e)&&!h.isLeaf&&this.getAllChildFn(h),t["checkedKeys"]=t["checkedKeys"].concat(_.map(this.searchCheckedNodes,(function(e){return e[c.nodeKey]}))),t["checkedNodes"]=t["checkedNodes"].concat(this.searchCheckedNodes),null===(i=this.$treeBox)||void 0===i||null===(s=i.checkNode)||void 0===s||s.call(i,{target:this,args:{node:e,checkDatas:t}}),!this.rightIstree){if(null!==(l=this.$refs.tree.getNode(e))&&void 0!==l&&l.checked&&1*this.maxNum===1){var f,p,v,g,m=[e[this.nodeKey]];null===(f=this.$refs)||void 0===f||null===(f=f.tree)||void 0===f||null===(p=f.setCheckedKeys)||void 0===p||p.call(f,m,!1,!0),null===(v=this.$refs)||void 0===v||null===(v=v.tree2)||void 0===v||null===(g=v.setCheckedKeys)||void 0===g||g.call(v,m,!1,!0)}null===(r=this.$treeBox)||void 0===r||null===(d=r.setSelectedData)||void 0===d||d.call(r,{target:this,args:{data:this.getSelectedData(),tabIndex:this.tabIndex}})}},checkRepeatKeyHandle:function(e,t){var a,n,i=this;if(this.filterText){var s,o,l=null===(s=this.$refs)||void 0===s||null===(s=s.tree2)||void 0===s||null===(o=s.keysGetNodes)||void 0===o?void 0:o.call(s,e[this.nodeKey],!0).filter((function(e){return!!e})),r=this.$refs.tree2;_.each(l,(function(e){e&&e.checked!=t&&r.getNode(e)&&r.setChecked(e,t,1!=i.maxNum&&"0"!=i.slotData.chooseOneNode,!1)}))}var d=null===(a=this.$refs)||void 0===a||null===(a=a.tree)||void 0===a||null===(n=a.keysGetNodes)||void 0===n?void 0:n.call(a,e[this.nodeKey],!0).filter((function(e){return!!e})),c=this.$refs.tree;_.each(d,(function(e){e&&e.checked!=t&&c.getNode(e)&&c.setChecked(e,t,1!=i.maxNum&&"0"!=i.slotData.chooseOneNode,!1)}))},deleteSearchCheckedNodes:function(e,t){var a,n=this;(_.forEach(this.searchCheckedNodes,(function(t,a){if(t[n.nodeKey]==e)return n.searchCheckedNodes.splice(a,1),!1})),t||this.ischeckRepeatKeysIng)||(null===this||void 0===this||null===(a=this.$refs)||void 0===a||null===(a=a.tree2)||void 0===a||a.setChecked(e,!1,1!=this.maxNum&&"0"!=this.slotData.chooseOneNode,!0))},getSelectedData:function(){var e,t=this,a=this,n=[];1*this.maxNum===1?n=this.filterText&&null!==(e=this.searchCheckedNodes)&&void 0!==e&&e.length?this.searchCheckedNodes:this.$refs.tree.getCheckedNodes():n=[].concat(this.$refs.tree.getCheckedNodes(),this.searchCheckedNodes);n=_.unionBy(n,"_id");var i="1"===this.slotData.chooseOneNodeSpecial;return _.forEachRight(n,(function(e,s){var o,l;e.tabIndex=t.tabIndex,a.isDisabledFn(e)||a.isExcludedFn(e)?n.splice(s,1):!i||null===(o=a.$refs.tree.getNode(e[a.nodeKey]))||void 0===o||null===(o=o.parent)||void 0===o||!o.checked||null!==(l=a.$refs.tree.getNode(e[a.nodeKey]))&&void 0!==l&&null!==(l=l.parent)&&void 0!==l&&l.isRoot||n.splice(s,1)})),n},nodeClick:function(e,t){if(e.isBtn)this.loadMore(e,t);else{if("expand"===this.slotData.clickTextFun)return;var a,n;if(this.rightIstree&&!this.isDisabledFn(e))return void(null===(a=this.$treeBox)||void 0===a||null===(n=a.setSelectedData)||void 0===n||n.call(a,{target:this,args:{data:t,tabIndex:this.tabIndex}}))}},setNodeDisableSearch:function(e,t){return this.setNodeDisable(e,t)},addMoreBtn:function(e,t){+this.slotData.pagination&&t.length==this.slotData.pageSize&&(this.pageNumObj[e]=2,t.push(r()(r()(r()(r()(r()({},this.defaultProps.label,"点击加载更多"),this.nodeKey,"更多按钮"+e),"isLeaf",!0),"isBtn",!0),"parentId",e)))},loadMore:function(e,t){var a=this;this.$set(e,"loading",!0),this.asyncLoadData(e,(function(n){var i=a.$refs.tree;if(n.length){var s=e[a.nodeKey];if(i.insertBefore(n,s),a.needExpand)for(var o=0;o<n.length;o++)a.initExpand(n[o],t.level>1?t.level-1:0);a.$nextTick((function(){var s,o,l;(a.$set(e,"loading",!1),a.pageNumObj[e.parentId]++,n.length<a.slotData.pageSize&&i.remove(t),a.$refs.tree.setCheckedKeys([].concat(a.$refs.tree.getCheckedKeys(),_.map(a.searchCheckedNodes,(function(e){return e[a.nodeKey]}))),!1,!0),null!==t&&void 0!==t&&null!==(s=t.parent)&&void 0!==s&&s.checked)&&(null===(o=a.$treeBox)||void 0===o||null===(l=o.setSelectedData)||void 0===l||l.call(o,{target:a,args:{data:a.getSelectedData(),tabIndex:a.tabIndex}}))}))}else i.remove(t)}),a._paginationSql)},needGetChildAll:function(e){var t=this;if(this.filterText)return!1;var a=!0,n=this.$refs.tree;if(_.forEachRight(n.getNodePath(e),(function(e){if(t.getChildAllCodes.includes(e[t.nodeKey]))return a=!1,!1})),!this.async&&+this.slotData.pagination&&a&&(+this.slotData.metaDataType>1||this.slotData.syncUrlForChild)){var i=!1;return dsf.deepForEach(e,(function(e){if(null!==e&&void 0!==e&&e.isBtn)return i=!0,-1})),i||n.expandNode(n.getNode(e),!0,!0),i}return this.async&&+this.slotData.chooseOneNode&&(+this.slotData.metaDataType>1||this.slotData.syncUrlForChild)&&a},getAllChildFn:function(e){var t=this,a=this.$refs.tree,n=e.data,i=e.checked;e.loading=!0,e.loaded=!1,+this.slotData.pagination&&(this.vLoading=!0),this.asyncLoadData(e,(function(s,o){if(t.getChildAllCodes.push(n[t.nodeKey]),null!==s&&void 0!==s&&s.length){n.children=[];var l=dsf.isObject(s)?null===s||void 0===s?void 0:s[0]:s||[],r=[],d=[];dsf.deepForEach(l,(function(e){e.children&&!e.children.length&&delete e.children,1!=t.maxNum&&!t.filterText&&"2"==t.slotData.chooseOneNode&&l.length&&(r.push(e[t.nodeKey]),i||d.push(e))})),a.$once("loadDataSuccess",(function(){_.forEach(d,(function(e){var a,n;null===(a=t.$treeBox)||void 0===a||null===(n=a.deleteDefaultSelect)||void 0===n||n.call(a,e)})),e.loaded=!0,e.loading=!1,a.expandNode(e,!0,!0,!0),null===o||void 0===o||o(r,i),t.vLoading&&t.$nextTick((function(){t.vLoading=!1}))})),a.updateKeyChildren(n[t.nodeKey],l)}else e.loaded=!0,e.loading=!1,e.isLeaf=!0,t.vLoading&&t.$nextTick((function(){t.vLoading=!1}))}),null,!1)},reset:function(){var e,t,a,n;null===(e=this.$refs)||void 0===e||null===(e=e.tree)||void 0===e||null===(t=e.setCheckedKeys)||void 0===t||t.call(e,[],!1,!0),null===(a=this.$refs)||void 0===a||null===(a=a.tree2)||void 0===a||null===(n=a.setCheckedKeys)||void 0===n||n.call(a,[],!1,!0),this.searchCheckedNodes=[],this.checkRepeatKeys=[]},initDefaultSelect:function(e){var t,a,n,i;null===(t=this.$refs)||void 0===t||null===(t=t.tree)||void 0===t||null===(a=t.setCheckedKeys)||void 0===a||a.call(t,e,!1,!0),null===(n=this.$refs)||void 0===n||null===(n=n.tree2)||void 0===n||null===(i=n.setCheckedKeys)||void 0===i||i.call(n,e,!1,!0)}},design:{isMask:!1,fit:!0}}),c=d,u=a(0),h=Object(u["a"])(c,n,i,!1,null,null,null);t["default"]=h.exports},1098:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ds-control ds-tree-selector"},[e.rightTree.nodeKey?a("el-row",[a("el-col",{attrs:{span:e.showRightBox?15:24}},[a("div",{staticClass:"head"},[e._t("search",(function(){return[a("el-input",{attrs:{placeholder:e.placeholder},nativeOn:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.filterTextVal=e.filterText}},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[e.filtering?a("i",{staticClass:"el-icon-loading",attrs:{slot:"suffix"},slot:"suffix"}):a("i",{staticClass:"iconfont icon-Magnifier",attrs:{slot:"suffix"},on:{click:function(t){e.filterTextVal=e.filterText}},slot:"suffix"})])]})),e._t("searchboxSolt")],2),a("div",{staticClass:"content"},[1!=e.slots.length||e.showTab?e.slots.length>1||1==e.slots.length&&e.showTab?a("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.slots,(function(t,n){return a("el-tab-pane",{key:t.name,ref:t.name,refInFor:!0,attrs:{label:t.title,name:t.title,lazy:!e.isDesign}},[a("DsfTree",{ref:"dsfTree",refInFor:!0,attrs:{"tab-index":n,slotData:t},scopedSlots:e._u([{key:"nodeLable",fn:function(t){var a=t.data,n=t.node;return[e._t("nodeLabel",null,{data:a,node:n})]}}],null,!0)})],1)})),1):e._e():a("DsfTree",{ref:"dsfTree",attrs:{"tab-index":"0",slotData:e.slots[0]},scopedSlots:e._u([{key:"nodeLable",fn:function(t){var a=t.data,n=t.node;return[e._t("nodeLabel",null,{data:a,node:n})]}}],null,!0)})],1)]),e.showRightBox?a("el-col",{class:{rightBoxIsTree:"tree"===e.typeStyle},attrs:{span:9}},[a("div",{staticClass:"head el-row"},[1!=e.slots.length||"tree"!==e.typeStyle?a("el-col",{staticClass:"ellipsis",attrs:{span:12}},[e._v(" 已选择 "),a("b",{staticClass:"chooseNum",domProps:{textContent:e._s(e.selectedData.length)}})]):e._e(),a("el-col",{staticClass:"ellipsis",attrs:{span:1==e.slots.length&&"tree"===e.typeStyle?24:12}},[a("span",{staticClass:"reset",on:{click:e.resetSelect}},[a("i",{staticClass:"el-icon-refresh-right"}),e._v("重置 ")])])],1),a("div",{staticClass:"content"},[1==e.slots.length&&"tree"===e.typeStyle?a("DsfVirtualTree",{ref:"tree",attrs:{props:e.rightTree.props,data:e.rightTree.data,"render-content":e.renderRightTreeContent,"default-expand-all":!0,"node-key":e.rightTree.nodeKey}}):a("ResultList")],1)]):e._e()],1):e._e()],1)},i=[],s=a(2),o=a.n(s),l=a(3),r=a.n(l),d=dsf.component({name:"DsfTreeSelector",ctrlCaption:"树选择器",mixins:[$mixins.control,$mixins.dataResult],components:{ResultList:function(){return a.e(70).then(a.bind(null,1266))}},props:{slots:{type:Array,default:function(){return[]}},placeholder:{type:String,default:"输入关键字进行过滤"},sort:{type:Boolean,default:!1},typeStyle:{type:String,default:"list"},maxLength:{type:Number,default:0},showTab:{type:Boolean,default:!0},showRightBox:{type:Boolean,default:!0},nodeKey:{type:String,default:"_id"},excludeIds:{type:Array,default:function(){return[]}},valueNodeKey:{type:String,default:"_id"},filterKeyInfo:{type:Array,default:function(){return[{code:"_name",operation:"like"}]}}},data:function(){return{activeName:"",treesObj:[],treeSelected:[],selectedData:[],defaultSelect:[],rightTree:{data:[],props:{children:"children",label:"_name"},nodeKey:"",keysOfNode:{}},isCheckNodeCtrl:!1,filterText:"",filtering:!1,filterTextVal:"",requiredData:[]}},watch:{filterTextVal:function(e){if(!this.filtering){this.filterState(!0);var t=-1;for(var a in this.treesObj)this.treesObj[a]&&(t++,"array"===dsf.type(this.$refs.dsfTree)?this.$refs.dsfTree[t].filter(e):this.$refs.dsfTree.filter(e))}},activeName:function(e,t){if(e!=t){var a=_.findIndex(this.slots,(function(t){return t.title===e}));this.$dispatch("tabChange",{name:e,index:a})}}},computed:{excludeIdsAll:function(){var e;return this.excludeIds.concat((null===(e=this.$vm)||void 0===e||null===(e=e.$attrs)||void 0===e?void 0:e.excludeIds)||[])}},created:function(){this.init()},methods:{disconnectIntersectionObserver:function(){var e,t;null===(e=this.intersectionObserver)||void 0===e||null===(t=e.disconnect)||void 0===t||t.call(e)},init:function(){var e=this;this.getParentCtrlConfig(),this.treesObj=[],this.treeSelected=[],this.selectedData=[],_.forEach(this.slots,(function(t,a){0==a&&(e.activeName=t.title),e.treeSelected.push([]),e.treesObj.push(null)})),this.setDefaultSelect()},getParentCtrlConfig:function(){var e;if(!dsf.isEmptyObject(this.$choiceParams)&&_.isArray(this.$choiceParams.slots)&&this.$choiceParams.slots.length>0)for(var t in this.slots.length=this.$choiceParams.slots.length,this.$choiceParams.slots)this.slots[t]=this.$choiceParams.slots[t];this.rightTree.nodeKey=(null===(e=this.slots)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.nodeKey)||this.nodeKey||"_id"},setDefaultSelect:function(){var e;this.$listeners.setDefaultSelect?this.$dispatch("setDefaultSelect",this._initDefaultSelect):this.getDefaultSelect(null===(e=this.$vm)||void 0===e||null===(e=e.$attrs)||void 0===e?void 0:e.selectValue)},getDefaultSelect:function(e){var t=this;if("array"==dsf.type(e)){var a=[];e.forEach((function(n,i){var s=n.value,o=n.text,l=n._name,d=n.required,c=dsf.mix({},e[i]);l?a.push(c):s&&o&&(dsf.mix(c,r()(r()({},t.valueNodeKey,s),"_name",o)),"globalId"==t.valueNodeKey&&(c._id=_.last(s.split("."))),a.push(c)),d&&t.requiredData.push(c)})),this.defaultSelect=a}this.selectedData=this.defaultSelect},_initDefaultSelect:function(e){var t,a=this;null!==(t=this.selectedData)&&void 0!==t&&t.length&&this.resetSelect(),this.getDefaultSelect(e);var n=_.map(this.selectedData,(function(e){return e[a.valueNodeKey]})),i=-1;for(var s in this.treesObj){var o,l,r,d,c,u;if(this.treesObj[s])if(i++,"array"===dsf.type(this.$refs.dsfTree))null===(o=this.$refs)||void 0===o||null===(o=o.dsfTree)||void 0===o||null===(o=o[i])||void 0===o||null===(l=(r=o).initDefaultSelect)||void 0===l||l.call(r,n);else null===(d=this.$refs)||void 0===d||null===(d=d.dsfTree)||void 0===d||null===(c=(u=d).initDefaultSelect)||void 0===c||c.call(u,n)}},treeLoadData:function(e){var t=e.target,a=e.args,n=this;a.length&&n.defaultSelect.length&&t.$nextTick((function(){var e=t.$refs.tree2||t.$refs.tree;e.$nextTick((function(){if(1==n.slots.length&&"tree"===n.typeStyle){var a=[];_.forEach(n.defaultSelect,(function(i){var s=e.getNode(i[t.nodeKey]);if(s){var o=s.data;n.requiredData&&(s.data.required=o.required||!1);var l=o.globalId.split(".");!o.treeinfo_pid&&l.length>=2&&(o.treeinfo_pid=l[l.length-2]),a.push(dsf.mix({},o))}}));for(var i={},s=[],o=0;o<a.length;o++){var l=a[o];l.children=[],i[l._id]=l,i[l.treeinfo_pid]?(i[l.treeinfo_pid]["children"]||(i[l.treeinfo_pid]["children"]=[]),i[l.treeinfo_pid]["children"].push(l)):s.push(l)}n.rightTreeData(s)}_.forEach(n.defaultSelect,(function(a){var i=e.getNode(a[t.nodeKey]);i&&(n.requiredData&&(i.data.required=a.required||!1),e.checkNode(i,!0,"1"==t.slotData.chooseOneNode,!1))}))}))}))},changeNodeCheckState:function(e,t,a,n,i){t.setChecked(a[e.nodeKey],n,!!dsf.isUnDef(i)&&"0"!=e.slotData.chooseOneNode,!0)},setSelectedData:_.debounce((function(e){var t=this,a=-1;if(e){if(1==this.slots.length&&"tree"===this.typeStyle)return void this.setRightTree(e);a=e.args.tabIndex,this.treeSelected[a]=e.args.data}if(1*this.getMaxLength()===1){var n;this.selectedData=(null===e||void 0===e||null===(n=e.args)||void 0===n?void 0:n.data)||[],_.forEach(this.treeSelected,(function(n,i){if(i!=a){t.treeSelected[i]=[];var s=t.treesObj[i];if(s){var o;_.forEach((null===s||void 0===s?void 0:s.getCheckedNodes())||[],(function(t){var a;(null===e||void 0===e||null===(a=e.args)||void 0===a||null===(a=a.data)||void 0===a?void 0:a._id)!=t._id&&(null===s||void 0===s||s.setChecked(t,!1))}));var l=null===s||void 0===s||null===(o=s.$parent)||void 0===o||null===(o=o.$refs)||void 0===o?void 0:o.tree2;l&&_.forEach((null===l||void 0===l?void 0:l.getCheckedNodes())||[],(function(t){var a;(null===e||void 0===e||null===(a=e.args)||void 0===a||null===(a=a.data)||void 0===a?void 0:a._id)!=t._id&&(null===l||void 0===l||l.setChecked(t,!1))}))}}}))}else{var i,s,l=(i=[]).concat.apply(i,o()(this.treeSelected).concat([this.defaultSelect]));if(l=_.unionBy(l,"_id"),this.getSort()&&null!==(s=this.selectedData)&&void 0!==s&&s.length){var r=this.valueNodeKey,d={};_.forEach(l,(function(e){d[e[r]]=e}));var c=[];_.forEach(this.selectedData,(function(e){var t=d[e[r]];t&&(c.push(t),delete d[e[r]])})),_.forEach(_.keys(d),(function(e){return[c.push(d[e])]})),this.selectedData=c}else this.selectedData=l}}),50),changeNodeCheckStateAll:function(e,t,a){var n=this,i=-1;_.each(this.treesObj,(function(s,o){if(s){i++;var l="";l="array"===dsf.type(n.$refs.dsfTree)?n.$refs.dsfTree[i]:n.$refs.dsfTree,t||l.deleteSearchCheckedNodes(e[l.nodeKey]),n.changeNodeCheckState(l,s,e,t),a||(n.treeSelected[o]=l.getSelectedData())}}))},deleted:function(e){e.required||(this.changeNodeCheckStateAll(e,!1),this.deleteDefaultSelect(e),this.setSelectedData(),this.$dispatch("deleteNode",e))},deleteDefaultSelect:function(e){var t=this;if(e.args&&(e=e.args),e.required)return!1;var a=this.valueNodeKey;_.forEach(this.defaultSelect,(function(n,i){if(n[a]==e[a])return t.defaultSelect.splice(i,1),!1}))},resetSelect:function(){var e=this;this.isResetSelectIng=!0,this.defaultSelect=this.requiredData,this.selectedData=this.requiredData;var t=-1;for(var a in this.treesObj){var n,i,s,o,l,r;if(this.treesObj[a])if(t++,"array"===dsf.type(this.$refs.dsfTree))null===(n=this.$refs)||void 0===n||null===(n=n.dsfTree)||void 0===n||null===(n=n[t])||void 0===n||null===(i=(s=n).reset)||void 0===i||i.call(s);else null===(o=this.$refs)||void 0===o||null===(o=o.dsfTree)||void 0===o||null===(l=(r=o).reset)||void 0===l||l.call(r);this.treeSelected[a]=[]}1==this.slots.length&&"tree"===this.typeStyle&&(_.forEach(this.rightTree.data,(function(t){e.$refs.tree.remove(t)})),this.rightTree.data=[]),this.isResetSelectIng=!1},reloadData:function(){this.resetSelect(),this.treesObj=[],this.treeSelected=[];var e=this.$refs.dsfTree;"array"===dsf.type(e)?e.forEach((function(e){return e.reloadData()})):e.reloadData()},getSort:function(){return this.$choiceParams&&dsf.isDef(this.$choiceParams.sort)?this.$choiceParams.sort:this.sort},getMaxLength:function(){return this.$choiceParams&&dsf.isDef(this.$choiceParams.maxLength)?this.$choiceParams.maxLength:this.maxLength},setTreeObj:function(e){this.$set(this.treesObj,e.tabIndex,e.$refs.tree),e.filterText=this.filterText,this.$dispatch("treeInited",e)},up:function(e){if(e>0){var t=this.selectedData[e],a=e;dsf.array.remove(this.selectedData,t),this.selectedData.splice(a-1,0,t)}},down:function(e){if(this.selectedData.length-1>e){var t=this.selectedData[e],a=e;dsf.array.remove(this.selectedData,t),this.selectedData.splice(a+1,0,t)}},getReturnValue:function(){var e=this,t=this,a=[];if(1*this.getMaxLength()>0&&this.selectedData.length>1*this.getMaxLength())return dsf.layer.message("已超出选择数量上限【"+this.getMaxLength()+"】",!1),!1;var n=function(){var n={};n={value:t.selectedData[i][e.valueNodeKey],text:t.selectedData[i]._name};var s=_.findIndex(a,(function(e){return e.value==n.value}));s<0&&a.push(dsf.mix(n,e.selectedData[i]))};for(var i in this.selectedData)n();return a},renderRightTreeContent:function(e,t){var a=this,n=t.node,i=t.data;t.store;return e("span",{class:"custom-tree-node"},[e("span",[n.label]),e("span",{class:"custom-tree-node_del",style:"margin-left:16px"},[e("i",{class:"el-icon-close",attrs:{title:"删除"},on:{click:function(){return a.removeNode(n,i)}}})])])},removeNode:function(e,t){this.$refs.tree.remove(e);var a=[];this.removeNodeChild(a,t),this.selectedData=_.differenceBy(this.selectedData,a,"_id")},removeNodeChild:function(e,t){var a=this;e.push(t),_.forEach(t.children,(function(t){a.removeNodeChild(e,t)}))},setRightTree:function(e){var t=e.args.data;if(t.data){var a=dsf.mix({},t.data);"0"==this.slots[0].chooseOneNode&&(a["children"]=[]);var n=[];_.forEach(this.treesObj[0].getNodePath(t.data[this.rightTree.nodeKey]),(function(e){dsf.isEmptyObject(e)||n.push(dsf.mix(!0,{},e))})),null!==n&&void 0!==n&&n.length&&this.rightTreeData(n)}},rightTreeData:function(e){var t,a,n=this,i=!1;null!==(t=this.$refs)&&void 0!==t&&t.tree&&_.forEachRight(e,(function(e,t){var s,o=n.$refs.tree.getNode(e[n.rightTree.nodeKey]);if(o&&null!==n&&void 0!==n&&null!==(s=n.selectedData)&&void 0!==s&&s.length)return a&&n.$refs.tree.append(a,o),i=!0,!1;a&&(e.children=[a]),a=e})),i||(this.rightTree.data=a?[a]:[]);var s=[].concat(this.selectedData,e);s=_.unionBy(s,"_id"),this.selectedData=s},checkNode:function(e){this.$dispatch("getCheckNode",e)},filterState:function(e){this.filtering=!!e}},design:{isMask:!0,fit:!0},provide:function(){return{$treeBox:this}},beforeDestroy:function(){this.disconnectIntersectionObserver()}}),c=d,u=a(0),h=Object(u["a"])(c,n,i,!1,null,null,null);t["default"]=h.exports},1099:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ds-control ds-form-item",class:e.getCss},[e.showLabel?a("DsfFieldLabel",{style:e.getLabelWidthStyle(),attrs:{mode:e.showDataCaptionMode,"show-icon":e.showDataCaptionIcon,trigger:e.showDataCaptionTrigger,"data-caption":e.dataCapion,"is-design":e.isDesign,owner:e._self}},[e._v(" "+e._s(e.$t(e.label))+" ")]):e._e(),a("div",{staticClass:"ds-form-block",style:e.getFormItemBlockMarginLeft()},[e.readOnly?a("div",{staticClass:"ds-form-readonly"},[a("span",[e._v(e._s(e.inputValue.pid))])]):a("el-input",{attrs:{type:"text"},on:{change:e.inputChangeHandler,blur:e.inputBlurHandler},model:{value:e.inputValue.pid,callback:function(t){e.$set(e.inputValue,"pid",t)},expression:"inputValue.pid"}})],1)],1)},i=[],s=dsf.component({name:"DsfTreeInfo",mixins:[$mixins.formControl],ctrlCaption:"树信息",props:{caption:{type:String,default:"treeinfo"},label:{type:String,default:"树信息"},pidExpress:{type:String,default:""},iconExpress:{type:String,default:""},iconMap:{type:Array,default:function(){return[]}},showLabel:{type:Boolean,default:!0},forceHidden:{type:Boolean,default:!0},value:{type:[String,Object],default:function(){return{pid:"",icon:""}}},visible:{type:Boolean,default:!1},metadata:{type:Object,default:function(){return dsf.metadata.get("tree-info-meta-data")}}},computed:{inputValue:{get:function(){return this.value},set:function(e){this.emitValueChange(e)}}},created:function(){this.pidExpress&&(this.value.pid=this.pidExpress.getValueString(",")),this.iconExpress&&(this.value.icon=this.iconExpress.getValueString(","))},methods:{inputChangeHandler:function(){this.$dispatch("change"),this.emitValueChange(this.value)},inputBlurHandler:function(){this.$dispatch("blur"),this.emitValueChange(this.value)}},watch:{value:{handler:function(e,t){if(dsf.isString(e)||dsf.isUnDef(e))return e={pid:dsf.isUnDef(e)?"":e,icon:""},void this.emitValueChange(e);this.inputValue=e},immediate:!0}},design:{layout:{nameValidate:!1}}}),o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},1100:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isEmptyItems?a("div",{staticClass:"ds-control ds-custom-drop-tree_empty"},[e._t("emptyItems",(function(){return[e._v(" 请双击或拖拽相关字段到此处 ")]}))],2):a("div",{staticClass:"ds-control ds-custom-drop-tree"},[a("DsfCustomDropTreeLogicNode",{attrs:{data:e.data},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return[e._t("item",null,{item:a})]}},{key:"more",fn:function(t){var a=t.data;return[e._t("more",null,{owner:a})]}},{key:"bottom",fn:function(t){var a=t.data;return[e._t("bottom",null,{owner:a})]}}],null,!0)})],1)},i=[],s=dsf.component({name:"DsfCustomDropTree",ctrlCaption:"放置树",mixins:[$mixins.control],provide:function(){return{$customDropTree:this}},design:{fit:!0},props:{vContentMenu:{type:Array,default:function(){return[]}},childBtns:{type:Array,default:null},data:{type:Object,default:function(){return{logic:"AND",items:[]}}},containerEl:{type:Function},logic:{type:Object,default:function(){return{AND:"与",OR:"或"}}},defaultLogic:{type:String,default:"AND"},changeLogic:{type:Function,default:function(e){return"OR"==e.logic?"AND":"OR"}},accept:{type:[String,Function],default:function(){return"ds-custom-drop-tree_item"}},setData:{type:Function},dragData:{type:Function,default:function(e){var t;return(null===(t=e.draggable.find(".nodeLabel").get(0))||void 0===t||null===(t=t.__vue__)||void 0===t?void 0:t.node.data)||{}}},canDragAdd:{type:Boolean,default:!0},isReadOnly:{type:Boolean,default:!1},resourceId:{type:String,default:null}},data:function(){return{dragStart:!1}},computed:{getContainer:function(){return this.containerEl?this.containerEl:this.$el.parentNode},isEmptyItems:function(){var e;return!((null===(e=this.data)||void 0===e||null===(e=e.items)||void 0===e?void 0:e.length)>0)}},watch:{isReadOnly:function(e,t){this.buildTreeRelation(),e?$(this.getContainer).droppable("disable"):$(this.getContainer).droppable("enable")}},created:function(){this.buildTreeRelation()},mounted:function(){this.canDragAdd&&!this.isReadOnly&&this.initDropContainer()},methods:{acceptDrag:function(e){return dsf.isFunction(this.accept)?this.accept(e):"*"==this.accept||(!!e.hasClass(this.accept)||!!e.hasClass("ds-custom-drop-tree_item"))},initDropContainer:function(){var e=this;$(this.getContainer).droppable({accept:e.acceptDrag,greedy:!0,tolerance:"pointer",hoverClass:"drop-hover",drop:function(t,a){var n=e.dragData(a);dsf.isEmptyObject(n)||e.addNode(e.dragData(a))},over:function(t,a){e.isEmptyItems||e.dragAutoScroll({top:t.clientY,left:t.clientX})}})},dragAutoScroll:function(e){var t=$(this.getContainer),a=t.height(),n=t.offset();n.top>e.top?t.scrollTop(t.scrollTop()-Math.abs(n.top-e.top)):n.top+a<e.top&&t.scrollTop(t.scrollTop()+Math.abs(n.top+a-e.top))},addNode:function(e){this.isReadOnly||this.data.items.push(this.setDataReal(e))},setDataReal:function(e){var t,a,n={};this.setData?n=this.setData(e):n={code:e.$code,operator:"eq",valueKey:e.$valueKey+"_"+dsf.uuid(),dataType:e.type,format:null,value:null,value2:null,field:e.remark,aggType:e.aggType,derive:e.derive,isMetrics:e.isMetrics,derivedMetrics:e.derivedMetrics,tableName:e.tableName,realTableName:e.realTableName,isEncrypt:e.isEncrypt||!1,erTableId:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.erTableId,tableAlias:null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.tableAlias};return this.setNode(n),n},setNode:function(e){"$hash"in e||Object.defineProperty(e,"$hash",{enumerable:!1,value:dsf.uuid(),writable:!0}),e["isGroup"]=!e.isJson&&dsf.isDef(e.logic),e["isLeaf"]=!e["isGroup"]},removeNode:function(e){e&&e.parent&&(dsf.array.remove(e.parent.items||[],e),this.resetTree(),this.$emit("removeAfter",e))},resetTree:function(){this.filterInvalidNodes(),this.buildTreeRelation()},filterInvalidNodes:function(){function e(t){if(!t.isRoot)while(1){var a;if(!t.isGroup||1!=t.items.length||null===(a=t.items[0])||void 0===a||!a.logic||t.items[0].isJson)break;t=t.items[0]}if(t.isGroup){for(var n=[],i=0;i<t.items.length;i++){var s=e(t.items[i]);s&&n.push(s)}return t.items=n,t.items&&n.length>0?t:null}return t}var t=e(this.data);Object.assign(this.data,t),this.buildTreeRelation()},buildTreeRelation:function(){dsf.deepForEach(this.data,(function(e,t,a,n){e&&("parent"in e?e.parent=n:Object.defineProperty(e,"parent",{enumerable:!1,value:n,writable:!0}))}),{children:"items"})},buildTreeRelationHash:function(e){var t=this;dsf.deepForEach(e,(function(e,a,n,i){e&&(t.setNode(e),"parent"in e?e.parent=i:Object.defineProperty(e,"parent",{enumerable:!1,value:i,writable:!0}))}),{children:"items"})}}}),o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},1148:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ds-control ds-virtual-tree",attrs:{"drag-start":e.dragstart}},[a("DsfVirtualScroll",{ref:"virtualScroll",attrs:{scrollX:!0,scrollY:!0},on:{scroll:e.onScroll}},[e.isInit&&e.totalData?a("div",{staticClass:"ds-virtual-tree__warp",style:"height: "+e.maxHeight+"px;"},[e._l(e.showNodes,(function(t){return a("div",e._g({key:t.id,staticClass:"ds-virtual-tree-node",class:e.customNodeClass(t),style:t.style,attrs:{expanded:t.expanded,"is-leaf":t.isLeaf,"is-current":e.highlightCurrent&&t.isCurrent,"node-id":t.id,"node-level":t.level,draggable:e.draggable},on:{click:function(a){return a.stopPropagation(),e.clickNode(t,a)},dblclick:function(a){return a.stopPropagation(),e.dblclickNode(t,a)},contextmenu:function(a){return e.contextmenuNode(t,a)}}},e.draggable?{dragstart:function(a){return e.dragStart(a,t)},dragend:function(a){return e.dragEnd(a,t)},dragover:function(a){return e.dragOver(a,t)},drop:function(a){return e.drop(a,t)}}:{}),[a("div",{staticClass:"ds-virtual-tree-node__content"},[e._t("label",(function(){return[a("span",{staticClass:"ds-virtual-tree-node-expanded el-icon-caret-right",attrs:{"is-opacity":e.isExpandedOpacity(t)},on:{click:function(a){return a.stopPropagation(),e.expandNode(t,!t.expanded)}}}),a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.isShowCheckbox(t),expression:"isShowCheckbox(node)"}],staticClass:"ds-virtual-tree-node-checkbox",attrs:{value:t.checked,disabled:e.isDisabledNode(t),indeterminate:t.indeterminate},on:{change:function(a){return e.checkboxClick(t,a)}},nativeOn:{click:function(e){return e.stopPropagation(),function(){}.apply(null,arguments)}}}),!t.loaded&&t.loading?a("span",{staticClass:"ds-virtual-tree-node-loading el-icon-loading"}):e._e(),a("span",{staticClass:"ds-virtual-tree-node__content_label"},[e._t("default",(function(){return[e._v(" "+e._s(t.label)+" ")]}),{data:t.data,node:t})],2)]}),{data:t.data,node:t})],2)])})),e.filterText&&!e.showNodes.length?a("div",{staticClass:"ds-virtual-tree-empty-text"},[e._v(" "+e._s(e.emptyText)+" ")]):e._e()],2):e.isInit?a("div",{staticClass:"ds-virtual-tree-empty-text"},[e._v(" "+e._s(e.emptyText)+" ")]):e._e()])],1)},i=[],s=dsf.component({name:"DsfVirtualTree",ctrlCaption:"虚拟树",components:{},mixins:[$mixins.virtualTreeMixin],props:{emptyText:{default:"暂无数据"},data:{default:function(){return[]}},nodeKey:{default:"id"},props:{default:function(){return{label:"label",children:"children",disabled:"disabled",isLeaf:"leaf",showCheckbox:"showCheckbox",customClass:null}}},nodeHeight:{default:26},defaultExpandAll:{type:Boolean,default:!1},levelIndentWidth:{default:20},expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:{default:null},defaultExpandedKeys:{default:function(){return[]}},showCheckbox:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},accordion:{type:Boolean,default:!1},currentNodeKey:{default:null},highlightCurrent:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},load:{default:null},filterNodeMethod:{default:null},draggable:{type:Boolean,default:!1}}}),o=s,l=(a(729),a(0)),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},1266:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("DsfVirtualScroll",{ref:"list",staticClass:"list",class:{canSort:e.$treeBox.getSort()},attrs:{scrollY:!0},on:{scroll:e.scrollListener}},[a("div",{staticClass:"scroll-bar",style:{height:e.totalHeight}}),e._l(e.showList,(function(t){return a("div",{key:t._id,ref:"selectedItems",refInFor:!0,staticClass:"li",style:{top:t.__top},attrs:{"row-index":t.__index}},[e._v(" "+e._s(t.__index+1)+". "+e._s(t._name)+" "),a("span",[t.__showSortUp?a("i",{staticClass:"el-icon-top",attrs:{title:"上移"},on:{click:function(a){return e.$treeBox.up(t.__index)}}}):e._e(),t.__showSortDown?a("i",{staticClass:"el-icon-bottom",attrs:{title:"下移"},on:{click:function(a){return e.$treeBox.down(t.__index)}}}):e._e(),t.required?e._e():a("i",{staticClass:"el-icon-close",attrs:{title:"删除"},on:{click:function(a){return e.$treeBox.deleted(t)}}})])])}))],2)},i=[],s=a(8),o=a.n(s),l=a(3),r=a.n(l);function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){r()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={name:"DsfTreeSelectorResultList",inject:{$treeBox:{default:null}},data:function(){return this.itemHeight=40,this.scrollY=0,this.elHeight=0,{start:0,showNum:40,top:0}},computed:{totalHeight:function(){var e=this.$treeBox.selectedData.length*this.itemHeight+"px";return this.scrollY>parseFloat(e)&&this.scrollListener(!0,{scrollTop:parseFloat(e)}),e},showList:function(){var e=this,t=[],a=this.$treeBox.selectedData.slice(this.start,this.start+this.showNum),n=this.$treeBox.selectedData.length-1,i=this.$treeBox.getSort();return _.forEach(a,(function(a,s){var o=e.start+s;t.push(c(c({},a),{},{__index:o,__top:o*e.itemHeight+"px",__showSortUp:i&&0!=o,__showSortDown:i&&o<n}))})),t}},mounted:function(){var e=this;this.__resizeObserver=new ResizeObserver((function(t){var a=o()(t,1),n=a[0];n.contentRect.height!=e.elHeight&&(e.elHeight=n.contentRect.height,e.updateShowHeight())})),this.__resizeObserver.observe(this.$el)},beforeDestroy:function(){this.__resizeObserver&&this.__resizeObserver.disconnect()},methods:{updateShowHeight:function(){this.showNum=Math.ceil(this.$el.clientHeight/this.itemHeight)+3},scrollListener:function(e,t){var a=t.scrollTop;if(Math.abs(this.scrollY-a)>this.itemHeight){this.scrollY=a;var n=Math.floor(a/this.itemHeight);n<=this.$treeBox.selectedData.length&&(this.start=n)}}}},h=u,f=a(0),p=Object(f["a"])(h,n,i,!1,null,null,null);t["default"]=p.exports},1275:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"ds-custom-drop-tree_chooseDialog",attrs:{title:"请选择：",width:"800px",visible:e.visible,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main",class:{noConst:e.noConst,noData:!(e.loading||e.data.length||e.keyWord),isRadio:1==e.maxLength},attrs:{"element-loading-text":"常量获取中","element-loading-spinner":"el-icon-loading"}},[a("div",{staticClass:"left"},[a("div",{staticClass:"input-box"},[a("div",{staticClass:"head"},[e._v("自定义：")]),a("el-input",{attrs:{resize:"none",type:"textarea",placeholder:"输入自定义数据",rows:2},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}})],1),a("div",{staticClass:"head"},[a("el-checkbox",{ref:"headTitle",attrs:{indeterminate:e.checkConfig.isIndeterminate,disabled:0==e.data.length},on:{change:e.checkAll},model:{value:e.checkConfig.checkAll,callback:function(t){e.$set(e.checkConfig,"checkAll",t)},expression:"checkConfig.checkAll"}},[e._v(" "+e._s(e.loading||e.data.length||e.keyWord?"常量：":"暂无常量")+" ")])],1),e.loading||e.data.length||e.keyWord?a("el-input",{staticClass:"searchBox",attrs:{clearable:"",placeholder:"输入关键字"},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[a("template",{slot:"suffix"},[a("i",{staticClass:"el-icon-search",attrs:{title:"搜索"}})])],2):e._e(),e.loading||e.data.length||e.keyWord?a("div",{staticClass:"list"},[a("dsf-virtual-scroll",{attrs:{"scroll-x":""},on:{scroll:e.paginationScroll}},[a("div",{staticClass:"phantom",style:{height:e.contentHeight}}),a("el-checkbox-group",{style:{transform:"translateY("+e.offset+"px)"},on:{change:e.changeState},model:{value:e.checkConfig.constChoose,callback:function(t){e.$set(e.checkConfig,"constChoose",t)},expression:"checkConfig.constChoose"}},e._l(e.visibleData,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.index,disabled:t.choosed}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1):e._e()],1),a("div",{staticClass:"center"},[a("DsfButton",{on:{click:e.chooseFn}},[e._v("选择 >")])],1),a("div",{staticClass:"right"},[a("div",{staticClass:"head el-row"},[a("div",{staticClass:"ellipsis el-col el-col-12"},[e._v(" 已选择 "),a("b",{staticClass:"chooseNum",class:{over:!!e.maxLength&&e.value.length>e.maxLength}},[e._v(" "+e._s(e.value.length||0)+e._s(e.maxLength?"/"+e.maxLength:"")+" ")])]),a("div",{staticClass:"ellipsis el-col el-col-12"},[a("span",{on:{click:e.resetFn}},[a("i",{staticClass:"el-icon-refresh-right"}),e._v("重置 ")])])]),a("div",{staticClass:"list"},[a("dsf-virtual-scroll",{attrs:{"scroll-x":""}},e._l(e.value,(function(t,n){return a("div",{key:t.id,staticClass:"item",attrs:{label:t.id}},[e._v(" "+e._s(n+1)+". "+e._s(t.name)+" "),a("i",{staticClass:"iconfont icon-guanbi2",class:{isInput:t.isInput},attrs:{title:t.isInput?"自定义数据":""},on:{click:function(a){return e.deleteFn(t,n)}}})])})),0)],1)])]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("dsf-button",{attrs:{type:"plain"},on:{click:e.closeFn}},[e._v(" 取消 ")]),a("dsf-button",{on:{click:e.sureFn}},[e._v(" 确定 ")])],1)])},i=[],s={name:"chooseDialog",props:{resourceId:{type:String,default:null}},data:function(){return this.data=[],this.visibleData=[],{visible:!1,loading:!0,value:[],inputValue:"",keyWord:"",checkConfig:{isIndeterminate:!1,checkAll:!1,constChoose:[],choosedL:0},parent:{},maxLength:null,noConst:!1,pagination:{pageSize:100,pageNum:1,noData:!1},offset:0,contentHeight:0}},watch:{keyWord:function(e,t){e!=t&&(this.loading=!0,this.searchFn())}},created:function(){var e=this;this.searchFn=_.debounce((function(){e.chooseFn(),e.openFn()}),300)},methods:{openFn:function(e){this.loading=!0,this.noConst=!1,this.pagination.pageNum=1,this.pagination.noData=!1,this.data=[],this.offset=0,this.contentHeight=0,this.visibleData=[],this.scrollTop=0,e?(this.keyWord="",this.visible=!0,this.parent=e,this.setMaxLength(),this.checkConfig.constChoose=[],this.checkConfig.checkAll=!1,this.checkConfig.isIndeterminate=!1,this.value=[],this.getData()):this.getDataConst()},setMaxLength:function(){var e=this.parent.operator;switch(this.maxLength=null,e){case"eq":case"noteq":case"lt":case"gt":case"lteq":case"gteq":this.maxLength=1;break;case"between":case"gtlt":this.maxLength=2;break}},getData:function(){var e=[],t=[];if(this.parent.value){var a=this.parent.value;2==this.maxLength&&this.parent.value2&&(a+=" "+this.parent.value2),e=a.split(" "),_.forEach(e,(function(e){""!==e&&t.push({name:e,index:dsf.uuid(),isInput:!0,id:dsf.uuid()})}))}this.value=t,this.parent.code?this.getDataConst():(this.data=[],this.noConst=!0,this.loading=!1)},getDataConst:function(){var e=this,t=this.parent.code.split("."),a={adHocQueryColumn:JSON.stringify({tableName:this.parent.originTableName||this.parent.tableName||t[0],tableAlias:this.parent.realTableName||this.parent.tableAlias,fieldName:t[1]}),resourceId:this.resourceId||dsf.url.queryString("resourceId"),pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize,filter:this.keyWord,fieldType:this.parent.dataType},n=_.map(this.value,(function(e){return e.name}));this.$http.post("/adHoc/constants",a,!0).done((function(t){if(null!==t&&void 0!==t&&t.success){var a=[];_.forEach(t.data,(function(t,i){if(t||0===t){var s={index:e.pagination.pageSize*(e.pagination.pageNum-1)+i,name:t,choosed:!1,id:dsf.uuid()},o=n.indexOf(t.toString());o>-1&&(s.choosed=!0,e.value[o].index=s.index,e.value[o].isInput=!1),a.push(s)}})),a.length&&e.pagination.pageNum>1&&e.checkConfig.checkAll&&(e.checkConfig.checkAll=!1,e.checkConfig.isIndeterminate=!0),(!a.length||a.length<e.pagination.pageSize)&&(e.pagination.noData=!0),e.data=e.data.concat(a)}else dsf.layer.message(t.message,!1)})).error((function(e){dsf.layer.message(e.message,!1)})).always((function(){e.loading=!1,e.contentHeight=e.data.length*($(e.$refs.headTitle.$el).height()+16)+"px",e.updateVisibleData()}))},checkAll:function(e){this.checkConfig.constChoose=e?_.map(this.data,(function(e,t){return t})):[],this.checkConfig.isIndeterminate=!1},changeState:function(){var e=this.checkConfig.constChoose.length;1==this.maxLength&&e>1?this.checkConfig.constChoose=[_.last(this.checkConfig.constChoose)]:2==this.maxLength&&e>2&&this.checkConfig.constChoose.shift(),this.checkConfig.checkAll=e+this.checkConfig.choosedL===this.data.length,this.checkConfig.isIndeterminate=e>0&&e<this.data.length-this.checkConfig.choosedL},chooseFn:function(){var e=this;if(this.inputValue){var t=this.inputValue.split(/[/\t,/\n,-\s]/);_.forEach(t,(function(t){t&&e.value.push({name:t,index:dsf.uuid(),isInput:!0})})),this.inputValue=""}if(_.forEach(this.checkConfig.constChoose,(function(t){var a=e.data[t];a.choosed||(a.choosed=!0,e.checkConfig.choosedL++,1==e.maxLength&&e.resetFn(),e.value.push(a))})),2==this.maxLength&&this.value.length>2){var a=this.value.length-2;_.forEachRight(this.value,(function(t,n){n<a&&e.deleteFn(t,n)}))}this.checkConfig.constChoose=[],this.checkConfig.checkAll=!1,this.checkConfig.isIndeterminate=!1},deleteFn:function(e,t){if(!e.isInput){var a=e.index;this.data[a].choosed=!1,this.checkConfig.choosedL--}dsf.array.removeAt(this.value,t),this.changeState()},resetFn:function(){var e=this;_.forEach(this.value,(function(t){if(!t.isInput){var a=t.index;e.data[a].choosed=!1}})),this.value=[],this.checkConfig.choosedL=0,this.changeState()},sureFn:function(){var e=_.map(this.value,(function(e){return e.name}));null!==e&&void 0!==e&&e.length?this.maxLength&&e.length>this.maxLength?dsf.layer.message("已超出选择数量上限【"+this.maxLength+"】",!1):(2==this.maxLength?(this.parent.value=e[0],e[1]&&(this.parent.value2=e[1])):this.parent.value=e.join(" "),this.closeFn()):dsf.layer.message("请选择数据",!1)},closeFn:function(){this.visible=!1},paginationScroll:function(e){if(!this.loading){var t=e.target;t.scrollHeight-t.clientHeight-t.scrollTop<20&&!this.loading&&!this.pagination.noData?this.paginationLoad():(this.scrollTop=t.scrollTop,this.updateVisibleData())}},paginationLoad:function(){this.loading=!0,this.pagination.pageNum++,this.getDataConst()},updateVisibleData:function(){var e=$(this.$refs.headTitle.$el).height()+16,t=Math.floor((this.scrollTop||0)/e),a=t+20;this.visibleData=this.data.slice(t,a),this.offset=t*e,this.$forceUpdate()}}},o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},1276:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.data?a("div",{staticClass:"split"},[a("div",{staticClass:"inner"})]):e._e()},i=[],s={name:"split",data:function(){return{}},inject:{$customDropTree:{default:null}},props:{data:{type:Object,default:function(){return null}},pos:{type:String,default:""}},mounted:function(){this.$customDropTree.isReadOnly||this.initDrop()},watch:{"$customDropTree.isReadOnly":function(e,t){var a,n,i,s;e?null===(a=$(this.$el))||void 0===a||null===(n=a.droppable)||void 0===n||n.call(a,"disable"):null===(i=$(this.$el))||void 0===i||null===(s=i.droppable)||void 0===s||s.call(i,"enable")}},methods:{initDrop:function(){var e=this;$(this.$el).droppable({accept:e.$customDropTree.acceptDrag,greedy:!0,tolerance:"pointer",hoverClass:"split-hover",drop:function(t,a){if(e.pos){var n;if(e.$customDropTree.dragStart)n=a.draggable.get(0).__vue__.data;else{var i=e.$customDropTree.dragData(a);if(dsf.isEmptyObject(i))return!1;n=e.$customDropTree.setDataReal(i)}n.$hash!=e.data.$hash&&e.dropToSplit(n,e.data,e.pos)}e.$customDropTree.dragStart=!1}})},dropToSplit:function(e,t,a){var n,i,s=null===e||void 0===e||null===(n=e.parent)||void 0===n?void 0:n.items;s&&dsf.array.remove(s,e);var o=null===t||void 0===t||null===(i=t.parent)||void 0===i?void 0:i.items,l=_.findIndex(o,(function(e){return e==t}));l>=0&&("after"==a&&l++,o.splice(l,0,e)),this.$customDropTree.resetTree()}}},o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},1283:function(e,t,a){"use strict";a.r(t);var n,i,s=dsf.component((function(){var e=dsf.getComponentOptions($components.platform.DsfTreeSelector);return{name:"DsfCheckNode",mixins:[e],ctrlCaption:"部门人员选择页面",props:{nodeKey:{type:String,default:"_id"}},created:function(){this.isCheckNodeCtrl=!0}}})),o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},547:function(e,t,a){var n=a(730);"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=a(19).default;i("78d9847d",n,!0,{sourceMap:!1,shadowMode:!1})},729:function(e,t,a){"use strict";a(547)},730:function(e,t,a){"use strict";a.r(t)},934:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ds-custom-drop-tree_item",on:{contextmenu:e.onContextmenu}},[a("div",{staticClass:"item-nothover"},[e._t("default",(function(){return[a("span",{staticClass:"item-field"},[e._v(e._s(e.data.field||"无字段"))]),a("el-select",{staticClass:"item-op",attrs:{size:"small",disabled:!e.notReadOnly},model:{value:e.data.operator,callback:function(t){e.$set(e.data,"operator",t)},expression:"data.operator"}},e._l(e.operatorOpts[e.operatorOptsKey],(function(t){return a("el-option",{key:t.value,staticClass:"ds-custom-drop-tree_item_operator",attrs:{label:t.label,value:t.value}},[a("span",[e._v(e._s(t.label))]),a("i",{staticClass:"iconfont bangzhuzhongxin icon-bangzhuzhongxin desc-striking",attrs:{title:t.label+"："+e.operatorInfo[t.label]}})])})),1),"is_null"!=e.data.operator&&"is_not_null"!=e.data.operator?a("div",{staticClass:"item-value"},[["like","slike","elike","in_list","not_in_list"].includes(e.data.operator)?[a("el-input",{attrs:{size:"small",disabled:!e.notReadOnly||e.data.isFormulaValue},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}})]:[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,size:"small",disabled:!e.notReadOnly||e.data.isFormulaValue},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}})]],2):e._e(),"is_null"!=e.data.operator&&"is_not_null"!=e.data.operator&&"between"==e.data.operator||"gtlt"==e.data.operator?[a("span",{staticClass:"item-text"},[e._v("至")]),a("div",{staticClass:"item-value"},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,size:"small",disabled:!e.notReadOnly||e.data.isFormulaValue},model:{value:e.data.value2,callback:function(t){e.$set(e.data,"value2",t)},expression:"data.value2"}})],1)]:e._e(),e.notReadOnly&&"is_null"!=e.data.operator&&"is_not_null"!=e.data.operator?a("i",{staticClass:"iconfont icon-rukuqingkuang const",attrs:{title:"选择"},on:{click:e.openChoose}}):e._e()]}),{data:e.data}),e._t("more",null,{data:e.owner}),!e.notReadOnly||e.data.isReadOnly||e.data.items?e._e():a("div",{staticClass:"item-close",on:{click:function(t){return e.remove()}}},[a("DsfIcon",{attrs:{name:"icon_close",title:"删除"}})],1)],2),e.notReadOnly?a("div",{staticClass:"item-hovering"},[a("div",{staticClass:"pos-top",on:{mouseover:function(t){return e.mouseOverHandler(t,"before")}}}),a("div",{staticClass:"pos-bottom",on:{mouseover:function(t){return e.mouseOverHandler(t,"after")}}})]):e._e(),e._t("bottom",null,{data:e.owner}),a("choose-dialog",{ref:"chooseDialog",attrs:{resourceId:e.$customDropTree.resourceId}})],2)},i=[],s={name:"item",components:{chooseDialog:function(){return a.e(70).then(a.bind(null,1275))}},props:{data:{type:Object,default:function(){return{}}}},inject:{$customDropTree:{default:null}},data:function(){return{hover:!1,pos:"",owner:this,operatorOpts:{isEncrypt:[{label:"等于",value:"eq"},{label:"不等于",value:"noteq"},{label:"空",value:"is_null"},{label:"非空",value:"is_not_null"}],unEncrypt:[{label:"模糊匹配",value:"like"},{label:"开头匹配",value:"slike"},{label:"结尾匹配",value:"elike"},{label:"等于",value:"eq"},{label:"不等于",value:"noteq"},{label:"小于",value:"lt"},{label:"大于",value:"gt"},{label:"小于等于",value:"lteq"},{label:"大于等于",value:"gteq"},{label:"介于",value:"gtlt"},{label:"区间",value:"between"},{label:"空",value:"is_null"},{label:"非空",value:"is_not_null"},{label:"在列表",value:"in_list"},{label:"不在列表",value:"not_in_list"}],isFormulaValue:[{label:"模糊匹配",value:"like"},{label:"开头匹配",value:"slike"},{label:"结尾匹配",value:"elike"},{label:"等于",value:"eq"},{label:"不等于",value:"noteq"},{label:"小于",value:"lt"},{label:"大于",value:"gt"},{label:"小于等于",value:"lteq"},{label:"大于等于",value:"gteq"},{label:"空",value:"is_null"},{label:"非空",value:"is_not_null"},{label:"在列表",value:"in_list"},{label:"不在列表",value:"not_in_list"}]},operatorInfo:{"开头匹配":"查询以指定字符开头的所有结果，如：输入”张“，会查询该字段以张开头的所有项","模糊匹配":"查询含有指定字符的所有结果，如：输入”张“，会查询该字段含有张的所有项","结尾匹配":"查询以指定字符结尾的所有结果，如：输入”张“，会查询该字段以张结尾的所有项","等于":"查询指定字符的所有结果，如：输入“张”，只会查询张的所有项","不等于":"查询不是指定字符的所有结果，如：输入“张”，只会查询不为张的所有项","空":"查询为空的所有结果","非空":"查询不为空的所有结果","小于":"查询小于输入数值的所有项","大于":"查询大于输入数值的所有项","小于等于":"查询小于等于输入数值的所有项","大于等于":"查询大于等于输入数值的所有项","介于":"查询在两个数值之间并且不包含两个数值的所有项","区间":"查询在两个数值之间并且包含两个数值的所有项","在列表":"查询输入项在列表的所有项","不在列表":"查询输入项不在列表的其他所有项"}}},computed:{notReadOnly:function(){return!this.$customDropTree.isReadOnly},show:function(){return this.notReadOnly&&"is_null"!=this.data.operator&&"is_not_null"!=this.data.operator},operatorOptsKey:function(){return this.data.isFormulaValue?"isFormulaValue":this.data.isEncrypt?"isEncrypt":"unEncrypt"}},created:function(){this.$customDropTree.buildTreeRelation()},mounted:function(){this.notReadOnly&&(this.initDrag(),this.initDrop())},watch:{notReadOnly:function(e,t){var a,n,i,s,o,l,r,d;e?(null===(a=$(this.$el))||void 0===a||null===(n=a.droppable)||void 0===n||n.call(a,"disable"),null===(i=$(this.$el))||void 0===i||null===(s=i.draggable)||void 0===s||s.call(i,"disable")):(null===(o=$(this.$el))||void 0===o||null===(l=o.droppable)||void 0===l||l.call(o,"enable"),null===(r=$(this.$el))||void 0===r||null===(d=r.draggable)||void 0===d||d.call(r,"enable"))}},methods:{querySearchAsync:function(e,t){var a=this.data.code.split("."),n={adHocQueryColumn:JSON.stringify({tableName:this.data.originTableName||this.data.tableName||a[0],tableAlias:this.data.realTableName||this.data.tableAlias,fieldName:a[1]}),resourceId:this.$customDropTree.resourceId||dsf.url.queryString("resourceId"),pageNum:1,pageSize:10,filter:e,fieldType:this.data.dataType};this.$http.post("/adHoc/constants",n,!0).done((function(e){if(null!==e&&void 0!==e&&e.success){var a=[];_.forEach(e.data,(function(e,t){if(e||0===e){var n={value:e+""};a.push(n)}})),t(a)}else t([]),dsf.layer.message(e.message,!1)})).error((function(e){t([]),dsf.layer.message(e.message,!1)}))},isCommonInput:function(){var e=["like","slike","elike","in_list","not_in_list"];return e.includes(this.data.operator)},initDrag:function(){var e=this;$(this.$el).draggable({helper:"clone",cursor:"move",scroll:!0,refreshPositions:!0,appendTo:e.$customDropTree.getContainer,zIndex:999,revert:"invalid",distance:5,delay:100,cursorAt:{left:-5,top:-5},drag:function(t,a){e.$customDropTree.dragAutoScroll({top:t.clientY,left:t.clientX})},stop:function(){e.$customDropTree.dragStart=!1},start:function(){e.$customDropTree.dragStart=!0}})},initDrop:function(){var e=this;$(this.$el).droppable({accept:e.$customDropTree.acceptDrag,greedy:!0,tolerance:"pointer",hoverClass:"drop-hover",drop:function(t,a){if(e.pos){var n;if(e.$customDropTree.dragStart)n=a.draggable.get(0).__vue__.data;else{var i=e.$customDropTree.dragData(a);if(dsf.isEmptyObject(i))return!1;n=e.$customDropTree.setDataReal(i)}e.dropToItem(n,e.data,e.pos)}e.$customDropTree.dragStart=!1,e.pos=""}})},remove:function(){this.$customDropTree.removeNode(this.data)},mouseOverHandler:function(e,t){this.pos=t},dropToItem:function(e,t,a){this.removeNodeFromNode(e),this.insertNode(e,t,a),this.$customDropTree.resetTree()},removeNodeFromNode:function(e){var t,a=null===e||void 0===e||null===(t=e.parent)||void 0===t?void 0:t.items;a&&dsf.array.remove(a,e)},insertNode:function(e,t,a){var n,i={logic:this.$customDropTree.defaultLogic,items:[]};"after"==a?(i.items.push(t),i.items.push(e)):(i.items.push(e),i.items.push(t));var s=null===t||void 0===t||null===(n=t.parent)||void 0===n?void 0:n.items;if(s){var o=_.findIndex(s,(function(e){return e==t}));1==s.length&&(i.logic=t.parent.logic),this.$customDropTree.setNode(i),o>=0&&s.splice(o,1,i)}},onContextmenu:function(e){var t;if(null!==(t=this.$customDropTree)&&void 0!==t&&null!==(t=t.vContentMenu)&&void 0!==t&&t.length&&this.notReadOnly){e.preventDefault(),e.stopPropagation();var a=Vue.directive("contextMenu").contextMenuClick,n={x:e.clientX,y:e.clientY};a(n,this.data,this.$customDropTree.vContentMenu,this.$el,e)}},openChoose:function(){this.$refs.chooseDialog.openFn(this.data)}}},o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},935:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group",class:{group__expand:e.expand}},[a("span",{staticClass:"group-join",class:{disabled:e.disabledChangeLogic},on:{click:e.changeLogic,mousedown:function(e){e.preventDefault()}}},[e._v(" "+e._s(e.getLogicStr())+" ")]),e.data.$isRoot?e._e():a("span",{staticClass:"group-expand",on:{mousedown:function(e){e.preventDefault()}}},[e.expand?a("DsfIcon",{attrs:{name:"jian",title:"折叠"},on:{click:function(t){return t.stopPropagation(),e.expandHandler.apply(null,arguments)}}}):a("DsfIcon",{attrs:{name:"jia",title:"展开"},on:{click:function(t){return t.stopPropagation(),e.expandHandler.apply(null,arguments)}}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.expand,expression:"expand"}],staticClass:"group-box"},[a("div",{staticClass:"group-brackets"}),a("div",{staticClass:"items"},[e._l(e.data.items,(function(t,n){return[a("split",{key:t.$hash+"—before",attrs:{data:t,pos:"before"}}),a("DsfCustomDropTreeLogicNode",{key:t.$hash,attrs:{data:t},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return[e._t("default",null,{data:a})]}},{key:"more",fn:function(t){var a=t.data;return[e._t("more",null,{data:a})]}},{key:"bottom",fn:function(t){var a=t.data;return[e._t("bottom",null,{data:a})]}}],null,!0)}),n==e.data.items.length-1?a("split",{key:t.$hash+"-after",attrs:{data:t,pos:"after"}}):e._e()]}))],2)]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.expand,expression:"!expand"}],staticClass:"group-box-contract",on:{click:function(t){return t.stopPropagation(),e.expandHandler.apply(null,arguments)}}},[a("span",{attrs:{title:"展开"}},[e._v(e._s(e.data.items.length+"个子条件"))])])])},i=[],s={name:"group",components:{split:function(){return a.e(70).then(a.bind(null,1276))}},inject:{$customDropTree:{default:null}},props:{data:{type:Object,default:function(){return{items:[]}}}},data:function(){return{expand:!0,hasItemReadOnly:!1}},created:function(){var e=this;_.forEach(this.data.items,(function(t){t.isReadOnly&&(e.hasItemReadOnly=!0),e.$customDropTree.setNode(t)})),this.data.logic||(this.data.logic=this.$customDropTree.defaultLogic)},computed:{disabledChangeLogic:function(){return this.$customDropTree.isReadOnly||this.data.isReadOnly||this.hasItemReadOnly}},methods:{changeLogic:function(){this.disabledChangeLogic||(this.data.logic=this.$customDropTree.changeLogic(this.data))},getLogicStr:function(){return this.$customDropTree.logic[this.data.logic]},expandHandler:function(){this.expand=!this.expand}},watch:{"data.items":function(e,t){var a=this;this.$nextTick((function(){a.$customDropTree.buildTreeRelation()}))}}},o=s,l=a(0),r=Object(l["a"])(o,n,i,!1,null,null,null);t["default"]=r.exports},945:function(e,t,a){"use strict";a.r(t);var n=a(7),i=a.n(n);t["default"]={name:"DsfCustomDropTreeLogicNode",components:{item:function(){return a.e(70).then(a.bind(null,934))},group:function(){return a.e(70).then(a.bind(null,935))}},inject:{$customDropTree:{default:null}},props:{data:{type:Object,default:function(){return null}}},created:function(){this.data&&this.$customDropTree&&this.$customDropTree.setNode(this.data)},methods:{renderGroup:function(e,t){var a=this;return e("group",i()([{},{props:{data:t}},{scopedSlots:{default:function(e){var t=e.data;return a.$scopedSlots.default({data:t})},more:function(e){var t=e.data;return a.$scopedSlots.more({data:t})},bottom:function(e){var t=e.data;return a.$scopedSlots.bottom({data:t})}}}]))},renderItem:function(e,t){var a=this;return e("item",i()([{},{props:{data:t}},{scopedSlots:{default:function(e){var t=e.data;return a.$scopedSlots.default({data:t})},more:function(e){var t=e.data;return a.$scopedSlots.more({data:t})},bottom:function(e){var t=e.data;return a.$scopedSlots.bottom({data:t})}}}]))}},render:function(e){if(this.data.isGroup){if(this.data.items.length>1)return this.renderGroup(e,this.data);if(1==this.data.items.length){var t,a,n=this.data.items[0];return(null===n||void 0===n||null===(t=n.items)||void 0===t?void 0:t.length)>1?this.renderGroup(e,n):1==(null===n||void 0===n||null===(a=n.items)||void 0===a?void 0:a.length)?this.renderItem(e,n.items[0]):this.renderItem(e,n)}}else if(this.data.isLeaf&&dsf.isDef(this.data.field))return this.renderItem(e,this.data);return e()}}},971:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.reloadDataLoading,expression:"reloadDataLoading"}],staticClass:"ds-control ds-navtree ds-tree ds-no-padding",class:{"tree-loaded":!e.loading,"has-btns":e.rowButtons.length>0},on:{mousedown:function(t){return e.mouseDownHandler(t)}}},[a("DsfPanel",{staticClass:"fit",attrs:{hasHeader:e.hasHeader},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0},{key:"header-left",fn:function(){return[e._t("header-left")]},proxy:!0},{key:"header-subtitle",fn:function(){return[e._t("header-subtitle")]},proxy:!0},{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[[a("div",{staticClass:"searchbox"},[e._t("search",(function(){return[e.openSearchBox?a("el-input",{attrs:{placeholder:e.inputPlaceholder},nativeOn:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.filterText=e.filterTextVal}},model:{value:e.filterTextVal,callback:function(t){e.filterTextVal=t},expression:"filterTextVal"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix",title:"检索"},on:{click:function(t){e.filterText=e.filterTextVal}},slot:"suffix"})]):e._e()]})),e._t("searchboxSolt")],2),a("DsfVirtualScroll",{staticClass:"ds-tree-box",attrs:{"scroll-y":"","scroll-x":""}},[a("el-tree",e._b({directives:[{name:"show",rawName:"v-show",value:e.$async&&e.searchSqlUrl&&e.filterText,expression:"$async && searchSqlUrl && filterText"}],ref:"tree2",attrs:{"empty-text":e.searchLoaded?"暂无匹配数据":"数据查询中...","default-expand-all":!0,data:e.searchData,"check-strictly":!0},on:{"check-change":e.checkChange2,"current-change":e.currNodeChange},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return e._t("default",(function(){return[a("NavTreeNode",{attrs:{node:n},scopedSlots:e._u([{key:"nodeLabel",fn:function(t){var a=t.data;return[e._t("nodeLabel",null,{data:a})]}}],null,!0)})]}))}}],null,!0)},"el-tree",e.elTreeAttrsCore,!1)),a("el-tree",e._b({directives:[{name:"show",rawName:"v-show",value:!e.$async||!e.searchSqlUrl||""==e.filterText,expression:"!$async || !searchSqlUrl || filterText == ''"}],ref:"tree",attrs:{"empty-text":e.loading?"数据查询中...":"暂无数据","default-expanded-keys":e.expandedKeys,lazy:e.$async,"filter-node-method":e.filterNode,"check-strictly":e.checkStrictly,draggable:e.openDraggable,"allow-drag":e.allowDrag,"allow-drop":e.allowDrop},on:{"check-change":e.checkChange,"current-change":e.currNodeChange,"node-expand":e.nodeExpand,"node-collapse":e.nodeCollapse,"node-drag-start":e.handleDragStart,"node-drag-enter":e.handleDragEnter,"node-drag-leave":e.handleDragLeave,"node-drag-over":e.handleDragOver,"node-drag-end":e.handleDragEnd,"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return e._t("default",(function(){return[a("NavTreeNode",{attrs:{node:n},scopedSlots:e._u([{key:"nodeLabel",fn:function(t){var a=t.data;return[e._t("nodeLabel",null,{data:a})]}}],null,!0)})]}))}},{key:"empty",fn:function(){return[e.loading?e._e():a("dsf-empty-data"),e.loading?a("span",[e._v("数据查询中...")]):e._e()]},proxy:!0}],null,!0)},"el-tree",e.elTreeAttrs,!1))],1)]],2)],1)},i=[],s=a(2),o=a.n(s),l=a(3),r=a.n(l),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"custom-tree-node",class:{"show-more":e.moreBtnShow},on:{mouseenter:e.mouseEnterHandler}},[a("div",{directives:[{name:"context-menu",rawName:"v-context-menu",value:{params:e.params,data:e.$menuButtons},expression:"{ params: params, data: $menuButtons }"}],staticClass:"tree-name",attrs:{id:e.data._id+"_navtree_nodeid"},on:{click:function(t){return t.stopPropagation(),e.currNodeChange.apply(null,arguments)}}},[a("span",{staticClass:"tree-name-label"},[e.$navTreeCtrl.icons?e._l(e.$navTreeCtrl.icons.filter((function(t){return""!=e.getIconClass(t,e.node)[0]})),(function(t,n){return a("i",{key:n,staticClass:"iconfont",class:e.getIconClass(t,e.node),style:{color:t.color}})})):[void 0!==e.data[e.$navTreeCtrl.defaultProps.children]&&e.$navTreeCtrl.showIcon?a("i",{class:["iconfont",e.node.expanded?"icon-dakai":"icon-wenjianjia"]}):e.$navTreeCtrl.showIcon?a("i",{staticClass:"iconfont icon-shiyongwendang"}):e._e(),e._t("nodeLabel",(function(){return[a("span",{domProps:{innerHTML:e._s(e.dsf.safe.xss(e.data[e.$navTreeCtrl.defaultProps.label]))}})]}),{data:e.data})],e._t("nodeLabel",(function(){return[a("span",{attrs:{title:e.dsf.safe.xss(e.data[e.$navTreeCtrl.defaultProps.label])},domProps:{innerHTML:e._s(e.dsf.safe.xss(e.data[e.$navTreeCtrl.defaultProps.label]))}})]}),{data:e.data})],2),e.needGetContextMenuData?a("span",{on:{click:function(e){e.stopPropagation()}}},[e.contextMenuData?e._e():a("div",{staticClass:"ds-no-padding edit-span"},[a("i",{staticClass:"iconfont icon-gengduo1",class:e.loadingBtns?"el-icon-loading":"icon-gengduo1",on:{click:e.getContextMenuData}})]),e.contextMenuData?a("DsfButtonBar",{ref:"btnCtrl",staticClass:"ds-no-padding edit-span",attrs:{moreButtonRenderPro:!0,"render-button":e.$navTreeCtrl.renderRowButton,"max-number":e.$navTreeCtrl.buttonsMaxNumber,"more-button-style":"icon-text","more-button-text":"",buttons:e.contextMenuData,"emit-prefix":"row-button",local:e.data,moreBtnColNum:e.$navTreeCtrl.moreBtnColNum,size:"small",align:"left"},on:{popoverState:e.popoverStateFn,moreButtonReady:e.moreButtonReady}}):a("DsfButtonBar",{ref:"btnCtrl",staticClass:"ds-no-padding edit-span",attrs:{moreButtonRenderPro:!0,local:e.data}})],1):e.isMouseEnter&&e.buttons.length>0?a("span",{on:{click:function(e){e.stopPropagation()}}},[a("DsfButtonBar",{ref:"btnCtrl",staticClass:"ds-no-padding edit-span",attrs:{"render-button":e.$navTreeCtrl.renderRowButton,"max-number":e.$navTreeCtrl.buttonsMaxNumber,"more-button-style":"icon-text","more-button-text":"",buttons:e.buttons,"emit-prefix":"row-button",local:e.data,moreBtnColNum:e.$navTreeCtrl.moreBtnColNum,size:"small",align:"left"},on:{popoverState:e.popoverStateFn}})],1):e._e()])])},c=[];function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){r()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={name:"navTreeNode",inject:{$navTreeCtrl:{default:null}},props:{node:{type:Object,default:function(){return null}}},data:function(){return{data:{},treeClickNum:0,treeClickTemp:null,params:{},buttons:[],isMouseEnter:!1,moreBtnShow:!1,needGetContextMenuData:!1,contextMenuData:null,loadingBtns:!1}},computed:{$menuButtons:function(){var e=this,t=[];if(_.forEach(this.buttons,(function(e){e.isContextmenu&&t.push(e)})),(null===t||void 0===t?void 0:t.length)>0){var a=[];return _.forEach(t,(function(t){var n=[];t.isUpload&&(n=e.getButtonParams(t));var i,s=!1;t.isUpload&&(s={action:dsf.url.getWebPath(n[0]),data:n[1],accept:null===(i=n[2])||void 0===i?void 0:i.split("|").map((function(e){return e=e.toLowerCase(),dsf.mime[e]||e})).join(",")});a.push({icon:("icon-"===t.icon.slice(0,5)?"":"icon-")+t.icon,name:t.text||t.caption,upload:s,hide:function(a){var n,i;null===(n=e.$refs.btnCtrl)||void 0===n||null===(n=n.$refs)||void 0===n||null===(n=n["more-button-popover"])||void 0===n||null===(i=n.doClose)||void 0===i||i.call(n);var s=e.$refs.btnCtrl;return!s||!s.showAndHide(t)},disabled:function(a){var n=e.$refs.btnCtrl;return!n||(n.disabledFactor(t),t.disabled)},handler:function(a){var n;e.$refs.btnCtrl.clickHandler(t,a.el,null===(n=a.response)||void 0===n?void 0:n.data)}})})),a}return[]}},created:function(){this.needGetContextMenuData=!!this.$navTreeCtrl.$listeners.contextMenuData,this.data=this.node.data,this.params=h({$vm:this.$navTreeCtrl},this.node)},mounted:function(){this.scrollEl=dsf.findScrollEl(this.$el),this.scrollEl.addEventListener("scroll",this.handlerScroll,!0)},methods:{moreButtonReady:function(){this.loadingBtns&&this.$refs.btnCtrl.$refs["more-button-popover"]&&(this.$refs.btnCtrl.$refs["more-button-popover"].showPopper=!0)},getContextMenuData:function(){var e=this;this.loadingBtns=!0;var t=this.buttons;_.forEach(t,(function(e){e.name=e.text})),new Promise((function(a){e.$navTreeCtrl.$dispatch("contextMenuData",{params:e.node,data:t,resolve:a})})).then((function(t){e.contextMenuData=t||[]}))},popoverStateFn:function(e){this.moreBtnShow=!e},handlerScroll:function(e){var t,a=e.target.scrollTop,n=this.$navTreeCtrl.$el.getElementsByClassName("ds-tree-box")[0].clientHeight;if(this.isMouseEnter&&null!==this&&void 0!==this&&null!==(t=this.$refs)&&void 0!==t&&t.btnCtrl&&!this.$refs.btnCtrl.moreFold){var i,s,o=this.$el.offsetTop,l=this.$el.clientHeight;if(a>o+l||o>a+n)null===(i=this.$refs.btnCtrl)||void 0===i||null===(i=i.$refs)||void 0===i||null===(i=i["more-button-popover"])||void 0===i||null===(s=i.doClose)||void 0===s||s.call(i)}},mouseEnterHandler:function(){this.isMouseEnter=!0},nodeContextmenu:function(e){document.body.click(),e.stopPropagation(),e.preventDefault();var t=Vue.directive("contextMenu").contextMenuClick;t({x:e.clientX,y:e.clientY},this.params,this.$menuButtons,e.target,e)},createMenuButtonBar:function(){var e=this,t={};["$vm","$page","$form","$dialog"].forEach((function(a){t[a]={default:e.$navTreeCtrl[a]}}));var a=Vue.extend({mixins:[window.$components["platform"]["DsfButtonBar"]],inject:t}),n=new a({propsData:{isDesign:!1,owner:this,local:this.node.data}});return n},currNodeChange:function(){this.treeClickNum++;var e=this;e.treeClickTemp=window.setTimeout((function(){e.$navTreeCtrl.currNodeChange(e.node.data,e.node),e.$navTreeCtrl.$refs.tree.setCurrentKey(e.node.key),e.treeClickNum>=2&&e.$navTreeCtrl.dblclickIsOpen&&(e.node.expanded?e.node.expanded=!1:e.node.expand(),window.getSelection?window.getSelection().removeAllRanges():document.getSelection.empty()),e.treeClickNum=0,clearTimeout(e.treeClickTemp)}),300)},getIconClass:function(e,t){return dsf.express.eval(e.code,t.data)?t.expanded?[e.iconExpand||""]:[e.iconFold||""]:[""]},getMenuButtons:function(){},isFunctionCode:function(e){var t=/^\s*function(\s+\w*)?\(.*\)\s*{/g;return t.test(e)},execFunction:function(e,t,a){var n=["var result= ("+a+").call(this,data,button,owner,self);","data=null;","button=null;","owner=null;","self=null;","return result;"],i=new Function("data","button","owner","self",n.join("\n")),s=i.call(this.$vm,this.local,e,t,this);return s=this.$replace(s,this.local),s},getButtonParams:function(e){var t=this,a=this.$navTreeCtrl.owner||this.$navTreeCtrl,n=_.map(e.params,(function(n){var i=null;if("string"==dsf.type(n.value)){var s=n.value.trim();i=t.isFunctionCode(s)?t.execFunction(e,a,s):s}else if("object"==dsf.type(n.value))if("static"==n.value.type){var o=n.value.code||"";i=o}else if("switch"==n.value.type){var l=t.local[n.value.code.field]||"";i=l}else{var r=n.value.code;t.isFunctionCode(r)&&(i=t.execFunction(e,a,r))}return(""==i||dsf.isUnDef(i))&&(i=n.default||null),"false"===i?i=!1:"true"===i&&(i=!0),i}));return n},getRowButtons:function(e){return dsf.mix(!0,[],e||[])}},beforeDestroy:function(){this.treeClickTemp&&clearTimeout(this.treeClickTemp),this.menuButtonBar&&this.menuButtonBar.$destroy(),this.scrollEl.removeEventListener("scroll",this.handlerScroll,!0)},watch:{"$navTreeCtrl.rowButtons":{handler:function(e,t){this.buttons=this.getRowButtons(this.$navTreeCtrl.rowButtons)},immediate:!0}}},p=f,v=a(0),g=Object(v["a"])(p,d,c,!1,null,null,null),m=g.exports,y=dsf.component({name:"DsfNavTree",ctrlCaption:"导航树",mixins:[$mixins.control,$mixins.tree],components:{NavTreeNode:m},provide:function(){return{$buttonOwner:this,$navTreeCtrl:this}},design:{fit:!0,metadata:{isDeep:!1,create:function(e){for(var t,a,n={},i=[],s=[],o=0;o<this.searchInfo.length;o++){var l=this.searchInfo[o],r=null;"0"==l.type?(r={code:l.code,operator:l.operation,valueKey:"searchValue",dataType:l.dataType,format:l.format},i.push(r)):(r={code:l.code,operator:l.operation,valueKey:l.code,dataType:l.dataType,format:l.format},s.push(r),l.metadata_fullcode=r.code)}var d={logic:"or",items:[]};(t=d.items).push.apply(t,i);var c={logic:"and",items:[]};(a=c.items).push.apply(a,s);var u={logic:"and",items:[]};u.items.push(d),u.items.push(c),n=u;var h={query:n,self:this,metadata:this.metadata,browseScope:this.browseScope};return this.buildMetadata?[h]:[]}}},props:{metadata:{type:Object,default:function(){return dsf.metadata.get("nav-tree-meta-data")}},label:{type:String,default:"导航树"},inputPlaceholder:{type:String,default:"请输入查询关键字"},hasHeader:{type:Boolean,default:!0},showIcon:{type:Boolean,default:!0},openSearchBox:{type:Boolean,default:!0},disabledBeforeLoaded:{type:Boolean,default:!0},openWebroot:{type:Boolean,default:!1},webrootName:{type:String,default:""},targetIframeName:{type:String,default:""},targetIframeSrc:{type:String,default:""},pId:{type:String,default:""},globalId:{type:String,default:""},maxLevel:{type:String,default:""},defaultOpenSeries:{type:String,default:"1"},defaultOrder:{type:String,default:""},searchInfo:{type:Array,default:function(){return[]}},filterKeyInfo:{type:Array,default:function(){return[{code:"_name",operation:"like"},{code:"pinyin",operation:"slike"},{code:"py",operation:"slike"}]}},initDataSource:{type:String,default:"1"},initDataSourceUrl:{type:String,default:""},asyncUrl:{type:String,default:""},chooseMetaData:{type:Object,default:function(){return{attach:[]}}},async:{type:Boolean,default:!1},asyncDataSource:{type:String,default:"1"},asyncChooseMetaData:{type:Object,default:function(){return{}}},metadata_fullcode:{type:String,default:""},browseScope:{type:Object,default:function(){return{scope:"2",unit:[]}}},icons:{type:Array,default:function(){return[{code:"!@[children]",iconExpand:"icon-shiyongwendang",iconFold:"icon-shiyongwendang",color:"#6594dc"},{code:"!!@[children]",iconExpand:"icon-dakai",iconFold:"icon-wenjianjia",color:"#c78511"}]}},rowButtons:{type:Array,default:function(){return[]}},renderRowButton:{type:Function,default:null},menusButtons:{type:Array,default:function(){return[]}},setIframePath:{type:Function,default:null},showCheckbox:{type:Boolean,default:function(){return!1}},checkedKeys:{type:Array,default:function(){return[]}},buildMetadata:{type:Boolean,default:!0},checkStrictly:{type:Boolean,default:!1},initSelectionNode:{type:Function,default:null},searchSqlUrl:{type:String,default:""},searchPidKey:{type:String,default:"pid"},hasPrefix:{type:Boolean,default:!1},dblclickIsOpen:{type:Boolean,default:!1},openDraggable:{type:Boolean,default:!1},allowDrag:{type:Function,default:function(){return function(){return!0}}},allowDrop:{type:Function,default:function(){return function(){return!0}}},btnUpdated:{type:Boolean,default:!1},buttonsMaxNumber:{type:Number,default:0},moreBtnColNum:{type:Number,default:10},virtualRootKey:{type:String,default:"virtualRoot"}},data:function(){return{metadataFullcode:this.metadata_fullcode,expandedKeys:[],filterText:"",filterTextVal:"",defaultProps:{children:"children",label:"_name",key:"_id",isLeaf:"isLeaf"},data:[],resolve:null,loading:!1,currNode:null,searchData:[],searchLoaded:!1,searchCheckedNodes:[],reloadDataLoading:!1}},computed:{elTreeAttrsCore:function(){return{props:this.defaultProps,class:"filter-tree ds-tree-select-tree-box","default-checked-keys":this.showCheckbox?this.checkedKeys:[],"show-checkbox":this.showCheckbox,"check-on-click-node":this.showCheckbox,"node-key":"_id","highlight-current":!0,"expand-on-click-node":!1}},elTreeAttrs:function(){var e=this.elTreeAttrsCore;return this.$async?e.load=this.lazyLoad:e.data=this.data,e},keywords:function(){var e=this.filterText.trim();return""===e?[]:e.split(" ")},$async:function(){return this.async&&!this.isDesign},initOpenLevel:function(){return!this.defaultOpenSeries||this.defaultOpenSeries<=1?1:this.defaultOpenSeries}},watch:{filterText:function(e){this.searchLoaded=!1,this._filter(e)},initDataSourceUrl:function(){var e=1*this.initDataSource;3===e&&this.loadData(!0)}},mounted:function(){document.addEventListener("click",this.controlMenu)},beforeDestroy:function(){document.removeEventListener("click",this.controlMenu)},created:function(){var e,t;(this.tidyBtn(),this.isDesign||this.initEventFlow(),this.$vm&&this.$vm.isPreView)&&(null!==(e=this.$vm)&&void 0!==e&&e.nameSpace||(this.$vm.nameSpace=""),null!==(t=this.$vm)&&void 0!==t&&t.pageName||(this.$vm.pageName=""),this.metadataFullcode="");this.$async||this.loadData(!0,!1)},methods:{mouseDownHandler:function(e){var t,a,n,i,s;if(null===(t=e.target)||void 0===t||null===(t=t.parentNode)||void 0===t||null===(t=t.className)||void 0===t||null===(a=t.includes)||void 0===a||!a.call(t,"ds-tree-box")){if(null!==(n=e.target)&&void 0!==n&&null!==(i=n.closest)&&void 0!==i&&null!==(i=i.call(n,".el-tree-node__content"))&&void 0!==i&&null!==(s=i.getElementsByClassName)&&void 0!==s&&null!==(s=s.call(i,"custom-tree-node"))&&void 0!==s&&null!==(s=s[0])&&void 0!==s&&s.__vue__){var o,l,r,d,c,u=null===(o=e.target)||void 0===o||null===(l=o.closest)||void 0===l||null===(l=l.call(o,".el-tree-node__content"))||void 0===l||null===(r=l.getElementsByClassName)||void 0===r||null===(r=r.call(l,"custom-tree-node"))||void 0===r||null===(r=r[0])||void 0===r?void 0:r.__vue__;if(u.isMouseEnter&&null!==u&&void 0!==u&&null!==(d=u.$refs)&&void 0!==d&&d.btnCtrl&&(null===u||void 0===u||null===(c=u.$refs)||void 0===c||null===(c=c.btnCtrl)||void 0===c||!c.moreFold))return}document.body.click()}},tidyBtn:function(){var e=this;if(!this.btnUpdated){var t,a=[].concat(this.menusButtons);if(null!==(t=this.menusButtons)&&void 0!==t&&t.length){var n=_.map(a,(function(e){return e.isContextmenu=!0,e.id}));_.forEachRight(this.rowButtons,(function(t,a){n.includes(t.id)&&e.rowButtons.splice(a,1)}))}var i=[].concat(this.rowButtons,a);_.forEachRight(i,(function(e,t){e.text||(e.text=e.title),e.btnStyle_hidden=!1,e.iconPosition_hidden=!1,e.text_hidden=!1,e.type_hidden=!1})),this.$emit("update:btnUpdated",!0),this.$emit("update:menusButtons",[]),this.$emit("update:rowButtons",i)}},initEventFlow:function(){var e=this;this._updatePath=_.throttle(this.__updatePath,50,{leading:!1,trailing:!0}),this._selectedTree=_.throttle(this.__selectedTree,50,{leading:!1,trailing:!0}),this._filter=_.debounce((function(t){var a;(e.disabledBeforeLoaded&&(e.reloadDataLoading=!0),e.filterText=t,e.searchData=[],e.$async&&e.searchSqlUrl&&""!=t)?e.initLoadData(null,!0,t):(null===(a=e.$refs)||void 0===a||a.tree.filter(t),e.$nextTick((function(){e.searchLoaded=!0,e.reloadDataLoading=!1})))}),600)},getTreeNode:function(e){return this.$refs.tree.getNode(e)},checkChange2:function(e,t,a){this.checkChange(e,t,a,!0)},checkChange:function(e,t,a,n){var i;n&&(this.$refs.tree.setChecked(e._id,t),t?(this.searchCheckedNodes.push(e),this.searchCheckedNodes=_.uniqBy(this.searchCheckedNodes,"_id")):_.pullAllBy(this.searchCheckedNodes,[e],"_id"));var s=this.$refs.tree.getCheckedNodes(),o={},l=[];if(s.forEach((function(e){var t;(null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t.length)>0&&l.push(e._id)})),s=_.uniqBy(s.concat(s,this.searchCheckedNodes),"_id"),"0"==(null===(i=s)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.pid)){var r=s[0];Object.keys(r).forEach((function(e){"children"!==e&&(o[e]?o[e].push(r[e]):o[e]=[r[e]])}))}else{var d;null===(d=s)||void 0===d||d.forEach((function(e){(-1===l.indexOf(e.pid)||l.indexOf(e._id)>-1)&&Object.keys(e).forEach((function(t){"children"!==t&&(o[t]?o[t].push(e[t]):o[t]=[e[t]])}))}))}if(this.$vm&&this.$vm.frames){var c=this.$vm.frames[this.targetIframeName],u="";c&&(u=this.setIframePath?this.setIframePath(o,s):this.$replace(decodeURIComponent(this.targetIframeSrc),this.$expressParams(o)),this._updatePath(c,u))}this._selectedTree({treeNodes:o,checkedNodes:s,currentNode:e,isChecked:t})},__updatePath:function(e,t){e.$emit("update:path",t)},__selectedTree:function(e){this.$dispatch("selectedTree",e)},nodeExpand:function(e){var t=this.defaultProps.key;dsf.array.ensure(this.expandedKeys,e[t])},nodeCollapse:function(e,t){var a=this,n=this.defaultProps.key;dsf.array.remove(this.expandedKeys,e[n]),_.each(t.childNodes,(function(e){a.nodeCollapse(e.data,e)}))},loadData:function(e,t){var a=this;if(this.isDesign){var n=b.call(this);this.data="4"==this.initDataSource?this.chooseMetaData.attach||[]:n,this.firstLoadedSuccess(!1,this.data,t),_.each(this.data,(function(e){a.initExpand(e)}))}else"4"==this.initDataSource?(this.searchLoaded=!0,this.firstLoadedSuccess(!1,this.chooseMetaData.attach||[],t)):e?this.initLoadData(null,!1):t&&this.initLoadData(null,!0)},initExpand:function(e,t){var a=this.defaultProps.key,n=this.defaultProps.children,i=1*(void 0==e["_realLevel"]?e["treeinfo_level"]:e["_realLevel"]);if(i=parseInt(i),t=parseInt(t),i<t&&dsf.array.ensure(this.expandedKeys,e[a]),e[n]&&e[n].length>0)for(var s=0;s<e[n].length;s++)this.initExpand(e[n][s],t)},requestTreeData:function(e){var t=this;return new Promise((function(a,n){var i,s,o=t;o.loading=!0;var l=1*t.initDataSource,r=t.chooseMetaData,d="meta/tree",c={pid:o.pId,metaFullCode:o.metadataFullcode,namespace:null===(i=o.$vm)||void 0===i?void 0:i.nameSpace,pageName:null===(s=o.$vm)||void 0===s?void 0:s.pageName,globalIdValue:o.globalId,query:null,maxLevel:o.maxLevel||10,order:[]};if(o.$async&&(c.openLevel=t.initOpenLevel),2===l&&r.type)if("meta"==r.type)c.name=r.code.id,d="meta/tree/byName";else{if("static"==r.type)return o.loading=!1,o.searchLoaded=!0,o.reloadDataLoading=!1,!1;"ds"==r.type&&(c={rmId:r.code},d="meta/tree/dbSource")}else 3===l&&(d=o.initDataSourceUrl,c={});for(var u={searchValue:""},h=o.searchInfo,f=0;f<h.length;f++){var p=h[f];if("1"==p.type){var v=p.code.split(".");2==v.length?u[p.code]=p.valueExpress:u[p.metadata_fullcode]=p.valueExpress}}for(var g=$.trim(o.defaultOrder).split(","),m=0;m<g.length;m++){var y=g[m],x=/(.+)\s+(desc|asc)/gim,D=$.trim(y);if(D){var b=x.exec(D);if(b){var C={code:b[1],sort:b[2]||"ASC"};c.order.push(C)}}}c.order=JSON.stringify(c.order),c.query=JSON.stringify(u),e&&(c.keyWord=e),dsf.mix(c,t.queryString),d?o.$http.get(o.$replace(e?o.searchSqlUrl:d,o.$expressParams(o)),c,!e&&3!==l||o.hasPrefix).done((function(n){n.success?a(n.data):!e&&t.$listeners["initedErr"]?o.$dispatch("initedErr",n):dsf.layer.message(n.message,!1)})).error((function(a){var n;!e&&t.$listeners["initedErr"]?o.$dispatch("initedErr",a):dsf.layer.message(a.message||(null===(n=a.error)||void 0===n?void 0:n.message)||"数据获取失败",!1)})).always((function(){o.searchLoaded=!0,o.loading=!1,o.reloadDataLoading=!1})):(o.loading=!1,o.reloadDataLoading=!1)}))},initLoadData:function(e,t,a){var n=this;this.requestTreeData(a).then((function(i){n.firstLoadedSuccess(e,i,t,a)}))},firstLoadedSuccess:function(e,t,a,n){var i,s=this,l=[],d=null,c=this;(Array.isArray(t)||(t=[t]),a&&(c.expandedKeys=[]),t=x(t,this),c.openWebroot&&c.webrootName&&(d=r()(r()(r()(r()(r()(r()({},c.defaultProps.key,c.virtualRootKey),c.defaultProps.label,c.webrootName),c.defaultProps.children,l),"_realLevel",1),"children",[]),"_loaded",!0)),D(t,(function(e,t,a){e._realLevel=t+1+(d?1:0);var i=e.children&&e.children.length>0;e._loaded=!!i,c.$async&&(c.searchSqlUrl&&n?i||(e.isLeaf=!0):e.isLeaf=e.isLeaf||!1),0==t&&l.push(e)})),n)||(d?((i=d.children).push.apply(i,o()(l)),this.initExpand(d,this.initOpenLevel),l=[d]):_.each(l,(function(e){s.initExpand(e,s.initOpenLevel)})));if(n)c.searchData=l,c.searchLoaded=!0,c.$nextTick((function(){c.$refs.tree2.setCheckedKeys([].concat(c.$refs.tree.getCheckedKeys(),_.map(c.searchCheckedNodes,(function(e){return e._id}))))}));else{c.data=l;var u=l[0]||{};if(c.$nextTick((function(){if(a){var e;null===(e=c.$refs.tree)||void 0===e||e.setCurrentKey(s.currNode._id),s.setCurrentKey(s.currNode._id)}else{var t,n="";n=s.initSelectionNode?s.initSelectionNode(l):u[c.defaultProps.key];var i=null===(t=c.$refs.tree)||void 0===t?void 0:t.getNode(n);i?(s.setCurrentKey(n),c.loadIframe(i.data,i),c.currNode=i.data):dsf.warn("节点无法再树结构中查询到，未能选中")}c.$dispatch("inited",l)})),e)return e(l)}},asyncLoadData:function(e,t,a){var n,i,s=this,o=this,l={},d=e,c="meta/tree/child";1*o.asyncDataSource===3?(c=o.$replace(o.asyncUrl,o.$expressParams(o,e.data)),l=r()({},o.searchPidKey,e.data[o.defaultProps.key])):l={metaFullCode:o.metadataFullcode,namespace:null===(n=o.$vm)||void 0===n?void 0:n.nameSpace,pageName:null===(i=o.$vm)||void 0===i?void 0:i.pageName,maxLevel:o.maxLevel||10,pid:e.data[o.defaultProps.key]};dsf.mix(l,this.queryString),o.$http.get(o.$replace(c,o.$expressParams(o,d.data)),l,!0).done((function(e){if(e.success){var a=e.data,n=[];a.children&&(a=a.children),a=x(a,s),D(a,(function(e,t,a,i){e._realLevel=i?i._realLevel:d._realLevel;var s=e.children&&e.children.length>0;e._loaded=!!s,e.isLeaf=e.isLeaf||!1,0==t&&n.push(e)})),t&&t(n),s.$nextTick((function(){o.$dispatch("nodes-loaded",n)}))}else dsf.layer.message(e.message,!1)})).error((function(e){var t;dsf.layer.message((null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message)||"服务器异常",!1)}))},lazyLoad:function(e,t,a){var n;null===e||void 0===e||null===(n=e.data)||void 0===n||!n.isLeaf||a?(this.resolve=t,0===e.level?this.initLoadData(t,a):e.data._loaded?t(e.data.children):this.asyncLoadData(e,t,a)):t([])},filterNode:function(e,t,a){if(!e)return!0;for(var n=0;n<this.keywords.length;n++)for(var i,s=null===(i=this.keywords[n])||void 0===i?void 0:i.toLowerCase(),o=0;o<this.filterKeyInfo.length;o++){var l=!1,r=this.filterKeyInfo[o],d=t[r.code];if(!dsf.isUnDef(d)){d=(d+"").toLowerCase();var c=d.indexOf(s),u=r.operation;switch(u){case"like":l=c>-1;break;case"slike":l=0==c;break;case"elike":l=c+s.length==(d+"").length;break;case"eq":l=d==s;break;case"noteq":l=d!=s;break;case"lt":l=d<s;break;case"gt":l=d>s;break;case"lteq":l=d<=s;break;case"gteq":l=d>=s;break}}if(l)return!0}return!1},currNodeChange:function(e,t){var a,n=this.defaultProps.key;e[n]!==(null===(a=this.currNode)||void 0===a?void 0:a[n])?(this.currNode=e,this.showCheckbox||this.loadIframe(e,t),this.$dispatch("currNodeChange",{data:e,node:t})):this.$dispatch("nodeClick",{data:e,node:t})},loadIframe:function(e,t){if(this.$vm&&this.$vm.frames){var a=this.$vm.frames[this.targetIframeName],n="";a&&(this.setIframePath?n=this.setIframePath(e,t):(n=decodeURIComponent(this.targetIframeSrc),n=this.$replace(n,this.$expressParams(this,e))),a.$emit("update:path",n))}},reloadData:function(){var e=this;if(this.data=[],this.$async&&this.resolve){var t=this.$refs.tree,a=t.getNode(this.currNode);a&&(a.childNodes&&a.childNodes.length&&t.updateKeyChildren(a.key,[]),a.loaded=!1,a.loading=!0,a.data._loaded=!1,this.lazyLoad(a,(function(e){t.updateKeyChildren(a.key,e),null!==e&&void 0!==e&&e.length?a.isLeaf=!1:a.isLeaf=!0,a.loaded=!0,a.loading=!1,a.data._loaded=!0}),!0))}else this.reloadDataLoading=!0,this.requestTreeData().then((function(t){e.firstLoadedSuccess(null,t,!0,null),e.$nextTick((function(){e.$refs.tree.filter(e.filterText),e.$refs.tree.setCurrentKey(e.currNode._id)}))})).catch((function(e){dsf.layer.message(e.message||"数据获取失败",!1)})).finally((function(){e.reloadDataLoading=!1}))},extendSelectionNode:function(e){var t,a,n=null===this||void 0===this||null===(t=this.$refs)||void 0===t||null===(t=t.tree)||void 0===t||null===(a=t.getNode)||void 0===a?void 0:a.call(t,e);if(n){var i=this.defaultProps.key;dsf.array.ensure(this.expandedKeys,n.data[i]),n.parent&&n.parent.data&&this.extendSelectionNode(n.parent.data[i])}},setCheckedKeys:function(e,t){var a,n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null===this||void 0===this||null===(a=this.$refs)||void 0===a||null===(a=a.tree)||void 0===a||null===(n=a.setCheckedKeys)||void 0===n||n.call(a,e,t,i)},setCurrentKey:function(e){var t,a,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(t=this.$refs.tree)||void 0===t||null===(a=t.setCurrentKey)||void 0===a||a.call(t,e),n&&this.extendSelectionNode(e)},setAsyncUrl:function(){var e=this.initDataSourceUrl;e&&"3"===this.initDataSource&&this.async&&"3"===this.asyncDataSource&&""===this.asyncUrl&&(this.asyncUrl=e)},handleDragStart:function(e,t){},handleDragEnter:function(e,t,a){},handleDragLeave:function(e,t,a){},handleDragOver:function(e,t,a){},handleDragEnd:function(e,t,a,n){},handleDrop:function(e,t,a,n){this.$dispatch("handleDrop",arguments)}}});function x(e,t){for(var a=[],n={},i=0;i<e.length;i++){var s=e[i];n[s[t.defaultProps.key]]=s,n[s.treeinfo_pid]?(n[s.treeinfo_pid]["children"]||(n[s.treeinfo_pid]["children"]=[]),n[s.treeinfo_pid]["children"].push(s)):a.push(s)}return a}function D(e,t){dsf.deepForEach(e,(function(e,a,n,i){self.$async&&(e.isLeaf=!0),t&&t(e,a,n,i)}),{children:"children"})}function b(){var e=[r()(r()(r()({},this.defaultProps.key,1),this.defaultProps.label,"一级"),this.defaultProps.children,[r()(r()(r()({},this.defaultProps.key,2),this.defaultProps.label,"二级 1-1"),"icon","el-icon-info"),r()(r()(r()({},this.defaultProps.key,3),this.defaultProps.label,"二级 1-2"),"icon","el-icon-info")])];return e}var C=y,k=Object(v["a"])(C,n,i,!1,null,null,null);t["default"]=k.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_tree_module.js.map