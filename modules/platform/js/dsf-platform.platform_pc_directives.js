/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[40],{777:function(e,t,n){var i=n(778);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var s=n(19).default;s("1bd85772",i,!0,{sourceMap:!1,shadowMode:!1})},778:function(e,t,n){"use strict";n.r(t)},978:function(e,t,n){"use strict";n.r(t),n.d(t,"contextMenuClick",(function(){return $}));n(777);var i=n(3),s=n.n(i),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds-context-menu-group",class:[e.positionX],style:e.rootStyle,on:{mouseenter:e.onRootMouseenter,mouseleave:e.onRootMouseleave}},[n("dsf-virtual-scroll",{ref:"box",attrs:{height:e.boxHeight+"px","max-height":e.boxHeight+"px"}},[e._l(e.realList,(function(t,i){return[t.divided?n("div",{key:i,staticClass:"ds-context-menu-divided"}):e.contextMenuRoot.isHide(t)?e._e():n("div",{key:i,staticClass:"ds-context-menu-item",class:{disabled:e.contextMenuRoot.isDisabled(t),active:e.activeMenu==t&&t.$hasChildren},attrs:{checked:t.checked},on:{mouseenter:function(n){return e.onMouseenter(n,t)}}},[n("div",{staticClass:"ds-context-menu-item-content",class:{"has-icon":e.hasIcon,"show-select":e.select},on:{click:function(n){return n.stopPropagation(),e.contextMenuRoot.itemClick(t,n)}}},[e.select?n("i",{staticClass:"ds-context-menu-item-icon select-icon iconfont icon-danxuankuangxuanzhong"}):e._e(),t.icon?n("i",{staticClass:"ds-context-menu-item-icon iconfont",class:[t.icon],style:{color:t.color}}):e._e(),n("span",{staticClass:"ds-context-menu-item-name"},[e._v(e._s(t.name))])]),n("i",{staticClass:"item-right",class:[t.loading?"el-icon-loading":"iconfont icon-right"],attrs:{show:t.$hasChildren}})])]}))],2),e.activeMenu&&e.activeMenu.$hasChildren&&e.activeMenu.$loaded?n("div",{staticClass:"children-box",style:{transform:"translateY("+e.activeTop+"px)"}},[n("dsf-context-menu-group",{key:e.changeKey,attrs:{list:e.activeMenu._children,select:e.activeMenu.select}})],1):e._e()],1)},r=[],a=n(4),l=n.n(a),c=n(1),u=n.n(c),d={name:"DsfContextMenuGroup",inject:["contextMenuRoot"],props:{list:{type:Array,default:function(){return[]}},select:{type:Boolean,default:!1}},data:function(){return{changeKey:"",activeTop:0,activeMenu:null,positionX:"right",top:0,left:0}},computed:{listInfo:function(){var e=[],t=8,n=this.list.length,i=this.contextMenuRoot.isHide;return _.each(this.list,(function(s,o){var r;s.divided?o&&o<n-1&&(null===(r=_.last(e))||void 0===r||!r.divided)&&(e.push(s),t+=7):i(s)||(dsf.setObjAttr(s,"$hasChildren",!1),dsf.setObjAttr(s,"$lazy",!1),dsf.setObjAttr(s,"$loaded",!0),dsf.isFunction(s.children)?(dsf.setObjAttr(s,"$hasChildren",!0),dsf.setObjAttr(s,"$lazy",!0),dsf.setObjAttr(s,"$loaded",!1)):dsf.isArray(s.children)&&s.children.length&&(dsf.setObjAttr(s,"$hasChildren",!0),dsf.setObjAttr(s,"_children",s.children)),e.push(s),t+=32)})),{realList:e,scrollHeight:t}},realList:function(){return this.listInfo.realList},scrollHeight:function(){return this.listInfo.scrollHeight},maxBoxHeight:function(){return window.innerHeight-22},boxHeight:function(){var e=this.scrollHeight,t=this.maxBoxHeight;return e>t?t:e},rootStyle:function(){var e={"max-height":this.maxBoxHeight+2+"px"};return"right"===this.positionX&&this.left&&(e.left=this.left+"px"),this.top&&(e.top=this.top+"px"),e},hasIcon:function(){return!!_.find(this.realList,(function(e){return!!e.icon}))}},created:function(){this.onMouseenter=_.debounce(this._onMouseenter,150,{leading:!1,trailing:!0})},mounted:function(){this.doLayout()},beforeDestroy:function(){this.onMouseenter.cancel(),clearTimeout(this._leaveTimeout)},methods:{doLayout:function(){var e=this;this.$nextTick((function(){var t=window,n=t.innerWidth,i=t.innerHeight,s=e.$el.getBoundingClientRect(),o=s.top,r=s.bottom,a=s.left,l=s.right,c=s.width,u=s.height;o+=10,r+=10;var d=n-l-10;if(l-n>0&&(a-c>0?e.positionX="left":d<0&&(a+d<0&&(d=-a),e.left=d)),r-i>-10)if(o-u+32>10){var h=37-u,f=h+r+10-i;f>0&&(h-=f),e.top=h}else e.top=i-r-10;else e.top=o<10?10-o:-5}))},rebindMouseenter:function(){this.onMouseenter.cancel(),this.onMouseenter=_.debounce(this._onMouseenter,150,{leading:!1,trailing:!0})},_onMouseenter:function(e,t){var n=this;return l()(u.a.mark((function i(){var s,o;return u.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(s=e.target,clearTimeout(n._leaveTimeout),n.activeMenu!=t){i.next=4;break}return i.abrupt("return");case 4:if(n.activeMenu=t.$hasChildren?t:null,t.$hasChildren){i.next=7;break}return i.abrupt("return");case 7:if(n.changeKey=dsf.uuid(),n.activeTop=s.offsetTop-n.$refs.box.getScrollInfo().scrollTop,!t.$lazy||t.$loaded){i.next=31;break}return i.prev=10,n.$set(t,"loading",!0),i.next=14,t.children();case 14:if(o=i.sent,dsf.setObjAttr(t,"$loaded",!0),!dsf.isArray(o)||!o.length){i.next=20;break}dsf.setObjAttr(t,"_children",o),i.next=24;break;case 20:return dsf.setObjAttr(t,"$hasChildren",!1),dsf.setObjAttr(t,"$lazy",!1),n.$set(t,"loading",!1),i.abrupt("return");case 24:n.$set(t,"loading",!1),i.next=31;break;case 27:throw i.prev=27,i.t0=i["catch"](10),n.$set(t,"loading",!1),i.t0;case 31:case"end":return i.stop()}}),i,null,[[10,27]])})))()},onRootMouseenter:function(){var e,t;null===(e=(t=this.$parent).rebindMouseenter)||void 0===e||e.call(t),clearTimeout(this._leaveTimeout)},onRootMouseleave:function(){clearTimeout(this._leaveTimeout),this._leaveTimeout=setTimeout((function(){}),300)}}},h=d,f=n(0),p=Object(f["a"])(h,o,r,!1,null,null,null),v=p.exports;function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={capture:!0,passive:!1},x={name:"DsfContextMenu",components:{DsfContextMenuGroup:v},provide:function(){return{contextMenuRoot:this}},data:function(){return{point:{x:0,y:0},list:[]}},computed:{rootStyle:function(){var e=this.point,t=e.x,n=e.y;return{left:t+"px",top:n+"px"}}},render:function(e){var t=[];return this.list.length&&t.push(e("dsf-context-menu-group",{attrs:{list:this.list}})),e("div",{class:"ds-context-menu show",style:this.rootStyle,attrs:{tabindex:"0"},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[t])},methods:{activeBlur:function(e){var t=e.target,n=this.$el;while(1){if(t===n){e.preventDefault();break}if(t===document.body){this.close();break}t=t.parentNode}},onDocWheel:function(e){var t=e.target,n=this.$el;while(1){if(t===n){e.stopPropagation();break}if(t===document.body){this.close();break}t=t.parentNode}},open:function(e,t,n,i,s){var o=this;clearTimeout(this.__timeout),this.list=[],this.point=e,this.__params=t||null,this.__el=i,this.__e=s,i.classList.add("__context-active"),this.$nextTick((function(){o.list=n,o.$el.focus(),o.$el.onblur=o.blur.bind(o),setTimeout((function(){window.addEventListener("resize",o.close),document.addEventListener("wheel",o.onDocWheel,g),document.addEventListener("mousedown",o.activeBlur,g),document.addEventListener("mouseup",o.activeBlur,g),document.addEventListener("click",o.activeBlur,g),document.addEventListener("dblclick",o.activeBlur,g)}),300)}))},blur:function(){var e=this;"IE"===dsf.client.info.browser?this.__timeout=setTimeout((function(){e.close()}),300):this.close()},close:function(){var e;this.$el.onblur=null,null===(e=this.__el)||void 0===e||e.classList.remove("__context-active"),this.list=[],this.__params=null,this.__el=null,this.__e=null,window.removeEventListener("resize",this.close),document.removeEventListener("wheel",this.activeBlur,!0),document.removeEventListener("mousedown",this.activeBlur,!0),document.removeEventListener("mouseup",this.activeBlur,!0),document.removeEventListener("click",this.activeBlur,!0),document.removeEventListener("dblclick",this.activeBlur,!0)},inputChange:function(){var e,t=this.uploadInput.menu,n=this.uploadInput.res,i=null===n||void 0===n||null===(e=n.params)||void 0===e?void 0:e.data,s=this.uploadInput.files[0],o=dsf.layer.loading(),r=t.upload,a=r.action,l=r.data,c=r.beforeHandler;if(dsf.isFunction(c)){var u=c(t,s);if(!1===u)return}if(dsf.isFunction(l)&&(l=l(t)),dsf.isString(l)){var d=this.$replace(l,i||this);l=dsf.url.queryStringParse(d)}else dsf.isPlainObject(l)||(l={});dsf.http.upload(a,b(b({},l),{},{file:s})).then((function(e){var i;null===(i=t.handler)||void 0===i||i.call(t,b({response:e,menu:t},n))})).error((function(e){dsf.error(e),dsf.layer.message((null===e||void 0===e?void 0:e.message)||"上传文件异常",!1)})).always((function(){dsf.layer.closeLoading(o)}))},itemClick:function(e,t){var n;if(!(null!==(n=e.children)&&void 0!==n&&n.length||this.isDisabled(e))){if(e.upload){var i=e.upload.accept;dsf.isString(i)&&(i=i.replace(/\|/g,",").split(",")),dsf.isArray(i)&&(i=_.map(i,(function(e){return e=e.toLowerCase(),dsf.mime[e]||e})).join(","));var s={params:this.__params,el:this.__el,e:this.__e},o=document.createElement("input");o.type="file",o.accept=i,o.menu=e,o.res=s,o.onchange=this.inputChange,o.click(),this.uploadInput=o}else{var r;null===(r=e.handler)||void 0===r||r.call(e,{menu:e,params:this.__params,el:this.__el,e:this.__e,clickEvent:t}),this.$el.blur()}"IE"===dsf.client.info.browser&&this.list.length>0&&(clearTimeout(this.__timeout),this.close())}},isDisabled:function(e){var t=e.disabled||!1;if("function"===dsf.type(t)){var n=this.__params;return t({params:n,menu:e,el:this.__el,e:this.__e})}return!!t},isHide:function(e){var t=e.hide||!1;if("function"===dsf.type(t)){var n=this.__params;return t({params:n,menu:e,el:this.__el,e:this.__e})}return!!t}}},y=null;function $(e,t,n,i,s){"array"===dsf.type(n)&&new Promise((function(e){var i,s;null!==t&&void 0!==t&&null!==(i=t.$vm)&&void 0!==i&&null!==(i=i.$listeners)&&void 0!==i&&i.contextMenuData?null===t||void 0===t||null===(s=t.$vm)||void 0===s||s.$dispatch("contextMenuData",{params:t,data:n,resolve:e}):e(n)})).then((function(n){if(!y){var o=Vue.extend(x);y=(new o).$mount(),document.body.appendChild(y.$el)}y.open(e,t,n,i,s)}))}}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_directives.js.map