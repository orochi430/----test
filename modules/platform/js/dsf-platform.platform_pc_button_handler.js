/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[34],{940:function(e,t,a){"use strict";a.r(t),a.d(t,"execInterface",(function(){return O})),a.d(t,"saveForm",(function(){return w})),a.d(t,"deleteForm",(function(){return b})),a.d(t,"copyForm",(function(){return S})),a.d(t,"getFormData",(function(){return N})),a.d(t,"datagridExport",(function(){return T})),a.d(t,"datagridDelete",(function(){return A})),a.d(t,"datagridBatchDelete",(function(){return C})),a.d(t,"datagridRowUpload",(function(){return q})),a.d(t,"datagridImport",(function(){return j})),a.d(t,"datagridPreImport",(function(){return E})),a.d(t,"datagridCommonImport",(function(){return F})),a.d(t,"datagridTemplateDownload",(function(){return J})),a.d(t,"datagridColumnsFilter",(function(){return R})),a.d(t,"datagridClearCondition",(function(){return L})),a.d(t,"navTreeDelete",(function(){return H})),a.d(t,"flowOpenDialog",(function(){return M})),a.d(t,"subtablePasteExcel",(function(){return B})),a.d(t,"subtableExport",(function(){return U})),a.d(t,"subtableImport",(function(){return W})),a.d(t,"subtableDataChoice",(function(){return V})),a.d(t,"openWindow",(function(){return k})),a.d(t,"openDialog",(function(){return P})),a.d(t,"openDrawer",(function(){return I})),a.d(t,"userImport",(function(){return K}));var n=a(7),r=a.n(n),i=a(2),s=a.n(i),o=a(3),l=a.n(o),u=a(8),d=a.n(u),c=a(4),p=a.n(c),f=a(1),m=a.n(f);function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){l()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function h(e){var t,a,n,r=2;for("undefined"!=typeof Symbol&&(a=Symbol.asyncIterator,n=Symbol.iterator);r--;){if(a&&null!=(t=e[a]))return t.call(e);if(n&&null!=(t=e[n]))return new y(t.call(e));a="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function y(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return y=function(e){this.s=e,this.n=e.next},y.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var a=this.s.return;return void 0===a?Promise.resolve({value:e,done:!0}):t(a.apply(this.s,arguments))},throw:function(e){var a=this.s.return;return void 0===a?Promise.reject(e):t(a.apply(this.s,arguments))}},new y(e)}function w(e){return x.apply(this,arguments)}function x(){return x=p()(m.a.mark((function e(t){var a,n,r,i;return m.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t._self.$form,!a){e.next=12;break}if(n=t.params[3]||"保存成功",r=t.params[4]||"保存失败","保存"==n&&(n="保存成功"),i={isRefresh:!0===t.params[0],customParams:t.params[1]||"",savedClose:!0===t.params[2],successMsg:n,errorMsg:r},a.$isPrototype){e.next=11;break}return e.next=9,a.formSave(i);case 9:e.next=12;break;case 11:dsf.layer.message(n);case 12:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function b(e){var t=e._self.$form;if(t&&t.$dataKey){var a={isRefresh:!0===e.params[0],successMsg:e.params[1]||"删除成功",errorMsg:e.params[2]||"删除失败"};if(t.$isPrototype)dsf.layer.message(a.successMsg);else{var n=t.$viewData;if(n){var r={namespace:e.owner.$vm.nameSpace,pageName:e.owner.$vm.pageName,isTree:!1,data:JSON.stringify([t.$dataKey])},i=dsf.layer.loading();e._self.$http.post("/meta/list/delete",r,!0).done((function(n){var r=n.success,i=(n.data,n.message);r?(e.owner.$message(a.successMsg,!0),e.owner&&(a.isRefresh&&t.reloadParentViewData(),t.closeForm((function(){setTimeout((function(){t._isDestroyed||t.$router.replace("/pc/deleteForm")}),300)})))):e.owner.$message(i||a.errorMsg,!1)})).error((function(t){e.owner.$message((null===t||void 0===t?void 0:t.message)||"请求异常",!1)})).always((function(){dsf.layer.closeLoading(i)}))}}}else dsf.layer.message("请操作正确的页面",!1)}function S(e){var t=e._self.$form,a=t.$dataKey;if(t&&a){if(t.$frame)delete t.$frame.params.id,delete t.$frame.params.isview,t.$frame.params["copyFormId"]=a;else{var n=dsf.mix({},t.$route.query);delete n.id,delete n.isview,n["copyFormId"]=a;var r=t.$route.path+"?"+dsf.url.queryStringStringify(n);t.$router.push(r)}t.$refreshView()}}function N(e){return D.apply(this,arguments)}function D(){return D=p()(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t._self.$form,!a){e.next=10;break}if(a.$isPrototype){e.next=9;break}return e.next=5,a.yes();case 5:return n=e.sent,e.abrupt("return",n);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function O(e){var t=e.params,a=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],l=r?dsf.url.queryStringParse(r):{},u=dsf.layer.loading();e._self.$http[n](a,l).then((function(t){var a=t.data;a.success&&"20000"==a.state?(dsf.layer.message(i,!0),e._self.$dispatch("system-interface-exec-callback",a),e._self.$vm[o]&&e._self.$vm[o](a,e)):dsf.layer.message(a.message,!1)})).catch((function(e){dsf.layer.message(s,!1)})).finally((function(){dsf.layer.closeLoading(u)}))}function k(e){var t,a,n,r=null===e||void 0===e||null===(t=e.params)||void 0===t?void 0:t[0],i=(null===e||void 0===e||null===(a=e.params)||void 0===a?void 0:a[1])||dsf.uuid(),s=(null===e||void 0===e||null===(n=e.params)||void 0===n?void 0:n[2])||!1,o=e._self;r&&o.$openWindow(s,{url:r,name:i})}function P(e){var t,a,n=d()(e.params,7),r=n[0],i=n[1],s=n[2],o=n[3],l=n[4],u=n[5],c=n[6];if(s){var f=s.split(","),v=d()(f,2);t=v[0],a=v[1]}else t="80%",a="500px";if(dsf.isString(l))try{var h=dsf.express.eval(l);l=h}catch(w){}if(l=_.isObject(l)?l:{},"left"!==u&&"center"!==u&&(u="right"),i){var y=dsf.merge({},{params:{path:i}},l);this.$openDialog(g({title:r||"",width:t,height:a,footerAlign:u,isTopOpen:c,params:{path:i},btns:[{text:"确定",handler:function(){var t=p()(m.a.mark((function t(a){var n,r;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=o||"system-dialog-save",t.next=3,a.yes();case 3:if(r=t.sent,e.owner.$dispatch(n,r),r){t.next=7;break}return t.abrupt("return",!1);case 7:case"end":return t.stop()}}),t)})));function a(e){return t.apply(this,arguments)}return a}()},{text:"取消"}]},y))}}function I(e){var t=d()(e.params,8),a=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],l=t[6],u=t[7];if(dsf.isString(o))try{var c=dsf.express.eval(o);o=c}catch(f){}o=_.isObject(o)?o:{},"left"!==l&&"center"!==l&&(l="right"),n&&this.$openDrawer(g({title:a||"",size:r,direction:i,footerAlign:l,isTopOpen:u,params:{path:n},btns:[{text:"确定",handler:function(){var t=p()(m.a.mark((function t(a){var n,r;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=s||"system-dialog-save",t.next=3,a.yes();case 3:if(r=t.sent,e.owner.$dispatch(n,r),r){t.next=7;break}return t.abrupt("return",!1);case 7:case"end":return t.stop()}}),t)})));function a(e){return t.apply(this,arguments)}return a}()},{text:"取消"}]},o))}function T(e){var t,a,n=e.params[0],r=dsf.express.eval(e.params[1]),i=e.params[2]||(n?"导出数据":"导出数据.xlsx"),s=e.params[3],o=e.params[4]||"",l=dsf.url.queryStringParse(e.params[5])||{},u=!1!==e.params[6],d=!!e.params[7],c="/office/excel/export/meta"!=o,p=void 0!=e.params[8];void 0!=e.params[9]&&!1===e.params[9]&&(p=!1);var f=!(!0===c||!p)&&!e.params[8],m=(null===(t=e.owner)||void 0===t||null===(t=t.$vm)||void 0===t?void 0:t.nameSpace)||"",v=(null===(a=e.owner)||void 0===a||null===(a=a.$vm)||void 0===a?void 0:a.pageName)||"";if(o){var g=e.owner.exportOptions[s];if(!g||0==g.length){var h,y=[];_.each(null===(h=e.owner)||void 0===h||null===(h=h.$vm)||void 0===h?void 0:h.metadataDict,(function(e){var t=e.id.split(".");if(t.length>=2){var a=t[0],n=t[1];e.hidden||_.each(e.valueAttributes,(function(t){"value"!=t&&y.push({id:a+"."+n+(e.valueAttributes.length>1?"_"+t:""),code:n,caption:e.name,currentValueAttribute:t,format:"",table:a,valueAttributes:e.valueAttributes})}))}})),g=y}if(!g||g.length<=0)dsf.layer.pc.message("未查找到可用的导出信息配置",!1);else if(p&&!c||n){var w=e.owner.tableExportResult||[],x=function(t,a){var n;if(f)return null===t||void 0===t||null===(n=t.asyncExportFunc)||void 0===n||n.call(t,e.owner,s,a,l,d),!1;if(t&&t.yes){var r=t.yes(),i=r.extName,o=r.fields,u=r.fieldIds;if(o.length<=0)return dsf.layer.pc.message("请选择要导出的数据字段",!1),!1;e.owner.$emit("update:tableExportResult",u),D(s,a,i,e.owner.getQueryInfo(),o,l),e.owner.$addCustom(e.owner.caption,{tableExportResult:u})}};this.$openDialog({title:"导出设置",width:"700px",height:"auto",content:"DsfExportSetting",footerAlign:"center",params:{fileName:i,allow:r,fields:g,fieldIds:n?w:[],showDownloadButton:f,showExportCustomFieldsSetting:n,nameSpace:m,pageName:v,customInterface:c,isNewversion:p,exportCallback:x},btns:[]})}else{var b,S,N=i.split(".");1==N.length?(b=N[0],S=""):N.length>0&&(b=N.slice(0,N.length-1).join("."),S=N[N.length-1]),D(s,b,S,e.owner.getQueryInfo(),g,l)}}else dsf.layer.pc.message("未查找到可用的导出接口地址",!1);function D(t,a,n,r,i,s){var o=e.owner.multipleSelection;if(!u&&o.length>0){var l="";dsf.layer.openDialog({title:"提示",width:"420px",height:"45px",template:"请选择您需要的导出结果",customClass:"confirm-dialog",btnSize:"small",draggable:!1,btns:[{text:"选中数据",handler:function(){var o=e.owner.multipleSelection;l=_.map(o,"_id"),O(t,a,n,r,i,s,l)}},{text:"当前查询结果",handler:function(){O(t,a,n,r,i,s,l)}}]})}else{var d=null;e.owner.isAllPageSelect&&!e.owner.isAllSelected&&o.length>0&&(d=_.map(o,"_id")),O(t,a,n,r,i,s,d)}}function O(t,a,n,r,i,s,l){var u=dsf.url.getWebPath(o,e.owner.$baseUrl),c=e.owner.getQueryInfo(),p={rule:e.owner.caption+"."+t,query:JSON.stringify(c.query),order:JSON.stringify(c.order),filter:JSON.stringify(c.filter),data:null,fileName:a,extName:n,fields:JSON.stringify(_.map(i,"id")),params:JSON.stringify(s),nameSpace:m,pageName:v,serialNum:d?1:0},f="";e.owner.isAllPageSelect&&(p.checkbox=e.owner.isAllSelected||!l?"all":"page",f='<input type="text" name="checkbox">');var g=dsf.url.queryStringStringify(e.owner.queryString),h=u+(u.indexOf("?")>0?"&":"?")+g,y='<form method="post">\n                        <input type="text" name="rule">\n                        <input type="text" name="query">\n                        <input type="text" name="order">\n                        <input type="text" name="fileName">\n                        <input type="text" name="extName">\n                        <input type="text" name="fields">\n                        <input type="text" name="params">\n                        <input type="text" name="namespace">\n                        <input type="text" name="pageName">\n                        <input type="text" name="filter">\n                        <input type="text" name="ids">\n                        <input type="text" name="serialNum">\n                        <input type="text" name="client_info">\n                        '.concat(f,"\n                  </form>"),w=$(y);w.attr("action",h),w.find("input[name=rule]").val(p.rule),w.find("input[name=query]").val(p.query),w.find("input[name=order]").val(p.order),w.find("input[name=fileName]").val(p.fileName),w.find("input[name=extName]").val(p.extName),w.find("input[name=fields]").val(p.fields),w.find("input[name=params]").val(p.params),w.find("input[name=namespace]").val(p.nameSpace),w.find("input[name=pageName]").val(p.pageName),w.find("input[name=filter]").val(p.filter),w.find("input[name=ids]").val(l||""),w.find("input[name=serialNum]").val(p.serialNum),w.find("input[name='client_info']").val(dsf.base64.encode(JSON.stringify(dsf.client.info))),e.owner.isAllPageSelect&&w.find("input[name=checkbox]").val(p.checkbox),w.appendTo("body").submit().remove()}}function A(e){var t=e.params,a=t[0]||"_id",n=!0===t[1],r=t[2]||"",i=t[3]||"是否要删除该数据";e.owner.$confirm(i).then((function(t){var i=e.data;if(i){var s=[i],o=[i[a]],l={namespace:e.owner.$vm.nameSpace,pageName:e.owner.$vm.pageName,isTree:n,data:JSON.stringify(o)};e._self.$http.post("/meta/list/delete",l,!0).done((function(t){var a=t.success,n=(t.data,t.message);a?(e.owner.$message("删除成功",!0),e.owner&&(e.owner.toggleSelect(e.data,!1),e.owner.$nextTick((function(){e.owner.reloadData(),e.owner.$dispatch("data-deleted",this),r&&e.owner.$vm[r]&&e.owner.$vm[r](s)})))):e.owner.$message(n||"删除失败",!1)})).error((function(t){e.owner.$message((null===t||void 0===t?void 0:t.message)||"请求异常",!1)}))}})).catch((function(e){throw e}))}function C(e){var t=e.params,a=t[0]||"_id",n=!0===t[1],r=t[2]||"",i=t[3],s=e.owner.multipleSelection;if(0!==s.length||e.owner.isAllSelected){var o,l=s.length;if(e.owner.isAllPageSelect&&e.owner.isAllSelected)l=(null===(o=e.owner)||void 0===o?void 0:o.pageCount)||s.length,s=s.length>0?s.concat(new Array(l-s.length).fill({})):e.owner.data.concat(new Array(l-e.owner.data.length).fill({}));var u=i||"是否要删除选中的"+l+"条数据？";i&&(u=dsf.express.replace(i,{rows:s})),e.owner.$confirm(u).then((function(t){var i=e.data;if(i){var o=_.map(s,(function(e){return e[a]})),l={namespace:e.owner.$vm.nameSpace,pageName:e.owner.$vm.pageName,isTree:n,data:JSON.stringify(o)};if(e.owner.isAllPageSelect&&(l.checkbox=e.owner.isAllSelected?"all":"page",e.owner.isAllSelected)){var u=e.owner.getQueryInfo();l.query=JSON.stringify(u.query)}e._self.$http.post("/meta/list/delete",l,!0).then((function(t){var a=t.data;2e4==a.state?(e.owner.$message("删除成功",!0),e.owner.clearSelect(),e.owner.$nextTick((function(){e.owner.reloadData(),e.owner.$dispatch("data-deleted",this),r&&e.owner.$vm[r]&&e.owner.$vm[r](s)}))):e.owner.$message(a.message||"删除失败",!1)})).catch((function(t){e.owner.$message("删除失败",!1)}))}})).catch((function(e){throw e}))}else e.owner.$message("请选择至少一条数据",!1)}function q(e){var t=e.owner,a=e.response,n=d()(e.params,9),r=n[3],i=n[4],s=n[5],o=n[6],l=n[7],u=n[8];return a&&a.success?u||l?l&&!t.multipleSelection.length?e.owner.$message("请选择需要上传到哪些行数据中",!1):u?"function"!=dsf.type(t.$listeners["upload-".concat(u)])?t.$message("请绑定upload-".concat(u,"上传二次开发方法"),!1):t.$dispatch("upload-".concat(u),e):t.$message("请配置二次开发方法",!1):r&&i&&o?void t.$http.post("/datagrid/row/upload",{namespace:r,pageName:i,primaryColumnName:s,fileColumnName:o,file:JSON.stringify(a.data),rowData:JSON.stringify(e.data)}).then((function(e){var a=e.data;a&&a.success?(t.$message("上传成功"),t.reloadData()):t.$message(a.message,!1)})).catch((function(){t.$message("上传失败",!1)})):t.$message("请检查命名空间、页名称、主键列字段名字、文件字段在表单中的名字是否配置",!1):t.$message("上传失败",!1)}function j(e){var t,a=e.owner,n=e.response,r=d()(e.params,4),i=r[3];a&&(a.reloadData(1),null===e||void 0===e||null===(t=e._self)||void 0===t||null===(t=t.$root)||void 0===t||null===(t=t.$dialogAll)||void 0===t||null===(t=t[0])||void 0===t||t.close(),a.$listeners[i]?a.$dispatch(i,n):n.success?e.owner.$message("导入完成",!0):e.owner.$message(n.message||"导入失败",!1))}function E(e){var t=this,a=e.owner,n=d()(e.params,7),r=n[3],i=n[4],s=n[5],o=n[6],l=e.response,u=function(t){e.owner.$dispatch("system-datagrid-preimport-saved",t),e.owner.reloadData()};if(l.success){var c;if(!r)return a.$message("导入文件成功",!0),u(l.data),void(null===e||void 0===e||null===(c=e._self)||void 0===c||null===(c=c.$root)||void 0===c||null===(c=c.$dialogAll)||void 0===c||null===(c=c[0])||void 0===c||c.close());this.$openDialog({title:"预导入文件编辑",width:"80%",height:"500px",center:!0,params:{path:r,fileData:l.data},showClose:!1,btns:[{text:"确定",handler:function(){var e=p()(m.a.mark((function e(a){var n;return m.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.$dialog.btnLoading,n(0,!0),n(1,!0),e.abrupt("return",new Promise((function(e,r){a.yes().then((function(l){return i?!l||dsf.isEmptyObject(l)||"array"==dsf.type(l)&&!l.length?(dsf.layer.message("请不要导入空数据",!1),r()):void(l&&t.$http.post(i,JSON.stringify(l),{timeout:dsf.isNumber(Number(o))?Number(o):2e4,headers:g({"Content-Type":"application/json"},dsf.getTokenHttpHeader())}).done((function(t){return t.success?(s=s||"submitCallBack",_.isFunction(a.content[s])?void a.content[s](t.data,(function(t){return 0==t?(setTimeout((function(){n(0,!1),n(1,!1)}),400),r()):e()})):(u(t.data),e())):(dsf.layer.message(t.message,!1),setTimeout((function(){n(0,!1),n(1,!1)}),400),r())})).error((function(e){dsf.layer.message("服务器异常",!1)}))):(u(l),e())})).catch((function(){return setTimeout((function(){n(0,!1),n(1,!1)}),400),r()}))})));case 4:case"end":return e.stop()}}),e)})));function a(t){return e.apply(this,arguments)}return a}()},{text:"关闭"}]})}else a.$message(l.message,!1)}function F(e){var t=e.owner,a=t.importOptions,n=d()(e.params,11),r=n[0],i=n[1],s=n[2],o=n[3],l=n[4],u=n[5],c=(n[6],n[7],n[8],n[9],n[10]);if(!r)return dsf.layer.message("预导入按钮tableName未配置！",!1);var p=this;function f(n){var d=new FormData;d.append("file",n);var f={};for(var m in t.queryString)d.append(m,t.queryString[m]);r&&(f.tableName=r),f.code=t.$vm.nameSpace+"."+t.$vm.pageName+"."+r,i&&(f.sheetIndex=i),s&&(f.rowIndex=s),o&&(f.columnIndex=o),a&&(f.rowRules=a),u&&(f.exInfo=u),f&&d.append("importAttr",JSON.stringify(f));var v=dsf.layer.loading();function h(a){if(!a.success)return dsf.layer.message(a.message,!1);var n;1!=a.data.status?this.$openDialog({title:"预导入错误数据编辑",width:"80%",height:"500px",content:"DesCommonImportErrorDataEidt",center:!0,params:{fileData:a.data,servicePrefix:t.$baseUrl,infoText:c},showClose:!1,btns:[{text:"确定",handler:function(e){var a=e.$dialog.btnLoading;return a(0,!0),a(1,!0),e.yes().then((function(e){return l?t.$dispatch(l,e):(t.reloadData&&t.reloadData(),dsf.layer.message("导入成功")),setTimeout((function(){a(0,!1),a(1,!1)})),Promise.resolve()})).catch((function(e){return setTimeout((function(){a(0,!1),a(1,!1)})),Promise.reject(e)}))}},{text:"取消",handler:function(){var e=dsf.layer.loading();return dsf.http.get("/import/destroyCache",{id:a.data.uuid},!0).always((function(){dsf.layer.closeLoading(e)}))}}]}):l?t.$dispatch(l,a):(t.reloadData&&t.reloadData(),dsf.layer.message("导入成功"),null===e||void 0===e||null===(n=e._self)||void 0===n||null===(n=n.$root)||void 0===n||null===(n=n.$dialogAll)||void 0===n||null===(n=n[0])||void 0===n||n.close())}$.ajax({url:dsf.url.getWebPath("/import/resolver",t.$baseUrl),dataType:"json",type:"post",data:d,processData:!1,contentType:!1,headers:g({},dsf.getDefaultHttpHeader()||{}),error:function(e){dsf.layer.closeLoading(v)},success:function(e){dsf.layer.closeLoading(v),h.call(p,e)}})}$('<input type="file"></input>').on("change",(function(e){f(this.files[0]),$(this).off("change").remove()})).appendTo($(document.body)).click()}function J(e){var t=e.params[0]+"^"+e.params[1],a=e.params[1];if(t){var n=dsf.url.getWebPath("file/downloadFromBlob",e.owner.$baseUrl);$("<form action="+n+' method="get"><input type="text" name="files" value="'+t+'"/><input type="text" name="zipName" value="'+a+'"/></form>').appendTo("body").submit().remove()}else dsf.layer.message("暂无上传模板",!1)}function R(e){var t=e.owner.getElTable(),a=d()(e.params,1),n=a[0];this.$openDialog({title:"数据列过滤",width:"650px",height:"450px",content:"DsfDataGridColumnsFilter",params:{atLeastOne:n,columns:t.columnsTree,filter:_.cloneDeep(e.owner.tableFilterResult)||[]},btns:[{text:"确定",handler:function(a){var n={type:"empty"};return a&&a.yes&&(n=a.yes()),0!=n&&("empty"==!n.type?(dsf.layer.message("请选择至少一列",!1),!1):void("change"!=n.type&&"reset"!=n.type||e.owner.$nextTick((function(){e.owner.$emit("update:tableFilterResult",n.data),e.owner.$addCustom(e.owner.caption,{tableFilterResult:n.data}),e.owner.updateTableFilterResult(n.data),t.headerReload(),e.owner.$nextTick((function(){e.owner.reloadData()}))}))))}},{text:"取消"}]})}function L(e){e.owner.searchStr="";var t=function(){var t=p()(m.a.mark((function t(){var a,n,r,i,s,o,l,u,d,c,p;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=(null===(a=e.owner)||void 0===a?void 0:a.superValue)||{},i=(null===(n=e.owner.$refs)||void 0===n||null===(n=n.superSearchBar)||void 0===n?void 0:n.searchItems)||[],"{}"==JSON.stringify(r)){t.next=34;break}i=i.filter((function(e){return Object.keys(r).includes(e.field)})),s=!1,o=!1,t.prev=6,u=h(i);case 8:return t.next=10,u.next();case 10:if(!(s=!(d=t.sent).done)){t.next=16;break}c=d.value,null===(p=e.owner.$refs)||void 0===p||p.superSearchBar.removeFilter(c);case 13:s=!1,t.next=8;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](6),o=!0,l=t.t0;case 22:if(t.prev=22,t.prev=23,!s||null==u.return){t.next=27;break}return t.next=27,u.return();case 27:if(t.prev=27,!o){t.next=30;break}throw l;case 30:return t.finish(27);case 31:return t.finish(22);case 32:t.next=35;break;case 34:e.owner.search();case 35:case"end":return t.stop()}}),t,null,[[6,18,22,32],[23,,27,31]])})));return function(){return t.apply(this,arguments)}}();t(),e.owner.$dispatch("clearCondition",e)}function H(e){var t=e.data,a=e.owner,n=a.$refs.tree;function r(e){if(t._id===a.currNode._id){var r=n.getNode(t),i=r.nextSibling||r.previousSibling||r.parent;i&&(a.currNode=i.data,a.loadIframe(i.data),e&&a.$nextTick((function(){n.setCurrentKey(i.data._id)})))}}e.owner.$confirm("是否要删除该数据").then((function(i){var s;if(t)if("4"==a.initDataSource)r(!0),n.remove(t);else if(null!==a&&void 0!==a&&null!==(s=a.$vm)&&void 0!==s&&s.frames){var o,l=e.params,u=l[0]||"_id",d=!0===l[1],c=l[2]||"",p=(null===a||void 0===a||null===(o=a.$vm)||void 0===o?void 0:o.frames[a.targetIframeName])||{},f={namespace:p.nameSpace,pageName:p.pageName,isTree:d,data:JSON.stringify([t[u]])};e._self.$http.post("/meta/list/delete",f,!0).then((function(a){var n=a.data;n&&n.success?(e.owner.$message("删除成功",!0),e.owner&&(r(),e.owner.reloadData(),e.owner.$nextTick((function(){c&&e.owner.$vm[c]&&e.owner.$vm[c](t)})))):e.owner.$message(n.message,!1)})).catch((function(t){e.owner.$message("删除失败",!1)}))}})).catch((function(e){throw e}))}function M(e){if(!e.targetButton.disabled){var t=e.owner.multipleSelection;if(t&&0===t.length&&0===Object.keys(e.data).length)dsf.layer.message("请选择至少一条数据",!1);else{var a,n,r=d()(e.params,6),i=r[0],s=r[1],o=(r[2],r[3]),l=r[4],u=r[5];if(u){var c=u.split(","),p=d()(c,2);a=p[0],n=p[1]}var f=[];Object.keys(e.data).length>0?(e.data[l||"sPID"]||this.$route.query.sCurLinkID)&&f.push({sPID:e.data[l||"sPID"]||this.$route.query.sPID,sCurLinkID:e.data[o||"sCurLinkID"]||this.$route.query.sCurLinkID}):t.forEach((function(e){f.push({sPID:e[l||"sPID"],sCurLinkID:e[o||"sCurLinkID"]})})),e.targetButton.disabled=!0,this.$openDialog({title:i||"",width:a||"80%",height:n||"500px",params:{path:s||"dsfa/wf/opion"},dialogArgs:{data:f,rowData:e.data},btns:[]}),setTimeout((function(){e.targetButton.disabled=!1}),200)}}}function B(e){var t=e.owner,a={text:""},n=t.$openDialog({width:"50vw",height:"50vh",title:"数据粘贴板",content:{data:function(){return{data:a}},methods:{pasteHandler:function(e){var a,r=event.clipboardData||window.clipboardData,i=r.getData("text/html"),o=(new DOMParser).parseFromString(i,"text/html"),l=o.querySelector("html"),u=o.querySelector("head");if(l&&u&&(l.getAttribute("xmlns:x")||"").indexOf("excel")<0||(u.outerHTML||"").indexOf("Microsoft Excel")<0)dsf.layer.message("您粘贴的数据不是excel表格数据",!1);else{var d=o.querySelectorAll("table tr"),c=_.map(d,(function(e){var t=e.querySelectorAll("td"),a=[];return _.each(t,(function(e){a.push(((null===e||void 0===e?void 0:e.innerText)||"").trim())})),a})),p=[];p=t.clipboardDataHandler&&dsf.isFunction(t.clipboardDataHandler)?t.clipboardDataHandler(c):null===t||void 0===t?void 0:t.$clipboardDataHandler(c);t.value;if(1==(null===t||void 0===t||null===(a=t.value)||void 0===a?void 0:a.length)&&t.isEmptyData(null===t||void 0===t?void 0:t.value[0])){var f=dsf.mix(!0,[],t.value,p);dsf.array.removeAll(t.value),_.each(f,(function(e){t.value.push(e)}))}else{var m;(m=t.value).push.apply(m,s()(p))}n.close()}}},render:function(e){return e("div",r()([{},{on:{paste:this.pasteHandler}}]),[e("el-input",{attrs:{placeholder:"请将excel内容粘贴到此处",type:"textarea",rows:"20"}})])}}})}function U(e){var t,a,n=e._self.$form,r=n.$dataKey;if(n&&r){var i=e.params[0],s=dsf.express.eval(e.params[1]),o=e.params[2]||(i?"导出数据":"导出数据.xlsx"),l=e.params[3],u=e.params[4]||"",d=dsf.url.queryStringParse(e.params[5])||{},c=!0,p=!!e.params[6],f="/office/excel/export/meta"!=u,m=!1,v=!1,g=(null===(t=e.owner)||void 0===t||null===(t=t.$vm)||void 0===t?void 0:t.nameSpace)||"",h=(null===(a=e.owner)||void 0===a||null===(a=a.$vm)||void 0===a?void 0:a.pageName)||"";if(u){var y=e.owner.exportOptions[l];if(!y||0==y.length){var w,x=[];_.each(null===(w=e.owner)||void 0===w?void 0:w.metadataDict,(function(e){var t=e.id.split(".");if(t.length>=2){var a=t[0],n=t[1];e.hidden||_.each(e.valueAttributes,(function(t){"value"!=t&&x.push({id:a+"."+n+(e.valueAttributes.length>1?"_"+t:""),code:n,caption:e.name,currentValueAttribute:t,format:"",table:a,valueAttributes:e.valueAttributes})}))}})),y=x}if(!y||y.length<=0)dsf.layer.pc.message("未查找到可用的导出信息配置",!1);else if(m&&!f||i){var b=e.owner.tableExportResult||[],S=function(t,a){var n;if(v)return null===t||void 0===t||null===(n=t.asyncExportFunc)||void 0===n||n.call(t,e.owner,l,a,d,p),!1;if(t&&t.yes){var r=t.yes(),i=r.extName,s=r.fields,o=r.fieldIds;if(s.length<=0)return dsf.layer.pc.message("请选择要导出的数据字段",!1),!1;e.owner.$emit("update:tableExportResult",o),k(l,a,i,s,d),e.owner.$addCustom(e.owner.caption,{tableExportResult:o})}};this.$openDialog({title:"导出设置",width:"700px",height:"auto",content:"DsfExportSetting",footerAlign:"center",params:{fileName:o,allow:s,fields:y,fieldIds:i?b:[],showDownloadButton:v,showExportCustomFieldsSetting:i,nameSpace:g,pageName:h,customInterface:f,isNewversion:m,exportCallback:S},btns:[]})}else{var N,D,O=o.split(".");1==O.length?(N=O[0],D=""):O.length>0&&(N=O.slice(0,O.length-1).join("."),D=O[O.length-1]),k(l,N,D,y,d)}}else dsf.layer.pc.message("未查找到可用的导出接口地址",!1)}function k(t,a,n,r,i){var s=e.owner.multipleSelection;if(!c&&s.length>0){var o="";dsf.layer.openDialog({title:"提示",width:"420px",height:"45px",template:"请选择您需要的导出结果",customClass:"confirm-dialog",btnSize:"small",draggable:!1,btns:[{text:"选中数据",handler:function(){var s=e.owner.multipleSelection;o=_.map(s,"_id"),P(t,a,n,r,i,o)}},{text:"当前查询结果",handler:function(){P(t,a,n,r,i,o)}}]})}else{var l=null;e.owner.isAllPageSelect&&!e.owner.isAllSelected&&s.length>0&&(l=_.map(s,"_id")),P(t,a,n,r,i,l)}}function P(t,a,n,r,i,s){var o=dsf.url.getWebPath(u,e.owner.$baseUrl),l={rule:e.owner.caption+"."+t,data:null,fileName:a,extName:n,fields:JSON.stringify(_.map(r,"id")),params:JSON.stringify(i),nameSpace:g,pageName:h,serialNum:p?1:0,subTableName:e.owner.metadata_fullcode},d=dsf.url.queryString("id");d&&(l["data"]=JSON.stringify({_id:d}));var c="";e.owner.isAllPageSelect&&(l.checkbox=e.owner.isAllSelected||!s?"all":"page",c='<input type="text" name="checkbox">');var f=dsf.url.queryStringStringify(e.owner.queryString),m=o+(o.indexOf("?")>0?"&":"?")+f,v='<form method="post">\n                        <input type="text" name="rule">\n                        <input type="text" name="fileName">\n                        <input type="text" name="extName">\n                        <input type="text" name="fields">\n                        <input type="text" name="params">\n                        <input type="text" name="namespace">\n                        <input type="text" name="pageName">\n                        <input type="text" name="ids">\n                        <input type="text" name="serialNum">\n                        <input type="text" name="client_info">\n                        <input type="text" name="data">\n                        <input type="text" name="subTableName">                        \n                        '.concat(c,"\n                  </form>"),y=$(v);y.attr("action",m),y.find("input[name=rule]").val(l.rule),y.find("input[name=fileName]").val(l.fileName),y.find("input[name=extName]").val(l.extName),y.find("input[name=fields]").val(l.fields),y.find("input[name=params]").val(l.params),y.find("input[name=namespace]").val(l.nameSpace),y.find("input[name=pageName]").val(l.pageName),y.find("input[name=ids]").val(s||""),y.find("input[name=serialNum]").val(l.serialNum),y.find("input[name='client_info']").val(dsf.base64.encode(JSON.stringify(dsf.client.info))),e.owner.isAllPageSelect&&y.find("input[name=checkbox]").val(l.checkbox),l.data?y.find("input[name=data]").val(l.data):y.find("input[name=data]").val(),y.find("input[name=subTableName]").val(l.subTableName),y.appendTo("body").submit().remove()}}function W(e){var t=e.owner,a=e.response,n=e.params[3],r=e.params[4];if(t&&a)if(a.success){var i,s=(null===a||void 0===a||null===(i=a.data)||void 0===i?void 0:i.array)||(null===a||void 0===a?void 0:a.data),o=t.childMetaDataCodes;if("array"==dsf.type(s)){for(var l=[],u=0;u<s.length;u++){var d=s[u];if("array"!=dsf.type(d))return void dsf.layer.message("导入数据格式错误",!1);for(var c={},p=0;p<o.length;p++)d.length>p&&(c[o[p]]=d[p]);l.push(c)}var f=function(a,n){n&&t.clearRows(),t.pushRow(a),r&&e.owner.$dispatch(r,a)};1==n?f(l,!0):2==n?f(l):dsf.layer.confirm({message:"导入数据是否覆盖现有数据?",confirmButtonText:"覆盖",cancelButtonText:"追加"}).then((function(){f(l,!0)})).catch((function(){f(l)})),dsf.layer.message("导入完成",!0)}else dsf.layer.message("接口返回数据格式异常",!1)}else dsf.layer.message("导入异常",!1)}function V(e){var t=e.params[0],a=e.params[1]||"数据选择",n=e.params[2]?e.params[2].split("/"):["1000px","70vh"],r=d()(n,2),i=r[0],s=r[1],o=e.params[3]?e.owner.$vm[e.params[3]]:null,l=(null===o||void 0===o?void 0:o(e.owner))||[];e._self.$openDialog({title:a,width:i,height:s,params:{path:t,selectValue:l,choiceParams:{value:l}},btns:[{text:"确定",handler:function(){var t=p()(m.a.mark((function t(a){var n;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.yes();case 2:if(n=t.sent,!1!==n){t.next=5;break}return t.abrupt("return",!1);case 5:e.owner.$dispatch("datachoice-result",n),e.owner.$dispatch("handleTreeInfo",n);case 7:case"end":return t.stop()}}),t)})));function a(e){return t.apply(this,arguments)}return a}()},{text:"取消"}]})}function K(e){var t=e.owner,a=t.importOptions,n=d()(e.params,7),r=n[0],i=n[1],s=n[2],o=n[3],l=n[4],u=n[5],c=n[6],p=this;function f(n){var d=new FormData;d.append("file",n);var f={};for(var m in t.queryString)f[m]=t.queryString[m];var v={};for(var h in r&&(v.tableName=r),v.code=t.$vm.nameSpace+"."+t.$vm.pageName+"."+r,i&&(v.sheetIndex=i),s&&(v.rowIndex=s),o&&(v.columnIndex=o),a&&(v.rowRules=a),u&&(v.exInfo=u),v&&(f["importAttr"]=JSON.stringify(v)),f)d.append(h,f[h]);var y=dsf.layer.loading();function w(a){if(!a.success)return dsf.layer.message(a.message,!1);var n;a.data.accomplish?l?t.$dispatch(l,a):(t.reloadData&&t.reloadData(),dsf.layer.message("导入成功"),null===e||void 0===e||null===(n=e._self)||void 0===n||null===(n=n.$root)||void 0===n||null===(n=n.$dialogAll)||void 0===n||null===(n=n[0])||void 0===n||n.close()):this.$openDialog({title:"预导入错误数据编辑",width:"95vw",height:"550px",content:"DsfUserImportPanel",center:!0,params:{importOptions:((null===t||void 0===t?void 0:t.importOptions)||[]).map((function(e){var t=e.titleName;return e.isRequired&&/^\*/.test(t)&&(t=t.slice(1)),{name:e.fieldName,label:t,width:"100",fixed:null,validationMethod:e.validationMethod,isRequired:e.isRequired,allowUpdatePersonnelSystem:!0}})),importId:a.data.importId,fileData:a.data.pieceList,servicePrefix:t.$baseUrl,infoText:c,queryFormData:JSON.stringify(f)},showClose:!1,btns:[{text:"确定",handler:function(e){var a=e.$dialog.btnLoading;return a(0,!0),a(1,!0),e.yes().then((function(e){return l?t.$dispatch(l,e):(t.reloadData&&t.reloadData(),dsf.layer.message("导入成功")),Promise.resolve()})).catch((function(e){return Promise.reject(e)})).finally((function(){setTimeout((function(){a(0,!1),a(1,!1)}))}))}},{text:"取消",handler:function(){var e=dsf.layer.loading();return dsf.http.post("import/user/clearImportCache",{importId:a.data.importId},t.$baseUrl).finally((function(){dsf.layer.closeLoading(e)}))}}]})}$.ajax({url:dsf.url.getWebPath("import/user/excel",t.$baseUrl),dataType:"json",type:"post",data:d,processData:!1,contentType:!1,headers:g({},dsf.getDefaultHttpHeader()||{}),error:function(e){dsf.layer.closeLoading(y)},success:function(e){dsf.layer.closeLoading(y),w.call(p,e)}})}$('<input type="file"></input>').on("change",(function(e){f(this.files[0]),$(this).off("change").remove()})).appendTo($(document.body)).click()}}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_pc_button_handler.js.map