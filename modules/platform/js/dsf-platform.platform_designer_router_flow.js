/*!
 * Name: @dsf/cli-platform
 * Version: 5.17.0-alpha.5
 * Description: 平台基础包
 * BuildTime: 2024/6/19 17:49:40
*/
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[9],{392:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return a})),n.d(e,"g",(function(){return r})),n.d(e,"h",(function(){return l})),n.d(e,"f",(function(){return h})),n.d(e,"i",(function(){return c})),n.d(e,"k",(function(){return u})),n.d(e,"j",(function(){return p})),n.d(e,"e",(function(){return f}));var i={vertical:"vertical",horizontal:"horizontal"},o={Left:"left",Right:"right",Top:"top",Bottom:"bottom",LeftTop:"leftTop",LeftBottom:"leftBottom",RightTop:"rightTop",RightBottom:"rightBottom"},s={vertical:"vertical",horizontal:"horizontal"},a={Left:"left",Right:"right",Top:"top",Bottom:"bottom"},r={width:40,height:44},l={width:200,height:124},h={width:500,height:304},d={width:110,height:50,nameWidth:80,imgWidth:110,imgHeight:50},c={101:d,102:d,103:d,104:d,105:d,106:d,107:d,108:d,109:d,201:{width:110,height:50,nameWidth:80,imgWidth:110,imgHeight:50},299:{width:110,height:50,nameWidth:80,imgWidth:110,imgHeight:50},301:{width:150,height:90,nameWidth:78,imgWidth:150,imgHeight:90},302:{width:150,height:90,nameWidth:78,imgWidth:150,imgHeight:90}},u=7,p={uuid:function(t,e){var n,i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=o,a=[];if(t=t||32,e=e||s.length,t)for(n=0;n<t;n++)a[n]=s[0|Math.random()*e];else for(a[8]=a[13]=a[18]=a[23]="",a[14]="4",n=0;n<36;n++)a[n]||(i=0|16*Math.random(),a[n]=s[19==n?3&i|8:i]);return a.join("")},laneTextRotate:function(t){t.css("transform","rotate(-90deg) translateX(-"+t.outerWidth()+"px)")},getNodeCenter:function(t){var e,n,i=(null===t||void 0===t||null===(e=t.point)||void 0===e?void 0:e.x)||0,o=(null===t||void 0===t||null===(n=t.point)||void 0===n?void 0:n.y)||0;return i+=t.width/2,o+=t.height/2,{x:i,y:o}},getNodeArriswiseAngle:function(t){var e={x:t.point.x,y:t.point.y},n={x:t.point.x+t.width,y:t.point.y+t.height},i=this.getAngle(e,n);return i},getNodeDirection:function(t,e){var n="",i=this.getNodeArriswiseAngle(t),o=this.getNodeCenter(t),s=e,r=this.getAngle({x:o.x,y:o.y},{x:s.x,y:s.y}),l=i;return n=0==r||r>=360-l||r<=l?a.Right:90==r||r>l&&r<=180-l?a.Bottom:270==r||r>180+l&&r<360-l?a.Top:a.Left,n},getDirection:function(t,e){var n="",i=this.getAngle({x:parseFloat(t.x),y:parseFloat(t.y)},{x:parseFloat(e.x),y:parseFloat(e.y)});return 0==i||360==i?n=o.Right:i>0&&i<90?n=o.RightBottom:90==i?n=o.Bottom:i>90&&i<180?n=o.LeftBottom:180==i?n=o.Left:i>180&&i<270?n=o.LeftTop:270==i?n=o.Top:i>270&&i<360&&(n=o.RightTop),n},getRadina:function(t,e,n){var i=Math.atan((e.y-t.y)/(e.x-t.x));return 0!=n&&(e.y-t.y>0&&e.x-t.x<0||e.y-t.y<0&&e.x-t.x<0?i+=Math.PI:e.y-t.y<0&&e.x-t.x>0&&(i+=2*Math.PI),e.x<t.x&&e.y==t.y?i=Math.PI:e.x==t.x&&e.y<t.y&&(i=1.5*Math.PI)),i},getAngle:function(t,e){var n=this.getRadina(t,e),i=180/(Math.PI/n);return i},angleToRadina:function(t){return t*Math.PI/180},getLineLength:function(t,e){var n=e.x-t.x,i=e.y-t.y,o=Math.sqrt(Math.pow(n,2)+Math.pow(i,2));return o},getNodeJoinPoint:function(t){var e=this.getNodeCenter(t),n={top:{x:e.x,y:e.y-t.height/2},bottom:{x:e.x,y:e.y+t.height/2},left:{x:e.x-t.width/2,y:e.y},right:{x:e.x+t.width/2,y:e.y}};return n},convertSegmentByPoint:function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],o=t[n+1];if(i&&o){var s=Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2));e.push({sp:i,ep:o,lineLength:s})}}return e},getLineType:function(t){return t.sp.y==t.ep.y?s.horizontal:t.sp.x==t.ep.x?s.vertical:void 0},segmentsIntr:function(t,e,n,i){var o=e.y-t.y,s=t.x-e.x,a=i.y-n.y,r=n.x-i.x,l=o*r-s*a;if(0==l)return!1;var h=a*n.x+r*n.y,d=a*t.x+r*t.y-h,c=a*e.x+r*e.y-h;if(d*c>=0)return!1;var u=o*t.x+s*t.y,p=o*n.x+s*n.y-u,f=o*i.x+s*i.y-u;if(p*f>=0)return!1;var y=d/l,g=y*s,x=-y*o;return{x:t.x+g,y:t.y+x}},drawArrow:function(t){var e=8,n=t.ep.x,i=t.ep.y,o=p.getAngle(t.sp,t.ep),s=this.rad(o-25),a=this.rad(o+25),r=n-Math.cos(s)*e,l=i-Math.sin(s)*e,h=n-Math.cos(a)*e,d=i-Math.sin(a)*e,c=["M",n,i,"L",r,l,"L",h,d,"Z"];return c},rad:function(t){return t%360*Math.PI/180}},f=[{text:"左对齐(L)",pos:"left"},{text:"水平居中(C)",pos:"center"},{text:"右对齐(R)",pos:"right"},{text:"顶端对齐(T)",pos:"top"},{text:"底端对齐(B)",pos:"bottom"},{text:"水平居中(M)",pos:"middle"},{text:"横向分布(H)",pos:"horizontal"},{text:"纵向分布(V)",pos:"vertical"}]},393:function(t,e,n){"use strict";n.d(e,"e",(function(){return s})),n.d(e,"g",(function(){return a})),n.d(e,"f",(function(){return r})),n.d(e,"h",(function(){return l})),n.d(e,"d",(function(){return d})),n.d(e,"b",(function(){return c})),n.d(e,"l",(function(){return u})),n.d(e,"c",(function(){return p})),n.d(e,"m",(function(){return f})),n.d(e,"i",(function(){return g})),n.d(e,"k",(function(){return x})),n.d(e,"j",(function(){return b})),n.d(e,"a",(function(){return m}));var i=n(2),o=n.n(i),s=function(t,e,n){return t.find((function(t){return(n?t[n]:t.id)===e}))},a=function(t,e){var n;return e.dataset&&e.dataset.id&&t.forEach((function(t){t.id===e.dataset.id&&(n=t)})),n},r=function(t,e,n){var i,o;return n.dataset&&n.dataset.parentId&&t.forEach((function(t){t.id===n.dataset.parentId&&(o=t,t[e].forEach((function(t){t.id===n.dataset.id&&(i=t)})))})),o&&i?{parent:o,sub:i}:void 0},l=function(t){return $(t).data("object")},h=10,d=function(t){var e={x:void 0==t.x?0:t.x,y:void 0==t.y?0:t.y};if(0!=e.x){var n=e.x%h;0!=n&&(e.x=n>h/2?e.x-n+h:e.x-n)}if(0!=e.y){var i=e.y%h;0!=i&&(e.y=i>h/2?e.y-i+h:e.y-i)}return e},c=function(t){var e=Object.getPrototypeOf(t);return Array.isArray(t)?Object.assign([],Object.create(e),t):Object.assign({},Object.create(e),t)},u=function(t){return"".concat(t,"px")},p=function(t){var e={};return t.forEach((function(t){t.attributes.forEach((function(t){var n=t.bindControlAttr;if(n)for(var i=n.split("."),o=e,s=0;s<i.length;s++){var a=i[s];s<i.length-1?(void 0===o[a]&&(o[a]={}),o=o[a]):void 0===o[a]&&(o[a]=dsf.isDef(t.value)?t.value:"boolean"==t.showType?0:void 0)}}))})),e},f=function(t){var e=t&&t.attributes.BaseInfo;return!(!e||0!==e.Mode||!e.SubWFID)},y={},g=function(t){var e=y[t];return e?_.cloneDeep(e):(y[t]=[],dsf.http.get("$/pd_attributes/flow/".concat(t,".json")).done((function(e){var n;return(n=y[t]).push.apply(n,o()(e)),_.cloneDeep(y[t])})))};function x(t){window.html2canvas?null===t||void 0===t||t():dsf.http.importFiles([dsf.url.getWebPath("$/js/libs/html2canvas/html2canvas.min.js")]).then((function(){null===t||void 0===t||t()})).catch((function(t){dsf.layer.message("加载html2canvas文件报错",!1),reject()}))}var v=new Image(1,1);function m(t){var e,n,i;return null===t||void 0===t||null===(e=t.dataTransfer)||void 0===e||e.setData("__"," "),null===t||void 0===t||null===(n=t.dataTransfer)||void 0===n||null===(i=n.setDragImage)||void 0===i||i.call(n,v,0,0),t}function b(t){return dsf.http.get("/intellect/robot/findCommonRobotConfig",{id:t}).done((function(t){if(t.success)return t.data}))}v.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},398:function(t,e,n){t.exports=n.p+"modules/platform/img/default-header.png"},403:function(t,e,n){t.exports=n.p+"modules/platform/img/status-2.png"},404:function(t,e,n){t.exports=n.p+"modules/platform/img/status-3.png"},405:function(t,e,n){t.exports=n.p+"modules/platform/img/status-4.png"},406:function(t,e,n){t.exports=n.p+"modules/platform/img/status0.png"},407:function(t,e,n){t.exports=n.p+"modules/platform/img/status1.png"},408:function(t,e,n){t.exports=n.p+"modules/platform/img/status2.png"},409:function(t,e,n){"use strict";var i=n(4),o=n.n(i),s=n(1),a=n.n(s),r=n(392),l=n(393),h=function(t){var e,n,i,s,h,d=0===(null===t||void 0===t||null===(e=t.type)||void 0===e?void 0:e.indexOf("10"))&&"102"!==t.type?r["h"]:r["g"],c=5,u=120;this.padding=c,this.nameWidth=u;var p={name:"",width:d.width,height:d.height,x:0,y:0,img:"",type:"101"};if(null!==t&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.content){var f=JSON.parse(t.data.content);Object.assign(p,f,{x:t.x,y:t.y,id:t.id})}else Object.assign(p,t);this.point={x:p.x,y:p.y},this.id=p.id||null,this.icons=(null===p||void 0===p||null===(i=p.data)||void 0===i?void 0:i.icons)||[],this.name=p.name,this.width=p.width,this.height=p.height,this.imgWidth=r["g"].width,this.imgHeight=r["g"].height,0===(null===p||void 0===p||null===(s=p.type)||void 0===s?void 0:s.indexOf("10"))&&(this.open=Object.assign({show:"102"!==p.type,width:"102"===p.type?r["f"].width:r["h"].width,height:"102"===p.type?r["f"].height:r["h"].height},p.open),this.taskMsg=p.taskMsg||"",this.imgType=p.imgType),this.isRender=!1,this.type=p.type,this.out=[],this.in=[],this.isHide=p.isHide,p.isThrough&&(this.isThrough=p.isThrough),(p.rid||null!==p&&void 0!==p&&null!==(h=p.data)&&void 0!==h&&h.rid)&&(this.rid=p.rid||p.data.rid),(p.isGeneral||"199"==(null===p||void 0===p?void 0:p.type))&&(this.isGeneral=!0),this.attributes=null,this.setAttributes=function(){var t=o()(a.a.mark((function t(e){var n,i,o,s;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["i"])("node"+(this.isGeneral?"general":e.type));case 2:n=t.sent,i=Object(l["c"])(n),e.attributes?this.attributes=dsf.mix(!0,i,e.attributes):(this.attributes=i,this.attributes.BaseInfo||(this.attributes.BaseInfo={}),this.attributes.BaseInfo.Name=this.name,this.attributes.BaseInfo.ID=this.id,102!=e.type&&(this.attributes.BaseInfo.ShowOrder=e.order||this.attributes.BaseInfo.ShowOrder),51==(null===(o=this.attributes)||void 0===o||null===(o=o.InLine)||void 0===o||null===(o=o.RangeRule)||void 0===o?void 0:o.Type)&&(s=this.attributes.InLine.RangeRule.Rule[0],s.RobotID=e.data.code||s.RobotID,s.RobotName=e.data.name||s.RobotName));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),this.reset=function(t){if("normal"===t){var e,n,i;if(null!==(e=this.open)&&void 0!==e&&e.show)n=0===(null===(i=this.type)||void 0===i?void 0:i.indexOf("10"))&&"102"!==this.type?r["h"]:this.open;else n=r["g"];this.point.x=this.point.x+this.width/2-n.width/2,this.point.y=this.point.y+this.height/2-n.height/2,this.width=n.width,this.height=n.height,this.padding=c,this.nameWidth=u,this.imgWidth=r["g"].width,this.imgHeight=r["g"].height}else{var o=r["i"][this.imgType||this.type];this.point.x=this.point.x+this.width/2-o.width/2,this.point.y=this.point.y+this.height/2-o.height/2,Object.assign(this,o)}},this.setAttributes(p)};e["a"]=h},410:function(t,e,n){"use strict";var i=n(4),o=n.n(i),s=n(1),a=n.n(s),r=n(393),l=function(t,e){var n,i,s,l=[],h={path:[],from:null,to:null,strokeWidth:null===t||void 0===t||null===(n=t.Path)||void 0===n?void 0:n.strokeWidth,stroke:null===t||void 0===t||null===(i=t.Path)||void 0===i?void 0:i.stroke,arrowEnd:null===t||void 0===t||null===(s=t.Path)||void 0===s?void 0:s.arrow},d=!1;Object.assign(h,e),this.id=h.id||null,this.name=h.name||"",this.type=h.type||0,this.path=h.path?$.inArray(h.path)?h.path:[h.path]:[],this.from=h.from,this.fromType=h.fromType,this.to=h.to,this.strokeWidth=h.strokeWidth,this.stroke=h.stroke,this.strokeDasharray=h.strokeDasharray,this.arrowEnd=h.arrowEnd,this.linkInfo=h.linkInfo||{},this.isHide=h.isHide||!1,this.parentNodeId=h.parentNodeId,h.isThrough&&(this.isThrough=h.isThrough),this.edit=h.edit||{show:!0,isEdit:!1,editName:!1,name1:""},this.propertyPos=h.propertyPos||{x:0,y:0,isMove:!1},this.attributes=null,h.attributes&&(this.attributes=dsf.mix(!0,{},h.attributes)),this.remove=function(){if(l)for(var t=l.length-1;t>=0;t--)l[t].remove();l=[]},this.getSegmenList=function(){return l},this.refresh=function(){if(l)for(var t=0;t<l.length;t++)l[t].refresh()},this.addElement=function(t){l.push(t)},this.isSelected=function(){return d},this.selected=function(){d=!0,this.stroke="#333",this.refresh()},this.unSelected=function(){d=!1,this.stroke=this.getLineStroke.call(this),this.refresh()},this.hide=function(){if(l)for(var t=l.length-1;t>=0;t--)l[t].hide()},this.show=function(){if(l)for(var t=l.length-1;t>=0;t--)l[t].show()},this.getPreLine=function(t){return l[t.index-1]},this.getNextLine=function(t){return l[t.index+1]},this.getLineStroke=function(){var e,n;if(this.isThrough)return null===t||void 0===t||null===(e=t.Path)||void 0===e?void 0:e.isThrough;if(this.isSelected())return null===t||void 0===t||null===(n=t.Path)||void 0===n?void 0:n.isSelected;var i,o=null===t||void 0===t?void 0:t.Lines["Line_"+this.type];return o?null===o||void 0===o?void 0:o.stroke:null===t||void 0===t||null===(i=t.Path)||void 0===i?void 0:i.stroke},this.setAttributes=function(){var t=o()(a.a.mark((function t(e,n){var i,o,s;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(r["i"])("line");case 2:o=t.sent,i=Object(r["c"])(o),this.attributes?i=dsf.mix(!0,i,this.attributes):(null===e||void 0===e||null===(s=e.out)||void 0===s?void 0:s.length)>1&&(i.BaseInfo.ShowOrder=e.out.length),i.BaseInfo.StartNodeID=this.from,i.BaseInfo.EndNodeID=this.to,this.name=this.name||e.name+"→"+n.name,i.BaseInfo.Name=this.name,i.BaseInfo.ID=this.id,i.BaseInfo.Type=this.type,this.attributes=i;case 12:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()};e["a"]=l},411:function(t,e,n){"use strict";function i(t){var e=[{value:0,text:"单人办理"},{value:1,text:"会签（多人同时处理）"},{value:2,text:"多人依次处理"},{value:3,text:"抄送（需提交）"},{value:4,text:"抄送（不需提交）"},{value:5,text:"抢办（按人数）"},{value:6,text:"抢办（按比例）"},{value:7,text:"抢办（同部门抢办）"},{value:8,text:"抢办（选人抢办）"}];return void 0!==t?o(e,t):e}function o(t,e){if(e+"")for(var n=0;n<t.length;n++)if(e==t[n].value)return t[n].text||t[n].label}function s(t){var e=[{label:"人工选择",value:0},{label:"默认选中",value:1},{label:"必选",value:2}];return void 0!==t?o(e,t):e}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"d",(function(){return d})),n.d(e,"c",(function(){return c}));var a=[{name:"开始事件",sort:"event",type:201},{name:"用户任务",sort:"task",type:101},{name:"条件网关",sort:"gateway",type:301},{name:"跳转网关",sort:"gateway",type:302},{name:"子流程任务",sort:"task",type:102},{name:"脚本任务",sort:"task",type:103},{name:"结束事件",sort:"event",type:299}],r=[{name:"用户任务",sort:"task",type:101},{name:"子流程任务",sort:"task",type:102},{name:"脚本任务",sort:"task",type:103},{name:"web服务任务",sort:"task",type:104},{name:"消息任务",sort:"task",type:105},{name:"python任务",sort:"task",type:106},{name:"shell任务",sort:"task",type:107},{name:"SQL任务",sort:"task",type:108},{name:"lua",sort:"task",type:109},{name:"R",sort:"task",type:110},{name:"消息哨兵",sort:"task",type:111},{name:"定时哨兵",sort:"task",type:112},{name:"数据转换",sort:"task",type:113},{name:"数据备份",sort:"task",type:114},{name:"数据还原",sort:"task",type:115},{name:"自由流",sort:"task",type:121}],l=[{name:"开始事件",sort:"event",type:201},{name:"结束事件",sort:"event",type:299}],h=[{name:"条件网关",sort:"gateway",type:301},{name:"跳转网关",sort:"gateway",type:302}],d=[{name:"终止事件",sort:"boundaryEvent",type:401},{name:"超时事件",sort:"boundaryEvent",type:402},{name:"异常事件",sort:"boundaryEvent",type:403}],c=[{name:"关键控制点",sort:"attached",type:"mark"},{name:"风险控制点",sort:"attached",type:"risk"}],u=[{name:"基础",components:a},{name:"任务",components:r},{name:"事件",components:l},{name:"网关",components:h},{name:"边界事件",components:d},{name:"附属属性",components:c}]},416:function(t,e,n){t.exports=n.p+"modules/platform/img/101_c_s.png"},417:function(t,e,n){t.exports=n.p+"modules/platform/img/101_s.png"},418:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n(33),o=n.n(i),s=n(34),a=n.n(s),r=n(392),l=function(){function t(e,n){o()(this,t),this.name=e.name,this.url=e.url,this.type=e.type,this.id=e.id||r["j"].uuid(),this.offset=e.offset||(n?{x:n.offsetX,y:n.offsetY}:{x:0,y:0}),this.point=e.point||{x:e.x,y:e.y},this.width=e.width||32,this.height=e.height||32,this.img=e.img||{width:32,height:32},e.from&&(this.from=e.from),this.direction=e.direction,this.index=e.index,this.out=e.out||[],this.isHide=e.isHide||!1,this.attributes=e.attributes||{Name:this.name,ID:this.id,Type:this.type},this.nodeId=e.nodeId,this.edit=!1}return a()(t,[{key:"setAttributes",value:function(t){this.attributes=t}},{key:"getAttributes",value:function(){return this.attributes}}]),t}()},432:function(t,e,n){t.exports=n.p+"modules/platform/img/head_logo.png"},435:function(t,e,n){t.exports=n.p+"modules/platform/img/flow-ybj.png"},443:function(t,e,n){t.exports=n.p+"modules/platform/img/ry1.png"},445:function(t,e,n){var i={"./101.png":597,"./101_c.png":598,"./101_c_s.png":416,"./101_s.png":417,"./102.png":830,"./102_s.png":446,"./103.png":831,"./103_s.png":447,"./104.png":832,"./104_s.png":448,"./105.png":833,"./105_s.png":449,"./106.png":834,"./106_s.png":450,"./107.png":835,"./107_s.png":451,"./108.png":836,"./108_s.png":452,"./109.png":837,"./109_s.png":453,"./201.png":838,"./201_s.png":454,"./202.png":839,"./203.png":840,"./204.png":841,"./204_s.png":455,"./299.png":842,"./299_s.png":456,"./301.png":843,"./301_s.png":457,"./302.png":844,"./302_s.png":458,"./401.png":845,"./402.png":846,"./403.png":847,"./addLane.png":459,"./bgs.png":848,"./bgs1.png":849,"./bm.png":850,"./default-header.png":398,"./event-abnormal.png":851,"./event-end.png":852,"./event-start.png":853,"./event-timing.png":854,"./flow-ybj.png":435,"./head_logo.png":432,"./mark.png":855,"./risk.png":856,"./ry.png":857,"./ry1.png":443,"./status-2.png":403,"./status-3.png":404,"./status-4.png":405,"./status0.png":406,"./status1.png":407,"./status2.png":408};function o(t){var e=s(t);return n(e)}function s(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}o.keys=function(){return Object.keys(i)},o.resolve=s,t.exports=o,o.id=445},446:function(t,e,n){t.exports=n.p+"modules/platform/img/102_s.png"},447:function(t,e,n){t.exports=n.p+"modules/platform/img/103_s.png"},448:function(t,e,n){t.exports=n.p+"modules/platform/img/104_s.png"},449:function(t,e,n){t.exports=n.p+"modules/platform/img/105_s.png"},450:function(t,e,n){t.exports=n.p+"modules/platform/img/106_s.png"},451:function(t,e,n){t.exports=n.p+"modules/platform/img/107_s.png"},452:function(t,e,n){t.exports=n.p+"modules/platform/img/108_s.png"},453:function(t,e,n){t.exports=n.p+"modules/platform/img/109_s.png"},454:function(t,e,n){t.exports=n.p+"modules/platform/img/201_s.png"},455:function(t,e,n){t.exports=n.p+"modules/platform/img/204_s.png"},456:function(t,e,n){t.exports=n.p+"modules/platform/img/299_s.png"},457:function(t,e,n){t.exports=n.p+"modules/platform/img/301_s.png"},458:function(t,e,n){t.exports=n.p+"modules/platform/img/302_s.png"},459:function(t,e,n){t.exports=n.p+"modules/platform/img/addLane.png"},460:function(t,e,n){"use strict";var i=n(3),o=n.n(i),s=n(4),a=n.n(s),r=n(1),l=n.n(r),h=n(392),d=n(393);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var p=function(t){var e=Object.assign({size:260,direction:h["a"].vertical},t);this.id=e.id||null,this.name=e.name||"",this.index=e.index,this.direction=e.direction,this.isRender=!1,this.size=e.size,this.setAttributes=a()(l.a.mark((function t(){var n;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.attributes){t.next=9;break}return t.next=3,Object(d["i"])("lane");case 3:n=t.sent,this.attributes=Object(d["c"])(n),this.attributes.Name=this.name,this.attributes.ID=this.id,t.next=10;break;case 9:this.attributes=u({},e.attributes);case 10:case"end":return t.stop()}}),t,this)}))),this.setAttributes()};e["a"]=p},461:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));var i=n(392);function o(t){var e=t.fromDirection,n=t.targetDirection,o=t.fromNode,s=t.targetNode,a=t.startPoint,r=t.endPoint,l=i["j"].getDirection(a,r),h=[],d=30;if(e==i["b"].Right&&n==i["b"].Left){if(l==i["c"].Right)h.push({x:a.x,y:a.y}),h.push({x:r.x,y:r.y});else if(l==i["c"].RightTop||l==i["c"].RightBottom)h.push({x:a.x,y:a.y}),h.push({x:a.x+(r.x-a.x)/2,y:a.y}),h.push({x:a.x+(r.x-a.x)/2,y:a.y+(r.y-a.y)}),h.push({x:r.x,y:r.y});else if(l==i["c"].Bottom||l==i["c"].Top||l==i["c"].Left||l==i["c"].LeftTop||l==i["c"].LeftBottom)if(h.push({x:a.x,y:a.y}),o.point.y>s.point.y+s.height){h.push({x:a.x+d,y:a.y});var c=h[h.length-1],u=Math.abs(o.point.y-(s.point.y+s.height))/2;h.push({x:c.x,y:o.point.y-u}),c=h[h.length-1],h.push({x:r.x-d,y:c.y}),c=h[h.length-1],h.push({x:c.x,y:r.y}),h.push({x:r.x,y:r.y})}else if(s.point.y>o.point.y+o.height>0){h.push({x:a.x+d,y:a.y});c=h[h.length-1],u=Math.abs(s.point.y-(o.point.y+o.height))/2;h.push({x:c.x,y:s.point.y-u}),c=h[h.length-1],h.push({x:r.x-d,y:c.y}),c=h[h.length-1],h.push({x:c.x,y:r.y}),h.push({x:r.x,y:r.y})}else{var p=d;p=s.point.x+s.width<=o.point.x+o.width?d:s.point.x+s.width+d-a.x,h.push({x:a.x+p,y:a.y});c=h[h.length-1];r.y<a.y?(h.push({x:c.x,y:s.point.y-d}),c=h[h.length-1],h.push({x:s.point.x-d,y:c.y}),h.push({x:s.point.x-d,y:r.y}),h.push({x:r.x,y:r.y})):(h.push({x:c.x,y:s.point.y+s.height+d}),c=h[h.length-1],h.push({x:s.point.x-d,y:c.y}),h.push({x:s.point.x-d,y:r.y}),h.push({x:r.x,y:r.y}))}}else if(e==i["b"].Right&&n==i["b"].Right){if(l==i["c"].Right||l==i["c"].Bottom||l==i["c"].Top||l==i["c"].RightTop||l==i["c"].RightBottom){h.push({x:a.x,y:a.y});c=h[h.length-1];var f={x:c.x,y:c.y};if(c.y>s.point.y-d&&c.y<s.point.y+s.height+d){f.x=o.point.x+o.width+d,h.push(f);c=h[h.length-1],f={x:c.x,y:c.y};Math.abs(c.y-s.point.y)<Math.abs(c.y-(s.point.y+s.height))?f.y=s.point.y-d:f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y}}o.point.x+o.width>s.point.x+s.width?f.x=o.point.x+o.width+d:f.x=s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f),h.push(r)}else if(l==i["c"].Left||l==i["c"].LeftTop||l==i["c"].LeftBottom){h.push({x:a.x,y:a.y}),h.push({x:a.x+d,y:a.y});c=h[h.length-1],f={x:c.x,y:c.y};r.y>o.point.y-d&&r.y<o.point.y+o.height+d?Math.abs(r.y-o.point.y)<Math.abs(r.y-(o.point.y+o.height))?f.y=o.point.y-d:f.y=o.point.y+o.height+d:f.y=r.y,h.push(f),c=h[h.length-1],c.y!=r.y&&(f={x:c.x,y:c.y},f.x=r.x+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)),h.push({x:r.x,y:r.y})}}else if(e==i["b"].Right&&n==i["b"].Top){if(l==i["c"].Right||l==i["c"].Top||l==i["c"].RightBottom||l==i["c"].RightTop){if(h.push({x:a.x,y:a.y}),s.point.y>a.y)h.push({x:r.x,y:a.y});else{if(s.point.x<=o.point.x+o.width&&s.point.x+s.width>=o.point.x){var y=d;y=s.point.x+s.width>o.point.x+o.width?s.point.x+s.width+d:o.point.x+o.width+d,h.push({x:y,y:a.y})}else{var g=Math.abs(s.point.x-(o.point.x+o.width));y=d;g<=d&&(y=g/2),h.push({x:a.x+y,y:a.y})}c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y-d,h.push(f),c=h[h.length-1],h.push({x:r.x,y:c.y})}h.push({x:r.x,y:r.y})}else if(l==i["c"].Left||l==i["c"].Bottom||l==i["c"].LeftTop||l==i["c"].LeftBottom){if(h.push({x:a.x,y:a.y}),l!=i["c"].LeftBottom&&l!=i["c"].Bottom&&s.point.x+s.width>o.point.x+o.width?h.push({x:s.point.x+s.width+d,y:a.y}):h.push({x:a.x+d,y:a.y}),s.point.y-(o.point.y+o.height)>0){c=h[h.length-1],f={x:c.x,y:c.y};y=d;s.point.y-(o.point.y+o.height)<=d&&(y=(s.point.y-(o.point.y+o.height))/2),f.y=s.point.y-y,h.push(f),c=h[h.length-1],f={x:r.x,y:c.y},h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},o.point.y<s.point.y?f.y=o.point.y-d:f.y=s.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);h.push({x:r.x,y:r.y})}}else if(e==i["b"].Right&&n==i["b"].Bottom){if(l==i["c"].Right||l==i["c"].Bottom||l==i["c"].RightBottom||l==i["c"].RightTop){if(h.push({x:a.x,y:a.y}),s.point.y+s.height<a.y)h.push({x:r.x,y:a.y});else{if(s.point.x<=o.point.x+o.width&&s.point.x+s.width>=o.point.x){y=d;y=s.point.x+s.width>o.point.x+o.width?s.point.x+s.width+d:o.point.x+o.width+d,h.push({x:y,y:a.y})}else{g=Math.abs(s.point.x-(o.point.x+o.width)),y=d;g<=d&&(y=g/2),h.push({x:a.x+y,y:a.y})}c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],h.push({x:r.x,y:c.y})}h.push({x:r.x,y:r.y})}else if(l==i["c"].Left||l==i["c"].Top||l==i["c"].LeftTop||l==i["c"].LeftBottom){if(h.push({x:a.x,y:a.y}),l!=i["c"].LeftTop&&l!=i["c"].Top&&s.point.x+s.width>o.point.x+o.width?h.push({x:s.point.x+s.width+d,y:a.y}):h.push({x:a.x+d,y:a.y}),o.point.y-(s.point.y+s.height)>0){c=h[h.length-1],f={x:c.x,y:c.y};y=d;s.point.y-(o.point.y+o.height)<=d&&(y=(s.point.y-(o.point.y+o.height))/2),f.y=s.point.y-y,h.push(f),c=h[h.length-1],f={x:r.x,y:c.y},h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.y+s.height>o.point.y+o.height?f.y=s.point.y+s.height+d:f.y=o.point.y+o.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);h.push({x:r.x,y:r.y})}}else if(e==i["b"].Bottom&&n==i["b"].Left){y=d;if(l==i["c"].RightBottom||l==i["c"].RightTop||l==i["c"].Right)h.push({x:a.x,y:a.y}),r.y>o.point.y+o.height?h.push({x:a.x,y:r.y}):s.point.x<=o.point.x+o.width?(s.point.y+s.height>o.point.y+o.height&&(y=s.point.y+s.height-(o.point.y+o.height)+d),h.push({x:a.x,y:a.y+y}),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x>o.point.x?f.x=o.point.x-d:f.x=s.point.x-d,h.push(f),c=h[h.length-1],h.push({x:c.x,y:r.y})):(h.push({x:a.x,y:a.y+d}),s.point.x-(o.point.x+o.width)<=2*d&&(y=(s.point.x-(o.point.x+o.width))/2),c=h[h.length-1],h.push({x:r.x-y,y:c.y}),c=h[h.length-1],h.push({x:c.x,y:r.y}));else if(l==i["c"].Top||l==i["c"].LeftTop)h.push({x:a.x,y:a.y}),s.point.y+s.height>o.point.y+o.height&&(y=s.point.y+s.height-(o.point.y+o.height)+d),h.push({x:a.x,y:a.y+y}),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x>o.point.x?f.x=o.point.x-d:f.x=s.point.x-d,h.push(f),c=h[h.length-1],h.push({x:c.x,y:r.y});else if(l==i["c"].Bottom||l==i["c"].LeftBottom||l==i["c"].Left)if(h.push({x:a.x,y:a.y}),s.point.y-(o.point.y+o.height)>0){var x=s.point.y-(o.point.y+o.height);x>2*d?h.push({x:a.x,y:a.y+d}):h.push({x:a.x,y:a.y+x/2}),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x-30,h.push(f),c=h[h.length-1],f={x:c.x,y:r.y},h.push(f)}else s.point.y+s.height>o.point.y+o.height&&(y=s.point.y+s.height-(o.point.y+o.height)+d),h.push({x:a.x,y:a.y+y}),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x>o.point.x?f.x=o.point.x-d:f.x=s.point.x-d,h.push(f),c=h[h.length-1],h.push({x:c.x,y:r.y});h.push({x:r.x,y:r.y})}else if(e==i["b"].Bottom&&n==i["b"].Bottom){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Right||l==i["c"].RightTop||l==i["c"].Top||l==i["c"].LeftTop)if(s.point.y+s.height>o.point.y+o.height&&(y=s.point.y+s.height-(o.point.y+o.height)+d),h.push({x:a.x,y:a.y+y}),c=h[h.length-1],f={x:c.x,y:c.y},r.x<o.point.x+o.width+d&&r.x>o.point.x-d){if(v=i["j"].getNodeCenter(s),v.x>a.x?(f.x=o.point.x+o.width+d,h.push(f)):(f.x=o.point.x-d,h.push(f)),c=h[h.length-1],f={x:c.x,y:c.y},o.point.y-(s.point.y+s.height)>2*d)f.y=s.point.y+s.height+d;else if(o.point.y-(s.point.y+s.height)<=0)f.y=s.point.y+s.height+d;else{x=o.point.y-(s.point.y+s.height);f.y=s.point.y+s.height+x/2}h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else f.x=r.x,h.push(f);else if(l==i["c"].Left||l==i["c"].RightBottom||l==i["c"].LeftBottom||l==i["c"].Bottom)if(c=h[h.length-1],f={x:c.x,y:c.y},s.point.x-d<=a.x&&s.point.x+s.width+d>a.x){if(s.point.y-(o.point.y+o.height)>d||s.point.y-(o.point.y+o.height)<=0)f.y=a.y+d,h.push(f);else{x=(s.point.y-(o.point.y+o.height))/2;f.y=a.y+x,h.push(f)}var v=i["j"].getNodeCenter(s);v.x>a.x?(c=h[h.length-1],f={x:c.x,y:c.y},f.x=s.point.x-d,h.push(f)):(c=h[h.length-1],f={x:c.x,y:c.y},f.x=s.point.x+s.width+d,h.push(f)),c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else o.point.y+o.height>s.point.y+s.height?f.y=o.point.y+o.height+d:f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);h.push({x:r.x,y:r.y})}else if(e==i["b"].Bottom&&n==i["b"].Right){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Top||l==i["c"].Bottom||l==i["c"].Right||l==i["c"].RightBottom||l==i["c"].RightTop)s.point.y-(o.point.y+o.height)>0?(c=h[h.length-1],f={x:c.x,y:c.y},y=s.point.y-(o.point.y+o.height)>2*d?d:(s.point.y-(o.point.y+o.height))/2,f.y=f.y+y,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)):(c=h[h.length-1],f={x:c.x,y:c.y},o.point.y+o.height>s.point.y+s.height?f.y=o.point.y+o.height+d:f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},o.point.x+o.width>s.point.x+s.width?f.x=o.point.x+o.width+d:f.x=s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f));else if(l==i["c"].LeftTop||l==i["c"].Left||l==i["c"].LeftBottom)if(r.y<=a.y)if(s.point.x+s.width<o.point.x){if(h.push({x:a.x,y:o.point.y+o.height+d}),c=h[h.length-1],f={x:c.x,y:c.y},o.point.x-(s.point.x+s.width)<=d){x=Math.abs(s.point.x+s.width-o.point.x)/2;f.x=s.point.x+s.width+x}else f.x=s.point.x+s.width+d;h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else o.point.y+o.height>s.point.y+s.height?h.push({x:a.x,y:o.point.y+o.height+d}):h.push({x:a.x,y:s.point.y+s.height+d}),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x+s.width>o.point.x+o.width?f.x=s.point.x+s.width+d:f.x=o.point.x+o.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f);else h.push({x:a.x,y:r.y});h.push({x:r.x,y:r.y})}else if(e==i["b"].Bottom&&n==i["b"].Top){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Top||l==i["c"].Right||l==i["c"].Left||l==i["c"].RightTop||l==i["c"].LeftTop)s.point.x<=o.point.x+o.width&&s.point.x+s.width>=o.point.x?(h.push({x:a.x,y:a.y+d}),v=i["j"].getNodeCenter(s),c=h[h.length-1],f={x:c.x,y:c.y},v.x>a.x?(f.x=o.point.x<s.point.x?o.point.x:s.point.x,f.x-=d):(f.x=o.point.x+o.width<s.point.x+s.width?s.point.x+s.width:o.point.x+o.width,f.x+=d),h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=o.point.y<s.point.y?o.point.y:s.point.y,f.y-=d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)):(h.push({x:a.x,y:a.y+d}),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x>o.point.x+o.width?f.x=o.point.x+o.width+(s.point.x-(o.point.x+o.width))/2:o.point.x>s.point.x+s.width&&(f.x=o.point.x-(o.point.x-(s.point.x+s.width))/2),h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f));else if((l==i["c"].Bottom||l==i["c"].LeftBottom||l==i["c"].RightBottom)&&r.x!=a.x){x=s.point.y-(o.point.y+o.height);h.push({x:a.x,y:a.y+x/2}),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}h.push({x:r.x,y:r.y})}else if(e==i["b"].Left&&n==i["b"].Left){y=d;h.push({x:a.x,y:a.y}),l==i["c"].Top||l==i["c"].Bottom||l==i["c"].Right||l==i["c"].RightTop||l==i["c"].RightBottom?(h.push({x:a.x-d,y:a.y}),c=h[h.length-1],f={x:c.x,y:c.y},r.y>o.point.y-d&&r.y<o.point.y+o.height+d?(r.y<a.y?f.y=o.point.y-d:f.y=o.point.y+o.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)):(f.y=r.y,h.push(f))):l!=i["c"].Left&&l!=i["c"].LeftBottom&&l!=i["c"].LeftTop||(c=h[h.length-1],f={x:c.x,y:c.y},a.y>s.point.y-d&&a.y<s.point.y+s.height+d?(h.push({x:a.x-d,y:a.y}),c=h[h.length-1],f={x:c.x,y:c.y},Math.abs(c.y-s.point.y)<Math.abs(c.y-(s.point.y+s.height))?f.y=s.point.y-d:f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=s.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)):(f.x=s.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f))),h.push({x:r.x,y:r.y})}else if(e==i["b"].Left&&n==i["b"].Top){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Right||l==i["c"].RightTop||l==i["c"].RightBottom||l==i["c"].Bottom)if(s.point.y-(o.point.y+o.height)>0){c=h[h.length-1],f={x:c.x,y:c.y},f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y};x=s.point.y-(o.point.y+o.height);f.y=x>2*d?s.point.y-d:o.point.y+o.height+x/2,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.x<o.point.x?f.x=s.point.x-d:f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);else if(l==i["c"].Top||l==i["c"].LeftTop||l==i["c"].Left)if(s.point.x+s.width<o.point.x){c=h[h.length-1],f={x:c.x,y:c.y};x=Math.abs(s.point.x+s.width-o.point.x);f.x=x>2*d?o.point.x-d:o.point.x-x/2,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.x<o.point.x?f.x=s.point.x-d:f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);else l==i["c"].LeftBottom&&h.push({x:r.x,y:a.y});h.push({x:r.x,y:r.y})}else if(e==i["b"].Left&&n==i["b"].Right){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Right||l==i["c"].RightTop||l==i["c"].RightBottom||l==i["c"].Top||l==i["c"].Bottom)if(h.push({x:a.x-d,y:a.y}),c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<=o.point.y+o.height&&s.point.y+s.height>=o.point.y){v=i["j"].getNodeCenter(s);v.y>a.y?f.y=o.point.y<s.point.y?o.point.y-d:s.point.y-d:f.y=o.point.y+o.height<s.point.y+s.height?s.point.y+s.height+d:o.point.y+o.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x+s.width>o.point.x+o.width?f.x=s.point.x+s.width+d:f.x=o.point.x+o.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else{if(s.point.y>o.point.y+o.height){x=Math.abs(s.point.y-(o.point.y+o.height));f.y=o.point.y+o.height+x/2}else if(s.point.y+s.height<o.point.y){x=Math.abs(s.point.y+s.height-o.point.y);f.y=s.point.y+s.height+x/2}h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else if((l==i["c"].Left||l==i["c"].LeftTop||l==i["c"].LeftBottom)&&a.y!=r.y){x=o.point.x-(s.point.x+s.width);h.push({x:o.point.x-x/2,y:a.y}),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}h.push({x:r.x,y:r.y})}else if(e==i["b"].Left&&n==i["b"].Bottom){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Top||l==i["c"].Bottom||l==i["c"].Right||l==i["c"].RightTop||l==i["c"].RightBottom)if(c=h[h.length-1],f={x:c.x,y:c.y},s.point.y+s.height<o.point.y){f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y};x=Math.abs(s.point.y+s.height-o.point.y);f.y=x<=2*d?s.point.y+s.height+x/2:s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.x<o.point.x?f.x=s.point.x-d:f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.y+s.height<o.point.y+o.height?f.y=o.point.y+o.height+d:f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);else if(l==i["c"].LeftTop)h.push({x:r.x,y:a.y});else if(l==i["c"].Left||l==i["c"].LeftBottom)if(c=h[h.length-1],f={x:c.x,y:c.y},s.point.x+s.width<o.point.x){x=Math.abs(s.point.x+s.width-o.point.x);f.x=x<2*d?o.point.x-x/2:o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else f.x=s.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y+s.height>o.point.y+o.height?s.point.y+s.height+d:o.point.y+o.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f);h.push({x:r.x,y:r.y})}else if(e==i["b"].Top&&n==i["b"].Left){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].RightTop)h.push({x:a.x,y:r.y});else if(l==i["c"].Right||l==i["c"].RightBottom||l==i["c"].Bottom||l==i["c"].LeftBottom)if(c=h[h.length-1],f={x:c.x,y:c.y},s.point.x>o.point.x+o.width){f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y};x=s.point.x-(o.point.x+o.width);f.x=x>2*d?s.point.x-d:s.point.x-x/2,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x<o.point.x?f.x=s.point.x-d:f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f);else if(l==i["c"].Left||l==i["c"].LeftTop||l==i["c"].Top)if(s.point.y+s.height<o.point.y){c=h[h.length-1],f={x:c.x,y:c.y};x=Math.abs(s.point.y+s.height-o.point.y);f.y=x>2*d?o.point.y-d:o.point.y-x/2,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=s.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x<o.point.x?f.x=s.point.x-d:f.x=o.point.x-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f);h.push({x:r.x,y:r.y})}else if(e==i["b"].Top&&n==i["b"].Right){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Top||l==i["c"].Right||l==i["c"].Bottom||l==i["c"].RightTop||l==i["c"].RightBottom)if(s.point.y+s.height<o.point.y){c=h[h.length-1],f={x:c.x,y:c.y};x=Math.abs(s.point.y+s.height-o.point.y);f.y=x<2*d?o.point.y-x/2:o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x+s.width>o.point.x+o.width?f.x=s.point.x+s.width+d:f.x=o.point.x+o.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f);else if(l==i["c"].LeftTop)h.push({x:a.x,y:r.y});else if(l==i["c"].Left||l==i["c"].LeftBottom)if(s.point.x+s.width<o.point.x){c=h[h.length-1],f={x:c.x,y:c.y},f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y};x=Math.abs(s.point.x+s.width-o.point.x);f.x=x<2*d?s.point.x+s.width+x/2:s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f)}else c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x+s.width<o.point.x+o.width?f.x=o.point.x+o.width+d:f.x=s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=r.y,h.push(f);h.push({x:r.x,y:r.y})}else if(e==i["b"].Top&&n==i["b"].Top){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Right||l==i["c"].Left||l==i["c"].RightBottom||l==i["c"].Bottom||l==i["c"].LeftBottom)if(c=h[h.length-1],f={x:c.x,y:c.y},s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},r.x<o.point.x+o.width+d&&r.x>o.point.x-d){v=i["j"].getNodeCenter(s);v.x<a.x?f.x=o.point.x-d:f.x=o.point.x+o.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y};x=s.point.y-(o.point.y+o.height);f.y=x<2*d?s.point.y-x/2:s.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else f.x=r.x,h.push(f);else if(l==i["c"].LeftTop||l==i["c"].Top||l==i["c"].RightTop){c=h[h.length-1];if(f={x:c.x,y:c.y},a.x<s.point.x+s.width+d&&a.x>s.point.x-d){x=Math.abs(s.point.y+s.height-o.point.y);f.y=x<2*d&&0!=x?o.point.y-x/2:o.point.y-d,h.push(f);c=h[h.length-1];f={x:c.x,y:c.y};v=i["j"].getNodeCenter(s);v.x<a.x?f.x=s.point.x+s.width+d:f.x=s.point.x-d,h.push(f);c=h[h.length-1];f={x:c.x,y:c.y},f.y=s.point.y-d,h.push(f);c=h[h.length-1];f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else{s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f);c=h[h.length-1];f={x:c.x,y:c.y},f.x=r.x,h.push(f)}}h.push({x:r.x,y:r.y})}else if(e==i["b"].Top&&n==i["b"].Bottom){y=d;if(h.push({x:a.x,y:a.y}),l==i["c"].Top||l==i["c"].LeftTop||l==i["c"].RightTop){if(c=h[h.length-1],f={x:c.x,y:c.y},r.x!=a.x){x=Math.abs(s.point.y+s.height-o.point.y);f.y=o.point.y-x/2,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}}else if(l==i["c"].Left||l==i["c"].Right||l==i["c"].LeftBottom||l==i["c"].RightBottom||l==i["c"].Bottom)if(c=h[h.length-1],f={x:c.x,y:c.y},s.point.x<=o.point.x+o.width&&s.point.x+s.width>=o.point.x){s.point.y<o.point.y?f.y=s.point.y-d:f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y};v=i["j"].getNodeCenter(s);v.x<a.x?f.x=s.point.x<o.point.x?s.point.x-d:o.point.x-d:f.x=s.point.x+s.width<o.point.x+o.width?o.point.x+o.width+d:s.point.x+s.width+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}else{if(f.y=o.point.y-d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},s.point.x+s.width<o.point.x){x=Math.abs(s.point.x+s.width-o.point.x);f.x=o.point.x-x/2}else if(o.point.x+o.width<s.point.x){x=Math.abs(o.point.x+o.width-s.point.x);f.x=s.point.x-x/2}h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.y=s.point.y+s.height+d,h.push(f),c=h[h.length-1],f={x:c.x,y:c.y},f.x=r.x,h.push(f)}h.push({x:r.x,y:r.y})}return h}function s(t,e){if(t){var n=[],o=t.fromDirection,s=t.fromNode,a=t.startPoint,r=e,l=30,h=i["j"].getDirection(a,r),d=i["j"].getAngle(a,r);if(o==i["b"].Right)n.push({x:a.x,y:a.y}),h==i["c"].RightTop||h==i["c"].RightBottom?d>0&&d<45||d>315&&d<360?(c=n[n.length-1],u={x:c.x,y:c.y},u.x=a.x+(r.x-a.x)/2,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):h==i["c"].Bottom||h==i["c"].LeftBottom||h==i["c"].Left?d<135?(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.y<=s.point.y+s.height+l?(u.y=s.point.y+s.height+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(u.y=r.y,n.push(u))):h!=i["c"].Top&&h!=i["c"].LeftTop||(d>225?(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.y>=s.point.y-l?(u.y=s.point.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(u.y=r.y,n.push(u)))),n.push({x:r.x,y:r.y});else if(o==i["b"].Bottom){n.push({x:a.x,y:a.y}),h==i["c"].RightBottom||h==i["c"].LeftBottom?d>90&&d<135||d<90&&d>45?(c=n[n.length-1],u={x:c.x,y:c.y},u.y=a.y+(r.y-a.y)/2,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):h==i["c"].Right||h==i["c"].Top||h==i["c"].RightTop?d>315?(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.x<=s.point.x+s.width+l?(u.x=s.point.x+s.width+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(u.x=r.x,n.push(u))):h!=i["c"].Left&&h!=i["c"].LeftTop||(d<225?(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.x>=s.point.x-l?(u.x=s.point.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(u.x=r.x,n.push(u)))),n.push({x:r.x,y:r.y})}else if(o==i["b"].Left){n.push({x:a.x,y:a.y}),h==i["c"].LeftTop||h==i["c"].LeftBottom?d>135&&d<180||d>180&&d<225?(c=n[n.length-1],u={x:c.x,y:c.y},u.x=a.x+(r.x-a.x)/2,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):h==i["c"].Bottom||h==i["c"].RightBottom||h==i["c"].Right?d>45?(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.y<=s.point.y+s.height+l?(u.y=s.point.y+s.height+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(u.y=r.y,n.push(u))):h!=i["c"].Top&&h!=i["c"].RightTop||(d<315?(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.x=u.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.y>=s.point.y-l?(u.y=s.point.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(u.y=r.y,n.push(u)))),n.push({x:r.x,y:r.y})}else if(o==i["b"].Top){var c,u;n.push({x:a.x,y:a.y}),h==i["c"].RightTop||h==i["c"].LeftTop?d>270&&d<315||d<270&&d>225?(c=n[n.length-1],u={x:c.x,y:c.y},u.y=a.y+(r.y-a.y)/2,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):h==i["c"].Right||h==i["c"].Bottom||h==i["c"].RightBottom?d<45?(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.x<=s.point.x+s.width+l?(u.x=s.point.x+s.width+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(u.x=r.x,n.push(u))):h!=i["c"].Left&&h!=i["c"].LeftBottom||(d>135?(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x+l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y,n.push(u)):(c=n[n.length-1],u={x:c.x,y:c.y},u.y=u.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},r.x>=s.point.x-l?(u.x=s.point.x-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.y=r.y-l,n.push(u),c=n[n.length-1],u={x:c.x,y:c.y},u.x=r.x,n.push(u)):(u.x=r.x,n.push(u)))),n.push({x:r.x,y:r.y})}return n}}},597:function(t,e,n){t.exports=n.p+"modules/platform/img/101.png"},598:function(t,e,n){t.exports=n.p+"modules/platform/img/101_c.png"},601:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"svgRoot",staticClass:"svgRoot"},[n("lines",{ref:"lines",attrs:{"is-draw-line":t.isDrawLine,lines:t.lines,nodes:t.nodes,events:t.events,checked:t.checked}}),n("nodes",{attrs:{"is-draw-line":t.isDrawLine,nodes:t.nodes,checked:t.checked}}),n("events",{attrs:{"is-draw-line":t.isDrawLine,nodes:t.nodes,events:t.events,checked:t.checked}})],1)},o=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"lines",staticClass:"lines",style:{height:t.isSub?"calc(100% - "+t.toPx(t.parentNode.imgHeight+2*t.parentNode.padding)+")":"100%",top:t.isSub?t.toPx(t.parentNode.imgHeight+2*t.parentNode.padding):0}},[n("LinesProperty",{attrs:{nodes:t.nodes,lines:t.lines,isSub:t.isSub,parentNode:t.parentNode,checked:t.checked}})],1)},a=[],r=n(2),l=n.n(r),h=n(4),d=n.n(h),c=n(3),u=n.n(c),f=n(1),y=n.n(f),g=n(859),x=n.n(g),v=n(392),m=function(t,e,n){var i,o=null,s=null,a={path:[],from:null,to:null,strokeWidth:2,stroke:null===t||void 0===t||null===(i=t.Path)||void 0===i?void 0:i.stroke,"stroke-dasharray":n["stroke-dasharray"]};a=Object.assign(a,n),this.id=null,this.path=a.path,this.from=a.from,this.to=a.to,this.linkInfo=a.linkInfo||{},this.render=function(){for(var t=[],n=0;n<this.path.length;n++){var i=this.path[n];0==n?t.push(["M",i.x,i.y]):t.push(["L",i.x,i.y])}if(t.length>1){var r={sp:{x:t[t.length-2][1],y:t[t.length-2][2]},ep:{x:t[t.length-1][1],y:t[t.length-1][2]}};r.sp.y==r.ep.y?r.ep.x=r.ep.x-(r.sp.x<r.ep.x?2:-2):r.ep.y=r.ep.y-(r.sp.y<r.ep.y?2:-2);try{o?(o.attr({path:t,"stroke-width":a.strokeWidth,stroke:a.stroke}),s&&s.attr({path:v["j"].drawArrow(r),"stroke-width":a.strokeWidth,stroke:a.stroke,fill:a.stroke})):(o=e.path(t).attr({"stroke-width":a.strokeWidth,stroke:a.stroke,"stroke-dasharray":a["stroke-dasharray"]}),s=e.path(v["j"].drawArrow(r)).attr({"stroke-width":a.strokeWidth,stroke:a.stroke,fill:a.stroke}),this.isRender=!0)}catch(l){}}},this.remove=function(){o&&o.remove(),s&&s.remove()}},b=m,w=n(409),O=n(410),N=n(418),L=function(t,e,n){var i=null,o=null,s=null,a=[],r=t;this.sp=null,this.ep=null,this.type=null,this.isLast=!1,this.index=n,this.direction=null,this.hasTransition=!1,this.getLine=function(){return r},this.render=function(){this.sp.x=parseFloat(this.sp.x),this.sp.y=parseFloat(this.sp.y),this.ep.x=parseFloat(this.ep.x),this.ep.y=parseFloat(this.ep.y);var t=[],n={type:"point",data:{x:this.sp.x,y:this.sp.y}},l={type:"point",data:{x:this.ep.x,y:this.ep.y}},h=[];this.remove();var d={sp:{x:n.data.x,y:n.data.y},ep:{x:l.data.x,y:l.data.y}};this.sp.y==this.ep.y?(this.type=v["d"].horizontal,this.isLast&&(d.ep.x=d.ep.x-(n.data.x<l.data.x?2:-2))):(this.type=v["d"].vertical,this.isLast&&(d.ep.y=d.ep.y-(n.data.y<l.data.y?2:-2)));var c=r.getPreLine(this);if(c&&c.type!=this.type&&c.hasTransition&&(this.type==v["d"].horizontal?n.data.x="left"==this.direction?n.data.x-v["k"]:n.data.x+v["k"]:n.data.y="top"==this.direction?n.data.y-v["k"]:n.data.y+v["k"]),this.type==v["d"].horizontal&&a.length>0){var u=5,p="right";this.sp.x>this.ep.x&&(p="left"),a=a.sort((function(t,e){return"right"==p?t.x<e.x?-1:1:t.x<e.x?1:-1})),t.push(n);for(var f=0;f<a.length;f++){var y=a[f],g={type:"point",data:{x:y.x-("right"==p?u:-u),y:y.y}},x={type:"point",data:{x:y.x+("right"==p?u:-u),y:y.y}};t.push(g),t.push({type:"arc",data:{radius:u,overX:x.data.x,overY:x.data.y,sweep:"right"==p?1:0}}),t.push(x)}}else t.push(n);var m=r.getNextLine(this);if(m&&m.type!=this.type){var b=0;b=v["j"].getLineLength(this.sp,this.ep);var w=v["j"].getLineLength(m.sp,m.ep),O=2*v["k"];if(b<=O||w<=O)t.push(l),this.hasTransition=!1;else{var N;if(b=v["j"].getLineLength(m.sp,m.ep),this.type==v["d"].vertical){N={type:"point",data:{x:this.ep.x,y:this.ep.y-("top"==this.direction?-v["k"]:v["k"])}},t.push(N);var L=null;"bottom"==this.direction&&"left"==m.direction||"top"==this.direction&&"right"==m.direction?L=1:("top"==this.direction&&"left"==m.direction||"bottom"==this.direction&&"right"==m.direction)&&(L=0),t.push({type:"arc",data:{radius:v["k"],overX:this.ep.x-("left"==m.direction?v["k"]:-v["k"]),overY:this.ep.y,sweep:L}})}else{N={type:"point",data:{x:this.ep.x-("right"==this.direction?v["k"]:-v["k"]),y:this.ep.y}},t.push(N);var k=null;"left"==this.direction&&"top"==m.direction||"right"==this.direction&&"bottom"==m.direction?k=1:("left"==this.direction&&"bottom"==m.direction||"right"==this.direction&&"top"==m.direction)&&(k=0),t.push({type:"arc",data:{radius:v["k"],overX:this.ep.x,overY:this.ep.y-("top"==m.direction?v["k"]:-v["k"]),sweep:k}})}this.hasTransition=!0}}else t.push(l),this.hasTransition=!1;for(var I=0;I<t.length;I++){var P=t[I];0==I&&"point"==P.type?h.push(["M",P.data.x,P.data.y]):"point"==P.type?h.push(["L",P.data.x,P.data.y]):"arc"==P.type&&h.push(["A",P.data.radius,P.data.radius,0,0,P.data.sweep,P.data.overX,P.data.overY])}try{i=e.path(h).attr({"stroke-width":r.strokeWidth,stroke:r.stroke}),o=e.path(h).attr({"stroke-width":10,stroke:"transparent","stroke-dasharray":r.strokeDasharray}),this.isLast&&(s=e.path(v["j"].drawArrow(d)).attr({"stroke-width":r.strokeWidth,stroke:r.stroke,fill:r.stroke}))}catch(j){}o&&$(o[0]).data("object",this),s&&$(s[0]).data("object",this)},this.setIntersection=function(t){a.push(t)},this.clearIntersection=function(){a=[]},this.getIntersection=function(){return a},this.remove=function(){i&&i.remove(),o&&o.remove(),s&&s.remove()},this.refresh=function(){i&&i.attr({"stroke-width":r.strokeWidth,stroke:r.stroke,"stroke-dasharray":r.strokeDasharray}),s&&s.attr({"stroke-width":r.strokeWidth,stroke:r.stroke,fill:r.stroke})},this.hide=function(){i&&i.hide(),s&&s.hide()},this.show=function(){i&&i.show(),s&&s.show()}},k=L,I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lines-property"},[t._l(t.lines,(function(e,i){return[e.edit.show&&(e.edit.isEdit&&t.checked===e||e.edit.name1)?n("div",{key:i,staticClass:"line-property",style:{top:t.toPx(e.propertyPos.y),left:t.toPx(e.propertyPos.x)},attrs:{draggable:"true"},on:{dragstart:function(n){return t.drag(n,e)},dblclick:function(n){return t.edit(e,n)}}},[n("div",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"line-name1",attrs:{contenteditable:e.edit.editName,draggable:"false"},domProps:{innerHTML:t._s(e.edit.name1)},on:{blur:function(n){return t.editBlur(e,n)}}})]):t._e()]})),t._l(t.showLines,(function(e,i){return[!e.isHide&&e.attributes?n("div",{key:"line"+i,staticClass:"line-property order",style:{top:t.getOrderPoint(e).top,left:t.getOrderPoint(e).left}},[t._v(" "+t._s(t.getOrder(e))+" ")]):t._e()]}))],2)},P=[],j=n(393);function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T={name:"LinesProperty",inject:["$designer"],props:{nodes:{type:Array,default:function(){return[]}},lines:{type:Array,default:function(){return[]}},isSub:{type:Boolean,default:function(){return!1}},parentNode:{type:Object,default:function(){return null}},checked:{type:Object,default:function(){return{}}}},data:function(){return{isDrag:!0,dragProperty:null,cloneObj:null,current:null}},computed:S(S({},Vuex.mapState({scale:function(t){return t.flow.page.scale}})),{},{showLines:function(){var t=this,e=[];return this.nodes.forEach((function(n){n.out.length>1&&n.out.forEach((function(n){var i=Object(j["e"])(t.lines,n);i&&e.push(i)}))})),e}}),mounted:function(){var t=this;document.addEventListener("dragover",(function(e){t.dragProperty&&t.move(e,t.dragProperty)})),document.addEventListener("dragend",(function(e){t.dragProperty&&(t.dragProperty&&document.body.removeChild(t.dragProperty),t.dragPropertyEnd(e),t.dragProperty=null,t.$designer.recordUndoData())}))},methods:{toPx:j["l"],edit:function(t,e){t.edit.editName=!0,this.$nextTick((function(){var t;e.target.focus();var n=window.getSelection(),i=null===n||void 0===n||null===(t=n.getRangeAt)||void 0===t?void 0:t.call(n,0);null===i||void 0===i||i.setStart(i.startContainer,e.target.innerText.length)})),this.$bus.$emit("update-checked",t)},editBlur:function(t,e){var n=e.target.innerText.trim(),i=t.edit.name1;t.edit.name1=n,t.attributes.BaseInfo.Name=n,t.name=n,i!==n&&this.$designer.recordUndoData()},drag:function(t,e){e.isDrag=!0,Object(j["a"])(t),this.offset={x:t.offsetX,y:t.offsetY},this.dragProperty=t.target.cloneNode(!0),this.dragProperty.className="ds_tool_event_drag",this.dragProperty.setAttribute("draggable",!0),this.cloneObj=_.cloneDeep(e),this.current=e,Object.assign(this.dragProperty.style,{position:"absolute",zIndex:9999,top:this.toPx(t.pageY-t.offsetY),left:this.toPx(t.pageX-t.offsetX),transform:"scale(".concat(this.scale,") translate(-50%, -50%)"),transformOrigin:"left top"}),document.body.appendChild(this.dragProperty),this.$bus.$emit("update-checked",e)},dragPropertyEnd:function(t){if("drop"===t.type&&t.preventDefault(),this.cloneObj){if(this.cloneObj.inLine){var e=this.cloneObj.endPoint;Object.assign(this.current.propertyPos,{isMove:!0},e)}this.cloneObj=null}},move:function(t){if(!this.isDrag)return!1;for(var e,n,i,o=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY}),s=this.cloneObj.getSegmenList(),a=0;a<s.length;a++){var r=s[a].sp,l=s[a].ep,h=this.getLine(r,l),d=h.A,c=h.B,u=h.C,p=this.getLength(d,c,u,o);if(p<=20){t.preventDefault(),e=s[a];break}}if(e){var f=e.sp,y=e.ep,g=this.getPoint(f,y,o),x=this.$store.getters["flow/getMousePointByPoint"](g);n=x.y,i=x.x,this.cloneObj.endPoint=g,this.cloneObj.inLine=!0}else n=t.pageY,i=t.pageX,this.cloneObj.endPoint=null,this.cloneObj.inLine=!1;var v=this.dragProperty;v.style.top=this.toPx(n),v.style.left=this.toPx(i)},getLine:function(t,e){return{A:e.y-t.y,B:t.x-e.x,C:e.x*t.y-t.x*e.y}},getLength:function(t,e,n,i){return Math.abs(t*i.x+e*i.y+n)/Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},getPoint:function(t,e,n){if(t.x===e.x){var i=Math.max(t.y,e.y),o=Math.min(t.y,e.y);o<=n.y&&n.y<=i&&(n.x=parseInt(t.x))}else{var s=this.getLine(t,e),a=s.A,r=s.B,l=s.C,h=(r*r*n.x-a*r*n.y-a*l)/(a*a+r*r),d=(-a*r*n.x+a*a*n.y-r*l)/(a*a+r*r);n.x=parseInt(h),n.y=parseInt(d)}return n},getOrder:function(t){var e;return null===(e=t.attributes)||void 0===e||null===(e=e.BaseInfo)||void 0===e?void 0:e.ShowOrder},getOrderPoint:function(t){var e=Object(j["e"])(this.nodes,t.from),n=t.path[0],i=t.path[1],o=0,s=0;if(n.x===i.x){s=n.x;var a=Math.min(n.y,i.y);o="bottom"===t.linkInfo.fromDirection&&"201"===e.type?a+50:a+20}else o=n.y,s=n.x<i.x?n.x+20:n.x-20;return{top:Object(j["l"])(o),left:Object(j["l"])(s)}}}},E=T,C=n(0),M=Object(C["a"])(E,I,P,!1,null,null,null),B=M.exports,R=n(461);function z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?z(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var F={name:"Lines",components:{LinesProperty:B},inject:["isPreview","$designer"],props:{lines:{type:Array,default:function(){return[]}},nodes:{type:Array,default:function(){return[]}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}},isSub:{type:Boolean,default:function(){return!1}},parentNode:{type:Object,default:function(){return null}}},data:function(){return{paper:null,start:!1,currentMouseDrawingLine:null,startInfo:null,startPoint:null,down_direction:null,currentLineInfo:null,centerOffset:10,dragSize:20,maxWidth:0,maxHeight:0,maxSizeOffset:50,currentDragLine:{},isDrag:!1,type:"drawLine",mp:null,startTime:0,allEvents:["startDraw","nodeMove","eventMove","addLine","showSubNode","updateIntersection","updateNodeName","cutOffLine","changeLineShape","clearLines","reRanderLines","resetLinePoint"]}},watch:{checked:function(t){this.lines.forEach((function(e){e===t?t.selected():e.unSelected()}))}},computed:A({},Vuex.mapState({page:function(t){return t.flow.page},scale:function(t){return t.flow.page.scale},flowModel:function(t){return t.flow.flowModel},config:function(t){return t.flow.lineDefault}})),mounted:function(){var t=this;this.paper=new x.a(this.$refs.lines,"100%","100%"),this.isPreview||(this.$refs.lines.addEventListener("mousedown",this.startEdit),document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.endEdit)),this.allEvents.forEach((function(e){t.$bus.$on("".concat(e).concat(t.isSub?t.parentNode.id:""),t[e])})),this.$bus.$on("hideLines",this.hideLines)},methods:{toPx:j["l"],verifySub:j["m"],startEdit:function(t){var e=(new Date).getTime();e-this.startTime<400&&this.editName(),this.startTime=e,this.mousedown(t)},endEdit:function(t){var e=this;return d()(y.a.mark((function n(){var i;return y.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.mouseup(t);case 2:e.updateIntersection(),i=t.target.nodeName.toLowerCase(),e.start&&"path"!==i&&e.$designer.recordUndoData(),e.start=!1;case 6:case"end":return n.stop()}}),n)})))()},editName:function(){this.checked instanceof O["a"]&&!this.checked.edit.isEdit&&(this.checked.edit.isEdit=!0,this.checked.edit.name1||(this.checked.edit.editName=!0))},startDraw:function(t,e){if(!this.verifySub(this.parentNode)){this.isDrawLine&&this.$bus.$emit("isDrewingLine".concat(this.isSub?this.parentNode.id:""),"end"),this.isDrawLine&&this.checked instanceof w["a"]&&e&&(this.start=!0,this.mouseDrawLine(t),this.type="drawLine");var n=e;this.isDrawLine&&n&&this.checked instanceof N["a"]&&(this.start=!0,this.eventDrawLine(t),this.type="drawLine")}},mousedown:function(t){if("path"==t.target.tagName){var e=Object(j["h"])(t.target);if(e){var n=e.getLine();if(this.$bus.$emit("update-checked",n),n){if(n.readOnly)return;this.lineMouseDownHandler(t,n)}}}},mousemove:function(t){if(this.start&&!this.verifySub(this.parentNode))return"drawLine"===this.type?(this.drawLine(t),!1):(this.dragLine(t),!1)},addLine:function(t){var e=this;return d()(y.a.mark((function n(){var i,o,s,a,r,l;return y.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=Object.assign({type:0},t),e.isPreview&&(o.isThrough=t.isThrough),s=new O["a"](e.config,o),o.from&&(a="event"===o.fromType?Object(j["e"])(e.events,o.from):Object(j["e"])(e.nodes,o.from)),o.to&&(r=Object(j["e"])(e.nodes,o.to)),0===(null===s||void 0===s||null===(i=s.path)||void 0===i?void 0:i.length)&&(l=e.getPathPoints(s,a,r),l&&l.length>0&&(s.path=l)),n.next=8,e.addToPanel(s,a,r);case 8:case"end":return n.stop()}}),n)})))()},showSubNode:function(t){var e=[],n=function(n,i){var o=n.linkInfo;t.open.show?(n.unFold=o[i],n.fold?o[i]=n.fold:o[i]=o[i]):(n.fold=o[i],n.unFold?o[i]=n.unFold:o[i]=0),e.push(n.id)};this.lines.forEach((function(i){i.from!==t.id&&i.to!==t.id||(n(i,i.from===t.id?"fromOffset":"toOffset"),e.push(i.id))})),e.length>0&&this.renderLines(e),this.updateIntersection()},hideLines:function(t,e){var n=this;t.forEach((function(t){n.lines.forEach((function(n){t===n.id&&(n.isHide=e,e?n.hide():n.show(),n.edit.show=!e)}))}))},drawLine:function(t){var e,n,i=this.scale,o=this.parentNode?{x:t.pageX-this.parentNode.point.x*i,y:t.pageY-(this.parentNode.point.y+this.parentNode.imgHeight+2*this.parentNode.padding)*i}:{x:t.pageX,y:t.pageY},s=this.$store.getters["flow/getMousePointByCanvas"](o);s.x=s.x/i,s.y=s.y/i;var a=t.target;if(this.currentLineInfo&&(this.currentLineInfo.endPoint=null,this.currentLineInfo.targetNode=null,this.currentLineInfo.targetDirection=null),"IMG"==(null===a||void 0===a?void 0:a.tagName)||"DIV"==(null===a||void 0===a?void 0:a.tagName)&&-1!==(null===a||void 0===a||null===(e=a.className)||void 0===e||null===(n=e.indexOf)||void 0===n?void 0:n.call(e,"task-node"))){var r=Object(j["g"])(this.nodes,a);if(r){var l=this.getDrawLineEndPointInfo(r,o),h=!1;if(this.currentLineInfo.fromNode==r?this.currentLineInfo.fromDirection!=l.direction&&(h=!0):h=!0,h){this.currentLineInfo.endPoint=l.point,this.currentLineInfo.targetNode=r,this.currentLineInfo.targetDirection=l.direction;var d=Object(R["a"])(this.currentLineInfo);d&&(this.currentMouseDrawingLine.path=d,this.currentMouseDrawingLine.render())}}}else{var c=Object(R["b"])(this.currentLineInfo,s);c&&(this.currentMouseDrawingLine.path=c,this.currentMouseDrawingLine.render())}this.$bus.$emit("autoScroll",{type:"line",data:this.currentMouseDrawingLine,mouse:{x:t.pageX,y:t.pageY}})},dragLine:function(t){var e=this.mp,n=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY});if(Math.abs(n.x-e.x)<2&&Math.abs(n.y-e.y)<2)return!1;var i=t.target,o=null,s=null,a=this.currentDragLine,r=this.checked;if(a.changeJoinDriection){if("start"==a.dragPosition?(s=Object(j["e"])(this.nodes,r.to),this.$bus.$emit("isDrewingLine".concat(this.isSub?this.parentNode.id:""),"start")):"end"==a.dragPosition&&(o=Object(j["e"])(this.nodes,r.from),this.$bus.$emit("isDrewingLine".concat(this.isSub?this.parentNode.id:""),"end")),"IMG"==i.tagName||"DIV"==i.tagName&&-1!==i.className.indexOf("task-node")){var l=Object(j["g"])(this.nodes,i);l&&("start"==a.dragPosition?(o=l,s=Object(j["e"])(this.nodes,r.to)):"end"==a.dragPosition&&(o="event"===r.fromType?Object(j["e"])(this.events,r.from):Object(j["e"])(this.nodes,r.from),s=l))}else"start"==a.dragPosition?s=Object(j["e"])(this.nodes,r.to):o="event"===r.fromType?Object(j["e"])(this.events,r.from):Object(j["e"])(this.nodes,r.from);this.mouseDragLine(o,s,t)}else o="event"===r.fromType?Object(j["e"])(this.events,r.from):Object(j["e"])(this.nodes,r.from),s=Object(j["e"])(this.nodes,r.to),this.mouseDragLine(o,s,t);this.isDrag=!0,this.$bus.$emit("autoScroll",{type:"line",data:a,mouse:{x:t.pageX,y:t.pageY}}),t.preventDefault()},mouseup:function(t){var e=this;return d()(y.a.mark((function n(){return y.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.stopPropagation(),t.preventDefault(),e.$bus.$emit("isDrewingLine".concat(e.isSub?e.parentNode.id:""),null),"drawLine"!==e.type){n.next=7;break}return n.next=6,e.drawRealLine();case 6:return n.abrupt("return",!1);case 7:return n.next=9,e.dragRealLine();case 9:return n.abrupt("return",!1);case 10:case"end":return n.stop()}}),n)})))()},drawRealLine:function(){var t=this;return d()(y.a.mark((function e(){var n,i,o,s;return y.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.currentLineInfo){e.next=2;break}return e.abrupt("return",!1);case 2:if(e.prev=2,n=t.currentLineInfo.fromNode,i=t.currentLineInfo.targetNode,o={paper:t.paper},n&&n instanceof N["a"]&&(o.fromType="event"),s=new O["a"](t.config,o),t.isSub&&(s.parentNodeId=t.parentNode.id),s.path=t.currentLineInfo.path||t.currentMouseDrawingLine.path,!i){e.next=17;break}return t.updateLineLinkInfo(s,n,i,t.currentLineInfo.fromDirection,t.currentLineInfo.targetDirection),t.currentMouseDrawingLine&&t.currentMouseDrawingLine.remove(),e.next=15,t.addToPanel(s,n,i);case 15:e.next=18;break;case 17:t.currentMouseDrawingLine&&t.currentMouseDrawingLine.remove();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](2),e.t0;case 23:return e.prev=23,t.currentLineInfo=null,e.finish(23);case 26:t.$bus.$emit("startMoveAll",!1);case 27:case"end":return e.stop()}}),e,null,[[2,20,23,26]])})))()},addToPanel:function(t,e,n){var i=this;return d()(y.a.mark((function o(){var s,a,r,l;return y.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:for(s=i.maxSizeOffset,t.paper=i.paper,a=!1,r=0;r<t.path.length;r++)l=t.path[r],parseFloat(l.x)+s>i.maxWidth&&(i.maxWidth=parseFloat(l.x)+s,a=!0),parseFloat(l.y)+s>i.maxWidth&&(i.maxHeight=parseFloat(l.y)+s,a=!0);return a&&i.$bus.$emit("resize"),t.id||(t.id=v["j"].uuid()),i.render(t),t.isHide?t.hide():t.show(),i.updateIntersection(),i.setNodeLinkNodeInfo(e,n,t),o.next=12,t.setAttributes(e,n);case 12:i.lines.push(t);case 13:case"end":return o.stop()}}),o)})))()},dragRealLine:function(){var t=this.currentDragLine,e=this.checked;try{if(this.isDrag){var n,i,o,s;if(t.changeJoinDriection){if(t.fromNode&&t.toNode){n=t.fromNode?t.fromNode:"event"===e.fromType?Object(j["e"])(this.events,e.from):Object(j["e"])(this.nodes,e.from),i=t.toNode?t.toNode:Object(j["e"])(this.nodes,e.to),o=t.fromDirection?t.fromDirection:e.linkInfo.fromDirection,s=t.toDirection?t.toDirection:e.linkInfo.toDirection;var a=!0;if(n==i&&o==s&&(a=!1),a){var r=t.proxy.path;if(r&&r.length>0&&(e.path=r,this.render(e)),e.id){var l;if(e.from)if(l="event"===e.fromType?Object(j["e"])(this.events,e.from):Object(j["e"])(this.nodes,e.from),l){var h,d=null===(h=l["out"])||void 0===h?void 0:h.indexOf(e.id);d>=0&&l["out"].splice(d,1)}if(e.to){var c=Object(j["e"])(this.nodes,e.to);if(c){var u,p=null===(u=c["in"])||void 0===u?void 0:u.indexOf(e.id);p>=0&&c["in"].splice(p,1)}}}}}}else{n="event"===e.fromType?Object(j["e"])(this.events,e.from):Object(j["e"])(this.nodes,e.from),i=Object(j["e"])(this.nodes,e.to),o=t.fromDirection?t.fromDirection:e.linkInfo.fromDirection,s=t.toDirection?t.toDirection:e.linkInfo.toDirection;var f=t.proxy.path;f&&f.length>0&&(e.path=f,this.render(e))}n&&i&&(this.updateLineLinkInfo(e,n,i,o,s),this.setNodeLinkNodeInfo(n,i,e),e.setAttributes(n,i),this.updateIntersection())}}catch(y){}finally{this.isDrag=!1,t.proxy.remove(),t=null,this.$bus.$emit("resize")}this.$bus.$emit("startMoveAll",!1)},mouseDrawLine:function(t){var e=this.scale;this.currentMouseDrawingLine=null;var n=this.checked;this.currentMouseDrawingLine=new b(this.config,this.paper,{strokeWidth:2,from:n.id});var i=this.parentNode?{x:t.pageX-this.parentNode.point.x*e,y:t.pageY-(this.parentNode.point.y+this.parentNode.imgHeight+2*this.parentNode.padding)*e}:{x:t.pageX,y:t.pageY};this.startInfo=this.getDrawLineStartPointInfo(n,i),this.startPoint=this.startInfo.point,this.down_direction=this.startInfo.direction,this.currentMouseDrawingLine.path.push(this.startPoint),this.currentLineInfo={startPoint:this.startPoint,fromDirection:this.down_direction,fromNode:n}},eventDrawLine:function(t){this.currentMouseDrawingLine=null;var e=this.checked;this.currentMouseDrawingLine=new b(this.config,this.paper,{strokeWidth:2,from:e.id}),this.startInfo=this.getEventLineStartPointInfo(e,{x:t.pageX,y:t.pageY}),this.startPoint=this.startInfo.point,this.down_direction=this.startInfo.direction,this.currentMouseDrawingLine.path.push(this.startPoint),this.currentLineInfo={startPoint:this.startPoint,fromDirection:this.down_direction,fromNode:e}},getDrawLineStartPointInfo:function(t,e){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.x,y:e.y}),i=this.scale;n.x=n.x/i,n.y=n.y/i;var o=v["j"].getNodeDirection(t,n),s=v["j"].getNodeCenter(t);o==v["b"].Right&&(n.x=s.x+t.width/2,n.y<t.point.y&&(n.y=t.point.y),n.y>t.point.y+t.height&&(n.y=t.point.y+t.height),Math.abs(n.y-s.y)<this.centerOffset?n.y=s.y:n.y=Object(j["d"])(n).y),o==v["b"].Left?(n.x=t.point.x,n.y<t.point.y&&(n.y=t.point.y),n.y>t.point.y+t.height&&(n.y=t.point.y+t.height),Math.abs(n.y-s.y)<this.centerOffset?n.y=s.y:n.y=Object(j["d"])(n).y):o==v["b"].Bottom?(n.y=t.point.y+t.height,n.x<t.point.x&&(n.x=t.point.x),n.x>t.point.x+t.width&&(n.x=t.point.x+t.width),Math.abs(n.x-s.x)<this.centerOffset?n.x=s.x:n.x=Object(j["d"])(n).x):o==v["b"].Top&&(n.y=t.point.y,n.x<t.point.x&&(n.x=t.point.x),n.x>t.point.x+t.width&&(n.x=t.point.x+t.width),Math.abs(n.x-s.x)<this.centerOffset?n.x=s.x:n.x=Object(j["d"])(n).x);var a={x:n.x,y:n.y},r={point:a,direction:o};return r},getDrawLineEndPointInfo:function(t,e){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.x,y:e.y}),i=this.scale;n.x=n.x/i,n.y=n.y/i;var o=v["j"].getNodeCenter(t),s=v["j"].getNodeDirection(t,n);s==v["b"].Left?(n.y<t.point.y&&(n.y=t.point.y),n.y>t.point.y+t.height&&(n.y=t.point.y+t.height),Math.abs(n.y-o.y)<this.centerOffset?n.y=o.y:n.y=Object(j["d"])(n).y,n.x=t.point.x):s==v["b"].Right?(n.y<t.point.y&&(n.y=t.point.y),n.y>t.point.y+t.height&&(n.y=t.point.y+t.height),Math.abs(n.y-o.y)<this.centerOffset?n.y=o.y:n.y=Object(j["d"])(n).y,n.x=t.point.x+t.width):s==v["b"].Top?(n.x<t.point.x&&(n.x=t.point.x),n.x>t.point.x+t.width&&(n.x=t.point.x+t.width),Math.abs(n.x-o.x)<this.centerOffset?n.x=o.x:n.x=Object(j["d"])(n).x,n.y=t.point.y):s==v["b"].Bottom&&(n.x<t.point.x&&(n.x=t.point.x),n.x>t.point.x+t.width&&(n.x=t.point.x+t.width),Math.abs(n.x-o.x)<this.centerOffset?n.x=o.x:n.x=Object(j["d"])(n).x,n.y=t.point.y+t.height);var a={x:n.x,y:n.y},r={point:a,direction:s};return r},getEventLineStartPointInfo:function(t,e){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.x,y:e.y}),i=this.scale;n.x=n.x/i,n.y=n.y/i;var o=t.direction;o==v["b"].Right?(n.x=t.point.x+t.width/2+t.img.width/2,n.y=t.point.y+t.img.width/2):o==v["b"].Left?(n.x=t.point.x+t.width/2-t.img.width/2,n.y=t.point.y+t.img.width/2):o==v["b"].Top?(n.x=t.point.x+t.width/2,n.y=t.point.y):(n.x=t.point.x+t.width/2,n.y=t.point.y+t.img.width);var s={x:n.x,y:n.y},a={point:s,direction:o};return a},updateLineLinkInfo:function(t,e,n,i,o){if("string"==typeof e&&(e=Object(j["e"])(this.nodes,e)),"string"==typeof n&&(n=Object(j["e"])(this.nodes,n)),e&&n){var s,a=0,r=0,l={x:t.path[0].x,y:t.path[0].y},h={x:t.path[t.path.length-1].x,y:t.path[t.path.length-1].y},d=v["j"].getNodeCenter(e),c=v["j"].getNodeCenter(n);i==v["b"].Top||i==v["b"].Bottom?a=l.x-d.x:i!=v["b"].Left&&i!=v["b"].Right||(a=l.y-d.y),o==v["b"].Top||o==v["b"].Bottom?r=h.x-c.x:o!=v["b"].Left&&o!=v["b"].Right||(r=h.y-c.y),t.linkInfo={fromDirection:i,toDirection:o,fromOffset:a,toOffset:r},1==(null===(s=e)||void 0===s||null===(s=s.attributes)||void 0===s||null===(s=s.InLine)||void 0===s?void 0:s.Type)&&(t.type=1)}},updateIntersection:function(){for(var t=this.getAllSegments(),e=t.v_segments,n=t.h_segments,i=0;i<n.length;i++){var o=n[i],s=o.getIntersection().length>0;o.clearIntersection();for(var a=0;a<e.length;a++){var r=e[a],l=v["j"].segmentsIntr(o.sp,o.ep,r.sp,r.ep),h=v["k"]+5;if(l){if(Math.abs(l.x-o.sp.x)<=h||Math.abs(l.x-o.ep.x)<=h)continue;if(Math.abs(l.y-r.sp.y)<=h||Math.abs(l.y-r.ep.y)<=h)continue;for(var d=o.getIntersection(),c=!1,u=0;u<d.length;u++)if(d[u].x==l.x&&d[u].y==l.y){c=!0;break}c||o.setIntersection(l)}}if(o.getIntersection().length>0||s){o.render();var p=o.getLine();p.isHide&&o.hide()}}},getAllSegments:function(){for(var t=[],e=[],n=0;n<this.lines.length;n++)for(var i=this.lines[n].getSegmenList(),o=0;o<i.length;o++){var s=i[o],a=this.getLineType(s);a==v["d"].horizontal?e.push(s):t.push(s)}return{v_segments:t,h_segments:e}},getLineType:function(t){return t.sp.y==t.ep.y?v["d"].horizontal:t.sp.x==t.ep.x?v["d"].vertical:void 0},nodeMove:function(t){var e=[].concat(l()(t.in),l()(t.out));this.renderLines(e,!0),this.updateIntersection()},resetLinePoint:function(t,e,n){var i;i="event"===t.fromType?Object(j["e"])(n,t.from):Object(j["e"])(e,t.from);var o=Object(j["e"])(e,t.to),s=this.getPathPoints(t,i,o);t.path=s},renderLines:function(t,e){if(t&&(!t||0!=t.length))for(var n=0;n<t.length;n++){var i=t[n],o=Object(j["e"])(this.lines,i),s=void 0;s="event"===o.fromType?Object(j["e"])(this.events,o.from):Object(j["e"])(this.nodes,o.from);var a=Object(j["e"])(this.nodes,o.to),r=this.getPathPoints(o,s,a);r&&r.length>0&&("single"===o.attributes.BaseInfo.LineShape&&r.length>2&&r.splice(1,r.length-2),e&&o.propertyPos&&(o.propertyPos.isMove=!1),o.path=r,this.render(o),this.hideOrShowSubNodeLines(o,s,a))}},getPathPoints:function(t,e,n){var i=t.linkInfo,o=("event"===t.fromType?this.getEventPointByLineOffset:this.getPointByLineOffset)(t,e,i.fromDirection),s=this.getPointByLineOffset(t,n,i.toDirection);if(o&&s){var a={fromNode:e,targetNode:n,startPoint:o,endPoint:s,fromDirection:i.fromDirection,targetDirection:i.toDirection};return Object(R["a"])(a)}return[]},hideOrShowSubNodeLines:function(t,e,n){t.isHide=!1,"event"===t.fromType&&(e.hide||n.hide)?(t.hide(),t.isHide=!0):t.show()},eventMove:function(t){if(t.out&&t.out.length>0)for(var e=0;e<t.out.length;e++){var n=t.out[e],i=Object(j["e"])(this.lines,n),o=Object(j["e"])(this.events,i.from),s=Object(j["e"])(this.nodes,i.to),a=i.linkInfo,r=0,l=0;r=this.getEventPointByLineOffset(i,o,a.fromDirection),l=this.getPointByLineOffset(i,s,a.toDirection);if(r&&l){var h={fromNode:o,targetNode:s,startPoint:r,endPoint:l,fromDirection:a.fromDirection,targetDirection:a.toDirection},d=Object(R["a"])(h);d&&d.length>0&&(i.path=d,this.render(i),this.hideOrShowSubNodeLines(i,o,s))}}this.updateIntersection()},getPointByLineOffset:function(t,e,n){var i=null,o=v["j"].getNodeCenter(e),s=t.from===e.id?"from":t.to===e.id?"to":null;if(!s)return null;var a="from"==s?t.linkInfo.fromOffset:t.linkInfo.toOffset;return i=n==v["b"].Top?{x:o.x+a,y:e.point.y}:n==v["b"].Bottom?{x:o.x+a,y:e.point.y+e.height}:n==v["b"].Left?{x:e.point.x,y:o.y+a}:{x:e.point.x+e.width,y:o.y+a},i},getEventPointByLineOffset:function(t,e,n){var i=null;return i=n==v["b"].Top?{x:e.point.x+e.width/2,y:e.point.y}:n==v["b"].Bottom?{x:e.point.x+e.width/2,y:e.point.y+e.img.height}:n==v["b"].Left?{x:e.point.x+e.width/2-e.img.height/2,y:e.point.y+e.img.height/2}:{x:e.point.x+e.width/2+e.img.height/2,y:e.point.y+e.img.height/2},i},getPointByFold:function(t,e,n,i,o){if(!i){var s="from"===o?t.linkInfo.fromOffset:t.linkInfo.toOffset,a=v["j"].getNodeCenter(e);return n==v["b"].Top?p={x:a.x+s,y:e.point.y}:n==v["b"].Bottom?p={x:a.x+s,y:e.point.y+e.height}:n==v["b"].Left?p={x:e.point.x,y:a.y+s}:p={x:e.point.x+e.width,y:a.y+s},p}},lineMouseDownHandler:function(t,e){this.type="dragline";var n=Object(j["h"])(t.target);if(n){if(this.start=!0,this.isDrag=!1,!e)return!1;var i={segmen:n,line:e,proxy:new b(this.config,this.paper,{"stroke-dasharray":["-"]}),changeJoinDriection:!1};this.currentDragLine=i;var o=this.mp=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY});1==e.getSegmenList().length?n.type==v["d"].horizontal?Math.abs(n.sp.x-o.x)<=this.dragSize?(i.changeJoinDriection=!0,i.dragPosition="start"):Math.abs(n.ep.x-o.x)<=this.dragSize&&(i.changeJoinDriection=!0,i.dragPosition="end"):0==n.index&&Math.abs(n.sp.y-o.y)<=this.dragSize?(i.changeJoinDriection=!0,i.dragPosition="start"):n.isLast&&Math.abs(n.ep.y-o.y)<=this.dragSize&&(i.changeJoinDriection=!0,i.dragPosition="end"):e.getSegmenList().length>1&&(n.type==v["d"].horizontal?0==n.index&&Math.abs(n.sp.x-o.x)<=this.dragSize?(i.changeJoinDriection=!0,i.dragPosition="start"):n.isLast&&Math.abs(n.ep.x-o.x)<this.dragSize&&(i.changeJoinDriection=!0,i.dragPosition="end"):0==n.index&&Math.abs(n.sp.y-o.y)<=this.dragSize?(i.changeJoinDriection=!0,i.dragPosition="start"):n.isLast&&Math.abs(n.ep.y-o.y)<=this.dragSize&&(i.changeJoinDriection=!0,i.dragPosition="end"))}},mouseDragLine:function(t,e,n){var i=this.currentDragLine;if(i)if(i.changeJoinDriection){O=i.segmen;if(O){I=O.getLine(),b=this.$store.getters["flow/getMousePointByCanvas"]({x:n.pageX,y:n.pageY});var o=this.scale;if(b.x=b.x/o,b.y=b.y/o,"start"==i.dragPosition){var s=t,a=e,r=null,l=null,h="";if(s)r=this.getDrawLineStartPointInfo(s,{x:n.pageX,y:n.pageY}),l=r.point,h=r.direction;else{var d=Object(j["d"])(b);s={width:0,height:0,point:d,abstract:!0},l=d;var c=v["j"].getNodeDirection(a,d);c==v["c"].Left?h=v["c"].Right:c==v["c"].Right?h=v["c"].Left:c==v["c"].Bottom?h=v["c"].Top:c==v["c"].Top&&(h=v["c"].Bottom)}var u=this.getPointByLineOffset(I,a,I.linkInfo.toDirection),p={startPoint:l,fromDirection:h,fromNode:s,targetNode:a,targetDirection:I.linkInfo.toDirection,endPoint:u};T=Object(R["a"])(p);s.abstract?i.fromNode=null:i.fromNode=s,i.toNode=a,i.fromDirection=h,i.proxy.path=T,i.proxy.render()}else if("end"==i.dragPosition){s=t,a=e;var f=null,y=null,g=null;if(a)f=this.getDrawLineStartPointInfo(a,{x:n.pageX,y:n.pageY}),y=f.point,g=f.direction;else{var x=b;a={width:0,height:0,point:x,abstract:!0},y=x;c=v["j"].getNodeDirection(s,x);c==v["c"].Left?g=v["c"].Right:c==v["c"].Right?g=v["c"].Left:c==v["c"].Bottom?g=v["c"].Top:c==v["c"].Top&&(g=v["c"].Bottom)}var m=(s instanceof N["a"]?this.getEventPointByLineOffset:this.getPointByLineOffset)(I,s,I.linkInfo.fromDirection);p={startPoint:m,fromDirection:I.linkInfo.fromDirection,fromNode:s,targetNode:a,targetDirection:g,endPoint:y},T=Object(R["a"])(p);i.fromNode=s,a.abstract?i.toNode=null:i.toNode=a,i.toDirection=g,i.proxy.path=T,i.proxy.render()}}}else{var b=this.$store.getters["flow/getMousePointByCanvas"]({x:n.pageX,y:n.pageY});b=Object(j["d"])(b),this.parentNode&&(b.x=b.x-this.parentNode.point.x,b.y=b.y-this.parentNode.point.y-this.parentNode.imgHeight);var w=this.scale;b.x=b.x/w,b.y=b.y/w;var O=i.segmen;if(O){var L,k,I=O.getLine();if(O.type==v["d"].vertical)if(0==O.index)L="event"===I.fromType?Object(j["e"])(this.events,I.from):Object(j["e"])(this.nodes,I.from),b.x>=L.point.x&&b.x<=L.point.x+L.width&&(O.ep.x=b.x,O.sp.x=b.x);else if(O.isLast){var P=Object(j["e"])(this.nodes,I.to);b.x>=P.point.x&&b.x<=P.point.x+P.width&&(O.ep.x=b.x,O.sp.x=b.x)}else O.ep.x=b.x,O.sp.x=b.x;else if(0==O.index){if(k="event"===I.fromType?Object(j["e"])(this.events,I.from):Object(j["e"])(this.nodes,I.from),b.y>=k.point.y&&b.y<=k.point.y+k.height){var $=v["j"].getNodeCenter(k);Math.abs(b.y-$.y)<this.centerOffset&&(b.y=$.y),O.ep.y=b.y,O.sp.y=b.y}}else if(O.isLast){P=Object(j["e"])(this.nodes,I.to);if(b.y>=P.point.y&&b.y<=P.point.y+P.height){var D=v["j"].getNodeCenter(P);Math.abs(b.y-D.y)<this.centerOffset&&(b.y=D.y),O.ep.y=b.y,O.sp.y=b.y}}else O.ep.y=b.y,O.sp.y=b.y;var S=I.getSegmenList(),T=this.covertPointBySegmen(S);i.proxy.path=T,i.proxy.render()}}},covertPointBySegmen:function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];e.push(i.sp),n==t.length-1&&e.push(i.ep)}return e},setNodeLinkNodeInfo:function(t,e,n){var i,o;(null===t||void 0===t||null===(i=t.out)||void 0===i?void 0:i.indexOf(n.id))<0&&t["out"].push(n.id),(null===e||void 0===e||null===(o=e.in)||void 0===o?void 0:o.indexOf(n.id))<0&&e["in"].push(n.id),n.from=t.id,n.to=e.id},render:function(t){t.remove(),t.stroke=t.getLineStroke();var e=v["j"].convertSegmentByPoint(t.path);t.propertyPos.isMove||this.setLineProperty(t,e);for(var n=0;n<e.length;n++){var i=e[n],o=new k(t,this.paper,n);o.sp=i.sp,o.ep=i.ep,n==e.length-1&&(o.isLast=!0),o.direction=v["j"].getDirection(o.sp,o.ep),t.addElement(o)}for(var s=t.getSegmenList(),a=0;a<s.length;a++)s[a].render()},clearLines:function(){_.map(this.lines,(function(t){null===t||void 0===t||t.remove()}))},reRanderLines:function(t){var e=this;_.map(t,(function(t){e.render(t)}))},setLineProperty:function(t,e){if(1===e.length){var n=e[0].sp,i=e[0].ep;return t.propertyPos.x=(n.x+i.x)/2,void(t.propertyPos.y=(n.y+i.y)/2)}if(e.length>=2){for(var o,s=e,a=s.map((function(t){return t.lineLength})).reduce((function(t,e){return t+e})),r=0,l=0;l<s.length;l++){if(r+s[l].lineLength>=a/2){o=s[l];break}r+=s[l].lineLength}var h=o.sp,d=o.ep;return t.propertyPos.x=(h.x+d.x)/2,void(t.propertyPos.y=(h.y+d.y)/2)}},globalMove:function(t,e,n){if(t)for(var i=0;i<this.lines.length;i++){for(var o=this.lines[i],s=0;s<o.path.length;s++)e&&(o.path[s].x+=t.x),n&&(o.path[s].y+=t.y);(e||n)&&this.render(o)}},updateNodeName:function(t){this.lines.forEach((function(e){if(e.from===t.id){var n=e.name.split("→");2===n.length&&(e.name=t.name+"→"+n[1],e.attributes.BaseInfo.Name=e.name)}if(e.to===t.id){var i=e.name.split("→");2===i.length&&(e.name=i[0]+"→"+t.name,e.attributes.BaseInfo.Name=e.name)}}))},cutOffLine:function(t){var e,n,i,o,s,a,r=this,l=[t.point,{x:t.point.x+t.width,y:t.point.y},{x:t.point.x,y:t.point.y+t.height},{x:t.point.x+t.width,y:t.point.y+t.height}];if(this.lines.forEach((function(h,d){h.path.reduce((function(c,u,p){var f=r.getLine(c,u),y=f.A,g=f.B,x=f.C,v=l.filter((function(t){return y*t.x+g*t.y+x>0}));return 2===v.length&&(v=v.filter((function(e,n){var r;return c.y===u.y&&(c.x<e.x&&e.x<u.x?(r=!0,0===n&&(i={x:e.x,y:c.y}),1===n&&(s={x:e.x,y:c.y}),o="left",a="right",t.point.y=c.y-t.height/2):u.x<e.x&&e.x<c.x&&(r=!0,1===n&&(i={x:e.x,y:c.y}),0===n&&(s={x:e.x,y:c.y}),o="right",a="left",t.point.y=c.y-t.height/2)),c.x===u.x&&(c.y<e.y&&e.y<u.y?(r=!0,0===n&&(i={x:c.x,y:e.y}),1===n&&(s={x:c.x,y:e.y}),o="top",a="bottom",t.point.x=c.x-t.width/2):u.y<e.y&&e.y<c.y&&(r=!0,1===n&&(i={x:c.x,y:e.y}),0===n&&(s={x:c.x,y:e.y}),o="bottom",a="top",t.point.x=c.x-t.width/2)),r}))),v.length>1&&v.length<l.length&&(e=h,d,n=p),u}))})),e&&e.path.length>=2){var h=e.path.slice(0,n);h.push(i);var d=e.fromType?this.events.filter((function(t){return t.id===e.from})):this.nodes.filter((function(t){return t.id===e.from}));this.currentLineInfo={endPoint:h[h.length-1],fromDirection:e.linkInfo.fromDirection,fromNode:d[0],startPoint:h[0],targetDirection:o,targetNode:t,path:h},this.drawRealLine();var c=e.path.slice(n,e.path.length);c.unshift(s);var u=this.nodes.filter((function(t){return t.id===e.to}));this.currentLineInfo={endPoint:c[h.length-1],fromDirection:a,fromNode:t,startPoint:c[0],targetDirection:e.linkInfo.toDirection,targetNode:u[0],path:c},this.drawRealLine(),this.$bus.$emit("deleteLine",e),this.currentLineInfo=null}},getLine:function(t,e){return{A:e.y-t.y,B:t.x-e.x,C:e.x*t.y-t.x*e.y}},changeLineShape:function(t){if("single"===t.attributes.BaseInfo.LineShape)t.path.splice(1,t.path.length-2);else{var e,n;t.from&&(e="event"===t.fromType?Object(j["e"])(this.events,t.from):Object(j["e"])(this.nodes,t.from)),t.to&&(n=Object(j["e"])(this.nodes,t.to));var i=this.getPathPoints(t,e,n);t.path=i}this.render(t),this.updateIntersection()}},beforeDestroy:function(){var t=this;this.$refs.lines.removeEventListener("mousedown",this.startEdit),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.endEdit),this.allEvents.forEach((function(e){t.$bus.$off("".concat(e).concat(t.isSub?t.parentNode.id:""))})),this.$bus.$off("hideLines")}},W=F,H=Object(C["a"])(W,s,a,!1,null,null,null),X=H.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"events",style:{top:t.isSub?t.toPx(t.parentNode.imgHeight+2*t.parentNode.padding):0,zIndex:t.zIndex}},t._l(t.events,(function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isHide,expression:"!ev.isHide"},{name:"flow-clickoutside",rawName:"v-flow-clickoutside:hideEdit",value:e,expression:"ev",arg:"hideEdit"}],key:e.id,staticClass:"ds_tool_event_drag tool_event",class:{selected:t.checked===e},style:{width:e.width+"px",height:e.height+"px",top:t.toPx(e.point.y),left:t.toPx(e.point.x)},attrs:{draggable:!t.isDrawLine,"data-id":e.id},on:{mousedown:function(n){return t.selectEvent(n,e)},click:function(n){return t.selectEvent(n,e)},dblclick:function(n){return t.openOrEdit(n,e)},dragstart:function(n){return t.drag(n,e)}}},[i("img",{class:{selected:t.checked===e},style:{width:t.toPx(e.img.width),height:t.toPx(e.img.height)},attrs:{src:n(445)("./"+e.type+".png"),draggable:"false"}}),"mark"===e.type||"risk"===e.type?i("span",{ref:"name"+e.id,refInFor:!0,staticClass:"name",class:e.type,attrs:{contenteditable:e.edit,draggable:"false"},domProps:{innerHTML:t._s(e.name)},on:{blur:function(n){return t.editBlur(e,n)}}}):t._e()])})),0)},V=[];function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var J={name:"Events",props:{nodes:{type:Array,default:function(){return[]}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}},isSub:{type:Boolean,default:function(){return!1}},parentNode:{type:Object,default:function(){return null}}},data:function(){return{current:null,crashNode:null}},computed:{zIndex:function(){return this.checked instanceof O["a"]?-1:0}},created:function(){},mounted:function(){this.$bus.$on("showSubNode".concat(this.isSub?this.parentNode.id:""),this.showSubNode),this.$bus.$on("nodeMove".concat(this.isSub?this.parentNode.id:""),this.nodeMove)},methods:{toPx:j["l"],drag:function(t,e){Object(j["a"])(t),"dragstart"===t.type?t=event||t:event.touches&&(t=event.touches[0]?event.touches[0]:event);var n={x:t.offsetX,y:t.offsetY};this.$bus.$emit("update-checked",e),this.current=G(G({},e),{},{offset:n}),this.$bus.$emit("dragCloneEvent",t,this.current)},selectEvent:function(t,e){var n=this;if(t.stopPropagation(),this.$bus.$emit("update-checked",e),this.isDrawLine&&"mark"!==e.type&&"risk"!==e.type){var i="startDraw".concat(this.isSub?this.parentNode.id:"");setTimeout((function(){n.$bus.$emit(i,t,e,n.parentNode)}),0)}},nodeMove:function(t){var e=this;if(t&&this.events&&this.events.length>0){this.crashNode=t,this.$store.commit("flow/setPointsByNode",{node:t,obj:this.events[0]});var n=this.$store.getters["flow/getPoints"](t.id),i=[],o=this.$store.state.flow.page.scale;n.forEach((function(n){e.events.forEach((function(s){t.id===s.nodeId&&n.direction===s.direction&&(n.index===s.index||n.isMax&&s.index>=n.index)&&(s=Object.assign(s,n),s.point.x=s.point.x/o,s.point.y=s.point.y/o,s.out&&s.out.length>0&&e.$bus.$emit("eventMove".concat(e.isSub?e.parentNode.id:""),s),i.push(n))}))})),i.forEach((function(i){var o=null===n||void 0===n?void 0:n.indexOf(i);e.$store.commit("flow/deletePoint",{id:t.id,index:o})}))}},showSubNode:function(t){var e=this;this.events.forEach((function(n){n.nodeId===t.id&&(n.isHide=!t.open.show,n.out&&n.out.length>0&&e.$bus.$emit("hideLines",n.out,!t.open.show))}))},globalMove:function(t,e,n){if(t)for(var i=0;i<this.events.length;i++){var o=this.events[i];e&&(o.point.x+=t.x),n&&(o.point.y+=t.y)}},editBlur:function(t,e){t.name=e.target.innerText,t.attributes.Name=e.target.innerText},openOrEdit:function(t,e){var n=this;if("risk"===e.type){var i,o=Object(j["e"])(this.nodes,e.nodeId),s=(null===(i=o.attributes)||void 0===i||null===(i=i.InstitutionAndRiskInfoList)||void 0===i?void 0:i.fxkz)||{};dsf.layer.openDialog({title:"风险控制",width:"600px",height:"428px",content:"RiskInfo",params:{value:{fxkz:s}},btns:[{text:"确定",handler:function(t){if(!t.validate())return!1;var e=t.yes();o.attributes.InstitutionAndRiskInfoList?Object.assign(o.attributes.InstitutionAndRiskInfoList,e):o.attributes.InstitutionAndRiskInfoList=e}},{text:"取消"}]})}else"mark"===e.type&&(e.edit=!0,setTimeout((function(){var t;n.$refs["name"+e.id][0].focus();var i=window.getSelection(),o=null===i||void 0===i||null===(t=i.getRangeAt)||void 0===t?void 0:t.call(i,0);null===o||void 0===o||o.setStart(o.startContainer,n.$refs["name"+e.id][0].innerText.length)}),0))},hideEdit:function(t){t.edit=!1}}},q=J,Z=Object(C["a"])(q,Y,V,!1,null,null,null),K=Z.exports,Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"nodes",staticClass:"nodes",class:{isSub:t.isSub,active:t.isSub&&t.dragToSubNode===t.parentNode},style:t.getNodesStyle()},[t._l(t.nodes,(function(e){return[e.isHide?t._e():n("div",{directives:[{name:"context-menu",rawName:"v-context-menu",value:{params:e,data:t.contextMenus},expression:"{params: node, data: contextMenus}"}],key:e.id,staticClass:"nodeOuter",class:t.getNodeOuterClass(e),style:t.getNodeOuterStyle(e),attrs:{"data-id":e.id,"data-parent-id":t.isSub?t.parentNode.id:"",draggable:t.draggable},on:{dragstart:function(n){return t.drag(n,e)},mousedown:function(n){return t.selectNode(n,e)},dblclick:function(n){return t.showSub(n,e)}}},[t.shrinkNode(e)?n("div",{staticClass:"node systematic-node",class:t.isChecked(e),style:{width:t.toPx(e.width),height:t.toPx(e.height)},attrs:{draggable:"false","data-id":e.id}},[n("FlowImg",{staticClass:"systematic",attrs:{node:e}}),t.isPreview&&t.sPID?n("i",{staticClass:"iconfont status",class:{"icon-icon-wancheng":e.isThrough&&t.checked!==e,"icon-gengduomore12":t.checked===e,"icon-a-shijianbeifen2":!e.isThrough&&t.checked!==e}}):t._e(),n("NodeName",{attrs:{node:e}})],1):n("div",{staticClass:"node",class:Object.assign({},t.isChecked(e),{"normal-node":"102"!==e.type,"cc-node":e.attributes&&e.attributes.InLine&&"101"===e.type&&[3,4].includes(e.attributes.InLine.Type),"sub-node":"102"===e.type&&e.open&&e.open.show}),style:{width:t.toPx(e.width+2),height:t.toPx(e.height+2),padding:"systematic"===t.flowModel?"3px":"30px 15px",pointerEvents:t.isDrewingLine?"none":""},attrs:{"data-id":e.id,"data-parent-id":t.isSub?t.parentNode.id:"",draggable:"false"}},[n("FlowImg",{key:t.flowModel,staticClass:"img",attrs:{node:e}}),t.isPreview&&t.sPID?n("i",{staticClass:"iconfont status normal",class:{"icon-icon-wancheng":e.isThrough&&t.checked!==e,"icon-gengduomore12":t.checked===e,"icon-a-shijianbeifen2":!e.isThrough&&t.checked!==e}}):t._e(),n("NodeName",{attrs:{node:e}}),!t.isPreview&&"101"===e.type||"201"===e.type?n("div",{staticClass:"task-msg",on:{dblclick:function(e){return t.showRangeRule(e)}}},[t._v(" "+t._s(e.taskMsg||"未设置发送范围")+" ")]):t._e(),t.showSubNode(e)?n("SubNode",{ref:"subprocess",refInFor:!0,attrs:{"is-draw-line":t.isDrawLine,lines:e.lines,"parent-node":e,nodes:e.nodes,events:e.events,checked:t.checked}}):t._e(),t.showSubNode(e)?t._l(t.resizeNodes,(function(i,o){return n("span",{key:o,class:i[1]+"-resize",on:{mousedown:function(n){return t.dragResize(n,e,i[0],i[1])}}})})):t._e()],2),t._l(4,(function(e,i){return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isDrawLine,expression:"isDrawLine"}],key:i,class:"joinPoint joinPoint-"+i})}))],2)]}))],2)},tt=[],et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",{staticClass:"nodename ellipsis",class:{isPreview:t.isPreview},style:{width:t.node.open&&t.node.open.show?"100%":t.toPx(t.node.nameWidth)},attrs:{title:t.showOrder(t.node.name,t.node)},on:{dblclick:function(e){return t.editNode(e,t.node)}}},[t.node.edit?t._e():n("span",[t._v(t._s(t.showOrder(t.node.name,t.node)))]),t.node.edit?n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.node.name,expression:"node.name"},{name:"focus",rawName:"v-focus"}],staticClass:"nodenameInput",attrs:{type:"text"},domProps:{value:t.node.name},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterEdit(t.node)},blur:t.handleBlur,input:[function(e){e.target.composing||t.$set(t.node,"name",e.target.value)},function(e){return t.editName(t.node)}]}}):t._e()])},nt=[],it={name:"NodeName",inject:["$flowModel","toPx","isPreview","$designer"],props:{node:{type:Object,default:function(){return{}}}},methods:{handleBlur:function(){this.node.edit=null,this.$designer.recordUndoData()},showOrder:function(t,e){var n;return"systematic"===this.$flowModel()&&null!==e&&void 0!==e&&null!==(n=e.attributes)&&void 0!==n&&null!==(n=n.BaseInfo)&&void 0!==n&&n.ShowOrder?"".concat(e.attributes.BaseInfo.ShowOrder,".").concat(t):t},enterEdit:function(t){"normal"===this.$flowModel()&&(t.edit=null)},editNode:function(t,e){this.isPreview||(t.stopPropagation(),this.$set(e,"edit",!0))},editName:function(t){this.$set(t.attributes.BaseInfo,"Name",t.name),this.$bus.$emit("updateNodeName".concat(this.isSub?this.parentNode.id:""),t)}}},ot=it,st=Object(C["a"])(ot,et,nt,!1,null,null,null),at=st.exports,rt=n(611),lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"subprocess"},[n("lines",{attrs:{"is-draw-line":t.isDrawLine,"parent-node":t.parentNode,lines:t.lines,nodes:t.nodes,events:t.events,checked:t.checked,"is-sub":!0}}),n("nodes",{attrs:{"is-draw-line":t.isDrawLine,"parent-node":t.parentNode,nodes:t.nodes,checked:t.checked,"is-sub":!0,"data-id":t.parentNode.id}}),n("events",{attrs:{"is-draw-line":t.isDrawLine,"parent-node":t.parentNode,nodes:t.nodes,events:t.events,checked:t.checked,"is-sub":!0}})],1)},ht=[],dt={name:"SubNode",components:{Lines:X,Events:K,Nodes:mt},props:{lines:{type:Array,default:function(){return[]}},nodes:{type:Array,default:function(){return[]}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}},parentNode:{type:Object,default:function(){return{}}}}},ct=dt,ut=Object(C["a"])(ct,lt,ht,!1,null,null,null),pt=ut.exports;function ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ft(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var gt={name:"Nodes",components:{SubNode:pt,NodeName:at,FlowImg:rt["a"]},inject:["$preData","isPreview","$designer"],props:{nodes:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}},isSub:{type:Boolean,default:function(){return!1}},parentNode:{type:Object,default:function(){return null}}},data:function(){return{dragToSubNode:null,current:null,edit:null,offset:{},moveObj:null,resizeNode:null,mouseDownPoint:null,isDrewingLine:null,isSelected:!1,sPID:dsf.url.queryString("sPID"),resizeNodes:[["horizontal","top"],["vertical","right"],["horizontal","bottom"],["vertical","left"]],contextMenus:[{icon:"icon-shanchu",name:"删除节点",handler:this.deleteNode}]}},computed:yt({draggable:function(){return!this.verifySub(this.parentNode)&&!this.isPreview&&(!this.isDrawLine&&this.checked instanceof w["a"]&&!this.resizeNode&&this.selectedList.length<=1)}},Vuex.mapState({page:function(t){return t.flow.page},svgRoot:function(t){return t.flow.svgRoot},scale:function(t){return t.flow.page.scale},flowModel:function(t){return t.flow.flowModel},selectedList:function(t){return t.flow.selectedList}})),mounted:function(){var t=this;this.isPreview||(this.$refs.nodes.ondragover=function(t){return!1},this.setNodePosition(),this.$bus.$on("isMoveNode",(function(e){t.current=e,e||(t.dragToSubNode=null,t.$bus.$emit("update-baseLine",{show:"",top:0,left:0}))})),this.$bus.$on("moveCopyNode".concat(this.isSub?this.parentNode.id:""),(function(e,n){t.move(e,n)})),this.$bus.$on("isDrewingLine".concat(this.isSub?this.parentNode.id:""),(function(e){t.isDrewingLine=e})),this.$bus.$on("startMoveEvent",(function(e){t.moveObj=e})),this.$bus.$on("endMoveEvent",(function(){t.moveObj=null})),this.$bus.$on("dragToSubNode",(function(e){Object(j["m"])(t.parentNode)||(t.dragToSubNode=e)})),this.$bus.$on("globalMove".concat(this.isSub?this.parentNode.id:""),this.globalMove),this.$bus.$on("selectGlobal".concat(this.isSub?this.parentNode.id:""),this.selectGlobal),document.addEventListener("mousemove",(function(e){t.resizeNode&&t.moveResize(e)})),document.addEventListener("mouseup",(function(e){t.resizeNode&&t.dropResize(e),(e.ctrlKey||e.metaKey)&&t.setSelectList(e)})))},methods:{toPx:j["l"],verifySub:j["m"],deleteNode:function(t){var e=t.params;this.$designer.deleteNode(e)},getNodesStyle:function(){return{height:this.current?this.isSub?"calc(100% - ".concat(Object(j["l"])(this.parentNode.imgHeight+2*this.parentNode.padding+2),")"):"100%":0,top:this.isSub?Object(j["l"])(this.parentNode.imgHeight+2*this.parentNode.padding):0,pointerEvents:this.current?"auto":""}},getNodeOuterClass:function(t){var e,n,i=null===(e=t.type)||void 0===e?void 0:e.toString(),o=0===i.indexOf("10")&&(null===t||void 0===t||null===(n=t.open)||void 0===n?void 0:n.show);return{systematic:"systematic"===this.flowModel,"task-node":o,"start-node":"201"===t.type,"end-node":"299"===t.type,"judgement-node":"301"===t.type,"jump-node":"302"===t.type}},getNodeOuterStyle:function(t){var e=this.showOuterPadding(t);return{top:e?Object(j["l"])(t.point.y-50):Object(j["l"])(t.point.y-t.padding),left:e?Object(j["l"])(t.point.x-50):Object(j["l"])(t.point.x-t.padding),padding:e?"50px 70px 70px 50px":Object(j["l"])(t.padding),pointerEvents:"auto"}},shrinkNode:function(t){var e;return!(null!==t&&void 0!==t&&null!==(e=t.open)&&void 0!==e&&e.show)},showSubNode:function(t){var e;return"102"==t.type&&"normal"===this.flowModel&&(null===t||void 0===t||null===(e=t.open)||void 0===e?void 0:e.show)},isChecked:function(t){return{selected:this.checked===t||this.selectedList.indexOf(t)>-1}},showOuterPadding:function(t){var e,n;return null!==(e=this.moveObj)&&void 0!==e&&e.type?"mark"===this.moveObj.type||"risk"===this.moveObj.type:this.moveObj&&0===(null===t||void 0===t||null===(n=t.type)||void 0===n?void 0:n.toString().indexOf("10"))},getNamePostion:function(t,e){var n={x:t.point.x<0?0:t.point.x,y:t.point.y<0?0:t.point.y},i=(t.width-t.nameWidth)/2,o=t.height,s={top:this.toPx(n.y+o),left:this.toPx(n.x+i)};return s[e]},drag:function(t,e){var n=this;return d()(y.a.mark((function i(){return y.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return Object(j["a"])(t),t.stopPropagation(),i.next=4,n.sleepTime();case 4:if(n.draggable){i.next=6;break}return i.abrupt("return");case 6:n.offset={x:t.offsetX,y:t.offsetY},n.$bus.$emit("update-checked",e),n.current=e,n.$bus.$emit("dragNode",t,n.current,n.offset,!0);case 10:case"end":return i.stop()}}),i)})))()},move:function(t,e){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY}),i={x:n.x-this.offset.x*this.scale<0?0:n.x-this.offset.x*this.scale,y:n.y-this.offset.y*this.scale<0?0:n.y-this.offset.y*this.scale};e.parentNodeId&&(i.x=i.x-this.parentNode.point.x*this.scale,i.y=i.y-this.parentNode.point.y*this.scale-(this.parentNode.imgHeight+2*this.parentNode.padding)*this.scale),i={x:i.x/this.scale,y:i.y/this.scale},this.setNodePosition(),this.showSamePositionNodeBaseLine(e,i),this.$bus.$emit("autoScroll",{type:"node",data:e,point:{x:i.x,y:i.y},mouse:{x:t.pageX,y:t.pageY}})},dragResize:function(t,e,n,i){t.stopPropagation(),this.$bus.$emit("update-checked",e),this.resizeNode=yt(yt({},e),{},{lineDirection:n,direction:i}),this.$bus.$emit("update-baseLine",{show:n,top:0,left:0})},moveResize:function(t){var e,n,i,o,s,a,r=this.page,l=this.svgRoot,h=this.resizeNode.lineDirection,d=this.$store.getters["flow/lanesWidth"],c=this.$store.getters["flow/lanesHeight"],u=this.scale;switch(this.resizeNode.direction){case"top":a=this.resizeNode.point.y+this.resizeNode.height+c-v["f"].height,i=t.pageY-r.top+l.scrollTop,e={top:i<a*u?i>0?i:0:a*u,left:0};break;case"right":n=this.resizeNode.point.x+v["f"].width+d,i=t.pageX-r.left+l.scrollLeft,e={top:0,left:i>n*u?i:n*u};break;case"bottom":o=this.resizeNode.point.y+v["f"].height+c,i=t.pageY-r.top+l.scrollTop,e={top:i>o*u?i:o*u,left:0};break;case"left":s=this.resizeNode.point.x+this.resizeNode.width+d-v["f"].width,i=t.pageX-r.left+l.scrollLeft,e={top:0,left:i<s*u?i>0?i:0:s*u};break}e.top=e.top/u,e.left=e.left/u;var p=Object.assign(e,{showV:"vertical"===h,showH:"horizontal"===h});this.$bus.$emit("update-baseLine",p),this.$bus.$emit("autoScroll",{type:"lane",data:this.resizeNode,mouse:{x:t.pageX,y:t.pageY}})},dropResize:function(t){var e=this;if(this.resizeNode&&this.checked&&this.checked instanceof w["a"]){var n,i,o,s,a,r,l,h=this.page,d=this.svgRoot,c=(this.resizeNode.lineDirection,this.$store.getters["flow/lanesWidth"]),u=this.$store.getters["flow/lanesHeight"],p=this.scale;switch(this.resizeNode.direction){case"top":a=this.resizeNode.point.y+this.resizeNode.height+u-v["f"].height,i=t.pageY-h.top+d.scrollTop,l=this.checked.point.y,this.checked.point.y=(i<a*p?i>0?i:0:a*p)/p,this.checked.height=this.checked.height+l-this.checked.point.y;break;case"right":n=this.resizeNode.point.x+v["f"].width+c,i=t.pageX-h.left+d.scrollLeft,this.checked.width=(i>n*p?i:n*p)/p-this.checked.point.x;break;case"bottom":o=this.resizeNode.point.y+v["f"].height+u,i=t.pageY-h.top+d.scrollTop,this.checked.height=(i>o*p?i:o*p)/p-this.checked.point.y;break;case"left":s=this.resizeNode.point.x+this.resizeNode.width+c-v["f"].width,i=t.pageX-h.left+d.scrollLeft,r=this.checked.point.x,this.checked.point.x=(i<s*p?i>0?i:0:s*p)/p,this.checked.width=this.checked.width+r-this.checked.point.x;break}this.checked.open.width=this.checked.width,this.checked.open.height=this.checked.height,this.$bus.$emit("nodeMove",this.checked),this.$bus.$emit("update-baseLine",{showV:!1,showH:!1,top:0,left:0}),this.$bus.$emit("resize"),this.resizeNode=null,this.$nextTick((function(){e.$designer.recordUndoData()}))}},sleepTime:function(){return new Promise((function(t){setTimeout((function(){t()}),0)}))},selectNode:function(t,e){var n=this;return d()(y.a.mark((function i(){var o,s,a;return y.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.sleepTime();case 2:if(!n.isPreview){i.next=4;break}return i.abrupt("return");case 4:if(n.mouseDownPoint={x:t.pageX,y:t.pageY},!t.ctrlKey&&!t.metaKey){i.next=12;break}n.selectedList.length>1&&-1===(null===(o=n.selectedList)||void 0===o?void 0:o.indexOf(e))&&(n.$store.commit("flow/addSelected",e),n.isSelected=!0),n.$bus.$emit("startCopyNodes",t),n.$bus.$emit("update-checked",e),t.stopPropagation(),i.next=21;break;case 12:if(t.stopPropagation(),!(!n.isDrawLine&&n.selectedList.length>1&&(null===(s=n.selectedList)||void 0===s?void 0:s.indexOf(e))>-1)){i.next=17;break}return n.$bus.$emit("startCopyNodes",t),n.$bus.$emit("update-checked",e),i.abrupt("return");case 17:n.$bus.$emit("update-checked",e),n.isDrawLine&&"299"!==(null===e||void 0===e?void 0:e.type)&&setTimeout((function(){n.$bus.$emit("startDraw".concat(n.isSub?n.parentNode.id:""),t,e,n.parentNode)}),0),a=n.isSub?[]:[e],n.$store.commit("flow/setSelectedList",a);case 21:case"end":return i.stop()}}),i)})))()},setSelectList:function(t){if(!this.isSub&&this.mouseDownPoint){var e=Math.sqrt(Math.pow(this.mouseDownPoint.x-t.pageX,2)+Math.pow(this.mouseDownPoint.y-t.pageY,2));if(!this.isSelected&&e<5){var n=this.selectedList.indexOf(this.checked);n>-1?(this.$store.commit("flow/deleteSelected",n),this.$bus.$emit("update-checked",flow)):this.$store.commit("flow/addSelected",this.checked)}this.isSelected=!1,this.mouseDownPoint=null}},showSub:function(t,e){var n,i=this;if(this.isPreview){var o=this.$preData();null===o||void 0===o||o.forEach((function(t){t.list.forEach((function(t){t.wholeName==e.name&&window.parent.postMessage({type:"nodeChange",data:t},"*")}))}))}else"systematic"!==this.flowModel&&(t.stopPropagation(),0===(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toString().indexOf("10"))&&(!e.parentNodeId||e.parentNodeId&&"102"!==e.type)&&(e.open.show=!e.open.show,e.open.show?(e.width=e.open.width,e.height=e.open.height):(e.open.width=e.width,e.open.height=e.height,e.width=v["g"].width,e.height=v["g"].height),this.$bus.$emit("showSubNode".concat(this.isSub?this.parentNode.id:""),e),this.$nextTick((function(){i.$designer.recordUndoData()}))))},setNodePosition:function(){this.nodePosition={x:{},xCenter:{},y:{},yCenter:{}};for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];this.nodePosition.x[e.point.x]||(this.nodePosition.x[e.point.x]=[]),this.nodePosition.y[e.point.y]||(this.nodePosition.y[e.point.y]=[]);var n=Object(j["d"])({x:this.parentNode?this.parentNode.point.x+e.point.x+e.width/2:e.point.x+e.width/2,y:this.parentNode?this.parentNode.point.y+(this.parentNode.imgHeight+2*this.parentNode.padding)+e.point.y+e.height/2:e.point.y+e.height/2});this.nodePosition.xCenter[n.x]||(this.nodePosition.xCenter[n.x]=[]),this.nodePosition.yCenter[n.y]||(this.nodePosition.yCenter[n.y]=[]),this.nodePosition.x[e.point.x].push(e),this.nodePosition.y[e.point.y].push(e),this.nodePosition.xCenter[n.x].push(e),this.nodePosition.yCenter[n.y].push(e)}},showSamePositionNodeBaseLine:function(t,e){var n=this.checkSamePositionNode(t,e),i=this.$store.getters["flow/getSvgOffset"],o={showV:n.V,showH:n.H,left:n.V?n.xCenter?n.x:e.x+i.left/this.scale:0,top:n.H?n.yCenter?n.y:e.y+i.top/this.scale:0};t.parentNodeId&&(o.left=o.left+this.parentNode.point.x,o.top=o.top+this.parentNode.point.y+(this.parentNode.imgHeight+2*this.parentNode.padding)),this.$bus.$emit("update-baseLine",o)},checkSamePositionNode:function(t,e){this.scale;var n=this.nodePosition,i=e.x,o=e.y,s={V:!1,H:!1,xCenter:!1,yCenter:!1};(n.x[i]&&n.x[i].length>0||n.x[i]&&1==n.x[i].length&&n.x[i][0]!=t)&&(s.V="vertical");var a=Object(j["d"])({x:this.parentNode?this.parentNode.point.x+i+t.width/2:i+t.width/2,y:this.parentNode?this.parentNode.point.y+(this.parentNode.imgHeight+2*this.parentNode.padding)+o+t.height/2:o+t.height/2});if(n.xCenter[a.x]&&n.xCenter[a.x].length>0){var r=n.xCenter[a.x][0];s.xCenter=!0,s.V="vertical",s.x=Object(j["d"])({x:r.point.x+r.width/2}).x}if(n.y[o]&&n.y[o].length>0&&(s.H="horizontal"),n.yCenter[a.y]&&n.yCenter[a.y].length>0){var l=n.yCenter[a.y][0];s.yCenter=!0,s.H="horizontal",s.y=Object(j["d"])({y:l.point.y+l.height/2}).y}return s},globalMove:function(t,e,n,i){if(t)for(var o=0;o<this.selectedList.length;o++){var s=this.selectedList[o];e&&(s.point.x+=t.x),n&&(s.point.y+=t.y),(e||n)&&this.$bus.$emit("nodeMove",s)}},selectGlobal:function(t,e){var n=[];t&&e&&this.nodes.forEach((function(i){i.point.x>t.x&&i.point.y>t.y&&i.point.x+i.width<e.x&&i.point.y+i.height<e.y&&n.push(i)}));var i=n?n[0]:this.checked;this.$bus.$emit("update-checked",i),this.$store.commit("flow/setSelectedList",n)},showRangeRule:function(t){t.stopPropagation(),t.preventDefault(),document.querySelector(".RangeRule")&&document.querySelector(".RangeRule").click()}}},xt=gt,vt=Object(C["a"])(xt,Q,tt,!1,null,null,null),mt=vt.exports,bt={name:"FlowContent",components:{Lines:X,Events:K,Nodes:mt},inject:["$designer"],props:{lines:{type:Array,default:function(){return[]}},nodes:{type:Array,default:function(){return[]}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}}},data:function(){return{}},created:function(){},methods:{}},wt=bt,Ot=Object(C["a"])(wt,i,o,!1,null,null,null);e["a"]=Ot.exports},603:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ds-flow-info designer-props"},[n("el-tabs",{attrs:{stretch:""},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[n("el-tab-pane",{staticClass:"commonUse",attrs:{label:"常用",name:"base"}},[n("dsf-virtual-scroll",[n("div",{staticClass:"el-collapse-item__content"},[t._l(t.data,(function(e,i){return[n("FlowProperties",{key:i,attrs:{inCommonUse:!0,item:e,subIsDisabled:t.subIsDisabled,curSelectObj:t.curSelectObj,curNodeAttr:t.curNodeAttr},on:{changeProperty:t.changeProperty}})]}))],2)])],1),n("el-tab-pane",{staticClass:"advanced",attrs:{label:"全部",name:"advanced"}},[n("dsf-virtual-scroll",[n("el-collapse",{attrs:{accordion:""},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[t._l(t.data,(function(e,i){return[t.showItem(e)?n("el-collapse-item",{key:i,attrs:{title:e.name,name:e.name}},[n("FlowProperties",{attrs:{item:e,subIsDisabled:t.subIsDisabled,curSelectObj:t.curSelectObj,curNodeAttr:t.curNodeAttr},on:{changeProperty:t.changeProperty}})],1):t._e()]}))],2)],1)],1)],1)],1)},o=[],s=n(4),a=n.n(s),r=n(3),l=n.n(r),h=n(1),d=n.n(h),c=n(411),u=n(410),p=n(460),f=n(409),y=n(418),g=n(393),x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"},nativeOn:{submit:function(t){t.preventDefault()}}},t._l(t.item.attributes,(function(e,i){return n("div",{key:i,staticClass:"property-item"},[t.showAttr(e)?n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[t._v(" "+t._s(e.text)+" "),e.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},on:{click:function(n){return t.showHelp(e)}}}):t._e()],1),"version"===e.showType?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:t.subIsDisabled,min:t.minValue(e,0)},on:{change:function(n){return t.changeVersion(e,0)}},model:{value:e.value0,callback:function(n){t.$set(e,"value0",n)},expression:"attr.value0"}}),n("span",[t._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",disabled:t.subIsDisabled,min:t.minValue(e,1)},on:{change:function(n){return t.changeVersion(e,1)}},model:{value:e.value1,callback:function(n){t.$set(e,"value1",n)},expression:"attr.value1"}}),n("span",[t._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:e.value2,callback:function(n){t.$set(e,"value2",n)},expression:"attr.value2"}})],1):t._e(),"text-unit"===e.showType?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:t.subIsDisabled,min:0,max:e.max},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[t._v(t._s(e.unit))])],1):t._e(),"text"===e.showType?n("el-input",{attrs:{disabled:t.subIsDisabled||e.disabled},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}}):t._e(),"number"===e.showType?n("el-input-number",{attrs:{disabled:t.subIsDisabled||e.disabled,min:e.config&&e.config.min||0,step:1,"step-strictly":""},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}}):t._e(),"textarea"===e.showType?n("el-input",{attrs:{disabled:t.subIsDisabled,type:"textarea",placeholder:"请输入内容"},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}}):t._e(),"select"===e.showType?n("el-select",{attrs:{name:e.bindControlAttr,disabled:t.subIsDisabled,placeholder:"请选择"},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}},t._l(e.dictionary,(function(t,e){return n("el-option",{key:e,attrs:{label:t.text,value:t.value}})})),1):t._e(),"boolean"===e.showType?n("el-radio-group",{attrs:{disabled:t.subIsDisabled},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}},[n("el-radio",{attrs:{label:0}},[t._v("否")]),n("el-radio",{attrs:{label:1}},[t._v("是")])],1):t._e(),"radio"===e.showType?n("el-radio-group",{attrs:{disabled:t.subIsDisabled},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}},t._l(e.dictionary,(function(e,i){return n("el-radio",{key:i,attrs:{label:e.value}},[t._v(" "+t._s(e.text)+" ")])})),1):t._e(),"checkbox"===e.showType?n("el-checkbox-group",{attrs:{disabled:t.subIsDisabled},on:{change:function(n){return t.changeProperty(e)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"attr.value"}},t._l(e.dictionary,(function(e,i){return n("el-checkbox",{key:i,attrs:{label:e.value}},[t._v(" "+t._s(e.text)+" ")])})),1):t._e(),"dialog"===e.showType?n("DsfButton",{class:e.class,attrs:{type:"plain",icon:"shezhi"},on:{click:function(n){return t.doOpenDialog(e)}}},[t._v(" "+t._s(t.subIsDisabled?"查看":"设置")+" ")]):t._e(),"url"===e.showType?n("DsfButton",{class:e.class,attrs:{type:"plain",icon:"chakan"},on:{click:function(n){return t.openWin(e)}}},[t._v(" 查看 ")]):t._e()],1):t._e()],1)})),0)},v=[],m=n(392),b={name:"FlowProperties",inject:["$flowModel","$nodes","$lines","$checked","getObjById","getProperties"],props:{item:{type:Object,default:function(){return{}}},curSelectObj:{type:Object,default:function(){return{}}},curNodeAttr:{type:Object,default:function(){return{}}},inCommonUse:{type:Boolean,default:!1},subIsDisabled:{type:Boolean,default:!1}},data:function(){return{}},computed:{},methods:{showAttr:function(t){var e=!0;this.inCommonUse&&(e=t.inCommonUse);var n=!0;return t.showExpress&&this.curNodeAttr&&(n=this.$eval(t.showExpress,this.curNodeAttr)),"normal"===this.$flowModel()?e&&n:n&&e&&t.inSystematic},changeProperty:function(t){this.$emit("changeProperty",t)},showHelp:function(t){this.$openDialog({title:t.name,width:"500px",height:"300px",overflow:"auto",template:'<span style="display: inline-block; line-height: 1.5em" v-html="dsf.safe.xss(params.value)"></span>',params:{value:t.desc},btns:[]})},changeVersion:function(t,e){t&&(0===e&&(t.value1=0,t.value2="0001"),t.value=t.value0+"."+t.value1+"."+t.value2,this.changeProperty(t))},doOpenDialog:function(t){var e=this;return a()(d.a.mark((function n(){var i,o,s,a,r,l,h,c,u,p;return d.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t,null!==o&&void 0!==o&&null!==(i=o.config)&&void 0!==i&&i.content){n.next=4;break}return e.$message("没有配置弹窗内容",!1),n.abrupt("return");case 4:if(s=o.config.content,a={code:o.value&&o.value.Expression||"",language:"java",checked:e.$checked(),value:o.value},"RangeRule"!==s&&"SumAllNode"!==s){n.next=11;break}a.nodes=e.$nodes(),a.value=o.value||{},n.next=71;break;case 11:if("Summary"!==s){n.next=16;break}a.lines=e.$lines(),a.value=o.value||{},n.next=71;break;case 16:if("SendCondition"!==s){n.next=22;break}a.lines=e.$lines(),a.nodes=e.$nodes(),a.value=o.value||{},n.next=71;break;case 22:if("EventSetting"!==s){n.next=26;break}a.isEvent=!0,n.next=71;break;case 26:if("SetSubFlow"!==s){n.next=30;break}a.mode=e.curSelectObj.attributes.BaseInfo.Mode,n.next=71;break;case 30:if("SetOpinionNode"!==s){n.next=34;break}a.subNodes=e.curSelectObj.nodes,n.next=71;break;case 34:if("SumStartNode"!==s){n.next=39;break}a.nodes=e.$nodes(),a.value=o.value||[],n.next=71;break;case 39:if("ParameterTree"!==s){n.next=44;break}a.type=o.config.type,a.url=o.config.url,n.next=71;break;case 44:if("ParameterReal"!==s){n.next=58;break}if(h=null===(r=o.config)||void 0===r?void 0:r.type,"general"!==h&&"dataConversion"!==h&&"python"!==h||null!==(l=o.config)&&void 0!==l&&l.isLoad){n.next=53;break}return n.next=49,Object(g["j"])(e.curSelectObj.rid);case 49:c=n.sent,o.config.url=c.executeScript,"general"===h&&(o.config.fullClassName=c.fullClassName),o.config.isLoad=!0;case 53:a.type=o.config.type,a.url=o.config.url,a.fullClassName=o.config.fullClassName,n.next=71;break;case 58:if("DatabaseOperation"!==s){n.next=63;break}a.isBack=o.config.isBack,a.fullClassName=o.config.fullClassName,n.next=71;break;case 63:if("ParameterExecSql"!==s&&"ParameterExecWeb"!==s){n.next=71;break}if(null!==(u=o.config)&&void 0!==u&&u.isLoad){n.next=70;break}return n.next=67,Object(g["j"])(e.curSelectObj.rid);case 67:p=n.sent,o.config.url=p.executeScript,o.config.isLoad=!0;case 70:a.url=o.config.url;case 71:e.$openDialog({title:o.config.title||o.text,width:o.config.width,height:o.config.height,overflow:"hidden",content:s,params:a,btns:[{class:e.subIsDisabled?"hide":"",text:"确定",handler:function(t){if("SetSubFlow"===s){if(t.validate()){var n=t.yes();return o.value=n.SubWFID,e.curSelectObj.attributes.BaseInfo.Mode=n.Mode,e.curSelectObj.attributes.BaseInfo.SubWFName=n.SubWFName,e.curSelectObj.attributes.BaseInfo.OpinionNodeID=null,e.curSelectObj.attributes.BaseInfo.OpinionNodeName=null,n.SubWFID?e.$http.get("wfm/getWFDefinition",{sID:n.SubWFID}).then((function(t){return e.changeProperty(o),e.$bus.$emit("initSubNode",e.curSelectObj,t.data.data.WorkFlow&&t.data.data.WorkFlow.ElementList||[]),!0})):(e.$bus.$emit("initSubNode",e.curSelectObj,[]),!0)}return!1}if("SetOpinionNode"===s){var i=t.yes();o.value=i.id,e.curSelectObj.attributes.BaseInfo.OpinionNodeName=i.name,e.changeProperty(o)}else if("SelectImg"===s)o.value=t.getContent(),"systematic"==e.$flowModel()&&Object.assign(e.curSelectObj,m["i"][o.value]),e.curSelectObj.imgType=o.value,e.$bus.$emit("nodeMove",e.curSelectObj),e.changeProperty(o);else if("InstitutionInfo"===s){if(!t.validate())return!1;var a=t.getContent();Object.assign(o.value,a),e.changeProperty(o)}else if("SendCondition"===s){var r;o.value=t.getContent(),e.changeProperty(o),"301"==e.curSelectObj.type&&(null===(r=e.curSelectObj)||void 0===r||null===(r=r.in)||void 0===r?void 0:r.length)>0&&e.curSelectObj.in.forEach((function(t){var n=e.getObjById(e.$lines(),t),i=e.getObjById(e.$nodes(),n.from);i.attributes.OutLine.SendConditions=o.value}))}else{if(dsf.isDef(t.validate)&&!t.validate())return!1;if(dsf.isUnDef(t.getContent))return e.$message("弹窗getContent函数没有设置， 当前".concat(o.config.title||o.text,"属性取不到值"),!1),!1;o.value=t.getContent(),e.changeProperty(o)}}},{text:"取消"}]}),"SetSubFlow"!==s||o.value||e.$message("请慎重操作，选择子流程任务后，将自动获取子流程任务，覆盖子流程");case 73:case"end":return n.stop()}}),n)})))()},openWin:function(t){var e=this.$replace(t.url,this.curSelectObj.attributes);this.$openWindow(e)},minValue:function(t,e){return 0===e?Number(t.oldValue.split(".")[0]):t.value0>Number(t.oldValue.split(".")[0])&&1===e?0:Number(t.oldValue.split(".")[1])}}},w=b,O=n(0),N=Object(O["a"])(w,x,v,!1,null,null,null),L=N.exports;function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){l()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var P={name:"FlowInfo",inject:["getObjById","$designer"],components:{FlowProperties:L},props:{checked:{type:Object,default:function(){return{}}},nodes:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:["1"],curSelectObj:null,curNodeAttr:null,data:[],status:"base",subIsDisabled:!1}},computed:I({minValue:function(){return function(t,e){return 0===e?Number(t.oldValue.split(".")[0]):t.value0>Number(t.oldValue.split(".")[0])&&1===e?0:Number(t.oldValue.split(".")[1])}}},Vuex.mapState({flowModel:function(t){return t.flow.flowModel}})),watch:{checked:function(t,e){t!==e&&(this.subIsDisabled=this.disabledSub())},"checked.attributes":function(t){this.curNodeAttr=t,t&&this.loadPropertyWindow(this.checked)}},mounted:function(){this.$bus.$on("updateNodeName",this.updateNodeName)},methods:{updateNodeName:function(t,e){e||this.loadPropertyWindow(this.checked)},disabledSub:function(){if(this.checked&&this.checked.parentNodeId){var t=this.getObjById(this.nodes,this.checked.parentNodeId);return Object(g["m"])(t)}return!1},showItem:function(t){return"normal"!==this.flowModel?"节点基本信息"===t.name||"质量体系标准"===t.name:!t.hide},loadPropertyWindow:function(t){var e=this;return a()(d.a.mark((function n(){return d.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(0!==Object.keys(t).length){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,e.setPropertyData(t);case 4:e.curSelectObj=t||null;case 5:case"end":return n.stop()}}),n)})))()},setPropertyData:function(t){var e=this;return a()(d.a.mark((function n(){var i,o,s,a,r;return d.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.data=[],i=t instanceof f["a"]?"node"+(t.isGeneral?"general":t.type):t instanceof u["a"]?"line":t instanceof p["a"]?"lane":t instanceof y["a"]?"boundaryevent":"flow",n.next=4,Object(g["i"])(i);case 4:return o=n.sent,s=t.attributes,"line"==i&&(a=e.nodes.filter((function(e){return"121"==e.type&&e.id==t.to})),r=e.nodes.filter((function(e){return"299"==e.type&&e.id==t.to}))),o.forEach((function(t){t.attributes.forEach((function(t){var e,n,i=t.bindControlAttr;if(i){(null===(e=a)||void 0===e?void 0:e.length)>0&&("SendParameter.RangeRule"==i||"SendParameter.IsInherit"==i)&&(t.showExpress="false"),0==(null===(n=r)||void 0===n?void 0:n.length)&&"SendParameter.promoterDone"==i&&(t.showExpress="false");var o,l,h,d,c,u=i.split("."),p=t.showType,f="";if(("select"===p&&"signType"!=(null===u||void 0===u?void 0:u[1])||"radio"===p||"boolean"===p)&&(f=0),3===u.length)t.value=dsf.isUnDef(null===s||void 0===s||null===(o=s[u[0]])||void 0===o||null===(o=o[u[1]])||void 0===o?void 0:o[u[2]])?t.value||f:null===s||void 0===s||null===(l=s[u[0]])||void 0===l||null===(l=l[u[1]])||void 0===l?void 0:l[u[2]];else if(2===u.length){var y,g;t.value=dsf.isUnDef(null===s||void 0===s||null===(y=s[u[0]])||void 0===y?void 0:y[u[1]])?t.value||f:null===s||void 0===s||null===(g=s[u[0]])||void 0===g?void 0:g[u[1]]}else t.value=dsf.isUnDef(null===s||void 0===s?void 0:s[u[0]])?t.value||f:null===s||void 0===s?void 0:s[u[0]];if("version"===p)t.oldValue=t.value,t.value0=null===(h=t.value)||void 0===h||null===(h=h.split("."))||void 0===h?void 0:h[0],t.value1=null===(d=t.value)||void 0===d||null===(d=d.split("."))||void 0===d?void 0:d[1],t.value2=null===(c=t.value)||void 0===c||null===(c=c.split("."))||void 0===c?void 0:c[2]}}))})),e.data=o,e.activeNames=[e.data[0].name],n.abrupt("return",o);case 11:case"end":return n.stop()}}),n)})))()},changeProperty:function(t){var e,n;"BaseInfo.Name"===t.bindControlAttr&&(this.curSelectObj.name=t.value,this.curSelectObj instanceof f["a"]&&this.$bus.$emit("updateNodeName".concat(this.isSub?this.parentNode.id:""),this.curSelectObj,!0),this.curSelectObj instanceof u["a"]&&(null!==(n=this.curSelectObj)&&void 0!==n&&null!==(n=n.edit)&&void 0!==n&&n.name1||(this.curSelectObj.name=t.value),this.curSelectObj.edit.name1&&(this.curSelectObj.edit.name1=t.value)));if("InLine.Type"===t.bindControlAttr){var i,o=Object(c["a"])(t.value),s=[],a=null===(i=this.curNodeAttr.InLine)||void 0===i||null===(i=i.RangeRule)||void 0===i?void 0:i.Rule;(null===a||void 0===a?void 0:a.length)>0&&(a.forEach((function(t){s.push(t.name+"/"+Object(c["b"])(t.IsSelected))})),this.curSelectObj.taskMsg="".concat(o,": ").concat(s.join(",")))}if("InLine.RangeRule"===t.bindControlAttr&&(null===t||void 0===t||null===(e=t.value)||void 0===e||null===(e=e.Rule)||void 0===e?void 0:e.length)>0){var r,l=Object(c["a"])(this.curNodeAttr.InLine.Type),h=[];null===(r=t.value)||void 0===r||null===(r=r.Rule)||void 0===r||r.forEach((function(t){h.push(t.name+"/"+Object(c["b"])(t.IsSelected))})),this.curSelectObj.taskMsg="".concat(l,": ").concat(h.join(","))}var d=t.bindControlAttr.split(".");this.curNodeAttr&&(1==(null===d||void 0===d?void 0:d.length)?this.curNodeAttr[d[0]]=t.value:2==(null===d||void 0===d?void 0:d.length)?this.curNodeAttr[d[0]][d[1]]=t.value:3==(null===d||void 0===d?void 0:d.length)&&(this.curNodeAttr[d[0]][d[1]][d[2]]=t.value)),this.curSelectObj instanceof u["a"]&&("BaseInfo.Type"==t.bindControlAttr&&(this.curSelectObj.type=t.value),"BaseInfo.LineShape"===t.bindControlAttr&&this.$bus.$emit("changeLineShape".concat(this.isSub?this.parentNode.id:""),this.curSelectObj),"BaseInfo.strokeDasharray"===t.bindControlAttr&&(this.curSelectObj.strokeDasharray=t.value,this.curSelectObj.refresh())),this.$designer.recordUndoData()},getCurrentNodeType:function(){var t=this.checked;return t instanceof f["a"]?"nodes":t instanceof u["a"]?"lines":t instanceof p["a"]?"lane":t instanceof y["a"]?"events":""}},destroyed:function(){this.$bus.$off("updateNodeName",this.updateNodeName)}},$=P,j=Object(O["a"])($,i,o,!1,null,null,null);e["a"]=j.exports},604:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"lanes"},t._l(t.lanes,(function(e,o){return i("div",{key:e.id||o,staticClass:"lane",class:{selected:!t.isPreview&&t.checked===e},style:{left:t.toPx(e.left),top:t.toPx(e.top),width:"vertical"===e.direction?t.toPx(e.size):"",height:"horizontal"===e.direction?t.toPx(e.size):""},attrs:{index:o},on:{click:function(n){return t.selectLane(n,e)}}},[i("div",{staticClass:"head"},[i("div",{staticClass:"title"},[i("el-popover",{attrs:{placement:"vertical"===e.direction?"bottom":"right",title:"修改名称",width:"200",trigger:"manual"},model:{value:e.isEdit,callback:function(n){t.$set(e,"isEdit",n)},expression:"lane.isEdit"}},[i("div",{staticClass:"el-input"},[e.isEdit?i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"lane.name"},{name:"focus",rawName:"v-focus"}],staticClass:"el-input__inner",attrs:{autofocus:"",type:"text",placeholder:"请输入内容"},domProps:{value:e.name},on:{change:function(n){e.attributes.Name=e.name,t.hideEdit()},input:function(n){n.target.composing||t.$set(e,"name",n.target.value)}}}):t._e()]),i("span",{staticClass:"textContent ellipsis",style:{width:t.toPx(e.size),transform:"horizontal"===e.direction?"rotate(-90deg) translateX(-"+e.size+"px)":""},attrs:{slot:"reference"},on:{dblclick:function(n){return t.edit(e)}},slot:"reference"},[t._v(" "+t._s(e.name)+" ")])]),i("img",{staticClass:"plus left",attrs:{src:n(459)},on:{click:function(n){return t.addLane(e.direction,o)}}}),i("img",{staticClass:"plus right",attrs:{src:n(459)},on:{click:function(n){return t.addLane(e.direction,o+1)}}}),i("span",{staticClass:"resizeLane",on:{mousedown:function(n){return t.dragLane(n,e)}}})],1)]),i("div",{staticClass:"bg/"}),i("div",{staticClass:"laneSelected"})])})),0)},o=[],s=n(3),a=n.n(s),r=n(392);function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){a()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={name:"Lanes",inject:["isPreview","$designer"],props:{lanes:{type:Array,default:function(){return[]}},checked:{type:Object,default:function(){return{}}}},data:function(){return{current:null,minSize:100}},mounted:function(){document.addEventListener("mousedown",this.startEit),document.addEventListener("mousemove",this.moveLane),document.addEventListener("mouseup",this.dropLane)},methods:{startEit:function(t){var e,n,i,o=t.target;"tooltip"!==o.getAttribute("role")&&"tooltip"!==(null===o||void 0===o||null===(e=o.parentElement)||void 0===e?void 0:e.getAttribute("role"))&&"tooltip"!==(null===o||void 0===o||null===(n=o.parentElement)||void 0===n||null===(n=n.parentElement)||void 0===n||null===(i=n.getAttribute)||void 0===i?void 0:i.call(n,"role"))&&this.hideEdit()},toPx:function(t){return"".concat(t,"px")},selectLane:function(t,e){this.$bus.$emit("update-checked",e),t.stopPropagation()},addLane:function(t,e){this.$emit("addLane",t,e)},dragLane:function(t,e){this.$bus.$emit("update-checked",e),this.current=h({},e),this.$bus.$emit("update-baseLine",{show:this.current.direction,top:0,left:0})},dropLane:function(t){var e=this;if(this.current){var n=this.$store.state.flow.page,i=this.$store.state.flow.svgRoot,o=this.$store.state.flow.page.scale;this.current.direction===r["a"].vertical?this.current.size=(t.pageX-this.current.left-n.left+i.scrollLeft)/o:this.current.size=(t.pageY-this.current.top-n.top+i.scrollTop)/o,this.current.size=this.current.size>this.minSize?this.current.size:this.minSize,this.$bus.$emit("update-baseLine",{showV:!1,showH:!1,top:0,left:0}),this.$store.commit("flow/changeLane",this.current),this.$bus.$emit("resize"),this.current=null,this.$nextTick((function(){e.$designer.recordUndoData()}))}},moveLane:function(t){if(!this.current)return!1;var e,n=this.$store.state.flow.page,i=this.$store.state.flow.svgRoot,o=this.$store.state.flow.page.scale;if(this.current.direction===r["a"].vertical){var s=this.current.left+this.minSize,a=t.pageX-n.left+i.scrollLeft;e={top:10,left:(a>s*o?a:s*o)/o}}else{var l=this.current.top+this.minSize,h=t.pageY-n.top+i.scrollTop;e={top:(h>l*o?h*o:l)/o,left:10}}var d=Object.assign(e,{showV:"vertical"===this.current.direction,showH:"horizontal"===this.current.direction});this.$bus.$emit("update-baseLine",d),this.$bus.$emit("autoScroll",{type:"lane",data:this.current,mouse:{x:t.pageX,y:t.pageY}})},edit:function(t){this.isPreview||this.lanes.forEach((function(e){e.isEdit=t===e}))},hideEdit:function(){this.lanes.forEach((function(t){t.isEdit=!1}))}},beforeDestroy:function(){this.$bus.$off("update-baseLine"),this.$bus.$off("flow/changeLane"),this.$bus.$off("autoScroll"),this.$bus.$off("update-checked"),this.$bus.$off("resize"),document.removeEventListener("mousedown",this.startEit),document.removeEventListener("mousemove",this.moveLane),document.removeEventListener("mouseup",this.dropLane)}},c=d,u=n(0),p=Object(u["a"])(c,i,o,!1,null,null,null);e["a"]=p.exports},611:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("img",{key:t.node.id,ref:"flowImg",style:{width:t.toPx(t.node.imgWidth),height:t.toPx(t.node.imgHeight)},attrs:{src:t.loadNodeServer(t.node),onerror:t.loadNodeImage(t.node),"data-id":t.node.id,draggable:"false"}})},o=[],s={name:"FlowImg",inject:["$flowModel","toPx"],props:{node:{type:Object,default:function(){return{}}}},methods:{loadNodeServer:function(t){var e,n,i,o="";if([3,4].includes(null===t||void 0===t||null===(e=t.attributes)||void 0===e||null===(e=e.InLine)||void 0===e?void 0:e.Type)&&(o=!0),null!==t&&void 0!==t&&t.icons){var s,a,r,l=Array.isArray(t.icons)?t.icons:t.icons?JSON.parse(t.icons):{};if(l&&l.length>0)return"systematic"==this.$flowModel()?dsf.url.getWebPath(null===(s=l[1])||void 0===s?void 0:s.relativePath):o?dsf.url.getWebPath(null===(a=l[2])||void 0===a?void 0:a.relativePath):dsf.url.getWebPath(null===(r=l[0])||void 0===r?void 0:r.relativePath)}return null===(n=this.$refs)||void 0===n||null===(n=n.flowImg)||void 0===n||null===(i=n.setAttribute)||void 0===i||i.call(n,"src",""),""},loadNodeImage:function(t){var e,i,o="systematic"===this.$flowModel()?"_s":"",s="";[3,4].includes(null===t||void 0===t||null===(e=t.attributes)||void 0===e||null===(e=e.InLine)||void 0===e?void 0:e.Type)&&(s="_c");try{i=n(445)("./".concat(t.imgType||t.type).concat(s).concat(o,".png"))}catch(a){i=n(858)("./101".concat(s).concat(o,".png"))}return'this.src="'.concat(i,'"')}}},a=s,r=n(0),l=Object(r["a"])(a,i,o,!1,null,null,null);e["a"]=l.exports},830:function(t,e,n){t.exports=n.p+"modules/platform/img/102.png"},831:function(t,e,n){t.exports=n.p+"modules/platform/img/103.png"},832:function(t,e,n){t.exports=n.p+"modules/platform/img/104.png"},833:function(t,e,n){t.exports=n.p+"modules/platform/img/105.png"},834:function(t,e,n){t.exports=n.p+"modules/platform/img/106.png"},835:function(t,e,n){t.exports=n.p+"modules/platform/img/107.png"},836:function(t,e,n){t.exports=n.p+"modules/platform/img/108.png"},837:function(t,e,n){t.exports=n.p+"modules/platform/img/109.png"},838:function(t,e,n){t.exports=n.p+"modules/platform/img/201.png"},839:function(t,e,n){t.exports=n.p+"modules/platform/img/202.png"},840:function(t,e,n){t.exports=n.p+"modules/platform/img/203.png"},841:function(t,e,n){t.exports=n.p+"modules/platform/img/204.png"},842:function(t,e,n){t.exports=n.p+"modules/platform/img/299.png"},843:function(t,e,n){t.exports=n.p+"modules/platform/img/301.png"},844:function(t,e,n){t.exports=n.p+"modules/platform/img/302.png"},845:function(t,e,n){t.exports=n.p+"modules/platform/img/401.png"},846:function(t,e,n){t.exports=n.p+"modules/platform/img/402.png"},847:function(t,e,n){t.exports=n.p+"modules/platform/img/403.png"},848:function(t,e,n){t.exports=n.p+"modules/platform/img/bgs.png"},849:function(t,e,n){t.exports=n.p+"modules/platform/img/bgs1.png"},850:function(t,e,n){t.exports=n.p+"modules/platform/img/bm.png"},851:function(t,e,n){t.exports=n.p+"modules/platform/img/event-abnormal.png"},852:function(t,e,n){t.exports=n.p+"modules/platform/img/event-end.png"},853:function(t,e,n){t.exports=n.p+"modules/platform/img/event-start.png"},854:function(t,e,n){t.exports=n.p+"modules/platform/img/event-timing.png"},855:function(t,e,n){t.exports=n.p+"modules/platform/img/mark.png"},856:function(t,e,n){t.exports=n.p+"modules/platform/img/risk.png"},857:function(t,e,n){t.exports=n.p+"modules/platform/img/ry.png"},858:function(t,e,n){var i={"./101.png":597,"./101_c.png":598,"./101_c_s.png":416,"./101_s.png":417};function o(t){var e=s(t);return n(e)}function s(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}o.keys=function(){return Object.keys(i)},o.resolve=s,t.exports=o,o.id=858},957:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dsf-designer-frame",{ref:"designerPanel",staticClass:"ds_workflow",class:t.flowModel,attrs:{id:"designer"},scopedSlots:t._u([{key:"top",fn:function(){return[n("div",{staticClass:"designer_tools_left"},[!t.tpl&&t.hasPermissions("1")?n("a",{staticClass:"ds-button--icon-text",on:{click:t.doSave}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[t._v("保存")])]):t._e(),t.tpl?t._e():n("a",{staticClass:"ds-button--icon-text",on:{click:function(e){return t.printImage()}}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[t._v("导出图片")])]),t.tpl?n("a",{staticClass:"ds-button--icon-text",on:{click:t.saveTem}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[t._v("保存模板")])]):t._e(),t.hasPermissions("9")?n("a",{staticClass:"ds-button--icon-text",on:{click:t.openComSelect}},[n("i",{staticClass:"iconfont icon-shebeiguanli"}),n("span",[t._v("环节选择")])]):t._e(),t.hasPermissions("2")?n("a",{staticClass:"ds-button--icon-text",on:{click:function(e){return t.chooseTem(!0)}}},[n("i",{staticClass:"iconfont icon-shebeikaifa1"}),n("span",[t._v("模板选择")])]):t._e(),n("a",{staticClass:"ds-button--icon-text",class:{selected:t.isDrawLine},on:{click:t.drawLine}},[n("i",{staticClass:"iconfont icon-liujisuan"}),n("span",[t._v("连线")])]),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),n("span",[t._v(" 泳道 "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(e){return t.addLane("vertical")}}},[n("span",[t._v("泳道(垂直)")])]),n("dd",{on:{click:function(e){return t.addLane("horizontal")}}},[n("span",[t._v("泳道(水平)")])])])]),n("a",{staticClass:"ds-button--icon-text scale"},[n("div",{staticClass:"scale-com"},[n("i",{staticClass:"el-icon-minus",class:{disabled:t.scale<=.4},on:{click:function(e){return t.rootScale("down")}}}),n("span",{staticClass:"percent"},[t._v(t._s(Math.round(100*t.scale))+"%")]),n("i",{staticClass:"el-icon-plus",class:{disabled:t.scale>=2},on:{click:function(e){return t.rootScale("up")}}})]),n("span",[t._v("缩放")])]),t.selectedList&&t.selectedList.length>1?n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),n("span",[t._v(" 对齐方式 "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},t._l(t.alignments,(function(e,i){return n("dd",{key:i,on:{click:function(n){return t.alignment(e.pos)}}},[n("span",[t._v(t._s(e.text))])])})),0)]):t._e(),t.hasPermissions("10")?n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),n("span",[t._v(" "+t._s("normal"===t.flowModel?"标准模式":"体系化模式")+" "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(e){return t.setFlowModel("normal")}}},[n("span",[t._v("标准模式")])]),n("dd",{on:{click:function(e){return t.setFlowModel("systematic")}}},[n("span",[t._v("体系化模式")])])])]):t._e(),!t.tpl&&t.hasPermissions("5")?n("a",{staticClass:"ds-button--icon-text",on:{click:t.saveToBusiness}},[n("i",{staticClass:"iconfont icon-biaodanzujian-xialakuang"}),n("span",[t._v("保存业务组件")])]):t._e(),n("a",{staticClass:"ds-button--icon-text",on:{click:function(e){return t.unReDo(e,90)}}},[n("i",{staticClass:"iconfont icon-cancel"}),n("span",[t._v("撤销")])]),n("a",{staticClass:"ds-button--icon-text",on:{click:function(e){return t.unReDo(e,89)}}},[n("i",{staticClass:"iconfont icon-cancel",staticStyle:{transform:"rotateY(180deg)"}}),n("span",[t._v("前进")])]),t.hasPermissions("8")?n("a",{staticClass:"ds-button--icon-text",on:{click:t.openPageDoc}},[n("i",{staticClass:"iconfont icon-DOC"}),n("span",[t._v("页面文档")])]):t._e(),t.tpl?t._e():n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),n("span",[t._v(" 更多 "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},[n("p",{staticClass:"title"},[n("span",[t._v("导出")])]),n("p",{staticClass:"label child",on:{click:function(e){return t.exportFlowJson()}}},[t._v("JSON")]),n("p",{staticClass:"title"},[n("span",[t._v("导入")])]),n("p",{staticClass:"label child"},[n("el-upload",{attrs:{action:"",accept:".json","show-file-list":!1,"on-change":t.uploadJson,"auto-upload":!1}},[n("span",{attrs:{slot:"trigger"},slot:"trigger"},[t._v("JSON")])])],1),n("dd",{on:{click:function(e){t.showZoneControl=!t.showZoneControl}}},[n("span",[t._v("区域控制")])])])])]),n("div",{staticClass:"designer_tools_right"})]},proxy:!0},{key:"left",fn:function(){return[n("dsf-designer-left",[n("dsf-designer-left-item",{attrs:{icon:"icon-buju",title:"组件","head-title":"组件库"}},[n("div",{staticClass:"designer-left-tools"},[n("el-tabs",{attrs:{stretch:""},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.leftTabs,(function(e,i){return n("el-tab-pane",{key:i,attrs:{label:e.subTypeName,name:e.subType+""}},["0"!=e.auth?n("LeftTools",{attrs:{tools:e.data}}):t._e()],1)})),1)],1)])],1)]},proxy:!0},{key:"right",fn:function(){return[n("dsf-designer-right",[n("dsf-designer-right-item",{attrs:{icon:"icon-gongnengdingyi",title:"属性"}},[n("flow-info",{class:{"has-zone-control":t.showZoneControl},attrs:{checked:t.checked,nodes:t.nodes}}),t.showZoneControl?n("ZoneControl"):t._e()],1)],1)]},proxy:!0},{key:"append",fn:function(){return[n("dsf-page-doc")]},proxy:!0}])},[[n("div",{ref:"ds_page",staticClass:"ds_page design",on:{scroll:function(e){return t.onScroll(e)}}},[n("div",{ref:"container",staticClass:"flow",class:{"is-print-image":t.isPrintImage},style:{width:t.toPx(t.scale>1?t.width*t.scale:t.width/t.scale),height:t.toPx(t.scale>1?t.height*t.scale:t.height/t.scale),transform:"scale("+t.scale+") translateZ(0)",transformOrigin:"left top"}},[n("div",{ref:"root",staticClass:"root",class:{has_v_head:t.lanes&&t.lanes.vertical.length>0,has_h_head:t.lanes&&t.lanes.horizontal.length>0},style:{width:t.toPx(t.scale>1?t.width*t.scale:t.width/t.scale),height:t.toPx(t.scale>1?t.height*t.scale:t.height/t.scale)}},[t.baseLine.showV?n("span",{staticClass:"baseLine_v",style:{transform:"translate3d("+t.baseLine.left+"px, 0, 0)"}}):t._e(),t.baseLine.showH?n("span",{staticClass:"baseLine_h",style:{transform:"translate3d(0, "+t.baseLine.top+"px, 0)"}}):t._e(),n("flow-content",{ref:"flowContent",attrs:{"is-draw-line":t.isDrawLine,lines:t.lines,nodes:t.nodes,events:t.events,checked:t.checked}}),n("div",{ref:"backLayout",staticClass:"backgroundLayout"},[n("div",{ref:"v_lane",staticClass:"v_lane"},[n("lanes",{attrs:{lanes:t.lanes&&t.lanes.vertical,checked:t.checked},on:{addLane:t.addLane}})],1),n("div",{ref:"h_lane",staticClass:"h_lane"},[n("lanes",{attrs:{lanes:t.lanes&&t.lanes.horizontal,checked:t.checked},on:{addLane:t.addLane}})],1)])],1)])])]],2)},o=[],s=n(2),a=n.n(s),r=n(4),l=n.n(r),h=n(3),d=n.n(h),c=n(1),u=n.n(c),p=n(9),f=n.n(p);function y(){var t,e,n=this.getXMLStr(),i=new Blob([n],{type:"text/xml;charset=UTF-8",encoding:"UTF-8"}),o=document.createElement("a"),s=window.URL.createObjectURL(i);o.href=s,o.download=null!==(t=null===(e=this.flowInfo)||void 0===e||null===(e=e.BaseInfo)||void 0===e?void 0:e.Name)&&void 0!==t?t:"流程",o.click()}function g(t,e){var n=this,i=new FileReader;dsf.layer.confirm({title:"",message:"导入后模式会切换为导入文件的模式，确认导入吗？"}).then((function(){i.onload=function(t){var e=JSON.parse(t.target.result);null!==e&&void 0!==e&&e.WorkFlow?n.reloadElement(e):dsf.layer.message("导入数据不满足要求",!1)},i.readAsText(t.raw)})).catch((function(){}))}function x(){var t,e,n,i,o=this.getSaveData();o=_.cloneDeep(o);var s={201:0,101:1,299:2,302:3,102:4};o.WorkFlow.BaseInfo.Vendor.APP={ID:"",Name:null!==(t=this.$route.query.sAPPName)&&void 0!==t?t:"",Desc:"",ModuleID:null!==(e=this.$route.query.sModuleID)&&void 0!==e?e:""},null===(n=o)||void 0===n||null===(n=n.WorkFlow)||void 0===n||null===(n=n.NodeList)||void 0===n||n.forEach((function(t){var e,n;t.BaseInfo.Type=null!==(e=s[t.BaseInfo.Type])&&void 0!==e?e:t.BaseInfo.Type,Object.assign(t,t.BaseInfo),t.InLine&&Object.assign(t.InLine,{Require:"",IsSpecialSend:"",Multiplayer:{IsEnabled:"",SendMode:"",Poior:""},ExAction:"",SendBackAction:"",BanSendBack:""}),null!==t&&void 0!==t&&null!==(n=t.InLine)&&void 0!==n&&null!==(n=n.RangeRule)&&void 0!==n&&n.Rule&&(t.InLine.RangeRule.RuleList=t.InLine.RangeRule.Rule,t.InLine.RangeRule.RuleList.forEach((function(t){var e,n,i,o;(t.RangeType=t.Type,t.Range=t.name,21==t.Type)&&(t.IsDeep=null!==(e=t.IsDeep)&&void 0!==e?e:"",t.IsShowDeptUser="");22==t.Type&&(t.NodeRowIndex="",t.desc="",t.IsDeep=null!==(n=t.IsDeep)&&void 0!==n?n:"",t.IsShowDeptUser="");(23==t.Type&&(t.Script="1",t.Sql=t.exp,t.SuperType="6"),31==t.Type&&(t.IsShowDeptUser=""),32==t.Type)&&(t.NodeRowIndex="",t.desc="",t.IsDeep=null!==(i=t.IsDeep)&&void 0!==i?i:"",t.IsShowDeptUser="",t.Level=1,t.level=1);33==t.Type&&(t.IsDeep=null!==(o=t.IsDeep)&&void 0!==o?o:"",t.IsShowDeptUser="",t.Script="1",t.Sql=t.exp,t.SuperType="6");41==t.Type&&(t.desc="",t.level="1"),42==t.Type&&(t.Script="1",t.Sql=t.exp,t.SuperType="6"),delete t.id,delete t.IsUser,delete t.name,delete t.Type})),delete t.InLine.RangeRule.Rule),t.OutLine&&Object.assign(t.OutLine,{SendConditions:"",PreAction:""}),delete t.BaseInfo})),null===(i=o)||void 0===i||null===(i=i.WorkFlow)||void 0===i||null===(i=i.LineList)||void 0===i||i.forEach((function(t){Object.assign(t,{Alias:"",Desc:"",SendParameter:{IsAutoSend:"",ShowOrder:"",IsInheritDept:"",IsBackTrack:"",Multiplayer:{SendMode:""},ExAction:"",SendBackAction:"",IsRemind:"",RemindContent:""}},t.BaseInfo),delete t.BaseInfo})),o.WorkFlow.Corridor={CorridorList:o.WorkFlow.LaneList.horizontal,StageList:o.WorkFlow.LaneList.vertical},delete o.WorkFlow.LaneList;var a=this.dataToXML(o);return a}function v(t,e){var n=this,i="";if(_.isArray(t)){var o=(null===e||void 0===e?void 0:e.indexOf("List"))>-1,s=e.replace("List","");t.forEach((function(e,a){o?i+="<".concat(s,">").concat(n.dataToXML(e),"</").concat(s,">"):(i+="".concat(n.dataToXML(e)),a<t.length-1&&(i+="</".concat(s,">")),a<t.length-1&&(i+="<".concat(s,">")))}))}else{if(!_.isObject(t))return t;Object.keys(t).forEach((function(e){"sImgData"!==e&&(i+="<".concat(e,">").concat(n.dataToXML(t[e],e),"</").concat(e,">"))}))}return i}function m(){var t=this.getSaveData(),e=this.flowInfo.BaseInfo.Name;t=JSON.stringify(t,void 0,2);var n=new Blob([t],{type:"text/json"}),i=document.createElement("a");i.download=e+".json",i.href=window.URL.createObjectURL(n),this.$nextTick((function(){i.click()}))}function b(t,e){var n=this;t.forEach((function(t){t.point.x=e,n.$bus.$emit("nodeMove",t)}))}function w(t,e){var n=this;t.forEach((function(t){t.point.x=e-t.width,n.$bus.$emit("nodeMove",t)}))}function O(t,e){var n=this;t.forEach((function(t){t.point.y=e,n.$bus.$emit("nodeMove",t)}))}function N(t,e){var n=this;t.forEach((function(t){t.point.y=e-t.height,n.$bus.$emit("nodeMove",t)}))}function L(t,e){var n=this;t.forEach((function(t){t.point.y=e-t.height/2,n.$bus.$emit("nodeMove",t)}))}function k(t,e){var n=this;t.forEach((function(t){t.point.x=e-t.width/2,n.$bus.$emit("nodeMove",t)}))}function I(t){var e=this,n=t.sort((function(t,e){return t.point.x-e.point.x})),i=[];n.reduce((function(t,e){var n=e.point.x-(t.point.x+t.width);return i.push(n),e}));var o=i.reduce((function(t,e){return t+e}))/i.length;n.forEach((function(t,i){0!==i&&i!==n.length-1&&(t.point.x=n[i-1].point.x+n[i-1].width+o,e.$bus.$emit("nodeMove",t))}))}function P(t){var e=this,n=t.sort((function(t,e){return t.point.y-e.point.y})),i=[];n.reduce((function(t,e){var n=e.point.y-(t.point.y+t.height);return i.push(n),e}));var o=i.reduce((function(t,e){return t+e}))/i.length;n.forEach((function(t,i){0!==i&&i!==n.length-1&&(t.point.y=n[i-1].point.y+n[i-1].height+o,e.$bus.$emit("nodeMove",t))}))}function $(t){var e=this.$store.state.flow.selectedList,n=0,i=0,o=0,s=0,a=0,r=0;switch(e.forEach((function(t,e){var a=t.width,r=t.height,l=t.point,h=l.x,d=l.y;0===e&&(n=d,s=h,i=h+a,o=d+r),s>h&&(s=h),n>d&&(n=d),i<h+a&&(i=h+a),o<d+r&&(o=d+r)})),a=(n+o)/2,r=(s+i)/2,t){case"left":this.alignLeft(e,s);break;case"top":this.alignTop(e,n);break;case"right":this.alignRight(e,i);break;case"bottom":this.alignBottom(e,o);break;case"middle":this.alignMiddle(e,a);break;case"center":this.alignCenter(e,r);break;case"horizontal":this.alignHorizontal(e);break;case"vertical":this.alignVertical(e);break}}function j(){this.$eventBus.$emit("showComponentDoc",{id:null})}function D(){var t=this,e={nodes:this.nodes,value:[]},n=this,i=function(t,e){var i=[];t.forEach((function(t){var n;i.push({code:t.type,name:t.name,version:"5.0",origin:"flow",terminalValue:"0",terminalText:"pc",authors:"",groupId:e.id,content:JSON.stringify(t),md:"",icons:(null===(n=t.icons)||void 0===n?void 0:n.length)>0?JSON.stringify(t.icons):""})})),n.$http.post("component/saveBC",{bcStrs:JSON.stringify(i),type:3}).done((function(t){t.success?dsf.layer.message("保存成功"):dsf.layer.message("保存失败",!1)}))},o=function(t,e){if(t.length>0){var n=JSON.parse(JSON.stringify(e)).filter((function(e){return e.in=[],e.out=[],t.indexOf(e.id)>-1}));return dsf.layer.openDialog({title:"保存到",width:"500px",height:"500px",overflow:"auto",content:"FlowBusiness",params:{ids:t},btns:[{text:"确定",handler:function(){var t=l()(u.a.mark((function t(e){var o;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=e.yes(),!o){t.next=4;break}return i(n,o),t.abrupt("return",!0);case 4:return t.abrupt("return",!1);case 5:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{text:"取消"}]}),!0}};dsf.layer.openDialog({title:"组件选择",width:"800px",height:"400px",overflow:"auto",content:"SumStartNode",params:e,btns:[{text:"确定",handler:function(){var e=l()(u.a.mark((function e(n){var i;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=n.getContent(),e.abrupt("return",o(i,t.nodes));case 2:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()},{text:"取消"}]})}function S(t,e,n){var i=t.strIds.join(","),o=t.terminal,s=t.type;if(i.length>0)return dsf.http.get("component/findComponents",{strIds:i,terminal:o,type:s},e,n).then((function(t){var e=t.data;return e}))}function T(){var t=this;dsf.layer.openDialog({title:"选择环节",fullscreen:!1,content:"FlowSelectNodes",width:"500px",params:{code:this.selectTemplatesCode||""},btns:[{text:"确定",handler:function(e){var n=e.yes();if(null!==n&&void 0!==n&&n.data){var i,o=null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.map((function(t){return t._id}));return 4!=n.type?S({strIds:o,terminal:"pc",type:n.type}).then((function(e){if(e.success){var i,o={};return null===(i=e.data)||void 0===i||i.forEach((function(t){var e;null===t||void 0===t||null===(e=t.components)||void 0===e||e.forEach((function(t){t.type=t.code})),o[t.id]=t})),void t.leftTabs.forEach((function(e){if(e.subType===n.type+1){for(var i=e.data.length,s=0;s<i;s++){var a=e.data[s];o[a.id]&&(t.$set(e.data,s,o[a.id]),delete o[a.id])}e.data=e.data.concat(Object.values(o))}}))}})):t.$http.get("intellect/robot/findRobotComponents",{strIds:o}).done((function(e){if(e.success){var n,i={};null===(n=e.data)||void 0===n||n.forEach((function(t){i[t.id]=t})),t.leftTabs.forEach((function(e){if(3===e.subType){for(var n=e.data.length,o=0;o<n;o++){var s=e.data[o];i[s.id]&&(t.$set(e.data,o,i[s.id]),delete i[s.id])}e.data=e.data.concat(Object.values(i))}}))}})),!0}return!1}},{text:"取消"}]})}function E(t){var e=this;dsf.layer.confirm({title:"提示",message:"确定删除改环节组吗？"}).then((function(){var n=e.flowTools.indexOf(t);e.flowTools.splice(n,1)})).catch((function(){}))}function C(){var t=this.getSaveData(),e={type:3,layout:JSON.stringify(t),pageName:this.$route.query.pname,namespace:this.$route.query.B+"."+this.$route.query.M};this.$http.post("template/saveTemp",e).done((function(t){t.success?dsf.layer.message("保存成功",!0):dsf.layer.message("保存失败",!1)})).error((function(){dsf.layer.message("保存失败",!1)}))}function M(t,e){return e.has(t)||e.set(t,dsf.uuid(32)),e.get(t)}function B(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map,n=arguments.length>2?arguments[2]:void 0;if("object"!==f()(t)||!t)return["out","in"].includes(n)?M(t,e):t;if(Array.isArray(t))return t.map((function(t){return B(t,e,n)}));for(var i in t)["ID","id","from","to","StartNodeID","EndNodeID"].includes(i)?t[i]=M(t[i],e):"ccNodes"!=n?"RangeRule"!=n&&(t[i]=B(t[i],e,i)):t=d()({},M(i,e),M(t[i],e));return t}function R(t){var e=this,n=[{text:"确定",handler:function(){var t=l()(u.a.mark((function t(n){var i,o,s,a;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=n.yes(),!_.isNull(i)){t.next=6;break}return dsf.layer.message("请选择一个模板",!1),t.abrupt("return",!1);case 6:e.templateId=i.code,e.selectTemplatesCode=i.code,e.selectTemplateId=i.id,o=i.path.split("/"),s=o.pop(),a=o.join("."),e.$http.get("/pc/wftemp/".concat(a,"/").concat(s,".json"),{}).done((function(t){e.initPermissions(i.id).then((function(){t&&e.reloadElement(B(t))}))})).catch((function(t){dsf.error(t),dsf.layer.message("未找到模板文件或者读取模板文件失败",!1)}));case 13:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()}];t&&n.push({text:"取消"}),dsf.layer.openDialog({title:"选择流程模板",fullscreen:!1,content:"DesUseLayoutTpl",showClose:!1,params:{defaultCheckedKey:this.selectTemplateId?[this.selectTemplateId]:[],isMobile:!1,templateType:"3",fileType:13,selectModel:"explorer"},width:"900px",height:"550px",btns:n})}function z(t){this.$store.commit("flow/clearLanes");for(var e=0;e<this.events.length;e++)this.deleteEvent(this.events[e].id,this.events),e--;for(var n=0;n<this.lines.length;n++)this.deleteLine(this.lines[n]),n--;for(var i=0;i<this.nodes.length;i++)this.deleteNode(this.nodes[i]),i--;this.initData(t),this.flowInfo.BaseInfo.ID=this.$route.query.id}var A={exportXML:y,uploadJson:g,getXMLStr:x,dataToXML:v,exportFlowJson:m,alignment:$,alignLeft:b,alignRight:w,alignTop:O,alignBottom:N,alignMiddle:L,alignCenter:k,alignHorizontal:I,alignVertical:P,openPageDoc:j,saveToBusiness:D,openComSelect:T,removeTool:E,saveTem:C,chooseTem:R,reloadElement:z},F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flow-left-tools"},[i("div",{staticClass:"design-search-box"},[i("form",{attrs:{action:""},on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.search.apply(null,arguments)}}},[i("el-input",{staticClass:"design-search-input",staticStyle:{height:"30px","line-height":"30px"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.search},slot:"append"})],1)],1)]),i("dsf-virtual-scroll",{staticStyle:{height:"calc(100% - 40px)"}},[i("el-collapse",{attrs:{accordion:""},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.realTools,(function(e,o){return i("el-collapse-item",{key:o,attrs:{name:o}},[i("template",{slot:"title"},[i("div",{staticClass:"ellipsis",staticStyle:{"font-size":"14px"},attrs:{title:e.name}},[t._v(" "+t._s(e.name)+" ")]),i("DsfIcon",{staticStyle:{position:"absolute",right:"30px"},attrs:{name:"guanbi2"},on:{click:function(n){return n.stopPropagation(),t.removeTool(e)}}})],1),i("div",{staticClass:"layui-colla-content layui-show"},[t._l(e.components,(function(e){return[t.show(e)?i("div",{key:e.id,staticClass:"nodeButton ds_tool_item",attrs:{title:e.name,nodetype:e.type,draggable:"true"},on:{dragstart:function(n){return t.dragTool(n,e)}}},[i("FlowImg",{attrs:{node:e}}),t._v(" "+t._s(e.name)+" ")],1):i("div",{key:e.type,staticClass:"nodeButton ds_tool_event",attrs:{title:e.name,nodetype:e.type}},[i("div",{staticClass:"tool_event_drag",attrs:{draggable:"true"},on:{dragstart:function(n){return t.dragEvents(n,e)}}},[i("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:n(445)("./"+e.type+".png"),draggable:"false"}})]),i("span",{staticClass:"event-name"},[t._v(t._s(e.name))])])]})),i("div",{staticStyle:{clear:"both"}})],2)],2)})),1)],1)],1)},W=[],H=n(611),X={name:"LeftTools",components:{FlowImg:H["a"]},props:{tools:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:[0],searchInput:"",realTools:[]}},watch:{tools:function(t){this.realTools=t}},methods:{show:function(t){return"401"!=t.type&&"402"!=t.type&&"403"!=t.type&&"mark"!=t.type&&"risk"!=t.type},removeTool:function(t){var e=this;dsf.layer.confirm({title:"提示",message:"确定删除改环节组吗？"}).then((function(){var n=e.tools.indexOf(t);e.tools.splice(n,1)})).catch((function(){}))},dragTool:function(t,e){var n;null===t||void 0===t||null===(n=t.dataTransfer)||void 0===n||n.setData("__"," "),this.$bus.$emit("dragNode",t,JSON.parse(JSON.stringify(e)))},dragEvents:function(t,e){var n;null===t||void 0===t||null===(n=t.dataTransfer)||void 0===n||n.setData("__"," "),e.id="",this.$bus.$emit("dragEvents",t,JSON.parse(JSON.stringify(e)))},search:function(){var t=this,e=JSON.parse(JSON.stringify(this.tools));this.realTools=e.filter((function(e){return e.components=e.components.filter((function(e){return e.name.indexOf(t.searchInput)>-1})),e.components.length>0}))}}},Y=X,V=n(0),U=Object(V["a"])(Y,F,W,!1,null,null,null),G=U.exports,J=n(409),q=n(460),Z=n(410),K=n(418),Q=n(603),tt=n(601),et=n(393),nt=n(392),it=n(604),ot=n(411),st=n(461),at=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"zone",staticClass:"zone-control",on:{dragover:t.move,dragend:t.zoneDragEnd}},[n("div",{staticClass:"title"},[n("span",[t._v("区域控制")]),n("div",{staticClass:"scale-com"},[n("i",{staticClass:"el-icon-minus",class:{disabled:t.scale<=.4},on:{click:function(e){return t.rootScale("down")}}}),n("span",{staticClass:"percent"},[t._v(t._s(Math.round(100*t.scale))+"%")]),n("i",{staticClass:"el-icon-plus",class:{disabled:t.scale>=2},on:{click:function(e){return t.rootScale("up")}}})])]),n("div",{ref:"content",staticClass:"content"},[n("img",{directives:[{name:"show",rawName:"v-show",value:t.zoomImg.url,expression:"zoomImg.url"}],staticClass:"zoom-img",style:{width:t.zoomImg.width,height:t.zoomImg.height},attrs:{draggable:"false",src:t.zoomImg.url,alt:""},on:{load:function(e){return t.init(e)}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.zoomImg.url,expression:"zoomImg.url"}],staticClass:"minimap",style:{width:t.minimap.width,height:t.minimap.height,top:t.minimap.top,left:t.minimap.left,transform:this.getTransform},attrs:{draggable:t.draggable},on:{dragstart:function(e){return t.drag(e)}}},[n("div",{staticClass:"zoom",on:{mousedown:function(e){return t.startZoom(e)}}})])])])},rt=[];function lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(n),!0).forEach((function(e){d()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var dt={name:"ZoneControl",inject:["$designer"],props:{},data:function(){return{draggable:!0,zoomOffset:{top:0,left:0},offset:{x:0,y:0},contentPos:{x:0,y:0},realPos:{x:0,y:0},zoomPos:{x:0,y:0},isStartMove:!1,isStartZoom:!1,zoomImg:{url:"",width:"100%",height:"auto",realWidth:0,realHeight:0},minimap:{width:"230px",height:"144px",top:0,left:"9px"},first:!1}},computed:ht(ht({},Vuex.mapState({scale:function(t){return t.flow.page.scale}})),{},{getTransform:function(){return"scale(".concat(this.getScale,") translate(").concat(this.realPos.x,"px, ").concat(this.realPos.y,"px)")},getScale:function(){var t=1;return t=(this.scale,2-this.scale),t},flowWidth:function(){return this.scale>1?this.$designer.width*this.scale:this.$designer.width/this.scale},flowHeight:function(){return this.scale>1?this.$designer.height*this.scale:this.$designer.height/this.scale}}),mounted:function(){var t=this;this.$nextTick((function(){t.generateImg()})),this.initEvents();var e=this.$refs.content.getBoundingClientRect();this.contentPos={x:e.left,y:e.top}},methods:{initEvents:function(){var t=this;document.addEventListener("mousemove",this.zoom),document.addEventListener("mouseup",this.endZoom),this.$bus.$on(["isMoveNode","startMoveAll"],this.moveFlowEnd),this.$bus.$on("pageScroll",this.pageScroll),this.$once("hook:beforeDestroy",(function(){document.removeEventListener("mousemove",t.zoom),document.removeEventListener("mouseup",t.endZoom),t.$bus.$off(["isMoveNode","startMoveAll"],t.moveFlowEnd),t.$bus.$off("pageScroll",t.pageScroll)}))},init:function(t){var e,n,i,o,s=this.$designer.$refs.ds_page,a=s.clientWidth,r=s.clientHeight,l=t.target.width,h=t.target.height;if(this.zoomImg.realWidth=l,this.zoomImg.realHeight=h,this.flowWidth<=a&&this.flowHeight<=r)if(l>=h){var d=(260-h-2)/2;this.minimap={width:"230px",height:h+"px",top:d+"px",left:"9px"}}else{var c=(250-l-2)/2;this.minimap={width:l+"px",height:"240px",top:"9px",left:c+"px"}}else this.flowWidth>a&&(e=a/this.flowWidth*l,n=r/this.flowHeight*h,l>=h?(i=(260-h-2)/2,o=9):(i=9,o=(250-l-2)/2),this.minimap={width:e+"px",height:n+"px",top:i+"px",left:o+"px"});this.zoomOffset={top:parseInt(this.minimap.top),left:parseInt(this.minimap.left)}},moveFlowEnd:function(t){var e=this;t||setTimeout((function(){e.generateImg()}),200)},generateImg:function(){var t=this;return l()(u.a.mark((function e(){var n,i,o;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$designer.html2canvas();case 2:n=e.sent,t.zoomImg.url=n,i=t.scale>1?t.$designer.width*t.scale:t.$designer.width/t.scale,o=t.scale>1?t.$designer.height*t.scale:t.$designer.height/t.scale,i>=o?Object.assign(t.zoomImg,{width:"100%",height:"auto"}):Object.assign(t.zoomImg,{width:"auto",height:"100%"});case 7:case"end":return e.stop()}}),e)})))()},rootScale:function(t){this.$designer.rootScale(t)},drag:function(t){"dragstart"===t.type?t=event||t:event.touches&&(t=event.touches[0]?event.touches[0]:event),Object(et["a"])(t),this.draggable&&(this.offset={x:t.offsetX,y:t.offsetY},this.isStartMove=!0)},startZoom:function(t){t.preventDefault(),this.isStartZoom=!0,this.draggable=!1,this.$refs.content.style.cursor="nwse-resize",this.first||(this.zoomPos={x:t.pageX,y:t.pageY},this.first=!0)},zoom:function(t){if(this.isStartZoom){var e={x:t.pageX,y:t.pageY},n={x:e.x-this.zoomPos.x,y:e.y-this.zoomPos.y},i=parseInt(this.minimap.width),o=parseInt(this.minimap.height),s=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),a=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)),r=5*Math.ceil(parseInt(a/s*100)/5)/100,l=1;l=n.x<0&&n.y<0?1+r>2?2:1+r:1-r<.4?.4:1-r,this.$store.commit("flow/setPage",{scale:l})}},endZoom:function(t){this.draggable=!0,this.isStartZoom=!1,this.$refs.content.style.cursor="default"},move:function(t){if(t.preventDefault(),this.isStartMove){var e={x:t.pageX-this.contentPos.x-this.zoomOffset.left,y:t.pageY-this.contentPos.y-this.zoomOffset.top},n={x:e.x-this.offset.x*(2-this.scale)<0?0:e.x-this.offset.x*(2-this.scale),y:e.y-this.offset.y*(2-this.scale)<0?0:e.y-this.offset.y*(2-this.scale)};this.realPos={x:n.x/(2-this.scale),y:n.y/(2-this.scale)};var i=this.$designer.$refs.ds_page;i.scrollLeft=this.realPos.x/this.zoomImg.realWidth*this.flowWidth,i.scrollTop=this.realPos.y/this.zoomImg.realHeight*this.flowHeight}},zoneDragEnd:function(t){this.draggable=!0,this.isStartMove=!1,this.isStartZoom=!1},pageScroll:function(t){if(!this.isStartMove){var e=t.scrollTop,n=t.scrollLeft,i=parseInt(n/this.flowWidth*(this.zoomImg.realWidth+10)),o=parseInt(e/this.flowHeight*(this.zoomImg.realHeight+10));this.realPos={x:i,y:o}}}}},ct=dt,ut=Object(V["a"])(ct,at,rt,!1,null,null,null),pt=ut.exports;function ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ft(Object(n),!0).forEach((function(e){d()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var gt={name:"Flow",components:{LeftTools:G,FlowInfo:Q["a"],FlowContent:tt["a"],Lanes:it["a"],ZoneControl:pt},props:{showAuxiliaryController:{type:Boolean,default:!0}},data:function(){return{activeNames:[0],isDrawLine:!1,dragNode:null,dragEvent:null,dragAttach:null,endTarget:null,width:0,height:0,maxWidth:0,maxHeight:0,flow:null,flowInfo:null,sID:this.$route.query&&this.$route.query.id,nodes:[],lines:[],events:[],distance:30,cloneObj:null,crashNode:null,dragSize:20,maxSizeOffset:50,boundaryEvents:ot["d"],attached:ot["c"],checked:null,baseLine:{show:"",top:0,left:0},showLineV:!1,showLineH:!1,isGlobalPosMove:!1,globalPos:null,globalMoveLastMouse:null,globalRect:null,isGlobalSelect:!1,selectGlobalPos:null,selectGlobalPonits:{start:{x:0,y:0},end:{x:0,y:0}},globalSelect:null,isCtrlKey:!1,ctrlCopyIndex:1,isCopyNodes:!1,copyNodesPos:null,copyNodes:[],hasMoved:!1,isPrintImage:!1,printImageUrl:"",status:"3",searchInput:"",pageDocument:"",tpl:!1,templateId:"",leftTabs:[],btnPermissions:[],selectTemplateId:"",selectTemplatesCode:this.$route.query.path?decodeURIComponent(this.$route.query.path):"",showZoneControl:!1,alignments:nt["e"],pagePoint:{pageX:0,pageY:0},auxiliary:!1,undoRedoStack:[],undoRedoIndex:0,undoRedoSize:100}},provide:function(){var t=this;return{$designer:this,$flowModel:function(){return t.flowModel},$nodes:function(){return t.nodes},$lines:function(){return t.lines},$checked:function(){return t.checked},getObjById:et["e"],getProperties:et["i"],toPx:et["l"],$preData:function(){return[]},isPreview:!1}},computed:yt({},Vuex.mapState({page:function(t){return t.flow.page},scale:function(t){return t.flow.page.scale},lanes:function(t){return t.flow.lanes},selectedList:function(t){return t.flow.selectedList},flowModel:function(t){return t.flow.flowModel}})),created:function(){this.tpl=!this.sID},mounted:function(){this.reset(),this.init()},methods:yt(yt({loadScript:et["k"],toPx:et["l"],verifySub:et["m"],recordUndoData:function(){var t=this;return l()(u.a.mark((function e(){var n,i,o,s;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(t,e){setTimeout((function(){t()}),500)}));case 2:for(n=["lanes","nodes","events","lines"],i=[],o=0;o<n.length;o++)s=n[o],i.push({type:s,data:_.cloneDeep(t[s])});t.undoRedoStack.length>t.undoRedoSize&&t.undoRedoStack.splice(0,1),t.undoRedoStack.splice(t.undoRedoIndex+1,1/0,i),t.undoRedoIndex=t.undoRedoStack.length-1;case 8:case"end":return e.stop()}}),e)})))()},unReDo:function(t,e){var n=this;if(t.ctrlKey||t.metaKey||e)if("89"==t.keyCode||89==e){var i=this.undoRedoIndex+1,o=this.undoRedoStack[i];o?(_.forEach(o,(function(t){var e=t.type,i=t.data;n.resetFlowData(e,_.cloneDeep(i),!0)})),this.undoRedoIndex=i):dsf.layer.message("已经没有可以前进的步骤了",!1)}else if("90"==t.keyCode||90==e){var s=this.undoRedoIndex-1;if(s>=0){var a=this.undoRedoStack[s];_.forEach(a,(function(t){var e=t.type,i=t.data;n.resetFlowData(e,_.cloneDeep(i),!1)})),this.undoRedoIndex=s}else dsf.layer.message("已经没有可以回退的步骤了",!1)}},resetFlowData:function(t,e,n){var i=this;"lanes"===t?this.$store.commit("flow/resetLane",e):("lines"===t?(this.$bus.$emit("clearLines"),this.$nextTick((function(){i.$bus.$emit("reRanderLines",e)}))):"nodes"===t&&_.forEach(e,(function(t){t.lines&&(i.$bus.$emit("clearLines".concat(t.id)),i.$nextTick((function(){i.$bus.$emit("reRanderLines".concat(t.id),t.lines)})))})),this.$set(this,t,e))},reset:function(){var t=this.$refs.ds_page.getBoundingClientRect();this.$store.commit("flow/setPage",{width:t.width,height:t.height,left:t.x,top:t.y,right:window.innerWidth-t.right,bottom:window.innerHeight-t.bottom}),this.resize()},init:function(){var t=this;return l()(u.a.mark((function e(){var n,i,o;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getProperties("flow");case 2:return i=e.sent,t.flow={attributes:Object(et["c"])(i)},e.next=6,t.initPermissions();case 6:return e.next=8,Object(et["i"])("line");case 8:return e.next=10,t.getWFData();case 10:o=e.sent,o&&t.initData(o),t.sID&&0===(null===o||void 0===o||null===(n=o.WorkFlow)||void 0===n||null===(n=n.ElementList)||void 0===n?void 0:n.length)&&!o.tools&&t.chooseTem(),t.initEvent();case 14:case"end":return e.stop()}}),e)})))()},initPermissions:function(t){var e,n=this;if(this.leftTabs=[],null!==(e=this.$route)&&void 0!==e&&null!==(e=e.query)&&void 0!==e&&e.path||t){var i=decodeURIComponent(this.$route.query.path);return this.$webAPI.selectButtonsAndBusiness({type:t?0:1,id:t||i}).then((function(t){var e,i,o=t.data;return n.btnPermissions=(null===(e=o[0])||void 0===e||null===(e=e.templateInitSubPermissionsVOS)||void 0===e||null===(e=e[0])||void 0===e||null===(e=e.auth)||void 0===e?void 0:e.split("^"))||[],null===(i=o[1])||void 0===i||null===(i=i.templateInitSubPermissionsVOS)||void 0===i||i.forEach((function(t){0==t.auth||3!=t.subType&&4!=t.subType||n.leftTabs.push({auth:t.auth,subType:t.subType,subTypeName:t.subTypeName,data:[]})})),n.leftTabs.sort((function(t,e){return t.subType-e.subType})),!0}))}return this.sID||(this.leftTabs=[{auth:"1",subType:3,subTypeName:"基础环节",data:[]},{auth:"1",subType:4,subTypeName:"业务环节",data:[]}]),!0},hasPermissions:function(t){return!this.sID||this.btnPermissions.indexOf(t)>-1},initData:function(t){var e=this;return l()(u.a.mark((function n(){var i,o,s,a,r;return u.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a={BaseInfo:{ID:"",Name:e.$route.query.title,Version:"0.0.0001",TimeLimit:{Type:0,Value:0},Desc:"",signType:0,Event:{onStart:"",onClose:"",onForceClose:"",onExSend:"",onDestory:""},Vendor:{ID:"",Name:""}},NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[]},e.flowInfo=e.sID&&0===(null===t||void 0===t||null===(i=t.WorkFlow)||void 0===i||null===(i=i.ElementList)||void 0===i?void 0:i.length)&&!t.tools?a:null===t||void 0===t?void 0:t.WorkFlow,null!==(o=e.flowInfo)&&void 0!==o&&null!==(o=o.BaseInfo)&&void 0!==o&&o.Name||(e.flowInfo.BaseInfo.Name=e.$route.query.title),e.flowInfo.BaseInfo.Version||(e.flowInfo.BaseInfo.Version="0.0.0001"),Object.assign(e.flow.attributes,e.flowInfo),e.leftTabs.forEach((function(e){3===e.subType&&(e.data=(null===t||void 0===t?void 0:t.tools)||[]),4===e.subType&&(e.data=(null===t||void 0===t?void 0:t.businessTools)||[])})),e.pageDocument=(null===t||void 0===t?void 0:t.pageDocument)||"",e.templateId=e.templateId||(null===t||void 0===t?void 0:t.templateid)||"",e.selectTemplateId=e.selectTemplateId||(null===t||void 0===t?void 0:t.selectTemplateId)||"",r=(null===t||void 0===t?void 0:t.flowModel)||(null===t||void 0===t||null===(s=t.WorkFlow)||void 0===s?void 0:s.flowModel)||"normal",e.setFlowModel(r),e.loadElement();case 12:case"end":return n.stop()}}),n)})))()},getWFData:function(){var t=this;if(this.sID){var e={sID:this.sID};return Object.assign(e,this.$route.query),this.$http.get("wfm/getWFDefinition",e).done((function(t){if(t.success)return t.data;dsf.layer.message(t.message,!1)})).catch((function(){t.flowInfo={}}))}var n=this.$route.query;return this.$http.get("/pc/wftemp/".concat(n.B,".").concat(n.M,"/").concat(n.pname,".json"),{}).done((function(t){return t})).catch((function(){t.flowInfo={}}))},loadElement:function(){var t=this,e=this.flowInfo&&this.flowInfo.ElementList||[];if(e&&e.length>0)for(var n=function(){var n=e[i];if("node"==n.nodeType){var o=n;o.in=o.in||[],o.out=o.out||[],o.point.x=parseFloat(o.point.x),o.point.y=parseFloat(o.point.y),o=Object.assign({x:o.point.x,y:o.point.y},o),ot["e"].forEach((function(t){t.components.forEach((function(t){o.attributes.BaseInfo.Type==t.type&&(o.attributes.BaseInfo.Type=t.name)}))})),o.isGeneral&&(o.attributes.BaseInfo.Type="通用任务");var s=t.addNode(o,!0);if(o.nodes){var a=o.nodes;s.nodes=[],s.lines=[],s.events=[],a.forEach((function(e){e=Object.assign({x:e.point.x,y:e.point.y},e),s.nodes.push(t.addSubNode(e,s))}))}o.events&&o.events.forEach((function(t){var e=new K["a"](t);e.parentNode=o,s.events.push(e)})),o.lines&&o.lines.forEach((function(e){e.linkInfo&&(e.linkInfo.fromOffset=parseFloat(e.linkInfo.fromOffset),e.linkInfo.toOffset=parseFloat(e.linkInfo.toOffset)),e.parentNodeId=o.id,setTimeout((function(){t.$bus.$emit("addLine".concat(o.id),e)}),0)})),t.nodes.push(s)}else if("line"==n.nodeType){var r=n;r.linkInfo&&(r.linkInfo.fromOffset=parseFloat(r.linkInfo.fromOffset),r.linkInfo.toOffset=parseFloat(r.linkInfo.toOffset)),setTimeout((function(){t.$bus.$emit("addLine",r)}),0)}else if("lane"==n.nodeType){var l=n;t.createLane({id:l.id,name:l.name,size:l.size,index:l.index,direction:l.direction,attributes:l.attributes})}else"event"==n.nodeType&&t.events.push(new K["a"](n))},i=0;i<e.length;i++)n();this.resize(),this.recordUndoData()},setFlowModel:function(t){var e=this;this.$store.commit("flow/setFlowModel",t),this.reset(),this.nodes.forEach((function(n){n.reset(t),e.$bus.$emit("nodeMove",n)})),_.forEach(this.undoRedoStack,(function(e){e[1].data.length&&_.forEach(e[1].data,(function(e){e.reset(t)}))})),_.forEach(this.undoRedoStack,(function(t){t[3].data.length&&_.forEach(t[3].data,(function(n){e.$bus.$emit("resetLinePoint",n,t[1].data,t[2].data)}))}))},getSaveData:function(){var t=this;this.flow.attributes.BaseInfo.ID=this.sID;var e={WorkFlow:{BaseInfo:this.flow.attributes.BaseInfo,NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[],flowModel:this.flowModel},tools:this.leftTabs[0].data,businessTools:this.leftTabs[1].data,pageDocument:this.pageDocument,templateid:this.templateId,selectTemplateId:this.selectTemplateId};"systematic"===this.flowModel&&(e.sImgData=this.printImageUrl),this.nodes.forEach((function(t){if(t.lines){var e=dsf.mix(!0,[],t.lines);t.lines=e.map((function(t){return delete t.paper,t}))}t.events&&(t.events=t.events.map((function(t){return t.parentNodeId=t.parentNode.id,delete t.parentNode,yt({},t)})))}));for(var n={nodes:a()(JSON.parse(JSON.stringify(this.nodes))),lanes:yt({},this.lanes),lines:a()(this.lines),events:a()(this.events)},i=dsf.mix(!0,{},n),o=[],s=0;s<o.length;s++)for(var r=i.lines.length-1;r>=0;r--)i.lines[r].attributes.ID==o[s]&&i.lines.splice(r,1);for(var l=function(){var o,s,a=i.nodes[h];a.nodes&&a.nodes.forEach((function(t){delete t.isRender,delete t.edit})),ot["e"].forEach((function(t){t.components.forEach((function(t){a.attributes.BaseInfo.Type==t.name&&(a.attributes.BaseInfo.Type=t.type)}))})),"通用任务"==a.attributes.BaseInfo.Type&&(a.attributes.BaseInfo.Type=Number(a.type));var r=a.point.y,l=0;a.attributes.BaseInfo.StageID="",a.attributes.BaseInfo.CLaneID="";var c=null===(o=a.attributes)||void 0===o||null===(o=o.OutLine)||void 0===o||null===(o=o.SendConditions)||void 0===o||null===(o=o.Condition)||void 0===o||null===(o=o.Switch)||void 0===o?void 0:o.ItemValue;if((null===c||void 0===c?void 0:c.length)>0){var u,p=a;if("301"!=a.type)null===(u=a.out)||void 0===u||u.forEach((function(e){var n=Object(et["e"])(t.lines,e),i=Object(et["e"])(t.nodes,n.to);"301"==i.type&&(p=i)}));for(var f=c.length-1;f>=0;f--){var y,g;-1==(null===(y=p.out)||void 0===y?void 0:y.indexOf(null===c||void 0===c||null===(g=c[f])||void 0===g?void 0:g.LineID))&&c.splice(f,1)}}if((null===a||void 0===a||null===(s=a.out)||void 0===s?void 0:s.length)>0){var x=[];a.out.map((function(t){var e,n,o=Object(et["e"])(i.lines,t),s=Object(et["e"])(i.nodes,o.to);3==(null===s||void 0===s||null===(e=s.attributes)||void 0===e||null===(e=e.InLine)||void 0===e?void 0:e.Type)||4==(null===s||void 0===s||null===(n=s.attributes)||void 0===n||null===(n=n.InLine)||void 0===n?void 0:n.Type)?(x.push(d()({},t,s.id)),o.attributes.SendParameter.ccLine=1):o.attributes.SendParameter.ccLine=0})),a.attributes.OutLine.ccNodes=x}for(var v=0;v<n.lanes.horizontal.length;v++){var m=n.lanes.horizontal[v];if(l+=parseInt(m.size),r<l){a.attributes.BaseInfo.StageID=m.id,a.attributes.BaseInfo.CLaneID=m.id;break}}if("121"==a.type){var b=a.attributes.InLine.selectMode;a.attributes.InLine.RangeRule={Type:1==b?61:62,IsUser:1==b?1:0}}var w=a.point.x,O=0;a.attributes.BaseInfo.LLaneID="";for(var N=0;N<n.lanes.vertical.length;N++){var L=n.lanes.vertical[N];if(O+=parseInt(L.size),w<O){a.attributes.BaseInfo.LLaneID=L.id;break}}e.WorkFlow.NodeList.push(a.attributes),a.nodeType="node",e.WorkFlow.ElementList.push(a)},h=0;h<i.nodes.length;h++)l();for(var c=0;c<i.lines.length;c++){var u=i.lines[c];delete u.paper,this.setFreedomLine(u),e.WorkFlow.LineList.push(u.attributes),delete u.arrowEnd,delete u.isRender,u.nodeType="line",e.WorkFlow.ElementList.push(u)}for(var p=0;p<i.events.length;p++){var f=i.events[p];e.WorkFlow.EventList.push(f.attributes),f.nodeType="event",e.WorkFlow.ElementList.push(f)}for(var y=0;y<n.lanes.horizontal.length;y++){var g=n.lanes.horizontal[y],x=Object(et["b"])(g);delete x.isRender,e.WorkFlow.LaneList.horizontal.push(g.attributes),x.nodeType="lane",e.WorkFlow.ElementList.push(x)}for(var v=0;v<n.lanes.vertical.length;v++){var m=n.lanes.vertical[v],b=Object(et["b"])(m);delete b.isRender,e.WorkFlow.LaneList.vertical.push(m.attributes),b.nodeType="lane",e.WorkFlow.ElementList.push(b)}return e},setFreedomLine:function(t){var e=this.nodes.filter((function(e){return"121"==e.type&&e.id==t.to}));if(e.length>0){var n=e[0].attributes.InLine.selectMode,i={Type:1==n?61:62,IsUser:1==n?1:0},o=t.attributes.SendParameter;o.returnToSender&&(i.Type=1==o.afterGatherReturnToSender?64:63),o.RangeRule=i,o.IsInherit=0}},doSave:function(){var t=this.validate();t?dsf.layer.message(t,!1):this.saveFlow()},validate:function(){var t=this,e=function(t){var e=t||{},n=e.Type,i=void 0===n?0:n,o=e.Value,s=void 0===o?0:o,a={0:0,1:1440,2:480,13:60,14:1,23:60,24:1};return s*a[i]},n=function(n){var i=e(t.flow.attributes.BaseInfo.TimeLimit),o=e(n.attributes.BaseInfo.TimeLimit);return 0===i||0===o||i>=o},i="";return this.nodes.forEach(function(){var t=l()(u.a.mark((function t(e){var o,s,a,r,l,h,d,c,p,f,y,g,x;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0==(null===e||void 0===e||null===(o=e.in)||void 0===o?void 0:o.length)&&0==(null===e||void 0===e||null===(s=e.out)||void 0===s?void 0:s.length)&&(i="".concat(e.name,"节点无效，未连线，不能保存")),d=(null===e||void 0===e||null===(a=e.attributes)||void 0===a||null===(a=a.InLine)||void 0===a||null===(a=a.Parameter)||void 0===a?void 0:a.fullClassName)||"",199!=e.type||d){t.next=9;break}return t.next=5,Object(et["j"])(e.rid);case 5:c=t.sent,p={_content:{fullClassName:c.fullClassName}},f=dsf.base64.encode(JSON.stringify(p)),e.attributes.InLine.Parameter={fullClassName:c.fullClassName,MultiType:2,Type:1,actuatorType:0,paramMode:0,Content:f,ID:""};case 9:103!=e.type||d||(i="".concat(e.name,'的属性"执行参数"fullClassName不能为空')),y=(null===e||void 0===e||null===(r=e.attributes)||void 0===r||null===(r=r.InLine)||void 0===r||null===(r=r.Parameter)||void 0===r?void 0:r.dataBaseText)||"",114!=e.type&&115!=e.type||y||(i="".concat(e.name,'的属性"执行参数"未设置')),g=null===e||void 0===e||null===(l=e.attributes)||void 0===l||null===(l=l.InLine)||void 0===l?void 0:l.selectMode,x=null===e||void 0===e||null===(h=e.attributes)||void 0===h||null===(h=h.InLine)||void 0===h?void 0:h.selectRoleValue,121!=e.type||0!=g||x||(i="".concat(e.name,'的属性"设置角色"未设置')),n(e)||(i="“".concat(e.name,"”环节的办理期限不能大于整体流程的办理期限， 请修改。"));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.lines.forEach((function(t){var e,n;1!=(null===(e=t.attributes)||void 0===e||null===(e=e.BaseInfo)||void 0===e?void 0:e.Type)||null!==(n=t.attributes)&&void 0!==n&&null!==(n=n.BaseInfo)&&void 0!==n&&null!==(n=n.GatherRule)&&void 0!==n&&n.GatherRange||(i="".concat(t.name,'线"汇总信息"未设置，不能保存'))})),i},saveFlow:function(){var t=this;return l()(u.a.mark((function e(){var n,i,o,s;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=dsf.layer.loading(),!t.templateId){e.next=5;break}return i={isMobile:!1,md:JSON.stringify({accessRole:[],isForm:!0,pageState:"form",mode:"develop",xssConfig:{allow:!1},init:{privilege:[]},query:{},export:{},browseScope:{},metadata:{},isMobile:!1}),stateSetting:[],layout:t.$route.query.pname,extJsCode:t.$route.query.pname,evJsCode:t.$route.query.pname,templateid:t.templateId,pageName:t.$route.query.pname,namespace:t.$route.query.B+"."+t.$route.query.M,pageTitle:t.$route.query.title},e.next=5,t.$webAPI.pageBuild(i).done((function(t){t.state})).error((function(t){}));case 5:o=t.getSaveData(),s={sData:JSON.stringify(o)},Object.assign(s,{sID:t.$route.query.id},t.$route.query),t.$http.post("wfm/saveWFDefinition",s).done((function(t){t.success?dsf.layer.message("保存成功",!0):dsf.layer.message(t.message||"保存失败",!1)})).error((function(){dsf.layer.message("保存失败",!1)})).finally((function(){dsf.layer.closeLoading(n)}));case 9:case"end":return e.stop()}}),e)})))()},initEvent:function(){var t=this,e="mousedown",n="mousemove",i="mouseup",o="dragover",s="dragend";"ontouchstart"in window&&(e="touchstart",n=o="touchmove",i=s="touchend"),document.addEventListener(o,(function(e){t.dragNode&&(t.hasMoved=!0,t.isCtrlKey=e.ctrlKey||e.metaKey,t.dragToolOver(e)),t.dragEvent&&t.dragEventOver(e),t.dragAttach&&t.dragAttachedOver(e),t.pagePoint.pageX=e.clientX||e.pageX,t.pagePoint.pageY=e.clientY||e.pageY})),document.addEventListener(s,(function(e){!t.hasMoved&&t.dragNode&&(t.dragNode&&document.body.removeChild(t.dragNode),t.dragNode=null,t.$bus.$emit("isMoveNode",!1),t.hasMoved=!1),t.dragNode&&(t.dragToolEnd(e),t.dragNode=null,t.hasMoved=!1,t.$bus.$emit("isMoveNode",!1),t.$nextTick((function(){t.recordUndoData()}))),document.body.childNodes.forEach((function(t){var e,n,i,o;(null===(e=t.className)||void 0===e||null===(n=e.indexOf)||void 0===n?void 0:n.call(e,"drag_nodeOuter"))>-1&&(null===(i=t.className)||void 0===i||null===(o=i.indexOf)||void 0===o?void 0:o.call(i,"nodeOuter"))>-1&&document.body.removeChild(t)})),t.dragEvent&&(t.dragEventEnd(e),t.dragEvent&&document.body.removeChild(t.dragEvent),t.dragEvent=null,t.cloneObj=null,t.crashNode=null,t.$bus.$emit("endMoveEvent",!0),t.$nextTick((function(){t.recordUndoData()}))),t.dragAttach&&(t.dragAttachedEnd(e),t.dragAttach&&document.body.removeChild(t.dragAttach),t.dragAttach=null,t.cloneObj=null,t.crashNode=null,t.$bus.$emit("endMoveEvent",!0),t.$nextTick((function(){t.recordUndoData()})))})),this.$bus.$on("update-baseLine",(function(e){t.baseLine=e})),this.$bus.$on("update-checked",(function(e){t.checked=e||t.flow})),this.$bus.$on("parentAutoScroll",this.parentAutoScroll),this.$bus.$on("autoScroll",this.autoScroll),this.$bus.$on("resize",this.resize),this.$bus.$on("dragCloneEvent",this.dragCloneEvent),this.$bus.$on("dragCloneAttached",this.dragCloneAttached),this.$bus.$on("dragNode",this.dragTool),this.$bus.$on("dragEvents",this.dragEvents),this.$bus.$on("startGlobalMove",this.startGlobalMove),this.$bus.$on("startCopyNodes",this.startCopyNodes),this.$bus.$on("deleteLine",this.deleteLine),this.$bus.$on("initSubNode",this.initSubNode),document.addEventListener("keydown",this.keydown),window.onresize=function(){t.reset(),t.resize()},this.$refs.root.addEventListener(e,(function(e){var n,i;if(window.getSelection().removeAllRanges(),"svg"===(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.tagName)&&-1===(null===e||void 0===e||null===(i=e.target)||void 0===i||null===(i=i.parentNode)||void 0===i||null===(i=i.parentElement)||void 0===i?void 0:i.className.indexOf("subprocess"))){t.lines.forEach((function(t){t.edit.isEdit=!1,t.edit.editName=!1})),setTimeout((function(){t.checked=t.flow,t.$bus.$emit("selectGlobal",null)}),0),t.isGlobalSelect=!0;var o=t.$store.getters["flow/getSvgOffset"],s=t.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});t.selectGlobalPos={x:s.x+o.left,y:s.y+o.top}}})),this.$refs.root.addEventListener(n,_.throttle((function(e){t.readOnly||(t.setCursor(e),t.isGlobalPosMove&&t.globalMove(e),t.isGlobalSelect&&t.selectGlobalMove(e),t.isCopyNodes&&t.nodesMove(e))}),100)),document.addEventListener(i,(function(e){t.isGlobalPosMove&&(t.isGlobalPosMove=!1,t.globalPos=null,t.resize(),t.$store.commit("flow/clearPoints")),t.isGlobalSelect&&(t.selectGlobalEnd(e),t.resize(),t.$store.commit("flow/clearPoints")),t.isCopyNodes&&t.nodesMoveEnd(e)})),document.body.childNodes.forEach((function(t){var e,n,i,o;(null===(e=t.className)||void 0===e||null===(n=e.indexOf)||void 0===n?void 0:n.call(e,"drag_nodeOuter"))>-1&&(null===(i=t.className)||void 0===i||null===(o=i.indexOf)||void 0===o?void 0:o.call(i,"nodeOuter"))>-1&&document.body.removeChild(t)})),this.$refs.ds_page.addEventListener("wheel",this.scrollwheel,!0),document.addEventListener("copy",this.documentCopy),document.addEventListener("paste",this.pasteNode)},dragEvents:function(t,e){"401"!=e.type&&"402"!=e.type&&"403"!=e.type?this.dragAttached(t,e):this.dragBoundaryEvent(t,e)},initSubNode:function(t,e){var n=this;t.open.show=!0,t.lines&&t.lines.forEach((function(t){t.remove()})),this.$set(t,"nodes",[]),this.$set(t,"lines",[]),this.$set(t,"events",[]),e.forEach((function(e){if("node"==e.nodeType)Object.assign(e,{x:e.point.x,y:e.point.y}),t.nodes.push(n.addSubNode(e,t));else if("line"==e.nodeType){var i=e;i.linkInfo&&(i.linkInfo.fromOffset=parseFloat(i.linkInfo.fromOffset),i.linkInfo.toOffset=parseFloat(i.linkInfo.toOffset)),setTimeout((function(){n.$bus.$emit("addLine".concat(t.id),{id:i.id,type:i.type,name:i.name,path:i.path,from:i.from,fromType:i.fromType,to:i.to,linkInfo:i.linkInfo,attributes:i.attributes,parentNodeId:t.id})}),0)}else if("event"==e.nodeType){var o=new K["a"](e);o.parentNode=t,newNode.events.push(o)}})),this.nodeResize(t)},copyNewNode:function(t,e,n,i){Object(et["a"])(t);var o=t.target||t,s=o.cloneNode(!0);s.setAttribute("draggable",!0),s.offset={x:n?n.x:0,y:n?n.y:0},i&&(s.copyNode=e),i||102!==e.type||(s.tool=e),s.data=e,s.className=s.className+" drag_nodeOuter "+this.flowModel;var a=this.toPx(t.pageX-((e.padding||0)+s.offset.x)*this.scale),r=this.toPx(t.pageY-((e.padding||0)+s.offset.y)*this.scale);return Object.assign(s.style,{position:"absolute",zIndex:9999,top:0,left:0,pointerEvents:"none",cursor:"move",transform:"translate3d(".concat(a,", ").concat(r,", 0) scale(").concat(this.scale,")"),transformOrigin:"left top"}),document.body.appendChild(s),this.$bus.$emit("isMoveNode",i?s.copyNode:s),s},startCopyNodes:function(t){this.isCopyNodes=!0,this.copyNodesPos={x:t.pageX,y:t.pageY}},createCopyNodes:function(t){var e=this,n=this.selectedList||null;n&&n.length>1&&(this.copyNodes=[],n.forEach((function(t){var n=document.querySelector('.nodeOuter[data-id="'.concat(t.id,'"]')),i={x:t.point.x*e.scale,y:t.point.y*e.scale},o=e.$store.getters["flow/getMousePointByPoint"](i);n.pageX=o.x,n.pageY=o.y;var s=e.copyNewNode(n,t,null,!0);s.point=o,e.copyNodes.push(s)})))},dragTool:function(t,e,n,i){var o;n=null!==(o=n)&&void 0!==o?o:{x:t.offsetX-(this.page.left/2-nt["g"].width-this.page.left/2*.05)/2,y:t.offsetY-this.page.left/2*.05},this.dragNode=this.copyNewNode(t,e,n,i)},getDisplacement:function(t){var e={x:t.pageX,y:t.pageY},n=Object(et["d"])(this.copyNodesPos),i=Object(et["d"])(e);return{x:i.x-n.x,y:i.y-n.y}},nodesMove:function(t){var e=this,n=this.getDisplacement(t);(!this.copyNodes||this.copyNodes&&0===this.copyNodes.length)&&(Math.abs(n.x)>5||Math.abs(n.y)>5)&&this.createCopyNodes(t),this.copyNodes.forEach((function(t){var i=t.offset,o={x:t.point.x+n.x-i.x*e.scale,y:t.point.y+n.y-i.y*e.scale},s=e.toPx(o.x),a=e.toPx(o.y);t.style.transform="translate3d(".concat(s,", ").concat(a,", 0) scale(").concat(e.scale,")")})),this.isCtrlKey=t.ctrlKey||t.metaKey},dragToolOver:function(t){var e,n=this.dragNode,i=n.offset,o=this.toPx(t.pageX-i.x*this.scale),s=this.toPx(t.pageY-i.y*this.scale);n.style.transform="translate3d(".concat(o,", ").concat(s,", 0) scale(").concat(this.scale,")");var a=n.copyNode;if(this.endTarget=this.getTargetIsNodes(t.target,a||n.tool),this.endTarget){var r=this.endTarget&&this.endTarget.className;if((null===r||void 0===r||null===(e=r.indexOf)||void 0===e?void 0:e.call(r,"nodes isSub"))>-1){var l=Object(et["g"])(this.nodes,this.endTarget);this.$bus.$emit("dragToSubNode",a!==l?l:null)}else this.$bus.$emit("dragToSubNode",null);a&&this.$bus.$emit("moveCopyNode".concat(a.parentNodeId||""),t,a)}},getTargetIsNodes:function(t,e){var n,i,o,s,a=document.querySelector(".svgRoot");if(!a.contains(t))return null;if(e&&"102"==e.type&&(null===t||void 0===t||null===(o=t.className)||void 0===o||null===(s=o.indexOf)||void 0===s?void 0:s.call(o,"nodes isSub"))>-1)return this.getTargetIsNodes(null===t||void 0===t?void 0:t.parentElement);return(null===t||void 0===t||null===(n=t.className)||void 0===n||null===(i=n.indexOf)||void 0===i?void 0:i.call(n,"nodes"))>-1?t:this.getTargetIsNodes(null===t||void 0===t?void 0:t.parentElement)},getBeforeCopyLine:function(t,e){var n=this,i=[];t.forEach((function(t){i=[].concat(a()(i),a()(t.out),a()(t.in))})),i=a()(new Set(i));var o=[],s=[],r=[];return i.forEach((function(i){var a=Object(et["e"])(e,i);if(a){var l;l="event"===a.fromType?Object(et["e"])(n.events,a.from):Object(et["e"])(t,a.from);var h=Object(et["e"])(t,a.to);if(l&&h){var d,c=Object(et["b"])(a);c.id=nt["j"].uuid(),null!==c&&void 0!==c&&null!==(d=c.attributes)&&void 0!==d&&null!==(d=d.BaseInfo)&&void 0!==d&&d.ID&&(c.attributes.BaseInfo.ID=c.id),o.push({line:c,nodeId:l.id}),s.push({line:c,nodeId:h.id}),r.push(c)}}})),{fromNodeIds:o,toNodeIds:s,newLines:r}},resetLineFromAndTo:function(t,e,n,i){t.length>0&&t.forEach((function(t){var e;t.nodeId===i.id&&(n.out.push(t.line.id),t.line.from=n.id,null!==(e=t.line)&&void 0!==e&&null!==(e=e.attributes)&&void 0!==e&&null!==(e=e.BaseInfo)&&void 0!==e&&e.StartNodeID&&(t.line.attributes.BaseInfo.StartNodeID=n.id))})),e.length>0&&e.forEach((function(t){var e;t.nodeId===i.id&&(n.in.push(t.line.id),t.line.to=n.id,null!==(e=t.line)&&void 0!==e&&null!==(e=e.attributes)&&void 0!==e&&null!==(e=e.BaseInfo)&&void 0!==e&&e.EndNodeID&&(t.line.attributes.BaseInfo.EndNodeID=n.id))}))},copyEventsLines:function(t){var e=this;t.forEach((function(t){if("event"===t.fromType){var n=Object(et["e"])(e.events,t.from,"fromId");n?(delete n.fromId,t.from=n.id):t.from=null}t.from&&t.to&&e.$bus.$emit("addLine",{id:t.id,type:t.type,name:t.name,from:t.from,fromType:t.fromType,to:t.to,linkInfo:t.linkInfo})}))},nodesMoveEnd:function(t){var e=this;if(this.copyNodes&&this.copyNodes.length>0){var n,i=this.copyNodes.map((function(t){return t.copyNode})),o=this.getBeforeCopyLine(i,this.lines),s=o.fromNodeIds,a=o.toNodeIds,r=o.newLines,l=this.getDisplacement(t),h=[];this.copyNodes.forEach((function(i){var o=i.copyNode;e.pagePoint.pageX=i.point.x+l.x,e.pagePoint.pageY=i.point.y+l.y;var r=e.nodeMoveEnd(t,i);r.id===o.id?n=!0:e.resetLineFromAndTo(s,a,r,o),e.checked=r,h.push(r)})),n||this.copyEventsLines(r),this.$store.commit("flow/setSelectedList",h)}this.isCopyNodes=!1,this.copyNodesPos=null,this.copyNodes=[],this.$bus.$emit("isMoveNode",!1)},nodeMoveEnd:function(t,e){var n,i,o,s,a=e&&e.copyNode,r=e.offset;if(a)if(a.parentNodeId)this.deleteNode(a),delete a.id,delete a.parentNodeId,delete a.point,i=Object.assign(a,{x:t.pageX-r.x*this.scale>a.padding?t.pageX-r.x*this.scale:a.padding,y:t.pageY-r.y*this.scale>a.padding?t.pageY-r.y*this.scale:a.padding,mouseConvert:!0});else{var l=this.$store.getters["flow/getMousePointByCanvas"]({x:this.pagePoint.pageX-r.x*this.scale,y:this.pagePoint.pageY-r.y*this.scale}),h=l;if(h={x:h.x>a.padding?h.x:a.padding,y:h.y>a.padding?h.y:a.padding},this.isCtrlKey){s=a.id;var d=nt["j"].uuid(),c=JSON.parse(JSON.stringify(a));i=Object.assign({},c,{id:d,out:[],in:[],x:h.x,y:h.y}),i.attributes.BaseInfo.ID=d}else h={x:h.x/this.scale,y:h.y/this.scale},h=Object(et["d"])(h),a.point.x=h.x,a.point.y=h.y,this.$bus.$emit("nodeMove",a),o=!0}if(!o){var u,p=null===t||void 0===t||null===(u=t.target)||void 0===u?void 0:u.getAttribute("nodetype");i=i||{data:e.data,type:p,x:this.pagePoint.pageX-r.x*this.scale,y:this.pagePoint.pageY-r.y*this.scale,mouseConvert:!0},n=this.copyNodeNext(i,s,a)}return document.body.removeChild(e),this.resize(),o?a:n},copyNodeNext:function(t,e,n){var i=this,o=this.addNode(t);return this.nodes.push(o),e&&this.copyNodeEvent(e,o),n&&n.nodes&&n.nodes.length>0&&(o.nodes=[],n.nodes.forEach((function(t){var e=Object(et["b"])(t),n=Object.assign({x:e.point.x,y:e.point.y},e);o.nodes.push(i.addSubNode(n,o))}))),o},dragToolEnd:function(t){if(this.endTarget){var e,n,i=this.endTarget&&this.endTarget.className,o=Object(et["g"])(this.nodes,this.endTarget);if((null===i||void 0===i||null===(e=i.indexOf)||void 0===e?void 0:e.call(i,"nodes isSub"))>-1&&!this.verifySub(o)){if(o){var s,a;if(this.dragNode&&this.dragNode.copyNode){var r=this.dragNode.copyNode,l=this.dragNode.offset;if(!r.parentNodeId||r.parentNodeId&&r.parentNodeId!==o.id)s=Object.assign(r,{x:this.pagePoint.pageX-l.x*this.scale>r.padding?this.pagePoint.pageX-l.x*this.scale:r.padding,y:this.pagePoint.pageY-l.y*this.scale>r.padding?this.pagePoint.pageY-l.y*this.scale:r.padding,mouseConvert:!0}),this.deleteNode(r),delete r.id;else{s={x:this.pagePoint.pageX-l.x*this.scale,y:this.pagePoint.pageY-l.y*this.scale,mouseConvert:!0};var h=this.getOptions(s);r.point.x=h.x-o.point.x,r.point.y=h.y-o.point.y-o.imgHeight-2*o.padding,this.$bus.$emit("nodeMove".concat(r.parentNodeId),r),this.$bus.$emit("cutOffLine".concat(r.parentNodeId),r),a=!0}}if(!a){var d=t.target&&t.target.getAttribute("nodetype");s=s||{type:d,x:this.pagePoint.pageX,y:this.pagePoint.pageY,mouseConvert:!0};var c=this.addSubNode(s,o);o.nodes?o.nodes.push(c):this.$set(o,"nodes",[c]),this.$set(o,"lines",o.lines||[]),this.$set(o,"events",o.events||[]),this.nodeResize(o),this.$bus.$emit("cutOffLine".concat(c.parentNodeId),c)}}}else((null===i||void 0===i?void 0:i.indexOf("nodes"))>-1||(null===i||void 0===i||null===(n=i.indexOf)||void 0===n?void 0:n.call(i,"nodes isSub"))>-1&&this.verifySub(o))&&(this.checked=this.nodeMoveEnd(t,this.dragNode),this.$bus.$emit("cutOffLine",this.checked),this.$store.commit("flow/setSelectedList",[this.checked]))}},createDragNode:function(t,e){Object(et["a"])(t);var n=t.target.cloneNode(!0);n.className="ds_tool_event_drag",n.setAttribute("draggable",!1),n.offset={x:t.offsetX,y:t.offsetY};var i=Object(et["b"])(e);this.cloneObj=new K["a"](i,t);var o=this.toPx(t.pageY-t.offsetY),s=this.toPx(t.pageX-t.offsetX);return Object.assign(n.style,{position:"absolute",zIndex:9999,width:this.toPx(this.cloneObj.width),height:this.toPx(this.cloneObj.height),top:0,left:0,pointerEvents:"none",transform:"translate3d(".concat(o,", ").concat(s,", 0) scale(").concat(this.scale,")"),transformOrigin:"left top"}),document.body.appendChild(n),n},commonDragOver:function(t,e){if(t.dataTransfer.dropEffect="copy",e){var n,i,o,s,a=e.offset,r=this.computedPoint(t,e);if((null===(n=Array.from(null===t||void 0===t||null===(i=t.target)||void 0===i?void 0:i.classList))||void 0===n?void 0:n.indexOf("task-node"))>-1||null!==(o=Array.from(null===t||void 0===t||null===(s=t.target)||void 0===s?void 0:s.parentElement))&&void 0!==o&&o.indexOf("node")){var l=Object(et["f"])(this.nodes,"nodes",t.target);if(l&&!this.verifySub(l.parent)){var h,d,c,u=l.parent,p=l.sub;this.crashNode=p,c=0===(null===(h=this.cloneObj)||void 0===h||null===(h=h.type)||void 0===h?void 0:h.toString().indexOf("40"))&&0!==(null===p||void 0===p||null===(d=p.type)||void 0===d?void 0:d.indexOf("10"))?[]:this.$store.getters["flow/getPoints"](p.id),c||(this.$store.commit("flow/setPointsByNode",{node:p,obj:this.cloneObj}),c=this.$store.getters["flow/getPoints"](p.id));var f={point:{x:r.point.x-u.point.x*this.scale,y:r.point.y-(u.point.y+u.padding+u.imgHeight+2*u.padding)*this.scale}},y=this.getPoint(f,c,this.distance);if(y){this.cloneObj=Object.assign(this.cloneObj,y,{parentNode:u});var g=this.$store.getters["flow/getMousePointByPoint"](y.point),x=this.toPx(g.x+u.point.x*this.scale),v=this.toPx(g.y+(u.point.y+u.imgHeight+2*u.padding)*this.scale);return void(e.style.transform="translate3d(".concat(x,", ").concat(v,", 0) scale(").concat(this.scale,")"))}}var m=Object(et["g"])(this.nodes,t.target);if(m){var b,w,O;this.crashNode=m,O=0===(null===(b=this.cloneObj)||void 0===b||null===(b=b.type)||void 0===b?void 0:b.toString().indexOf("40"))&&0!==(null===m||void 0===m||null===(w=m.type)||void 0===w?void 0:w.indexOf("10"))?[]:this.$store.getters["flow/getPoints"](m.id),O||(this.$store.commit("flow/setPointsByNode",{node:m,obj:this.cloneObj}),O=this.$store.getters["flow/getPoints"](m.id));var N=this.getPoint(r,O,this.distance);if(N){this.cloneObj=Object.assign(this.cloneObj,N);var L=this.$store.getters["flow/getMousePointByPoint"](N.point),k=this.toPx(L.y),I=this.toPx(L.x);return void(e.style.transform="translate3d(".concat(I,", ").concat(k,", 0) scale(").concat(this.scale,")"))}}}this.crashNode=null;var P=this.toPx(t.pageX-a.x*this.scale),$=this.toPx(t.pageY-a.x*this.scale);e.style.transform="translate3d(".concat(P,", ").concat($,", 0) scale(").concat(this.scale,")")}},commonDragEnd:function(t){var e,n=this;if("drop"===t.type?(t=event||t,t.preventDefault()):event.touches&&(t=event.touches[0]?event.touches[0]:event),this.crashNode){var i=null!==(e=this.$store.getters["flow/getPoints"](this.crashNode.id))&&void 0!==e?e:[],o=this.computedPoint(t,this.cloneObj);if(this.cloneObj.parentNode){var s=this.cloneObj.parentNode;o={point:{x:o.point.x-s.point.x*this.scale,y:o.point.y-(s.point.y+s.padding+s.imgHeight+2*s.padding)*this.scale}}}var a=this.getPoint(o,i,this.distance);if(a){if(i.splice(null===i||void 0===i?void 0:i.indexOf(a),1),this.cloneObj.from){var r=this.cloneObj.parentNode?this.cloneObj.parentNode.events:this.events;r.forEach((function(t){t.id===n.cloneObj.from&&n.$store.commit("flow/addPoint",{id:n.cloneObj.nodeId,obj:{point:{x:t.point.x,y:t.point.y},index:t.index,direction:t.direction}})})),this.deleteEvent(this.cloneObj.from,r),this.cloneObj.id=this.cloneObj.from,delete this.cloneObj.from}this.cloneObj=Object.assign(this.cloneObj,a),this.cloneObj.point.x=this.cloneObj.point.x/this.scale,this.cloneObj.point.y=this.cloneObj.point.y/this.scale,this.cloneObj.nodeId=this.crashNode.id,this.checked=this.cloneObj,this.cloneObj.out&&this.cloneObj.out.length>0&&this.$bus.$emit("eventMove".concat(this.cloneObj.parentNode?this.cloneObj.parentNode.id:""),this.cloneObj)}}},dragBoundaryEvent:function(t,e){this.dragEvent=this.createDragNode(t,e),this.$bus.$emit("startMoveEvent",this.dragEvent)},dragEventOver:function(t){this.commonDragOver(t,this.dragEvent)},dragEventEnd:function(t){this.commonDragEnd(t),this.crashNode&&this.addNewEvent(this.cloneObj)},addNewEvent:function(t){t.parentNode?this.nodes.forEach((function(e){t.parentNode&&t.parentNode.id===e.id&&e.events.push(t)})):this.events.push(t)},dragAttached:function(t,e){var n=Object(et["b"])(e);n.name="mark"===e.type?1:"A",this.dragAttach=this.createDragNode(t,n),this.$bus.$emit("startMoveEvent",this.cloneObj)},dragAttachedOver:function(t){this.commonDragOver(t,this.dragAttach)},dragAttachedEnd:function(t){this.commonDragEnd(t),this.crashNode&&this.addNewEvent(this.cloneObj)},dragCloneEvent:function(t,e){var n=Object(et["b"])(e);n.from=e.id,n.id=nt["j"].uuid(),this.dragBoundaryEvent(t,n)},dragLineProperty:function(t,e){var n=Object(et["b"])(e);n.from=e.id,n.id=nt["j"].uuid(),this.dragBoundaryEvent(t,n)},copyNodeEvent:function(t,e){var n=this,i=[];if(this.events.forEach((function(e){e.nodeId===t&&i.push(Object(et["b"])(e))})),0!==i.length){this.$store.commit("flow/setPointsByNode",{node:e,obj:i[0]});var o=this.$store.getters["flow/getPoints"](e.id);o.forEach((function(t){i.forEach((function(i){i.direction===t.direction&&i.index===t.index&&(i.fromId=i.id,i.id=nt["j"].uuid(),i.point=t.point,i.nodeId=e.id,n.addNewEvent(i))}))}))}},getPoint:function(t,e,n){var i,o=this,s=0;return e.forEach((function(e){var a=o.getDistance(e,t);a<=n&&s<a&&(s=a,i=e)})),i},getDistance:function(t,e){var n=Math.sqrt(Math.pow(t.point.x-e.point.x,2)+Math.pow(t.point.y-e.point.y,2));return n},computedPoint:function(t,e){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY});return{point:Object(et["d"])(n)}},getOptions:function(t){var e=Object.assign({id:nt["j"].uuid(),type:1},t),n={x:e.x||0,y:e.y||0};if(1==e.mouseConvert){var i=this.$store.getters["flow/getMousePointByCanvas"]({x:e.x,y:e.y});n.x=i.x,n.y=i.y}return n=Object(et["d"])(n),e.x=n.x/this.scale,e.y=n.y/this.scale,e},addNode:function(t,e){var n=this.getOptions(t),i=n.type;n.name||102==i||(n.order=this.nodes.length+1),n.name=n.name||("201"===i?"开始":"299"===i?"结束":"")||"新建环节"+this.nodes.length;var o=new J["a"](n);return e&&"systematic"!==this.flowModel||o.reset(this.flowModel),o},addSubNode:function(t,e){var n=this.getOptions(t);n.name=n.name||"新建环节"+(e.nodes&&e.nodes.length||0),1==n.mouseConvert&&(n.x=n.x-e.point.x,n.y=n.y-e.point.y-e.imgHeight-2*e.padding);var i=new J["a"](n);return i.parentNodeId=e.id,i},showSubNode:function(t){},keydown:function(t){var e=this;if(this.unReDo(t),(!this.checked||!this.checked.readOnly)&&(46==t.keyCode||dsf.client.isMac()&&8==t.keyCode)&&t.target==document.body){var n=this.selectedList||null;if(n&&n.length>1)n.forEach((function(t){setTimeout((function(){e.deleteNode(t)}),0)}));else if(this.checked instanceof J["a"])this.deleteNode(this.checked,!0,!0),this.checked=this.flow;else if(this.checked instanceof q["a"])this.$store.commit("flow/deleteLane",this.checked),this.resize(),this.checked=this.flow;else if(this.checked instanceof Z["a"])this.deleteLine(this.checked,!0,!0),this.checked=this.flow;else if(this.checked instanceof K["a"]){var i=this.checked;"risk"===i.type||"mark"===i.type?dsf.layer.confirm({title:"",message:"确认删除？"}).then((function(){e.deleteEventAndLines(i)})).catch((function(){})):this.deleteEventAndLines(i)}}},deleteEventAndLines:function(t){for(var e,n=t["out"].length-1;n>=0;n--){var i=Object(et["e"])(this.lines,t["out"][n]);i&&this.deleteLine(i)}var o=Object(et["e"])(this.nodes,t.nodeId);null!==o&&void 0!==o&&null!==(e=o.attributes)&&void 0!==e&&null!==(e=e.InstitutionAndRiskInfoList)&&void 0!==e&&e.fxkz&&(o.attributes.InstitutionAndRiskInfoList.fxkz={});var s=t.parentNode?t.parentNode.events:this.events;this.deleteEvent(t.id,s,!0)},deleteNode:function(t,e){var n,i=this;if(!(t.parentNodeId&&(n=this.nodes.find((function(e){return t.parentNodeId===e.id})),e&&this.verifySub(n)))){var o=t.parentNodeId?n.nodes:this.nodes,s=t.parentNodeId?n.lines:this.lines,a=t.parentNodeId?n.events:this.events,r=null===o||void 0===o?void 0:o.indexOf(t);if(r>-1){var l=t;l.in.length>0&&l.out.length>0&&l.in.forEach((function(e){var n=Object(et["e"])(s,e);if(n){var a=Object(et["e"])(o,n.from);l.out.forEach((function(e){var r=Object(et["e"])(s,e);if(r){var l=Object(et["e"])(o,r.to);if(a===l)return;var h=nt["j"].uuid(),d={endPoint:r.path[r.path.length-1],fromDirection:n.linkInfo.fromDirection,fromNode:a,startPoint:n.path[0],targetDirection:r.linkInfo.toDirection,targetNode:l},c=Object(st["a"])(d),u={id:h,type:n.type,name:a.name+"→"+l.name,path:c,from:n.from,fromType:n.fromType,isHide:n.isHide,to:r.to,linkInfo:{fromDirection:n.linkInfo.fromDirection,fromOffset:n.linkInfo.fromOffset,toDirection:r.linkInfo.toDirection,toOffset:r.linkInfo.toOffset},attributes:Object.assign(n.attributes,{BaseInfo:{EndNodeID:r.to,ID:h,Name:a.name+"→"+l.name,StartNodeID:n.from}})};t.parentNodeId&&(u.parentNodeId=t.parentNodeId),i.$bus.$emit("addLine".concat(t.parentNodeId||""),u)}}))}}));for(var h=l.out.length-1;h>=0;h--){var d=Object(et["e"])(s,l.out[h]);d&&this.deleteLine(d)}for(var c=l.in.length-1;c>=0;c--){var u=Object(et["e"])(s,l.in[c]);u&&this.deleteLine(u)}for(var p=0;p<a.length;p++){var f=a[p].nodeId;if(f===l.id){for(var y=a[p],g=y.out.length-1;g>=0;g--){var x=Object(et["e"])(this.lines,y.out[g]);x&&this.deleteLine(x)}a.splice(p,1),p--}}o.splice(r,1)}this.recordUndoData()}},deleteLine:function(t,e,n){var i;if(!(t.parentNodeId&&(i=this.nodes.find((function(e){return t.parentNodeId===e.id})),e&&this.verifySub(i)))){t.remove();var o=t.parentNodeId?i.nodes:this.nodes,s=t.parentNodeId?i.lines:this.lines,a=null===s||void 0===s?void 0:s.indexOf(t);a>-1&&this.deleteFromOrOut(o,s,t,a),n&&this.recordUndoData()}},deleteFromOrOut:function(t,e,n,i){var o=Object(et["e"])(t,n.from),s=Object(et["e"])(t,n.to);if(o){var a,r=null===(a=o["out"])||void 0===a?void 0:a.indexOf(n.id);r>=0&&o["out"].splice(r,1)}if(s){var l,h=null===(l=s["in"])||void 0===l?void 0:l.indexOf(n.id);h>=0&&s["in"].splice(h,1)}e.splice(i,1),this.$bus.$emit("updateIntersection")},deleteEvent:function(t,e,n){var i=(e||this.events).findIndex((function(e){return e.id===t}));i>-1&&(e||this.events).splice(i,1),this.$store.commit("flow/addPoint",{id:this.checked.nodeId,obj:{point:{x:this.checked.point.x,y:this.checked.point.y},index:this.checked.index,direction:this.checked.direction}}),this.checked=this.flow},addLane:function(t,e){this.createLane({direction:t,index:e}),this.recordUndoData()},createLane:function(t){var e=t.direction;t.name=t.name||"泳道"+(this.lanes[e].length+1),t.id=t.id||nt["j"].uuid();var n=new q["a"](t),i=this.lanes[e][(t.index||this.lanes[e].length)-1];e==nt["a"].vertical?n.left=i?i.size+i.left:0:n.top=i?i.size+i.top:0,this.$store.commit("flow/addLane",{direction:e,lane:n,index:t.index}),this.resize()},onScroll:function(t){var e=t.target;this.$store.commit("flow/setSvgRoot",{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this.showZoneControl&&this.$bus.$emit("pageScroll",e)},getFromNodes:function(t){if(!t["in"]||t["in"].length<=0)return null;for(var e=[],n=0;n<t["in"].length;n++){var i=t["in"][n],o=Object(et["e"])(this.lines,i);if(o){var s=Object(et["e"])(this.nodes,o.from);e.push(s)}}return e},getToNodes:function(t){if(!t["out"]||t["out"].length<=0)return null;for(var e=[],n=0;n<t["out"].length;n++){var i=t["out"][n],o=Object(et["e"])(this.lines,i);if(o){var s=Object(et["e"])(this.nodes,o.to);e.push(s)}}return e},getFlowAllObjectMap:function(t){for(var e={},n=0;n<t.nodes.length;n++){var i=t.nodes[n];e[i.id]=i}for(var o=0;o<t.lines.length;o++){var s=t.lines[o];e[s.id]=s}for(var a=0;a<t.lanes.horizontal.length;a++){var r=t.lanes.horizontal[a];e[r.id]=r}for(var l=0;l<t.lanes.vertical.length;l++){r=t.lanes.vertical[l];e[r.id]=r}return e},drawLine:function(){this.isDrawLine=!this.isDrawLine},resize:function(){var t=this.page.width,e=this.page.height,n=t||0,i=e||0,o=this.lanes.vertical[this.lanes.vertical.length-1],s=this.$store.getters["flow/lanesWidth"];o&&o.size+o.left+s>n?this.width=o.size+o.left+s:this.width=t;var a=this.lanes.horizontal[this.lanes.horizontal.length-1],r=this.$store.getters["flow/lanesHeight"];a&&a.size+a.top+r>i?this.height=a.size+a.top+r:this.height=e;var l=0,h=0;this.nodes.forEach((function(t){t.width+t.point.x+2*t.padding>l&&(l=t.width+t.point.x+2*t.padding),t.height+t.point.y+2*t.padding+20>h&&(h=t.height+t.point.y+2*t.padding+20)})),this.width=this.width>l?this.width:l,this.height=this.height>h?this.height:h},nodeResize:function(t){var e=0,n=0;t.nodes.forEach((function(i){i.width+i.point.x+2*i.padding>e&&(e=i.width+i.point.x+2*i.padding),i.height+i.point.y+2*i.padding+20+t.imgHeight+2*t.padding>n&&(n=i.height+i.point.y+2*i.padding+20+t.imgHeight+2*t.padding)})),t.width=t.width>e?t.width:e,t.height=t.height>n?t.height:n,this.$bus.$emit("nodeMove",t)},autoScroll:function(t){var e=null,n=t.type;"node"==n?(e=t.point,t.mouse.x>this.width/2?e.x=e.x+t.data.width+this.maxSizeOffset:e.x=e.x,t.mouse.y>this.height/2?e.y=e.y+t.data.height+this.maxSizeOffset:e.y=e.y):"line"==n?(e=this.$store.getters["flow/getMousePointByCanvas"]({x:t.mouse.x,y:t.mouse.y}),t.mouse.x>this.width/2?e.x=e.x+this.maxSizeOffset:e.x=e.x-this.maxSizeOffset,t.mouse.y>this.height/2?e.y=e.y+this.maxSizeOffset:e.y=e.y-this.maxSizeOffset):"lane"==n&&(e=this.$store.getters["flow/getMousePointByCanvas"]({x:t.mouse.x,y:t.mouse.y}),t.mouse.x>this.width/2?e.x=e.x+this.maxSizeOffset:e.x=e.x,t.mouse.y>this.height/2?e.y=e.y+this.maxSizeOffset:e.y=e.y);var i,o,s,a=this.$refs.ds_page;a&&(e.x<a.scrollLeft&&(i=Math.abs(a.scrollLeft-e.x),o=a.scrollLeft,a.scrollLeft=o-i/3),e.y<a.scrollTop&&(i=Math.abs(a.scrollTop-e.y),s=a.scrollTop,a.scrollTop=s-i/3),e.h<a.scrollTop&&(i=Math.abs(a.scrollLeft-e.x),o=a.scrollLeft,a.scrollLeft=o-i/3),e.x>a.clientWidth+a.scrollLeft&&(this.width=e.x,i=Math.abs(a.clientWidth+a.scrollLeft-e.x),o=a.scrollLeft,a.scrollLeft=o+i/3),e.y>a.clientHeight+a.scrollTop&&(this.height=e.y,i=Math.abs(a.clientHeight+a.scrollTop-e.y),s=a.scrollTop,a.scrollTop=s+i/3))},parentAutoScroll:function(t){var e=t.mouse,n=t.point,i=t.parent,o=t.node;n.x>i.width+i.point.x?n.x=n.x+o.width+this.maxSizeOffset:n.x=n.x,n.y>i.height+i.point.y?n.y=n.y+o.height+this.maxSizeOffset:n.y=n.y,n.x>i.width+0&&(i.width=n.x),n.y>i.height+0&&(i.height=n.y),this.$bus.$emit("nodeMove",i),this.autoScroll({type:"node",data:i,mouse:{x:e.x,y:e.y},point:{x:n.x,y:n.y}})},setCursor:function(t){if("svg"!=t.target.tagName){t.target.className;if("path"==t.target.tagName){var e=Object(et["h"])(t.target);if(e){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY});e.type==nt["d"].horizontal?0==e.index&&Math.abs(e.sp.x-n.x)<=this.dragSize||e.isLast&&Math.abs(e.ep.x-n.x)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ns-resize"):0==e.index&&Math.abs(e.sp.y-n.y)<=this.dragSize||e.isLast&&Math.abs(e.ep.y-n.y)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ew-resize")}}}else this.setRootCursor("default")},setRootCursor:function(t){this.$refs.root.style.cursor=t},startGlobalMove:function(t){this.isGlobalPosMove=!0,this.globalPos=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY}),this.globalMoveLastMouse={x:t.pageX,y:t.pageY},this.globalRect=this.getRect()},globalMove:function(t){if(this.isGlobalPosMove){var e={x:t.pageX,y:t.pageY},n=Object(et["d"])(this.globalMoveLastMouse),i=Object(et["d"])(e),o={x:i.x-n.x,y:i.y-n.y};Number.MIN_VALUE,Number.MIN_VALUE;if(0==o.x&&0==o.y)return!1;var s=!1,a=!1;return this.globalRect.x+o.x>0&&(this.globalRect.x+=o.x,s=!0),this.globalRect.y+o.y>=0&&(this.globalRect.y+=o.y,a=!0),this.$bus.$emit("globalMove",o,s,a,t),void(this.globalMoveLastMouse=i)}},getRect:function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MIN_VALUE,o=0;o<this.nodes.length;o++){var s=this.nodes[o];s.point.x<t&&(t=s.point.x),s.point.x+s.width>n&&(n=s.point.x+s.width),s.point.y<e&&(e=s.point.y),s.point.y+s.height>i&&(i=s.point.y+s.height)}for(var a=0;a<this.lines.length;a++)for(var r=this.lines[a],l=0;l<r.path.length;l++)r.path[l].x<t&&(t=r.path[l].x),r.path[l].x>n&&(n=r.path[l].x),r.path[l].y<e&&(e=r.path[l].y),r.path[l].y>i&&(i=r.path[l].y);return{x:t,y:e,width:n,height:i}},getWheelDirect:function(t){var e;return t=t||window.event,t.wheelDelta?(t.wheelDelta>0&&(e="up"),t.wheelDelta<0&&(e="down")):t.detail&&(t.detail>0&&(e="up"),t.detail<0&&(e="down")),e},scrollwheel:function(t){if(t=t||window.event,t.wheelDelta&&(t.ctrlKey||t.metaKey)){t.preventDefault();var e=this.getWheelDirect(t);this.rootScale(e)}},rootScale:function(t){var e=1;e=Number("up"===t?(this.scale+.05<2?this.scale+.05:2).toFixed(2):(this.scale>.4?this.scale-.05:.4).toFixed(2)),this.$store.commit("flow/setPage",{scale:e}),this.$store.commit("flow/clearPoints")},selectGlobalMove:function(t){if(this.globalSelect||(this.globalSelect=document.createElement("div"),this.globalSelect.className="select-nodes",Object.assign(this.globalSelect.style,{zIndex:9999,transform:"translate3d(".concat(this.selectGlobalPos.x/this.scale,"px, ").concat(this.selectGlobalPos.y/this.scale,"px, 0)"),pointerEvents:"none"}),this.$refs.root.appendChild(this.globalSelect)),this.selectGlobalPos){var e,n,i,o,s=this.selectGlobalPos,a=this.$store.getters["flow/getSvgOffset"],r=this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY}),l={x:r.x+a.left,y:r.y+a.top};l.x>s.x?(n=s.x,i=l.x-s.x):(n=l.x,i=s.x-l.x),l.y>s.y?(e=s.y,o=l.y-s.y):(e=l.y,o=s.y-l.y),this.selectGlobalPonits.start.x=n/this.scale,this.selectGlobalPonits.start.y=e/this.scale,this.selectGlobalPonits.end.x=(n+i)/this.scale,this.selectGlobalPonits.end.y=(e+o)/this.scale,Object.assign(this.globalSelect.style,{transform:"translate3d(".concat(n/this.scale,"px, ").concat(e/this.scale,"px, 0)"),width:this.toPx(i/this.scale),height:this.toPx(o/this.scale)})}},selectGlobalEnd:function(t){if(this.isGlobalSelect=!1,this.globalSelect){this.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY});this.$bus.$emit("selectGlobal",this.selectGlobalPonits.start,this.selectGlobalPonits.end),this.$refs.root.removeChild(this.globalSelect),this.globalSelect=null}},documentCopy:function(t){if(0!==this.selectedList.length&&"BODY"===t.target.nodeName){t.preventDefault();var e,n=this.selectedList;e=n&&n.length>1?a()(n):[this.checked];var i=dsf.mix([],this.lines);i.forEach((function(t){return delete t.paper})),t.clipboardData.setData("flow",JSON.stringify({nodes:e,lines:i})),this.ctrlCopyIndex=1}},pasteNode:function(t){var e=this,n=t.clipboardData.getData("flow");if(n){n=JSON.parse(n);var i=n.nodes;if(!i)return!1;var o=this.getBeforeCopyLine(i,n.lines),s=o.fromNodeIds,a=o.toNodeIds,r=o.newLines,l=[],h={};i.forEach((function(t){var n=t,i=n.id,o=nt["j"].uuid(),r=JSON.parse(JSON.stringify(n)),d=Object.assign({},r,{id:o,out:[],in:[],x:n.point.x+10*e.ctrlCopyIndex,y:n.point.y+10*e.ctrlCopyIndex});d.attributes.BaseInfo.ID=o,h[i]=o;var c=e.copyNodeNext(d,i,n);e.resetLineFromAndTo(s,a,c,n),l.push(c),e.checked=c})),l.forEach((function(t){var e;if((null===(e=t.attributes)||void 0===e||null===(e=e.InLine)||void 0===e||null===(e=e.RangeRule)||void 0===e||null===(e=e.Rule)||void 0===e?void 0:e.length)>0){var n,i=null===(n=t.attributes)||void 0===n||null===(n=n.InLine)||void 0===n||null===(n=n.RangeRule)||void 0===n?void 0:n.Rule;i.forEach((function(t){if(22==t.Type){var e=t.NodeID;t.id=h[e],t.NodeID=h[e]}if(32==t.Type||41==t.Type){var n=t.NodeID;t.id=dsf.uuid(32),t.NodeID=h[n]}}))}})),this.copyEventsLines(r),t.preventDefault(),this.ctrlCopyIndex++,this.$store.commit("flow/setSelectedList",l)}},toPrintImage:function(t,e){var n=this,i=dsf.layer.loading();this.loadScript(l()(u.a.mark((function o(){var s,a;return u.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,n.html2canvas();case 2:s=o.sent,t?n.printImageUrl=s:(a=document.createElement("a"),a.download=n.flowInfo.BaseInfo.Name+".png",a.href=s,a.style.display="none",document.body.appendChild(a),n.$nextTick((function(){a.click(),document.body.removeChild(a),dsf.layer.closeLoading(i)}))),setTimeout((function(){e&&n.hideNodes(e,!1),t&&n.$nextTick((function(){n.saveFlow()})),n.isPrintImage=!1}),300);case 5:case"end":return o.stop()}}),o)}))))},html2canvas:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){var t=this.scale>1?this.width*this.scale:this.width/this.scale,e=this.scale>1?this.height*this.scale:this.height/this.scale;return html2canvas(this.$refs.container,{useCORS:!0,x:0,y:0,width:t,height:e}).then((function(t){var e=t.toDataURL("image/png",1);return e}))})),printImage:function(t){var e=this;if(0!==this.nodes.length){this.isPrintImage=!0;var n={nodes:this.nodes,value:[]};dsf.layer.openDialog({title:"选择需要隐藏的节点",width:"500px",height:"400px",overflow:"auto",content:"SumStartNode",params:n,btns:[{text:"确定",handler:function(){var n=l()(u.a.mark((function n(i){var o;return u.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=i.getContent(),!(o.length>0)){n.next=5;break}return e.hideNodes(o,!0),e.$nextTick((function(){e.toPrintImage(t,o)})),n.abrupt("return");case 5:e.toPrintImage(t);case 6:case"end":return n.stop()}}),n)})));function i(t){return n.apply(this,arguments)}return i}()},{text:"取消"}]})}else this.toPrintImage(t)},hideNodes:function(t,e){var n=this,i=[];t.forEach((function(t){n.nodes.forEach((function(n){n.id===t&&(n.isHide=e,i.push.apply(i,a()(n.in)),i.push.apply(i,a()(n.out)))})),n.events.forEach((function(n){n.nodeId===t&&(n.isHide=e,i.push.apply(i,a()(item.in)),i.push.apply(i,a()(item.out)))}))})),i.length>0&&this.$bus.$emit("hideLines",i,e)}},A),{},{getProperties:et["i"]}),destroyed:function(){document.removeEventListener("keydown",this.keydown)}},xt=gt,vt=Object(V["a"])(xt,i,o,!1,null,null,null);e["default"]=vt.exports},994:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dsf-designer-frame",{staticClass:"ds_workflow ds-designer ds_workflow_preview",class:t.flowModel,attrs:{id:"designer"},scopedSlots:t._u([{key:"right",fn:function(){return[t.isPreview?t._e():n("dsf-designer-right",[n("dsf-designer-right-item",{attrs:{icon:"icon-gongnengdingyi",title:"属性"}},[n("flow-info",{attrs:{checked:t.checked,nodes:t.nodes,lines:t.lines,"flow-info":t.flowInfo}})],1)],1)]},proxy:!0}])},[[n("div",{ref:"ds_page",staticClass:"ds_page design",on:{scroll:function(e){return t.onScroll(e)}}},[n("div",{ref:"container",staticClass:"flow",class:{"is-print-image":!0},style:{width:t.toPx(t.scale>1?t.width*t.scale:t.width/t.scale),height:t.toPx(t.scale>1?t.height*t.scale:t.height/t.scale),transform:"scale("+t.scale+") translateZ(0)",transformOrigin:"left top"}},[n("div",{ref:"root",staticClass:"root",class:{has_v_head:t.lanes&&t.lanes.vertical.length>0,has_h_head:t.lanes&&t.lanes.horizontal.length>0},style:{width:t.toPx(t.scale>1?t.width*t.scale:t.width/t.scale),height:t.toPx(t.scale>1?t.height*t.scale:t.height/t.scale)}},[t.baseLine.showV?n("span",{staticClass:"baseLine_v",style:{transform:"translate3d("+t.baseLine.left+"px, 0, 0)"}}):t._e(),t.baseLine.showH?n("span",{staticClass:"baseLine_h",style:{transform:"translate3d(0, "+t.baseLine.top+"px, 0)"}}):t._e(),n("flow-content",{ref:"flowContent",attrs:{"is-draw-line":t.isDrawLine,lines:t.lines,nodes:t.nodes,events:t.events,checked:t.checked}}),n("div",{ref:"backLayout",staticClass:"backgroundLayout"},[n("div",{ref:"v_lane",staticClass:"v_lane"},[n("lanes",{attrs:{lanes:t.lanes&&t.lanes.vertical,checked:t.checked},on:{addLane:t.addLane}})],1),n("div",{ref:"h_lane",staticClass:"h_lane"},[n("lanes",{attrs:{lanes:t.lanes&&t.lanes.horizontal,checked:t.checked},on:{addLane:t.addLane}})],1)])],1)])])]],2)},o=[],s=n(2),a=n.n(s),r=n(4),l=n.n(r),h=n(3),d=n.n(h),c=n(1),u=n.n(c),p=n(409),f=n(460),y=n(410),g=n(418),x=n(601),v=n(603),m=n(393),b=n(392),w=n(604),O=n(411),N=n(461);function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){d()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I={name:"Flow",components:{FlowContent:x["a"],Lanes:w["a"],FlowInfo:v["a"]},data:function(){return{activeNames:[0],isDrawLine:!1,dragNode:null,dragEvent:null,dragAttach:null,endTarget:null,width:0,height:0,maxWidth:0,maxHeight:0,flow:null,flowInfo:null,sID:dsf.url.queryString("id"),sPID:dsf.url.queryString("sPID"),nodes:[],lines:[],events:[],distance:30,cloneObj:null,crashNode:null,dragSize:20,maxSizeOffset:50,boundaryEvents:O["d"],attached:O["c"],checked:null,baseLine:{show:"",top:0,left:0},showLineV:!1,showLineH:!1,isGlobalPosMove:!1,globalPos:null,globalMoveLastMouse:null,globalRect:null,isGlobalSelect:!1,selectGlobalPos:null,selectGlobalPonits:{start:{x:0,y:0},end:{x:0,y:0}},globalSelect:null,isCtrlKey:!1,ctrlCopyIndex:1,isCopyNodes:!1,copyNodesPos:null,copyNodes:[],hasMoved:!1,isPrintImage:!1,printImageUrl:"",preData:[],isPreview:this.$route.meta.isPreview&&!this.$route.query.property,hasThrough:{nodes:"",lines:"",checked:""}}},provide:function(){var t=this;return{$designer:this,$flowModel:function(){return t.flowModel},$nodes:function(){return t.nodes},$lines:function(){return t.lines},$checked:function(){return t.checked},getObjById:m["e"],getProperties:m["i"],toPx:m["l"],$preData:function(){return t.preData},isPreview:this.isPreview}},computed:k({},Vuex.mapState({page:function(t){return t.flow.page},scale:function(t){return t.flow.page.scale},lanes:function(t){return t.flow.lanes},selectedList:function(t){return t.flow.selectedList},flowModel:function(t){return t.flow.flowModel}})),created:function(){},mounted:function(){var t=this;this.reset(),this.initPreview(),this.sID||this.sPID||window.addEventListener("message",(function(e){var n=e.data;"flowData"==n.type&&(t.preData=n.data,t.initDataDeal(n.data))}),!1)},methods:{loadScript:m["k"],toPx:m["l"],verifySub:m["m"],reset:function(){var t=this.$refs.ds_page.getBoundingClientRect();this.$store.commit("flow/setPage",{width:t.width,height:t.height,left:t.x,top:t.y,right:window.innerWidth-t.right,bottom:window.innerHeight-t.bottom}),this.resize()},printImage:function(){var t=this;if(0!==this.nodes.length){this.isPrintImage=!0;var e={nodes:this.nodes,value:[]};dsf.layer.openDialog({title:"选择需要隐藏的节点",width:"500px",height:"400px",overflow:"auto",content:"SumStartNode",params:e,btns:[{text:"确定",handler:function(){var e=l()(u.a.mark((function e(n){var i;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=n.getContent(),!(i.length>0)){e.next=5;break}return t.hideNodes(i,!0),t.$nextTick((function(){t.toPrintImage(i)})),e.abrupt("return");case 5:t.toPrintImage();case 6:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()},{text:"取消"}]})}else this.toPrintImage()},hideNodes:function(t,e){var n=this,i=[];t.forEach((function(t){n.nodes.forEach((function(n){n.id===t&&(n.isHide=e,i.push.apply(i,a()(n.in)),i.push.apply(i,a()(n.out)))})),n.events.forEach((function(n){n.nodeId===t&&(n.isHide=e,i.push.apply(i,a()(item.in)),i.push.apply(i,a()(item.out)))}))})),i.length>0&&this.$bus.$emit("hideLines",i,e)},toPrintImage:function(t){var e=this,n=dsf.layer.loading();this.loadScript(l()(u.a.mark((function i(){var o,s;return u.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,e.html2canvas();case 2:o=i.sent,s=document.createElement("a"),s.download=e.flowInfo.BaseInfo.Name+".png",s.href=o,e.$nextTick((function(){s.click(),dsf.layer.closeLoading(n)})),setTimeout((function(){t&&e.hideNodes(t,!1),e.isPrintImage=!1}),300);case 8:case"end":return i.stop()}}),i)}))))},html2canvas:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){var t=this.scale>1?this.width*this.scale:this.width/this.scale,e=this.scale>1?this.height*this.scale:this.height/this.scale;return html2canvas(this.$refs.container,{useCORS:!0,x:0,y:0,width:t,height:e}).then((function(t){var e=t.toDataURL("image/png",1);return e}))})),initPreview:function(){var t=this;return l()(u.a.mark((function e(){var n;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getWFData();case 2:n=e.sent,n&&t.initData(n),t.initEvent();case 5:case"end":return e.stop()}}),e)})))()},initDataDeal:function(t){var e=this;null===t||void 0===t||t.forEach((function(t,n){var i;e.addLane("vertical",n,t.groupName);var o=260,s=80,a=0;t.list.unshift({stepName:"开始"}),t.list.push({stepName:"结束"}),null===t||void 0===t||null===(i=t.list)||void 0===i||i.forEach((function(i,r){var l,h,d;0==r?(l="201",h=b["g"]):r==t.list.length-1?(l="299",h=b["g"]):(h=b["h"],l="101",d={show:!0,width:b["g"].width,height:b["g"].height});var c=o*n+o/2-h.width/2;a+=s;var u=a;a+=h.height;var p={type:l,name:i.stepName,width:h.width,height:h.height,point:{x:c,y:u},x:c,y:u};d&&(p.open=d);var f=e.addNode(p,!0);e.nodes.push(f)}))})),this.nodes.reduce((function(t,n,i,o){var s="201"==t.type||"299"==n.type;if(t.point.x==n.point.x||s){var a=e.getLineOps(t,n,s);e.$bus.$emit("addLine",a)}return n}))},getLineOps:function(t,e,n){var i=Object(m["d"])({x:t.point.x+t.width/2,y:t.point.y+t.height}),o=Object(m["d"])({x:e.point.x+e.width/2,y:e.point.y}),s=b["j"].uuid(),a=b["b"].Top;t.point.x==e.point.x||n||(a=b["b"].Left,o=Object(m["d"])({x:e.point.x,y:e.point.y+e.height/2}));var r={endPoint:o,fromDirection:b["b"].Bottom,fromNode:t,startPoint:i,targetDirection:a,targetNode:e},l=Object(N["a"])(r),h={id:s,name:t.name+"→"+e.name,path:l,from:t.id,to:e.id,linkInfo:{fromDirection:r.fromDirection,fromOffset:0,toDirection:r.targetDirection,toOffset:0},attributes:{BaseInfo:{EndNodeID:e.id,ID:s,Name:t.name+"→"+e.name,StartNodeID:t.id}}};return h},getWFData:function(){var t=this;if(this.sID){var e={sID:this.sID};return Object.assign(e,this.$route.query),this.$http.get("wfm/getWFDefinition",e).done((function(t){var e=t.data;return e})).catch((function(){t.flowInfo={}}))}if(this.sPID){var n={sPID:this.sPID};return this.$http.get("wfr/getWFTrajectories",n).done((function(e){var n=e.data,i=[],o=[];return n.WFTrajectories.forEach((function(e){"1"==e.status||"0"==e.status?(t.hasThrough.checked=e.nodeid,e.lineid&&o.push(e.lineid)):(i.push(e.nodeid),e.lineid&&o.push(e.lineid))})),t.hasThrough.nodes=_.uniq(i).join(","),t.hasThrough.lines=_.uniq(o).join(","),null===n||void 0===n?void 0:n.wfDefinition})).catch((function(){t.flowInfo={}}))}return{}},initData:function(t){var e=this;return l()(u.a.mark((function n(){var i,o,s;return u.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o={BaseInfo:{ID:"",Name:"",Version:"0.0.0001",TimeLimit:{Type:"",Value:""},Desc:"",Event:{onStart:"",onClose:"",onForceClose:"",onExSend:"",onDestory:""},Vendor:{ID:"",Name:""}},NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[]},e.flowInfo=(null===t||void 0===t?void 0:t.WorkFlow)||o,s=(null===t||void 0===t?void 0:t.flowModel)||(null===t||void 0===t||null===(i=t.WorkFlow)||void 0===i?void 0:i.flowModel)||"normal",e.setFlowModel(s),e.loadElement();case 5:case"end":return n.stop()}}),n)})))()},loadElement:function(){var t=this,e=this.flowInfo&&this.flowInfo.ElementList||[];if(e&&e.length>0)for(var n=function(){var n=e[i];if("node"==n.nodeType){var o,s=n;s.in=s.in||[],s.out=s.out||[],s.point.x=parseFloat(s.point.x),s.point.y=parseFloat(s.point.y),s=Object.assign({x:s.point.x,y:s.point.y},s),O["e"].forEach((function(t){t.components.forEach((function(t){s.attributes.BaseInfo.Type==t.type&&(s.attributes.BaseInfo.Type=t.name)}))}));var a=t.addNode(s);if(a.id==(null===(o=t.hasThrough)||void 0===o?void 0:o.checked)&&(t.checked=a),s.nodes){var r=s.nodes;a.nodes=[],a.lines=[],a.events=[],r.forEach((function(e){e=Object.assign({x:e.point.x,y:e.point.y},e),a.nodes.push(t.addSubNode(e,a))}))}s.events&&s.events.forEach((function(t){var e=new g["a"](t);e.parentNode=s,a.events.push(e)})),s.lines&&s.lines.forEach((function(e){e.linkInfo&&(e.linkInfo.fromOffset=parseFloat(e.linkInfo.fromOffset),e.linkInfo.toOffset=parseFloat(e.linkInfo.toOffset)),e.parentNodeId=s.id,setTimeout((function(){t.$bus.$emit("addLine".concat(s.id),e)}),0)})),t.nodes.push(a)}else if("line"==n.nodeType){var l,h,d=n;if(d.linkInfo&&(d.linkInfo.fromOffset=parseFloat(d.linkInfo.fromOffset),d.linkInfo.toOffset=parseFloat(d.linkInfo.toOffset)),t.isPreview)(null===(l=t.hasThrough)||void 0===l||null===(l=l.lines)||void 0===l||null===(h=l.indexOf)||void 0===h?void 0:h.call(l,d.id))>-1&&(d.isThrough=!0);setTimeout((function(){t.$bus.$emit("addLine",d)}),0)}else if("lane"==n.nodeType){var c=n;t.createLane({id:c.id,name:c.name,size:c.size,index:c.index,direction:c.direction,attributes:c.attributes})}else"event"==n.nodeType&&t.events.push(new g["a"](n))},i=0;i<e.length;i++)n();this.resize()},setFlowModel:function(t){var e=this;this.$store.commit("flow/setFlowModel",t),this.nodes.forEach((function(n){n.reset(t),e.$bus.$emit("nodeMove",n)}))},initEvent:function(){var t=this;this.$bus.$on("update-checked",(function(e){t.checked=e||t.flow})),this.$bus.$on("resize",this.resize),this.$bus.$on("deleteLine",this.deleteLine),this.$bus.$on("initSubNode",this.initSubNode),document.addEventListener("keydown",this.keydown),window.onresize=function(){t.reset(),t.resize()}},initSubNode:function(t,e){var n=this;t.open.show=!0,t.lines&&t.lines.forEach((function(t){t.remove()})),this.$set(t,"nodes",[]),this.$set(t,"lines",[]),this.$set(t,"events",[]),e.forEach((function(e){if("node"==e.nodeType)Object.assign(e,{x:e.point.x,y:e.point.y}),t.nodes.push(n.addSubNode(e,t));else if("line"==e.nodeType){var i=e;i.linkInfo&&(i.linkInfo.fromOffset=parseFloat(i.linkInfo.fromOffset),i.linkInfo.toOffset=parseFloat(i.linkInfo.toOffset)),setTimeout((function(){n.$bus.$emit("addLine".concat(t.id),{id:i.id,type:i.type,name:i.name,path:i.path,from:i.from,fromType:i.fromType,to:i.to,linkInfo:i.linkInfo,attributes:i.attributes,parentNodeId:t.id})}),0)}else if("event"==e.nodeType){var o=new g["a"](e);o.parentNode=t,newNode.events.push(o)}}))},getOptions:function(t){var e=Object.assign({id:b["j"].uuid(),type:1},t),n={x:e.x||0,y:e.y||0};if(1==e.mouseConvert){var i=this.$store.getters["flow/getMousePointByCanvas"]({x:e.x,y:e.y});n.x=i.x,n.y=i.y}return n=Object(m["d"])(n),e.x=n.x/this.scale,e.y=n.y/this.scale,e},addNode:function(t,e){var n,i,o=this.getOptions(t),s=o.type;(o.name||102==s||(o.order=this.nodes.length+1),o.name=o.name||("201"===s?"开始":"299"===s?"结束":"")||"新建环节"+this.nodes.length,this.isPreview)&&((null===(n=this.hasThrough)||void 0===n||null===(n=n.nodes)||void 0===n||null===(i=n.indexOf)||void 0===i?void 0:i.call(n,t.id))>-1&&(o.isThrough=!0));var a=new p["a"](o);return e||a.reset(this.flowModel),a},addSubNode:function(t,e){var n=this.getOptions(t);n.name=n.name||"新建环节"+(e.nodes&&e.nodes.length||0),1==n.mouseConvert&&(n.x=n.x-e.point.x,n.y=n.y-e.point.y-e.imgHeight-2*e.padding);var i=new p["a"](n);return i.parentNodeId=e.id,i},keydown:function(t){if((!this.checked||!this.checked.readOnly)&&46==t.keyCode){var e=this.selectedList||null;e&&e.length>1||(this.checked instanceof p["a"]?(this.deleteNode(this.checked,!0),this.checked=this.flow):this.checked instanceof f["a"]||this.checked instanceof y["a"]||(this.checked,g["a"]))}},deleteEventAndLines:function(t){for(var e,n=t["out"].length-1;n>=0;n--){var i=Object(m["e"])(this.lines,t["out"][n]);i&&this.deleteLine(i)}var o=Object(m["e"])(this.nodes,t.nodeId);null!==o&&void 0!==o&&null!==(e=o.attributes)&&void 0!==e&&null!==(e=e.InstitutionAndRiskInfoList)&&void 0!==e&&e.fxkz&&(o.attributes.InstitutionAndRiskInfoList.fxkz={});var s=t.parentNode?t.parentNode.events:this.events;this.deleteEvent(t.id,s,!0)},deleteNode:function(t,e){var n,i=this;if(!(t.parentNodeId&&(n=this.nodes.find((function(e){return t.parentNodeId===e.id})),e&&this.verifySub(n)))){var o,s=t.parentNodeId?n.nodes:this.nodes,a=t.parentNodeId?n.lines:this.lines,r=t.parentNodeId?n.events:this.events,l=null===s||void 0===s?void 0:s.indexOf(t);if(l>-1){var h=t;h.in.length>0&&h.out.length>0&&h.in.forEach((function(e){var n=Object(m["e"])(a,e);if(n){var o=Object(m["e"])(s,n.from);h.out.forEach((function(e){var r=Object(m["e"])(a,e);if(r){var l=Object(m["e"])(s,r.to);if(o===l)return;var h=b["j"].uuid(),d={endPoint:r.path[r.path.length-1],fromDirection:n.linkInfo.fromDirection,fromNode:o,startPoint:n.path[0],targetDirection:r.linkInfo.toDirection,targetNode:l},c=Object(N["a"])(d),u={id:h,type:n.type,name:o.name+"→"+l.name,path:c,from:n.from,fromType:n.fromType,isHide:n.isHide,to:r.to,linkInfo:{fromDirection:n.linkInfo.fromDirection,fromOffset:n.linkInfo.fromOffset,toDirection:r.linkInfo.toDirection,toOffset:r.linkInfo.toOffset},attributes:Object.assign(n.attributes,{BaseInfo:{EndNodeID:r.to,ID:h,Name:o.name+"→"+l.name,StartNodeID:n.from}})};t.parentNodeId&&(u.parentNodeId=t.parentNodeId),i.$bus.$emit("addLine".concat(t.parentNodeId||""),u)}}))}}));for(var d=h.out.length-1;d>=0;d--){var c=Object(m["e"])(a,h.out[d]);c&&this.deleteLine(c)}for(var u=h.in.length-1;u>=0;u--){var p=Object(m["e"])(a,h.in[u]);p&&this.deleteLine(p)}for(var f=0;f<r.length;f++){var y=r[f].nodeId;if(y===h.id){for(var g=r[f],x=g.out.length-1;x>=0;x--){var v=Object(m["e"])(this.lines,g.out[x]);v&&this.deleteLine(v)}r.splice(f,1),f--}}s.splice(l,1)}if(this.isPreview)null===(o=this.preData)||void 0===o||o.forEach((function(e){e.list.forEach((function(e){e.wholeName==t.name&&window.parent.postMessage({type:"nodeDel",data:e},"*")}))}));else;}},deleteLine:function(t,e){var n;if(!(t.parentNodeId&&(n=this.nodes.find((function(e){return t.parentNodeId===e.id})),e&&this.verifySub(n)))){t.remove();var i=t.parentNodeId?n.nodes:this.nodes,o=t.parentNodeId?n.lines:this.lines,s=null===o||void 0===o?void 0:o.indexOf(t);s>-1&&this.deleteFromOrOut(i,o,t,s)}},deleteFromOrOut:function(t,e,n,i){var o=Object(m["e"])(t,n.from),s=Object(m["e"])(t,n.to);if(o){var a,r=null===(a=o["out"])||void 0===a?void 0:a.indexOf(n.id);r>=0&&o["out"].splice(r,1)}if(s){var l,h=null===(l=s["in"])||void 0===l?void 0:l.indexOf(n.id);h>=0&&s["in"].splice(h,1)}e.splice(i,1),this.$bus.$emit("updateIntersection")},deleteEvent:function(t,e,n){var i=(e||this.events).findIndex((function(e){return e.id===t}));i>-1&&(e||this.events).splice(i,1),this.$store.commit("flow/addPoint",{id:this.checked.nodeId,obj:{point:{x:this.checked.point.x,y:this.checked.point.y},index:this.checked.index,direction:this.checked.direction}}),this.checked=this.flow},addLane:function(t,e,n){this.createLane({direction:t,index:e,name:n})},createLane:function(t){var e=t.direction;t.name=t.name||"泳道"+(this.lanes[e].length+1),t.id=t.id||b["j"].uuid();var n=new f["a"](t),i=this.lanes[e][(t.index||this.lanes[e].length)-1];e==b["a"].vertical?n.left=i?i.size+i.left:0:n.top=i?i.size+i.top:0,this.$store.commit("flow/addLane",{direction:e,lane:n,index:t.index}),this.resize()},resize:function(){var t=this.page.width,e=this.page.height,n=t||0,i=e||0,o=this.lanes.vertical[this.lanes.vertical.length-1],s=this.$store.getters["flow/lanesWidth"];o&&o.size+o.left+s>n?this.width=o.size+o.left+s:this.width=t;var a=this.lanes.horizontal[this.lanes.horizontal.length-1],r=this.$store.getters["flow/lanesHeight"];a&&a.size+a.top+r>i?this.height=a.size+a.top+r:this.height=e;var l=0,h=0;this.nodes.forEach((function(t){t.width+t.point.x+2*t.padding>l&&(l=t.width+t.point.x+2*t.padding),t.height+t.point.y+2*t.padding+20>h&&(h=t.height+t.point.y+2*t.padding+20)})),this.width=this.width>l?this.width:l,this.height=this.height>h?this.height:h},onScroll:function(t){var e=t.target;this.$store.commit("flow/setSvgRoot",{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this.showZoneControl&&this.$bus.$emit("pageScroll",e)}}},P=I,$=n(0),j=Object($["a"])(P,i,o,!1,null,null,null);e["default"]=j.exports}}]);
//# sourceMappingURL=../../../smap/platform/dsf-platform.platform_designer_router_flow.js.map